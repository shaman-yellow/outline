% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\usepackage{caption} \captionsetup{font={footnotesize},width=6in} \renewcommand{\dblfloatpagefraction}{.9} \makeatletter \renewenvironment{figure} {\def\@captype{figure}} \makeatletter \definecolor{shadecolor}{RGB}{242,242,242} \usepackage{xeCJK} \usepackage{setspace} \setstretch{1.3}
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={R codes of build and test MCnebula2},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{R codes of build and test MCnebula2}
\author{}
\date{\vspace{-2.5em}}

\begin{document}
\maketitle

{
\setcounter{tocdepth}{3}
\tableofcontents
}
\hypertarget{file-combine_fig.pathway.r}{%
\section{File: combine\_fig.pathway.R}\label{file-combine_fig.pathway.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# combine 3 figures of png of pathway enrichment}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\NormalTok{pngs }\OtherTok{\textless{}{-}} \FunctionTok{list.files}\NormalTok{(}\AttributeTok{pattern =} \StringTok{"pathway.*}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.png"}\NormalTok{)}
\NormalTok{pngs }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(pngs, png}\SpecialCharTok{::}\NormalTok{readPNG)}
\FunctionTok{names}\NormalTok{(pngs) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"ACs"}\NormalTok{, }\StringTok{"BAs"}\NormalTok{, }\StringTok{"LPCs"}\NormalTok{)}

\NormalTok{pngs }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(pngs,}
  \ControlFlowTok{function}\NormalTok{(png) \{}
    \FunctionTok{grid.grabExpr}\NormalTok{(}\FunctionTok{grid.raster}\NormalTok{(png))}
\NormalTok{  \})}

\NormalTok{grobs }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{3}\NormalTok{,}
  \ControlFlowTok{function}\NormalTok{(n, }\AttributeTok{x =} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"c"}\NormalTok{)) \{}
    \FunctionTok{into}\NormalTok{(}\FunctionTok{grecta}\NormalTok{(x[n], }\AttributeTok{cex =} \DecValTok{3}\NormalTok{), pngs[[ n ]])}
\NormalTok{  \})}
\FunctionTok{names}\NormalTok{(grobs) }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(pngs)}

\NormalTok{grobs.path }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{ACs =} \DecValTok{1}\NormalTok{, }\AttributeTok{BAs =} \DecValTok{1}\NormalTok{, }\AttributeTok{LPCs =} \DecValTok{1}\NormalTok{), grobs)}
\NormalTok{grobs.path }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(grobs.path, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{95}\NormalTok{, .}\DecValTok{95}\NormalTok{))}

\FunctionTok{pdf}\NormalTok{(}\StringTok{"pathway.pdf"}\NormalTok{, }\DecValTok{7}\NormalTok{, }\DecValTok{7}\NormalTok{)}
\FunctionTok{draw}\NormalTok{(grobs.path)}
\FunctionTok{dev.off}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-create_exmcnebula2.r}{%
\section{File: create\_exMCnebula2.R}\label{file-create_exmcnebula2.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# An attached package that packages the analysis tools used for the study.}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\FunctionTok{new\_package.fromFiles}\NormalTok{(}\StringTok{"\textasciitilde{}/exMCnebula2"}\NormalTok{,}
  \FunctionTok{c}\NormalTok{(}\StringTok{"aaa.R"}\NormalTok{, }\StringTok{"grid\_draw.R"}\NormalTok{, }\StringTok{"dot\_heatmap.R"}\NormalTok{, }\StringTok{"query\_synonyms.R"}\NormalTok{,}
    \StringTok{"query\_inchikey.R"}\NormalTok{, }\StringTok{"query\_classification.R"}\NormalTok{, }\StringTok{"query\_others.R"}\NormalTok{,}
    \StringTok{"output\_identification.R"}\NormalTok{, }\StringTok{"pick\_annotation.R"}\NormalTok{, }\StringTok{"alignment\_merge.R"}\NormalTok{,}
    \StringTok{"pathway\_enrichment.R"}\NormalTok{, }\StringTok{"cross\_select.R"}\NormalTok{, }\StringTok{"exReport.R"}\NormalTok{, }\StringTok{"plot\_EIC\_stack.R"}\NormalTok{),}
  \AttributeTok{path =} \StringTok{"\textasciitilde{}/utils.tool/R/"}\NormalTok{, }\AttributeTok{exclude =} \FunctionTok{c}\NormalTok{(}\StringTok{"MSnbase"}\NormalTok{, }\StringTok{"MetaboAnalystR"}\NormalTok{))}

\CommentTok{\# list.files("\textasciitilde{}/utils.tool/inst/extdata", full.names = T)}
\NormalTok{files }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \StringTok{"/home/echo/utils.tool/inst/extdata/mcn\_serum6501.rdata"}\NormalTok{,}
  \StringTok{"/home/echo/utils.tool/inst/extdata/mcn\_herbal1612.rdata"}\NormalTok{,}
  \StringTok{"/home/echo/utils.tool/inst/extdata/serum.tar.gz"}\NormalTok{,}
  \StringTok{"/home/echo/utils.tool/inst/extdata/herbal.tar.gz"}\NormalTok{,}
  \StringTok{"/home/echo/utils.tool/inst/extdata/svg"}\NormalTok{,}
  \StringTok{"/home/echo/utils.tool/inst/extdata/toActiv30.rdata"}\NormalTok{,}
  \StringTok{"/home/echo/utils.tool/inst/extdata/toBinary5.rdata"}\NormalTok{,}
  \StringTok{"/home/echo/utils.tool/inst/extdata/toAnno5.rdata"}\NormalTok{,}
  \StringTok{"/home/echo/utils.tool/inst/extdata/evaluation.tar.gz"}
\NormalTok{)}

\FunctionTok{lapply}\NormalTok{(files, file.copy, }\AttributeTok{to =} \StringTok{"\textasciitilde{}/exMCnebula2/inst/extdata"}\NormalTok{,}
       \AttributeTok{recursive =}\NormalTok{ T)}

\NormalTok{files2 }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}
  \AttributeTok{evaluation\_workflow =} \FunctionTok{c}\NormalTok{(}\StringTok{"/home/echo/outline/mc.test/evaluation\_workflow/evaluation\_workflow.R"}\NormalTok{,}
    \StringTok{"\textasciitilde{}/tmp\_backup/R/evaluation/report.pdf"}\NormalTok{),}
  \AttributeTok{eucommia\_workflow =} \FunctionTok{c}\NormalTok{(}\StringTok{"/home/echo/outline/mc.test/eucommia\_workflow/eucommia\_workflow.R"}\NormalTok{,}
    \StringTok{"\textasciitilde{}/tmp\_backup/R/eucommia/temp\_data/report.pdf"}\NormalTok{),}
  \AttributeTok{serum\_workflow =} \FunctionTok{c}\NormalTok{(}\StringTok{"/home/echo/outline/mc.test/serum\_workflow/serum\_workflow.R"}\NormalTok{,}
    \StringTok{"\textasciitilde{}/tmp\_backup/R/serum/temp\_data/report.pdf"}\NormalTok{),}
  \AttributeTok{mcn\_principle =} \FunctionTok{c}\NormalTok{(}\StringTok{"/home/echo/outline/mc.test/mcn\_principle/a\_elements.R"}\NormalTok{,}
    \StringTok{"/home/echo/outline/mc.test/mcn\_principle/b\_gather.R"}\NormalTok{,}
    \StringTok{"/home/echo/outline/mc.test/mcn\_principle/figure\_mech.pdf"}\NormalTok{),}
  \AttributeTok{mcn\_structure =} \FunctionTok{c}\NormalTok{(}\StringTok{"/home/echo/outline/mc.test/mcn\_structure/a\_project.R"}\NormalTok{,}
    \StringTok{"/home/echo/outline/mc.test/mcn\_structure/b\_mcn\_dataset.R"}\NormalTok{,}
    \StringTok{"/home/echo/outline/mc.test/mcn\_structure/c\_nebulae.R"}\NormalTok{,}
    \StringTok{"/home/echo/outline/mc.test/mcn\_structure/d\_across.R"}\NormalTok{,}
    \StringTok{"/mnt/data/wizard/Documents/article/MCnebula2/data\_stream.pdf"}\NormalTok{)}
\NormalTok{)}

\NormalTok{path }\OtherTok{\textless{}{-}} \StringTok{"\textasciitilde{}/exMCnebula2/inst/extdata/scripts\_evaluation"}
\FunctionTok{dir.create}\NormalTok{(path)}
\FunctionTok{lapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(files2),}
  \ControlFlowTok{function}\NormalTok{(name) \{}
\NormalTok{    dir }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(path, }\StringTok{"/"}\NormalTok{, name)}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{file.exists}\NormalTok{(dir))}
      \FunctionTok{dir.create}\NormalTok{(dir)}
    \FunctionTok{lapply}\NormalTok{(files2[[ name ]], file.copy,}
      \AttributeTok{to =}\NormalTok{ dir, }\AttributeTok{overwrite =}\NormalTok{ T, }\AttributeTok{recursive =}\NormalTok{ T)}
\NormalTok{  \})}

\DocumentationTok{\#\# update simulate\_and\_evaluate.R}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-delete_examples.r}{%
\section{File: delete\_examples.R}\label{file-delete_examples.r}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{setwd}\NormalTok{(}\StringTok{"\textasciitilde{}/MCnebula2/R"}\NormalTok{)}
\FunctionTok{library}\NormalTok{(magrittr)}

\NormalTok{script }\OtherTok{\textless{}{-}} \FunctionTok{list.files}\NormalTok{(}\StringTok{"."}\NormalTok{, }\AttributeTok{pattern =} \StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.R$"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{sapply}\NormalTok{(readLines)}

\NormalTok{target }\OtherTok{\textless{}{-}} 
  \FunctionTok{lapply}\NormalTok{(script,}
         \ControlFlowTok{function}\NormalTok{(text)\{}
\NormalTok{           sig }\OtherTok{\textless{}{-}} \DecValTok{0}
\NormalTok{           if\_exam }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(F, }\FunctionTok{length}\NormalTok{(text))}
           \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(text)) \{}
             \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{grepl}\NormalTok{(}\StringTok{"\^{}\#\textquotesingle{}"}\NormalTok{, text[i])) \{}
               \ControlFlowTok{next}
\NormalTok{             \}}
             \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{grepl}\NormalTok{(}\StringTok{"\^{}\#\textquotesingle{} @examples"}\NormalTok{, text[i])) \{}
\NormalTok{               sig }\OtherTok{\textless{}{-}} \DecValTok{2}
\NormalTok{               if\_exam[i] }\OtherTok{\textless{}{-}}\NormalTok{ T}
               \ControlFlowTok{next}
\NormalTok{             \}}
             \ControlFlowTok{if}\NormalTok{ (sig }\SpecialCharTok{==} \DecValTok{2}\NormalTok{) \{}
               \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{grepl}\NormalTok{(}\StringTok{"\^{}\#\textquotesingle{} @"}\NormalTok{, text[i])) \{}
\NormalTok{                 sig }\OtherTok{\textless{}{-}} \DecValTok{1}
\NormalTok{               \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{                 if\_exam[i] }\OtherTok{\textless{}{-}}\NormalTok{ T}
\NormalTok{               \}}
\NormalTok{             \}}
\NormalTok{           \}}
\NormalTok{           text[}\SpecialCharTok{!}\NormalTok{if\_exam]}
\NormalTok{         \})}

\FunctionTok{lapply}\NormalTok{(target, writeLines)}

\NormalTok{path }\OtherTok{\textless{}{-}} \StringTok{"\textasciitilde{}/code\_backup/mcnebula2"}
\FunctionTok{dir.create}\NormalTok{(path, }\AttributeTok{recursive =}\NormalTok{ T)}

\FunctionTok{lapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(target),}
       \ControlFlowTok{function}\NormalTok{(name)\{}
         \FunctionTok{writeLines}\NormalTok{(target[[name]], }\FunctionTok{paste0}\NormalTok{(path, }\StringTok{"/"}\NormalTok{, name))}
\NormalTok{       \})}

\FunctionTok{system}\NormalTok{(}\StringTok{"cp \textasciitilde{}/code\_backup/mcnebula2/* {-}t \textasciitilde{}/MCnebula2/R"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-eucommia_workflow.r}{%
\section{File: eucommia\_workflow.R}\label{file-eucommia_workflow.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# workflow to process data and output report (Eucomma)}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\# workflow(mode = "print")}

\NormalTok{s0}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_section}\NormalTok{(}\StringTok{"Abstract"}\NormalTok{, }\DecValTok{1}\NormalTok{, reportDoc}\SpecialCharTok{$}\NormalTok{abstract, }\ConstantTok{NULL}\NormalTok{)}

\NormalTok{s0}\FloatTok{.2} \OtherTok{\textless{}{-}} \FunctionTok{new\_section}\NormalTok{(}\StringTok{"Introduction"}\NormalTok{, }\DecValTok{1}\NormalTok{,}
  \FunctionTok{c}\NormalTok{(reportDoc}\SpecialCharTok{$}\NormalTok{introduction, }\StringTok{""}\NormalTok{,}
    \StringTok{"*Eucommia ulmoides Oliv.* (*E.  ulmoides*), as a traditional"}\NormalTok{,}
    \StringTok{"Chinese medicine (TCM), after being processed with saline water, was"}\NormalTok{,}
    \StringTok{"applied to the treatment of renal diseases for a long time in China."}\NormalTok{,}
    \StringTok{"Due to its complex composition, discovering chemical"}\NormalTok{,}
    \StringTok{"changes during processing (such as processed with saline water) is challenging."}\NormalTok{,}
    \StringTok{"We would next demonstrate the addressing of this challenge with MCnebula, which"}\NormalTok{,}
    \StringTok{"may be enlightening for the study of phytopharmaceuticals."}\NormalTok{), }\ConstantTok{NULL}\NormalTok{)}

\NormalTok{s0}\FloatTok{.3} \OtherTok{\textless{}{-}} \FunctionTok{new\_section}\NormalTok{(}\StringTok{"Set{-}up"}\NormalTok{, }\DecValTok{1}\NormalTok{, reportDoc}\SpecialCharTok{$}\NormalTok{setup,}
  \FunctionTok{rblock}\NormalTok{(\{}
    \FunctionTok{library}\NormalTok{(MCnebula2)}
    \FunctionTok{library}\NormalTok{(exMCnebula2)}
\NormalTok{  \}, F)}
\NormalTok{)}

\NormalTok{s0}\FloatTok{.9} \OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Integrate data and Create Nebulae"}\NormalTok{, }\DecValTok{1}\NormalTok{)}

\NormalTok{s1 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Initialize analysis"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s1}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Set SIRIUS project path and its version to initialize mcnebula object."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{mcnebula}\NormalTok{()}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{initialize\_mcnebula}\NormalTok{(mcn, }\StringTok{"sirius.v4"}\NormalTok{, }\StringTok{"."}\NormalTok{)}
    \FunctionTok{ion\_mode}\NormalTok{(mcn) }\OtherTok{\textless{}{-}} \StringTok{"neg"}
\NormalTok{  \}, }\AttributeTok{eval =}\NormalTok{ F)}
\NormalTok{)}

\NormalTok{s1}\FloatTok{.5} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Create a temporary folder to store the output data."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    tmp }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"/temp\_data"}\NormalTok{)}
    \FunctionTok{dir.create}\NormalTok{(tmp, F)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s1}\FloatTok{.6} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"In order to demonstrate the process of analyzing data with MCnebula2,"}\NormalTok{,}
    \StringTok{"we provide a \textquotesingle{}mcnebula\textquotesingle{} object that was extracted in advance using the"}\NormalTok{,}
    \StringTok{"\textasciigrave{}collate\_used\textasciigrave{} function, which means that all the data"}\NormalTok{,}
    \StringTok{"used in the subsequent analysis has already stored in this \textquotesingle{}mcnebula\textquotesingle{}"}\NormalTok{,}
    \StringTok{"object, without the need to obtain it from the original Project"}\NormalTok{,}
    \StringTok{"directory. This avoids the hassle of downloading and storing a dozen"}\NormalTok{,}
    \StringTok{"GB of raw files. The following, we"}\NormalTok{,}
    \StringTok{"use the collated dataset containing 1612 features"}\NormalTok{,}
    \StringTok{"with chemical formula identification."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    exfiles }\OtherTok{\textless{}{-}} \FunctionTok{system.file}\NormalTok{(}\StringTok{"extdata"}\NormalTok{, }\AttributeTok{package =} \StringTok{"exMCnebula2"}\NormalTok{)}
\NormalTok{  \}))}

\NormalTok{s1}\FloatTok{.7} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Load the \textquotesingle{}.rdata\textquotesingle{} file."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
    \FunctionTok{load}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(exfiles, }\StringTok{"/mcn\_herbal1612.rdata"}\NormalTok{))}
\NormalTok{    mcn }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_herbal1612}
    \FunctionTok{rm}\NormalTok{(mcn\_herbal1612)}
    \FunctionTok{export\_path}\NormalTok{(mcn) }\OtherTok{\textless{}{-}}\NormalTok{ tmp}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s2 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Filter candidates"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s2}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
\NormalTok{  reportDoc}\SpecialCharTok{$}\NormalTok{filter,}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(mcn)}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(mcn)}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(mcn, }\AttributeTok{by\_reference =}\NormalTok{ T)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s3 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Filter chemical classes"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s3}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
\NormalTok{  reportDoc}\SpecialCharTok{$}\NormalTok{stardust,}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{create\_stardust\_classes}\NormalTok{(mcn)}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{create\_features\_annotation}\NormalTok{(mcn)}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{cross\_filter\_stardust}\NormalTok{(mcn, }\AttributeTok{max\_ratio =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{cutoff =}\NormalTok{ .}\DecValTok{4}\NormalTok{, }\AttributeTok{identical\_factor =}\NormalTok{ .}\DecValTok{6}\NormalTok{)}
\NormalTok{    classes }\OtherTok{\textless{}{-}} \FunctionTok{unique}\NormalTok{(}\FunctionTok{stardust\_classes}\NormalTok{(mcn)}\SpecialCharTok{$}\NormalTok{class.name)}
\NormalTok{    table.filtered.classes }\OtherTok{\textless{}{-}} \FunctionTok{backtrack\_stardust}\NormalTok{(mcn)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s3}\FloatTok{.5} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Manually filter some repetitive classes or sub{-}structural classes."}\NormalTok{,}
    \StringTok{"By means of Regex matching, we obtained a number of recurring"}\NormalTok{,}
    \StringTok{"name of chemical classes that would contain manay identical compounds"}\NormalTok{,}
    \StringTok{"as their sub{-}structure."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    classes}
\NormalTok{    pattern }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"fatty acid"}\NormalTok{, }\StringTok{"hydroxy"}\NormalTok{)}
\NormalTok{    dis }\OtherTok{\textless{}{-}} \FunctionTok{unlist}\NormalTok{(}\FunctionTok{lapply}\NormalTok{(pattern, grep, }\AttributeTok{x =}\NormalTok{ classes, }\AttributeTok{ignore.case =}\NormalTok{ T))}
\NormalTok{    dis }\OtherTok{\textless{}{-}}\NormalTok{ classes[dis]}
\NormalTok{    dis}
\NormalTok{  \}, }\AttributeTok{args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{eval =}\NormalTok{ T))}
\NormalTok{)}

\NormalTok{s3}\FloatTok{.6} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Remove these classes."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{backtrack\_stardust}\NormalTok{(mcn, dis, }\AttributeTok{remove =}\NormalTok{ T)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s4 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Create Nebulae"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s4}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Create Nebula{-}Index data. This data created based on \textquotesingle{}stardust\_classes\textquotesingle{} data."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{create\_nebula\_index}\NormalTok{(mcn)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s4}\FloatTok{.5} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
\NormalTok{  reportDoc}\SpecialCharTok{$}\NormalTok{nebulae,}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{compute\_spectral\_similarity}\NormalTok{(mcn)}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{create\_parent\_nebula}\NormalTok{(mcn)}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_nebulae}\NormalTok{(mcn)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s5 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Visualize Nebulae"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s5}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Create layouts for Parent{-}Nebula or Child{-}Nebulae visualizations."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{create\_parent\_layout}\NormalTok{(mcn)}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_layouts}\NormalTok{(mcn)}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{activate\_nebulae}\NormalTok{(mcn)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s5}\FloatTok{.3} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"The available chemical classes for visualization and its"}\NormalTok{,}
    \StringTok{"sequence in storage."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    table.nebulae }\OtherTok{\textless{}{-}} \FunctionTok{visualize}\NormalTok{(mcn)}
\NormalTok{    table.nebulae}
\NormalTok{  \}, }\AttributeTok{args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{eval =}\NormalTok{ T))}
\NormalTok{)}

\NormalTok{s5}\FloatTok{.6} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Draw and save as .png or .pdf image files."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    p }\OtherTok{\textless{}{-}} \FunctionTok{visualize}\NormalTok{(mcn, }\StringTok{"parent"}\NormalTok{)}
    \FunctionTok{ggsave}\NormalTok{(f5}\FloatTok{.61} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/parent\_nebula.png"}\NormalTok{), p)}
    \FunctionTok{pdf}\NormalTok{(f5}\FloatTok{.62} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/child\_nebula.pdf"}\NormalTok{), }\DecValTok{12}\NormalTok{, }\DecValTok{14}\NormalTok{)}
    \FunctionTok{visualize\_all}\NormalTok{(mcn)}
    \FunctionTok{dev.off}\NormalTok{()}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s5.}\FloatTok{6.}\NormalTok{fig1 }\OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(f5}\FloatTok{.61}\NormalTok{, }\StringTok{"parent"}\NormalTok{, }\StringTok{"Parent{-}Nebula"}\NormalTok{)}
\NormalTok{s5.}\FloatTok{6.}\NormalTok{fig2 }\OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(f5}\FloatTok{.62}\NormalTok{, }\StringTok{"child"}\NormalTok{, }\StringTok{"Child{-}Nebulae"}\NormalTok{)}

\NormalTok{ref }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
  \FunctionTok{paste0}\NormalTok{(}\StringTok{"(Fig. "}\NormalTok{, }\FunctionTok{get\_ref}\NormalTok{(x), }\StringTok{")"}\NormalTok{)}
\NormalTok{\}}

\NormalTok{s5}\FloatTok{.8} \OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \StringTok{"In general, Parent{-}Nebulae"}\NormalTok{, }\FunctionTok{ref}\NormalTok{(s5.}\FloatTok{6.}\NormalTok{fig1),}
  \StringTok{"is too informative to show, so Child{-}Nebulae"}\NormalTok{, }\FunctionTok{ref}\NormalTok{(s5.}\FloatTok{6.}\NormalTok{fig2),}
  \StringTok{"was used to dipict the abundant classes of features (metabolites)"}\NormalTok{,}
  \StringTok{"in a grid panel, intuitively. In a bird\textquotesingle{}s eye view of"}\NormalTok{,}
  \StringTok{"Child{-}Nebulae, we can obtain many characteristics of features,"}\NormalTok{,}
  \StringTok{"involving classes distribution, structure identified accuracy, as"}\NormalTok{,}
  \StringTok{"well as spectral similarity within classes."}
\NormalTok{)}

\NormalTok{s6 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Nebulae for Downstream analysis"}\NormalTok{, }\DecValTok{1}\NormalTok{)}

\DocumentationTok{\#\# Statistic analysis}
\NormalTok{s7 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Statistic analysis"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s7}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Next we perform a statistical analysis with quantification data of the"}\NormalTok{,}
    \StringTok{"features. Note that the SIRIUS project does not contain quantification"}\NormalTok{,}
    \StringTok{"data of features, so our object \textasciigrave{}mcn\textasciigrave{} naturally does not contain"}\NormalTok{,}
    \StringTok{"that either. We need to get it from elsewhere."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    utils}\SpecialCharTok{::}\FunctionTok{untar}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(exfiles, }\StringTok{"/herbal.tar.gz"}\NormalTok{), }\AttributeTok{exdir =}\NormalTok{ tmp)}
\NormalTok{    origin }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{fread}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/features.csv"}\NormalTok{))}
\NormalTok{    origin }\OtherTok{\textless{}{-}}\NormalTok{ tibble}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(origin)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s7}\FloatTok{.2} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Now, let\textquotesingle{}s check the columns in the table."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    origin}
\NormalTok{  \}, }\AttributeTok{args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{eval =}\NormalTok{ T))}
\NormalTok{)}

\NormalTok{s7}\FloatTok{.3} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Remove the rest of the columns and keep only the columns for ID,"}\NormalTok{,}
    \StringTok{"m/z, retention time, and quantification."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    quant }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(}
\NormalTok{      origin, }\AttributeTok{id =} \DecValTok{1}\NormalTok{, dplyr}\SpecialCharTok{::}\FunctionTok{contains}\NormalTok{(}\StringTok{"Peak area"}\NormalTok{)}
\NormalTok{    )}
    \FunctionTok{colnames}\NormalTok{(quant) }\OtherTok{\textless{}{-}} \FunctionTok{gsub}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.mzML Peak area"}\NormalTok{, }\StringTok{""}\NormalTok{, }\FunctionTok{colnames}\NormalTok{(quant))}
\NormalTok{    quant }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(quant, }\AttributeTok{.features\_id =} \FunctionTok{as.character}\NormalTok{(id))}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s7}\FloatTok{.6} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Create the metadata table and store it in the \textasciigrave{}mcn\textasciigrave{} object"}\NormalTok{,}
    \StringTok{"along with the quantification data."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    gp }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\AttributeTok{Blank =} \StringTok{"EU{-}BlANK"}\NormalTok{, }\AttributeTok{Raw =} \StringTok{"EU{-}Raw"}\NormalTok{, }\AttributeTok{Pro =} \StringTok{"EU{-}Pro"}\NormalTok{)}
\NormalTok{    metadata }\OtherTok{\textless{}{-}}\NormalTok{ MCnebula2}\SpecialCharTok{:::}\FunctionTok{group\_strings}\NormalTok{(}\FunctionTok{colnames}\NormalTok{(quant), gp, }\StringTok{"sample"}\NormalTok{)}
\NormalTok{    metadata}\SpecialCharTok{$}\NormalTok{annotation }\OtherTok{\textless{}{-}}
      \FunctionTok{vapply}\NormalTok{(metadata}\SpecialCharTok{$}\NormalTok{group, }\ControlFlowTok{switch}\NormalTok{, }\AttributeTok{FUN.VALUE =} \FunctionTok{character}\NormalTok{(}\DecValTok{1}\NormalTok{),}
        \AttributeTok{Blank =} \StringTok{"methanol/water (1:1, v/v)"}\NormalTok{,}
        \AttributeTok{Raw =} \StringTok{"Raw bark of Eucommia ulmoides Oliv."}\NormalTok{,}
        \AttributeTok{Pro =} \StringTok{"Precessed (with saline water) bark of Eucommia ulmoides Oliv."}
\NormalTok{      )}
    \FunctionTok{features\_quantification}\NormalTok{(mcn) }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(quant, }\SpecialCharTok{{-}}\NormalTok{id)}
    \FunctionTok{sample\_metadata}\NormalTok{(mcn) }\OtherTok{\textless{}{-}}\NormalTok{ metadata}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s7}\FloatTok{.7} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(reportDoc}\SpecialCharTok{$}\NormalTok{statistic, }\StringTok{""}\NormalTok{, }\StringTok{"In the following we use the"}\NormalTok{,}
    \StringTok{"\textasciigrave{}binary\_comparison\textasciigrave{} function for variance analysis."}\NormalTok{,}
    \StringTok{"To accommodate the downstream analysis of gene"}\NormalTok{,}
    \StringTok{"expression that the \textasciigrave{}limma\textasciigrave{} package was originally used for, we"}\NormalTok{,}
    \StringTok{"should log2{-}transform and centralize this data"}\NormalTok{,}
    \StringTok{"(use the default parameter \textquotesingle{}fun\_norm\textquotesingle{} of \textasciigrave{}binary\_comparison()\textasciigrave{})."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{binary\_comparison}\NormalTok{(mcn, Pro }\SpecialCharTok{{-}}\NormalTok{ Raw)}
\NormalTok{    top.list }\OtherTok{\textless{}{-}} \FunctionTok{top\_table}\NormalTok{(}\FunctionTok{statistic\_set}\NormalTok{(mcn))}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s7}\FloatTok{.8} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Check the results."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    top.list[[}\DecValTok{1}\NormalTok{]]}
\NormalTok{  \}, }\AttributeTok{args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{eval =}\NormalTok{ T, }\AttributeTok{echo =}\NormalTok{ T))}
\NormalTok{)}

\DocumentationTok{\#\# Set tracer in Child{-}Nebulae}
\NormalTok{s8 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Set tracer in Child{-}Nebulae"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s8}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
\NormalTok{  reportDoc}\SpecialCharTok{$}\NormalTok{tracer,}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    n }\OtherTok{\textless{}{-}} \DecValTok{20}
\NormalTok{    tops }\OtherTok{\textless{}{-}} \FunctionTok{select\_features}\NormalTok{(}
\NormalTok{      mcn, }\AttributeTok{tani.score\_cutoff =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{order\_by\_coef =} \DecValTok{1}\NormalTok{, }\AttributeTok{togather =}\NormalTok{ T}
\NormalTok{    )}
\NormalTok{    top20 }\OtherTok{\textless{}{-}}\NormalTok{ tops[}\DecValTok{1}\SpecialCharTok{:}\NormalTok{n]}
    \FunctionTok{palette\_set}\NormalTok{(}\FunctionTok{melody}\NormalTok{(mcn)) }\OtherTok{\textless{}{-}} \FunctionTok{colorRampPalette}\NormalTok{(}\FunctionTok{palette\_set}\NormalTok{(mcn))(n)}
\NormalTok{    mcn2 }\OtherTok{\textless{}{-}} \FunctionTok{set\_tracer}\NormalTok{(mcn, top20)}
\NormalTok{    mcn2 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_nebulae}\NormalTok{(mcn2)}
\NormalTok{    mcn2 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_layouts}\NormalTok{(mcn2)}
\NormalTok{    mcn2 }\OtherTok{\textless{}{-}} \FunctionTok{activate\_nebulae}\NormalTok{(mcn2)}
\NormalTok{    mcn2 }\OtherTok{\textless{}{-}} \FunctionTok{set\_nodes\_color}\NormalTok{(mcn2, }\AttributeTok{use\_tracer =}\NormalTok{ T)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s8}\FloatTok{.2} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Draw and save the image."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
    \FunctionTok{pdf}\NormalTok{(f8}\FloatTok{.2} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/tracer\_child\_nebula.pdf"}\NormalTok{), }\DecValTok{12}\NormalTok{, }\DecValTok{14}\NormalTok{)}
    \FunctionTok{visualize\_all}\NormalTok{(mcn2)}
    \FunctionTok{dev.off}\NormalTok{()}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s8.}\FloatTok{2.}\NormalTok{fig1 }\OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(f8}\FloatTok{.2}\NormalTok{, }\StringTok{"tracer"}\NormalTok{, }\StringTok{"Tracing top features in Child{-}Nebulae"}\NormalTok{)}

\NormalTok{s8}\FloatTok{.3} \OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"A part of the top features are marked with colored nodes in"}\NormalTok{,}
          \StringTok{"Child{-}Nebulae"}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(}\FunctionTok{ref}\NormalTok{(s8.}\FloatTok{2.}\NormalTok{fig1), }\StringTok{"."}\NormalTok{))}

\DocumentationTok{\#\# Quantification in Child{-}Nebulae}
\NormalTok{s9 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Quantification in Child{-}Nebulae"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s9}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Show Fold Change (Pro versus Raw) in Child{-}Nebulae."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
    \FunctionTok{palette\_gradient}\NormalTok{(}\FunctionTok{melody}\NormalTok{(mcn2)) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"blue"}\NormalTok{, }\StringTok{"grey90"}\NormalTok{, }\StringTok{"red"}\NormalTok{)}
\NormalTok{    mcn2 }\OtherTok{\textless{}{-}} \FunctionTok{set\_nodes\_color}\NormalTok{(mcn2, }\StringTok{"logFC"}\NormalTok{, top.list[[}\DecValTok{1}\NormalTok{]])}
    \FunctionTok{pdf}\NormalTok{(f9}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/logFC\_child\_nebula.pdf"}\NormalTok{), }\DecValTok{12}\NormalTok{, }\DecValTok{14}\NormalTok{)}
    \FunctionTok{visualize\_all}\NormalTok{(mcn2, }\AttributeTok{fun\_modify =}\NormalTok{ modify\_stat\_child)}
    \FunctionTok{dev.off}\NormalTok{()}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s9.}\FloatTok{1.}\NormalTok{fig1 }\OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(f9}\FloatTok{.1}\NormalTok{, }\StringTok{"logFC"}\NormalTok{, }\StringTok{"Show log2(FC) in Child{-}Nebulae"}\NormalTok{)}

\NormalTok{s9}\FloatTok{.2} \OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Each Child{-}Nebula separately shows the overall content variation of"}\NormalTok{,}
          \StringTok{"the chemical class to which it belongs"}\NormalTok{, }\FunctionTok{ref}\NormalTok{(s9.}\FloatTok{1.}\NormalTok{fig1), }\StringTok{"."}\NormalTok{)}

\DocumentationTok{\#\# Annotate Nebulae}
\NormalTok{s10 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Annotate Nebulae"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s10}\FloatTok{.0} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Now, the available Nebulae contains:"}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    table.nebulae2 }\OtherTok{\textless{}{-}} \FunctionTok{visualize}\NormalTok{(mcn2)}
    \FunctionTok{print}\NormalTok{(table.nebulae2, }\AttributeTok{n =} \ConstantTok{Inf}\NormalTok{)}
\NormalTok{  \}, }\AttributeTok{args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{eval =}\NormalTok{ T))}
\NormalTok{)}

\NormalTok{s10}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Next, let us focus on \textquotesingle{}Lignans, neolignans and related compounds\textquotesingle{} and"}\NormalTok{,}
    \StringTok{"\textquotesingle{}Iridoids and derivatives\textquotesingle{}. They were representative chemical classes in"}\NormalTok{,}
    \StringTok{"E. ulmoides."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    mcn2 }\OtherTok{\textless{}{-}} \FunctionTok{set\_nodes\_color}\NormalTok{(mcn2, }\AttributeTok{use\_tracer =}\NormalTok{ T)}
    \FunctionTok{palette\_stat}\NormalTok{(}\FunctionTok{melody}\NormalTok{(mcn2)) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
      \AttributeTok{Pro =} \StringTok{"\#EBA9A7"}\NormalTok{, }\AttributeTok{Raw =} \StringTok{"\#ACDFEE"}\NormalTok{, }\AttributeTok{Blank =} \StringTok{"grey80"}
\NormalTok{    )}
\NormalTok{    lig }\OtherTok{\textless{}{-}} \StringTok{"Lignans, neolignans and related compounds"}
\NormalTok{    iri }\OtherTok{\textless{}{-}} \StringTok{"Iridoids and derivatives"}
\NormalTok{    mcn2 }\OtherTok{\textless{}{-}} \FunctionTok{annotate\_nebula}\NormalTok{(mcn2, lig)}
\NormalTok{    mcn2 }\OtherTok{\textless{}{-}} \FunctionTok{annotate\_nebula}\NormalTok{(mcn2, iri)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s10}\FloatTok{.2} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Draw and save the image."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    p }\OtherTok{\textless{}{-}} \FunctionTok{visualize}\NormalTok{(mcn2, lig, }\AttributeTok{annotate =}\NormalTok{ T)}
    \FunctionTok{ggsave}\NormalTok{(f10.}\FloatTok{2.1} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/lig\_child.pdf"}\NormalTok{), p, }\AttributeTok{width =} \DecValTok{6}\NormalTok{, }\AttributeTok{height =} \DecValTok{4}\NormalTok{)}
\NormalTok{    p }\OtherTok{\textless{}{-}} \FunctionTok{visualize}\NormalTok{(mcn2, iri, }\AttributeTok{annotate =}\NormalTok{ T)}
    \FunctionTok{ggsave}\NormalTok{(f10.}\FloatTok{2.2} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/iri\_child.pdf"}\NormalTok{), p, }\AttributeTok{width =} \DecValTok{6}\NormalTok{, }\AttributeTok{height =} \DecValTok{4}\NormalTok{)}
\NormalTok{  \})}
\NormalTok{)}

\CommentTok{\# pngGrob \textless{}{-} zoom\_pdf(f10.2.2, dpi = 1000, position = c(.3, .5))}
\CommentTok{\# grid.draw(pngGrob)}

\NormalTok{s10.}\FloatTok{2.}\NormalTok{fig1 }\OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(f10.}\FloatTok{2.1}\NormalTok{, }\StringTok{"lig"}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(}\StringTok{"Annotated Nebulae: "}\NormalTok{, lig))}
\NormalTok{s10.}\FloatTok{2.}\NormalTok{fig2 }\OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(f10.}\FloatTok{2.2}\NormalTok{, }\StringTok{"iri"}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(}\StringTok{"Annotated Nebulae: "}\NormalTok{, iri))}

\NormalTok{s10}\FloatTok{.3} \OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \StringTok{"See results (Fig."}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(}\FunctionTok{get\_ref}\NormalTok{(s10.}\FloatTok{2.}\NormalTok{fig1), }\StringTok{" and "}\NormalTok{, }\FunctionTok{get\_ref}\NormalTok{(s10.}\FloatTok{2.}\NormalTok{fig2)),}
  \StringTok{")."}\NormalTok{, }\StringTok{""}\NormalTok{, reportDoc}\SpecialCharTok{$}\NormalTok{annotate}
\NormalTok{)}

\NormalTok{s10}\FloatTok{.4} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Use the \textasciigrave{}show\_node\textasciigrave{} function to get the annotation details"}\NormalTok{,}
    \StringTok{"for a feature. For example:"}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    ef }\OtherTok{\textless{}{-}} \StringTok{"1642"}
    \FunctionTok{pdf}\NormalTok{(f10}\FloatTok{.4} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/features\_"}\NormalTok{, ef, }\StringTok{".pdf"}\NormalTok{), }\DecValTok{11}\NormalTok{, }\DecValTok{4}\NormalTok{)}
    \FunctionTok{show\_node}\NormalTok{(mcn2, ef)}
    \FunctionTok{dev.off}\NormalTok{()}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s10.}\FloatTok{4.}\NormalTok{fig1 }\OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(f10}\FloatTok{.4}\NormalTok{, }\StringTok{"ef"}\NormalTok{, }\StringTok{"The annotated feature of ID: 1642"}\NormalTok{)}

\NormalTok{s10}\FloatTok{.5} \OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \StringTok{"See results"}\NormalTok{, }\FunctionTok{ref}\NormalTok{(s10.}\FloatTok{4.}\NormalTok{fig1),}
  \FunctionTok{paste0}\NormalTok{(}\StringTok{"(feature in "}\NormalTok{, }\FunctionTok{get\_ref}\NormalTok{(s10.}\FloatTok{2.}\NormalTok{fig2), }\StringTok{")"}\NormalTok{), }\StringTok{"."}
\NormalTok{)}

\DocumentationTok{\#\# Output identification table}
\NormalTok{s11 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Query compounds"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s11}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"The \textasciigrave{}features\_annotation(mcn)\textasciigrave{} contains the main annotation information of all"}\NormalTok{,}
           \StringTok{"the features, i.e., the identity of the  compound. Next, we would"}\NormalTok{,}
           \StringTok{"query the identified compounds based on the \textquotesingle{}inchikey2d\textquotesingle{} column therein."}\NormalTok{,}
           \StringTok{"Note that the stereoisomerism of the compounds is difficult to be"}\NormalTok{,}
           \StringTok{"determined due to the limitations of MS/MS spectra."}\NormalTok{,}
           \StringTok{"Therefore, we used InChIKey 2D (representing the molecular"}\NormalTok{,}
           \StringTok{"backbone of the compound) to query"}\NormalTok{,}
           \StringTok{"the compound instead of InChI."}\NormalTok{)}

\NormalTok{s11}\FloatTok{.2} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"First we need to format and organize the annotated data of"}\NormalTok{,}
    \StringTok{"features to get the non{-}duplicated \textquotesingle{}inchikey2d\textquotesingle{}."}\NormalTok{,}
    \StringTok{"We provide a function with a pre{-}defined filtering algorithm to quickly"}\NormalTok{,}
    \StringTok{"organize the table."}\NormalTok{,}
    \StringTok{"By default, this function filters the data based on"}\NormalTok{,}
    \StringTok{"\textquotesingle{}tani.score\textquotesingle{} (Tanimoto similarity),"}\NormalTok{,}
    \StringTok{"and then sorts and de{-}duplicates it."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    feas }\OtherTok{\textless{}{-}} \FunctionTok{features\_annotation}\NormalTok{(mcn2)}
\NormalTok{    feas }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(feas, top.list[[}\DecValTok{1}\NormalTok{]], }\AttributeTok{by =} \StringTok{".features\_id"}\NormalTok{, }\AttributeTok{all.x =}\NormalTok{ T)}
\NormalTok{    feas }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(feas, }\AttributeTok{arrange.rank =}\NormalTok{ adj.P.Val)}
\NormalTok{    feas }\OtherTok{\textless{}{-}} \FunctionTok{format\_table}\NormalTok{(feas, }\AttributeTok{export\_name =} \ConstantTok{NULL}\NormalTok{)}
\NormalTok{    key2d }\OtherTok{\textless{}{-}}\NormalTok{ feas}\SpecialCharTok{$}\NormalTok{inchikey2d}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s11}\FloatTok{.3} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Create a folder to store the acquired data."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    tmp2 }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/query"}\NormalTok{)}
    \FunctionTok{dir.create}\NormalTok{(tmp2, F)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s11}\FloatTok{.4} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Query the compound\textquotesingle{}s InChIKey, chemical class, IUPUA name."}\NormalTok{,}
    \StringTok{"If your system is not Linux, the multithreading below may pose some problems,"}\NormalTok{,}
    \StringTok{"please remove the parameters \textasciigrave{}curl\_cl = 4\textasciigrave{} and \textasciigrave{}classyfire\_cl = 4\textasciigrave{}."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    key.rdata }\OtherTok{\textless{}{-}} \FunctionTok{query\_inchikey}\NormalTok{(key2d, tmp2, }\AttributeTok{curl\_cl =} \DecValTok{4}\NormalTok{)}
\NormalTok{    class.rdata }\OtherTok{\textless{}{-}} \FunctionTok{query\_classification}\NormalTok{(key2d, tmp2, }\AttributeTok{classyfire\_cl =} \DecValTok{4}\NormalTok{)}
\NormalTok{    iupac.rdata }\OtherTok{\textless{}{-}} \FunctionTok{query\_iupac}\NormalTok{(key2d, tmp2, }\AttributeTok{curl\_cl =} \DecValTok{4}\NormalTok{)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s11}\FloatTok{.5} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"We will also query for synonyms of compounds, but this is done in"}\NormalTok{,}
    \StringTok{"\textquotesingle{}CID\textquotesingle{} (PubChem\textquotesingle{}s ID), so some transformation is required."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    key.set }\OtherTok{\textless{}{-}} \FunctionTok{extract\_rdata\_list}\NormalTok{(key.rdata)}
\NormalTok{    cid }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(key.set, }\ControlFlowTok{function}\NormalTok{(data) data}\SpecialCharTok{$}\NormalTok{CID)}
\NormalTok{    cid }\OtherTok{\textless{}{-}} \FunctionTok{unlist}\NormalTok{(cid, }\AttributeTok{use.names =}\NormalTok{ F)}
\NormalTok{    syno.rdata }\OtherTok{\textless{}{-}} \FunctionTok{query\_synonyms}\NormalTok{(cid, tmp2, }\AttributeTok{curl\_cl =} \DecValTok{4}\NormalTok{)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s11}\FloatTok{.6} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Screen for unique synonyms and chemical classes for all compounds."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    syno }\OtherTok{\textless{}{-}} \FunctionTok{pick\_synonym}\NormalTok{(key2d, key.rdata, syno.rdata, iupac.rdata)}
\NormalTok{    feas}\SpecialCharTok{$}\NormalTok{synonym }\OtherTok{\textless{}{-}}\NormalTok{ syno}
\NormalTok{    class }\OtherTok{\textless{}{-}} \FunctionTok{pick\_class}\NormalTok{(key2d, class.rdata)}
\NormalTok{    feas}\SpecialCharTok{$}\NormalTok{class }\OtherTok{\textless{}{-}}\NormalTok{ class}
\NormalTok{    feas.table }\OtherTok{\textless{}{-}} \FunctionTok{rename\_table}\NormalTok{(feas)}
    \FunctionTok{write\_tsv}\NormalTok{(feas.table, }\FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/compounds\_format.tsv"}\NormalTok{))}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s11}\FloatTok{.7} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"The formatted table as following:"}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    feas.table}
\NormalTok{  \}, }\AttributeTok{args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{eval =}\NormalTok{ T))}
\NormalTok{)}

\DocumentationTok{\#\# Plot spectra of top \textquotesingle{}features\textquotesingle{}}
\NormalTok{s12 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Plot spectra of top \textquotesingle{}features\textquotesingle{}"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s12}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Drawing of MS/MS spectra of top \textquotesingle{}features\textquotesingle{}."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    mcn2 }\OtherTok{\textless{}{-}} \FunctionTok{draw\_structures}\NormalTok{(mcn2, }\AttributeTok{.features\_id =}\NormalTok{ top20)}
    \FunctionTok{pdf}\NormalTok{(f12}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/msms\_tops\_identified.pdf"}\NormalTok{), }\DecValTok{12}\NormalTok{, }\DecValTok{10}\NormalTok{)}
    \FunctionTok{plot\_msms\_mirrors}\NormalTok{(mcn2, top20)}
    \FunctionTok{dev.off}\NormalTok{()}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s12}\FloatTok{.2} \OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(f12}\FloatTok{.1}\NormalTok{, }\StringTok{"msmsTops"}\NormalTok{, }\StringTok{"MS/MS spectra of top features (identified)"}\NormalTok{)}

\NormalTok{s12}\FloatTok{.3} \OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"See results"}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(}\FunctionTok{ref}\NormalTok{(s12}\FloatTok{.2}\NormalTok{), }\StringTok{"."}\NormalTok{))}

\NormalTok{s12}\FloatTok{.5} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Plot EIC spectra of top \textquotesingle{}features\textquotesingle{}."}\NormalTok{,}
    \StringTok{"(Since the code below requires .mzML mass spectrometry data, these files are too"}\NormalTok{,}
    \StringTok{"large to be stored in a package, so the code below will not be run. But we have"}\NormalTok{,}
    \StringTok{"saved the result data.)"}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    metadata}\SpecialCharTok{$}\NormalTok{file }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(metadata}\SpecialCharTok{$}\NormalTok{sample, }\StringTok{".mzML"}\NormalTok{)}
\NormalTok{    data }\OtherTok{\textless{}{-}} \FunctionTok{plot\_EIC\_stack}\NormalTok{(top20, metadata,}
      \AttributeTok{quant.path =} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/features.csv"}\NormalTok{),}
      \AttributeTok{mzml.path =} \StringTok{"/media/echo/back/thermo\_mzML\_0518/"}\NormalTok{,}
      \AttributeTok{palette =} \FunctionTok{palette\_stat}\NormalTok{(mcn2)}
\NormalTok{    )}
    \FunctionTok{save}\NormalTok{(data, }\AttributeTok{file =} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/eic\_data.rdata"}\NormalTok{))}
\NormalTok{  \}, F)}
\NormalTok{)}

\NormalTok{s12}\FloatTok{.6} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Load the saved data and draw the figure."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
    \FunctionTok{load}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/eic\_data.rdata"}\NormalTok{))}
    \FunctionTok{pdf}\NormalTok{(f12}\FloatTok{.6} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/eic\_tops\_identified.pdf"}\NormalTok{), }\DecValTok{12}\NormalTok{, }\DecValTok{10}\NormalTok{)}
    \FunctionTok{print}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{p)}
    \FunctionTok{dev.off}\NormalTok{()}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s12}\FloatTok{.7} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Or use following to re{-}plot the \textquotesingle{}ggplot\textquotesingle{} object."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    data }\OtherTok{\textless{}{-}} \FunctionTok{plot\_EIC\_stack}\NormalTok{(}\AttributeTok{data =}\NormalTok{ data, }\AttributeTok{palette =} \FunctionTok{palette\_stat}\NormalTok{(mcn2))}
\NormalTok{  \}, F, }\AttributeTok{args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{eval =}\NormalTok{ F))}
\NormalTok{)}

\NormalTok{s12}\FloatTok{.8} \OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(f12}\FloatTok{.6}\NormalTok{, }\StringTok{"eic"}\NormalTok{,}
  \StringTok{"Extracted Ions Chromatograph (EIC) of top features (identified)"}\NormalTok{)}

\NormalTok{s12}\FloatTok{.9} \OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"See results"}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(}\FunctionTok{ref}\NormalTok{(s12}\FloatTok{.8}\NormalTok{), }\StringTok{"."}\NormalTok{),}
  \StringTok{"It can be assumed that 1642, 1785, and 2321 are newly generated compounds after"}\NormalTok{,}
  \StringTok{"the processing. According to Fig. }\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{\ref{fig:tracer}, they were belong to chemical"}\NormalTok{,}
  \StringTok{"classes of \textquotesingle{}Iridoids and derivatives\textquotesingle{}, \textquotesingle{}Dialkyl ethers\textquotesingle{} and"}\NormalTok{,}
  \StringTok{"\textquotesingle{}Phenylpropanoids and polyketides\textquotesingle{}."}
\NormalTok{)}

\NormalTok{s13 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Discover more around top \textquotesingle{}features\textquotesingle{} in Child{-}Nebulae"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s13}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Plot the Child{-}Nebulae of the two chemical classes that we have not annotated"}\NormalTok{,}
    \StringTok{"yet."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    dia }\OtherTok{\textless{}{-}} \StringTok{"Dialkyl ethers"}
\NormalTok{    phe }\OtherTok{\textless{}{-}} \StringTok{"Phenylpropanoids and polyketides"}
\NormalTok{    mcn2 }\OtherTok{\textless{}{-}} \FunctionTok{annotate\_nebula}\NormalTok{(mcn2, dia)}
\NormalTok{    mcn2 }\OtherTok{\textless{}{-}} \FunctionTok{annotate\_nebula}\NormalTok{(mcn2, phe)}
\NormalTok{    p }\OtherTok{\textless{}{-}} \FunctionTok{visualize}\NormalTok{(mcn2, dia, }\AttributeTok{annotate =}\NormalTok{ T)}
    \DocumentationTok{\#\# c(.3, .4)}
    \FunctionTok{ggsave}\NormalTok{(f13.}\FloatTok{1.1} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/dia\_child.pdf"}\NormalTok{), p, }\AttributeTok{width =} \DecValTok{6}\NormalTok{, }\AttributeTok{height =} \DecValTok{4}\NormalTok{)}
\NormalTok{    p }\OtherTok{\textless{}{-}} \FunctionTok{visualize}\NormalTok{(mcn2, phe, }\AttributeTok{annotate =}\NormalTok{ T)}
    \DocumentationTok{\#\# c(.5, .8)}
    \FunctionTok{ggsave}\NormalTok{(f13.}\FloatTok{1.2} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/phe\_child.pdf"}\NormalTok{), p, }\AttributeTok{width =} \DecValTok{6}\NormalTok{, }\AttributeTok{height =} \DecValTok{4}\NormalTok{)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s13}\FloatTok{.2} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Draw their partial views and put them together."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    grob\_iri }\OtherTok{\textless{}{-}} \FunctionTok{zoom\_pdf}\NormalTok{(f10.}\FloatTok{2.2}\NormalTok{, }\FunctionTok{c}\NormalTok{(.}\DecValTok{28}\NormalTok{, .}\DecValTok{515}\NormalTok{), }\FunctionTok{c}\NormalTok{(.}\DecValTok{1}\NormalTok{, .}\DecValTok{1}\NormalTok{), }\AttributeTok{dpi =} \DecValTok{3000}\NormalTok{)}
\NormalTok{    grob\_dia }\OtherTok{\textless{}{-}} \FunctionTok{zoom\_pdf}\NormalTok{(f13.}\FloatTok{1.1}\NormalTok{, }\FunctionTok{c}\NormalTok{(.}\DecValTok{25}\NormalTok{, .}\DecValTok{3}\NormalTok{), }\FunctionTok{c}\NormalTok{(.}\DecValTok{1}\NormalTok{, .}\DecValTok{1}\NormalTok{), }\AttributeTok{dpi =} \DecValTok{3000}\NormalTok{)}
\NormalTok{    grob\_phe }\OtherTok{\textless{}{-}} \FunctionTok{zoom\_pdf}\NormalTok{(f13.}\FloatTok{1.2}\NormalTok{, }\FunctionTok{c}\NormalTok{(.}\DecValTok{465}\NormalTok{, .}\DecValTok{825}\NormalTok{), }\FunctionTok{c}\NormalTok{(.}\DecValTok{06}\NormalTok{, .}\DecValTok{06}\NormalTok{), }\AttributeTok{dpi =} \DecValTok{3000}\NormalTok{)}
\NormalTok{    local\_1642 }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{grecta}\NormalTok{(}\StringTok{"a"}\NormalTok{), grob\_iri)}
\NormalTok{    local\_1785 }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{grecta}\NormalTok{(}\StringTok{"b"}\NormalTok{), grob\_dia)}
\NormalTok{    local\_2321 }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{grecta}\NormalTok{(}\StringTok{"c"}\NormalTok{), grob\_phe)}
\NormalTok{    locals }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{local\_1642 =} \DecValTok{1}\NormalTok{, }\AttributeTok{local\_1785 =} \DecValTok{1}\NormalTok{, }\AttributeTok{local\_2321 =} \DecValTok{1}\NormalTok{),}
      \FunctionTok{namel}\NormalTok{(local\_1642, local\_1785, local\_2321))}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s13}\FloatTok{.3} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"We found interesting adjacent compounds (ID:2110 and ID:854) in \textasciigrave{}local\_1642\textasciigrave{},"}\NormalTok{,}
    \StringTok{"which has a similar chemical structure to \textquotesingle{}feature\textquotesingle{} 1642."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    grob\_struc2110 }\OtherTok{\textless{}{-}} \FunctionTok{grid.grabExpr}\NormalTok{(}\FunctionTok{show\_structure}\NormalTok{(mcn2, }\StringTok{"2110"}\NormalTok{))}
\NormalTok{    grob\_struc2110 }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{grecta}\NormalTok{(}\StringTok{"d"}\NormalTok{), grob\_struc2110)}
\NormalTok{    grob\_struc854 }\OtherTok{\textless{}{-}} \FunctionTok{grid.grabExpr}\NormalTok{(}\FunctionTok{show\_structure}\NormalTok{(mcn2, }\StringTok{"854"}\NormalTok{))}
\NormalTok{    grob\_struc854 }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{grecta}\NormalTok{(}\StringTok{"e"}\NormalTok{), grob\_struc854)}
\NormalTok{    grob\_msms2110 }\OtherTok{\textless{}{-}} \FunctionTok{grid.grabExpr}\NormalTok{(}\FunctionTok{plot\_msms\_mirrors}\NormalTok{(mcn2, }\FunctionTok{c}\NormalTok{(}\StringTok{"2110"}\NormalTok{, }\StringTok{"854"}\NormalTok{), }\AttributeTok{structure\_vp =} \ConstantTok{NULL}\NormalTok{))}
\NormalTok{    grob\_msms2110 }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{grecta}\NormalTok{(}\StringTok{"f"}\NormalTok{), grob\_msms2110)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s13}\FloatTok{.4} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Again, we don\textquotesingle{}t run the following code, but we save the results."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    data }\OtherTok{\textless{}{-}} \FunctionTok{plot\_EIC\_stack}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"2110"}\NormalTok{, }\StringTok{"854"}\NormalTok{), metadata,}
      \AttributeTok{quant.path =} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/features.csv"}\NormalTok{),}
      \AttributeTok{mzml.path =} \StringTok{"/media/echo/back/thermo\_mzML\_0518/"}\NormalTok{,}
      \AttributeTok{palette =} \FunctionTok{palette\_stat}\NormalTok{(mcn2)}
\NormalTok{    )}
    \FunctionTok{save}\NormalTok{(data, }\AttributeTok{file =} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/eic\_data2110.rdata"}\NormalTok{))}
\NormalTok{  \}, F)}
\NormalTok{)}

\NormalTok{s13}\FloatTok{.5} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Load the data and convert picture."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
    \FunctionTok{load}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/eic\_data2110.rdata"}\NormalTok{))}
\NormalTok{    grob\_eic2110 }\OtherTok{\textless{}{-}} \FunctionTok{as\_grob}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{p)}
\NormalTok{    grob\_eic2110 }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{grecta}\NormalTok{(}\StringTok{"g"}\NormalTok{), grob\_eic2110)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s13}\FloatTok{.6} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Draw the final figure."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    frame }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{grob\_struc2110 =} \DecValTok{1}\NormalTok{, }\AttributeTok{grob\_struc854 =} \DecValTok{1}\NormalTok{),}
      \FunctionTok{namel}\NormalTok{(grob\_struc2110, grob\_struc854))}
\NormalTok{    frame }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{frame =} \DecValTok{1}\NormalTok{, }\AttributeTok{grob\_msms2110 =} \DecValTok{1}\NormalTok{, }\AttributeTok{grob\_eic2110 =} \DecValTok{1}\NormalTok{),}
      \FunctionTok{namel}\NormalTok{(frame, grob\_msms2110, grob\_eic2110))}
\NormalTok{    frame }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{locals =} \DecValTok{1}\NormalTok{, }\AttributeTok{frame =} \FloatTok{1.5}\NormalTok{),}
      \FunctionTok{namel}\NormalTok{(locals, frame))}
\NormalTok{    frame }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(frame, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{95}\NormalTok{, .}\DecValTok{95}\NormalTok{))}
    \FunctionTok{pdf}\NormalTok{(f13}\FloatTok{.6} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/complex.pdf"}\NormalTok{), }\DecValTok{14}\NormalTok{, }\DecValTok{10}\NormalTok{)}
    \FunctionTok{draw}\NormalTok{(frame)}
    \FunctionTok{dev.off}\NormalTok{()}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s13}\FloatTok{.7} \OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(f13}\FloatTok{.6}\NormalTok{, }\StringTok{"complex"}\NormalTok{,}
  \StringTok{"Discover chemical changes using MCnebula"}\NormalTok{)}

\NormalTok{s13}\FloatTok{.8} \OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"It can be speculated that the changes in the levels of ID 1642 and ID 845 were"}\NormalTok{,}
  \StringTok{"caused by structural changes of ID 2110 during the processing, which may have"}\NormalTok{,}
  \StringTok{"involved reactions such as dehydration and rearrangement (Fig. }\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{\ref{fig:complex})."}\NormalTok{)}

\NormalTok{s100 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Session infomation"}\NormalTok{, }\DecValTok{1}\NormalTok{)}

\NormalTok{s100}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{rblock}\NormalTok{(\{}
  \FunctionTok{sessionInfo}\NormalTok{()}
\NormalTok{\}, }\AttributeTok{args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{eval =}\NormalTok{ T))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# gather}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\NormalTok{sections }\OtherTok{\textless{}{-}} \FunctionTok{gather\_sections}\NormalTok{()}
\NormalTok{report }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(new\_report, sections)}
\FunctionTok{yaml}\NormalTok{(report)[}\DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"title: Analysis on *E. ulmoides* dataset"}\NormalTok{)}
\FunctionTok{render\_report}\NormalTok{(report, file }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/report.Rmd"}\NormalTok{))}
\NormalTok{rmarkdown}\SpecialCharTok{::}\FunctionTok{render}\NormalTok{(file)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# as biocStyle}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\# library(MCnebula2)}

\CommentTok{\# write\_biocStyle(report, file2 \textless{}{-} paste0(tmp, "/report\_biocStyle\_nofloat.Rmd"),}
\CommentTok{\#   title \textless{}{-} paste0(yaml(report)[1], "\textbackslash{}nauthor: \textquotesingle{}LiChuang Huang\textquotesingle{}")}
\CommentTok{\# )}

\CommentTok{\# rmarkdown::render(file2)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# draw extra...}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\# p \textless{}{-} visualize(mcn, "parent")}

\NormalTok{pgg }\OtherTok{\textless{}{-}} \FunctionTok{modify\_set\_labs}\NormalTok{(mcn}\SpecialCharTok{@}\NormalTok{parent\_nebula}\SpecialCharTok{@}\NormalTok{ggset, mcn)}
\NormalTok{pgg }\OtherTok{\textless{}{-}} \FunctionTok{mutate\_layer}\NormalTok{(pgg, }\DecValTok{3}\NormalTok{, }\AttributeTok{stroke =} \DecValTok{0}\NormalTok{, }\AttributeTok{color =} \StringTok{"transparent"}\NormalTok{)}
\CommentTok{\# ggsave("herbal\_parent.pdf", call\_command(pgg), width = 7, height = 7)}

\NormalTok{mcn}\SpecialCharTok{@}\NormalTok{child\_nebulae}\SpecialCharTok{@}\NormalTok{ggset }\SpecialCharTok{\%\textless{}\textgreater{}\%}
  \FunctionTok{lapply}\NormalTok{(}\ControlFlowTok{function}\NormalTok{(ggset) \{}
    \FunctionTok{mutate\_layer}\NormalTok{(ggset, }\DecValTok{3}\NormalTok{, }\AttributeTok{stroke =} \DecValTok{0}\NormalTok{, }\AttributeTok{color =} \StringTok{"transparent"}\NormalTok{)}
\NormalTok{\})}

\NormalTok{pc }\OtherTok{\textless{}{-}} \FunctionTok{nebulae\_as\_grob}\NormalTok{(mcn)}
\NormalTok{frame }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{p =} \FloatTok{1.2}\NormalTok{, }\AttributeTok{pc =} \DecValTok{1}\NormalTok{), }\FunctionTok{namel}\NormalTok{(}\AttributeTok{p =} \FunctionTok{as\_grob}\NormalTok{(}\FunctionTok{call\_command}\NormalTok{(pgg)), pc))}
\CommentTok{\# dev.new(width = 23, height = 14)}

\FunctionTok{pdf}\NormalTok{(}\StringTok{"parent\_and\_child.pdf"}\NormalTok{, }\DecValTok{23} \SpecialCharTok{*}\NormalTok{ .}\DecValTok{8}\NormalTok{, }\DecValTok{14} \SpecialCharTok{*}\NormalTok{ .}\DecValTok{8}\NormalTok{)}
\FunctionTok{draw}\NormalTok{(frame)}
\FunctionTok{dev.off}\NormalTok{()}

\CommentTok{\# 2110 {-}\textgreater{} 854}
\CommentTok{\# 2110 {-}\textgreater{} 1642}

\CommentTok{\# library(MCnebula2)}

\CommentTok{\# grob\_struc2110 \textless{}{-} grid.grabExpr(show\_structure(mcn2, "2110"))}
\CommentTok{\# grob\_struc1642 \textless{}{-} grid.grabExpr(show\_structure(mcn2, "1642"))}
\CommentTok{\# grob\_struc854 \textless{}{-} grid.grabExpr(show\_structure(mcn2, "854"))}
\CommentTok{\# lst \textless{}{-} namel(grob\_struc2110, grob\_struc1642, grob\_struc854)}
\CommentTok{\# setwd(tmp)}

\CommentTok{\# ids \textless{}{-} c("2110", "1642", "854")}
\CommentTok{\# data \textless{}{-} dplyr::filter(feas, .features\_id \%in\% ids)}
\CommentTok{\# data.table::fwrite(data, "compounds\_1642s.csv")}
\CommentTok{\# for (i in names(lst)) \{}
\CommentTok{\#   pdf(paste0(i, ".pdf"))}
\CommentTok{\#   draw(lst[[ i ]])}
\CommentTok{\#   dev.off()}
\CommentTok{\# \}}

\CommentTok{\# pdf("compounds\_1642\_surounds.pdf", 8, 6)}
\CommentTok{\# draw(grob\_iri)}
\CommentTok{\# dev.off()}

\CommentTok{\# mcn2 \textless{}{-} activate\_nebulae(mcn2)}
\CommentTok{\# p \textless{}{-} visualize(mcn2, "Iridoids and derivatives",}
\CommentTok{\#   function(ggset, x = mcn2) \{}
\CommentTok{\#     modify\_default\_child(modify\_tracer\_node(ggset), x)}
\CommentTok{\#   \})}
\CommentTok{\# ggsave("iri.pdf", p, width = 4, height = 4)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-evaluation_workflow.r}{%
\section{File: evaluation\_workflow.R}\label{file-evaluation_workflow.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# script for evaluation}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\NormalTok{s0}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Introduction"}\NormalTok{, }\DecValTok{1}\NormalTok{)}

\NormalTok{s0}\FloatTok{.2} \OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \StringTok{"This document provides the code to evaluate MCnebula2. Most of the data used"}\NormalTok{,}
  \StringTok{"in this is already included in the package \textquotesingle{}exMCnebula2\textquotesingle{}. By downloading and"}\NormalTok{,}
  \StringTok{"installing the \textquotesingle{}exMCnebula2\textquotesingle{} package, the following code can be run without"}\NormalTok{,}
  \StringTok{"trouble. The code in this document can be divided into two parts:"}\NormalTok{,}
  \StringTok{""}\NormalTok{,}
  \StringTok{"{-} The first part is the code used to generate the predicate dataset (for"}\NormalTok{,}
  \StringTok{"evaluation), which is time consuming to run, but we have already run it in"}\NormalTok{,}
  \StringTok{"advance and included the outcome data in the package \textquotesingle{}exMCnebula2\textquotesingle{}, so users"}\NormalTok{,}
  \StringTok{"do not need to rerun them, unless they are tested for feasibility."}\NormalTok{,}
  \StringTok{""}\NormalTok{,}
  \StringTok{"{-} The second part of the code is the code for evaluating the results, including"}\NormalTok{,}
  \StringTok{"the data processing and data visualization modules, which is lightweight and"}\NormalTok{,}
  \StringTok{"can be run quickly to get the results."}
\NormalTok{)}

\NormalTok{s0}\FloatTok{.3} \OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Set{-}up"}\NormalTok{, }\DecValTok{1}\NormalTok{)}

\NormalTok{s0}\FloatTok{.4} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Load the R package used for analysis.  In the following analysis process, to"}\NormalTok{,}
    \StringTok{"illustrate the source of the function, we use the symbol \textasciigrave{}::\textasciigrave{} to mark the"}\NormalTok{,}
    \StringTok{"functions, e.g., \textasciigrave{}dplyr::filter\textasciigrave{}.  The functions that were not marked may"}\NormalTok{,}
    \StringTok{"source from MCnebula2 or the packages that R (version 4.2) loaded by default."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
    \FunctionTok{library}\NormalTok{(MCnebula2)}
    \FunctionTok{library}\NormalTok{(exMCnebula2)}
\NormalTok{  \}, F)}
\NormalTok{)}

\NormalTok{s0}\FloatTok{.5} \OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Initialisation"}\NormalTok{, }\DecValTok{1}\NormalTok{)}

\NormalTok{s0}\FloatTok{.9} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Create a temporary folder to store the output data."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    tmp }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"/temp\_data"}\NormalTok{)}
    \FunctionTok{dir.create}\NormalTok{(tmp, F)}
\NormalTok{    exfiles }\OtherTok{\textless{}{-}} \FunctionTok{system.file}\NormalTok{(}\StringTok{"extdata"}\NormalTok{, }\AttributeTok{package =} \StringTok{"exMCnebula2"}\NormalTok{)}
\NormalTok{    utils}\SpecialCharTok{::}\FunctionTok{untar}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(exfiles, }\StringTok{"/evaluation.tar.gz"}\NormalTok{), }\AttributeTok{exdir =}\NormalTok{ tmp)}
    \FunctionTok{source}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/evaluation.R"}\NormalTok{))}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s1 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Use simulated dataset"}\NormalTok{, }\DecValTok{1}\NormalTok{)}

\NormalTok{s1}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Convert .msp as .mgf"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s1}\FloatTok{.2} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"We downloaded a collated spectral data (.msp file) originating from GNPS from a"}\NormalTok{,}
    \StringTok{"third{-}party website."}\NormalTok{, }\StringTok{"(\textless{}http://prime.psc.riken.jp/compms/msdial/main.html\#MSP\textgreater{})"}\NormalTok{,}
    \StringTok{"The .msp was converted as .mgf file and, at the same time, the simulated"}\NormalTok{,}
    \StringTok{"isotope peaks were added to MS1. Then the .mgf file could be used for"}\NormalTok{,}
    \StringTok{"SIRIUS computation. The following would not be evaluated, as the converted"}\NormalTok{,}
    \StringTok{".mgf file has been included in .tar file."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{requireNamespace}\NormalTok{(}\StringTok{"rcdk"}\NormalTok{, }\AttributeTok{quietly =}\NormalTok{ T))}
      \FunctionTok{install.packages}\NormalTok{(}\StringTok{"rcdk"}\NormalTok{)}
    \FunctionTok{msp\_to\_mgf}\NormalTok{(}
      \AttributeTok{name =} \StringTok{"origin\_gnps\_pos.msp"}\NormalTok{,}
      \AttributeTok{id\_prefix =} \StringTok{"gnps"}\NormalTok{,}
      \AttributeTok{path =}\NormalTok{ tmp,}
      \AttributeTok{mass\_level =} \StringTok{"all"}\NormalTok{,}
      \AttributeTok{fun =} \StringTok{"deal\_with\_msp\_record"}\NormalTok{)}
\NormalTok{  \}, F)}
\NormalTok{)}

\NormalTok{s1}\FloatTok{.3} \OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Query classification for compounds"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s1}\FloatTok{.4} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"In order for this data to be used for evaluation, we need to first obtain the"}\NormalTok{,}
    \StringTok{"classes of these compounds. (The results has been included in .tar files."}\NormalTok{,}
    \StringTok{"So the following need not to be run again, as its time{-}consuming.)."}\NormalTok{,}
    \StringTok{"(Please note that the following cl (\textasciigrave{}curl\_cl\textasciigrave{}, \textasciigrave{}classyfire\_cl\textasciigrave{}) sets the number of threads,"}\NormalTok{,}
    \StringTok{"if it is not a Unix like system, there may be an error, please set this parameter to"}\NormalTok{,}
    \StringTok{"\textasciigrave{}NULL\textasciigrave{}, or refer to \textless{}https://github.com/psolymos/pbapply\textgreater{}.)"}\NormalTok{,}
\NormalTok{    ),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    mgf\_metadata }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{fread}\NormalTok{(}
      \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/"}\NormalTok{, }\StringTok{"origin\_gnps\_pos.meta.tsv"}\NormalTok{)}
\NormalTok{    )}
    \CommentTok{\# mgf\_metadata \textless{}{-} data.table::fread(}
    \CommentTok{\# paste0("/media/echo/back/test\_mcnebula/mgf/used", "/", "origin\_gnps\_pos.meta.tsv")}
    \CommentTok{\# )}
    \FunctionTok{dir.create}\NormalTok{(tmp1 }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/query"}\NormalTok{))}
\NormalTok{    key2d }\OtherTok{\textless{}{-}} \FunctionTok{unique}\NormalTok{(stringr}\SpecialCharTok{::}\FunctionTok{str\_extract}\NormalTok{(mgf\_metadata}\SpecialCharTok{$}\NormalTok{INCHIKEY, }\StringTok{"\^{}[A{-}Z]*"}\NormalTok{))}
\NormalTok{    key.rdata }\OtherTok{\textless{}{-}} \FunctionTok{query\_inchikey}\NormalTok{(key2d, tmp1, }\AttributeTok{curl\_cl =} \DecValTok{10}\NormalTok{)}
\NormalTok{    class.rdata }\OtherTok{\textless{}{-}} \FunctionTok{query\_classification}\NormalTok{(key2d, tmp1, }\AttributeTok{classyfire\_cl =} \DecValTok{20}\NormalTok{)}
\NormalTok{  \}, F)}
\NormalTok{)}

\NormalTok{s1}\FloatTok{.5} \OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Add noise peak"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s1}\FloatTok{.6} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"The \textquotesingle{}noise\textquotesingle{} include mass shift, peak intensity shift, and external"}\NormalTok{,}
    \StringTok{"noise peaks for original spectra. (refer to \textless{}https://doi.org/10.1038/s41587{-}021{-}01045{-}9\textgreater{})."}\NormalTok{,}
    \StringTok{"First, we collected a subset of the noise peaks used to insert the spectra:"}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
    \FunctionTok{load}\NormalTok{(files[}\DecValTok{1}\NormalTok{])}
\NormalTok{    non\_noise }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(}
      \FunctionTok{latest}\NormalTok{(mcn, }\StringTok{"project\_dataset"}\NormalTok{, }\StringTok{".f3\_spectra"}\NormalTok{),}
\NormalTok{      .features\_id, mz, rel.int.}
\NormalTok{    )}
\NormalTok{    non\_noise }\OtherTok{\textless{}{-}} \FunctionTok{split}\NormalTok{(non\_noise, }\SpecialCharTok{\textasciitilde{}}\NormalTok{ .features\_id)}
\NormalTok{    non\_noise }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(non\_noise, dplyr}\SpecialCharTok{::}\NormalTok{select, }\SpecialCharTok{{-}}\NormalTok{.features\_id)}
    \FunctionTok{rm}\NormalTok{(mcn)}
\NormalTok{    origin\_lst }\OtherTok{\textless{}{-}} \FunctionTok{filter\_mgf}\NormalTok{(}\ConstantTok{NULL}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/origin\_gnps\_pos.mgf"}\NormalTok{))}
    \CommentTok{\# origin\_lst \textless{}{-} filter\_mgf(NULL, "/media/echo/back/test\_mcnebula/mgf/used/origin\_gnps\_pos.mgf")}
\NormalTok{    noise\_pool }\OtherTok{\textless{}{-}} \FunctionTok{collate\_as\_noise\_pool}\NormalTok{(origin\_lst, non\_noise)}
\NormalTok{  \}, F)}
\NormalTok{)}

\NormalTok{s1}\FloatTok{.7} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Two noise models were simulated:"}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    medium\_noise\_lst }\OtherTok{\textless{}{-}} \FunctionTok{spectrum\_add\_noise}\NormalTok{(}
\NormalTok{      origin\_lst,}
      \AttributeTok{int.sigma =} \DecValTok{1}\NormalTok{,}
      \AttributeTok{global.sigma =} \DecValTok{10}\SpecialCharTok{/}\DecValTok{3} \SpecialCharTok{*} \FloatTok{1e{-}6}\NormalTok{,}
      \AttributeTok{indivi.sigma =} \DecValTok{10}\SpecialCharTok{/}\DecValTok{3} \SpecialCharTok{*} \FloatTok{1e{-}6}\NormalTok{,}
      \AttributeTok{sub.factor =} \FloatTok{0.03}\NormalTok{,}
      \AttributeTok{alpha =} \FloatTok{0.2}\NormalTok{,}
      \AttributeTok{.noise\_pool =}\NormalTok{ noise\_pool}
\NormalTok{    )}
\NormalTok{    high\_noise\_lst }\OtherTok{\textless{}{-}} \FunctionTok{spectrum\_add\_noise}\NormalTok{(}
\NormalTok{      origin\_lst,}
      \AttributeTok{int.sigma =} \DecValTok{2}\SpecialCharTok{\^{}}\NormalTok{(}\DecValTok{1}\SpecialCharTok{/}\DecValTok{2}\NormalTok{),}
      \AttributeTok{global.sigma =} \DecValTok{15}\SpecialCharTok{/}\DecValTok{3} \SpecialCharTok{*} \FloatTok{1e{-}6}\NormalTok{,}
      \AttributeTok{indivi.sigma =} \DecValTok{15}\SpecialCharTok{/}\DecValTok{3} \SpecialCharTok{*} \FloatTok{1e{-}6}\NormalTok{,}
      \AttributeTok{sub.factor =} \FloatTok{0.03}\NormalTok{,}
      \AttributeTok{alpha =} \FloatTok{0.4}\NormalTok{,}
      \AttributeTok{.noise\_pool =}\NormalTok{ noise\_pool}
\NormalTok{    )}
\NormalTok{  \}, F)}
\NormalTok{)}

\NormalTok{s1}\FloatTok{.8} \OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Output .mgf for SIRIUS"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s1}\FloatTok{.85} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Export the above three list data to the .mgf format required by SIRIUS."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    lst }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}
      \AttributeTok{origin =}\NormalTok{ origin\_lst,}
      \AttributeTok{medium\_noise =}\NormalTok{ medium\_noise\_lst, }
      \AttributeTok{high\_noise =}\NormalTok{ high\_noise\_lst}
\NormalTok{    )}
    \FunctionTok{dir.create}\NormalTok{(tmp2 }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/simutate"}\NormalTok{))}
    \FunctionTok{lapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(lst),}
      \ControlFlowTok{function}\NormalTok{(name) \{}
\NormalTok{        data }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(lst[[ name ]])}
        \FunctionTok{write.table}\NormalTok{(}
\NormalTok{          data, }\FunctionTok{paste0}\NormalTok{(tmp2, }\StringTok{"/"}\NormalTok{, name, }\StringTok{"\_gnps\_pos.sirius.mgf"}\NormalTok{),}
          \AttributeTok{quote =}\NormalTok{ F, }\AttributeTok{col.names =}\NormalTok{ F, }\AttributeTok{row.names =}\NormalTok{ F}
\NormalTok{        )}
\NormalTok{      \})}
\NormalTok{  \}, F)}
\NormalTok{)}

\NormalTok{s1}\FloatTok{.9} \OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Output .mgf for GNPS"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s1}\FloatTok{.95} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Export the above three list data to the .mgf format required by GNPS (FBMN)."}\NormalTok{,}
    \StringTok{"(\textless{}https://doi.org/10.1038/s41592{-}020{-}0933{-}6\textgreater{})."}\NormalTok{,}
    \StringTok{"FBMN worklow required two types of data for upload, .mgf file and"}\NormalTok{,}
    \StringTok{".csv (quantification table)"}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    quant\_table }\OtherTok{\textless{}{-}} \FunctionTok{simulate\_gnps\_quant}\NormalTok{(}
\NormalTok{      mgf\_metadata, tmp2, }\AttributeTok{return\_df =}\NormalTok{ T}
\NormalTok{    )}
    \FunctionTok{lapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(lst), }
      \ControlFlowTok{function}\NormalTok{(name) \{}
\NormalTok{        lst }\OtherTok{\textless{}{-}} \FunctionTok{discard\_level1}\NormalTok{(lst[[ name ]])}
\NormalTok{        lst }\OtherTok{\textless{}{-}}\NormalTok{ pbapply}\SpecialCharTok{::}\FunctionTok{pblapply}\NormalTok{(lst, mgf\_add\_anno.gnps)}
\NormalTok{        data }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(lst)}
\NormalTok{        data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(}
\NormalTok{          data, }\AttributeTok{V1 =} \FunctionTok{gsub}\NormalTok{(}\StringTok{"RTINSECONDS="}\NormalTok{, }\StringTok{"RTINSECONDS=1000"}\NormalTok{, V1),}
          \AttributeTok{V1 =} \FunctionTok{gsub}\NormalTok{(}\StringTok{"CHARGE=+1"}\NormalTok{, }\StringTok{"CHARGE=1+"}\NormalTok{, V1),}
          \AttributeTok{V1 =} \FunctionTok{gsub}\NormalTok{(}\StringTok{"FEATURE\_ID=gnps"}\NormalTok{, }\StringTok{"FEATURE\_ID="}\NormalTok{, V1)}
\NormalTok{        )}
        \FunctionTok{write.table}\NormalTok{(}
\NormalTok{          data, }\FunctionTok{paste0}\NormalTok{(tmp2, }\StringTok{"/"}\NormalTok{, name, }\StringTok{"\_gnps\_pos.gnps.mgf"}\NormalTok{),}
          \AttributeTok{quote =}\NormalTok{ F, }\AttributeTok{col.names =}\NormalTok{ F, }\AttributeTok{row.names =}\NormalTok{ F}
\NormalTok{        )}
\NormalTok{        quant }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(}
\NormalTok{          quant\_table, }\StringTok{\textasciigrave{}}\AttributeTok{row m/z}\StringTok{\textasciigrave{}} \SpecialCharTok{\textless{}=} \DecValTok{800}\NormalTok{, }\StringTok{\textasciigrave{}}\AttributeTok{row ID}\StringTok{\textasciigrave{}} \SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(lst)}
\NormalTok{        )}
\NormalTok{        quant}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{row ID}\StringTok{\textasciigrave{}} \OtherTok{\textless{}{-}}\NormalTok{ stringr}\SpecialCharTok{::}\FunctionTok{str\_extract}\NormalTok{(quant}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{row ID}\StringTok{\textasciigrave{}}\NormalTok{, }\StringTok{"[0{-}9]\{1,\}$"}\NormalTok{)}
        \FunctionTok{write.table}\NormalTok{(}
\NormalTok{          quant, }\FunctionTok{paste0}\NormalTok{(tmp2, }\StringTok{"/"}\NormalTok{, name, }\StringTok{"\_gnps\_pos.gnps.meta.csv"}\NormalTok{),}
          \AttributeTok{sep =} \StringTok{","}\NormalTok{, }\AttributeTok{row.names =}\NormalTok{ F, }\AttributeTok{col.names =}\NormalTok{ T, }\AttributeTok{quote =}\NormalTok{ F)}
\NormalTok{      \})}
\NormalTok{  \}, F)}
\NormalTok{)}

\NormalTok{s2 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Evaluate MCnebula2"}\NormalTok{, }\DecValTok{1}\NormalTok{)}

\NormalTok{s2}\FloatTok{.05} \OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Use pre{-}computed data"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s2}\FloatTok{.05} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Extract the required data from the pre{-}computed SIRIUS projects, using the"}\NormalTok{,}
    \StringTok{"following code:"}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    dirs }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"origin"}\NormalTok{, }\StringTok{"medium\_noise"}\NormalTok{, }\StringTok{"high\_noise"}\NormalTok{)}
\NormalTok{    lst }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(dirs,}
      \ControlFlowTok{function}\NormalTok{(dir)\{}
\NormalTok{        mcn }\OtherTok{\textless{}{-}} \FunctionTok{collated\_used}\NormalTok{()}
\NormalTok{        mcn }\OtherTok{\textless{}{-}} \FunctionTok{mcnebula}\NormalTok{()}
\NormalTok{        mcn }\OtherTok{\textless{}{-}} \FunctionTok{initialize\_mcnebula}\NormalTok{(mcn, }\StringTok{"sirius.v4"}\NormalTok{, dir)}
\NormalTok{        mcn }\OtherTok{\textless{}{-}} \FunctionTok{collate\_used}\NormalTok{(mcn)}
\NormalTok{      \})}
\NormalTok{  \}, F)}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Integrate data"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s2}\FloatTok{.11} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Integrate data to classifiy the \textquotesingle{}features\textquotesingle{} via MCnebula2."}\NormalTok{,}
    \StringTok{"(The following .rdata files were not provided in packages of \textquotesingle{}exMCnebula2\textquotesingle{}."}\NormalTok{,}
    \StringTok{"But you can downloaded them via URL such as:"}\NormalTok{,}
    \StringTok{"\textless{}https://raw.githubusercontent.com/Cao{-}lab{-}zcmu/utils\_tool/master/inst/extdata/evaluationLarge/origin\_gnps\_pos.rdata\textgreater{})"}
\NormalTok{    ),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    files }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}
      \FunctionTok{system.file}\NormalTok{(}\StringTok{"extdata/evaluationLarge"}\NormalTok{, }\AttributeTok{package =} \StringTok{"utils.tool"}\NormalTok{), }\StringTok{"/"}\NormalTok{,}
      \FunctionTok{c}\NormalTok{(}\StringTok{"origin\_gnps\_pos.rdata"}\NormalTok{, }\StringTok{"medium\_noise\_gnps\_pos.rdata"}\NormalTok{, }\StringTok{"high\_noise\_gnps\_pos.rdata"}\NormalTok{)}
\NormalTok{    )}
\NormalTok{    lst }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(files,}
      \ControlFlowTok{function}\NormalTok{(file) \{}
        \FunctionTok{load}\NormalTok{(file)}
\NormalTok{        mcn }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(mcn)}
\NormalTok{        mcn }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(mcn)}
\NormalTok{        mcn }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(mcn, }\AttributeTok{by\_reference =}\NormalTok{ T)}
\NormalTok{        mcn }\OtherTok{\textless{}{-}} \FunctionTok{create\_stardust\_classes}\NormalTok{(mcn)}
\NormalTok{        mcn }\OtherTok{\textless{}{-}} \FunctionTok{create\_features\_annotation}\NormalTok{(mcn)}
\NormalTok{        mcn }\OtherTok{\textless{}{-}} \FunctionTok{cross\_filter\_stardust}\NormalTok{(}
\NormalTok{          mcn, }\AttributeTok{min\_number =} \DecValTok{50}\NormalTok{, }\AttributeTok{max\_ratio =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{cutoff =}\NormalTok{ .}\DecValTok{4}\NormalTok{, }\AttributeTok{identical\_factor =}\NormalTok{ .}\DecValTok{6}
\NormalTok{        )}
\NormalTok{        mcn }\OtherTok{\textless{}{-}} \FunctionTok{create\_nebula\_index}\NormalTok{(mcn, }\AttributeTok{force =}\NormalTok{ T)}
        \ControlFlowTok{if}\NormalTok{ (file }\SpecialCharTok{==}\NormalTok{ files[}\DecValTok{1}\NormalTok{]) \{}
\NormalTok{          mcn }\OtherTok{\textless{}{-}} \FunctionTok{create\_hierarchy}\NormalTok{(mcn)}
\NormalTok{          mcnHier. }\OtherTok{\textless{}{-}} \FunctionTok{mcnebula}\NormalTok{()}
          \FunctionTok{reference}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(mcnHier.))}\SpecialCharTok{$}\NormalTok{hierarchy }\OtherTok{\textless{}{-}} \FunctionTok{hierarchy}\NormalTok{(mcn)}
          \FunctionTok{save}\NormalTok{(mcnHier., }\AttributeTok{file =} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{system.file}\NormalTok{(}\StringTok{"extdata/evaluation"}\NormalTok{,}
                \AttributeTok{package =} \StringTok{"utils.tool"}\NormalTok{), }\StringTok{"/mcnHier.rdata"}\NormalTok{))}
\NormalTok{        \}}
        \FunctionTok{list}\NormalTok{(}\AttributeTok{features\_annotation =} \FunctionTok{features\_annotation}\NormalTok{(mcn),}
          \AttributeTok{nebula\_index =} \FunctionTok{nebula\_index}\NormalTok{(mcn))}
\NormalTok{      \})}
    \FunctionTok{names}\NormalTok{(lst) }\OtherTok{\textless{}{-}}\NormalTok{ dirs}
    \FunctionTok{save}\NormalTok{(lst, }\AttributeTok{file =} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{system.file}\NormalTok{(}\StringTok{"extdata/evaluation"}\NormalTok{,}
          \AttributeTok{package =} \StringTok{"utils.tool"}\NormalTok{),}
        \StringTok{"/integrated.rdata"}\NormalTok{))}
\NormalTok{  \}, F)}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.2} \OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Use pre{-}integrate data"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s2}\FloatTok{.21} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Load the integrated data in the \textquotesingle{}exMCnebula2\textquotesingle{} package. This data contains"}\NormalTok{,}
    \StringTok{"the results of the three levels, as well as the corresponding classified"}\NormalTok{,}
    \StringTok{"results and identification results."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
    \FunctionTok{load}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/integrated.rdata"}\NormalTok{))}
    \CommentTok{\# load(paste0(exfiles, "/evaluation/integrated.rdata"))}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.3} \OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Download results of finished jobs from GNPS service"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s2}\FloatTok{.31} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"In order to compare MCnebula2 with MolNetEnhancer in GNPS, we have"}\NormalTok{,}
    \StringTok{"pre{-}uploaded and completed jobs of FBMN and MolNetEnhancer."}\NormalTok{,}
    \StringTok{"The URL of finished jobs in GNPS service were as following."}\NormalTok{,}
    \StringTok{"(MolNetEnhancer: \textless{}https://doi.org/10.1101/654459\textgreater{})"}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    fbmn\_lst }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}
      \AttributeTok{origin =}
        \StringTok{"https://gnps.ucsd.edu/proteosafe/status.jsp?task=05f492249df5413ba72a1def76ca973d"}\NormalTok{,}
      \AttributeTok{medium\_noise =} 
        \StringTok{"https://gnps.ucsd.edu/proteosafe/status.jsp?task=c65abe76cd9846c99f1ae47ddbd34927"}\NormalTok{,}
      \AttributeTok{high\_noise =}
        \StringTok{"https://gnps.ucsd.edu/proteosafe/status.jsp?task=62b25cf2dcf041d3a8b5593fdbf5ac5e"}
\NormalTok{    )}
\NormalTok{    molnet\_lst }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}
      \AttributeTok{origin =}
        \StringTok{"https://gnps.ucsd.edu/ProteoSAFe/status.jsp?task=9d9c7f83fa2046c2bf615a3dbe35ca62"}\NormalTok{,}
      \AttributeTok{medium\_noise =} 
        \StringTok{"https://gnps.ucsd.edu/ProteoSAFe/status.jsp?task=7cc8b5a2476f4d4e90256ec0a0f94ca7"}\NormalTok{,}
      \AttributeTok{high\_noise =}
        \StringTok{"https://gnps.ucsd.edu/ProteoSAFe/status.jsp?task=f6d08a335e814c5eac7c97598b26fb80"}
\NormalTok{    )}
\NormalTok{  \}, F)}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.32} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"The data that would be used has been extracted."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    molnet\_files }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/"}\NormalTok{, }\StringTok{"gnps\_results"}\NormalTok{)}
    \CommentTok{\# molnet\_files \textless{}{-} paste0(exfiles, "/evaluation/gnps\_results")}
\NormalTok{    molnet\_lst }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"origin"}\NormalTok{, }\StringTok{"medium\_noise"}\NormalTok{, }\StringTok{"high\_noise"}\NormalTok{), }\AttributeTok{simplify =}\NormalTok{ F,}
      \ControlFlowTok{function}\NormalTok{(dir) \{}
\NormalTok{        data.table}\SpecialCharTok{::}\FunctionTok{fread}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(molnet\_files, }\StringTok{"/"}\NormalTok{, dir, }\StringTok{"/ClassyFireResults\_Network.txt"}\NormalTok{))}
\NormalTok{      \})}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.4} \OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Evaluate accuracy of classify"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s2}\FloatTok{.5} \OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Evaluate the \textquotesingle{}features\textquotesingle{} of each chemical class within the Nebula{-}Index:"}\NormalTok{,}
  \StringTok{"whether the compounds relative to the chemical class."}\NormalTok{)}

\NormalTok{s2}\FloatTok{.51} \OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Load assessment data and reference data."}\NormalTok{, }\DecValTok{3}\NormalTok{)}

\NormalTok{s2}\FloatTok{.511} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"The evaluation and reference data have already been saved in the previous"}\NormalTok{,}
    \StringTok{"steps and only need to be loaded:"}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    mgf\_metadata }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{fread}\NormalTok{(}
      \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/"}\NormalTok{, }\StringTok{"origin\_gnps\_pos.meta.tsv"}\NormalTok{)}
\NormalTok{    )}
\NormalTok{    id2key }\OtherTok{\textless{}{-}}\NormalTok{ stringr}\SpecialCharTok{::}\FunctionTok{str\_extract}\NormalTok{(mgf\_metadata}\SpecialCharTok{$}\NormalTok{INCHIKEY, }\StringTok{"\^{}[A{-}Z]*"}\NormalTok{)}
    \FunctionTok{names}\NormalTok{(id2key) }\OtherTok{\textless{}{-}}\NormalTok{ mgf\_metadata}\SpecialCharTok{$}\NormalTok{.id}
\NormalTok{    id2key }\OtherTok{\textless{}{-}} \FunctionTok{as.list}\NormalTok{(id2key)}
    \FunctionTok{load}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/mcnHier.rdata"}\NormalTok{))}
\NormalTok{    class.db }\OtherTok{\textless{}{-}} \FunctionTok{extract\_rdata\_list}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/classification.rdata"}\NormalTok{))}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.52} \OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Filter assessment data."}\NormalTok{, }\DecValTok{3}\NormalTok{)}

\NormalTok{s2}\FloatTok{.521} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Filtered according to: the common \textquotesingle{}features\textquotesingle{} (at least identified to the"}\NormalTok{,}
    \StringTok{"chemical formula) in the three levels; whether included in reference data (\textasciigrave{}class.db\textasciigrave{})."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    common }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(lst, }\ControlFlowTok{function}\NormalTok{(l)  l}\SpecialCharTok{$}\NormalTok{features\_annotation}\SpecialCharTok{$}\NormalTok{.features\_id )}
\NormalTok{    common }\OtherTok{\textless{}{-}}\NormalTok{ common[[}\DecValTok{1}\NormalTok{]][}
\NormalTok{      (common[[}\DecValTok{1}\NormalTok{]] }\SpecialCharTok{\%in\%}\NormalTok{ common[[}\DecValTok{2}\NormalTok{]]) }\SpecialCharTok{\&}
\NormalTok{      (common[[}\DecValTok{1}\NormalTok{]] }\SpecialCharTok{\%in\%}\NormalTok{ common[[}\DecValTok{3}\NormalTok{]]) }
\NormalTok{    ]}
\NormalTok{    keep }\OtherTok{\textless{}{-}}\NormalTok{ id2key }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(class.db)}
\NormalTok{    common }\OtherTok{\textless{}{-}}\NormalTok{ common[ common }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(id2key)[keep] ]}
    \DocumentationTok{\#\# length(common) \# [1] 7524}
\NormalTok{    lst }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(lst,}
      \ControlFlowTok{function}\NormalTok{(l) \{}
\NormalTok{        l}\SpecialCharTok{$}\NormalTok{nebula\_index }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(}
\NormalTok{          l}\SpecialCharTok{$}\NormalTok{nebula\_index, .features\_id }\SpecialCharTok{\%in\%}\NormalTok{ common}
\NormalTok{        )}
        \FunctionTok{return}\NormalTok{(l)}
\NormalTok{      \})}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.53} \OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Count the results."}\NormalTok{, }\DecValTok{3}\NormalTok{)}

\NormalTok{s2}\FloatTok{.531} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Assess the accuracy and derive ratios for each type of result."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    res }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(lst,}
      \ControlFlowTok{function}\NormalTok{(l) \{}
\NormalTok{        l }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{split}\NormalTok{(l}\SpecialCharTok{$}\NormalTok{nebula\_index, }\SpecialCharTok{\textasciitilde{}}\NormalTok{ class.name),}
          \ControlFlowTok{function}\NormalTok{(df) df[[ }\StringTok{".features\_id"}\NormalTok{ ]])}
\NormalTok{        stat\_list }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(l), }\AttributeTok{simplify =}\NormalTok{ F,}
          \ControlFlowTok{function}\NormalTok{(class.name) \{}
            \FunctionTok{stat\_classify}\NormalTok{(}
\NormalTok{              l[[ class.name ]], class.name,}
\NormalTok{              id2key, mcnHier., class.db}
\NormalTok{            )}
\NormalTok{          \})}
\NormalTok{        stat\_table }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(}
          \FunctionTok{lapply}\NormalTok{(stat\_list, table\_app, }\AttributeTok{prop =}\NormalTok{ T), }\AttributeTok{fill =}\NormalTok{ T, }\AttributeTok{idcol =}\NormalTok{ T}
\NormalTok{        )}
\NormalTok{        stat\_table }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{rename}\NormalTok{(stat\_table, }\AttributeTok{class.name =}\NormalTok{ .id)}
\NormalTok{        stat\_table }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{summarise\_all}\NormalTok{(}
\NormalTok{          stat\_table, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{ifelse}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(x), }\DecValTok{0}\NormalTok{, x)}
\NormalTok{        )}
\NormalTok{      \})}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.54} \OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Post{-}filtering."}\NormalTok{, }\DecValTok{3}\NormalTok{)}

\NormalTok{s2}\FloatTok{.541} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Filter out chemical classes with insufficient number of features; keep only"}\NormalTok{,}
    \StringTok{"those contained in \textquotesingle{}origin\textquotesingle{}."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    res[[}\DecValTok{1}\NormalTok{]] }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(res[[}\DecValTok{1}\NormalTok{]], sum }\SpecialCharTok{\textgreater{}=} \DecValTok{50}\NormalTok{)}
\NormalTok{    keep }\OtherTok{\textless{}{-}}\NormalTok{ res[[}\DecValTok{1}\NormalTok{]]}\SpecialCharTok{$}\NormalTok{class.name}
\NormalTok{    res[}\DecValTok{2}\SpecialCharTok{:}\DecValTok{3}\NormalTok{] }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(res[}\DecValTok{2}\SpecialCharTok{:}\DecValTok{3}\NormalTok{], dplyr}\SpecialCharTok{::}\NormalTok{filter, class.name }\SpecialCharTok{\%in\%}\NormalTok{ keep)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.55} \OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Distinguish the chemical class of the dominant structure."}\NormalTok{, }\DecValTok{3}\NormalTok{)}

\NormalTok{s2}\FloatTok{.551} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Our reference data (\textasciigrave{}class.db\textasciigrave{}) contains only chemical classes for the"}\NormalTok{,}
    \StringTok{"dominant structure of a compound, but not for the sub{-}structure of a"}\NormalTok{,}
    \StringTok{"compound.  Our evaluation data (\textasciigrave{}lst\textasciigrave{}) contain both chemical classes of"}\NormalTok{,}
    \StringTok{"substructures and classes of dominant structures. This makes the assessment"}\NormalTok{,}
    \StringTok{"biased. But they are easily distinguishable:"}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    dominant\_res }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(res, dplyr}\SpecialCharTok{::}\NormalTok{filter, false }\SpecialCharTok{\textless{}}\NormalTok{ .}\DecValTok{4}\NormalTok{)}
\NormalTok{    sub\_res }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(res, dplyr}\SpecialCharTok{::}\NormalTok{filter, false }\SpecialCharTok{\textgreater{}=}\NormalTok{ .}\DecValTok{4}\NormalTok{)}
\NormalTok{    summarise }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(df) \{}
\NormalTok{      false }\OtherTok{\textless{}{-}} \FunctionTok{round}\NormalTok{(}\FunctionTok{mean}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{false) }\SpecialCharTok{*} \DecValTok{100}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{      sum }\OtherTok{\textless{}{-}} \FunctionTok{round}\NormalTok{(}\FunctionTok{mean}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{sum), }\DecValTok{1}\NormalTok{)}
      \FunctionTok{list}\NormalTok{(}\AttributeTok{false =}\NormalTok{ false, }\AttributeTok{sum =}\NormalTok{ sum)}
\NormalTok{    \}}
\NormalTok{    summary }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(dominant\_res, summarise)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.56} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"These chemical classes represent mostly local structures in compounds (they"}\NormalTok{,}
    \StringTok{"represent very small structures that are present in many other classes of"}\NormalTok{,}
    \StringTok{"compounds):"}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    sub\_res[[}\DecValTok{1}\NormalTok{]]}\SpecialCharTok{$}\NormalTok{class.name}
\NormalTok{  \}, }\AttributeTok{args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{eval =}\NormalTok{ T))}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.57} \OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Visualizaion"}\NormalTok{, }\DecValTok{3}\NormalTok{)}

\NormalTok{s2}\FloatTok{.571} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Visualize the results of evaluation:"}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    vis\_lst }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(dominant\_res, visualize\_stat, }\AttributeTok{mcn =}\NormalTok{ mcnHier.)}
\NormalTok{    pdfs }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
    \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \FunctionTok{names}\NormalTok{(vis\_lst)) \{}
\NormalTok{      pdfs[[ i ]] }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/"}\NormalTok{, i, }\StringTok{"\_classified\_accuracy.pdf"}\NormalTok{)}
      \FunctionTok{pdf}\NormalTok{(pdfs[[ i ]], }\DecValTok{13}\NormalTok{, }\DecValTok{11}\NormalTok{)}
      \FunctionTok{draw}\NormalTok{(vis\_lst[[ i ]])}
      \FunctionTok{dev.off}\NormalTok{()}
\NormalTok{    \}}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.572} \OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(pdfs[[ }\DecValTok{1}\NormalTok{ ]], }\StringTok{"origin"}\NormalTok{,}
  \StringTok{"Classified accuracy (MCnebula2) of origin dataset"}\NormalTok{)}
\NormalTok{s2}\FloatTok{.573} \OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(pdfs[[ }\DecValTok{2}\NormalTok{ ]], }\StringTok{"medium"}\NormalTok{,}
  \StringTok{"Classified accuracy (MCnebula2) of medium noise dataset"}\NormalTok{)}
\NormalTok{s2}\FloatTok{.574} \OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(pdfs[[ }\DecValTok{3}\NormalTok{ ]], }\StringTok{"high"}\NormalTok{,}
  \StringTok{"Classified accuracy (MCnebula2) of high noise dataset"}\NormalTok{)}

\NormalTok{ref }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
  \FunctionTok{paste0}\NormalTok{(}\StringTok{"(Fig. "}\NormalTok{, }\FunctionTok{get\_ref}\NormalTok{(x), }\StringTok{")"}\NormalTok{)}
\NormalTok{\}}
\NormalTok{s2}\FloatTok{.575} \OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \FunctionTok{paste0}\NormalTok{(}\StringTok{"Totally "}\NormalTok{, }\FunctionTok{length}\NormalTok{(common), }\StringTok{" compounds used for evaluation."}\NormalTok{),}
  \StringTok{"For the origin dataset, the average false rate of MCnebula2 classifying is"}\NormalTok{,}
  \FunctionTok{paste0}\NormalTok{(summary}\SpecialCharTok{$}\NormalTok{origin}\SpecialCharTok{$}\NormalTok{false, }\StringTok{"\% "}\NormalTok{, }\FunctionTok{ref}\NormalTok{(s2}\FloatTok{.572}\NormalTok{), }\StringTok{";"}\NormalTok{),}
  \StringTok{"the average classified number of \textquotesingle{}features\textquotesingle{} is"}\NormalTok{,}
  \FunctionTok{paste0}\NormalTok{(summary}\SpecialCharTok{$}\NormalTok{origin}\SpecialCharTok{$}\NormalTok{sum, }\StringTok{"."}\NormalTok{),}
  \StringTok{"For the medium noise dataset, the average false rate of MCnebula2 classifying is"}\NormalTok{,}
  \FunctionTok{paste0}\NormalTok{(summary}\SpecialCharTok{$}\NormalTok{medium\_noise}\SpecialCharTok{$}\NormalTok{false, }\StringTok{"\% "}\NormalTok{, }\FunctionTok{ref}\NormalTok{(s2}\FloatTok{.573}\NormalTok{), }\StringTok{";"}\NormalTok{),}
  \StringTok{"the average classified number of \textquotesingle{}features\textquotesingle{} is"}\NormalTok{,}
  \FunctionTok{paste0}\NormalTok{(summary}\SpecialCharTok{$}\NormalTok{medium\_noise}\SpecialCharTok{$}\NormalTok{sum, }\StringTok{"."}\NormalTok{),}
  \StringTok{"For the high noise dataset, the average false rate of MCnebula2 classifying is"}\NormalTok{,}
  \FunctionTok{paste0}\NormalTok{(summary}\SpecialCharTok{$}\NormalTok{high\_noise}\SpecialCharTok{$}\NormalTok{false, }\StringTok{"\% "}\NormalTok{, }\FunctionTok{ref}\NormalTok{(s2}\FloatTok{.574}\NormalTok{), }\StringTok{"."}\NormalTok{),}
  \StringTok{"the average classified number of \textquotesingle{}features\textquotesingle{} is"}\NormalTok{,}
  \FunctionTok{paste0}\NormalTok{(summary}\SpecialCharTok{$}\NormalTok{high\_noise}\SpecialCharTok{$}\NormalTok{sum, }\StringTok{"."}\NormalTok{)}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.576} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"See following:"}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    summary}
\NormalTok{  \}, }\AttributeTok{args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{eval =}\NormalTok{ T, }\AttributeTok{echo =}\NormalTok{ T))}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.577} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Gather three levels (origin, medium\_noise, high\_noise) of results:"}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    vis }\OtherTok{\textless{}{-}} \FunctionTok{visualize\_statComplex}\NormalTok{(}
\NormalTok{      dominant\_res, mcnHier., }\AttributeTok{weight =} \FunctionTok{c}\NormalTok{(}\AttributeTok{pl =}\NormalTok{ .}\DecValTok{7}\NormalTok{, }\AttributeTok{pm =} \FloatTok{1.1}\NormalTok{, }\AttributeTok{pr =}\NormalTok{ .}\DecValTok{8}\NormalTok{)}
\NormalTok{    )}
    \FunctionTok{pdf}\NormalTok{(f2}\FloatTok{.577} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/gather\_classified\_accuracy.pdf"}\NormalTok{), }\FloatTok{15.5}\NormalTok{, }\DecValTok{13}\NormalTok{)}
    \FunctionTok{draw}\NormalTok{(vis)}
    \FunctionTok{dev.off}\NormalTok{()}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.578} \OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(f2}\FloatTok{.577}\NormalTok{, }\StringTok{"gather"}\NormalTok{,}
  \StringTok{"Classified accuracy (MCnebula2) of three levels dataset"}\NormalTok{)}

\NormalTok{s2}\FloatTok{.579} \OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"See results"}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(}\FunctionTok{ref}\NormalTok{(s2}\FloatTok{.578}\NormalTok{), }\StringTok{"."}\NormalTok{))}

\NormalTok{s2}\FloatTok{.58} \OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Compare with MolNetEnhancer"}\NormalTok{, }\DecValTok{3}\NormalTok{)}

\NormalTok{s2}\FloatTok{.581} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Pre{-}process the data."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    molnet\_lst }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(molnet\_lst,}
      \ControlFlowTok{function}\NormalTok{(df) \{}
\NormalTok{        df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(df, }\AttributeTok{.id =} \StringTok{\textasciigrave{}}\AttributeTok{cluster index}\StringTok{\textasciigrave{}}\NormalTok{, }\FunctionTok{ends\_with}\NormalTok{(}\StringTok{"class"}\NormalTok{))}
\NormalTok{        df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(df, }\AttributeTok{.id =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"gnps"}\NormalTok{, .id))}
\NormalTok{        df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(df, .id }\SpecialCharTok{\%in\%} \SpecialCharTok{!!}\NormalTok{common)}
\NormalTok{        lst }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\DecValTok{2}\SpecialCharTok{:}\DecValTok{4}\NormalTok{,}
          \ControlFlowTok{function}\NormalTok{(n) \{}
\NormalTok{            lst }\OtherTok{\textless{}{-}} \FunctionTok{split}\NormalTok{(df, df[[ n ]])}
\NormalTok{            lst }\OtherTok{\textless{}{-}}\NormalTok{ lst[}\SpecialCharTok{!}\FunctionTok{names}\NormalTok{(lst) }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{""}\NormalTok{, }\StringTok{"no matches"}\NormalTok{)]}
\NormalTok{            lst }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(lst,}
              \ControlFlowTok{function}\NormalTok{(df) \{}
                \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(df[[ }\StringTok{".id"}\NormalTok{ ]]) }\SpecialCharTok{\textgreater{}=} \DecValTok{50}\NormalTok{) df[[ }\StringTok{".id"}\NormalTok{ ]]}
                \ControlFlowTok{else} \ConstantTok{NULL}
\NormalTok{              \})}
\NormalTok{          \})}
\NormalTok{        lst }\OtherTok{\textless{}{-}} \FunctionTok{unlist}\NormalTok{(lst, }\AttributeTok{recursive =}\NormalTok{ F)}
\NormalTok{        lst[}\SpecialCharTok{!}\FunctionTok{vapply}\NormalTok{(lst, is.null, }\FunctionTok{logical}\NormalTok{(}\DecValTok{1}\NormalTok{))]}
\NormalTok{      \})}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.582} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Count the results."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    res\_molnet }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(molnet\_lst,}
      \ControlFlowTok{function}\NormalTok{(l) \{}
\NormalTok{        stat\_list }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(l), }\AttributeTok{simplify =}\NormalTok{ F,}
          \ControlFlowTok{function}\NormalTok{(class.name) \{}
            \FunctionTok{stat\_classify}\NormalTok{(}
\NormalTok{              l[[ class.name ]], class.name,}
\NormalTok{              id2key, mcnHier., class.db}
\NormalTok{            )}
\NormalTok{          \})}
\NormalTok{        stat\_table }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(}
          \FunctionTok{lapply}\NormalTok{(stat\_list, table\_app, }\AttributeTok{prop =}\NormalTok{ T), }\AttributeTok{fill =}\NormalTok{ T, }\AttributeTok{idcol =}\NormalTok{ T}
\NormalTok{        )}
\NormalTok{        stat\_table }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{rename}\NormalTok{(stat\_table, }\AttributeTok{class.name =}\NormalTok{ .id)}
\NormalTok{        stat\_table }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{summarise\_all}\NormalTok{(}
\NormalTok{          stat\_table, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{ifelse}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(x), }\DecValTok{0}\NormalTok{, x)}
\NormalTok{        )}
\NormalTok{      \})}
\NormalTok{    res\_molnet[[}\DecValTok{1}\NormalTok{]] }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(res\_molnet[[}\DecValTok{1}\NormalTok{]], sum }\SpecialCharTok{\textgreater{}=} \DecValTok{50}\NormalTok{)}
\NormalTok{    keep }\OtherTok{\textless{}{-}}\NormalTok{ res\_molnet[[}\DecValTok{1}\NormalTok{]]}\SpecialCharTok{$}\NormalTok{class.name}
\NormalTok{    res\_molnet[}\DecValTok{2}\SpecialCharTok{:}\DecValTok{3}\NormalTok{] }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(res\_molnet[}\DecValTok{2}\SpecialCharTok{:}\DecValTok{3}\NormalTok{], dplyr}\SpecialCharTok{::}\NormalTok{filter, class.name }\SpecialCharTok{\%in\%}\NormalTok{ keep)}
\NormalTok{    summary\_molnet }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(res\_molnet, summarise)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.583} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Visualize the results."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    vis\_lst }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}
\NormalTok{      res\_molnet, visualize\_stat, }\AttributeTok{mcn =}\NormalTok{ mcnHier.,}
      \AttributeTok{weight =} \FunctionTok{c}\NormalTok{(}\AttributeTok{pl =} \DecValTok{1}\NormalTok{, }\AttributeTok{pm =}\NormalTok{ .}\DecValTok{8}\NormalTok{, }\AttributeTok{pr =}\NormalTok{ .}\DecValTok{7}\NormalTok{)}
\NormalTok{    )}
\NormalTok{    pdfs2 }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
    \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \FunctionTok{names}\NormalTok{(vis\_lst)) \{}
\NormalTok{      pdfs2[[ i ]] }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/"}\NormalTok{, i, }\StringTok{"\_classified\_accuracy\_Molnet.pdf"}\NormalTok{)}
\NormalTok{      w }\OtherTok{\textless{}{-}} \ControlFlowTok{if}\NormalTok{ (i }\SpecialCharTok{==} \StringTok{"origin"}\NormalTok{) }\DecValTok{15} \ControlFlowTok{else} \DecValTok{11}
      \FunctionTok{pdf}\NormalTok{(pdfs2[[ i ]], w, }\DecValTok{11}\NormalTok{)}
      \FunctionTok{draw}\NormalTok{(vis\_lst[[ i ]])}
      \FunctionTok{dev.off}\NormalTok{()}
\NormalTok{    \}}
\NormalTok{    vis }\OtherTok{\textless{}{-}} \FunctionTok{visualize\_statComplex}\NormalTok{(}
\NormalTok{      res\_molnet, mcnHier.,}
      \AttributeTok{y\_cut\_left =} \FunctionTok{c}\NormalTok{(}\DecValTok{50}\NormalTok{, }\DecValTok{700}\NormalTok{),}
      \AttributeTok{y\_cut\_right =} \FunctionTok{c}\NormalTok{(}\DecValTok{800}\NormalTok{, }\DecValTok{2000}\NormalTok{),}
      \AttributeTok{y\_cut\_left\_breaks =} \FunctionTok{c}\NormalTok{(}\DecValTok{50}\NormalTok{, }\FunctionTok{seq}\NormalTok{(}\DecValTok{100}\NormalTok{, }\DecValTok{700}\NormalTok{, }\AttributeTok{by =} \DecValTok{200}\NormalTok{)),}
      \AttributeTok{y\_cut\_right\_breaks =} \FunctionTok{c}\NormalTok{(}\DecValTok{1200}\NormalTok{, }\DecValTok{1600}\NormalTok{),}
\NormalTok{    )}
    \FunctionTok{pdf}\NormalTok{(f2}\FloatTok{.583} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/gather\_classified\_accuracy\_Molnet.pdf"}\NormalTok{), }\DecValTok{18}\NormalTok{, }\DecValTok{13}\NormalTok{)}
    \FunctionTok{draw}\NormalTok{(vis)}
    \FunctionTok{dev.off}\NormalTok{()}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.584} \OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(pdfs2[[ }\DecValTok{1}\NormalTok{ ]], }\StringTok{"originMolnet"}\NormalTok{,}
  \StringTok{"Classified accuracy (MolnetEnhancer) of origin dataset"}\NormalTok{)}
\NormalTok{s2}\FloatTok{.585} \OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(pdfs2[[ }\DecValTok{2}\NormalTok{ ]], }\StringTok{"mediumMolnet"}\NormalTok{,}
  \StringTok{"Classified accuracy (MolNetEnhancer) of medium noise dataset"}\NormalTok{)}
\NormalTok{s2}\FloatTok{.586} \OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(pdfs2[[ }\DecValTok{3}\NormalTok{ ]], }\StringTok{"highMolnet"}\NormalTok{,}
  \StringTok{"Classified accuracy (MolNetEnhancer) of high noise dataset"}\NormalTok{)}

\NormalTok{s2}\FloatTok{.587} \OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \StringTok{"For the origin dataset, the average false rate of MolNetEnhancer classifying is"}\NormalTok{,}
  \FunctionTok{paste0}\NormalTok{(summary\_molnet}\SpecialCharTok{$}\NormalTok{origin}\SpecialCharTok{$}\NormalTok{false, }\StringTok{"\% "}\NormalTok{, }\FunctionTok{ref}\NormalTok{(s2}\FloatTok{.584}\NormalTok{), }\StringTok{";"}\NormalTok{),}
  \StringTok{"the average classified number of \textquotesingle{}features\textquotesingle{} is"}\NormalTok{,}
  \FunctionTok{paste0}\NormalTok{(summary\_molnet}\SpecialCharTok{$}\NormalTok{origin}\SpecialCharTok{$}\NormalTok{sum, }\StringTok{"."}\NormalTok{),}
  \StringTok{"For the medium noise dataset, the average false rate of MolNetEnhancer classifying is"}\NormalTok{,}
  \FunctionTok{paste0}\NormalTok{(summary\_molnet}\SpecialCharTok{$}\NormalTok{medium\_noise}\SpecialCharTok{$}\NormalTok{false, }\StringTok{"\% "}\NormalTok{, }\FunctionTok{ref}\NormalTok{(s2}\FloatTok{.585}\NormalTok{), }\StringTok{";"}\NormalTok{),}
  \StringTok{"the average classified number of \textquotesingle{}features\textquotesingle{} is"}\NormalTok{,}
  \FunctionTok{paste0}\NormalTok{(summary\_molnet}\SpecialCharTok{$}\NormalTok{medium\_noise}\SpecialCharTok{$}\NormalTok{sum, }\StringTok{"."}\NormalTok{),}
  \StringTok{"For the high noise dataset, the average false rate of MolNetEnhancer classifying is"}\NormalTok{,}
  \FunctionTok{paste0}\NormalTok{(summary\_molnet}\SpecialCharTok{$}\NormalTok{high\_noise}\SpecialCharTok{$}\NormalTok{false, }\StringTok{"\% "}\NormalTok{, }\FunctionTok{ref}\NormalTok{(s2}\FloatTok{.586}\NormalTok{), }\StringTok{";"}\NormalTok{),}
  \StringTok{"the average classified number of \textquotesingle{}features\textquotesingle{} is"}\NormalTok{,}
  \FunctionTok{paste0}\NormalTok{(summary\_molnet}\SpecialCharTok{$}\NormalTok{high\_noise}\SpecialCharTok{$}\NormalTok{sum, }\StringTok{"."}\NormalTok{)}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.588} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"See following:"}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    summary\_molnet}
\NormalTok{  \}, }\AttributeTok{args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{eval =}\NormalTok{ T, }\AttributeTok{echo =}\NormalTok{ T))}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.589} \OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(f2}\FloatTok{.583}\NormalTok{, }\StringTok{"gatherMol"}\NormalTok{,}
  \StringTok{"Classified accuracy (MolNetEnhancer) of three levels dataset"}\NormalTok{)}

\NormalTok{s2}\FloatTok{.5891} \OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"See results"}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(}\FunctionTok{ref}\NormalTok{(s2}\FloatTok{.589}\NormalTok{), }\StringTok{"."}\NormalTok{))}

\NormalTok{s2}\FloatTok{.59} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Compare classified number of features for two methods in three levels:"}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    vis }\OtherTok{\textless{}{-}} \FunctionTok{visualize\_comparison}\NormalTok{(dominant\_res, res\_molnet)}
    \FunctionTok{pdf}\NormalTok{(f2}\FloatTok{.8} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/classified\_number\_comparison.pdf"}\NormalTok{))}
    \FunctionTok{draw}\NormalTok{(vis)}
    \FunctionTok{dev.off}\NormalTok{()}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.591} \OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(f2}\FloatTok{.8}\NormalTok{, }\StringTok{"numberComp"}\NormalTok{,}
  \StringTok{"Comparison of classified number for MCnebula2 and MolNetEnhancer"}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.592} \OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"As shown"}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(}\FunctionTok{ref}\NormalTok{(s2}\FloatTok{.591}\NormalTok{), }\StringTok{","}\NormalTok{),}
  \StringTok{"MCnebula2 has a higher noise tolerance than MolNetEnhancer."}\NormalTok{,}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.59} \OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Summary"}\NormalTok{, }\DecValTok{3}\NormalTok{)}

\NormalTok{s2}\FloatTok{.591} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"The following data is available."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    res\_parallel }\OtherTok{\textless{}{-}} \FunctionTok{attr}\NormalTok{(vis, }\StringTok{"data"}\NormalTok{)}
\NormalTok{    comman\_class }\OtherTok{\textless{}{-}} \FunctionTok{unique}\NormalTok{(res\_parallel[[}\DecValTok{1}\NormalTok{]]}\SpecialCharTok{$}\NormalTok{class.name)}
\NormalTok{    res\_mcnebula }\OtherTok{\textless{}{-}}\NormalTok{ dominant\_res}
\NormalTok{    res\_molnet}
\NormalTok{    summary\_mcnebula }\OtherTok{\textless{}{-}}\NormalTok{ summary}
\NormalTok{    summary\_molnet}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.592} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Also required:"}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    res\_mcnebula\_common }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}
\NormalTok{      res\_mcnebula, dplyr}\SpecialCharTok{::}\NormalTok{filter, class.name }\SpecialCharTok{\%in\%}\NormalTok{ comman\_class}
\NormalTok{    )}
\NormalTok{    res\_molnet\_common }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}
\NormalTok{      res\_molnet, dplyr}\SpecialCharTok{::}\NormalTok{filter, class.name }\SpecialCharTok{\%in\%}\NormalTok{ comman\_class}
\NormalTok{    )}
\NormalTok{    summary\_mcnebula\_common }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(res\_mcnebula\_common, summarise)}
\NormalTok{    summary\_molnet\_common }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(res\_molnet\_common, summarise)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.593} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Draw the figure:"}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    lst\_molnet }\OtherTok{\textless{}{-}} \FunctionTok{visualize\_summary}\NormalTok{(summary\_molnet\_common)}
\NormalTok{    lst\_mcnebula }\OtherTok{\textless{}{-}} \FunctionTok{visualize\_summary}\NormalTok{(summary\_mcnebula\_common)}
\NormalTok{    vis }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{namel}\NormalTok{(lst\_mcnebula, lst\_molnet),}
      \ControlFlowTok{function}\NormalTok{(lst) \{}
\NormalTok{        bar }\OtherTok{\textless{}{-}} \FunctionTok{as\_grob}\NormalTok{(lst}\SpecialCharTok{$}\NormalTok{p.num)}
\NormalTok{        ring }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}
          \AttributeTok{p.precision =} \FunctionTok{as\_grob}\NormalTok{(lst}\SpecialCharTok{$}\NormalTok{p.precision}\SpecialCharTok{$}\NormalTok{p.m),}
          \AttributeTok{p.ratioSt =} \FunctionTok{as\_grob}\NormalTok{(lst}\SpecialCharTok{$}\NormalTok{p.ratioSt}\SpecialCharTok{$}\NormalTok{p.m),}
          \AttributeTok{p.recall =} \FunctionTok{as\_grob}\NormalTok{(lst}\SpecialCharTok{$}\NormalTok{p.recall}\SpecialCharTok{$}\NormalTok{p.m)}
\NormalTok{        )}
\NormalTok{        frame }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{p.ratioSt =} \DecValTok{2}\NormalTok{, }\AttributeTok{p.precision =} \DecValTok{3}\NormalTok{, }\AttributeTok{p.recall =} \DecValTok{3}\NormalTok{), ring)}
        \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{bar =} \DecValTok{2}\NormalTok{, }\AttributeTok{frame =} \DecValTok{8}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\FunctionTok{namel}\NormalTok{(bar), }\FunctionTok{namel}\NormalTok{(frame)))}
\NormalTok{      \})}
\NormalTok{    vis }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{lst\_mcnebula =} \DecValTok{1}\NormalTok{, }\AttributeTok{lst\_molnet =} \DecValTok{1}\NormalTok{), vis)}
\NormalTok{    label\_mcnebula }\OtherTok{\textless{}{-}} \FunctionTok{gtext90}\NormalTok{(}\StringTok{"MCnebula"}\NormalTok{, }\StringTok{"\#4DBBD5FF"}\NormalTok{)}
\NormalTok{    label\_molnet }\OtherTok{\textless{}{-}} \FunctionTok{gtext90}\NormalTok{(}\StringTok{"GNPS"}\NormalTok{, }\StringTok{"\#E64B35FF"}\NormalTok{)}
\NormalTok{    group\_labels }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{label\_mcnebula =} \DecValTok{1}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{label\_molnet =} \DecValTok{1}\NormalTok{),}
      \FunctionTok{namel}\NormalTok{(label\_mcnebula, label\_molnet, }\AttributeTok{null =} \FunctionTok{nullGrob}\NormalTok{()))}
\NormalTok{    vis2 }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{group\_labels =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{vis =} \DecValTok{5}\NormalTok{), }\FunctionTok{namel}\NormalTok{(group\_labels, vis))}
\NormalTok{    legend }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{null =} \DecValTok{2}\NormalTok{, }\AttributeTok{null =} \DecValTok{2}\NormalTok{, }\AttributeTok{null =} \DecValTok{3}\NormalTok{, }\AttributeTok{null =} \DecValTok{3}\NormalTok{),}
      \FunctionTok{list}\NormalTok{(}\AttributeTok{null =} \FunctionTok{nullGrob}\NormalTok{(), }\AttributeTok{p.precision =}\NormalTok{ lst\_molnet}\SpecialCharTok{$}\NormalTok{p.precision}\SpecialCharTok{$}\NormalTok{p.l,}
        \AttributeTok{p.ratioSt =}\NormalTok{ lst\_molnet}\SpecialCharTok{$}\NormalTok{p.ratioSt}\SpecialCharTok{$}\NormalTok{p.l))}
\NormalTok{    vis3 }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{vis2 =} \DecValTok{5}\NormalTok{, }\AttributeTok{legend =}\NormalTok{ .}\DecValTok{5}\NormalTok{), }\FunctionTok{namel}\NormalTok{(vis2, legend))}
\NormalTok{    label\_sum }\OtherTok{\textless{}{-}} \FunctionTok{gtext90}\NormalTok{(}\StringTok{"Sum number"}\NormalTok{, }\StringTok{"\#709AE1FF"}\NormalTok{, }\DecValTok{0}\NormalTok{)}
\NormalTok{    label\_false }\OtherTok{\textless{}{-}} \FunctionTok{gtext90}\NormalTok{(}\StringTok{"Precision"}\NormalTok{, }\StringTok{"\#FED439FF"}\NormalTok{, }\DecValTok{0}\NormalTok{)}
\NormalTok{    label\_stab }\OtherTok{\textless{}{-}} \FunctionTok{gtext90}\NormalTok{(}\StringTok{"Stability"}\NormalTok{, }\StringTok{"\#91D1C2"}\NormalTok{, }\DecValTok{0}\NormalTok{)}
\NormalTok{    label\_recall }\OtherTok{\textless{}{-}} \FunctionTok{gtext90}\NormalTok{(}\StringTok{"Recall"}\NormalTok{, }\StringTok{"\#D5E4A2FF"}\NormalTok{, }\DecValTok{0}\NormalTok{)}
\NormalTok{    title\_labels }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}
      \FunctionTok{c}\NormalTok{(}\AttributeTok{null =}\NormalTok{ .}\DecValTok{2}\NormalTok{, }\AttributeTok{label\_sum =} \DecValTok{2}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{label\_stab =} \DecValTok{2}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{1}\NormalTok{,}
        \AttributeTok{label\_false =} \DecValTok{3}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{label\_recall =} \DecValTok{3}\NormalTok{), }
      \FunctionTok{namel}\NormalTok{(label\_sum, label\_false, label\_stab, label\_recall, }\AttributeTok{null =} \FunctionTok{nullGrob}\NormalTok{())}
\NormalTok{    )}
\NormalTok{    vis4 }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}
      \FunctionTok{c}\NormalTok{(}\AttributeTok{title\_labels =} \DecValTok{1}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{vis3 =} \DecValTok{15}\NormalTok{), }
      \FunctionTok{namel}\NormalTok{(title\_labels, vis3, }\AttributeTok{null =} \FunctionTok{nullGrob}\NormalTok{())}
\NormalTok{    )}
\NormalTok{    vis4 }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(vis4, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{95}\NormalTok{, .}\DecValTok{95}\NormalTok{))}
    \FunctionTok{pdf}\NormalTok{(f2}\FloatTok{.59} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/evaluation\_summary.pdf"}\NormalTok{), }\DecValTok{17}\NormalTok{, }\DecValTok{5}\NormalTok{)}
    \FunctionTok{draw}\NormalTok{(vis4)}
    \FunctionTok{dev.off}\NormalTok{()}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.594} \OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(f2}\FloatTok{.59}\NormalTok{, }\StringTok{"summary"}\NormalTok{, }\StringTok{"Evaluation sumary for MCnebula and benchmark method"}\NormalTok{)}

\NormalTok{s2}\FloatTok{.595} \OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Under the same conditions (common chemical classes), MCnebula outperforms the"}\NormalTok{,}
  \StringTok{"benchmark method (Fig. }\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{\ref{fig:summary})."}\NormalTok{,}
  \StringTok{"The formula for Relative false rate and Recall (TP / (TP + FN)):"}\NormalTok{,}
  \StringTok{"{-} RelativeFalseRate = 1 {-} (1 {-} FalseRate) * (1 {-} AverageLostRate)"}\NormalTok{,}
  \StringTok{"{-} Recall = (1 {-} RelativeFalseRate) / (1 {-} RelativeFalseRate + AverageLostRate)"}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.6} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Combine figure..."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    vis\_summary }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{grecta}\NormalTok{(}\StringTok{"a"}\NormalTok{), vis4)}
\NormalTok{    vis\_classify }\OtherTok{\textless{}{-}} \FunctionTok{visualize\_comparison}\NormalTok{(dominant\_res, res\_molnet,}
      \AttributeTok{from =} \FunctionTok{c}\NormalTok{(}\StringTok{"MCnebula"}\NormalTok{, }\StringTok{"GNPS"}\NormalTok{))}
\NormalTok{    vis\_classify }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{grecta}\NormalTok{(}\StringTok{"b"}\NormalTok{), vis\_classify)}
\NormalTok{    vis\_id }\OtherTok{\textless{}{-}} \FunctionTok{visualize\_idRes}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\StringTok{\textasciigrave{}}\AttributeTok{No cut{-}off}\StringTok{\textasciigrave{}} \OtherTok{=}\NormalTok{ idRes, }\StringTok{\textasciigrave{}}\AttributeTok{0.5 cut{-}off}\StringTok{\textasciigrave{}} \OtherTok{=}\NormalTok{ idRes}\FloatTok{.5}\NormalTok{))}
\NormalTok{    vis\_id }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{grecta}\NormalTok{(}\StringTok{"c"}\NormalTok{), vis\_id)}
\NormalTok{    frame1 }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}
      \FunctionTok{c}\NormalTok{(}\AttributeTok{vis\_classify =} \DecValTok{2}\NormalTok{, }\AttributeTok{vis\_id =} \DecValTok{1}\NormalTok{),}
      \FunctionTok{namel}\NormalTok{(vis\_classify, vis\_id)}
\NormalTok{    )}
\NormalTok{    frame2 }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}
      \FunctionTok{c}\NormalTok{(}\AttributeTok{vis\_summary =} \DecValTok{1}\NormalTok{, }\AttributeTok{frame1 =} \DecValTok{2}\NormalTok{),}
      \FunctionTok{namel}\NormalTok{(vis\_summary, frame1)}
\NormalTok{    )}
\NormalTok{    frame2 }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(frame2, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{95}\NormalTok{, .}\DecValTok{95}\NormalTok{))}
    \FunctionTok{pdf}\NormalTok{(fs }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/compare\_accuracy.pdf"}\NormalTok{), }\DecValTok{18}\NormalTok{, }\DecValTok{14}\NormalTok{)}
    \FunctionTok{draw}\NormalTok{(frame2)}
    \FunctionTok{dev.off}\NormalTok{()}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.61} \OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(fs, }\StringTok{"comP"}\NormalTok{, }\StringTok{"Overall summary"}\NormalTok{)}

\NormalTok{s2}\FloatTok{.7} \OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Evaluate accuracy of identification"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s2}\FloatTok{.8} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Evaluate the accuracy of identification with origin dataset:"}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    identified }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(}
\NormalTok{      lst[[}\DecValTok{1}\NormalTok{]]}\SpecialCharTok{$}\NormalTok{features\_annotation, .features\_id, inchikey2d, tani.score}
\NormalTok{    )}
\NormalTok{    identified }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(identified, }\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(tani.score))}
    \CommentTok{\# nrow(identified) \# [1] 6610}
\NormalTok{    index }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(lst[[}\DecValTok{1}\NormalTok{]]}\SpecialCharTok{$}\NormalTok{nebula\_index, .features\_id }\SpecialCharTok{\%in\%}\NormalTok{ identified}\SpecialCharTok{$}\NormalTok{.features\_id)}
\NormalTok{    index }\OtherTok{\textless{}{-}} \FunctionTok{split}\NormalTok{(index, }\SpecialCharTok{\textasciitilde{}}\NormalTok{ class.name)}
\NormalTok{    index }\OtherTok{\textless{}{-}}\NormalTok{ index[}\FunctionTok{names}\NormalTok{(index) }\SpecialCharTok{\%in\%}\NormalTok{ dominant\_res[[}\DecValTok{1}\NormalTok{]]}\SpecialCharTok{$}\NormalTok{class.name]}
\NormalTok{    ref\_inchikey2d }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(}
\NormalTok{      mgf\_metadata, }\AttributeTok{inchikey2d =}\NormalTok{ stringr}\SpecialCharTok{::}\FunctionTok{str\_extract}\NormalTok{(INCHIKEY, }\StringTok{"\^{}[A{-}Z]*"}\NormalTok{)}
\NormalTok{    )}
\NormalTok{    ref\_inchikey2d }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(ref\_inchikey2d, }\AttributeTok{.features\_id =}\NormalTok{ .id, inchikey2d)}
\NormalTok{    idRes }\OtherTok{\textless{}{-}} \FunctionTok{stat\_identification}\NormalTok{(index, identified, ref\_inchikey2d)}
\NormalTok{    idRes.summary }\OtherTok{\textless{}{-}} \FunctionTok{summarise}\NormalTok{(idRes)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.81} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Set a cut{-}off for \textquotesingle{}tani.score\textquotesingle{} (Tanimoto similarity)."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    identified}\FloatTok{.5} \OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(identified, tani.score }\SpecialCharTok{\textgreater{}=}\NormalTok{ .}\DecValTok{5}\NormalTok{)}
\NormalTok{    index}\FloatTok{.5} \OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(index, dplyr}\SpecialCharTok{::}\NormalTok{filter, .features\_id }\SpecialCharTok{\%in\%}\NormalTok{ identified}\FloatTok{.5}\SpecialCharTok{$}\NormalTok{.features\_id)}
\NormalTok{    idRes}\FloatTok{.5} \OtherTok{\textless{}{-}} \FunctionTok{stat\_identification}\NormalTok{(index}\FloatTok{.5}\NormalTok{, identified}\FloatTok{.5}\NormalTok{, ref\_inchikey2d)}
\NormalTok{    idRes.}\FloatTok{5.}\NormalTok{summary }\OtherTok{\textless{}{-}} \FunctionTok{summarise}\NormalTok{(idRes}\FloatTok{.5}\NormalTok{)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.82} \OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \StringTok{"For all identified compounds, the average false rate was"}\NormalTok{,}
  \FunctionTok{paste0}\NormalTok{(idRes.summary}\SpecialCharTok{$}\NormalTok{false, }\StringTok{"\%."}\NormalTok{), }\StringTok{"Set 0.5 for \textquotesingle{}tani.score\textquotesingle{} as threshold,}
\StringTok{  the average false rate was"}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(idRes.}\FloatTok{5.}\NormalTok{summary}\SpecialCharTok{$}\NormalTok{false, }\StringTok{"\%."}\NormalTok{)}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.83} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Visualize the results:"}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    vis }\OtherTok{\textless{}{-}} \FunctionTok{visualize\_idRes}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\StringTok{\textasciigrave{}}\AttributeTok{No cut{-}off}\StringTok{\textasciigrave{}} \OtherTok{=}\NormalTok{ idRes, }\StringTok{\textasciigrave{}}\AttributeTok{0.5 cut{-}off}\StringTok{\textasciigrave{}} \OtherTok{=}\NormalTok{ idRes}\FloatTok{.5}\NormalTok{))}
    \FunctionTok{pdf}\NormalTok{(f2}\FloatTok{.83} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/identified\_accuracy.pdf"}\NormalTok{), }\DecValTok{6}\NormalTok{, }\DecValTok{9}\NormalTok{)}
    \FunctionTok{draw}\NormalTok{(vis)}
    \FunctionTok{dev.off}\NormalTok{()}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.84} \OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(f2}\FloatTok{.83}\NormalTok{, }\StringTok{"idres"}\NormalTok{,}
  \StringTok{"Identified accuracy of compounds in each classified chemical class"}\NormalTok{)}

\NormalTok{s2}\FloatTok{.85} \OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"See results"}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(}\FunctionTok{ref}\NormalTok{(s2}\FloatTok{.84}\NormalTok{), }\StringTok{"."}\NormalTok{))}

\NormalTok{s100 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Session infomation"}\NormalTok{, }\DecValTok{1}\NormalTok{)}

\NormalTok{s100}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{rblock}\NormalTok{(\{}
  \FunctionTok{sessionInfo}\NormalTok{()}
\NormalTok{\}, }\AttributeTok{args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{eval =}\NormalTok{ T))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# gather}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\NormalTok{sections }\OtherTok{\textless{}{-}} \FunctionTok{gather\_sections}\NormalTok{()}
\NormalTok{report }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(new\_report, sections)}
\FunctionTok{yaml}\NormalTok{(report)[}\DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"title: Evaluation of MCnebula2"}\NormalTok{)}
\FunctionTok{render\_report}\NormalTok{(report, file }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/report.Rmd"}\NormalTok{))}
\NormalTok{rmarkdown}\SpecialCharTok{::}\FunctionTok{render}\NormalTok{(file)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-abstract-mcnebula2.r}{%
\section{File: ABSTRACT-MCnebula2.R}\label{file-abstract-mcnebula2.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-activate_nebulae-methods.r}{%
\section{File: activate\_nebulae-methods.R}\label{file-activate_nebulae-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\NormalTok{test }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_5features}

\DocumentationTok{\#\# the previous steps}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(test)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(test1, }\AttributeTok{by\_reference =}\NormalTok{ T)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_stardust\_classes}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_features\_annotation}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{cross\_filter\_stardust}\NormalTok{(test1, }\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_nebula\_index}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{compute\_spectral\_similarity}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_parent\_nebula}\NormalTok{(test1, }\FloatTok{0.01}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_nebulae}\NormalTok{(test1, }\FloatTok{0.01}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_parent\_layout}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_layouts}\NormalTok{(test1)}

\DocumentationTok{\#\# default parameters}
\FunctionTok{activate\_nebulae}\NormalTok{()}

\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{activate\_nebulae}\NormalTok{(test1)}
\DocumentationTok{\#\# see results}
\FunctionTok{ggset}\NormalTok{(}\FunctionTok{parent\_nebula}\NormalTok{(test1))}
\FunctionTok{head}\NormalTok{(}\FunctionTok{ggset}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(test1)))}

\DocumentationTok{\#\# visualize}
\FunctionTok{call\_command}\NormalTok{(}\FunctionTok{ggset}\NormalTok{(}\FunctionTok{parent\_nebula}\NormalTok{(test1)))}
\DocumentationTok{\#\# or}
\FunctionTok{visualize}\NormalTok{(test1, }\StringTok{"parent"}\NormalTok{)}
\DocumentationTok{\#\# child nebula}
\FunctionTok{call\_command}\NormalTok{(}\FunctionTok{ggset}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(test1))[[}\DecValTok{1}\NormalTok{]])}
\DocumentationTok{\#\# or}
\FunctionTok{visualize}\NormalTok{(test1, }\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-annotate_nebula-methods.r}{%
\section{File: annotate\_nebula-methods.R}\label{file-annotate_nebula-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\NormalTok{test }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_5features}

\DocumentationTok{\#\# the previous steps}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(test)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(test1, }\AttributeTok{by\_reference =}\NormalTok{ T)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_stardust\_classes}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_features\_annotation}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{cross\_filter\_stardust}\NormalTok{(test1, }\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_nebula\_index}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{compute\_spectral\_similarity}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_nebulae}\NormalTok{(test1, }\FloatTok{0.01}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_layouts}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{activate\_nebulae}\NormalTok{(test1)}

\DocumentationTok{\#\# set features quantification data}
\NormalTok{ids }\OtherTok{\textless{}{-}} \FunctionTok{features\_annotation}\NormalTok{(test1)}\SpecialCharTok{$}\NormalTok{.features\_id}
\NormalTok{quant. }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{.features\_id =}\NormalTok{ ids,}
  \AttributeTok{sample\_1 =} \FunctionTok{rnorm}\NormalTok{(}\FunctionTok{length}\NormalTok{(ids), }\DecValTok{1000}\NormalTok{, }\DecValTok{200}\NormalTok{),}
  \AttributeTok{sample\_2 =} \FunctionTok{rnorm}\NormalTok{(}\FunctionTok{length}\NormalTok{(ids), }\DecValTok{2000}\NormalTok{, }\DecValTok{500}\NormalTok{)}
\NormalTok{)}
\NormalTok{metadata }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{sample =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"sample\_"}\NormalTok{, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{2}\NormalTok{),}
  \AttributeTok{group =} \FunctionTok{c}\NormalTok{(}\StringTok{"control"}\NormalTok{, }\StringTok{"model"}\NormalTok{)}
\NormalTok{)}
\FunctionTok{features\_quantification}\NormalTok{(test1) }\OtherTok{\textless{}{-}}\NormalTok{ quant.}
\FunctionTok{sample\_metadata}\NormalTok{(test1) }\OtherTok{\textless{}{-}}\NormalTok{ metadata}

\DocumentationTok{\#\# optional \textquotesingle{}nebula\_name\textquotesingle{}}
\FunctionTok{visualize}\NormalTok{(test1)}
\DocumentationTok{\#\# a class for example}
\NormalTok{class }\OtherTok{\textless{}{-}} \FunctionTok{visualize}\NormalTok{(test1)}\SpecialCharTok{$}\NormalTok{class.name[}\DecValTok{1}\NormalTok{]}
\NormalTok{tmp }\OtherTok{\textless{}{-}} \FunctionTok{export\_path}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{annotate\_nebula}\NormalTok{(test1, class)}

\DocumentationTok{\#\# The following can be run before "annotate\_nebula()"}
\DocumentationTok{\#\# to customize the visualization of nodes.}
\CommentTok{\# test1 \textless{}{-} draw\_structures(test1, "Fatty Acyls")}
\DocumentationTok{\#\# set parameters for visualization of nodes}
\CommentTok{\# test1 \textless{}{-} draw\_nodes(}
\CommentTok{\#   test1, "Fatty Acyls",}
\CommentTok{\#   add\_id\_text = T,}
\CommentTok{\#   add\_structure = T,}
\CommentTok{\#   add\_ration = T,}
\CommentTok{\#   add\_ppcp = T}
\CommentTok{\# )}
\CommentTok{\# test1 \textless{}{-} annotate\_nebula(test1, class)}

\DocumentationTok{\#\# see results}
\NormalTok{ggset }\OtherTok{\textless{}{-}} \FunctionTok{ggset\_annotate}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(test1))}
\NormalTok{ggset[[class]]}
\DocumentationTok{\#\# visualize \textquotesingle{}ggset\textquotesingle{}}
\FunctionTok{call\_command}\NormalTok{(ggset[[class]])}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-backtrack_stardust-methods.r}{%
\section{File: backtrack\_stardust-methods.R}\label{file-backtrack_stardust-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-binary_comparison-methods.r}{%
\section{File: binary\_comparison-methods.R}\label{file-binary_comparison-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\NormalTok{test }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_5features}

\DocumentationTok{\#\# the previous steps}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(test)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(test1, }\AttributeTok{by\_reference =}\NormalTok{ T)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_features\_annotation}\NormalTok{(test1)}

\DocumentationTok{\#\# set up a simulated quantification data.}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{.simulate\_quant\_set}\NormalTok{(test1)}
\DocumentationTok{\#\# the simulated data}
\FunctionTok{features\_quantification}\NormalTok{(test1)}
\FunctionTok{sample\_metadata}\NormalTok{(test1)}

\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{binary\_comparison}\NormalTok{(}
\NormalTok{  test1, control }\SpecialCharTok{{-}}\NormalTok{ model,}
\NormalTok{  model }\SpecialCharTok{{-}}\NormalTok{ control, }\DecValTok{2} \SpecialCharTok{*}\NormalTok{ model }\SpecialCharTok{{-}}\NormalTok{ control}
\NormalTok{)}
\DocumentationTok{\#\# see results}
\FunctionTok{top\_table}\NormalTok{(}\FunctionTok{statistic\_set}\NormalTok{(test1))}

\DocumentationTok{\#\# the default parameters}
\FunctionTok{binary\_comparison}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-clear.r}{%
\section{File: clear.R}\label{file-clear.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-code_block-class.r}{%
\section{File: code\_block-class.R}\label{file-code_block-class.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\DocumentationTok{\#\# general}
\NormalTok{codes }\OtherTok{\textless{}{-}} \StringTok{"df \textless{}{-} data.frame(x = 1:10)}
\StringTok{  df\textless{}{-}dplyr::mutate(df,y=x*1.5)\%\textgreater{}\%}
\StringTok{  dplyr::filter(x \textgreater{}= 5)}
\StringTok{  p \textless{}{-} ggplot(df)+}
\StringTok{  geom\_point(aes(x=x,y=y))}
\StringTok{  p"}
\NormalTok{block }\OtherTok{\textless{}{-}} \FunctionTok{new\_code\_block}\NormalTok{(}\StringTok{"r"}\NormalTok{, codes, }\FunctionTok{list}\NormalTok{(}\AttributeTok{eval =}\NormalTok{ T, }\AttributeTok{echo =}\NormalTok{ T, }\AttributeTok{message =}\NormalTok{ T))}
\DocumentationTok{\#\# see results}
\NormalTok{block}
\FunctionTok{call\_command}\NormalTok{(block)}
\FunctionTok{writeLines}\NormalTok{(}\FunctionTok{call\_command}\NormalTok{(block))}

\DocumentationTok{\#\# figure}
\NormalTok{fig\_block }\OtherTok{\textless{}{-}} \FunctionTok{new\_code\_block\_figure}\NormalTok{(}
  \StringTok{"plot1"}\NormalTok{,}
  \StringTok{"this is a caption"}\NormalTok{,}
  \AttributeTok{codes =}\NormalTok{ codes}
\NormalTok{)}
\DocumentationTok{\#\# see results}
\NormalTok{fig\_block}
\FunctionTok{writeLines}\NormalTok{(}\FunctionTok{call\_command}\NormalTok{(fig\_block))}
\FunctionTok{command\_args}\NormalTok{(fig\_block)}
\FunctionTok{cat}\NormalTok{(}\FunctionTok{get\_ref}\NormalTok{(fig\_block), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}

\DocumentationTok{\#\# table}
\NormalTok{codes }\OtherTok{\textless{}{-}} \StringTok{"df \textless{}{-} data.frame(x = 1:10) \%\textgreater{}\% }
\StringTok{  dplyr::mutate(y = x, z = x * y)}
\StringTok{  knitr::kable(df, format = \textquotesingle{}markdown\textquotesingle{}, caption = \textquotesingle{}this is a caption\textquotesingle{}) "}
\NormalTok{tab\_block }\OtherTok{\textless{}{-}} \FunctionTok{new\_code\_block\_table}\NormalTok{(}\StringTok{"table1"}\NormalTok{, }\AttributeTok{codes =}\NormalTok{ codes)}
\DocumentationTok{\#\# see results}
\NormalTok{tab\_block}
\FunctionTok{cat}\NormalTok{(}\FunctionTok{get\_ref}\NormalTok{(tab\_block), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}

\DocumentationTok{\#\# default parameters}
\FunctionTok{new\_code\_block}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-collate_data-methods.r}{%
\section{File: collate\_data-methods.R}\label{file-collate_data-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\DocumentationTok{\#\# The raw data used for the example}
\NormalTok{tmp }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"/temp\_data"}\NormalTok{)}
\FunctionTok{dir.create}\NormalTok{(tmp)}
\NormalTok{eg.path }\OtherTok{\textless{}{-}} \FunctionTok{system.file}\NormalTok{(}\StringTok{"extdata"}\NormalTok{, }\StringTok{"raw\_instance.tar.gz"}\NormalTok{,}
                       \AttributeTok{package =} \StringTok{"MCnebula2"}\NormalTok{)}

\NormalTok{utils}\SpecialCharTok{::}\FunctionTok{untar}\NormalTok{(eg.path, }\AttributeTok{exdir =}\NormalTok{ tmp)}

\DocumentationTok{\#\# initialize \textquotesingle{}mcnebula\textquotesingle{} object}
\NormalTok{test }\OtherTok{\textless{}{-}} \FunctionTok{mcnebula}\NormalTok{()}
\NormalTok{test }\OtherTok{\textless{}{-}} \FunctionTok{initialize\_mcnebula}\NormalTok{(test, }\StringTok{"sirius.v4"}\NormalTok{, tmp)}

\DocumentationTok{\#\# extract candidates data in SIRIUS project directory}
\DocumentationTok{\#\# chemical structure}
\NormalTok{test }\OtherTok{\textless{}{-}} \FunctionTok{collate\_data}\NormalTok{(test, }\StringTok{".f3\_fingerid"}\NormalTok{)}
\FunctionTok{latest}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(test))}

\DocumentationTok{\#\# chemical formula}
\NormalTok{test }\OtherTok{\textless{}{-}} \FunctionTok{collate\_data}\NormalTok{(test, }\StringTok{".f2\_formula"}\NormalTok{)}
\FunctionTok{latest}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(test))}

\DocumentationTok{\#\# chemical classes}
\NormalTok{test }\OtherTok{\textless{}{-}} \FunctionTok{collate\_data}\NormalTok{(test, }\StringTok{".f3\_canopus"}\NormalTok{)}
\FunctionTok{latest}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(test))}

\DocumentationTok{\#\# mz and rt}
\NormalTok{test }\OtherTok{\textless{}{-}} \FunctionTok{collate\_data}\NormalTok{(test, }\StringTok{".f2\_info"}\NormalTok{)}
\FunctionTok{latest}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(test))}

\DocumentationTok{\#\# classification description}
\NormalTok{test }\OtherTok{\textless{}{-}} \FunctionTok{collate\_data}\NormalTok{(test, }\StringTok{".canopus"}\NormalTok{)}

\DocumentationTok{\#\# the extracted data in \textquotesingle{}mcnebula\textquotesingle{}}
\FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(test))}
\FunctionTok{entity}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(test))}\SpecialCharTok{$}\NormalTok{.f3\_fingerid)}

\FunctionTok{unlink}\NormalTok{(tmp, T, T)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-command-class.r}{%
\section{File: command-class.R}\label{file-command-class.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\DocumentationTok{\#\# example 1}
\NormalTok{com }\OtherTok{\textless{}{-}} \FunctionTok{new\_command}\NormalTok{(plot, }\AttributeTok{x =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{)}
\NormalTok{com}
\FunctionTok{call\_command}\NormalTok{(com)}

\DocumentationTok{\#\# example 2}
\NormalTok{com }\OtherTok{\textless{}{-}} \FunctionTok{new\_command}\NormalTok{(data.frame, }\AttributeTok{x =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, }\AttributeTok{y =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, }\AttributeTok{z =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{)}
\FunctionTok{call\_command}\NormalTok{(com)}

\DocumentationTok{\#\# example 3}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{x =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, }\AttributeTok{y =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{)}
\NormalTok{com1 }\OtherTok{\textless{}{-}} \FunctionTok{new\_command}\NormalTok{(ggplot, data)}
\NormalTok{com2 }\OtherTok{\textless{}{-}} \FunctionTok{new\_command}\NormalTok{(geom\_point, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y))}
\FunctionTok{call\_command}\NormalTok{(com1) }\SpecialCharTok{+} \FunctionTok{call\_command}\NormalTok{(com2)}

\DocumentationTok{\#\# slots}
\FunctionTok{command\_name}\NormalTok{(com)}
\FunctionTok{command\_args}\NormalTok{(com)}
\FunctionTok{command\_function}\NormalTok{(com)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-compute_spectral_similarity-methods.r}{%
\section{File: compute\_spectral\_similarity-methods.R}\label{file-compute_spectral_similarity-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\NormalTok{test }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_5features}

\DocumentationTok{\#\# the previous steps}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(test)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(test1, }\AttributeTok{by\_reference =}\NormalTok{ T)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_stardust\_classes}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_features\_annotation}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{cross\_filter\_stardust}\NormalTok{(test1, }\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_nebula\_index}\NormalTok{(test1)}

\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{compute\_spectral\_similarity}\NormalTok{(test1)}
\DocumentationTok{\#\# see results}
\FunctionTok{spectral\_similarity}\NormalTok{(test1)}
\DocumentationTok{\#\# or}
\FunctionTok{reference}\NormalTok{(test1)}\SpecialCharTok{$}\NormalTok{spectral\_similarity}
\DocumentationTok{\#\# or}
\FunctionTok{reference}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(test1))}\SpecialCharTok{$}\NormalTok{spectral\_similarity}

\DocumentationTok{\#\# compare the two spectra individually}
\NormalTok{spectra }\OtherTok{\textless{}{-}} \FunctionTok{latest}\NormalTok{(test1, }\StringTok{"project\_dataset"}\NormalTok{, }\StringTok{".f3\_spectra"}\NormalTok{)}
\NormalTok{data1 }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(spectra, .features\_id }\SpecialCharTok{==} \StringTok{"gnps1537"}\NormalTok{),}
\NormalTok{  mz, int.}
\NormalTok{)}
\NormalTok{data2 }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(spectra, .features\_id }\SpecialCharTok{==} \StringTok{"gnps1539"}\NormalTok{),}
\NormalTok{  mz, int.}
\NormalTok{)}
\NormalTok{e1 }\OtherTok{\textless{}{-}} \FunctionTok{compute\_spectral\_similarity}\NormalTok{(}\AttributeTok{sp1 =}\NormalTok{ data1, }\AttributeTok{sp2 =}\NormalTok{ data2)}
\NormalTok{e1}
\CommentTok{\# [1] 0.7670297}

\DocumentationTok{\#\# MSnbase}
\ControlFlowTok{if}\NormalTok{ (}\FunctionTok{requireNamespace}\NormalTok{(}\StringTok{"MSnbase"}\NormalTok{)) \{}
\NormalTok{  MSnbase}\SpecialCharTok{::}\NormalTok{compareSpectra}
\NormalTok{  spec1 }\OtherTok{\textless{}{-}} \FunctionTok{new}\NormalTok{(}\StringTok{"Spectrum2"}\NormalTok{, }\AttributeTok{mz =}\NormalTok{ data1}\SpecialCharTok{$}\NormalTok{mz, }\AttributeTok{intensity =}\NormalTok{ data1}\SpecialCharTok{$}\NormalTok{int.)}
\NormalTok{  spec2 }\OtherTok{\textless{}{-}} \FunctionTok{new}\NormalTok{(}\StringTok{"Spectrum2"}\NormalTok{, }\AttributeTok{mz =}\NormalTok{ data2}\SpecialCharTok{$}\NormalTok{mz, }\AttributeTok{intensity =}\NormalTok{ data2}\SpecialCharTok{$}\NormalTok{int.)}
\NormalTok{  e2 }\OtherTok{\textless{}{-}}\NormalTok{ MSnbase}\SpecialCharTok{::}\FunctionTok{compareSpectra}\NormalTok{(spec1, spec2, }\AttributeTok{fun =} \StringTok{"dotproduct"}\NormalTok{)}
  \FunctionTok{identical}\NormalTok{(e1, e2)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-create_child_layouts-methods.r}{%
\section{File: create\_child\_layouts-methods.R}\label{file-create_child_layouts-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\NormalTok{test }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_5features}

\DocumentationTok{\#\# the previous steps}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(test)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(test1, }\AttributeTok{by\_reference =}\NormalTok{ T)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_stardust\_classes}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_features\_annotation}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{cross\_filter\_stardust}\NormalTok{(test1, }\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_nebula\_index}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{compute\_spectral\_similarity}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_nebulae}\NormalTok{(test1, }\FloatTok{0.01}\NormalTok{)}

\DocumentationTok{\#\# function to generate default parameters}
\FunctionTok{create\_child\_layouts}\NormalTok{()}
\DocumentationTok{\#\# default parameters}
\FunctionTok{create\_child\_layouts}\NormalTok{()(test1)}

\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_layouts}\NormalTok{(test1)}
\DocumentationTok{\#\# see results (a object for \textquotesingle{}ggraph\textquotesingle{} package to visualization)}
\FunctionTok{lapply}\NormalTok{(}
  \FunctionTok{layout\_ggraph}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(test1)),}
\NormalTok{  tibble}\SpecialCharTok{::}\NormalTok{as\_tibble}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-create_child_nebulae-methods.r}{%
\section{File: create\_child\_nebulae-methods.R}\label{file-create_child_nebulae-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\NormalTok{test }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_5features}

\DocumentationTok{\#\# the previous steps}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(test)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(test1, }\AttributeTok{by\_reference =}\NormalTok{ T)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_stardust\_classes}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_features\_annotation}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{cross\_filter\_stardust}\NormalTok{(test1, }\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_nebula\_index}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{compute\_spectral\_similarity}\NormalTok{(test1)}

\DocumentationTok{\#\# default parameters}
\FunctionTok{create\_child\_nebulae}\NormalTok{()}

\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_nebulae}\NormalTok{(test1, }\FloatTok{0.01}\NormalTok{)}
\DocumentationTok{\#\# see results}
\FunctionTok{igraph}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(test1))}
\DocumentationTok{\#\# write output for \textquotesingle{}Cytoscape\textquotesingle{} or other network software}
\NormalTok{tmp }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"/child\_nebulae/"}\NormalTok{)}
\FunctionTok{dir.create}\NormalTok{(tmp)}
\NormalTok{res }\OtherTok{\textless{}{-}} \FunctionTok{igraph}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(test1))}
\FunctionTok{lapply}\NormalTok{(}
  \FunctionTok{names}\NormalTok{(res),}
  \ControlFlowTok{function}\NormalTok{(name) \{}
\NormalTok{    igraph}\SpecialCharTok{::}\FunctionTok{write\_graph}\NormalTok{(}
\NormalTok{      res[[name]],}
      \AttributeTok{file =} \FunctionTok{paste0}\NormalTok{(tmp, name, }\StringTok{".graphml"}\NormalTok{),}
      \AttributeTok{format =} \StringTok{"graphml"}
\NormalTok{    )}
\NormalTok{  \}}
\NormalTok{)}
\FunctionTok{list.files}\NormalTok{(tmp)}

\FunctionTok{unlink}\NormalTok{(tmp, T, T)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-create_features_annotation-methods.r}{%
\section{File: create\_features\_annotation-methods.R}\label{file-create_features_annotation-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\NormalTok{test }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_5features}

\DocumentationTok{\#\# the previous steps}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(test)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(test1, }\AttributeTok{by\_reference=}\NormalTok{T)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_stardust\_classes}\NormalTok{(test1)}

\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_features\_annotation}\NormalTok{(test1)}
\DocumentationTok{\#\# see results}
\FunctionTok{features\_annotation}\NormalTok{(test1)}
\DocumentationTok{\#\# or}
\FunctionTok{reference}\NormalTok{(test1)}\SpecialCharTok{$}\NormalTok{features\_annotation}
\DocumentationTok{\#\# or}
\FunctionTok{reference}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(test1))}\SpecialCharTok{$}\NormalTok{features\_annotation}

\DocumentationTok{\#\# merge additional data}
\NormalTok{ids }\OtherTok{\textless{}{-}} \FunctionTok{features\_annotation}\NormalTok{(test1)}\SpecialCharTok{$}\NormalTok{.features\_id}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{.features\_id =}\NormalTok{ ids, }\AttributeTok{quant. =} \FunctionTok{rnorm}\NormalTok{(}\FunctionTok{length}\NormalTok{(ids), }\DecValTok{1000}\NormalTok{, }\DecValTok{200}\NormalTok{))}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_features\_annotation}\NormalTok{(test1, }\AttributeTok{extra\_data =}\NormalTok{ data)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-create_hierarchy-methods.r}{%
\section{File: create\_hierarchy-methods.R}\label{file-create_hierarchy-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-create_nebula_index-methods.r}{%
\section{File: create\_nebula\_index-methods.R}\label{file-create_nebula_index-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\NormalTok{test }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_5features}

\DocumentationTok{\#\# the previous steps}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(test)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(test1, }\AttributeTok{by\_reference =}\NormalTok{ T)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_stardust\_classes}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_features\_annotation}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{cross\_filter\_stardust}\NormalTok{(test1, }\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{)}

\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_nebula\_index}\NormalTok{(test1)}
\DocumentationTok{\#\# see results}
\FunctionTok{nebula\_index}\NormalTok{(test1)}
\DocumentationTok{\#\# or}
\FunctionTok{reference}\NormalTok{(test1)}\SpecialCharTok{$}\NormalTok{nebula\_index}
\DocumentationTok{\#\# or}
\FunctionTok{reference}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(test1))}\SpecialCharTok{$}\NormalTok{nebula\_index}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-create_parent_layout-methods.r}{%
\section{File: create\_parent\_layout-methods.R}\label{file-create_parent_layout-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\NormalTok{test }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_5features}

\DocumentationTok{\#\# the previous steps}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(test)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(test1, }\AttributeTok{by\_reference =}\NormalTok{ T)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_stardust\_classes}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_features\_annotation}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{cross\_filter\_stardust}\NormalTok{(test1, }\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_nebula\_index}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{compute\_spectral\_similarity}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_parent\_nebula}\NormalTok{(test1, }\FloatTok{0.01}\NormalTok{)}

\DocumentationTok{\#\# default parameters}
\FunctionTok{create\_parent\_layout}\NormalTok{()}

\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_parent\_layout}\NormalTok{(test1)}
\DocumentationTok{\#\# see results (a object for \textquotesingle{}ggraph\textquotesingle{} package to visualization)}
\NormalTok{tibble}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(}\FunctionTok{layout\_ggraph}\NormalTok{(}\FunctionTok{parent\_nebula}\NormalTok{(test1)))}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-create_parent_nebula-methods.r}{%
\section{File: create\_parent\_nebula-methods.R}\label{file-create_parent_nebula-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\NormalTok{test }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_5features}

\DocumentationTok{\#\# the previous steps}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(test)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(test1, }\AttributeTok{by\_reference =}\NormalTok{ T)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_stardust\_classes}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_features\_annotation}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{cross\_filter\_stardust}\NormalTok{(test1, }\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_nebula\_index}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{compute\_spectral\_similarity}\NormalTok{(test1)}

\DocumentationTok{\#\# default parameters}
\FunctionTok{create\_parent\_nebula}\NormalTok{()}

\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_parent\_nebula}\NormalTok{(test1, }\FloatTok{0.01}\NormalTok{)}
\DocumentationTok{\#\# see results}
\FunctionTok{igraph}\NormalTok{(}\FunctionTok{parent\_nebula}\NormalTok{(test1))}
\DocumentationTok{\#\# write output for \textquotesingle{}Cytoscape\textquotesingle{} or other network software}
\NormalTok{tmp }\OtherTok{\textless{}{-}} \FunctionTok{tempdir}\NormalTok{()}
\NormalTok{igraph}\SpecialCharTok{::}\FunctionTok{write\_graph}\NormalTok{(}
  \FunctionTok{igraph}\NormalTok{(}\FunctionTok{parent\_nebula}\NormalTok{(test1)),}
  \AttributeTok{file =} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/parent\_nebula.graphml"}\NormalTok{),}
  \AttributeTok{format =} \StringTok{"graphml"}
\NormalTok{)}

\FunctionTok{unlink}\NormalTok{(tmp, T, T)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-create_reference-methods.r}{%
\section{File: create\_reference-methods.R}\label{file-create_reference-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\NormalTok{test }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_5features}

\DocumentationTok{\#\# set specific candidate}
\DocumentationTok{\#\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} }
\DocumentationTok{\#\# from chemical structure}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(test)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(test1)}
\DocumentationTok{\#\# see results}
\FunctionTok{specific\_candidate}\NormalTok{(test1)}
\DocumentationTok{\#\# or}
\FunctionTok{reference}\NormalTok{(test1)}\SpecialCharTok{$}\NormalTok{specific\_candidate}
\DocumentationTok{\#\# or}
\FunctionTok{reference}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(test1))}\SpecialCharTok{$}\NormalTok{specific\_candidate}
\DocumentationTok{\#\# \textquotesingle{}create\_reference(test1)\textquotesingle{} equals to}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(test1, }\AttributeTok{from =} \StringTok{"structure"}\NormalTok{, }\AttributeTok{fill =}\NormalTok{ T)}
\NormalTok{e1 }\OtherTok{\textless{}{-}} \FunctionTok{specific\_candidate}\NormalTok{(test1)}

\DocumentationTok{\#\# the above equals to following:}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{latest}\NormalTok{(}\FunctionTok{filter\_structure}\NormalTok{(test1))}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(test1, }\AttributeTok{data =}\NormalTok{ data, }\AttributeTok{fill =}\NormalTok{ T)}
\NormalTok{e2 }\OtherTok{\textless{}{-}} \FunctionTok{specific\_candidate}\NormalTok{(test1)}
\FunctionTok{identical}\NormalTok{(e1, e2)}

\DocumentationTok{\#\# the \textquotesingle{}specific\_candidate\textquotesingle{} data used for filtering}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(test1, }\AttributeTok{by\_reference =}\NormalTok{ T)}

\DocumentationTok{\#\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} }
\DocumentationTok{\#\# from chemical formula}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(test1, }\AttributeTok{from =} \StringTok{"formula"}\NormalTok{)}

\DocumentationTok{\#\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} }
\DocumentationTok{\#\# from chemical classes}
\DocumentationTok{\#\# A complex example:}
\DocumentationTok{\#\# suppose there were some classes we were interested in}
\NormalTok{all\_classes }\OtherTok{\textless{}{-}} \FunctionTok{latest}\NormalTok{(test1, }\StringTok{"project\_dataset"}\NormalTok{, }\StringTok{".canopus"}\NormalTok{)}\SpecialCharTok{$}\NormalTok{class.name}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{1}\NormalTok{)}
\NormalTok{classes }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(all\_classes, }\DecValTok{50}\NormalTok{)}
\NormalTok{classes}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_ppcp}\NormalTok{(test1,}
\NormalTok{  dplyr}\SpecialCharTok{::}\NormalTok{filter,}
\NormalTok{  class.name }\SpecialCharTok{\%in\%}\NormalTok{ classes,}
\NormalTok{  pp.value }\SpecialCharTok{\textgreater{}} \FloatTok{0.5}\NormalTok{,}
  \AttributeTok{by\_reference =}\NormalTok{ F}
\NormalTok{)}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{latest}\NormalTok{(test1)}
\NormalTok{data}
\DocumentationTok{\#\# \textquotesingle{}feature\textquotesingle{} have a plural number of candidates.}
\NormalTok{ids }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{.features\_id}
\NormalTok{id }\OtherTok{\textless{}{-}} \FunctionTok{unique}\NormalTok{(ids[}\FunctionTok{duplicated}\NormalTok{(ids)])}
\DocumentationTok{\#\# get the candidate of top chemical structural score.}
\StringTok{\textasciigrave{}}\AttributeTok{\%\textgreater{}\%}\StringTok{\textasciigrave{}} \OtherTok{\textless{}{-}}\NormalTok{ magrittr}\SpecialCharTok{::}\StringTok{\textasciigrave{}}\AttributeTok{\%\textgreater{}\%}\StringTok{\textasciigrave{}}
\NormalTok{candidates }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(test1, dplyr}\SpecialCharTok{::}\NormalTok{filter, .features\_id }\SpecialCharTok{\%in\%}\NormalTok{ id) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{latest}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(.candidates\_id }\SpecialCharTok{\%in\%}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{.candidates\_id) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{arrange}\NormalTok{(.features\_id, dplyr}\SpecialCharTok{::}\FunctionTok{desc}\NormalTok{(csi.score)) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{distinct}\NormalTok{(.features\_id, }\AttributeTok{.keep\_all =}\NormalTok{ T)}
\DocumentationTok{\#\# for refecrence}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ data }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(}
\NormalTok{    .features\_id }\SpecialCharTok{!=}\NormalTok{ candidates}\SpecialCharTok{$}\NormalTok{.features\_id }\SpecialCharTok{|}
\NormalTok{      (.features\_id }\SpecialCharTok{==}\NormalTok{ candidates}\SpecialCharTok{$}\NormalTok{.features\_id }\SpecialCharTok{\&}
\NormalTok{        .candidates\_id }\SpecialCharTok{==}\NormalTok{ candidates}\SpecialCharTok{$}\NormalTok{.candidates\_id)}
\NormalTok{  )}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(test1, }\AttributeTok{data =}\NormalTok{ data, }\AttributeTok{fill =}\NormalTok{ T)}
\FunctionTok{specific\_candidate}\NormalTok{(test1)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-create_stardust_classes-methods.r}{%
\section{File: create\_stardust\_classes-methods.R}\label{file-create_stardust_classes-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\NormalTok{test }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_5features}

\DocumentationTok{\#\# the previous steps}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(test)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(test1)}

\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_stardust\_classes}\NormalTok{(test1)}
\DocumentationTok{\#\# see results}
\FunctionTok{stardust\_classes}\NormalTok{(test1)}
\DocumentationTok{\#\# or}
\FunctionTok{reference}\NormalTok{(test1)}\SpecialCharTok{$}\NormalTok{stardust\_classes}
\DocumentationTok{\#\# or}
\FunctionTok{reference}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(test1))}\SpecialCharTok{$}\NormalTok{stardust\_classes}

\DocumentationTok{\#\# the default parameters}
\FunctionTok{create\_stardust\_classes}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-cross_filter_stardust-methods.r}{%
\section{File: cross\_filter\_stardust-methods.R}\label{file-cross_filter_stardust-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\NormalTok{test }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_5features}

\DocumentationTok{\#\# the previous steps}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(test)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(test1, }\AttributeTok{by\_reference =}\NormalTok{ T)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_stardust\_classes}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_features\_annotation}\NormalTok{(test1)}

\DocumentationTok{\#\# the default parameters}
\FunctionTok{cross\_filter\_stardust}\NormalTok{()}
\CommentTok{\# This is a simulated dataset with only 5 \textquotesingle{}features\textquotesingle{},}
\CommentTok{\# so the default parameters are meaningless for it.}

\CommentTok{\# Note that real datasets often contain thousands of "features"}
\CommentTok{\# and the following \textquotesingle{}min\_number\textquotesingle{} and \textquotesingle{}max\_ratio\textquotesingle{} parameter values are not suitable.}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{cross\_filter\_stardust}\NormalTok{(}
\NormalTok{  test1,}
  \AttributeTok{min\_number =} \DecValTok{2}\NormalTok{,}
  \AttributeTok{max\_ratio =} \DecValTok{1}
\NormalTok{)}
\DocumentationTok{\#\# see results}
\FunctionTok{stardust\_classes}\NormalTok{(test1)}
\DocumentationTok{\#\# or}
\FunctionTok{reference}\NormalTok{(test1)}\SpecialCharTok{$}\NormalTok{stardust\_classes}
\DocumentationTok{\#\# or}
\FunctionTok{reference}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(test1))}\SpecialCharTok{$}\NormalTok{stardust\_classes}

\NormalTok{e1 }\OtherTok{\textless{}{-}} \FunctionTok{stardust\_classes}\NormalTok{(test1)}

\DocumentationTok{\#\# see the filtered classes}
\FunctionTok{backtrack\_stardust}\NormalTok{(test1)}

\DocumentationTok{\#\# reset the \textquotesingle{}stardust\_classes\textquotesingle{}}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_stardust\_classes}\NormalTok{(test1)}

\DocumentationTok{\#\# customized filtering}
\CommentTok{\# Note that real datasets often contain thousands of "features"}
\CommentTok{\# and the following \textquotesingle{}min\_number\textquotesingle{} and \textquotesingle{}max\_ratio\textquotesingle{} parameter values are not suitable.}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{cross\_filter\_quantity}\NormalTok{(test1, }\AttributeTok{min\_number =} \DecValTok{2}\NormalTok{, }\AttributeTok{max\_ratio =} \DecValTok{1}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{cross\_filter\_score}\NormalTok{(test1,}
  \AttributeTok{types =} \StringTok{"tani.score"}\NormalTok{,}
  \AttributeTok{cutoff =} \FloatTok{0.3}\NormalTok{,}
  \AttributeTok{tolerance =} \FloatTok{0.6}
\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{cross\_filter\_identical}\NormalTok{(}
\NormalTok{  test1,}
  \AttributeTok{hierarchy\_range =} \FunctionTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{11}\NormalTok{),}
  \AttributeTok{identical\_factor =} \FloatTok{0.7}
\NormalTok{)}
\NormalTok{e2 }\OtherTok{\textless{}{-}} \FunctionTok{stardust\_classes}\NormalTok{(test1)}

\FunctionTok{identical}\NormalTok{(e1, e2)}

\DocumentationTok{\#\# reset}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_stardust\_classes}\NormalTok{(test1)}
\DocumentationTok{\#\# targeted plural attributes}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{cross\_filter\_stardust}\NormalTok{(}
\NormalTok{  test1,}
  \AttributeTok{min\_number =} \DecValTok{2}\NormalTok{,}
  \AttributeTok{max\_ratio =} \DecValTok{1}\NormalTok{,}
  \AttributeTok{types =} \FunctionTok{c}\NormalTok{(}\StringTok{"tani.score"}\NormalTok{, }\StringTok{"csi.score"}\NormalTok{),}
  \AttributeTok{cutoff =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.3}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{150}\NormalTok{),}
  \AttributeTok{tolerance =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.6}\NormalTok{, }\FloatTok{0.3}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-draw_nodes-methods.r}{%
\section{File: draw\_nodes-methods.R}\label{file-draw_nodes-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\NormalTok{test }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_5features}

\DocumentationTok{\#\# the previous steps}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(test)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(test1, }\AttributeTok{by\_reference =}\NormalTok{ T)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_stardust\_classes}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_features\_annotation}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{cross\_filter\_stardust}\NormalTok{(test1, }\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_nebula\_index}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{compute\_spectral\_similarity}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_nebulae}\NormalTok{(test1, }\FloatTok{0.01}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_layouts}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{activate\_nebulae}\NormalTok{(test1)}

\DocumentationTok{\#\# set features quantification data}
\NormalTok{ids }\OtherTok{\textless{}{-}} \FunctionTok{features\_annotation}\NormalTok{(test1)}\SpecialCharTok{$}\NormalTok{.features\_id}
\NormalTok{quant. }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{.features\_id =}\NormalTok{ ids,}
  \AttributeTok{sample\_1 =} \FunctionTok{rnorm}\NormalTok{(}\FunctionTok{length}\NormalTok{(ids), }\DecValTok{1000}\NormalTok{, }\DecValTok{200}\NormalTok{),}
  \AttributeTok{sample\_2 =} \FunctionTok{rnorm}\NormalTok{(}\FunctionTok{length}\NormalTok{(ids), }\DecValTok{2000}\NormalTok{, }\DecValTok{500}\NormalTok{)}
\NormalTok{)}
\NormalTok{metadata }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{sample =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"sample\_"}\NormalTok{, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{2}\NormalTok{),}
  \AttributeTok{group =} \FunctionTok{c}\NormalTok{(}\StringTok{"control"}\NormalTok{, }\StringTok{"model"}\NormalTok{)}
\NormalTok{)}
\FunctionTok{features\_quantification}\NormalTok{(test1) }\OtherTok{\textless{}{-}}\NormalTok{ quant.}
\FunctionTok{sample\_metadata}\NormalTok{(test1) }\OtherTok{\textless{}{-}}\NormalTok{ metadata}

\DocumentationTok{\#\# optional \textquotesingle{}nebula\_name\textquotesingle{}}
\FunctionTok{visualize}\NormalTok{(test1)}
\DocumentationTok{\#\# a class for example}
\NormalTok{class }\OtherTok{\textless{}{-}} \FunctionTok{visualize}\NormalTok{(test1)}\SpecialCharTok{$}\NormalTok{class.name[}\DecValTok{1}\NormalTok{]}
\NormalTok{tmp }\OtherTok{\textless{}{-}} \FunctionTok{export\_path}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{draw\_structures}\NormalTok{(test1, class)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{draw\_nodes}\NormalTok{(test1, class)}

\DocumentationTok{\#\# see results}
\NormalTok{grobs }\OtherTok{\textless{}{-}} \FunctionTok{nodes\_grob}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(test1))}
\NormalTok{grobs}
\NormalTok{grid}\SpecialCharTok{::}\FunctionTok{grid.draw}\NormalTok{(grobs[[}\DecValTok{1}\NormalTok{]])}
\DocumentationTok{\#\# visualize with ID of \textquotesingle{}feature\textquotesingle{} (.features\_id)}
\DocumentationTok{\#\# with legend}
\NormalTok{ids }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(grobs)}
\FunctionTok{x11}\NormalTok{(}\AttributeTok{width =} \DecValTok{9}\NormalTok{, }\AttributeTok{height =} \DecValTok{5}\NormalTok{)}
\FunctionTok{show\_node}\NormalTok{(test1, ids[}\DecValTok{1}\NormalTok{])}

\DocumentationTok{\#\# default parameters}
\FunctionTok{draw\_nodes}\NormalTok{()}

\FunctionTok{unlink}\NormalTok{(tmp, T, T)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-draw_structures-methods.r}{%
\section{File: draw\_structures-methods.R}\label{file-draw_structures-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\NormalTok{test }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_5features}

\DocumentationTok{\#\# the previous steps}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(test)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(test1, }\AttributeTok{by\_reference =}\NormalTok{ T)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_stardust\_classes}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_features\_annotation}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{cross\_filter\_stardust}\NormalTok{(test1, }\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_nebula\_index}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{compute\_spectral\_similarity}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_nebulae}\NormalTok{(test1, }\FloatTok{0.01}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_layouts}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{activate\_nebulae}\NormalTok{(test1)}

\DocumentationTok{\#\# optional \textquotesingle{}nebula\_name\textquotesingle{}}
\FunctionTok{visualize}\NormalTok{(test1)}
\DocumentationTok{\#\# a class for example}
\NormalTok{class }\OtherTok{\textless{}{-}} \FunctionTok{visualize}\NormalTok{(test1)}\SpecialCharTok{$}\NormalTok{class.name[}\DecValTok{1}\NormalTok{]}
\NormalTok{tmp }\OtherTok{\textless{}{-}} \FunctionTok{export\_path}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{draw\_structures}\NormalTok{(test1, class)}

\DocumentationTok{\#\# see results}
\NormalTok{grobs }\OtherTok{\textless{}{-}} \FunctionTok{structures\_grob}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(test1))}
\NormalTok{grobs}
\NormalTok{grid}\SpecialCharTok{::}\FunctionTok{grid.draw}\NormalTok{(grobs[[}\DecValTok{1}\NormalTok{]])}
\DocumentationTok{\#\# visualize with ID of \textquotesingle{}feature\textquotesingle{} (.features\_id)}
\NormalTok{ids }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(grobs)}
\FunctionTok{show\_structure}\NormalTok{(test1, ids[}\DecValTok{1}\NormalTok{])}

\FunctionTok{unlink}\NormalTok{(tmp, T, T)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-filter_formula-methods.r}{%
\section{File: filter\_formula-methods.R}\label{file-filter_formula-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\NormalTok{test }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_5features}

\DocumentationTok{\#\# filter chemical formula candidates}
\DocumentationTok{\#\# use default parameters}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(test)}
\FunctionTok{latest}\NormalTok{(test1)}

\DocumentationTok{\#\# the default parameters:}
\FunctionTok{filter\_formula}\NormalTok{()}

\DocumentationTok{\#\# customized filtering}
\DocumentationTok{\#\# according to score}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(test1, dplyr}\SpecialCharTok{::}\NormalTok{filter, zodiac.score }\SpecialCharTok{\textgreater{}} \FloatTok{0.5}\NormalTok{)}
\FunctionTok{latest}\NormalTok{(test1)}

\DocumentationTok{\#\# get top rank}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(test1, dplyr}\SpecialCharTok{::}\NormalTok{filter, rank.formula }\SpecialCharTok{\textless{}=} \DecValTok{3}\NormalTok{)}
\FunctionTok{latest}\NormalTok{(test1)}

\DocumentationTok{\#\# complex filtering}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(}
\NormalTok{  test1, dplyr}\SpecialCharTok{::}\NormalTok{filter,}
  \DocumentationTok{\#\# molecular formula}
  \SpecialCharTok{!}\FunctionTok{grepl}\NormalTok{(}\StringTok{"N"}\NormalTok{, mol.formula),}
  \DocumentationTok{\#\# mass error}
  \FunctionTok{abs}\NormalTok{(error.mass) }\SpecialCharTok{\textless{}} \FloatTok{0.001}
\NormalTok{)}
\FunctionTok{latest}\NormalTok{(test1)}

\DocumentationTok{\#\# select columns}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(test1, dplyr}\SpecialCharTok{::}\NormalTok{select, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{)}
\FunctionTok{latest}\NormalTok{(test1)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-filter_ppcp-methods.r}{%
\section{File: filter\_ppcp-methods.R}\label{file-filter_ppcp-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\NormalTok{test }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_5features}

\DocumentationTok{\#\# filter chemical class candidates}
\DocumentationTok{\#\# the default parameters:}
\FunctionTok{filter\_ppcp}\NormalTok{()}

\DocumentationTok{\#\# if \textquotesingle{}by\_reference\textquotesingle{} set with TRUE, \textquotesingle{}create\_reference\textquotesingle{} should be}
\DocumentationTok{\#\# run previously.}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_ppcp}\NormalTok{(test, }\AttributeTok{by\_reference =}\NormalTok{ F)}
\FunctionTok{latest}\NormalTok{(test1)}

\DocumentationTok{\#\# customized filtering}
\DocumentationTok{\#\# according to score}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_ppcp}\NormalTok{(test1, dplyr}\SpecialCharTok{::}\NormalTok{filter, pp.value }\SpecialCharTok{\textgreater{}} \FloatTok{0.5}\NormalTok{,}
                     \AttributeTok{by\_reference =}\NormalTok{ F)}
\FunctionTok{latest}\NormalTok{(test1)}

\DocumentationTok{\#\# complex filtering}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_ppcp}\NormalTok{(}
\NormalTok{  test1, dplyr}\SpecialCharTok{::}\NormalTok{filter,}
  \DocumentationTok{\#\# PPCP value}
\NormalTok{  pp.value }\SpecialCharTok{\textgreater{}} \FloatTok{0.5}\NormalTok{,}
  \DocumentationTok{\#\# speicifid class}
\NormalTok{  class.name }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"Azoles"}\NormalTok{),}
  \AttributeTok{by\_reference =}\NormalTok{ F}
\NormalTok{)}
\FunctionTok{latest}\NormalTok{(test1)}

\DocumentationTok{\#\# select columns}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_ppcp}\NormalTok{(test1, dplyr}\SpecialCharTok{::}\NormalTok{select, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{,}
                     \AttributeTok{by\_reference =}\NormalTok{ F)}
\FunctionTok{latest}\NormalTok{(test1)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-filter_structure-methods.r}{%
\section{File: filter\_structure-methods.R}\label{file-filter_structure-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\NormalTok{test }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_5features}

\DocumentationTok{\#\# filter chemical structure candidates}
\DocumentationTok{\#\# use default parameters}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(test)}
\FunctionTok{latest}\NormalTok{(test1)}

\DocumentationTok{\#\# the default parameters:}
\FunctionTok{filter\_structure}\NormalTok{()}

\DocumentationTok{\#\# customized filtering}
\DocumentationTok{\#\# according to score}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(test1, dplyr}\SpecialCharTok{::}\NormalTok{filter, tani.score }\SpecialCharTok{\textgreater{}} \FloatTok{0.4}\NormalTok{)}
\FunctionTok{latest}\NormalTok{(test1)}

\DocumentationTok{\#\# get top rank}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(test1, dplyr}\SpecialCharTok{::}\NormalTok{filter, rank.structure }\SpecialCharTok{\textless{}=} \DecValTok{3}\NormalTok{)}
\FunctionTok{latest}\NormalTok{(test1)}

\DocumentationTok{\#\# complex filtering}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(}
\NormalTok{  test1, dplyr}\SpecialCharTok{::}\NormalTok{filter,}
  \DocumentationTok{\#\# molecular formula}
  \SpecialCharTok{!}\FunctionTok{grepl}\NormalTok{(}\StringTok{"N"}\NormalTok{, mol.formula),}
  \DocumentationTok{\#\# Tanimoto similarity}
\NormalTok{  tani.score }\SpecialCharTok{\textgreater{}} \FloatTok{0.4}
\NormalTok{)}
\FunctionTok{latest}\NormalTok{(test1)}

\DocumentationTok{\#\# select columns}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(test1, dplyr}\SpecialCharTok{::}\NormalTok{select, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{)}
\FunctionTok{latest}\NormalTok{(test1)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-fun_modify.r}{%
\section{File: fun\_modify.R}\label{file-fun_modify.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-gather_sections.r}{%
\section{File: gather\_sections.R}\label{file-gather_sections.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-ggset-class.r}{%
\section{File: ggset-class.R}\label{file-ggset-class.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{x =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, }\AttributeTok{y =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{)}
\NormalTok{layer1 }\OtherTok{\textless{}{-}} \FunctionTok{new\_command}\NormalTok{(ggplot, data)}
\NormalTok{layer2 }\OtherTok{\textless{}{-}} \FunctionTok{new\_command}\NormalTok{(geom\_point, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y))}
\NormalTok{layer3 }\OtherTok{\textless{}{-}} \FunctionTok{new\_command}\NormalTok{(labs, }\AttributeTok{x =} \StringTok{"x label"}\NormalTok{, }\AttributeTok{y =} \StringTok{"y label"}\NormalTok{)}
\NormalTok{layer4 }\OtherTok{\textless{}{-}} \FunctionTok{new\_command}\NormalTok{(theme, }\AttributeTok{text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{family =} \StringTok{"Times"}\NormalTok{))}

\DocumentationTok{\#\# gather}
\NormalTok{ggset }\OtherTok{\textless{}{-}} \FunctionTok{new\_ggset}\NormalTok{(layer1, layer2, layer3, layer4)}
\NormalTok{ggset}
\DocumentationTok{\#\# visualize}
\NormalTok{p }\OtherTok{\textless{}{-}} \FunctionTok{call\_command}\NormalTok{(ggset)}
\NormalTok{p}

\DocumentationTok{\#\# add layers}
\NormalTok{layer5 }\OtherTok{\textless{}{-}} \FunctionTok{new\_command}\NormalTok{(}
\NormalTok{  geom\_text,}
  \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y, }\AttributeTok{label =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"label\_"}\NormalTok{, x))}
\NormalTok{)}
\NormalTok{layer6 }\OtherTok{\textless{}{-}} \FunctionTok{new\_command}\NormalTok{(ggtitle, }\StringTok{"this is title"}\NormalTok{)}
\NormalTok{ggset }\OtherTok{\textless{}{-}} \FunctionTok{add\_layers}\NormalTok{(ggset, layer5, layer6)}
\FunctionTok{call\_command}\NormalTok{(ggset)}

\DocumentationTok{\#\# delete layers}
\NormalTok{ggset }\OtherTok{\textless{}{-}} \FunctionTok{delete\_layers}\NormalTok{(ggset, }\DecValTok{5}\SpecialCharTok{:}\DecValTok{6}\NormalTok{)}
\FunctionTok{call\_command}\NormalTok{(ggset)}

\DocumentationTok{\#\# mutate layer}
\NormalTok{ggset }\OtherTok{\textless{}{-}} \FunctionTok{mutate\_layer}\NormalTok{(ggset, }\StringTok{"theme"}\NormalTok{,}
  \AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{,}
  \AttributeTok{plot.background =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{"red"}\NormalTok{)}
\NormalTok{)}
\NormalTok{ggset }\OtherTok{\textless{}{-}} \FunctionTok{mutate\_layer}\NormalTok{(ggset, }\StringTok{"geom\_point"}\NormalTok{,}
  \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y, }\AttributeTok{color =}\NormalTok{ x)}
\NormalTok{)}
\FunctionTok{call\_command}\NormalTok{(ggset)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-history_rblock-methods.r}{%
\section{File: history\_rblock-methods.R}\label{file-history_rblock-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \DecValTok{1}
\NormalTok{test2 }\OtherTok{\textless{}{-}} \DecValTok{2}
\NormalTok{test3 }\OtherTok{\textless{}{-}} \DecValTok{3}

\NormalTok{block }\OtherTok{\textless{}{-}} \FunctionTok{history\_rblock}\NormalTok{(, }\StringTok{"\^{}test1"}\NormalTok{, }\StringTok{"\^{}test3"}\NormalTok{)}
\NormalTok{block}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-include_figure-methods.r}{%
\section{File: include\_figure-methods.R}\label{file-include_figure-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\NormalTok{tmp }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"/test.pdf"}\NormalTok{)}
\FunctionTok{pdf}\NormalTok{(tmp)}
\FunctionTok{plot}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{)}
\FunctionTok{dev.off}\NormalTok{()}

\NormalTok{fig\_block }\OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(}
\NormalTok{  tmp, }\StringTok{"plot"}\NormalTok{, }\StringTok{"This is caption"}
\NormalTok{)}
\NormalTok{fig\_block}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-include_table-methods.r}{%
\section{File: include\_table-methods.R}\label{file-include_table-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{x =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, }\AttributeTok{y =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{)}
\NormalTok{tab\_block }\OtherTok{\textless{}{-}} \FunctionTok{include\_table}\NormalTok{(}
\NormalTok{  data, }\StringTok{"table1"}\NormalTok{,}
  \StringTok{"This is caption"}
\NormalTok{)}
\NormalTok{tab\_block}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-initialize_mcnebula-methods.r}{%
\section{File: initialize\_mcnebula-methods.R}\label{file-initialize_mcnebula-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\DocumentationTok{\#\# The raw data used for the example}
\NormalTok{tmp }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"/temp\_data"}\NormalTok{)}
\FunctionTok{dir.create}\NormalTok{(tmp)}
\NormalTok{eg.path }\OtherTok{\textless{}{-}} \FunctionTok{system.file}\NormalTok{(}\StringTok{"extdata"}\NormalTok{, }\StringTok{"raw\_instance.tar.gz"}\NormalTok{,}
                       \AttributeTok{package =} \StringTok{"MCnebula2"}\NormalTok{)}

\NormalTok{utils}\SpecialCharTok{::}\FunctionTok{untar}\NormalTok{(eg.path, }\AttributeTok{exdir =}\NormalTok{ tmp)}

\DocumentationTok{\#\# initialize \textquotesingle{}mcnebula\textquotesingle{} object}
\NormalTok{test }\OtherTok{\textless{}{-}} \FunctionTok{mcnebula}\NormalTok{()}
\NormalTok{test }\OtherTok{\textless{}{-}} \FunctionTok{initialize\_mcnebula}\NormalTok{(test, }\StringTok{"sirius.v4"}\NormalTok{, tmp)}
\DocumentationTok{\#\# check the setting}
\FunctionTok{export\_path}\NormalTok{(test)}
\FunctionTok{palette\_set}\NormalTok{(test)}
\FunctionTok{ion\_mode}\NormalTok{(test)}
\FunctionTok{project\_version}\NormalTok{(test)}

\DocumentationTok{\#\# initialize \textquotesingle{}melody\textquotesingle{} object}
\NormalTok{test }\OtherTok{\textless{}{-}} \FunctionTok{new}\NormalTok{(}\StringTok{"melody"}\NormalTok{)}
\NormalTok{test }\OtherTok{\textless{}{-}} \FunctionTok{initialize\_mcnebula}\NormalTok{(test)}
\DocumentationTok{\#\# check...}
\FunctionTok{palette\_stat}\NormalTok{(test)}

\DocumentationTok{\#\# initialize \textquotesingle{}project\_conformation\textquotesingle{} object}
\NormalTok{test }\OtherTok{\textless{}{-}} \FunctionTok{new}\NormalTok{(}\StringTok{"project\_conformation"}\NormalTok{)}
\NormalTok{test }\OtherTok{\textless{}{-}} \FunctionTok{initialize\_mcnebula}\NormalTok{(test, }\StringTok{"sirius.v4"}\NormalTok{)}
\DocumentationTok{\#\# check}
\FunctionTok{file\_name}\NormalTok{(test)}

\DocumentationTok{\#\# initialize \textquotesingle{}project\_api\textquotesingle{} object}
\NormalTok{test }\OtherTok{\textless{}{-}} \FunctionTok{new}\NormalTok{(}\StringTok{"project\_api"}\NormalTok{)}
\NormalTok{test }\OtherTok{\textless{}{-}} \FunctionTok{initialize\_mcnebula}\NormalTok{(test, }\StringTok{"sirius.v4"}\NormalTok{)}
\DocumentationTok{\#\# check}
\FunctionTok{methods\_format}\NormalTok{(test)}

\FunctionTok{unlink}\NormalTok{(tmp, T, T)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-mcn_dataset-class.r}{%
\section{File: mcn\_dataset-class.R}\label{file-mcn_dataset-class.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-mcnebula-class.r}{%
\section{File: mcnebula-class.R}\label{file-mcnebula-class.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\NormalTok{test }\OtherTok{\textless{}{-}} \FunctionTok{mcnebula}\NormalTok{()}
\FunctionTok{class}\NormalTok{(test)}

\NormalTok{test }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_5features}
\DocumentationTok{\#\# slots}
\FunctionTok{ion\_mode}\NormalTok{(test)}
\FunctionTok{project\_version}\NormalTok{(test)}
\FunctionTok{melody}\NormalTok{(test)}
\FunctionTok{export\_name}\NormalTok{(test)}
\DocumentationTok{\#\# ...}

\DocumentationTok{\#\# \textquotesingle{}fast channel\textquotesingle{}}
\FunctionTok{palette\_label}\NormalTok{(test)}
\FunctionTok{palette\_stat}\NormalTok{(test)}
\FunctionTok{sample\_metadata}\NormalTok{(test)}
\DocumentationTok{\#\# ...}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-melody-class.r}{%
\section{File: melody-class.R}\label{file-melody-class.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-msframe-class.r}{%
\section{File: msframe-class.R}\label{file-msframe-class.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-nebula-class.r}{%
\section{File: nebula-class.R}\label{file-nebula-class.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-plot_msms_mirrors.r}{%
\section{File: plot\_msms\_mirrors.R}\label{file-plot_msms_mirrors.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-project_api-class.r}{%
\section{File: project\_api-class.R}\label{file-project_api-class.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-project_conformation-class.r}{%
\section{File: project\_conformation-class.R}\label{file-project_conformation-class.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-project_dataset-class.r}{%
\section{File: project\_dataset-class.R}\label{file-project_dataset-class.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-project_metadata-class.r}{%
\section{File: project\_metadata-class.R}\label{file-project_metadata-class.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-project-class.r}{%
\section{File: project-class.R}\label{file-project-class.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-rblock.r}{%
\section{File: rblock.R}\label{file-rblock.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{  test1 }\OtherTok{\textless{}{-}} \DecValTok{1}
\NormalTok{  test2 }\OtherTok{\textless{}{-}} \DecValTok{2}
\NormalTok{  test3 }\OtherTok{\textless{}{-}} \DecValTok{3}
\NormalTok{\})}

\FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{  test }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_5features}
  \DocumentationTok{\#\# this annotation line would be ignored}
\NormalTok{  test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(test)}
\NormalTok{  test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(test1)}
\NormalTok{  test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(test1, }\AttributeTok{by\_reference=}\NormalTok{T)}
\NormalTok{  test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_stardust\_classes}\NormalTok{(test1)}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-render_report.r}{%
\section{File: render\_report.R}\label{file-render_report.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-report-class.r}{%
\section{File: report-class.R}\label{file-report-class.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\NormalTok{s1 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Title 1"}\NormalTok{, }\DecValTok{1}\NormalTok{)}

\NormalTok{s1}\FloatTok{.5} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"..."}\NormalTok{), }\ConstantTok{NULL}
\NormalTok{)}

\NormalTok{s2 }\OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"This is sentence 1."}\NormalTok{,}
    \StringTok{"This is sentence 2."}\NormalTok{,}
    \StringTok{"This is sentence 3."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{x =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, }\AttributeTok{y =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{)}
\NormalTok{    df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(df,}
      \AttributeTok{group =} \FunctionTok{rep}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"p"}\NormalTok{, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{3}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{))}
\NormalTok{    )}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s3 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Title 2"}\NormalTok{, }\DecValTok{1}\NormalTok{)}

\NormalTok{s4 }\OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"This is a paragraph..."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    p }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(df) }\SpecialCharTok{+}
      \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y, }\AttributeTok{fill =}\NormalTok{ group))}
    \FunctionTok{ggsave}\NormalTok{(f }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"/test.pdf"}\NormalTok{), p)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s5 }\OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(f, }\StringTok{"name"}\NormalTok{, }\StringTok{"Caption: ..."}\NormalTok{)}

\NormalTok{s6 }\OtherTok{\textless{}{-}} \FunctionTok{rblock}\NormalTok{(\{}
  \FunctionTok{print}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{100}\NormalTok{)}
\NormalTok{\}, }\AttributeTok{args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{echo =}\NormalTok{ F, }\AttributeTok{eval =}\NormalTok{ F))}

\NormalTok{s7 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"... paragraph ..."}\NormalTok{)}

\NormalTok{sections }\OtherTok{\textless{}{-}} \FunctionTok{gather\_sections}\NormalTok{()}
\NormalTok{report }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(new\_report, sections)}
\FunctionTok{render\_report}\NormalTok{(report, }\FunctionTok{paste0}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"/report.Rmd"}\NormalTok{), T)}

\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\DocumentationTok{\#\#\#\#\# Another example}
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}

\NormalTok{h1 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"heading, level 1"}\NormalTok{, }\DecValTok{1}\NormalTok{)}

\NormalTok{sec1 }\OtherTok{\textless{}{-}} \FunctionTok{new\_section}\NormalTok{(}
  \StringTok{"sub{-}heading"}\NormalTok{, }\DecValTok{2}\NormalTok{,}
  \StringTok{"This is a description."}\NormalTok{,}
  \FunctionTok{new\_code\_block}\NormalTok{(}\AttributeTok{codes =} \StringTok{"seq \textless{}{-} lapply(1:10, cat)"}\NormalTok{)}
\NormalTok{)}

\NormalTok{h2 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"heading 2, level 1"}\NormalTok{, }\DecValTok{1}\NormalTok{)}

\NormalTok{fig\_block }\OtherTok{\textless{}{-}} \FunctionTok{new\_code\_block\_figure}\NormalTok{(}\StringTok{"plot"}\NormalTok{, }\StringTok{"this is a caption"}\NormalTok{,}
  \AttributeTok{codes =} \StringTok{"df \textless{}{-} data.frame(x = 1:10, y = 1:10)}
\StringTok{    p \textless{}{-} ggplot(df) +}
\StringTok{      geom\_point(aes(x = x, y = y))}
\StringTok{    p"}
\NormalTok{)}
\NormalTok{sec2 }\OtherTok{\textless{}{-}} \FunctionTok{new\_section}\NormalTok{(}
  \StringTok{"sub{-}heading2"}\NormalTok{, }\DecValTok{2}\NormalTok{,}
  \FunctionTok{paste0}\NormalTok{(}
    \StringTok{"This is a description. "}\NormalTok{,}
    \StringTok{"See Figure "}\NormalTok{, }\FunctionTok{get\_ref}\NormalTok{(fig\_block), }\StringTok{"."}
\NormalTok{  ),}
\NormalTok{  fig\_block}
\NormalTok{)}

\NormalTok{a\_data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\NormalTok{storms[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{15}\NormalTok{, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{]}
\NormalTok{table\_block }\OtherTok{\textless{}{-}} \FunctionTok{include\_table}\NormalTok{(a\_data, }\StringTok{"table1"}\NormalTok{, }\StringTok{"This is a caption"}\NormalTok{)}

\NormalTok{sec3 }\OtherTok{\textless{}{-}} \FunctionTok{new\_section}\NormalTok{(}
  \ConstantTok{NULL}\NormalTok{, ,}
  \FunctionTok{paste0}\NormalTok{(}\StringTok{"See Table "}\NormalTok{, }\FunctionTok{get\_ref}\NormalTok{(table\_block, }\StringTok{"tab"}\NormalTok{), }\StringTok{"."}\NormalTok{),}
  \ConstantTok{NULL}
\NormalTok{)}

\NormalTok{tmp\_p }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"/test.pdf"}\NormalTok{)}
\FunctionTok{pdf}\NormalTok{(tmp\_p)}
\FunctionTok{plot}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{)}
\FunctionTok{dev.off}\NormalTok{()}
\NormalTok{fig\_block\_2 }\OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(tmp\_p, }\StringTok{"plot2"}\NormalTok{, }\StringTok{"this is a caption"}\NormalTok{)}
\NormalTok{sec4 }\OtherTok{\textless{}{-}} \FunctionTok{history\_rblock}\NormalTok{(, }\StringTok{"\^{}tmp\_p \textless{}{-} "}\NormalTok{, }\StringTok{"\^{}fig\_block\_2"}\NormalTok{)}
\NormalTok{sec4}

\DocumentationTok{\#\# gather}
\NormalTok{yaml }\OtherTok{\textless{}{-}} \StringTok{"title: \textquotesingle{}title\textquotesingle{}}\SpecialCharTok{\textbackslash{}n}\StringTok{output:}\SpecialCharTok{\textbackslash{}n}\StringTok{  bookdown::pdf\_document2"}
\NormalTok{report }\OtherTok{\textless{}{-}} \FunctionTok{new\_report}\NormalTok{(}
\NormalTok{  h1, sec1, h2, sec2,}
\NormalTok{  table\_block, sec3,}
\NormalTok{  fig\_block\_2, sec4,}
  \AttributeTok{yaml =}\NormalTok{ yaml}
\NormalTok{)}
\NormalTok{report}

\DocumentationTok{\#\# output}
\NormalTok{tmp }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"/tmp\_output.Rmd"}\NormalTok{)}
\FunctionTok{render\_report}\NormalTok{(report, tmp)}
\NormalTok{rmarkdown}\SpecialCharTok{::}\FunctionTok{render}\NormalTok{(tmp)}
\FunctionTok{file.exists}\NormalTok{(}\FunctionTok{sub}\NormalTok{(}\StringTok{"Rmd$"}\NormalTok{, }\StringTok{"pdf"}\NormalTok{, tmp))}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-section-class.r}{%
\section{File: section-class.R}\label{file-section-class.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\DocumentationTok{\#\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} }
\DocumentationTok{\#\# heading}
\FunctionTok{new\_heading}\NormalTok{(}\StringTok{"this is a heading"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\DocumentationTok{\#\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} }
\DocumentationTok{\#\# section}
\DocumentationTok{\#\# example 1}
\NormalTok{para }\OtherTok{\textless{}{-}} \StringTok{"This is a paragraph stating"}
\NormalTok{section }\OtherTok{\textless{}{-}} \FunctionTok{new\_section}\NormalTok{(}\StringTok{"this is a heading"}\NormalTok{, }\DecValTok{2}\NormalTok{, para)}
\DocumentationTok{\#\# see results}
\NormalTok{section}
\FunctionTok{call\_command}\NormalTok{(section)}
\FunctionTok{writeLines}\NormalTok{(}\FunctionTok{call\_command}\NormalTok{(section))}

\DocumentationTok{\#\# example 2}
\NormalTok{para }\OtherTok{\textless{}{-}} \StringTok{"This is a paragraph stating"}
\NormalTok{section }\OtherTok{\textless{}{-}} \FunctionTok{new\_section}\NormalTok{(}\ConstantTok{NULL}\NormalTok{, , para, }\ConstantTok{NULL}\NormalTok{)}

\DocumentationTok{\#\# example 3}
\NormalTok{para }\OtherTok{\textless{}{-}} \StringTok{"This is a paragraph stating"}
\NormalTok{block }\OtherTok{\textless{}{-}} \FunctionTok{new\_code\_block}\NormalTok{(}\AttributeTok{codes =} \StringTok{"df \textless{}{-} data.frame(x = 1:10)"}\NormalTok{)}
\NormalTok{section }\OtherTok{\textless{}{-}} \FunctionTok{new\_section}\NormalTok{(}\StringTok{"heading"}\NormalTok{, }\DecValTok{2}\NormalTok{, para, block)}
\NormalTok{section}

\DocumentationTok{\#\# example 4}
\NormalTok{codes }\OtherTok{\textless{}{-}} \StringTok{"df \textless{}{-} data.frame(x = 1:10, y = 1:10)}
\StringTok{  p \textless{}{-} ggplot(df) +}
\StringTok{    geom\_point(aes(x = x, y = y))}
\StringTok{  p"}
\NormalTok{fig\_block }\OtherTok{\textless{}{-}} \FunctionTok{new\_code\_block\_figure}\NormalTok{(}\StringTok{"plot"}\NormalTok{, }\StringTok{"this is caption"}\NormalTok{, }\AttributeTok{codes =}\NormalTok{ codes)}
\NormalTok{para }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"This is a paragraph describing the picture. "}\NormalTok{,}
               \StringTok{"See Figure "}\NormalTok{, }\FunctionTok{get\_ref}\NormalTok{(fig\_block), }\StringTok{"."}\NormalTok{)}
\NormalTok{section }\OtherTok{\textless{}{-}} \FunctionTok{new\_section}\NormalTok{(}\StringTok{"heading"}\NormalTok{, }\DecValTok{2}\NormalTok{, para, fig\_block)}
\NormalTok{section}
\DocumentationTok{\#\# output}
\NormalTok{tmp }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"/tmp\_output.Rmd"}\NormalTok{)}
\FunctionTok{writeLines}\NormalTok{(}\FunctionTok{call\_command}\NormalTok{(section), tmp)}
\NormalTok{rmarkdown}\SpecialCharTok{::}\FunctionTok{render}\NormalTok{(tmp, }\AttributeTok{output\_format =} \StringTok{"bookdown::pdf\_document2"}\NormalTok{)}
\FunctionTok{file.exists}\NormalTok{(}\FunctionTok{sub}\NormalTok{(}\StringTok{"Rmd$"}\NormalTok{, }\StringTok{"pdf"}\NormalTok{, tmp))}
\DocumentationTok{\#\# see [report{-}class] object: }
\DocumentationTok{\#\# A complete output report, including multiple \textquotesingle{}section\textquotesingle{}.}

\DocumentationTok{\#\# defalt parameters}
\FunctionTok{new\_section}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-set_nodes_color-methods.r}{%
\section{File: set\_nodes\_color-methods.R}\label{file-set_nodes_color-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\NormalTok{test }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_5features}

\DocumentationTok{\#\# the previous steps}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(test)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(test1, }\AttributeTok{by\_reference =}\NormalTok{ T)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_stardust\_classes}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_features\_annotation}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{cross\_filter\_stardust}\NormalTok{(test1, }\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_nebula\_index}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{compute\_spectral\_similarity}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_parent\_nebula}\NormalTok{(test1, }\FloatTok{0.01}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_nebulae}\NormalTok{(test1, }\FloatTok{0.01}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_parent\_layout}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_layouts}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{activate\_nebulae}\NormalTok{(test1)}

\NormalTok{ids }\OtherTok{\textless{}{-}} \FunctionTok{features\_annotation}\NormalTok{(test1)}\SpecialCharTok{$}\NormalTok{.features\_id}
\NormalTok{extra\_data }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{.features\_id =}\NormalTok{ ids,}
  \AttributeTok{attr\_1 =} \FunctionTok{rnorm}\NormalTok{(}\FunctionTok{length}\NormalTok{(ids), }\DecValTok{100}\NormalTok{, }\DecValTok{50}\NormalTok{),}
  \AttributeTok{attr\_2 =} \FunctionTok{sample}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"special"}\NormalTok{, }\StringTok{"normal"}\NormalTok{), }\DecValTok{5}\NormalTok{, }\AttributeTok{replace =}\NormalTok{ T)}
\NormalTok{)}

\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{set\_nodes\_color}\NormalTok{(test1, }\StringTok{"attr\_1"}\NormalTok{, extra\_data)}
\FunctionTok{visualize}\NormalTok{(test1, }\DecValTok{1}\NormalTok{)}
\FunctionTok{visualize\_all}\NormalTok{(test1)}
\DocumentationTok{\#\# set labal of the legend}
\FunctionTok{export\_name}\NormalTok{(test1) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \FunctionTok{export\_name}\NormalTok{(test1),}
  \AttributeTok{attr\_1 =} \StringTok{"Continuous attribute"}\NormalTok{,}
  \AttributeTok{attr\_2 =} \StringTok{"Discrete attribute"}
\NormalTok{)}
\FunctionTok{visualize\_all}\NormalTok{(test1)}

\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{set\_nodes\_color}\NormalTok{(test1, }\StringTok{"attr\_2"}\NormalTok{, extra\_data)}
\FunctionTok{visualize}\NormalTok{(test1, }\DecValTok{1}\NormalTok{)}
\FunctionTok{visualize\_all}\NormalTok{(test1)}

\DocumentationTok{\#\# set colors for \textquotesingle{}tracer\textquotesingle{}}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{set\_tracer}\NormalTok{(test1, ids[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{2}\NormalTok{])}
\DocumentationTok{\#\# re{-}build Child{-}Nebulae}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_nebulae}\NormalTok{(test1, }\FloatTok{0.01}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_layouts}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{activate\_nebulae}\NormalTok{(test1)}
\DocumentationTok{\#\# set color}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{set\_nodes\_color}\NormalTok{(test1, }\AttributeTok{use\_tracer =}\NormalTok{ T)}
\FunctionTok{visualize\_all}\NormalTok{(test1)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-set_ppcp_data-methods.r}{%
\section{File: set\_ppcp\_data-methods.R}\label{file-set_ppcp_data-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\NormalTok{test }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_5features}

\DocumentationTok{\#\# the previous steps}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(test)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(test1, }\AttributeTok{by\_reference =}\NormalTok{ T)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_stardust\_classes}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_features\_annotation}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{cross\_filter\_stardust}\NormalTok{(test1, }\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_nebula\_index}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{compute\_spectral\_similarity}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_nebulae}\NormalTok{(test1, }\FloatTok{0.01}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_layouts}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{activate\_nebulae}\NormalTok{(test1)}

\DocumentationTok{\#\# optional \textquotesingle{}nebula\_name\textquotesingle{}}
\FunctionTok{visualize}\NormalTok{(test1)}
\DocumentationTok{\#\# a class for example}
\NormalTok{class }\OtherTok{\textless{}{-}} \FunctionTok{visualize}\NormalTok{(test1)}\SpecialCharTok{$}\NormalTok{class.name[}\DecValTok{1}\NormalTok{]}
\NormalTok{tmp }\OtherTok{\textless{}{-}} \FunctionTok{export\_path}\NormalTok{(test1)}
\DocumentationTok{\#\# customize the chemical classes displayed}
\DocumentationTok{\#\# in the radial bar plot in node.}
\NormalTok{classes }\OtherTok{\textless{}{-}} \FunctionTok{classification}\NormalTok{(test1)}
\DocumentationTok{\#\# get some random classes}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\NormalTok{classes }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(classes}\SpecialCharTok{$}\NormalTok{class.name, }\DecValTok{50}\NormalTok{)}
\NormalTok{classes}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{set\_ppcp\_data}\NormalTok{(test1, classes)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{draw\_nodes}\NormalTok{(test1, class,}
  \AttributeTok{add\_structure =}\NormalTok{ F,}
  \AttributeTok{add\_ration =}\NormalTok{ F}
\NormalTok{)}

\DocumentationTok{\#\# visualize with ID of \textquotesingle{}feature\textquotesingle{} (.features\_id)}
\DocumentationTok{\#\# with legend}
\NormalTok{ids }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(}\FunctionTok{nodes\_grob}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(test1)))}
\FunctionTok{x11}\NormalTok{(}\AttributeTok{width =} \DecValTok{15}\NormalTok{, }\AttributeTok{height =} \DecValTok{5}\NormalTok{)}
\FunctionTok{show\_node}\NormalTok{(test1, ids[}\DecValTok{1}\NormalTok{])}

\DocumentationTok{\#\# get a function to generate default parameters}
\FunctionTok{set\_ppcp\_data}\NormalTok{()}
\DocumentationTok{\#\# the default parameters}
\FunctionTok{set\_ppcp\_data}\NormalTok{()(test1)}

\FunctionTok{unlink}\NormalTok{(tmp, T, T)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-set_ration_data-methods.r}{%
\section{File: set\_ration\_data-methods.R}\label{file-set_ration_data-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\NormalTok{test }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_5features}

\DocumentationTok{\#\# the previous steps}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(test)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(test1, }\AttributeTok{by\_reference =}\NormalTok{ T)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_stardust\_classes}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_features\_annotation}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{cross\_filter\_stardust}\NormalTok{(test1, }\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_nebula\_index}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{compute\_spectral\_similarity}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_nebulae}\NormalTok{(test1, }\FloatTok{0.01}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_layouts}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{activate\_nebulae}\NormalTok{(test1)}

\DocumentationTok{\#\# set features quantification data}
\NormalTok{ids }\OtherTok{\textless{}{-}} \FunctionTok{features\_annotation}\NormalTok{(test1)}\SpecialCharTok{$}\NormalTok{.features\_id}
\NormalTok{quant. }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{.features\_id =}\NormalTok{ ids,}
  \AttributeTok{sample\_1 =} \FunctionTok{rnorm}\NormalTok{(}\FunctionTok{length}\NormalTok{(ids), }\DecValTok{1000}\NormalTok{, }\DecValTok{200}\NormalTok{),}
  \AttributeTok{sample\_2 =} \FunctionTok{rnorm}\NormalTok{(}\FunctionTok{length}\NormalTok{(ids), }\DecValTok{2000}\NormalTok{, }\DecValTok{500}\NormalTok{)}
\NormalTok{)}
\NormalTok{quant. }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(quant.,}
  \AttributeTok{sample\_3 =}\NormalTok{ sample\_1 }\SpecialCharTok{*} \FloatTok{1.5}\NormalTok{,}
  \AttributeTok{sample\_4 =}\NormalTok{ sample\_2 }\SpecialCharTok{*} \DecValTok{5}
\NormalTok{)}
\NormalTok{metadata }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{sample =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"sample\_"}\NormalTok{, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{4}\NormalTok{),}
  \AttributeTok{group =} \FunctionTok{rep}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"control"}\NormalTok{, }\StringTok{"model"}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{))}
\NormalTok{)}
\FunctionTok{features\_quantification}\NormalTok{(test1) }\OtherTok{\textless{}{-}}\NormalTok{ quant.}
\FunctionTok{sample\_metadata}\NormalTok{(test1) }\OtherTok{\textless{}{-}}\NormalTok{ metadata}

\DocumentationTok{\#\# a more convenient way to obtain simulation data}
\CommentTok{\# test1 \textless{}{-} MCnebula2:::.simulate\_quant\_set(test1)}

\DocumentationTok{\#\# optional \textquotesingle{}nebula\_name\textquotesingle{}}
\FunctionTok{visualize}\NormalTok{(test1)}
\DocumentationTok{\#\# a class for example}
\NormalTok{class }\OtherTok{\textless{}{-}} \FunctionTok{visualize}\NormalTok{(test1)}\SpecialCharTok{$}\NormalTok{class.name[}\DecValTok{1}\NormalTok{]}
\NormalTok{tmp }\OtherTok{\textless{}{-}} \FunctionTok{export\_path}\NormalTok{(test1)}

\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{set\_ration\_data}\NormalTok{(test1, }\AttributeTok{mean =}\NormalTok{ F)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{draw\_nodes}\NormalTok{(test1, class,}
  \AttributeTok{add\_structure =}\NormalTok{ F,}
  \AttributeTok{add\_ppcp =}\NormalTok{ F}
\NormalTok{)}

\DocumentationTok{\#\# visualize with ID of \textquotesingle{}feature\textquotesingle{} (.features\_id)}
\DocumentationTok{\#\# with legend}
\NormalTok{ids }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(}\FunctionTok{nodes\_grob}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(test1)))}
\FunctionTok{x11}\NormalTok{(}\AttributeTok{width =} \DecValTok{15}\NormalTok{, }\AttributeTok{height =} \DecValTok{5}\NormalTok{)}
\FunctionTok{show\_node}\NormalTok{(test1, ids[}\DecValTok{1}\NormalTok{])}

\DocumentationTok{\#\# the default parameters}
\FunctionTok{set\_ration\_data}\NormalTok{()}

\FunctionTok{unlink}\NormalTok{(tmp, T, T)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-set_tracer-methods.r}{%
\section{File: set\_tracer-methods.R}\label{file-set_tracer-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\NormalTok{test }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_5features}

\DocumentationTok{\#\# the previous steps}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(test)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(test1, }\AttributeTok{by\_reference =}\NormalTok{ T)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_stardust\_classes}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_features\_annotation}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{cross\_filter\_stardust}\NormalTok{(test1, }\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_nebula\_index}\NormalTok{(test1)}

\NormalTok{ids }\OtherTok{\textless{}{-}} \FunctionTok{features\_annotation}\NormalTok{(test1)}\SpecialCharTok{$}\NormalTok{.features\_id}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{set\_tracer}\NormalTok{(test1, ids[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{2}\NormalTok{])}
\DocumentationTok{\#\# see results}
\FunctionTok{nebula\_index}\NormalTok{(test1)}

\DocumentationTok{\#\# see examples in \textquotesingle{}set\_nodes\_color()\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-statistic_set-class.r}{%
\section{File: statistic\_set-class.R}\label{file-statistic_set-class.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-virtual_backtrack-class.r}{%
\section{File: VIRTUAL\_backtrack-class.R}\label{file-virtual_backtrack-class.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-virtual_dataset-class.r}{%
\section{File: VIRTUAL\_dataset-class.R}\label{file-virtual_dataset-class.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-virtual_export-class.r}{%
\section{File: VIRTUAL\_export-class.R}\label{file-virtual_export-class.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-virtual_layerset-class.r}{%
\section{File: VIRTUAL\_layerSet-class.R}\label{file-virtual_layerset-class.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-virtual_reference-class.r}{%
\section{File: VIRTUAL\_reference-class.R}\label{file-virtual_reference-class.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-virtual_subscript-class.r}{%
\section{File: VIRTUAL\_subscript-class.R}\label{file-virtual_subscript-class.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-visualize-methods.r}{%
\section{File: visualize-methods.R}\label{file-visualize-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\NormalTok{test }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_5features}

\DocumentationTok{\#\# the previous steps}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(test)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(test1, }\AttributeTok{by\_reference =}\NormalTok{ T)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_stardust\_classes}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_features\_annotation}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{cross\_filter\_stardust}\NormalTok{(test1, }\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_nebula\_index}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{compute\_spectral\_similarity}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_parent\_nebula}\NormalTok{(test1, }\FloatTok{0.01}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_nebulae}\NormalTok{(test1, }\FloatTok{0.01}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_parent\_layout}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_layouts}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{activate\_nebulae}\NormalTok{(test1)}

\DocumentationTok{\#\# optional Child{-}Nebulae}
\FunctionTok{visualize}\NormalTok{(test1)}

\FunctionTok{visualize}\NormalTok{(test1, }\StringTok{"parent"}\NormalTok{)}
\FunctionTok{visualize}\NormalTok{(test1, }\DecValTok{1}\NormalTok{)}
\FunctionTok{visualize\_all}\NormalTok{(test1)}
\DocumentationTok{\#\# ...}

\DocumentationTok{\#\# use \textquotesingle{}fun\_modify\textquotesingle{}}
\FunctionTok{visualize}\NormalTok{(test1, }\DecValTok{1}\NormalTok{, modify\_default\_child)}
\FunctionTok{visualize}\NormalTok{(test1, }\DecValTok{1}\NormalTok{, modify\_unify\_scale\_limits)}
\FunctionTok{visualize}\NormalTok{(test1, }\DecValTok{1}\NormalTok{, modify\_set\_labs)}
\DocumentationTok{\#\# ...}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-workflow-methods.r}{%
\section{File: workflow-methods.R}\label{file-workflow-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# codes}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-export_data.r}{%
\section{File: export\_data.R}\label{file-export_data.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# get the data}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\NormalTok{tmp }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"/temp\_data"}\NormalTok{)}
\FunctionTok{dir.create}\NormalTok{(tmp, F)}
\NormalTok{eg.path }\OtherTok{\textless{}{-}} \FunctionTok{system.file}\NormalTok{(}\StringTok{"extdata"}\NormalTok{, }\StringTok{"raw\_instance.tar.gz"}\NormalTok{,}
                       \AttributeTok{package =} \StringTok{"MCnebula2"}\NormalTok{)}

\NormalTok{utils}\SpecialCharTok{::}\FunctionTok{untar}\NormalTok{(eg.path, }\AttributeTok{exdir =}\NormalTok{ tmp)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# decrease object.size}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\NormalTok{test }\OtherTok{\textless{}{-}} \FunctionTok{initialize\_mcnebula}\NormalTok{(}\FunctionTok{mcnebula}\NormalTok{(), , tmp)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(test)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_ppcp}\NormalTok{(test1, }\AttributeTok{by\_reference =}\NormalTok{ F)}

\FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(test1))}

\DocumentationTok{\#\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} }
\DocumentationTok{\#\# chemical structure}

\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{entity}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(test1))[[ }\StringTok{".f3\_fingerid"}\NormalTok{ ]])}
\NormalTok{df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(df, }\AttributeTok{links =} \FunctionTok{character}\NormalTok{(}\DecValTok{1}\NormalTok{), }\AttributeTok{pubmed.ids =} \FunctionTok{character}\NormalTok{(}\DecValTok{1}\NormalTok{))}
\NormalTok{df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate\_if}\NormalTok{(df, is.numeric, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{round}\NormalTok{(x, }\DecValTok{2}\NormalTok{))}

\FunctionTok{format}\NormalTok{(}\FunctionTok{object.size}\NormalTok{(df), }\AttributeTok{units =} \StringTok{"MB"}\NormalTok{)}
\NormalTok{dplyr}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(df)}
\NormalTok{df}

\FunctionTok{entity}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(test1))[[ }\StringTok{".f3\_fingerid"}\NormalTok{ ]]) }\OtherTok{\textless{}{-}}\NormalTok{ df}

\DocumentationTok{\#\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} }
\DocumentationTok{\#\# chemical formula}

\NormalTok{df2 }\OtherTok{\textless{}{-}} \FunctionTok{entity}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(test1))[[ }\StringTok{".f2\_formula"}\NormalTok{ ]])}
\NormalTok{df2 }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate\_if}\NormalTok{(df2, is.numeric, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{round}\NormalTok{(x, }\DecValTok{2}\NormalTok{))}

\NormalTok{dplyr}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(df2)}
\NormalTok{df2}

\FunctionTok{entity}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(test1))[[ }\StringTok{".f2\_formula"}\NormalTok{ ]]) }\OtherTok{\textless{}{-}}\NormalTok{ df2}

\DocumentationTok{\#\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} }
\DocumentationTok{\#\# chmical classes}

\NormalTok{df3 }\OtherTok{\textless{}{-}} \FunctionTok{entity}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(test1))[[ }\StringTok{".f3\_canopus"}\NormalTok{ ]])}
\NormalTok{df3 }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate\_if}\NormalTok{(df3, is.numeric, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{round}\NormalTok{(x, }\DecValTok{2}\NormalTok{))}
\NormalTok{df3 }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(df3, }\AttributeTok{description =} \FunctionTok{character}\NormalTok{(}\DecValTok{1}\NormalTok{),}
                     \AttributeTok{rel.index =} \FunctionTok{as.integer}\NormalTok{(rel.index))}

\FunctionTok{format}\NormalTok{(}\FunctionTok{object.size}\NormalTok{(df3), }\AttributeTok{units =} \StringTok{"MB"}\NormalTok{)}
\NormalTok{dplyr}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(df3)}
\NormalTok{df3}

\FunctionTok{entity}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(test1))[[ }\StringTok{".f3\_canopus"}\NormalTok{ ]]) }\OtherTok{\textless{}{-}}\NormalTok{ df3}

\DocumentationTok{\#\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} }
\DocumentationTok{\#\# others}

\NormalTok{reference }\OtherTok{\textless{}{-}} \FunctionTok{specific\_candidate}\NormalTok{(}\FunctionTok{create\_reference}\NormalTok{(test1, }\AttributeTok{from =} \StringTok{"structure"}\NormalTok{))}
\NormalTok{reference}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{collate\_data}\NormalTok{(test1, }\StringTok{".f3\_spectra"}\NormalTok{, }\AttributeTok{reference =}\NormalTok{ reference)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{collate\_data}\NormalTok{(test1, }\AttributeTok{subscript =} \StringTok{".f2\_info"}\NormalTok{)}

\DocumentationTok{\#\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} }
\DocumentationTok{\#\# delete tmpfile}

\FunctionTok{mcn\_dataset}\NormalTok{(test1) }\OtherTok{\textless{}{-}}\NormalTok{ MCnebula2}\SpecialCharTok{:::}\FunctionTok{.mcn\_dataset}\NormalTok{()}

\FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(test1))}

\FunctionTok{format}\NormalTok{(}\FunctionTok{object.size}\NormalTok{(test1), }\AttributeTok{units =} \StringTok{"MB"}\NormalTok{)}

\FunctionTok{list.files}\NormalTok{(tmp)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# test function}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\FunctionTok{project\_dataset}\NormalTok{(test1)}
\FunctionTok{mcn\_dataset}\NormalTok{(test1)}
\FunctionTok{latest}\NormalTok{(test1, }\AttributeTok{subscript =} \StringTok{".f3\_canopus"}\NormalTok{)}

\NormalTok{test3 }\OtherTok{\textless{}{-}}\NormalTok{ test1}

\NormalTok{test3 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(test3)}
\NormalTok{test3 }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(test3)}
\NormalTok{test3 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(test3, }\AttributeTok{by\_reference=}\NormalTok{T)}

\NormalTok{test3 }\OtherTok{\textless{}{-}} \FunctionTok{create\_stardust\_classes}\NormalTok{(test3)}
\NormalTok{test3 }\OtherTok{\textless{}{-}} \FunctionTok{create\_features\_annotation}\NormalTok{(test3)}
\NormalTok{test3 }\OtherTok{\textless{}{-}} \FunctionTok{cross\_filter\_stardust}\NormalTok{(test3, }\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\FunctionTok{stardust\_classes}\NormalTok{(test3)}

\NormalTok{test3 }\OtherTok{\textless{}{-}} \FunctionTok{create\_nebula\_index}\NormalTok{(test3)}
\NormalTok{test3 }\OtherTok{\textless{}{-}} \FunctionTok{compute\_spectral\_similarity}\NormalTok{(test3)}
\NormalTok{test3 }\OtherTok{\textless{}{-}} \FunctionTok{create\_parent\_nebula}\NormalTok{(test3, }\FloatTok{0.01}\NormalTok{, F)}
\NormalTok{test3 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_nebulae}\NormalTok{(test3, }\FloatTok{0.01}\NormalTok{, }\DecValTok{5}\NormalTok{)}
\FunctionTok{spectral\_similarity}\NormalTok{(test3)}

\NormalTok{test3 }\OtherTok{\textless{}{-}} \FunctionTok{create\_parent\_layout}\NormalTok{(test3)}
\NormalTok{test3 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_layouts}\NormalTok{(test3)}
\NormalTok{test3 }\OtherTok{\textless{}{-}} \FunctionTok{activate\_nebulae}\NormalTok{(test3)}

\NormalTok{test3 }\OtherTok{\textless{}{-}} \FunctionTok{.simulate\_quant\_set}\NormalTok{(test3)}
\NormalTok{test3 }\OtherTok{\textless{}{-}} \FunctionTok{set\_ppcp\_data}\NormalTok{(test3)}
\NormalTok{test3 }\OtherTok{\textless{}{-}} \FunctionTok{set\_ration\_data}\NormalTok{(test3)}
\NormalTok{test3 }\OtherTok{\textless{}{-}} \FunctionTok{binary\_comparison}\NormalTok{(test3, control }\SpecialCharTok{{-}}\NormalTok{ model,}
\NormalTok{                           model }\SpecialCharTok{{-}}\NormalTok{ control, }\DecValTok{2} \SpecialCharTok{*}\NormalTok{ model }\SpecialCharTok{{-}}\NormalTok{ control)}

\FunctionTok{top\_table}\NormalTok{(}\FunctionTok{statistic\_set}\NormalTok{(test3))}

\FunctionTok{visualize}\NormalTok{(test3)}
\FunctionTok{visualize}\NormalTok{(test3, }\DecValTok{3}\NormalTok{)}

\FunctionTok{call\_command}\NormalTok{(}\FunctionTok{ggset}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(test3))[[}\DecValTok{2}\NormalTok{]])}
\FunctionTok{names}\NormalTok{(}\FunctionTok{ggset}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(test3))[}\DecValTok{2}\NormalTok{])}
\FunctionTok{layout\_ggraph}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(test3))[}\DecValTok{2}\NormalTok{]}
\FunctionTok{call\_command}\NormalTok{(}\FunctionTok{ggset}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(test3))[[}\DecValTok{3}\NormalTok{]])}

\FunctionTok{visualize}\NormalTok{(test3, }\StringTok{"parent"}\NormalTok{)}

\FunctionTok{visualize\_all}\NormalTok{(test3)}
\FunctionTok{visualize}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# save object}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\NormalTok{mcn\_5features }\OtherTok{\textless{}{-}}\NormalTok{ test1}
\FunctionTok{setwd}\NormalTok{(}\StringTok{"\textasciitilde{}/MCnebula2/"}\NormalTok{)}
\NormalTok{usethis}\SpecialCharTok{::}\FunctionTok{use\_data}\NormalTok{(mcn\_5features)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# post modify}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\FunctionTok{library}\NormalTok{(magrittr)}
\NormalTok{backup }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_5features}
\NormalTok{test }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_5features}

\DocumentationTok{\#\# non{-}asc}
\FunctionTok{entity}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(test))[[}\StringTok{".canopus"}\NormalTok{]])}\SpecialCharTok{$}\NormalTok{description }\SpecialCharTok{\%\textless{}\textgreater{}\%} 
  \FunctionTok{enc2utf8}\NormalTok{()}

\NormalTok{mcn\_5features }\OtherTok{\textless{}{-}}\NormalTok{ test}

\DocumentationTok{\#\# msms}
\NormalTok{test }\OtherTok{\textless{}{-}} \FunctionTok{collate\_data}\NormalTok{(test, }\AttributeTok{subscript =} \StringTok{".f2\_msms"}\NormalTok{)}
\FunctionTok{format}\NormalTok{(}\FunctionTok{object.size}\NormalTok{(test), }\AttributeTok{units =} \StringTok{"MB"}\NormalTok{)}
\FunctionTok{project\_dataset}\NormalTok{(test)}

\NormalTok{mcn\_5features }\OtherTok{\textless{}{-}}\NormalTok{ test}

\NormalTok{usethis}\SpecialCharTok{::}\FunctionTok{use\_data}\NormalTok{(mcn\_5features, }\AttributeTok{overwrite =}\NormalTok{ T)}
\CommentTok{\# save(mcn\_5features, file = "\textasciitilde{}/mcn\_5features.rda")}

\FunctionTok{unlink}\NormalTok{(tmp, T, T)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-grep_names.r}{%
\section{File: grep\_names.R}\label{file-grep_names.r}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{setwd}\NormalTok{(}\StringTok{"\textasciitilde{}/MCnebula2/R"}\NormalTok{)}
\FunctionTok{library}\NormalTok{(magrittr)}

\NormalTok{script }\OtherTok{\textless{}{-}} \FunctionTok{list.files}\NormalTok{(}\StringTok{"."}\NormalTok{, }\AttributeTok{pattern =} \StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.R$"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{sapply}\NormalTok{(readLines)}

\NormalTok{target }\OtherTok{\textless{}{-}}
  \FunctionTok{lapply}\NormalTok{(script,}
         \ControlFlowTok{function}\NormalTok{(text)\{}
\NormalTok{           lo\_1 }\OtherTok{\textless{}{-}} \SpecialCharTok{!}\FunctionTok{grepl}\NormalTok{(}\StringTok{"@aliases|@exportClass|@family|new}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{("}\NormalTok{, text)}
\NormalTok{           lo\_2 }\OtherTok{\textless{}{-}} \FunctionTok{grepl}\NormalTok{(}\StringTok{"\^{}\#\textquotesingle{}.*(?\textless{}![\_|a{-}z|A{-}Z])nebula(?![{-}|\_])"}\NormalTok{, text, }\AttributeTok{perl =}\NormalTok{ T)}
\NormalTok{           lo }\OtherTok{\textless{}{-}}\NormalTok{ lo\_1 }\SpecialCharTok{\&}\NormalTok{ lo\_2}
\NormalTok{           text[lo] }\OtherTok{\textless{}{-}} \FunctionTok{gsub}\NormalTok{(}\StringTok{"child(?!\_)"}\NormalTok{, }\StringTok{"Child"}\NormalTok{, text[lo], }\AttributeTok{perl =}\NormalTok{ T)}
\NormalTok{           text[lo] }\OtherTok{\textless{}{-}} \FunctionTok{gsub}\NormalTok{(}\StringTok{"parent(?!\_)"}\NormalTok{, }\StringTok{"Parent"}\NormalTok{, text[lo], }\AttributeTok{perl =}\NormalTok{ T)}
\NormalTok{           text[lo] }\OtherTok{\textless{}{-}} \FunctionTok{gsub}\NormalTok{(}\StringTok{"(?\textless{}![\_|a{-}z|A{-}Z])nebula(?![{-}|\_])"}\NormalTok{, }\StringTok{"Nebula"}\NormalTok{,}
\NormalTok{                            text[lo], }\AttributeTok{perl =}\NormalTok{ T)}
\NormalTok{           text[lo] }\OtherTok{\textless{}{-}} \FunctionTok{gsub}\NormalTok{(}\StringTok{"\textquotesingle{}Nebula\textquotesingle{}"}\NormalTok{, }\StringTok{"Nebula"}\NormalTok{, text[lo])}
\NormalTok{           text[lo] }\OtherTok{\textless{}{-}} \FunctionTok{gsub}\NormalTok{(}\StringTok{"\textquotesingle{}Nebulae\textquotesingle{}"}\NormalTok{, }\StringTok{"Nebulae"}\NormalTok{, text[lo])}
\NormalTok{           text}
\NormalTok{         \})}

\NormalTok{path }\OtherTok{\textless{}{-}} \StringTok{"\textasciitilde{}/code\_backup/mcnebula2"}
\FunctionTok{dir.create}\NormalTok{(path, }\AttributeTok{recursive =}\NormalTok{ T)}

\FunctionTok{lapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(target),}
       \ControlFlowTok{function}\NormalTok{(name)\{}
         \FunctionTok{writeLines}\NormalTok{(target[[name]], }\FunctionTok{paste0}\NormalTok{(path, }\StringTok{"/"}\NormalTok{, name))}
\NormalTok{       \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-grid_draw.r}{%
\section{File: grid\_draw.R}\label{file-grid_draw.r}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tmp }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"/test.png"}\NormalTok{)}

\FunctionTok{png}\NormalTok{(tmp, }\DecValTok{480}\NormalTok{, }\DecValTok{490}\NormalTok{)}
\FunctionTok{pushViewport}\NormalTok{(}\FunctionTok{viewport}\NormalTok{(, , }\FloatTok{0.5}\NormalTok{, }\FloatTok{0.5}\NormalTok{))}
\NormalTok{test }\OtherTok{\textless{}{-}} \FunctionTok{grecto}\NormalTok{(}\StringTok{"test"}\NormalTok{, }\AttributeTok{cex =} \DecValTok{3}\NormalTok{)}
\FunctionTok{draw}\NormalTok{(test, }\FunctionTok{gtext}\NormalTok{(}\StringTok{"shiny"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{cex =} \DecValTok{5}\NormalTok{)))}
\FunctionTok{dev.off}\NormalTok{()}

\NormalTok{cv }\OtherTok{\textless{}{-}} \FunctionTok{import}\NormalTok{(}\StringTok{"cv2"}\NormalTok{)}
\CommentTok{\# np \textless{}{-} import("numpy")}

\NormalTok{img }\OtherTok{\textless{}{-}}\NormalTok{ cv}\SpecialCharTok{$}\FunctionTok{imread}\NormalTok{(tmp)}

\NormalTok{dim }\OtherTok{\textless{}{-}} \FunctionTok{dim}\NormalTok{(img)[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{2}\NormalTok{]}
\NormalTok{w }\OtherTok{\textless{}{-}}\NormalTok{ dim[}\DecValTok{1}\NormalTok{]}
\NormalTok{h }\OtherTok{\textless{}{-}}\NormalTok{ dim[}\DecValTok{2}\NormalTok{]}

\NormalTok{src }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, h), }\FunctionTok{c}\NormalTok{(w, }\DecValTok{0}\NormalTok{), }\FunctionTok{c}\NormalTok{(w, h))}
\NormalTok{target }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{100}\NormalTok{, }\DecValTok{100}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, h), }\FunctionTok{c}\NormalTok{(}\DecValTok{300}\NormalTok{, }\DecValTok{100}\NormalTok{), }\FunctionTok{c}\NormalTok{(w, h))}

\NormalTok{trans }\OtherTok{\textless{}{-}}\NormalTok{ cv}\SpecialCharTok{$}\FunctionTok{findHomography}\NormalTok{(src, target)[[}\DecValTok{1}\NormalTok{]]}

\NormalTok{new\_img }\OtherTok{\textless{}{-}}\NormalTok{ cv}\SpecialCharTok{$}\FunctionTok{warpPerspective}\NormalTok{(img, trans, dim)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-internal_data.r}{%
\section{File: internal\_data.R}\label{file-internal_data.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# MCnebula2 used}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\FunctionTok{setwd}\NormalTok{(}\StringTok{"\textasciitilde{}/MCnebula2/"}\NormalTok{)}

\NormalTok{path }\OtherTok{\textless{}{-}} \StringTok{"\textasciitilde{}/outline/mc.test/templates/"}
\NormalTok{names }\OtherTok{\textless{}{-}} \FunctionTok{eval}\NormalTok{(.workflow\_name)}
\NormalTok{objs }\OtherTok{\textless{}{-}}
  \FunctionTok{sapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(names), }\AttributeTok{simplify =}\NormalTok{ F,}
    \ControlFlowTok{function}\NormalTok{(name) \{}
\NormalTok{      file }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(path, name, }\StringTok{".R"}\NormalTok{)}
      \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{file.exists}\NormalTok{(file))}
        \FunctionTok{readLines}\NormalTok{(file)}
\NormalTok{    \})}
\NormalTok{.workflow\_templ }\OtherTok{\textless{}{-}}\NormalTok{ objs[}\SpecialCharTok{!}\FunctionTok{vapply}\NormalTok{(objs, is.null, }\FunctionTok{logical}\NormalTok{(}\DecValTok{1}\NormalTok{))]}

\NormalTok{usethis}\SpecialCharTok{::}\FunctionTok{use\_data}\NormalTok{(.workflow\_templ, }\AttributeTok{internal =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{overwrite =}\NormalTok{ T)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-abs_2.r}{%
\section{File: abs\_2.R}\label{file-abs_2.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# draw the graphic abstract}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\FunctionTok{library}\NormalTok{(ggplot2)}

\NormalTok{title\_pals }\OtherTok{\textless{}{-}} \FunctionTok{colorRampPalette}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}white\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}\#1B1919\textquotesingle{}}\NormalTok{))(}\DecValTok{10}\NormalTok{)[ }\DecValTok{5}\SpecialCharTok{:}\DecValTok{8}\NormalTok{ ]}

\CommentTok{\# alignment}
\NormalTok{shift }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{all\_range }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{30}\NormalTok{, }\DecValTok{31}\SpecialCharTok{:}\DecValTok{60}\NormalTok{, }\DecValTok{61}\SpecialCharTok{:}\DecValTok{100}\NormalTok{)}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{1}\NormalTok{)}
\NormalTok{lst }\OtherTok{\textless{}{-}} \FunctionTok{mapply}\NormalTok{(shift, }\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(shift), }\AttributeTok{SIMPLIFY =}\NormalTok{ F, }\AttributeTok{FUN =} \ControlFlowTok{function}\NormalTok{(shift, id)\{}
\NormalTok{  peak }\OtherTok{\textless{}{-}} \FunctionTok{mapply}\NormalTok{(all\_range, }\AttributeTok{SIMPLIFY =}\NormalTok{ F,}
    \AttributeTok{FUN =} \ControlFlowTok{function}\NormalTok{(range)\{}
\NormalTok{      peak }\OtherTok{\textless{}{-}} \FunctionTok{dnorm}\NormalTok{(range, }\FunctionTok{median}\NormalTok{(range) }\SpecialCharTok{+}\NormalTok{ shift, }\FunctionTok{rnorm}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{5}\NormalTok{, }\FloatTok{1.2}\NormalTok{)) }\SpecialCharTok{*}
        \FunctionTok{rnorm}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FloatTok{0.7}\NormalTok{, }\FloatTok{0.15}\NormalTok{)}
\NormalTok{    \})}
\NormalTok{  feature }\OtherTok{\textless{}{-}} \FunctionTok{mapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(all\_range), }\FunctionTok{lengths}\NormalTok{(all\_range),}
    \AttributeTok{FUN =} \ControlFlowTok{function}\NormalTok{(seq, rep)\{}
      \FunctionTok{rep}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"peak"}\NormalTok{, seq), rep)}
\NormalTok{    \})}
\NormalTok{  tibble}\SpecialCharTok{::}\FunctionTok{tibble}\NormalTok{(}\AttributeTok{x =} \FunctionTok{unlist}\NormalTok{(all\_range), }\AttributeTok{y =} \FunctionTok{unlist}\NormalTok{(peak),}
    \AttributeTok{sample =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"sample"}\NormalTok{, id),}
    \AttributeTok{peak =} \FunctionTok{unlist}\NormalTok{(feature)}
\NormalTok{  )}
\NormalTok{\})}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(lst)}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(data,}
  \AttributeTok{is =} \FunctionTok{ifelse}\NormalTok{(y }\SpecialCharTok{\textgreater{}=} \FloatTok{0.003}\NormalTok{, T, F),}
  \AttributeTok{peak =} \FunctionTok{ifelse}\NormalTok{(is, peak, }\StringTok{"non{-}feature"}\NormalTok{))}
\NormalTok{palette }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(ggsci}\SpecialCharTok{::}\FunctionTok{pal\_npg}\NormalTok{()(}\FunctionTok{length}\NormalTok{(all\_range)), }\StringTok{"transparent"}\NormalTok{)}
\FunctionTok{names}\NormalTok{(palette) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"peak"}\NormalTok{, }\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(all\_range)), }\StringTok{"non{-}feature"}\NormalTok{)}
\CommentTok{\# detection}
\NormalTok{all\_time }\OtherTok{\textless{}{-}} \FunctionTok{vapply}\NormalTok{(all\_range, median, }\DecValTok{1}\NormalTok{)}
\NormalTok{anpi }\OtherTok{\textless{}{-}} \FloatTok{0.05}
\NormalTok{len }\OtherTok{\textless{}{-}} \DecValTok{5}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{1}\NormalTok{)}
\NormalTok{ms1\_set }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(all\_time,}
  \ControlFlowTok{function}\NormalTok{(n)\{}
\NormalTok{    ms1 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FunctionTok{rnorm}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{2}\NormalTok{), }\FunctionTok{rnorm}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{8}\NormalTok{, }\DecValTok{3}\NormalTok{), }\FunctionTok{rnorm}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{2}\NormalTok{))}
\NormalTok{    ms1 }\OtherTok{\textless{}{-}}\NormalTok{ ms1[ ms1 }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{ ]}
\NormalTok{    ms1 }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{x =} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(ms1), }\AttributeTok{xend =} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(ms1),}
      \AttributeTok{y =} \DecValTok{0}\NormalTok{, }\AttributeTok{yend =}\NormalTok{ ms1)}
\NormalTok{    ms1 }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(ms1,}
      \AttributeTok{x =}\NormalTok{ x }\SpecialCharTok{*}\NormalTok{ len, }\AttributeTok{xend =}\NormalTok{ xend }\SpecialCharTok{*}\NormalTok{ len,}
      \AttributeTok{y =} \FunctionTok{sinpi}\NormalTok{(anpi) }\SpecialCharTok{*}\NormalTok{ x }\SpecialCharTok{+}\NormalTok{ y, }\AttributeTok{yend =} \FunctionTok{sinpi}\NormalTok{(anpi) }\SpecialCharTok{*}\NormalTok{ xend }\SpecialCharTok{+}\NormalTok{ yend,}
      \AttributeTok{x =} \FunctionTok{cospi}\NormalTok{(anpi) }\SpecialCharTok{*}\NormalTok{ x }\SpecialCharTok{+}\NormalTok{ n, }\AttributeTok{xend =}\NormalTok{ x)}
\NormalTok{    ms1 }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{bind\_rows}\NormalTok{(ms1,}
      \FunctionTok{c}\NormalTok{(}\AttributeTok{x =}\NormalTok{ n, }\AttributeTok{xend =} \FunctionTok{max}\NormalTok{(ms1}\SpecialCharTok{$}\NormalTok{xend),}
        \AttributeTok{y =} \DecValTok{0}\NormalTok{, }\AttributeTok{yend =} \FunctionTok{max}\NormalTok{(ms1}\SpecialCharTok{$}\NormalTok{y)))}
\NormalTok{    dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(ms1, }\AttributeTok{time =}\NormalTok{ n)}
\NormalTok{  \})}
\NormalTok{ms1\_set }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(ms1\_set)}
\NormalTok{p }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(data, sample }\SpecialCharTok{==} \StringTok{"sample1"}\NormalTok{), }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y }\SpecialCharTok{*} \DecValTok{50}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{geom\_segment}\NormalTok{(}\AttributeTok{data =}\NormalTok{ ms1\_set,}
    \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{xend =}\NormalTok{ xend, }\AttributeTok{y =}\NormalTok{ y, }\AttributeTok{yend =}\NormalTok{ yend),}
    \AttributeTok{color =} \StringTok{"grey30"}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.8}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_area}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ peak)) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{x =} \StringTok{"retention time"}\NormalTok{, }\AttributeTok{y =} \StringTok{"intensity"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =}\NormalTok{ palette) }\SpecialCharTok{+}
  \FunctionTok{theme\_void}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{family =} \StringTok{"Times"}\NormalTok{),}
    \AttributeTok{axis.text.y =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{  )}
\NormalTok{grob.detect }\OtherTok{\textless{}{-}} \FunctionTok{as\_grob}\NormalTok{(p)}
\NormalTok{g.detect }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{grectn}\NormalTok{(}\AttributeTok{bgp\_args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{lty =} \StringTok{"solid"}\NormalTok{)), grob.detect)}
\DocumentationTok{\#\# gear}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{x =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{20}\NormalTok{, }\AttributeTok{y =} \FunctionTok{rep}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{), }\DecValTok{10}\NormalTok{))}
\NormalTok{p.step }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(dplyr}\SpecialCharTok{::}\FunctionTok{slice}\NormalTok{(data, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{19}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{geom\_step}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y), }\AttributeTok{size =}\NormalTok{ .}\DecValTok{2}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{coord\_polar}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{8}\NormalTok{, }\DecValTok{1}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme\_void}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{plot.margin =} \FunctionTok{rep}\NormalTok{(}\FunctionTok{u}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{.}\DecValTok{1}\NormalTok{, npc), }\DecValTok{4}\NormalTok{))}
\NormalTok{gear }\OtherTok{\textless{}{-}} \FunctionTok{as\_grob}\NormalTok{(p.step)}
\NormalTok{g.gear }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(gear,}
  \FunctionTok{circleGrob}\NormalTok{(}\AttributeTok{r =} \FunctionTok{c}\NormalTok{(.}\DecValTok{2}\NormalTok{, .}\DecValTok{4}\NormalTok{)),}
  \FunctionTok{circleGrob}\NormalTok{(}\AttributeTok{r =}\NormalTok{ .}\DecValTok{3}\NormalTok{, }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{lwd =} \DecValTok{5}\NormalTok{, }\AttributeTok{col =} \StringTok{\textquotesingle{}grey70\textquotesingle{}}\NormalTok{)), }
  \AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(}\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{alpha =}\NormalTok{ .}\DecValTok{2}\NormalTok{)))}
\NormalTok{MCnebula2}\SpecialCharTok{:::}\FunctionTok{.smiles\_to\_cairosvg}\NormalTok{(}
  \StringTok{\textquotesingle{}C1=C(C=C(C(=C1I)OC2=CC(=C(C(=C2)I)O)I)I)CC(C(=O)O)N\textquotesingle{}}\NormalTok{,}
  \StringTok{\textquotesingle{}chemEg.svg\textquotesingle{}}\NormalTok{)}
\NormalTok{struc }\OtherTok{\textless{}{-}} \FunctionTok{.rm\_background}\NormalTok{(}\FunctionTok{.cairosvg\_to\_grob}\NormalTok{(}\StringTok{\textquotesingle{}chemEg.svg\textquotesingle{}}\NormalTok{))}
\NormalTok{struc }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(struc, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, .}\DecValTok{5}\NormalTok{, }\FloatTok{1.8}\NormalTok{, }\FloatTok{1.8}\NormalTok{))}
\NormalTok{mglayer }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(}\AttributeTok{from =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{, }\AttributeTok{n =} \DecValTok{5}\NormalTok{, }\AttributeTok{seed =} \DecValTok{100}\NormalTok{) \{}
  \FunctionTok{set.seed}\NormalTok{(seed)}
\NormalTok{  ns }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(from, n, T)}
\NormalTok{  grobs }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(ns,}
    \ControlFlowTok{function}\NormalTok{(n) \{}
      \FunctionTok{ggather}\NormalTok{(}\FunctionTok{glayer}\NormalTok{(n), }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{7}\NormalTok{, .}\DecValTok{7}\NormalTok{))}
\NormalTok{    \})}
\NormalTok{  sig }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"glayer"}\NormalTok{, seed), }\DecValTok{1}\SpecialCharTok{:}\NormalTok{n)}
  \FunctionTok{names}\NormalTok{(grobs) }\OtherTok{\textless{}{-}}\NormalTok{ sig}
  \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{fill\_list}\NormalTok{(sig, }\DecValTok{1}\NormalTok{), grobs)}
\NormalTok{\}}
\NormalTok{g.predict }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(struc, g.gear)}
\NormalTok{g.predict }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{g.predict =} \DecValTok{4}\NormalTok{, }\AttributeTok{glayers =} \DecValTok{1}\NormalTok{),}
  \FunctionTok{namel}\NormalTok{(g.predict, }\AttributeTok{glayers =} \FunctionTok{mglayer}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{4}\NormalTok{, }\DecValTok{4}\NormalTok{)))}
\NormalTok{g.before }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{g.detect =} \FloatTok{1.5}\NormalTok{, }\AttributeTok{g.predict =} \DecValTok{1}\NormalTok{),}
  \FunctionTok{namel}\NormalTok{(g.detect, g.predict))}
\NormalTok{g.step0 }\OtherTok{\textless{}{-}} \FunctionTok{grecti2}\NormalTok{(}\StringTok{\textquotesingle{}Detection and prediction\textquotesingle{}}\NormalTok{, }\AttributeTok{tfill =}\NormalTok{ title\_pals[}\DecValTok{1}\NormalTok{])}
\NormalTok{g.step0 }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(g.step0, }\FunctionTok{ggather}\NormalTok{(g.before, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{95}\NormalTok{, .}\DecValTok{8}\NormalTok{)))}

\DocumentationTok{\#\# step2}
\DocumentationTok{\#\# rank bar}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{100}\NormalTok{)}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{x =} \DecValTok{1}\SpecialCharTok{:}\NormalTok{(n }\OtherTok{\textless{}{-}} \DecValTok{12}\NormalTok{), }\AttributeTok{y =} \FunctionTok{sort}\NormalTok{(}\FunctionTok{abs}\NormalTok{(}\FunctionTok{rnorm}\NormalTok{(n, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{))))}
\NormalTok{p.rank }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(data) }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y), }\AttributeTok{fill =} \FunctionTok{ifelse}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{y }\SpecialCharTok{\textgreater{}} \DecValTok{5}\NormalTok{, }\StringTok{\textquotesingle{}\#D5E4A2\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}\#FD7446\textquotesingle{}}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \DecValTok{5}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{color =} \StringTok{"red"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme\_void}\NormalTok{()}
\NormalTok{g.rank }\OtherTok{\textless{}{-}} \FunctionTok{as\_grob}\NormalTok{(p.rank)}
\DocumentationTok{\#\# bar}
\NormalTok{p.bar }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{data.frame}\NormalTok{(}\AttributeTok{x =} \DecValTok{1}\NormalTok{, }\AttributeTok{y =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.1}\NormalTok{, }\FloatTok{0.9}\NormalTok{), }\AttributeTok{group =} \FunctionTok{c}\NormalTok{(}\StringTok{"false"}\NormalTok{, }\StringTok{"true"}\NormalTok{))) }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y, }\AttributeTok{fill =} \FunctionTok{reorder}\NormalTok{(group, }\FunctionTok{desc}\NormalTok{(y))), }\AttributeTok{width =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{"segment"}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.7}\NormalTok{, }\AttributeTok{xend =} \FloatTok{1.7}\NormalTok{, }\AttributeTok{y =} \FloatTok{0.12}\NormalTok{, }\AttributeTok{yend =} \FloatTok{0.98}\NormalTok{,}
    \AttributeTok{arrow =} \FunctionTok{arrow}\NormalTok{(}\AttributeTok{angle =} \DecValTok{10}\NormalTok{, }\AttributeTok{type =} \StringTok{"closed"}\NormalTok{, }\AttributeTok{length =} \FunctionTok{unit}\NormalTok{(}\FloatTok{0.05}\NormalTok{, }\StringTok{"npc"}\NormalTok{))) }\SpecialCharTok{+}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{"segment"}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.6}\NormalTok{, }\AttributeTok{xend =} \FloatTok{1.8}\NormalTok{, }\AttributeTok{y =} \FloatTok{0.1}\NormalTok{, }\AttributeTok{yend =} \FloatTok{0.1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}\#91D1C2FF\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}\#DC0000FF\textquotesingle{}}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{xlim}\NormalTok{(}\FunctionTok{c}\NormalTok{(.}\DecValTok{5}\NormalTok{, }\DecValTok{2}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme\_void}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{\textquotesingle{}none\textquotesingle{}}\NormalTok{)}
\NormalTok{p.bar }\OtherTok{\textless{}{-}} \FunctionTok{as\_grob}\NormalTok{(p.bar)}
\NormalTok{p.bar }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(p.bar, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{95}\NormalTok{, .}\DecValTok{9}\NormalTok{))}
\DocumentationTok{\#\# box}
\NormalTok{simu\_score }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(}
  \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{.features\_id =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{50}\NormalTok{, }\AttributeTok{score =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{50}\NormalTok{, }\FloatTok{0.4}\NormalTok{, }\FloatTok{0.15}\NormalTok{)),}
  \AttributeTok{group =} \FunctionTok{ifelse}\NormalTok{(score }\SpecialCharTok{\textgreater{}=} \FloatTok{0.3}\NormalTok{, }\StringTok{"true"}\NormalTok{, }\StringTok{"false"}\NormalTok{)}
\NormalTok{)}
\NormalTok{p.box }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(simu\_score, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \StringTok{""}\NormalTok{, }\AttributeTok{y =}\NormalTok{ score)) }\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{color =} \StringTok{"red"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_jitter}\NormalTok{(}\AttributeTok{width =} \FloatTok{0.1}\NormalTok{, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{color =}\NormalTok{ group)) }\SpecialCharTok{+}
  \FunctionTok{theme\_void}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{)}
\NormalTok{p.box }\OtherTok{\textless{}{-}} \FunctionTok{as\_grob}\NormalTok{(p.box)}
\DocumentationTok{\#\# upset}
\NormalTok{p.upbar }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{data.frame}\NormalTok{(}\AttributeTok{x =} \DecValTok{1}\NormalTok{, }\AttributeTok{y =} \DecValTok{5}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y), }\AttributeTok{width =}\NormalTok{ .}\DecValTok{5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{7}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_continuous}\NormalTok{(}\AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{), }\AttributeTok{limits =} \FunctionTok{c}\NormalTok{(.}\DecValTok{5}\NormalTok{, }\FloatTok{1.5}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{text =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.ticks.y =} \FunctionTok{element\_blank}\NormalTok{()) }\SpecialCharTok{+}
  \FunctionTok{geom\_blank}\NormalTok{()}
\NormalTok{p.upbar }\OtherTok{\textless{}{-}} \FunctionTok{as\_grob}\NormalTok{(p.upbar)}
\NormalTok{cirs }\OtherTok{\textless{}{-}} \FunctionTok{circleGrob}\NormalTok{(}\AttributeTok{y =}\NormalTok{ (cirs.y }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(.}\DecValTok{1}\NormalTok{, .}\DecValTok{9}\NormalTok{, }\AttributeTok{length.out =} \DecValTok{5}\NormalTok{))[}\DecValTok{2}\SpecialCharTok{:}\DecValTok{4}\NormalTok{], }\AttributeTok{r =}\NormalTok{ .}\DecValTok{08}\NormalTok{,}
  \AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{col =} \StringTok{\textquotesingle{}transparent\textquotesingle{}}\NormalTok{, }\AttributeTok{fill =} \StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{))}
\NormalTok{cirs.sol }\OtherTok{\textless{}{-}} \FunctionTok{circleGrob}\NormalTok{(}\AttributeTok{y =}\NormalTok{ cirs.y[}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{5}\NormalTok{)], }\AttributeTok{r =}\NormalTok{ .}\DecValTok{08}\NormalTok{,}
  \AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{col =} \StringTok{\textquotesingle{}transparent\textquotesingle{}}\NormalTok{, }\AttributeTok{fill =} \StringTok{\textquotesingle{}black\textquotesingle{}}\NormalTok{))}
\NormalTok{line }\OtherTok{\textless{}{-}} \FunctionTok{linesGrob}\NormalTok{(}\AttributeTok{x =} \FunctionTok{c}\NormalTok{(.}\DecValTok{5}\NormalTok{, .}\DecValTok{5}\NormalTok{), }\AttributeTok{y =} \FunctionTok{c}\NormalTok{(.}\DecValTok{1}\NormalTok{, .}\DecValTok{9}\NormalTok{), }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{lwd =} \DecValTok{3}\NormalTok{))}
\NormalTok{p.upcir }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(cirs, line, cirs.sol)}
\NormalTok{g.upset }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{p.upbar =} \DecValTok{2}\NormalTok{, }\AttributeTok{p.upcir =} \DecValTok{1}\NormalTok{),}
  \FunctionTok{namel}\NormalTok{(}\AttributeTok{p.upbar =} \FunctionTok{ggather}\NormalTok{(p.upbar, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(.}\DecValTok{48}\NormalTok{)), p.upcir))}
\NormalTok{g.upset }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(g.upset, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{90}\NormalTok{, .}\DecValTok{90}\NormalTok{))}
\DocumentationTok{\#\# gather}
\NormalTok{g.step1}\FloatTok{.1}\NormalTok{t3 }\OtherTok{\textless{}{-}} \FunctionTok{mapply}\NormalTok{(}\FunctionTok{list}\NormalTok{(p.bar, p.box, g.upset), }\AttributeTok{n =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{3}\NormalTok{, }\AttributeTok{SIMPLIFY =}\NormalTok{ F,}
  \AttributeTok{FUN =} \ControlFlowTok{function}\NormalTok{(g, n) \{}
    \FunctionTok{into}\NormalTok{(}\FunctionTok{grecti2}\NormalTok{(n, }\AttributeTok{tfill =} \StringTok{\textquotesingle{}\#CC0C00\textquotesingle{}}\NormalTok{), g)}
\NormalTok{  \})}
\FunctionTok{names}\NormalTok{(g.step1}\FloatTok{.1}\NormalTok{t3) }\OtherTok{\textless{}{-}} \FunctionTok{n}\NormalTok{(g, }\DecValTok{3}\NormalTok{)}
\NormalTok{g.step1}\FloatTok{.1}\NormalTok{t3 }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{g1 =} \DecValTok{1}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{g2 =} \DecValTok{1}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{g3 =} \DecValTok{1}\NormalTok{),}
  \FunctionTok{c}\NormalTok{(g.step1}\FloatTok{.1}\NormalTok{t3, }\FunctionTok{list}\NormalTok{(}\AttributeTok{null =} \FunctionTok{nullGrob}\NormalTok{())))}
\NormalTok{g.step1}\FloatTok{.0}\NormalTok{t3 }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{g.rank =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{g.step1.1t3 =} \DecValTok{3}\NormalTok{),}
  \FunctionTok{namel}\NormalTok{(g.rank, g.step1}\FloatTok{.1}\NormalTok{t3, }\AttributeTok{null =} \FunctionTok{nullGrob}\NormalTok{()))}
\NormalTok{g.step1}\FloatTok{.0}\NormalTok{t3 }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}
  \FunctionTok{grecti2}\NormalTok{(}\StringTok{\textquotesingle{}Select classes\textquotesingle{}}\NormalTok{, }\AttributeTok{tfill =}\NormalTok{ title\_pals[}\DecValTok{2}\NormalTok{]), }
  \FunctionTok{ggather}\NormalTok{(g.step1}\FloatTok{.0}\NormalTok{t3, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{95}\NormalTok{, .}\DecValTok{8}\NormalTok{))}
\NormalTok{)}

\DocumentationTok{\#\# step2}
\CommentTok{\# network}
\FunctionTok{load}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(.expath, }\StringTok{"/toActiv30.rdata"}\NormalTok{))}
\NormalTok{test1 }\OtherTok{\textless{}{-}}\NormalTok{ toActiv30}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{17}\NormalTok{)}
\FunctionTok{reference}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(test1))}\SpecialCharTok{$}\NormalTok{nebula\_index }\SpecialCharTok{\%\textless{}\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(class.name }\SpecialCharTok{\%in\%} \FunctionTok{sample}\NormalTok{(}\FunctionTok{unique}\NormalTok{(class.name), }\DecValTok{2}\NormalTok{))}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{set\_tracer}\NormalTok{(test1, }\FunctionTok{c}\NormalTok{(}\StringTok{"2027"}\NormalTok{, }\StringTok{"2020"}\NormalTok{), }\AttributeTok{colors =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#C80813"}\NormalTok{, }\StringTok{"\#FD7446"}\NormalTok{))}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_nebulae}\NormalTok{(test1, }\FloatTok{0.01}\NormalTok{, }\DecValTok{5}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_layouts}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{activate\_nebulae}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{set\_nodes\_color}\NormalTok{(test1, }\AttributeTok{use\_tracer =}\NormalTok{ T)}
\NormalTok{chAsGrob }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(ch, x) \{}
\NormalTok{  ggset }\OtherTok{\textless{}{-}} \FunctionTok{modify\_default\_child}\NormalTok{(ch)}
\NormalTok{  ggset}\SpecialCharTok{@}\NormalTok{layers}\SpecialCharTok{$}\NormalTok{ggtitle}\SpecialCharTok{@}\NormalTok{command\_args}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{\%\textless{}\textgreater{}\%}
    \FunctionTok{gsub}\NormalTok{(}\StringTok{"[a{-}zA{-}Z]"}\NormalTok{, }\StringTok{"."}\NormalTok{, .) }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{gsub}\NormalTok{(}\StringTok{"\^{}...."}\NormalTok{, }\StringTok{"Class"}\NormalTok{, .) }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{gsub}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{."}\NormalTok{, }\StringTok{"."}\NormalTok{, .)}
  \FunctionTok{as\_grob}\NormalTok{(}\FunctionTok{call\_command}\NormalTok{(ggset))}
\NormalTok{\}}
\NormalTok{sets }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{ggset}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(test1)), chAsGrob, }\AttributeTok{x =}\NormalTok{ test1)}
\NormalTok{sets }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(sets),}
  \ControlFlowTok{function}\NormalTok{(name) \{}
    \FunctionTok{ggather}\NormalTok{(sets[[name]],}
      \AttributeTok{vp =} \FunctionTok{viewports}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(test1))[[name]])}
\NormalTok{  \})}
\NormalTok{sets\_vp }\OtherTok{\textless{}{-}} \FunctionTok{viewport}\NormalTok{(}\AttributeTok{layout =} \FunctionTok{grid\_layout}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(test1)))}
\NormalTok{sets }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(ggather, }\FunctionTok{c}\NormalTok{(sets, }\FunctionTok{list}\NormalTok{(}\AttributeTok{vp =}\NormalTok{ sets\_vp)))}

\FunctionTok{set.seed}\NormalTok{(}\DecValTok{120}\NormalTok{)}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{x =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{12}\NormalTok{, }\AttributeTok{y =} \FunctionTok{sort}\NormalTok{(}\FunctionTok{abs}\NormalTok{(}\FunctionTok{rnorm}\NormalTok{(}\DecValTok{12}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{))))}
\NormalTok{p.fRank }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(data) }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y, }\AttributeTok{fill =}\NormalTok{ y)) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_gradientn}\NormalTok{(}\AttributeTok{colors =} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}red\textquotesingle{}}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme\_void}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.ticks =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.position =} \StringTok{\textquotesingle{}none\textquotesingle{}}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_blank}\NormalTok{()}
\NormalTok{g.fRank }\OtherTok{\textless{}{-}} \FunctionTok{as\_grob}\NormalTok{(p.fRank)}

\NormalTok{omit }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"..."}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_void}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{\textquotesingle{}none\textquotesingle{}}\NormalTok{,}
    \AttributeTok{plot.title =}\NormalTok{ MCnebula2}\SpecialCharTok{:::}\FunctionTok{.element\_textbox}\NormalTok{(}
      \AttributeTok{fill =}\NormalTok{ MCnebula2}\SpecialCharTok{:::}\FunctionTok{.get\_label\_color}\NormalTok{()[}\FunctionTok{sample}\NormalTok{(}\DecValTok{2}\SpecialCharTok{:}\DecValTok{6}\NormalTok{, }\DecValTok{1}\NormalTok{)])) }\SpecialCharTok{+}
  \FunctionTok{geom\_blank}\NormalTok{()}
\NormalTok{omit }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(}\FunctionTok{as\_grob}\NormalTok{(omit), }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{9}\NormalTok{))}
\NormalTok{g.sets }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{sets =} \DecValTok{4}\NormalTok{, }\AttributeTok{omit =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{omit =}\NormalTok{ .}\DecValTok{5}\NormalTok{), }\FunctionTok{namel}\NormalTok{(sets, omit))}
\NormalTok{g.step2 }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\AttributeTok{g.fRank =} \DecValTok{1}\NormalTok{, }\AttributeTok{g.sets =} \DecValTok{5}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{2}\NormalTok{),}
  \FunctionTok{namel}\NormalTok{(g.fRank, g.sets, }\AttributeTok{null =} \FunctionTok{nullGrob}\NormalTok{())}
\NormalTok{)}
\NormalTok{g.step2 }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{grecti2}\NormalTok{(}\StringTok{\textquotesingle{}Tracing top features\textquotesingle{}}\NormalTok{, }\AttributeTok{tfill =}\NormalTok{ title\_pals[}\DecValTok{3}\NormalTok{]),}
  \FunctionTok{ggather}\NormalTok{(g.step2, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{95}\NormalTok{, .}\DecValTok{95}\NormalTok{)))}

\NormalTok{g.ab }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{g.step0 =} \DecValTok{1}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{02}\NormalTok{, }\AttributeTok{g.step1.0t3 =} \DecValTok{2}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{02}\NormalTok{, }\AttributeTok{g.step2 =} \DecValTok{1}\NormalTok{),}
  \FunctionTok{namel}\NormalTok{(g.step0, g.step1}\FloatTok{.0}\NormalTok{t3, g.step2, }\AttributeTok{null =} \FunctionTok{nullGrob}\NormalTok{()))}

\FunctionTok{pdf}\NormalTok{(}\StringTok{\textquotesingle{}tocg.pdf\textquotesingle{}}\NormalTok{, }\DecValTok{9}\NormalTok{, }\DecValTok{4}\NormalTok{)}
\FunctionTok{draw}\NormalTok{(g.ab)}
\FunctionTok{dev.off}\NormalTok{()}
\CommentTok{\# dev.new(height = 4, width = 9)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-abs.r}{%
\section{File: abs.R}\label{file-abs.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# draw the graphic abstract}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\FunctionTok{library}\NormalTok{(ggplot2)}

\DocumentationTok{\#\# msms}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{50}\NormalTok{)}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{x =} \FunctionTok{sample}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{50}\NormalTok{, }\DecValTok{10}\NormalTok{), }\AttributeTok{y =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{, }\AttributeTok{mean =} \DecValTok{40}\NormalTok{, }\DecValTok{30}\NormalTok{))}
\NormalTok{p.msms }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(data) }\SpecialCharTok{+}
  \FunctionTok{geom\_segment}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{xend =}\NormalTok{ x, }\AttributeTok{y =} \DecValTok{0}\NormalTok{, }\AttributeTok{yend =} \FunctionTok{abs}\NormalTok{(y)), }\AttributeTok{size =}\NormalTok{ .}\DecValTok{7}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{text =} \FunctionTok{element\_blank}\NormalTok{(), }
    \AttributeTok{axis.ticks =} \FunctionTok{element\_blank}\NormalTok{()) }\SpecialCharTok{+}
  \FunctionTok{geom\_blank}\NormalTok{()}
\NormalTok{g.msms }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{glayer}\NormalTok{(}\DecValTok{3}\NormalTok{, .}\DecValTok{1}\NormalTok{), }\FunctionTok{as\_grob}\NormalTok{(p.msms))}
\NormalTok{g.msms }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\AttributeTok{title =} \DecValTok{1}\NormalTok{, }\AttributeTok{g.msms =} \DecValTok{5}\NormalTok{),}
  \FunctionTok{namel}\NormalTok{(}\AttributeTok{title =} \FunctionTok{gtext}\NormalTok{(}\StringTok{"MS/MS"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{cex =} \FloatTok{1.5}\NormalTok{)), g.msms)}
\NormalTok{)}

\DocumentationTok{\#\# ms1}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{100}\NormalTok{)}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{x =} \SpecialCharTok{{-}}\DecValTok{25}\SpecialCharTok{:}\DecValTok{25}\NormalTok{, }\AttributeTok{y =} \FunctionTok{dnorm}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{25}\SpecialCharTok{:}\DecValTok{25}\NormalTok{, }\DecValTok{0}\NormalTok{, }\FunctionTok{sqrt}\NormalTok{(}\DecValTok{50}\NormalTok{)))}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(data, }\AttributeTok{fill =} \FunctionTok{ifelse}\NormalTok{(}\FunctionTok{abs}\NormalTok{(x) }\SpecialCharTok{\textless{}} \FunctionTok{sqrt}\NormalTok{(}\DecValTok{50}\NormalTok{) }\SpecialCharTok{*} \DecValTok{3}\NormalTok{, }\StringTok{\textquotesingle{}peak\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}zero\textquotesingle{}}\NormalTok{))}
\NormalTok{p.ms1 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(data) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y)) }\SpecialCharTok{+}
  \FunctionTok{geom\_area}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y, }\AttributeTok{fill =}\NormalTok{ fill)) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(ggsci}\SpecialCharTok{::}\FunctionTok{pal\_npg}\NormalTok{()(}\DecValTok{2}\NormalTok{)[}\DecValTok{2}\NormalTok{], }\StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{text =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.ticks =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{geom\_blank}\NormalTok{()}
\NormalTok{g.ms1 }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{glayer}\NormalTok{(}\DecValTok{3}\NormalTok{, .}\DecValTok{1}\NormalTok{), }\FunctionTok{as\_grob}\NormalTok{(p.ms1))}
\NormalTok{g.ms1 }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\AttributeTok{title =} \DecValTok{1}\NormalTok{, }\AttributeTok{g.ms1 =} \DecValTok{5}\NormalTok{),}
  \FunctionTok{namel}\NormalTok{(}\AttributeTok{title =} \FunctionTok{gtext}\NormalTok{(}\StringTok{"Features"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{cex =} \FloatTok{1.5}\NormalTok{)), g.ms1)}
\NormalTok{)}

\DocumentationTok{\#\# rank bar}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{100}\NormalTok{)}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{x =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{7}\NormalTok{, }\AttributeTok{y =} \FunctionTok{sort}\NormalTok{(}\FunctionTok{abs}\NormalTok{(}\FunctionTok{rnorm}\NormalTok{(}\DecValTok{7}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{))))}
\NormalTok{p.rank }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(data) }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y, }\AttributeTok{fill =}\NormalTok{ y)) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_gradientn}\NormalTok{(}\AttributeTok{colors =} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}orange\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}red\textquotesingle{}}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme\_void}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.ticks =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.position =} \StringTok{\textquotesingle{}none\textquotesingle{}}\NormalTok{,}
    \AttributeTok{text =} \FunctionTok{element\_blank}\NormalTok{()) }\SpecialCharTok{+}
  \FunctionTok{geom\_blank}\NormalTok{()}
\NormalTok{g.rank }\OtherTok{\textless{}{-}} \FunctionTok{as\_grob}\NormalTok{(p.rank)}
\NormalTok{g.rank }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\AttributeTok{title =} \DecValTok{1}\NormalTok{, }\AttributeTok{g.rank =} \DecValTok{5}\NormalTok{),}
  \FunctionTok{namel}\NormalTok{(}\AttributeTok{title =} \FunctionTok{gtext}\NormalTok{(}\StringTok{"Ranking"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{cex =} \FloatTok{1.5}\NormalTok{)), g.rank)}
\NormalTok{)}

\DocumentationTok{\#\# identify}
\NormalTok{MCnebula2}\SpecialCharTok{:::}\FunctionTok{.smiles\_to\_cairosvg}\NormalTok{(}
  \StringTok{\textquotesingle{}C1=C(C=C(C(=C1I)OC2=CC(=C(C(=C2)I)O)I)I)CC(C(=O)O)N\textquotesingle{}}\NormalTok{,}
  \StringTok{\textquotesingle{}chemEg.svg\textquotesingle{}}\NormalTok{)}
\NormalTok{struc }\OtherTok{\textless{}{-}} \FunctionTok{.cairosvg\_to\_grob}\NormalTok{(}\StringTok{\textquotesingle{}chemEg.svg\textquotesingle{}}\NormalTok{)}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{x =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{20}\NormalTok{, }\AttributeTok{y =} \FunctionTok{rep}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{), }\DecValTok{10}\NormalTok{))}
\NormalTok{p.step }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(dplyr}\SpecialCharTok{::}\FunctionTok{slice}\NormalTok{(data, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{19}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{geom\_step}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y)) }\SpecialCharTok{+}
  \FunctionTok{coord\_polar}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{8}\NormalTok{, }\DecValTok{1}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme\_void}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{plot.margin =} \FunctionTok{rep}\NormalTok{(}\FunctionTok{u}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{.}\DecValTok{1}\NormalTok{, npc), }\DecValTok{4}\NormalTok{))}
\NormalTok{gear }\OtherTok{\textless{}{-}} \FunctionTok{as\_grob}\NormalTok{(p.step)}
\NormalTok{g.struc }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(struc, gear)}
\NormalTok{g.struc }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\AttributeTok{title =} \DecValTok{1}\NormalTok{, }\AttributeTok{g.struc =} \DecValTok{5}\NormalTok{),}
  \FunctionTok{namel}\NormalTok{(}\AttributeTok{title =} \FunctionTok{gtext}\NormalTok{(}\StringTok{"Prediction"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{cex =} \FloatTok{1.5}\NormalTok{)), g.struc)}
\NormalTok{)}

\DocumentationTok{\#\# network}
\NormalTok{p.nets }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{12}\NormalTok{, }\DecValTok{13}\SpecialCharTok{:}\DecValTok{20}\NormalTok{, }\DecValTok{20}\SpecialCharTok{:}\DecValTok{30}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(ids) \{}
    \FunctionTok{set.seed}\NormalTok{(}\DecValTok{1501}\NormalTok{)}
\NormalTok{    data }\OtherTok{\textless{}{-}} \FunctionTok{random\_graph}\NormalTok{(ids, }\AttributeTok{layout =} \StringTok{\textquotesingle{}kk\textquotesingle{}}\NormalTok{)}
\NormalTok{    p }\OtherTok{\textless{}{-}} \FunctionTok{ggraph}\NormalTok{(data) }\SpecialCharTok{+}
      \FunctionTok{geom\_edge\_fan}\NormalTok{(}\AttributeTok{color =} \StringTok{\textquotesingle{}grey85\textquotesingle{}}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{geom\_node\_point}\NormalTok{(}
        \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y, }\AttributeTok{size =}\NormalTok{ size,}
          \AttributeTok{fill =} \FunctionTok{ifelse}\NormalTok{(name }\SpecialCharTok{==} \StringTok{\textquotesingle{}11\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}target\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}non{-}target\textquotesingle{}}\NormalTok{)),}
        \AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{color =} \StringTok{\textquotesingle{}transparent\textquotesingle{}}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}grey85\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}red\textquotesingle{}}\NormalTok{)) }\SpecialCharTok{+}
      \FunctionTok{ggtitle}\NormalTok{(}\StringTok{\textquotesingle{}Class ...\textquotesingle{}}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{theme\_void}\NormalTok{() }\SpecialCharTok{+}
      \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{\textquotesingle{}none\textquotesingle{}}\NormalTok{,}
        \AttributeTok{text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{family =} \StringTok{"Times"}\NormalTok{),}
        \AttributeTok{plot.title =}\NormalTok{ MCnebula2}\SpecialCharTok{:::}\FunctionTok{.element\_textbox}\NormalTok{(}
          \AttributeTok{fill =}\NormalTok{ MCnebula2}\SpecialCharTok{:::}\FunctionTok{.get\_label\_color}\NormalTok{()[}\FunctionTok{sample}\NormalTok{(}\DecValTok{4}\SpecialCharTok{:}\DecValTok{7}\NormalTok{, }\DecValTok{1}\NormalTok{)])) }\SpecialCharTok{+}
      \FunctionTok{geom\_blank}\NormalTok{()}
\NormalTok{    p }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(}\FunctionTok{as\_grob}\NormalTok{(p), }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{9}\NormalTok{, .}\DecValTok{9}\NormalTok{))}
\NormalTok{  \})}
\FunctionTok{names}\NormalTok{(p.nets) }\OtherTok{\textless{}{-}} \FunctionTok{n}\NormalTok{(net, }\DecValTok{3}\NormalTok{)}
\NormalTok{omits }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(}\FunctionTok{n}\NormalTok{(omit, }\DecValTok{3}\NormalTok{), }\AttributeTok{simplify =}\NormalTok{ F,}
  \ControlFlowTok{function}\NormalTok{(n) \{}
\NormalTok{    omit }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
      \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"..."}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{theme\_void}\NormalTok{() }\SpecialCharTok{+}
      \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{\textquotesingle{}none\textquotesingle{}}\NormalTok{,}
        \AttributeTok{text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{family =} \StringTok{"Times"}\NormalTok{),}
        \AttributeTok{plot.title =}\NormalTok{ MCnebula2}\SpecialCharTok{:::}\FunctionTok{.element\_textbox}\NormalTok{(}
          \AttributeTok{fill =}\NormalTok{ MCnebula2}\SpecialCharTok{:::}\FunctionTok{.get\_label\_color}\NormalTok{()[}\FunctionTok{sample}\NormalTok{(}\DecValTok{2}\SpecialCharTok{:}\DecValTok{6}\NormalTok{, }\DecValTok{1}\NormalTok{)])) }\SpecialCharTok{+}
      \FunctionTok{geom\_blank}\NormalTok{()}
    \FunctionTok{ggather}\NormalTok{(}\FunctionTok{as\_grob}\NormalTok{(omit), }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{9}\NormalTok{))}
\NormalTok{  \})}
\NormalTok{g.nets }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\AttributeTok{net1 =} \DecValTok{1}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{net2 =} \DecValTok{1}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{1}\NormalTok{,}
    \AttributeTok{omit1 =}\NormalTok{ .}\DecValTok{2}\NormalTok{, }\AttributeTok{omit2 =}\NormalTok{ .}\DecValTok{2}\NormalTok{, }\AttributeTok{omit3 =}\NormalTok{ .}\DecValTok{2}\NormalTok{),}
  \FunctionTok{c}\NormalTok{(p.nets, omits, }\FunctionTok{list}\NormalTok{(}\AttributeTok{null =} \FunctionTok{nullGrob}\NormalTok{()))}
\NormalTok{)}
\NormalTok{g.nets }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\AttributeTok{title =} \DecValTok{1}\NormalTok{, }\AttributeTok{g.nets =} \DecValTok{12}\NormalTok{),}
  \FunctionTok{namel}\NormalTok{(}\AttributeTok{title =} \FunctionTok{gtext}\NormalTok{(}\StringTok{"Tracing"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{cex =} \FloatTok{1.5}\NormalTok{)), g.nets)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# gather}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\NormalTok{null }\OtherTok{\textless{}{-}} \FunctionTok{nullGrob}\NormalTok{()}
\NormalTok{spArr }\OtherTok{\textless{}{-}} \FunctionTok{polygonGrob}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, .}\DecValTok{6}\NormalTok{, }\DecValTok{1}\NormalTok{, .}\DecValTok{6}\NormalTok{, }\DecValTok{0}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, .}\DecValTok{5}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{),}
  \AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{lwd =} \FunctionTok{u}\NormalTok{(}\DecValTok{2}\NormalTok{, line), }\AttributeTok{col =} \StringTok{"grey30"}\NormalTok{)}
\NormalTok{)}
\NormalTok{spArr }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(spArr, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{4}\NormalTok{, .}\DecValTok{5}\NormalTok{))}
\NormalTok{frameAr }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{spArr =} \DecValTok{1}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{spArr =} \DecValTok{1}\NormalTok{),}
  \FunctionTok{namel}\NormalTok{(null, spArr))}
\NormalTok{frame1 }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{g.msms =} \DecValTok{1}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{g.ms1 =} \DecValTok{1}\NormalTok{),}
  \FunctionTok{namel}\NormalTok{(g.msms, g.ms1, null))}
\NormalTok{frame2 }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{g.struc =} \DecValTok{1}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{g.rank =} \DecValTok{1}\NormalTok{),}
  \FunctionTok{namel}\NormalTok{(g.struc, g.rank, null))}
\NormalTok{parrow }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\AttributeTok{null =} \DecValTok{1}\NormalTok{, }\AttributeTok{arrow =} \DecValTok{2}\NormalTok{, }\AttributeTok{null =} \DecValTok{4}\NormalTok{),}
  \FunctionTok{namel}\NormalTok{(}\AttributeTok{arrow =} \FunctionTok{parrow}\NormalTok{(}\AttributeTok{col =} \StringTok{\textquotesingle{}black\textquotesingle{}}\NormalTok{), null))}
\NormalTok{frame1a2a3 }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\AttributeTok{frame1 =}\NormalTok{ .}\DecValTok{8}\NormalTok{, }\AttributeTok{frameAr =}\NormalTok{ .}\DecValTok{15}\NormalTok{,}
    \AttributeTok{frame2 =}\NormalTok{ .}\DecValTok{6}\NormalTok{, }\AttributeTok{spArr =}\NormalTok{ .}\DecValTok{15}\NormalTok{, }\AttributeTok{g.nets =} \DecValTok{1}\NormalTok{, }\AttributeTok{parrow =}\NormalTok{ .}\DecValTok{15}\NormalTok{),}
  \FunctionTok{namel}\NormalTok{(frame1, frame2, g.nets, frameAr, spArr, parrow))}

\FunctionTok{pdf}\NormalTok{(}\StringTok{\textquotesingle{}tocg.pdf\textquotesingle{}}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{6}\NormalTok{)}
\FunctionTok{draw}\NormalTok{(}\FunctionTok{ggather}\NormalTok{(frame1a2a3, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{95}\NormalTok{, .}\DecValTok{95}\NormalTok{)))}
\FunctionTok{dev.off}\NormalTok{()}
\CommentTok{\# dev.new(height = 1, width = 2)}
\CommentTok{\# draw(g.nets)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-a_elements.r}{%
\section{File: a\_elements.R}\label{file-a_elements.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# grobs}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\DocumentationTok{\#\# object}
\FunctionTok{load}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(.expath, }\StringTok{"/toActiv30.rdata"}\NormalTok{))}
\NormalTok{test1 }\OtherTok{\textless{}{-}}\NormalTok{ toActiv30}
\NormalTok{ids }\OtherTok{\textless{}{-}} \FunctionTok{features\_annotation}\NormalTok{(test1)}\SpecialCharTok{$}\NormalTok{.features\_id}
\FunctionTok{export\_path}\NormalTok{(test1) }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"/mcnebula\_results"}\NormalTok{)}
\FunctionTok{export\_path}\NormalTok{(test1)}
\NormalTok{the\_id }\OtherTok{\textless{}{-}} \StringTok{"2095"}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{draw\_structures}\NormalTok{(test1, }\AttributeTok{.features\_id =}\NormalTok{ the\_id)}

\DocumentationTok{\#\# get classes dataset}
\NormalTok{class }\OtherTok{\textless{}{-}} \FunctionTok{latest}\NormalTok{(}\FunctionTok{filter\_ppcp}\NormalTok{(test1, }\AttributeTok{pp.threshold =} \DecValTok{0}\NormalTok{))}
\NormalTok{class }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(class, }\AttributeTok{class.name =} \FunctionTok{reorder}\NormalTok{(class.name, dplyr}\SpecialCharTok{::}\FunctionTok{desc}\NormalTok{(pp.value)))}
\NormalTok{class\_2095 }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(class, .features\_id }\SpecialCharTok{==} \SpecialCharTok{!!}\NormalTok{the\_id)}
\NormalTok{class\_2095 }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{arrange}\NormalTok{(class\_2095, class.name)}
\DocumentationTok{\#\# modified the data}
\NormalTok{class }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(class, .features\_id, class.name, pp.value)}
\NormalTok{class }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{split}\NormalTok{(}\FunctionTok{data.frame}\NormalTok{(class), }\SpecialCharTok{\textasciitilde{}}\NormalTok{.features\_id),}
  \ControlFlowTok{function}\NormalTok{(df)\{}
\NormalTok{    df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(df, }\AttributeTok{class.name =} \FunctionTok{reorder}\NormalTok{(class.name, dplyr}\SpecialCharTok{::}\FunctionTok{desc}\NormalTok{(pp.value)))}
    \FunctionTok{head}\NormalTok{(dplyr}\SpecialCharTok{::}\FunctionTok{arrange}\NormalTok{(df, class.name), }\AttributeTok{n =} \DecValTok{30}\NormalTok{)}
\NormalTok{  \})}
\NormalTok{class }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(class)}

\DocumentationTok{\#\# for inner filter}
\NormalTok{class\_in }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(class, .features\_id }\SpecialCharTok{\%in\%} \FunctionTok{as.character}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{2093}\NormalTok{, }\DecValTok{2095}\NormalTok{, }\DecValTok{2097}\NormalTok{)),}
\NormalTok{  pp.value }\SpecialCharTok{\textless{}=} \FloatTok{0.9}\NormalTok{)}
\NormalTok{class\_in }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{bind\_rows}\NormalTok{(class\_in,}
  \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{class.name =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"class"}\NormalTok{, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{3}\NormalTok{),}
    \AttributeTok{pp.value =} \FloatTok{0.5}\NormalTok{,}
    \AttributeTok{.features\_id =} \StringTok{"Others"}
\NormalTok{    ))}

\DocumentationTok{\#\# draw horizontal bar plot for inner filter}
\NormalTok{y.arrow }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{0.4}\NormalTok{, }\FloatTok{0.4}\NormalTok{, }\AttributeTok{length.out =} \DecValTok{3}\NormalTok{)}
\NormalTok{check\_pal }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\AttributeTok{true =} \StringTok{"\#91D1C2FF"}\NormalTok{, }\AttributeTok{false =} \StringTok{"\#E64B35FF"}\NormalTok{)}
\NormalTok{df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(class\_in, .features\_id }\SpecialCharTok{!=} \StringTok{"Others"}\NormalTok{)}
\NormalTok{df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(df, }\AttributeTok{.features\_id =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"ID: "}\NormalTok{, .features\_id))}
\NormalTok{p1 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(df) }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ class.name, }\AttributeTok{y =}\NormalTok{ pp.value,}
      \AttributeTok{fill =} \FunctionTok{ifelse}\NormalTok{(pp.value }\SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{, }\StringTok{"true"}\NormalTok{, }\StringTok{"false"}\NormalTok{),}
\NormalTok{      )) }\SpecialCharTok{+}
  \FunctionTok{geom\_segment}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(df, }\SpecialCharTok{!}\FunctionTok{grepl}\NormalTok{(}\StringTok{"[0{-}9]"}\NormalTok{, class.name), pp.value }\SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{),}
    \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ class.name, }\AttributeTok{xend =}\NormalTok{ class.name, }\AttributeTok{y =} \DecValTok{1}\NormalTok{, }\AttributeTok{yend =} \FloatTok{1.15}\NormalTok{),}
    \AttributeTok{color =}\NormalTok{ check\_pal[[}\StringTok{"true"}\NormalTok{]],}
    \AttributeTok{arrow =} \FunctionTok{arrow}\NormalTok{(}\DecValTok{8}\NormalTok{, }\FunctionTok{unit}\NormalTok{(}\FloatTok{0.1}\NormalTok{, }\StringTok{"inches"}\NormalTok{), }\StringTok{"last"}\NormalTok{, }\StringTok{"closed"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(df, }\FunctionTok{grepl}\NormalTok{(}\StringTok{"[0{-}9]"}\NormalTok{, class.name) }\SpecialCharTok{|}\NormalTok{ pp.value }\SpecialCharTok{\textless{}} \FloatTok{0.5}\NormalTok{),}
    \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ class.name, }\AttributeTok{y =} \DecValTok{1}\NormalTok{),}
    \AttributeTok{shape =} \DecValTok{4}\NormalTok{, }\AttributeTok{color =}\NormalTok{ check\_pal[[}\StringTok{"false"}\NormalTok{]]) }\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(df, }\FunctionTok{grepl}\NormalTok{(}\StringTok{"[0{-}9]"}\NormalTok{, class.name)),}
    \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ class.name, }\AttributeTok{y =} \SpecialCharTok{{-}}\FloatTok{0.05}\NormalTok{, }\AttributeTok{label =}\NormalTok{ stringr}\SpecialCharTok{::}\FunctionTok{str\_wrap}\NormalTok{(class.name, }\DecValTok{30}\NormalTok{)),}
    \AttributeTok{color =} \StringTok{"red"}\NormalTok{,}
    \AttributeTok{family =} \StringTok{"Times"}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{, }\AttributeTok{size =} \FloatTok{1.2}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(df, }\SpecialCharTok{!}\FunctionTok{grepl}\NormalTok{(}\StringTok{"[0{-}9]"}\NormalTok{, class.name)),}
    \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ class.name, }\AttributeTok{y =} \SpecialCharTok{{-}}\FloatTok{0.05}\NormalTok{, }\AttributeTok{label =}\NormalTok{ stringr}\SpecialCharTok{::}\FunctionTok{str\_wrap}\NormalTok{(class.name, }\DecValTok{30}\NormalTok{)),}
    \AttributeTok{color =} \StringTok{"black"}\NormalTok{,}
    \AttributeTok{family =} \StringTok{"Times"}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{, }\AttributeTok{size =} \FloatTok{1.2}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_hline}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{yintercept =} \FloatTok{0.5}\NormalTok{),}
    \AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{color =} \StringTok{"red"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{1.3}\NormalTok{,}\FloatTok{1.3}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{x =} \StringTok{"Classification"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =}\NormalTok{ check\_pal) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{facet\_grid}\NormalTok{(.features\_id }\SpecialCharTok{\textasciitilde{}}\NormalTok{ ., }\AttributeTok{scales =} \StringTok{"free"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{family =} \StringTok{"Times"}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{),}
    \AttributeTok{axis.title.x =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.text =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_blank}\NormalTok{()}
\DocumentationTok{\#\# arrow}
\NormalTok{p1.ex }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_segment}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(class\_in, .features\_id }\SpecialCharTok{==} \StringTok{"Others"}\NormalTok{),}
    \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \DecValTok{5}\NormalTok{, }\AttributeTok{xend =} \DecValTok{1}\NormalTok{, }\AttributeTok{y =}\NormalTok{ y.arrow, }\AttributeTok{yend =}\NormalTok{ y.arrow),}
    \AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{,}
    \AttributeTok{arrow =} \FunctionTok{arrow}\NormalTok{(}\DecValTok{10}\NormalTok{, }\FunctionTok{unit}\NormalTok{(}\FloatTok{0.15}\NormalTok{, }\StringTok{"inches"}\NormalTok{), }\StringTok{"last"}\NormalTok{, }\StringTok{"closed"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{1.3}\NormalTok{,}\FloatTok{1.3}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{y =} \StringTok{"Posterior probability"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =}\NormalTok{ check\_pal) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{facet\_grid}\NormalTok{(.features\_id }\SpecialCharTok{\textasciitilde{}}\NormalTok{ ., }\AttributeTok{scales =} \StringTok{"free"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{family =} \StringTok{"Times"}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{),}
    \AttributeTok{axis.title.y =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.text =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_blank}\NormalTok{()}
\DocumentationTok{\#\# as grob}
\NormalTok{p1 }\OtherTok{\textless{}{-}} \FunctionTok{as\_grob}\NormalTok{(p1)}
\NormalTok{p1.ex }\OtherTok{\textless{}{-}} \FunctionTok{as\_grob}\NormalTok{(p1.ex)}
\NormalTok{p1 }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{p1 =} \DecValTok{3}\NormalTok{, }\AttributeTok{p1.ex =}\NormalTok{ .}\DecValTok{4}\NormalTok{), }\FunctionTok{namel}\NormalTok{(p1, p1.ex))}

\DocumentationTok{\#\# for stardust}
\NormalTok{stardust }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(class, pp.value }\SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{)}
\NormalTok{stardust }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(class, }\SpecialCharTok{!}\FunctionTok{grepl}\NormalTok{(}\StringTok{"[0{-}9]"}\NormalTok{, class.name))}
\NormalTok{stardust }\OtherTok{\textless{}{-}} \FunctionTok{split}\NormalTok{(}\FunctionTok{data.frame}\NormalTok{(stardust), }\SpecialCharTok{\textasciitilde{}} \FunctionTok{as.character}\NormalTok{(class.name))}
\NormalTok{hierarchy }\OtherTok{\textless{}{-}} \FunctionTok{hierarchy}\NormalTok{(test1) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(hierarchy, class.name)}
\NormalTok{index }\OtherTok{\textless{}{-}} \FunctionTok{as.list}\NormalTok{(hierarchy}\SpecialCharTok{$}\NormalTok{hierarchy)}
\FunctionTok{names}\NormalTok{(index) }\OtherTok{\textless{}{-}}\NormalTok{ hierarchy}\SpecialCharTok{$}\NormalTok{class.name}
\NormalTok{label\_color }\OtherTok{\textless{}{-}} \FunctionTok{palette\_label}\NormalTok{(test1)}
\DocumentationTok{\#\# draw network plots}
\FunctionTok{library}\NormalTok{(ggraph)}
\NormalTok{n }\OtherTok{\textless{}{-}} \DecValTok{8}
\NormalTok{lst }\OtherTok{\textless{}{-}} \FunctionTok{mapply}\NormalTok{(}\FunctionTok{head}\NormalTok{(stardust, }\AttributeTok{n =}\NormalTok{ n), }\FunctionTok{names}\NormalTok{(stardust)[}\DecValTok{1}\SpecialCharTok{:}\NormalTok{n],}
  \AttributeTok{SIMPLIFY =}\NormalTok{ F,}
  \AttributeTok{FUN =} \ControlFlowTok{function}\NormalTok{(df, name)\{}
\NormalTok{    edges }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{.features\_id1 =}\NormalTok{ df[}\DecValTok{1}\NormalTok{, ]}\SpecialCharTok{$}\NormalTok{.features\_id,}
      \AttributeTok{.features\_id2 =}\NormalTok{ df[}\FloatTok{1.}\NormalTok{ ]}\SpecialCharTok{$}\NormalTok{.features\_id)}
\NormalTok{    graph }\OtherTok{\textless{}{-}}\NormalTok{ igraph}\SpecialCharTok{::}\FunctionTok{graph\_from\_data\_frame}\NormalTok{(edges, }\AttributeTok{directed =}\NormalTok{ T, }\AttributeTok{vertices =}\NormalTok{ df)}
\NormalTok{    graph }\OtherTok{\textless{}{-}}\NormalTok{ tidygraph}\SpecialCharTok{::}\FunctionTok{as\_tbl\_graph}\NormalTok{(graph)}
\NormalTok{    layout\_n }\OtherTok{\textless{}{-}} \FunctionTok{create\_layout}\NormalTok{(graph, }\AttributeTok{layout =} \StringTok{"kk"}\NormalTok{)}
    \FunctionTok{ggraph}\NormalTok{(layout\_n) }\SpecialCharTok{+}
      \FunctionTok{geom\_node\_point}\NormalTok{(}\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{stroke =} \FloatTok{0.2}\NormalTok{, }\AttributeTok{fill =} \StringTok{"\#D9D9D9"}\NormalTok{, }\AttributeTok{size =} \DecValTok{5}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{theme\_void}\NormalTok{() }\SpecialCharTok{+}
      \FunctionTok{ggtitle}\NormalTok{(stringr}\SpecialCharTok{::}\FunctionTok{str\_wrap}\NormalTok{(name, }\AttributeTok{width =} \DecValTok{30}\NormalTok{)) }\SpecialCharTok{+}
      \FunctionTok{theme}\NormalTok{(}\AttributeTok{text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{family =} \StringTok{"Times"}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{),}
        \AttributeTok{plot.title =}\NormalTok{ ggtext}\SpecialCharTok{::}\FunctionTok{element\_textbox}\NormalTok{(}
          \AttributeTok{size =} \DecValTok{10}\NormalTok{, }\AttributeTok{color =} \StringTok{"white"}\NormalTok{,}
          \AttributeTok{fill =}\NormalTok{ label\_color[ index[[name]] ],}
          \AttributeTok{box.color =} \StringTok{"white"}\NormalTok{,}
          \AttributeTok{halign =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{linetype =} \DecValTok{1}\NormalTok{, }\AttributeTok{r =} \FunctionTok{unit}\NormalTok{(}\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{), }\AttributeTok{width =} \FunctionTok{unit}\NormalTok{(}\DecValTok{1}\NormalTok{, }\StringTok{"npc"}\NormalTok{),}
          \AttributeTok{padding =} \FunctionTok{margin}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{), }\AttributeTok{margin =} \FunctionTok{margin}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{))}
\NormalTok{        ) }\SpecialCharTok{+}
      \FunctionTok{geom\_blank}\NormalTok{()}
\NormalTok{  \})}
\DocumentationTok{\#\# as grob}
\NormalTok{lst }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(lst, as\_grob)}

\DocumentationTok{\#\# ring diagrame}
\NormalTok{text\_gp }\OtherTok{\textless{}{-}} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{cex =} \DecValTok{1}\NormalTok{, }\AttributeTok{fontfamily =} \StringTok{"Times"}\NormalTok{, }\AttributeTok{fontface =} \StringTok{"bold"}\NormalTok{,}
  \AttributeTok{fontsize =} \DecValTok{20}\NormalTok{)}
\NormalTok{p.ring }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{data.frame}\NormalTok{(}\AttributeTok{x =} \DecValTok{1}\NormalTok{, }\AttributeTok{y =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.1}\NormalTok{, }\FloatTok{0.9}\NormalTok{), }\AttributeTok{group =} \FunctionTok{c}\NormalTok{(}\StringTok{"true"}\NormalTok{, }\StringTok{"false"}\NormalTok{))) }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y, }\AttributeTok{fill =}\NormalTok{ group)) }\SpecialCharTok{+}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{"segment"}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.7}\NormalTok{, }\AttributeTok{xend =} \FloatTok{1.7}\NormalTok{, }\AttributeTok{y =} \FloatTok{0.01}\NormalTok{, }\AttributeTok{yend =} \FloatTok{0.08}\NormalTok{,}
    \AttributeTok{arrow =} \FunctionTok{arrow}\NormalTok{(}\AttributeTok{angle =} \DecValTok{10}\NormalTok{, }\AttributeTok{type =} \StringTok{"closed"}\NormalTok{, }\AttributeTok{length =} \FunctionTok{unit}\NormalTok{(}\FloatTok{0.05}\NormalTok{, }\StringTok{"npc"}\NormalTok{))) }\SpecialCharTok{+}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{"segment"}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.6}\NormalTok{, }\AttributeTok{xend =} \FloatTok{1.8}\NormalTok{, }\AttributeTok{y =} \DecValTok{0}\NormalTok{, }\AttributeTok{yend =} \DecValTok{0}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{"segment"}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.6}\NormalTok{, }\AttributeTok{xend =} \FloatTok{1.8}\NormalTok{, }\AttributeTok{y =} \FloatTok{0.1}\NormalTok{, }\AttributeTok{yend =} \FloatTok{0.1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =}\NormalTok{ check\_pal) }\SpecialCharTok{+}
  \FunctionTok{xlim}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{coord\_polar}\NormalTok{(}\AttributeTok{theta =} \StringTok{"y"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Ratio"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_void}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{,}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{family =}\NormalTok{ .font, }\AttributeTok{size =} \DecValTok{6}\NormalTok{, }\AttributeTok{hjust =}\NormalTok{ .}\DecValTok{5}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{geom\_blank}\NormalTok{()}
\DocumentationTok{\#\# as grob}
\NormalTok{p.ring }\OtherTok{\textless{}{-}} \FunctionTok{as\_grob}\NormalTok{(p.ring)}
\DocumentationTok{\#\# another ring...}
\NormalTok{p.ring2 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{data.frame}\NormalTok{(}\AttributeTok{x =} \DecValTok{1}\NormalTok{, }\AttributeTok{y =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.7}\NormalTok{, }\FloatTok{0.3}\NormalTok{), }\AttributeTok{group =} \FunctionTok{c}\NormalTok{(}\StringTok{"true"}\NormalTok{, }\StringTok{"false"}\NormalTok{))) }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y, }\AttributeTok{fill =}\NormalTok{ group)) }\SpecialCharTok{+}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{"segment"}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.7}\NormalTok{, }\AttributeTok{xend =} \FloatTok{1.7}\NormalTok{, }\AttributeTok{y =} \FloatTok{0.01}\NormalTok{, }\AttributeTok{yend =} \FloatTok{0.68}\NormalTok{,}
    \AttributeTok{arrow =} \FunctionTok{arrow}\NormalTok{(}\AttributeTok{angle =} \DecValTok{10}\NormalTok{, }\AttributeTok{type =} \StringTok{"closed"}\NormalTok{, }\AttributeTok{length =} \FunctionTok{unit}\NormalTok{(}\FloatTok{0.05}\NormalTok{, }\StringTok{"npc"}\NormalTok{))) }\SpecialCharTok{+}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{"segment"}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.6}\NormalTok{, }\AttributeTok{xend =} \FloatTok{1.8}\NormalTok{, }\AttributeTok{y =} \DecValTok{0}\NormalTok{, }\AttributeTok{yend =} \DecValTok{0}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{"segment"}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.6}\NormalTok{, }\AttributeTok{xend =} \FloatTok{1.8}\NormalTok{, }\AttributeTok{y =} \FloatTok{0.7}\NormalTok{, }\AttributeTok{yend =} \FloatTok{0.7}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =}\NormalTok{ check\_pal) }\SpecialCharTok{+}
  \FunctionTok{xlim}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{coord\_polar}\NormalTok{(}\AttributeTok{theta =} \StringTok{"y"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Score distribution"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_void}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{,}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{family =}\NormalTok{ .font, }\AttributeTok{size =} \DecValTok{6}\NormalTok{, }\AttributeTok{hjust =}\NormalTok{ .}\DecValTok{5}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{geom\_blank}\NormalTok{()}
\DocumentationTok{\#\# as grob}
\NormalTok{p.ring2 }\OtherTok{\textless{}{-}} \FunctionTok{as\_grob}\NormalTok{(p.ring2)}

\DocumentationTok{\#\# bar diagrame}
\NormalTok{p.bar }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{data.frame}\NormalTok{(}\AttributeTok{x =} \DecValTok{1}\NormalTok{, }\AttributeTok{y =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.1}\NormalTok{, }\FloatTok{0.9}\NormalTok{), }\AttributeTok{group =} \FunctionTok{c}\NormalTok{(}\StringTok{"false"}\NormalTok{, }\StringTok{"true"}\NormalTok{))) }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y, }\AttributeTok{fill =} \FunctionTok{reorder}\NormalTok{(group, }\FunctionTok{desc}\NormalTok{(y))), }\AttributeTok{width =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{"segment"}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.7}\NormalTok{, }\AttributeTok{xend =} \FloatTok{1.7}\NormalTok{, }\AttributeTok{y =} \FloatTok{0.12}\NormalTok{, }\AttributeTok{yend =} \FloatTok{0.98}\NormalTok{,}
    \AttributeTok{arrow =} \FunctionTok{arrow}\NormalTok{(}\AttributeTok{angle =} \DecValTok{10}\NormalTok{, }\AttributeTok{type =} \StringTok{"closed"}\NormalTok{, }\AttributeTok{length =} \FunctionTok{unit}\NormalTok{(}\FloatTok{0.05}\NormalTok{, }\StringTok{"npc"}\NormalTok{))) }\SpecialCharTok{+}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{"segment"}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.6}\NormalTok{, }\AttributeTok{xend =} \FloatTok{1.8}\NormalTok{, }\AttributeTok{y =} \FloatTok{0.1}\NormalTok{, }\AttributeTok{yend =} \FloatTok{0.1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =}\NormalTok{ check\_pal) }\SpecialCharTok{+}
  \FunctionTok{xlim}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{2}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Number"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_void}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{,}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{family =}\NormalTok{ .font, }\AttributeTok{size =} \DecValTok{6}\NormalTok{, }\AttributeTok{hjust =}\NormalTok{ .}\DecValTok{5}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{geom\_blank}\NormalTok{()}
\DocumentationTok{\#\# as grob}
\NormalTok{p.bar }\OtherTok{\textless{}{-}} \FunctionTok{as\_grob}\NormalTok{(p.bar)}

\DocumentationTok{\#\# peak simbolized for feature }
\NormalTok{p.peak }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{data.frame}\NormalTok{(}\AttributeTok{x =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{20}\NormalTok{, }\AttributeTok{y =} \FunctionTok{dnorm}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{20}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{3}\NormalTok{)), }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y)) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{x =} \StringTok{"RT"}\NormalTok{, }\AttributeTok{y =} \StringTok{"Intensity"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{text =} \FunctionTok{element\_blank}\NormalTok{())}
\NormalTok{p.peak.yellow }\OtherTok{\textless{}{-}}\NormalTok{ p.peak }\SpecialCharTok{+} 
  \FunctionTok{geom\_area}\NormalTok{(}\AttributeTok{fill =} \StringTok{"lightyellow"}\NormalTok{) }
\NormalTok{p.peak.grey }\OtherTok{\textless{}{-}}\NormalTok{ p.peak }\SpecialCharTok{+}
  \FunctionTok{geom\_area}\NormalTok{(}\AttributeTok{fill =} \StringTok{"\#D9D9D9"}\NormalTok{) }
\DocumentationTok{\#\# as grob}
\NormalTok{p.peak }\OtherTok{\textless{}{-}} \FunctionTok{as\_grob}\NormalTok{(p.peak)}
\NormalTok{p.peak.yellow }\OtherTok{\textless{}{-}} \FunctionTok{as\_grob}\NormalTok{(p.peak.yellow)}
\NormalTok{p.peak.grey }\OtherTok{\textless{}{-}} \FunctionTok{as\_grob}\NormalTok{(p.peak.grey)}

\DocumentationTok{\#\# boxplot}
\NormalTok{struc\_2095 }\OtherTok{\textless{}{-}} \FunctionTok{structures\_grob}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(test1))[[ the\_id ]]}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{100}\NormalTok{)}
\NormalTok{simu\_score }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{.features\_id =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{50}\NormalTok{, }\AttributeTok{score =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{50}\NormalTok{, }\FloatTok{0.4}\NormalTok{, }\FloatTok{0.15}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(}\AttributeTok{group =} \FunctionTok{ifelse}\NormalTok{(score }\SpecialCharTok{\textgreater{}=} \FloatTok{0.3}\NormalTok{, }\StringTok{"true"}\NormalTok{, }\StringTok{"false"}\NormalTok{))}
\NormalTok{p.box }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(simu\_score, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \StringTok{""}\NormalTok{, }\AttributeTok{y =}\NormalTok{ score)) }\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{color =} \StringTok{"red"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_jitter}\NormalTok{(}\AttributeTok{width =} \FloatTok{0.1}\NormalTok{, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{color =}\NormalTok{ group)) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{x =} \StringTok{""}\NormalTok{, }\AttributeTok{y =} \StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \CommentTok{\# ggtitle("Identified score") +}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =}\NormalTok{ check\_pal) }\SpecialCharTok{+}
  \FunctionTok{theme\_void}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{,}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =}\NormalTok{ .}\DecValTok{5}\NormalTok{),}
    \AttributeTok{text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{family =}\NormalTok{ .font, }\AttributeTok{size =} \DecValTok{5}\NormalTok{),}
    \CommentTok{\# panel.grid = element\_blank(),}
    \CommentTok{\# plot.background = element\_blank(),}
    \CommentTok{\# panel.background = element\_blank(),}
    \AttributeTok{axis.ticks =} \FunctionTok{element\_blank}\NormalTok{()) }\SpecialCharTok{+}
  \FunctionTok{geom\_blank}\NormalTok{()}
\DocumentationTok{\#\# as grob}
\NormalTok{p.box }\OtherTok{\textless{}{-}} \FunctionTok{as\_grob}\NormalTok{(p.box)}

\DocumentationTok{\#\# ratio bar plot}
\NormalTok{ratio }\OtherTok{\textless{}{-}} \FunctionTok{table}\NormalTok{(simu\_score}\SpecialCharTok{$}\NormalTok{group) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{prop.table}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{as.data.frame}\NormalTok{()}
\NormalTok{p.ratio }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(ratio, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \DecValTok{1}\NormalTok{, }\AttributeTok{y =}\NormalTok{ Freq, }\AttributeTok{fill =} \FunctionTok{reorder}\NormalTok{(Var1, }\FunctionTok{desc}\NormalTok{(Freq)))) }\SpecialCharTok{+}
\NormalTok{  ggchicklet}\SpecialCharTok{::}\FunctionTok{geom\_chicklet}\NormalTok{(}\AttributeTok{radius =} \FunctionTok{unit}\NormalTok{(}\FloatTok{0.1}\NormalTok{, }\StringTok{"npc"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \FloatTok{0.6}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{color =} \StringTok{"red"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =}\NormalTok{ check\_pal) }\SpecialCharTok{+}
  \FunctionTok{xlim}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{2}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{text =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_blank}\NormalTok{()}
  \DocumentationTok{\#\# as\_grob}
\NormalTok{p.ratio }\OtherTok{\textless{}{-}} \FunctionTok{as\_grob}\NormalTok{(p.ratio)}

\DocumentationTok{\#\# assessment}
\NormalTok{df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(}\FunctionTok{stardust\_classes}\NormalTok{(test1), hierarchy }\SpecialCharTok{\textgreater{}=} \DecValTok{3}\NormalTok{)}
\NormalTok{parents }\OtherTok{\textless{}{-}} \FunctionTok{get\_parent\_classes}\NormalTok{(}\FunctionTok{unique}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{class.name), test1)}
\NormalTok{set }\OtherTok{\textless{}{-}}\NormalTok{ parents[}\SpecialCharTok{!}\FunctionTok{vapply}\NormalTok{(parents, is.null, }\FunctionTok{logical}\NormalTok{(}\DecValTok{1}\NormalTok{))]}
\NormalTok{set }\OtherTok{\textless{}{-}}\NormalTok{ set[}\FunctionTok{vapply}\NormalTok{(set, }\ControlFlowTok{function}\NormalTok{(cl) }\ControlFlowTok{if}\NormalTok{ (}\FunctionTok{any}\NormalTok{(cl }\SpecialCharTok{\%in\%} \FunctionTok{unique}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{class.name) )) T }\ControlFlowTok{else}\NormalTok{ F, T)]}
\DocumentationTok{\#\# draw}
\NormalTok{ec }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Carboxylic acids"}\NormalTok{)}
\NormalTok{ec. }\OtherTok{\textless{}{-}} \StringTok{"Child..."}
\NormalTok{ep }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Carboxylic acids and derivatives"}\NormalTok{)}
\NormalTok{ep. }\OtherTok{\textless{}{-}} \StringTok{"Parent..."}
\NormalTok{labels }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{c}\NormalTok{(ec., ep., }\StringTok{"Class..."}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(lab) \{}
    \FunctionTok{zo}\NormalTok{(}\FunctionTok{into}\NormalTok{(}\FunctionTok{grectn}\NormalTok{(}\AttributeTok{bgp\_args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{lty =} \StringTok{"solid"}\NormalTok{)),}
        \FunctionTok{gtextp}\NormalTok{(stringr}\SpecialCharTok{::}\FunctionTok{str\_wrap}\NormalTok{(lab, }\DecValTok{15}\NormalTok{), }\FunctionTok{list}\NormalTok{(}\AttributeTok{col =} \StringTok{"white"}\NormalTok{, }\AttributeTok{cex =}\NormalTok{ .}\DecValTok{6}\NormalTok{))))}
\NormalTok{  \})}
\FunctionTok{names}\NormalTok{(labels) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"ec"}\NormalTok{, }\StringTok{"ep"}\NormalTok{, }\StringTok{"omit"}\NormalTok{)}
\NormalTok{labels}\SpecialCharTok{$}\NormalTok{null }\OtherTok{\textless{}{-}} \FunctionTok{nullGrob}\NormalTok{()}
\DocumentationTok{\#\# frame}
\NormalTok{scolor }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(grobs, hier, }\AttributeTok{color =} \FunctionTok{palette\_label}\NormalTok{(test1)[hier]) \{}
  \FunctionTok{lapply}\NormalTok{(grobs,}
    \ControlFlowTok{function}\NormalTok{(grob) \{}
      \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is}\NormalTok{(grob, }\StringTok{"null"}\NormalTok{)) }\FunctionTok{return}\NormalTok{(grob)}
      \ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{        grob}\SpecialCharTok{$}\NormalTok{children[[}\DecValTok{1}\NormalTok{]]}\SpecialCharTok{$}\NormalTok{children[[}\DecValTok{1}\NormalTok{]]}\SpecialCharTok{$}\NormalTok{gp}\SpecialCharTok{$}\NormalTok{fill }\OtherTok{\textless{}{-}}\NormalTok{ color}
\NormalTok{        grob}\SpecialCharTok{$}\NormalTok{children[[}\DecValTok{1}\NormalTok{]]}\SpecialCharTok{$}\NormalTok{children[[}\DecValTok{1}\NormalTok{]]}\SpecialCharTok{$}\NormalTok{gp}\SpecialCharTok{$}\NormalTok{col }\OtherTok{\textless{}{-}} \StringTok{"transparent"}
        \FunctionTok{return}\NormalTok{(grob)}
\NormalTok{      \}}
\NormalTok{    \})}
\NormalTok{\}}
\NormalTok{frame1 }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{null =}\NormalTok{ .}\DecValTok{3}\NormalTok{, }\AttributeTok{omit =}\NormalTok{ .}\DecValTok{4}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{3}\NormalTok{, }\AttributeTok{omit =}\NormalTok{ .}\DecValTok{4}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{3}\NormalTok{),}
  \FunctionTok{scolor}\NormalTok{(labels, }\DecValTok{2}\NormalTok{))}
\NormalTok{frame2 }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{omit =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{3}\NormalTok{, }\AttributeTok{ep =} \DecValTok{1}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{3}\NormalTok{, }\AttributeTok{omit =}\NormalTok{ .}\DecValTok{5}\NormalTok{),}
  \FunctionTok{scolor}\NormalTok{(labels, }\DecValTok{3}\NormalTok{))}
\NormalTok{frame3 }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{null =}\NormalTok{ .}\DecValTok{3}\NormalTok{, }\AttributeTok{ec =} \DecValTok{1}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{3}\NormalTok{, }\AttributeTok{omit =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{3}\NormalTok{),}
  \FunctionTok{scolor}\NormalTok{(labels, }\DecValTok{4}\NormalTok{))}
\NormalTok{frame }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{frame1 =} \DecValTok{1}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{6}\NormalTok{, }\AttributeTok{frame2 =} \DecValTok{1}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{6}\NormalTok{, }\AttributeTok{frame3 =} \DecValTok{1}\NormalTok{),}
  \FunctionTok{namel}\NormalTok{(frame1, frame2, frame3, }\AttributeTok{null =} \FunctionTok{nullGrob}\NormalTok{()))}
\DocumentationTok{\#\# arrows}
\NormalTok{path }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"frame1::.*::omit.rep.2"}\NormalTok{, }\StringTok{"frame2::.*::omit"}\NormalTok{,}
  \StringTok{"frame2::.*::ep"}\NormalTok{, }\StringTok{"frame2::.*::omit.rep.2"}\NormalTok{, }\StringTok{"frame3::.*::ec"}\NormalTok{, }\StringTok{"frame3::.*omit"}\NormalTok{)}
\NormalTok{nulls }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(path, }\ControlFlowTok{function}\NormalTok{(p) \{}
  \FunctionTok{list}\NormalTok{(}\AttributeTok{l =} \FunctionTok{setnullvp}\NormalTok{(p, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \DecValTok{0}\NormalTok{, }\AttributeTok{y =}\NormalTok{ .}\DecValTok{5}\NormalTok{), frame),}
    \AttributeTok{r =} \FunctionTok{setnullvp}\NormalTok{(p, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \DecValTok{1}\NormalTok{, }\AttributeTok{y =}\NormalTok{ .}\DecValTok{5}\NormalTok{), frame))}
\NormalTok{  \})}
\FunctionTok{names}\NormalTok{(nulls) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"n1.2"}\NormalTok{, }\StringTok{"n2.1"}\NormalTok{, }\StringTok{"ep"}\NormalTok{, }\StringTok{"n2.3"}\NormalTok{, }\StringTok{"ec"}\NormalTok{, }\StringTok{"n3.2"}\NormalTok{)}
\NormalTok{arr1\_2 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"n2.1"}\NormalTok{, }\StringTok{"ep"}\NormalTok{, }\StringTok{"n2.3"}\NormalTok{)}
\NormalTok{cur }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{.}\DecValTok{1}\NormalTok{, .}\DecValTok{2}\NormalTok{, .}\DecValTok{3}\NormalTok{)}
\NormalTok{arr\_gpar }\OtherTok{\textless{}{-}} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fill =} \FunctionTok{palette\_label}\NormalTok{(test1)[}\DecValTok{2}\NormalTok{], }\AttributeTok{col =} \FunctionTok{palette\_label}\NormalTok{(test1)[}\DecValTok{2}\NormalTok{])}
\NormalTok{arr1\_2 }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(arr1\_2),}
  \ControlFlowTok{function}\NormalTok{(n) \{}
\NormalTok{    no }\OtherTok{\textless{}{-}}\NormalTok{ arr1\_2[n]}
    \FunctionTok{garrow}\NormalTok{(nulls}\SpecialCharTok{$}\NormalTok{n1}\FloatTok{.2}\SpecialCharTok{$}\NormalTok{r, nulls[[no]]}\SpecialCharTok{$}\NormalTok{l,}
      \FunctionTok{list}\NormalTok{(}\AttributeTok{curvature =}\NormalTok{ cur[n], }\AttributeTok{gp =}\NormalTok{ arr\_gpar))}
\NormalTok{  \})}
\NormalTok{arr2\_3 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"ec"}\NormalTok{, }\StringTok{"n3.2"}\NormalTok{)}
\NormalTok{cur }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{.}\DecValTok{1}\NormalTok{, .}\DecValTok{2}\NormalTok{)}
\NormalTok{arr2\_3 }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(arr2\_3),}
  \ControlFlowTok{function}\NormalTok{(n) \{}
\NormalTok{    no }\OtherTok{\textless{}{-}}\NormalTok{ arr2\_3[n]}
    \FunctionTok{garrow}\NormalTok{(nulls}\SpecialCharTok{$}\NormalTok{ep}\SpecialCharTok{$}\NormalTok{r, nulls[[no]]}\SpecialCharTok{$}\NormalTok{l, }
      \FunctionTok{list}\NormalTok{(}\AttributeTok{curvature =}\NormalTok{ cur[n], }\AttributeTok{gp =}\NormalTok{ arr\_gpar))}
\NormalTok{  \})}
\DocumentationTok{\#\# gather}
\NormalTok{bg }\OtherTok{\textless{}{-}} \FunctionTok{rectGrob}\NormalTok{(.}\DecValTok{3}\NormalTok{, , .}\DecValTok{7}\NormalTok{, }\FloatTok{1.1}\NormalTok{, }\AttributeTok{just =} \FunctionTok{c}\NormalTok{(}\StringTok{"left"}\NormalTok{, }\StringTok{"centre"}\NormalTok{),}
  \AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{col =} \StringTok{"transparent"}\NormalTok{, }\AttributeTok{fill =} \StringTok{"lightyellow"}\NormalTok{))}
\NormalTok{hier\_tree }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(ggather, }\FunctionTok{c}\NormalTok{(}\FunctionTok{list}\NormalTok{(bg), }\FunctionTok{list}\NormalTok{(frame), arr1\_2, arr2\_3))}

\DocumentationTok{\#\# venn plot}
\NormalTok{conts }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(df, class.name }\SpecialCharTok{==}\NormalTok{ ep)}\SpecialCharTok{$}\NormalTok{.features\_id,}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(df, class.name }\SpecialCharTok{==}\NormalTok{ ec)}\SpecialCharTok{$}\NormalTok{.features\_id)}
\NormalTok{feas }\OtherTok{\textless{}{-}} \FunctionTok{unique}\NormalTok{(}\FunctionTok{c}\NormalTok{(conts[[}\DecValTok{1}\NormalTok{]], conts[[}\DecValTok{2}\NormalTok{]]))}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{a =}\NormalTok{ feas }\SpecialCharTok{\%in\%}\NormalTok{ conts[[}\DecValTok{1}\NormalTok{]], }\AttributeTok{b =}\NormalTok{ feas }\SpecialCharTok{\%in\%}\NormalTok{ conts[[}\DecValTok{2}\NormalTok{]])}
\NormalTok{names }\OtherTok{\textless{}{-}}\NormalTok{ stringr}\SpecialCharTok{::}\FunctionTok{str\_trunc}\NormalTok{(}\FunctionTok{c}\NormalTok{(ep, ec), }\DecValTok{15}\NormalTok{, }\StringTok{"cen"}\NormalTok{)}
\NormalTok{cir }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(}\FunctionTok{circleGrob}\NormalTok{(.}\DecValTok{3}\NormalTok{, }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{alpha =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{fill =} \FunctionTok{palette\_label}\NormalTok{(test1)[}\DecValTok{3}\NormalTok{])),}
  \FunctionTok{circleGrob}\NormalTok{(.}\DecValTok{7}\NormalTok{, }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{alpha =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{fill =} \FunctionTok{palette\_label}\NormalTok{(test1)[}\DecValTok{4}\NormalTok{])))}
\NormalTok{venn.text }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \DecValTok{1}\NormalTok{, }\AttributeTok{null =} \DecValTok{1}\NormalTok{),}
  \FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \FunctionTok{gtextp}\NormalTok{(}\StringTok{"Overlap Ratio"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{cex =}\NormalTok{ .}\DecValTok{5}\NormalTok{), }\AttributeTok{x =}\NormalTok{ .}\DecValTok{8}\NormalTok{, }\AttributeTok{y =} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{),}
    \AttributeTok{null =} \FunctionTok{nullGrob}\NormalTok{()))}
\NormalTok{venn }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{null =}\NormalTok{ .}\DecValTok{05}\NormalTok{, }\AttributeTok{tit =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{cont =} \DecValTok{2}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{05}\NormalTok{),}
  \FunctionTok{list}\NormalTok{(}\AttributeTok{tit =}\NormalTok{ venn.text, }\AttributeTok{cont =}\NormalTok{ cir, }\AttributeTok{null =} \FunctionTok{nullGrob}\NormalTok{()))}

\DocumentationTok{\#\# upset plot}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{101}\NormalTok{)}
\NormalTok{rand }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(}\FunctionTok{unique}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{class.name), }\DecValTok{3}\NormalTok{)}
\NormalTok{comc }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(ep, ec, rand)}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(df, class.name }\SpecialCharTok{\%in\%}\NormalTok{ comc)}
\NormalTok{mutate }\OtherTok{\textless{}{-}} \FunctionTok{.as\_dic}\NormalTok{(}\FunctionTok{c}\NormalTok{(ep., ec., }\FunctionTok{paste0}\NormalTok{(}\FunctionTok{n}\NormalTok{(Class, }\DecValTok{2}\NormalTok{), }\StringTok{"..."}\NormalTok{), }\StringTok{"..."}\NormalTok{), }\FunctionTok{c}\NormalTok{(ep, ec, rand), , F)}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(data, }\AttributeTok{class.name =}
  \FunctionTok{vapply}\NormalTok{(class.name, }\AttributeTok{FUN.VALUE =} \FunctionTok{character}\NormalTok{(}\DecValTok{1}\NormalTok{), }\AttributeTok{USE.NAMES =}\NormalTok{ F,}
    \ControlFlowTok{function}\NormalTok{(cl) \{}
      \FunctionTok{do.call}\NormalTok{(}\ControlFlowTok{switch}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\FunctionTok{list}\NormalTok{(cl), mutate))}
\NormalTok{    \}))}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{split}\NormalTok{(data, }\SpecialCharTok{\textasciitilde{}}\NormalTok{.features\_id), }\ControlFlowTok{function}\NormalTok{(df) df}\SpecialCharTok{$}\NormalTok{class.name)}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(data,}
  \ControlFlowTok{function}\NormalTok{(cl) \{}
    \FunctionTok{unlist}\NormalTok{(}\FunctionTok{lapply}\NormalTok{(cl,}
        \ControlFlowTok{function}\NormalTok{(cl) \{}
\NormalTok{          mutate }\OtherTok{\textless{}{-}}\NormalTok{ mutate[mutate }\SpecialCharTok{!=}\NormalTok{ cl]}
          \FunctionTok{vapply}\NormalTok{(mutate, }\AttributeTok{FUN.VALUE =} \FunctionTok{character}\NormalTok{(}\DecValTok{1}\NormalTok{),}
            \ControlFlowTok{function}\NormalTok{(v) \{}
              \FunctionTok{paste0}\NormalTok{(}\FunctionTok{sort}\NormalTok{(}\FunctionTok{c}\NormalTok{(v, cl)), }\AttributeTok{collapse =} \StringTok{"\_"}\NormalTok{)}
\NormalTok{            \})}
\NormalTok{        \}))}
\NormalTok{  \})}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ tibble}\SpecialCharTok{::}\FunctionTok{tibble}\NormalTok{(}\AttributeTok{Class =} \FunctionTok{unlist}\NormalTok{(data))}
\NormalTok{p.upset }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(data, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Class)) }\SpecialCharTok{+}
  \FunctionTok{geom\_bar}\NormalTok{() }\SpecialCharTok{+}
\NormalTok{  ggupset}\SpecialCharTok{::}\FunctionTok{axis\_combmatrix}\NormalTok{(}\AttributeTok{sep =} \StringTok{"\_"}\NormalTok{, }\AttributeTok{levels =} \FunctionTok{unlist}\NormalTok{(mutate, }\AttributeTok{use.names =}\NormalTok{ F)) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{family =}\NormalTok{ .font),}
    \AttributeTok{axis.text.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{5}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{size =} \DecValTok{6}\NormalTok{),}
    \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{6}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{y =} \StringTok{"Number"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Overlap Number"}\NormalTok{) }\SpecialCharTok{+}
\NormalTok{  ggupset}\SpecialCharTok{::}\FunctionTok{theme\_combmatrix}\NormalTok{(}
    \AttributeTok{combmatrix.label.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{family =}\NormalTok{ .font, }\AttributeTok{size =} \DecValTok{5}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{geom\_blank}\NormalTok{()}
\NormalTok{p.upset }\OtherTok{\textless{}{-}} \FunctionTok{as\_grob}\NormalTok{(p.upset)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-b_gather.r}{%
\section{File: b\_gather.R}\label{file-b_gather.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# gather the grobs as a figure}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\NormalTok{pal }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\AttributeTok{fun =} \StringTok{"\#BC3C29FF"}\NormalTok{, }\AttributeTok{ex =} \StringTok{"\#E18727FF"}\NormalTok{)}

\DocumentationTok{\#\# inner filter}
\NormalTok{inner }\OtherTok{\textless{}{-}} \FunctionTok{grecti3}\NormalTok{(}\StringTok{"inner filter"}\NormalTok{, }\AttributeTok{tfill =}\NormalTok{ pal[[ }\StringTok{"fun"}\NormalTok{ ]])}
\NormalTok{inner }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(inner, p1)}

\DocumentationTok{\#\# stardust classes}
\NormalTok{stardust }\OtherTok{\textless{}{-}} \FunctionTok{grecti3}\NormalTok{(}\StringTok{"stardust classes"}\NormalTok{, }\AttributeTok{tfill =}\NormalTok{ pal[[ }\StringTok{"ex"}\NormalTok{ ]])}
\NormalTok{stardust }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(stardust, }\FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{fill\_list}\NormalTok{(}\FunctionTok{names}\NormalTok{(lst), }\DecValTok{1}\NormalTok{), lst))}

\DocumentationTok{\#\# quantity}
\NormalTok{ass }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{glayer}\NormalTok{(}\DecValTok{4}\NormalTok{), p.peak.yellow)}
\NormalTok{sum }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{glayer}\NormalTok{(}\DecValTok{6}\NormalTok{), p.peak.grey)}
\NormalTok{seg }\OtherTok{\textless{}{-}} \FunctionTok{segmentsGrob}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{arr }\OtherTok{\textless{}{-}} \FunctionTok{parrow}\NormalTok{(}\DecValTok{3}\NormalTok{, }\StringTok{"black"}\NormalTok{, }\StringTok{"solid"}\NormalTok{)}
\NormalTok{mp.ring }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(p.ring, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(.}\DecValTok{4}\NormalTok{, , .}\DecValTok{8}\NormalTok{))}
\NormalTok{c1 }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{ass =} \DecValTok{1}\NormalTok{, }\AttributeTok{seg =}\NormalTok{ .}\DecValTok{4}\NormalTok{, }\AttributeTok{sum =} \DecValTok{1}\NormalTok{, }\AttributeTok{arr =}\NormalTok{ .}\DecValTok{3}\NormalTok{, }\AttributeTok{mp.ring =} \DecValTok{1}\NormalTok{),}
                \FunctionTok{namel}\NormalTok{(ass, seg, sum, arr, mp.ring))}
\NormalTok{mp.bar }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(p.bar, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(.}\DecValTok{2}\NormalTok{, , .}\DecValTok{8}\NormalTok{))}
\NormalTok{c2 }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{ass =} \DecValTok{1}\NormalTok{, }\AttributeTok{arr =}\NormalTok{ .}\DecValTok{3}\NormalTok{, }\AttributeTok{mp.bar =} \DecValTok{1}\NormalTok{), }\FunctionTok{namel}\NormalTok{(ass, arr, mp.bar))}
\NormalTok{sep }\OtherTok{\textless{}{-}} \FunctionTok{segmentsGrob}\NormalTok{(.}\DecValTok{5}\NormalTok{, .}\DecValTok{1}\NormalTok{, .}\DecValTok{5}\NormalTok{, .}\DecValTok{9}\NormalTok{)}
\DocumentationTok{\#\# gather}
\NormalTok{content }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{c1 =} \DecValTok{1}\NormalTok{, }\AttributeTok{c2 =}\NormalTok{ .}\DecValTok{7}\NormalTok{), }\FunctionTok{namel}\NormalTok{(c1, c2))}
\NormalTok{quantity }\OtherTok{\textless{}{-}} \FunctionTok{grectn\_frame}\NormalTok{(}\FunctionTok{zo}\NormalTok{(content, }\AttributeTok{h =}\NormalTok{ .}\DecValTok{7}\NormalTok{), }\FunctionTok{gtext0}\NormalTok{(}\StringTok{"quantity  (Abundance selection)"}\NormalTok{), }\AttributeTok{zo =}\NormalTok{ F)}

\DocumentationTok{\#\# score}
\NormalTok{struc }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{glayer}\NormalTok{(}\DecValTok{4}\NormalTok{), struc\_2095)}
\DocumentationTok{\#\# gather}
\NormalTok{content }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{struc =} \DecValTok{1}\NormalTok{, }\AttributeTok{arr =}\NormalTok{ .}\DecValTok{3}\NormalTok{, }\AttributeTok{p.box =} \DecValTok{1}\NormalTok{, }\AttributeTok{arr =}\NormalTok{ .}\DecValTok{3}\NormalTok{, }\AttributeTok{p.ring2 =} \DecValTok{1}\NormalTok{),}
                     \FunctionTok{namel}\NormalTok{(struc, arr, p.box, p.ring2))}
\NormalTok{score }\OtherTok{\textless{}{-}} \FunctionTok{grectn\_frame}\NormalTok{(}\FunctionTok{zo}\NormalTok{(content, }\AttributeTok{h =}\NormalTok{ .}\DecValTok{8}\NormalTok{), }\FunctionTok{gtext0}\NormalTok{(}\StringTok{"score  (Goodness assessment)"}\NormalTok{), }\AttributeTok{zo =}\NormalTok{ F)}

\DocumentationTok{\#\# identical}
\NormalTok{identical }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{hier\_tree =}\NormalTok{ .}\DecValTok{7}\NormalTok{, }\AttributeTok{arr =}\NormalTok{ .}\DecValTok{15}\NormalTok{, }\AttributeTok{p.upset =} \FloatTok{1.4}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{venn =}\NormalTok{ .}\DecValTok{3}\NormalTok{),}
                       \FunctionTok{namel}\NormalTok{(hier\_tree, arr, venn, }\AttributeTok{null =} \FunctionTok{nullGrob}\NormalTok{(), p.upset))}
\NormalTok{identical }\OtherTok{\textless{}{-}} \FunctionTok{grectn\_frame}\NormalTok{(identical, }\FunctionTok{gtext0}\NormalTok{(}\StringTok{"identical  (Identicality assessment)"}\NormalTok{))}

\DocumentationTok{\#\# cross}
\NormalTok{cross }\OtherTok{\textless{}{-}} \FunctionTok{grecti3}\NormalTok{(}\StringTok{"cross filter"}\NormalTok{, }\AttributeTok{tfill =}\NormalTok{ pal[[ }\StringTok{"fun"}\NormalTok{ ]])}
\NormalTok{obj }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(}\FunctionTok{namel}\NormalTok{(quantity, score, identical), zo, }\AttributeTok{simplify =}\NormalTok{ F)}
\NormalTok{obj }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{fill\_list}\NormalTok{(}\FunctionTok{names}\NormalTok{(obj), }\DecValTok{1}\NormalTok{), obj)}
\NormalTok{cross }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(cross, obj)}
\CommentTok{\# draw(cross)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# gather all}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\NormalTok{prin }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{inner =} \DecValTok{1}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{stardust =}\NormalTok{ .}\DecValTok{7}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{cross =} \FloatTok{3.5}\NormalTok{),}
                  \FunctionTok{namel}\NormalTok{(inner, stardust, cross, }\AttributeTok{null =} \FunctionTok{nullGrob}\NormalTok{()))}
\NormalTok{vp }\OtherTok{\textless{}{-}} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{95}\NormalTok{, .}\DecValTok{95}\NormalTok{)}
\NormalTok{prin }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(prin, }\AttributeTok{vp =}\NormalTok{ vp)}

\FunctionTok{pdf}\NormalTok{(}\StringTok{"figure\_mech.pdf"}\NormalTok{, }\DecValTok{11}\NormalTok{, }\DecValTok{7}\NormalTok{)}
\FunctionTok{draw}\NormalTok{(prin)}
\FunctionTok{dev.off}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-a_project.r}{%
\section{File: a\_project.R}\label{file-a_project.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# external grob}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\DocumentationTok{\#\# external element}
\NormalTok{grob.lcms }\OtherTok{\textless{}{-}} \FunctionTok{ex\_grob}\NormalTok{(}\StringTok{"lcms"}\NormalTok{)}
\NormalTok{grob.sample }\OtherTok{\textless{}{-}} \FunctionTok{ex\_grob}\NormalTok{(}\StringTok{"sample"}\NormalTok{)}
\NormalTok{grob.convert }\OtherTok{\textless{}{-}} \FunctionTok{ex\_grob}\NormalTok{(}\StringTok{"convert"}\NormalTok{)}
\NormalTok{grob.sirius }\OtherTok{\textless{}{-}} \FunctionTok{ex\_grob}\NormalTok{(}\StringTok{"sirius"}\NormalTok{)}
\NormalTok{grob.collate }\OtherTok{\textless{}{-}} \FunctionTok{ex\_grob}\NormalTok{(}\StringTok{"collate\_data"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# sub.frame}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\DocumentationTok{\#\# melody: palette}
\NormalTok{type }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"class"}\NormalTok{, }\StringTok{"slot"}\NormalTok{, }\StringTok{"sub.slot"}\NormalTok{, }\StringTok{"function"}\NormalTok{, }\StringTok{"custom"}\NormalTok{)}
\NormalTok{pal }\OtherTok{\textless{}{-}}\NormalTok{ MCnebula2}\SpecialCharTok{:::}\FunctionTok{.as\_dic}\NormalTok{(}\FunctionTok{palette\_set}\NormalTok{(mcn\_5features)[}\SpecialCharTok{{-}}\DecValTok{3}\NormalTok{], type, }\AttributeTok{na.rm =}\NormalTok{ T)}
\NormalTok{pal[[ }\StringTok{"report"}\NormalTok{ ]] }\OtherTok{\textless{}{-}} \StringTok{"black"}

\NormalTok{grobs.project }\OtherTok{\textless{}{-}} \FunctionTok{lst\_grecti}\NormalTok{(}\StringTok{"dataset"}\NormalTok{, pal, , grecti2)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# content}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\DocumentationTok{\#\# special arrow}
\NormalTok{spArr }\OtherTok{\textless{}{-}} \FunctionTok{polygonGrob}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{, .}\DecValTok{5}\NormalTok{, }\DecValTok{0}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{, .}\DecValTok{4}\NormalTok{, }\DecValTok{0}\NormalTok{, .}\DecValTok{4}\NormalTok{),}
  \AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{lwd =} \FunctionTok{u}\NormalTok{(}\DecValTok{2}\NormalTok{, line), }\AttributeTok{col =} \StringTok{"grey30"}\NormalTok{)}
\NormalTok{)}

\CommentTok{\# alignment}
\NormalTok{shift }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{all\_range }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{30}\NormalTok{, }\DecValTok{31}\SpecialCharTok{:}\DecValTok{60}\NormalTok{, }\DecValTok{61}\SpecialCharTok{:}\DecValTok{100}\NormalTok{)}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{1}\NormalTok{)}
\NormalTok{lst }\OtherTok{\textless{}{-}} \FunctionTok{mapply}\NormalTok{(shift, }\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(shift), }\AttributeTok{SIMPLIFY =}\NormalTok{ F, }\AttributeTok{FUN =} \ControlFlowTok{function}\NormalTok{(shift, id)\{}
\NormalTok{  peak }\OtherTok{\textless{}{-}} \FunctionTok{mapply}\NormalTok{(all\_range, }\AttributeTok{SIMPLIFY =}\NormalTok{ F,}
    \AttributeTok{FUN =} \ControlFlowTok{function}\NormalTok{(range)\{}
\NormalTok{      peak }\OtherTok{\textless{}{-}} \FunctionTok{dnorm}\NormalTok{(range, }\FunctionTok{median}\NormalTok{(range) }\SpecialCharTok{+}\NormalTok{ shift, }\FunctionTok{rnorm}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{5}\NormalTok{, }\FloatTok{1.2}\NormalTok{)) }\SpecialCharTok{*}
        \FunctionTok{rnorm}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FloatTok{0.7}\NormalTok{, }\FloatTok{0.15}\NormalTok{)}
\NormalTok{    \})}
\NormalTok{  feature }\OtherTok{\textless{}{-}} \FunctionTok{mapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(all\_range), }\FunctionTok{lengths}\NormalTok{(all\_range),}
    \AttributeTok{FUN =} \ControlFlowTok{function}\NormalTok{(seq, rep)\{}
      \FunctionTok{rep}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"peak"}\NormalTok{, seq), rep)}
\NormalTok{    \})}
\NormalTok{  tibble}\SpecialCharTok{::}\FunctionTok{tibble}\NormalTok{(}\AttributeTok{x =} \FunctionTok{unlist}\NormalTok{(all\_range), }\AttributeTok{y =} \FunctionTok{unlist}\NormalTok{(peak),}
    \AttributeTok{sample =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"sample"}\NormalTok{, id),}
    \AttributeTok{peak =} \FunctionTok{unlist}\NormalTok{(feature)}
\NormalTok{  )}
\NormalTok{\})}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(lst)}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(data,}
  \AttributeTok{is =} \FunctionTok{ifelse}\NormalTok{(y }\SpecialCharTok{\textgreater{}=} \FloatTok{0.003}\NormalTok{, T, F),}
  \AttributeTok{peak =} \FunctionTok{ifelse}\NormalTok{(is, peak, }\StringTok{"non{-}feature"}\NormalTok{))}
\NormalTok{palette }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(ggsci}\SpecialCharTok{::}\FunctionTok{pal\_npg}\NormalTok{()(}\FunctionTok{length}\NormalTok{(all\_range)), }\StringTok{"transparent"}\NormalTok{)}
\FunctionTok{names}\NormalTok{(palette) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"peak"}\NormalTok{, }\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(all\_range)), }\StringTok{"non{-}feature"}\NormalTok{)}
\NormalTok{p }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(data, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y)) }\SpecialCharTok{+}
  \FunctionTok{geom\_area}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ peak)) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_vline}\NormalTok{(}\AttributeTok{xintercept =} \FunctionTok{vapply}\NormalTok{(all\_range, median, }\DecValTok{1}\NormalTok{), }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \FloatTok{0.003}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{facet\_grid}\NormalTok{(sample }\SpecialCharTok{\textasciitilde{}}\NormalTok{ .) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =}\NormalTok{ palette) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{x =} \StringTok{"retention time"}\NormalTok{, }\AttributeTok{y =} \StringTok{"intensity"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_void}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{family =} \StringTok{"Times"}\NormalTok{), }\AttributeTok{axis.text.y =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{strip.text =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{  )}
\NormalTok{grob.align }\OtherTok{\textless{}{-}} \FunctionTok{as\_grob}\NormalTok{(p)}
\CommentTok{\# detection}
\NormalTok{all\_time }\OtherTok{\textless{}{-}} \FunctionTok{vapply}\NormalTok{(all\_range, median, }\DecValTok{1}\NormalTok{)}
\NormalTok{anpi }\OtherTok{\textless{}{-}} \FloatTok{0.05}
\NormalTok{len }\OtherTok{\textless{}{-}} \DecValTok{5}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{1}\NormalTok{)}
\NormalTok{ms1\_set }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(all\_time,}
  \ControlFlowTok{function}\NormalTok{(n)\{}
\NormalTok{    ms1 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FunctionTok{rnorm}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{2}\NormalTok{), }\FunctionTok{rnorm}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{8}\NormalTok{, }\DecValTok{3}\NormalTok{), }\FunctionTok{rnorm}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{2}\NormalTok{))}
\NormalTok{    ms1 }\OtherTok{\textless{}{-}}\NormalTok{ ms1[ ms1 }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{ ]}
\NormalTok{    ms1 }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{x =} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(ms1), }\AttributeTok{xend =} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(ms1),}
      \AttributeTok{y =} \DecValTok{0}\NormalTok{, }\AttributeTok{yend =}\NormalTok{ ms1)}
\NormalTok{    ms1 }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(ms1,}
      \AttributeTok{x =}\NormalTok{ x }\SpecialCharTok{*}\NormalTok{ len, }\AttributeTok{xend =}\NormalTok{ xend }\SpecialCharTok{*}\NormalTok{ len,}
      \AttributeTok{y =} \FunctionTok{sinpi}\NormalTok{(anpi) }\SpecialCharTok{*}\NormalTok{ x }\SpecialCharTok{+}\NormalTok{ y, }\AttributeTok{yend =} \FunctionTok{sinpi}\NormalTok{(anpi) }\SpecialCharTok{*}\NormalTok{ xend }\SpecialCharTok{+}\NormalTok{ yend,}
      \AttributeTok{x =} \FunctionTok{cospi}\NormalTok{(anpi) }\SpecialCharTok{*}\NormalTok{ x }\SpecialCharTok{+}\NormalTok{ n, }\AttributeTok{xend =}\NormalTok{ x)}
\NormalTok{    ms1 }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{bind\_rows}\NormalTok{(ms1,}
      \FunctionTok{c}\NormalTok{(}\AttributeTok{x =}\NormalTok{ n, }\AttributeTok{xend =} \FunctionTok{max}\NormalTok{(ms1}\SpecialCharTok{$}\NormalTok{xend),}
        \AttributeTok{y =} \DecValTok{0}\NormalTok{, }\AttributeTok{yend =} \FunctionTok{max}\NormalTok{(ms1}\SpecialCharTok{$}\NormalTok{y)))}
\NormalTok{    dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(ms1, }\AttributeTok{time =}\NormalTok{ n)}
\NormalTok{  \})}
\NormalTok{ms1\_set }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(ms1\_set)}
\NormalTok{p }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(data, sample }\SpecialCharTok{==} \StringTok{"sample1"}\NormalTok{), }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y }\SpecialCharTok{*} \DecValTok{50}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{geom\_segment}\NormalTok{(}\AttributeTok{data =}\NormalTok{ ms1\_set,}
    \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{xend =}\NormalTok{ xend, }\AttributeTok{y =}\NormalTok{ y, }\AttributeTok{yend =}\NormalTok{ yend),}
    \AttributeTok{color =} \StringTok{"grey30"}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.8}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_area}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ peak)) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{x =} \StringTok{"retention time"}\NormalTok{, }\AttributeTok{y =} \StringTok{"intensity"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =}\NormalTok{ palette) }\SpecialCharTok{+}
  \FunctionTok{theme\_void}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{family =} \StringTok{"Times"}\NormalTok{),}
    \AttributeTok{axis.text.y =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{  )}
\NormalTok{grob.detect }\OtherTok{\textless{}{-}} \FunctionTok{as\_grob}\NormalTok{(p)}

\DocumentationTok{\#\# project\_dataset}
\DocumentationTok{\#\# into}
\NormalTok{grobs.project}\SpecialCharTok{$}\NormalTok{dataset }\SpecialCharTok{\%\textless{}\textgreater{}\%} \FunctionTok{into}\NormalTok{(grob.collate)}

\DocumentationTok{\#\# omit}
\NormalTok{omit }\OtherTok{\textless{}{-}} \FunctionTok{circleGrob}\NormalTok{(}\FunctionTok{seq}\NormalTok{(.}\DecValTok{2}\NormalTok{, .}\DecValTok{8}\NormalTok{, , }\DecValTok{3}\NormalTok{), .}\DecValTok{5}\NormalTok{, .}\DecValTok{07}\NormalTok{, }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fill =} \StringTok{"grey20"}\NormalTok{),}
                   \AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , }\FunctionTok{u}\NormalTok{(}\FloatTok{1.5}\NormalTok{, line), }\FunctionTok{u}\NormalTok{(}\FloatTok{1.5}\NormalTok{, line)))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# gather}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\NormalTok{grob.sampleCir }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(}\FunctionTok{circleGrob}\NormalTok{(), grob.sample)}
\NormalTok{spArrScale }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(spArr, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{2}\NormalTok{, .}\DecValTok{7}\NormalTok{))}
\NormalTok{grob.rdetect }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(}
  \FunctionTok{into}\NormalTok{(}\FunctionTok{grectn}\NormalTok{(}\AttributeTok{bgp\_args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{lty =} \StringTok{"solid"}\NormalTok{)), grob.detect),}
  \AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{7}\NormalTok{, .}\DecValTok{9}\NormalTok{)}
\NormalTok{)}

\NormalTok{frame.project }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\AttributeTok{grob.sampleCir =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{samples =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{spArrScale =}\NormalTok{ .}\DecValTok{1}\NormalTok{,}
    \AttributeTok{grob.lcms =} \DecValTok{1}\NormalTok{, }\StringTok{\textasciigrave{}}\AttributeTok{LC{-}MS/MS}\StringTok{\textasciigrave{}} \OtherTok{=}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{spArrScale =}\NormalTok{ .}\DecValTok{1}\NormalTok{,}
    \AttributeTok{grob.convert =}\NormalTok{ .}\DecValTok{6}\NormalTok{, }\AttributeTok{convert\_raw\_data =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{spArrScale =}\NormalTok{ .}\DecValTok{1}\NormalTok{,}
    \AttributeTok{grob.rdetect =}\NormalTok{ .}\DecValTok{7}\NormalTok{, }\AttributeTok{feature\_detection =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{spArrScale =}\NormalTok{ .}\DecValTok{1}\NormalTok{,}
    \AttributeTok{grob.sirius =}\NormalTok{ .}\DecValTok{4}\NormalTok{, }\AttributeTok{run\_SIRIUS =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{spArrScale =}\NormalTok{ .}\DecValTok{1}\NormalTok{,}
    \AttributeTok{MCnebula2 =}\NormalTok{ .}\DecValTok{2}\NormalTok{, }\AttributeTok{omit =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{dataset =} \DecValTok{1}\NormalTok{),}
  \FunctionTok{c}\NormalTok{(}\FunctionTok{namel}\NormalTok{(grob.sampleCir, grob.lcms, grob.convert, grob.rdetect,}
\NormalTok{      grob.sirius, spArrScale, omit),}
    \AttributeTok{dataset =} \FunctionTok{list}\NormalTok{(grobs.project[[}\DecValTok{1}\NormalTok{]]),}
    \FunctionTok{sapply}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"samples"}\NormalTok{, }\StringTok{"LC{-}MS/MS"}\NormalTok{, }\StringTok{"convert\_raw\_data"}\NormalTok{,}
        \StringTok{"feature\_detection"}\NormalTok{, }\StringTok{"run\_SIRIUS"}\NormalTok{, }\StringTok{"MCnebula2"}\NormalTok{),}
      \AttributeTok{simplify =}\NormalTok{ F, }\ControlFlowTok{function}\NormalTok{(name) \{ }\FunctionTok{gtext}\NormalTok{(name) \})}
\NormalTok{  )}
\NormalTok{)}
\NormalTok{.gene.vp }\OtherTok{\textless{}{-}} \FunctionTok{viewport}\NormalTok{(, , }\AttributeTok{width =} \FunctionTok{unit}\NormalTok{(}\DecValTok{8} \SpecialCharTok{*} \FloatTok{1.5}\NormalTok{, }\StringTok{"line"}\NormalTok{),}
                     \AttributeTok{height =} \FunctionTok{unit}\NormalTok{(}\DecValTok{35} \SpecialCharTok{*} \FloatTok{1.5}\NormalTok{, }\StringTok{"line"}\NormalTok{), }\AttributeTok{clip =} \StringTok{"off"}\NormalTok{)}
\NormalTok{.project }\OtherTok{\textless{}{-}} \FunctionTok{gTree}\NormalTok{(}\AttributeTok{children =} \FunctionTok{gList}\NormalTok{(frame.project), }\AttributeTok{vp =}\NormalTok{ .gene.vp)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# line and arrow}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\NormalTok{baf }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, y, }\AttributeTok{width =} \FunctionTok{u}\NormalTok{(}\DecValTok{1}\NormalTok{, line), }\AttributeTok{height =} \FunctionTok{u}\NormalTok{(}\DecValTok{3}\NormalTok{, line)) \{}
\NormalTok{  rect }\OtherTok{\textless{}{-}} \FunctionTok{grectn}\NormalTok{(}\AttributeTok{bgp\_args =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{lty =} \StringTok{"solid"}\NormalTok{))}\SpecialCharTok{@}\NormalTok{grob}
\NormalTok{  clip }\OtherTok{\textless{}{-}} \FunctionTok{clipGrob}\NormalTok{(, , .}\DecValTok{7}\NormalTok{)}
  \FunctionTok{ggather}\NormalTok{(clip, rect, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(x, y, width, height))}
\NormalTok{\}}
\CommentTok{\# a1. \textless{}{-} setnullvp("dataset", list(x = 1), .project)}
\CommentTok{\# baf. \textless{}{-} baf(grobX(a1., 0), grobY(a1., 0))}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-b_mcn_dataset.r}{%
\section{File: b\_mcn\_dataset.R}\label{file-b_mcn_dataset.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# sub.frame}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\FunctionTok{load}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(.expath, }\StringTok{"/toBinary5.rdata"}\NormalTok{))}
\NormalTok{weight.mcn }\OtherTok{\textless{}{-}} \FunctionTok{weight}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(toBinary5), }\FunctionTok{slotNames}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(toBinary5)))}
\NormalTok{weight.mcn }\OtherTok{\textless{}{-}} 
  \FunctionTok{sapply}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"dataset"}\NormalTok{, }\StringTok{"reference"}\NormalTok{, }\StringTok{"backtrack"}\NormalTok{), }\AttributeTok{simplify =}\NormalTok{ F,}
         \ControlFlowTok{function}\NormalTok{(x) weight.mcn[[x]])}

\NormalTok{grobs.mcn }\OtherTok{\textless{}{-}} \FunctionTok{lst\_grecti}\NormalTok{(}\FunctionTok{names}\NormalTok{(weight.mcn), pal, }\StringTok{"sub.slot"}\NormalTok{, grecti2)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# content}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\DocumentationTok{\#\# dataset}
\DocumentationTok{\#\# features}
\NormalTok{mshn }\OtherTok{\textless{}{-}} \DecValTok{5}
\NormalTok{mshvp }\OtherTok{\textless{}{-}} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{7}\NormalTok{, .}\DecValTok{7}\NormalTok{)}
\NormalTok{fea }\OtherTok{\textless{}{-}} \FunctionTok{circleGrob}\NormalTok{(}\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fill =} \StringTok{"grey85"}\NormalTok{))}
\NormalTok{fea }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(fea, }\AttributeTok{vp =}\NormalTok{ mshvp)}
\NormalTok{grob\_feas }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{fill\_list}\NormalTok{(}\FunctionTok{n}\NormalTok{(fea, mshn), }\DecValTok{1}\NormalTok{), }\FunctionTok{fill\_list}\NormalTok{(}\FunctionTok{n}\NormalTok{(fea, mshn), }\FunctionTok{list}\NormalTok{(fea)))}
\DocumentationTok{\#\# function to draw}
\NormalTok{mglayer }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(}\AttributeTok{from =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{, }\AttributeTok{n =} \DecValTok{5}\NormalTok{, }\AttributeTok{seed =} \DecValTok{100}\NormalTok{) \{}
  \FunctionTok{set.seed}\NormalTok{(seed)}
\NormalTok{  ns }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(from, n, T)}
\NormalTok{  grobs }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(ns, }\ControlFlowTok{function}\NormalTok{(n) \{}
                    \FunctionTok{ggather}\NormalTok{(}\FunctionTok{glayer}\NormalTok{(n), }\AttributeTok{vp =}\NormalTok{ mshvp)}
\NormalTok{         \})}
\NormalTok{  sig }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"glayer"}\NormalTok{, seed), }\DecValTok{1}\SpecialCharTok{:}\NormalTok{n)}
  \FunctionTok{names}\NormalTok{(grobs) }\OtherTok{\textless{}{-}}\NormalTok{ sig}
  \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{fill\_list}\NormalTok{(sig, }\DecValTok{1}\NormalTok{), grobs)}
\NormalTok{\}}
\DocumentationTok{\#\# set}
\NormalTok{grob\_fset }\OtherTok{\textless{}{-}} \FunctionTok{mglayer}\NormalTok{(, , }\DecValTok{100}\NormalTok{)}
\NormalTok{grob\_sset }\OtherTok{\textless{}{-}} \FunctionTok{mglayer}\NormalTok{(}\DecValTok{2}\SpecialCharTok{:}\DecValTok{7}\NormalTok{, , }\DecValTok{110}\NormalTok{)}
\NormalTok{grob\_cset }\OtherTok{\textless{}{-}} \FunctionTok{mglayer}\NormalTok{(}\DecValTok{5}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, , }\DecValTok{120}\NormalTok{)}
\DocumentationTok{\#\# titles}
\NormalTok{tit\_fea }\OtherTok{\textless{}{-}} \FunctionTok{gltext}\NormalTok{(}\StringTok{"features"}\NormalTok{)}
\NormalTok{tit\_cand }\OtherTok{\textless{}{-}} \FunctionTok{gltext}\NormalTok{(}\StringTok{"candidates"}\NormalTok{, }\AttributeTok{flip =}\NormalTok{ T)}
\NormalTok{tit\_formu }\OtherTok{\textless{}{-}} \FunctionTok{gtext}\NormalTok{(}\StringTok{"molecular formula"}\NormalTok{, }\FunctionTok{gpar}\NormalTok{(}\AttributeTok{fontface =} \StringTok{"plain"}\NormalTok{))}
\NormalTok{tit\_struc }\OtherTok{\textless{}{-}} \FunctionTok{gtext}\NormalTok{(}\StringTok{"chemical structure"}\NormalTok{, }\FunctionTok{gpar}\NormalTok{(}\AttributeTok{fontface =} \StringTok{"plain"}\NormalTok{))}
\NormalTok{tit\_class }\OtherTok{\textless{}{-}} \FunctionTok{gtext}\NormalTok{(}\StringTok{"chemical classes"}\NormalTok{, }\FunctionTok{gpar}\NormalTok{(}\AttributeTok{fontface =} \StringTok{"plain"}\NormalTok{))}
\DocumentationTok{\#\# combine}
\NormalTok{names }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"grob\_feas"}\NormalTok{, }\StringTok{"tit\_formu"}\NormalTok{, }\StringTok{"grob\_fset"}\NormalTok{,}
           \StringTok{"tit\_struc"}\NormalTok{, }\StringTok{"grob\_sset"}\NormalTok{, }\StringTok{"tit\_class"}\NormalTok{, }\StringTok{"grob\_cset"}\NormalTok{)}
\NormalTok{env }\OtherTok{\textless{}{-}} \FunctionTok{environment}\NormalTok{()}
\NormalTok{mdataset }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{fill\_list}\NormalTok{(names, }\DecValTok{1}\NormalTok{), }\FunctionTok{sapply}\NormalTok{(names, get, }\AttributeTok{envir =}\NormalTok{ env))}
\NormalTok{mdataset }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{tit\_cand =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{mdataset =} \DecValTok{1}\NormalTok{),}
                      \FunctionTok{list}\NormalTok{(}\AttributeTok{tit\_cand =}\NormalTok{ tit\_cand, }\AttributeTok{mdataset =}\NormalTok{ mdataset))}
\NormalTok{mdataset }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{tit\_fea =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{mdataset =} \DecValTok{1}\NormalTok{),}
                      \FunctionTok{list}\NormalTok{(}\AttributeTok{tit\_fea =}\NormalTok{ tit\_fea, }\AttributeTok{mdataset =}\NormalTok{ mdataset))}
\NormalTok{.grob.dataset }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(mdataset, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{9}\NormalTok{, .}\DecValTok{9}\NormalTok{))}
\DocumentationTok{\#\# into}
\NormalTok{grobs.mcn}\SpecialCharTok{$}\NormalTok{dataset }\SpecialCharTok{\%\textless{}\textgreater{}\%} \FunctionTok{into}\NormalTok{(.grob.dataset)}

\DocumentationTok{\#\# reference}
\NormalTok{ref }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(}\FunctionTok{reference}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(toBinary5)))}
\DocumentationTok{\#\# spe.table}
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{.fea\_id =} \FunctionTok{n}\NormalTok{(id., }\DecValTok{3}\NormalTok{), }\AttributeTok{.cand\_id =} \FunctionTok{n}\NormalTok{(cand., }\DecValTok{3}\NormalTok{))}
\NormalTok{grob\_table }\OtherTok{\textless{}{-}}\NormalTok{ gridExtra}\SpecialCharTok{::}\FunctionTok{tableGrob}\NormalTok{(df, }\AttributeTok{theme =}\NormalTok{ gridExtra}\SpecialCharTok{::}\FunctionTok{ttheme\_default}\NormalTok{(}\DecValTok{8}\NormalTok{))}
\NormalTok{grobs\_ref }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(ref, }\AttributeTok{simplify =}\NormalTok{ F,}
                    \ControlFlowTok{function}\NormalTok{(name) \{}
                      \ControlFlowTok{if}\NormalTok{ (name }\SpecialCharTok{==} \StringTok{"nebula\_index"}\NormalTok{)}
\NormalTok{                        res }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{gshiny}\NormalTok{(}\AttributeTok{xn =} \DecValTok{6}\NormalTok{), }\FunctionTok{gtext}\NormalTok{(name))}
                      \ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (name }\SpecialCharTok{==} \StringTok{"specific\_candidate"}\NormalTok{) \{}
\NormalTok{                        res }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{tit =}\NormalTok{ .}\DecValTok{2}\NormalTok{, }\AttributeTok{df =} \DecValTok{1}\NormalTok{),}
                                         \FunctionTok{list}\NormalTok{(}\AttributeTok{tit =} \FunctionTok{gtext}\NormalTok{(name, }\AttributeTok{y =}\NormalTok{ .}\DecValTok{2}\NormalTok{), }\AttributeTok{df =}\NormalTok{ grob\_table))}
\NormalTok{                        res }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{grectn}\NormalTok{(}\StringTok{"transparent"}\NormalTok{), res)}
\NormalTok{                      \} }\ControlFlowTok{else}
\NormalTok{                        res }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{grectn}\NormalTok{(}\StringTok{"transparent"}\NormalTok{), }\FunctionTok{gtext}\NormalTok{(name))}
                      \FunctionTok{ggather}\NormalTok{(res, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{9}\NormalTok{))}
\NormalTok{                    \})}
\NormalTok{weight.ref }\OtherTok{\textless{}{-}} \FunctionTok{vapply}\NormalTok{(ref, }\AttributeTok{FUN.VALUE =} \FunctionTok{numeric}\NormalTok{(}\DecValTok{1}\NormalTok{),}
                     \ControlFlowTok{function}\NormalTok{(name) \{}
                       \ControlFlowTok{if}\NormalTok{ (name }\SpecialCharTok{==} \StringTok{"nebula\_index"}\NormalTok{) .}\DecValTok{5}
                       \ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (name }\SpecialCharTok{==} \StringTok{"specific\_candidate"}\NormalTok{) }\FloatTok{1.3}
                       \ControlFlowTok{else}\NormalTok{ .}\DecValTok{5}
\NormalTok{                     \})}
\NormalTok{grobs\_ref }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(weight.ref, grobs\_ref)}
\NormalTok{grobs.ref }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(grobs\_ref, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{9}\NormalTok{, .}\DecValTok{9}\NormalTok{))}
\DocumentationTok{\#\# into}
\NormalTok{grobs.mcn}\SpecialCharTok{$}\NormalTok{reference }\SpecialCharTok{\%\textless{}\textgreater{}\%} \FunctionTok{into}\NormalTok{(grobs.ref)}

\DocumentationTok{\#\# backtrack}
\NormalTok{grob.trash }\OtherTok{\textless{}{-}} \FunctionTok{ex\_grob}\NormalTok{(}\StringTok{"trash"}\NormalTok{)}
\NormalTok{grob\_trash }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(grob.trash, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{8}\NormalTok{, .}\DecValTok{8}\NormalTok{))}
\NormalTok{grobs.mcn}\SpecialCharTok{$}\NormalTok{backtrack }\SpecialCharTok{\%\textless{}\textgreater{}\%} \FunctionTok{into}\NormalTok{(grob\_trash)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# gather}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\NormalTok{.size\_subslot }\OtherTok{\textless{}{-}} \FunctionTok{u}\NormalTok{(}\DecValTok{1}\NormalTok{, npc) }\SpecialCharTok{{-}} \FunctionTok{u}\NormalTok{(.}\DecValTok{5}\NormalTok{, line)}
\NormalTok{frame.mcn }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(weight.mcn, grobs.mcn)}
\NormalTok{frame.mcn }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(frame.mcn, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .size\_subslot, .size\_subslot))}
\NormalTok{.mcn }\OtherTok{\textless{}{-}} \FunctionTok{grecti2}\NormalTok{(}\FunctionTok{form}\NormalTok{(}\StringTok{"mcn\_dataset"}\NormalTok{), }\AttributeTok{tfill =}\NormalTok{ pal[[ }\StringTok{"slot"}\NormalTok{ ]])}
\NormalTok{.mcn }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(.mcn, frame.mcn)}
\NormalTok{.mcn }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(.mcn, }\AttributeTok{vp =}\NormalTok{ .gene.vp)}

\CommentTok{\# draw(.mcn)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# line and arrow}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\DocumentationTok{\#\# link}
\NormalTok{link }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \CommentTok{\# "dataset", "stardust\_classes", "create\_stardust\_classes",}
  \CommentTok{\# "dataset", "specific\_candidate", "create\_reference",}
  \CommentTok{\# "dataset", "features\_annotation", "create\_features\_annotation",}
  \CommentTok{\# "specific\_candidate", "features\_annotation", "create\_features\_annotation",}
  \CommentTok{\# "hierarchy", "stardust\_classes", "create\_stardust\_classes",}
  \CommentTok{\# "features\_annotation", "nebula\_index", "create\_nebula\_index",}
  \CommentTok{\# "stardust\_classes", "nebula\_index", "create\_nebula\_index",}
  \StringTok{"stardust\_classes"}\NormalTok{, }\StringTok{"backtrack"}\NormalTok{, }\StringTok{"cross\_filter\_stardust"}\NormalTok{,}
  \StringTok{"backtrack"}\NormalTok{, }\StringTok{"stardust\_classes"}\NormalTok{, }\StringTok{"backtrack\_stardust"}
\NormalTok{)}
\NormalTok{link }\OtherTok{\textless{}{-}} \FunctionTok{split}\NormalTok{(link, }\FunctionTok{rep}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\NormalTok{(}\FunctionTok{length}\NormalTok{(link) }\SpecialCharTok{/} \DecValTok{3}\NormalTok{), }\AttributeTok{each =} \DecValTok{3}\NormalTok{))}
\NormalTok{link }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\FunctionTok{t}\NormalTok{(}\FunctionTok{do.call}\NormalTok{(cbind, link)))}
\FunctionTok{names}\NormalTok{(link) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"from"}\NormalTok{, }\StringTok{"to"}\NormalTok{, }\StringTok{"fun"}\NormalTok{)}
\DocumentationTok{\#\# the attributes for arrow}
\NormalTok{fun\_pal }\OtherTok{\textless{}{-}}\NormalTok{ ggsci}\SpecialCharTok{::}\FunctionTok{pal\_d3}\NormalTok{(}\StringTok{"category20"}\NormalTok{)(}\DecValTok{20}\NormalTok{)}
\NormalTok{link }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(link,}
  \AttributeTok{group =} \FunctionTok{agroup}\NormalTok{(to, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, }\FunctionTok{integer}\NormalTok{(}\DecValTok{1}\NormalTok{)),}
  \AttributeTok{group =} \FunctionTok{ifelse}\NormalTok{(from }\SpecialCharTok{==} \StringTok{"backtrack"}\NormalTok{, }\FunctionTok{max}\NormalTok{(group) }\SpecialCharTok{+} \DecValTok{1}\NormalTok{, group),}
  \AttributeTok{color =} \FunctionTok{agroup}\NormalTok{(group, fun\_pal),}
  \AttributeTok{left =} \FunctionTok{ifelse}\NormalTok{(from }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"dataset"}\NormalTok{, }\StringTok{"specific\_candidate"}\NormalTok{), F, T),}
  \AttributeTok{left =} \FunctionTok{ifelse}\NormalTok{(to }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"specific\_candidate"}\NormalTok{, }\StringTok{"stardust\_classes"}\NormalTok{),}
    \SpecialCharTok{!}\NormalTok{left, left),}
  \AttributeTok{up =} \FunctionTok{ifelse}\NormalTok{(from }\SpecialCharTok{==} \StringTok{"backtrack"}\NormalTok{, T, F),}
  \AttributeTok{shift =} \FunctionTok{ifelse}\NormalTok{(from }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"dataset"}\NormalTok{, }\StringTok{"backtrack"}\NormalTok{), }\DecValTok{2}\NormalTok{, }\FloatTok{2.5}\NormalTok{))}

\DocumentationTok{\#\# tools}
\NormalTok{tools }\OtherTok{\textless{}{-}} \FunctionTok{maparrow}\NormalTok{(.mcn, link)}
\NormalTok{link }\OtherTok{\textless{}{-}}\NormalTok{ tools}\SpecialCharTok{$}\NormalTok{data}

\DocumentationTok{\#\# complex arr}
\NormalTok{com\_arr }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(tools}\SpecialCharTok{$}\NormalTok{arr\_city),}
                  \ControlFlowTok{function}\NormalTok{(n) \{}
\NormalTok{                    rect }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"create\_stardust\_classes"}\NormalTok{, }\StringTok{"cross\_filter\_stardust"}\NormalTok{,}
                              \StringTok{"create\_features\_annotation"}\NormalTok{, }\StringTok{"backtrack\_stardust"}\NormalTok{)}
                    \ControlFlowTok{if}\NormalTok{ (link}\SpecialCharTok{$}\NormalTok{fun[[ n ]] }\SpecialCharTok{\%in\%}\NormalTok{ rect }\SpecialCharTok{\&} \SpecialCharTok{!}\NormalTok{link}\SpecialCharTok{$}\NormalTok{dup[[ n ]])}
\NormalTok{                      tools}\SpecialCharTok{$}\NormalTok{arr\_city[[n]]}
                    \ControlFlowTok{else}
\NormalTok{                      tools}\SpecialCharTok{$}\NormalTok{arr\_round[[n]]}
\NormalTok{                  \})}

\DocumentationTok{\#\# modify bafs}
\NormalTok{bafs }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(tools}\SpecialCharTok{$}\NormalTok{bafs), }\AttributeTok{simplify =}\NormalTok{ F,}
               \ControlFlowTok{function}\NormalTok{(name)\{}
\NormalTok{                 sub\_name }\OtherTok{\textless{}{-}} \FunctionTok{gsub}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.[a{-}z]$"}\NormalTok{, }\StringTok{""}\NormalTok{, name)}
\NormalTok{                 fun }\OtherTok{\textless{}{-}}\NormalTok{ tools}\SpecialCharTok{$}\NormalTok{bafs[[name]]}
                 \ControlFlowTok{if}\NormalTok{ (sub\_name }\SpecialCharTok{==} \StringTok{"backtrack"}\NormalTok{)}
                   \FunctionTok{fun}\NormalTok{(}\AttributeTok{h =} \FunctionTok{u}\NormalTok{(}\DecValTok{2}\NormalTok{, line))}
                 \ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (sub\_name }\SpecialCharTok{==} \StringTok{"specific\_candidate"}\NormalTok{)}
                   \FunctionTok{fun}\NormalTok{(}\AttributeTok{w =} \FunctionTok{u}\NormalTok{(}\DecValTok{3}\NormalTok{, line))}
                 \ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (sub\_name }\SpecialCharTok{==} \StringTok{"dataset"}\NormalTok{)}
                   \FunctionTok{fun}\NormalTok{()}
                 \ControlFlowTok{else}
                   \FunctionTok{fun}\NormalTok{(}\FunctionTok{u}\NormalTok{(}\DecValTok{3}\NormalTok{, line), }\FunctionTok{u}\NormalTok{(}\DecValTok{1}\NormalTok{, line))}
\NormalTok{               \})}

\DocumentationTok{\#\# show}
\NormalTok{.mcn }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(ggather, }\FunctionTok{c}\NormalTok{(}\FunctionTok{list}\NormalTok{(.mcn), bafs, com\_arr, tools}\SpecialCharTok{$}\NormalTok{sags))}
\CommentTok{\# draw(.mcn)}

\NormalTok{link\_b }\OtherTok{\textless{}{-}}\NormalTok{ link}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-c_nebulae.r}{%
\section{File: c\_nebulae.R}\label{file-c_nebulae.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# sub.frame}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\NormalTok{weight.nebulae }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\AttributeTok{parent\_nebula =}\NormalTok{ .}\DecValTok{7}\NormalTok{, }\AttributeTok{child\_nebulae =} \FloatTok{1.5}\NormalTok{)}
\NormalTok{grobs.nebulae }\OtherTok{\textless{}{-}} \FunctionTok{lst\_grecti}\NormalTok{(}\FunctionTok{names}\NormalTok{(weight.nebulae), pal, }\StringTok{"slot"}\NormalTok{, grecti2)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# content}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\DocumentationTok{\#\# parent\_nebula}
\NormalTok{keep }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"grid\_layout"}\NormalTok{, }\StringTok{"viewports"}\NormalTok{, }\StringTok{"ggset"}\NormalTok{, }\StringTok{"..."}\NormalTok{)}
\NormalTok{name.par }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"..."}\NormalTok{, }\FunctionTok{slotNames}\NormalTok{(}\FunctionTok{parent\_nebula}\NormalTok{(toBinary5)))}
\NormalTok{fun }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(names) \{}
\NormalTok{  names }\OtherTok{\textless{}{-}}\NormalTok{ names[ names }\SpecialCharTok{\%in\%}\NormalTok{ keep ]}
\NormalTok{  weight }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\DecValTok{10}\NormalTok{, }\FunctionTok{length}\NormalTok{(names))}
\NormalTok{  weight[}\FunctionTok{which}\NormalTok{(names }\SpecialCharTok{==} \StringTok{"..."}\NormalTok{)] }\OtherTok{\textless{}{-}} \DecValTok{2}
  \FunctionTok{names}\NormalTok{(weight) }\OtherTok{\textless{}{-}}\NormalTok{ names}
\NormalTok{  weight}
\NormalTok{\}}
\NormalTok{weight.par }\OtherTok{\textless{}{-}} \FunctionTok{fun}\NormalTok{(name.par)}
\DocumentationTok{\#\# draw}
\NormalTok{grobs.par }\OtherTok{\textless{}{-}} \FunctionTok{lst\_grecti}\NormalTok{(}\FunctionTok{names}\NormalTok{(weight.par), pal, }\StringTok{"sub.slot"}\NormalTok{, grecti2)}
\NormalTok{omit }\OtherTok{\textless{}{-}} \FunctionTok{circleGrob}\NormalTok{(}\FunctionTok{seq}\NormalTok{(.}\DecValTok{2}\NormalTok{, .}\DecValTok{8}\NormalTok{, , }\DecValTok{3}\NormalTok{), .}\DecValTok{5}\NormalTok{, .}\DecValTok{07}\NormalTok{, }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fill =} \StringTok{"grey20"}\NormalTok{),}
                   \AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , }\FunctionTok{u}\NormalTok{(}\FloatTok{1.5}\NormalTok{, line), }\FunctionTok{u}\NormalTok{(}\FloatTok{1.5}\NormalTok{, line)))}
\NormalTok{grobs.par}\SpecialCharTok{$}\NormalTok{... }\OtherTok{\textless{}{-}}\NormalTok{ omit}
\DocumentationTok{\#\# ggset}
\NormalTok{ids }\OtherTok{\textless{}{-}} \FunctionTok{n}\NormalTok{(n, }\DecValTok{5}\NormalTok{)}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{99}\NormalTok{)}
\NormalTok{graph }\OtherTok{\textless{}{-}} \FunctionTok{random\_graph}\NormalTok{(ids, }\AttributeTok{layout =} \StringTok{"kk"}\NormalTok{)}
\NormalTok{theme }\OtherTok{\textless{}{-}} \FunctionTok{theme\_void}\NormalTok{() }\SpecialCharTok{+} \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{)}
\NormalTok{layer0 }\OtherTok{\textless{}{-}}\NormalTok{ ggraph}\SpecialCharTok{::}\FunctionTok{ggraph}\NormalTok{(graph)}
\NormalTok{scale\_size }\OtherTok{\textless{}{-}} \FunctionTok{scale\_size}\NormalTok{(}\AttributeTok{range =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{))}
\NormalTok{layer1 }\OtherTok{\textless{}{-}}\NormalTok{ layer0 }\SpecialCharTok{+}\NormalTok{ ggraph}\SpecialCharTok{::}\FunctionTok{geom\_node\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{size =}\NormalTok{ size), }\AttributeTok{shape =} \DecValTok{21}\NormalTok{) }\SpecialCharTok{+}
\NormalTok{  scale\_size }\SpecialCharTok{+}\NormalTok{ theme}
\NormalTok{layer1 }\OtherTok{\textless{}{-}} \FunctionTok{as\_grob}\NormalTok{(layer1)}
\NormalTok{edge\_color }\OtherTok{\textless{}{-}} \StringTok{"lightblue"}
\NormalTok{layer2 }\OtherTok{\textless{}{-}}\NormalTok{ layer0 }\SpecialCharTok{+}
\NormalTok{  ggraph}\SpecialCharTok{::}\FunctionTok{geom\_edge\_fan}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{edge\_width =}\NormalTok{ width), }\AttributeTok{color =}\NormalTok{ edge\_color) }\SpecialCharTok{+}\NormalTok{ theme}
\NormalTok{layer2 }\OtherTok{\textless{}{-}} \FunctionTok{as\_grob}\NormalTok{(layer2)}
\NormalTok{layer4 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{data.frame}\NormalTok{(}\AttributeTok{x =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{2}\NormalTok{, }\AttributeTok{y =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{2}\NormalTok{, }\AttributeTok{fill =} \FunctionTok{n}\NormalTok{(g, }\DecValTok{2}\NormalTok{))) }\SpecialCharTok{+} 
  \FunctionTok{geom\_tile}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y, }\AttributeTok{fill =}\NormalTok{ fill)) }\SpecialCharTok{+} 
\NormalTok{  ggsci}\SpecialCharTok{::}\FunctionTok{scale\_fill\_npg}\NormalTok{() }\SpecialCharTok{+}\NormalTok{ theme}
\NormalTok{layer4 }\OtherTok{\textless{}{-}} \FunctionTok{as\_grob}\NormalTok{(layer4)}
\NormalTok{layer5 }\OtherTok{\textless{}{-}}\NormalTok{ layer0 }\SpecialCharTok{+} 
\NormalTok{  ggraph}\SpecialCharTok{::}\FunctionTok{geom\_edge\_fan}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{edge\_width =}\NormalTok{ width), }\AttributeTok{color =}\NormalTok{ edge\_color) }\SpecialCharTok{+}
\NormalTok{  ggraph}\SpecialCharTok{::}\FunctionTok{geom\_node\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{size =}\NormalTok{ size, }\AttributeTok{fill =}\NormalTok{ name), }\AttributeTok{shape =} \DecValTok{21}\NormalTok{) }\SpecialCharTok{+}
\NormalTok{  scale\_size }\SpecialCharTok{+}
\NormalTok{  ggsci}\SpecialCharTok{::}\FunctionTok{scale\_fill\_npg}\NormalTok{() }\SpecialCharTok{+}
\NormalTok{  theme}
\NormalTok{layer5 }\OtherTok{\textless{}{-}}\NormalTok{ layer5\_ }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(}\FunctionTok{as\_grob}\NormalTok{(layer5))}
\DocumentationTok{\#\# ggset gather}
\NormalTok{layers }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{namel}\NormalTok{(layer1, layer2, layer4, layer5),}
                 \ControlFlowTok{function}\NormalTok{(lay)\{}
                   \FunctionTok{into}\NormalTok{(}\FunctionTok{grectn}\NormalTok{(), lay)}
\NormalTok{                 \})}
\NormalTok{wei\_ggset }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\AttributeTok{layer1 =} \DecValTok{1}\NormalTok{, }\AttributeTok{plus =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{layer2 =} \DecValTok{1}\NormalTok{, }\AttributeTok{plus =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }
               \AttributeTok{layer4 =} \DecValTok{1}\NormalTok{, }\AttributeTok{equals =} \DecValTok{1}\NormalTok{, }\AttributeTok{layer5 =} \DecValTok{1}\NormalTok{)}
\NormalTok{grob\_ggset }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(wei\_ggset, }\FunctionTok{c}\NormalTok{(layers, }\FunctionTok{list}\NormalTok{(}\AttributeTok{plus =} \FunctionTok{gtext}\NormalTok{(}\StringTok{"+"}\NormalTok{),}
                                                  \AttributeTok{equals =} \FunctionTok{gtext}\NormalTok{(}\StringTok{"=\textgreater{}"}\NormalTok{))))}
\NormalTok{grob\_ggset }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(grob\_ggset, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{9}\NormalTok{, .}\DecValTok{5}\NormalTok{))}
\NormalTok{grobs.par}\SpecialCharTok{$}\NormalTok{ggset }\SpecialCharTok{\%\textless{}\textgreater{}\%} \FunctionTok{into}\NormalTok{(grob\_ggset)}
\DocumentationTok{\#\# parent gather}
\NormalTok{.par }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(weight.par, grobs.par)}
\NormalTok{.par }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(.par, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .size\_subslot, .size\_subslot))}
\DocumentationTok{\#\# into}
\NormalTok{grobs.nebulae}\SpecialCharTok{$}\NormalTok{parent\_nebula }\SpecialCharTok{\%\textless{}\textgreater{}\%} \FunctionTok{into}\NormalTok{(.par)}

\DocumentationTok{\#\# child\_nebulae}
\NormalTok{name.chi }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"..."}\NormalTok{, }\FunctionTok{slotNames}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(toBinary5)), }\StringTok{"..."}\NormalTok{)}
\NormalTok{weight.chi }\OtherTok{\textless{}{-}} \FunctionTok{fun}\NormalTok{(name.chi)}
\DocumentationTok{\#\# draw}
\NormalTok{grobs.chi }\OtherTok{\textless{}{-}} \FunctionTok{lst\_grecti}\NormalTok{(}\FunctionTok{names}\NormalTok{(weight.chi), pal, }\StringTok{"sub.slot"}\NormalTok{, grecti2)}
\NormalTok{grobs.chi}\SpecialCharTok{$}\NormalTok{... }\OtherTok{\textless{}{-}}\NormalTok{ omit}
\DocumentationTok{\#\# signal grid layout}
\NormalTok{n }\OtherTok{\textless{}{-}} \DecValTok{3}
\NormalTok{seq }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(.}\DecValTok{2}\NormalTok{, .}\DecValTok{8}\NormalTok{, }\AttributeTok{length.out =}\NormalTok{ n)}
\NormalTok{grid }\OtherTok{\textless{}{-}} \FunctionTok{segmentsGrob}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{, n), seq),}
                     \FunctionTok{c}\NormalTok{(seq, }\FunctionTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, n)),}
                     \FunctionTok{c}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, n), seq),}
                     \FunctionTok{c}\NormalTok{(seq, }\FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{, n)), }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{lty =} \StringTok{"dashed"}\NormalTok{))}
\NormalTok{grid }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(}\FunctionTok{clipGrob}\NormalTok{(}\AttributeTok{height =}\NormalTok{ .}\DecValTok{8}\NormalTok{), }\FunctionTok{rectGrob}\NormalTok{(), grid, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{8}\NormalTok{, .}\DecValTok{8}\NormalTok{))}
\NormalTok{grobs.chi}\SpecialCharTok{$}\NormalTok{grid\_layout }\SpecialCharTok{\%\textless{}\textgreater{}\%} \FunctionTok{into}\NormalTok{(grid)}
\DocumentationTok{\#\# signal viewport}
\NormalTok{n }\OtherTok{\textless{}{-}} \DecValTok{6}
\NormalTok{seq }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\DecValTok{135}\NormalTok{, }\DecValTok{0}\NormalTok{, }\AttributeTok{length.out =}\NormalTok{ n)}
\NormalTok{seq2 }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\DecValTok{45}\NormalTok{, }\DecValTok{0}\NormalTok{, }\AttributeTok{length.out =}\NormalTok{ n)}
\NormalTok{vps }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(seq),}
              \ControlFlowTok{function}\NormalTok{(n, }\AttributeTok{fx =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{fy =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{x =}\NormalTok{ .}\DecValTok{5}\NormalTok{) \{}
\NormalTok{                ang }\OtherTok{\textless{}{-}}\NormalTok{ seq[n]}
\NormalTok{                ang2 }\OtherTok{\textless{}{-}}\NormalTok{ seq2[n]}
\NormalTok{                vp }\OtherTok{\textless{}{-}} \FunctionTok{viewport}\NormalTok{(}\FunctionTok{cospi}\NormalTok{(ang }\SpecialCharTok{/} \DecValTok{180}\NormalTok{) }\SpecialCharTok{*}\NormalTok{ fx }\SpecialCharTok{+}\NormalTok{ x, }\FunctionTok{sinpi}\NormalTok{(ang }\SpecialCharTok{/} \DecValTok{180}\NormalTok{) }\SpecialCharTok{*}\NormalTok{ fy }\SpecialCharTok{+}\NormalTok{ x,}
                               \FunctionTok{u}\NormalTok{(}\DecValTok{2}\NormalTok{, line), }\FunctionTok{u}\NormalTok{(}\DecValTok{2}\NormalTok{, line), }\AttributeTok{angle =}\NormalTok{ ang2,}
                               \AttributeTok{just =} \FunctionTok{c}\NormalTok{(}\StringTok{"centre"}\NormalTok{, }\StringTok{"bottom"}\NormalTok{))}
                \FunctionTok{ggather}\NormalTok{(}\FunctionTok{rectGrob}\NormalTok{(}\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fill =} \StringTok{"lightyellow"}\NormalTok{, }\AttributeTok{col =}\NormalTok{ pal[[}\StringTok{"sub.slot"}\NormalTok{]])),}
                        \FunctionTok{gtext}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"n"}\NormalTok{, }\FunctionTok{rev}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(seq))[n]),}
                              \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fontface =} \StringTok{"plain"}\NormalTok{), }\AttributeTok{form =}\NormalTok{ F), }\AttributeTok{vp =}\NormalTok{ vp)}
\NormalTok{              \})}
\NormalTok{vps }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(ggather, }\FunctionTok{c}\NormalTok{(vps, }\FunctionTok{list}\NormalTok{(}\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, .}\DecValTok{1}\NormalTok{, .}\DecValTok{5}\NormalTok{, .}\DecValTok{5}\NormalTok{))))}
\NormalTok{grobs.chi}\SpecialCharTok{$}\NormalTok{viewports }\SpecialCharTok{\%\textless{}\textgreater{}\%} \FunctionTok{into}\NormalTok{(vps)}
\DocumentationTok{\#\# signal ggset}
\NormalTok{ggsets }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{n =} \DecValTok{1}\NormalTok{, }\AttributeTok{x =} \DecValTok{1}\NormalTok{, }\AttributeTok{mn =} \DecValTok{1}\NormalTok{),}
                    \FunctionTok{list}\NormalTok{(}\AttributeTok{n =} \FunctionTok{gtext}\NormalTok{(}\StringTok{"n"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{cex =} \FloatTok{2.5}\NormalTok{), }\AttributeTok{form =}\NormalTok{ F),}
                         \AttributeTok{x =} \FunctionTok{gtext}\NormalTok{(}\StringTok{"×"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{cex =} \DecValTok{2}\NormalTok{, }\AttributeTok{font =} \FunctionTok{c}\NormalTok{(}\AttributeTok{plain =} \DecValTok{1}\NormalTok{))),}
                         \AttributeTok{mn =} \FunctionTok{into}\NormalTok{(}\FunctionTok{glayer}\NormalTok{(}\DecValTok{3}\NormalTok{), layer5\_)))}
\NormalTok{ggsets }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(ggsets, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{7}\NormalTok{, .}\DecValTok{7}\NormalTok{))}
\NormalTok{grobs.chi}\SpecialCharTok{$}\NormalTok{ggset }\SpecialCharTok{\%\textless{}\textgreater{}\%} \FunctionTok{into}\NormalTok{(ggsets)}
\DocumentationTok{\#\# child... gather}
\NormalTok{.chi }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(weight.chi, grobs.chi)}
\NormalTok{.chi }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(.chi, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .size\_subslot, .size\_subslot))}
\DocumentationTok{\#\# ino}
\NormalTok{grobs.nebulae}\SpecialCharTok{$}\NormalTok{child\_nebulae }\SpecialCharTok{\%\textless{}\textgreater{}\%} \FunctionTok{into}\NormalTok{(.chi)}

\DocumentationTok{\#\# visualization}
\FunctionTok{load}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(.expath, }\StringTok{"/toActiv30.rdata"}\NormalTok{))}
\NormalTok{test1 }\OtherTok{\textless{}{-}}\NormalTok{ toActiv30}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\DocumentationTok{\#\# filter}
\FunctionTok{reference}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(test1))}\SpecialCharTok{$}\NormalTok{nebula\_index }\SpecialCharTok{\%\textless{}\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(class.name }\SpecialCharTok{\%in\%} \FunctionTok{sample}\NormalTok{(}\FunctionTok{unique}\NormalTok{(class.name), }\DecValTok{9}\NormalTok{))}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_parent\_nebula}\NormalTok{(test1, }\FloatTok{0.01}\NormalTok{, }\DecValTok{5}\NormalTok{, T)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_nebulae}\NormalTok{(test1, }\FloatTok{0.01}\NormalTok{, }\DecValTok{5}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_parent\_layout}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_layouts}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{activate\_nebulae}\NormalTok{(test1)}
\DocumentationTok{\#\# gather child grobs}
\NormalTok{chAsGrob }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(ch, x) \{}
\NormalTok{  ggset }\OtherTok{\textless{}{-}} \FunctionTok{modify\_default\_child}\NormalTok{(ch)}
\NormalTok{  ggset}\SpecialCharTok{@}\NormalTok{layers}\SpecialCharTok{$}\NormalTok{ggtitle}\SpecialCharTok{@}\NormalTok{command\_args}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{\%\textless{}\textgreater{}\%}
    \FunctionTok{gsub}\NormalTok{(}\StringTok{"[a{-}zA{-}Z]"}\NormalTok{, }\StringTok{"."}\NormalTok{, .) }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{gsub}\NormalTok{(}\StringTok{"\^{}...."}\NormalTok{, }\StringTok{"Class"}\NormalTok{, .)}
  \FunctionTok{as\_grob}\NormalTok{(}\FunctionTok{call\_command}\NormalTok{(ggset))}
\NormalTok{\}}
\NormalTok{sets }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{ggset}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(test1)), chAsGrob, }\AttributeTok{x =}\NormalTok{ test1)}
\NormalTok{sets }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(sets),}
               \ControlFlowTok{function}\NormalTok{(name) \{}
                 \FunctionTok{ggather}\NormalTok{(sets[[name]],}
                         \AttributeTok{vp =} \FunctionTok{viewports}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(test1))[[name]])}
\NormalTok{               \})}
\NormalTok{sets\_vp }\OtherTok{\textless{}{-}} \FunctionTok{viewport}\NormalTok{(}\AttributeTok{layout =} \FunctionTok{grid\_layout}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(test1)))}
\NormalTok{sets }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(ggather, }\FunctionTok{c}\NormalTok{(sets, }\FunctionTok{list}\NormalTok{(}\AttributeTok{vp =}\NormalTok{ sets\_vp)))}
\NormalTok{legendH }\OtherTok{\textless{}{-}}\NormalTok{ MCnebula2}\SpecialCharTok{:::}\FunctionTok{.legend\_hierarchy}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(test1), test1)}
\FunctionTok{export\_name}\NormalTok{(test1)[[}\StringTok{"tani.score"}\NormalTok{]] }\OtherTok{\textless{}{-}} \StringTok{"TS"}
\FunctionTok{export\_name}\NormalTok{(test1)[[}\StringTok{"similarity"}\NormalTok{]] }\OtherTok{\textless{}{-}} \StringTok{"SS"}
\NormalTok{legendG }\OtherTok{\textless{}{-}} \FunctionTok{ggset}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(test1))[[}\DecValTok{1}\NormalTok{]] }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{modify\_default\_child}\NormalTok{(}\AttributeTok{x =}\NormalTok{ test1) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{call\_command}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  MCnebula2}\SpecialCharTok{:::}\FunctionTok{.get\_legend}\NormalTok{()}
\DocumentationTok{\#\# integrate}
\NormalTok{vis }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{sets =} \DecValTok{5}\NormalTok{, }\AttributeTok{legendH =}\NormalTok{ .}\DecValTok{5}\NormalTok{), }\FunctionTok{namel}\NormalTok{(sets, legendH))}
\NormalTok{vis }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{vis =} \DecValTok{4}\NormalTok{, }\AttributeTok{legendG =} \DecValTok{1}\NormalTok{), }\FunctionTok{namel}\NormalTok{(vis, legendG))}
\DocumentationTok{\#\# final}
\NormalTok{.grob.vis }\OtherTok{\textless{}{-}}\NormalTok{ vis}

\DocumentationTok{\#\# report}
\NormalTok{rept }\OtherTok{\textless{}{-}} \FunctionTok{grecti}\NormalTok{(}\StringTok{"Report: Workflow"}\NormalTok{, }\AttributeTok{tfill =}\NormalTok{ pal[[}\StringTok{"report"}\NormalTok{]],}
               \AttributeTok{tgp\_args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{col =} \StringTok{"transparent"}\NormalTok{), }\AttributeTok{borderF =} \FloatTok{1.5}\NormalTok{)}
\NormalTok{head }\OtherTok{\textless{}{-}} \FunctionTok{gtext}\NormalTok{(}\StringTok{"4.4 Create Nebulae"}\NormalTok{, }\AttributeTok{x =} \DecValTok{0}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{0}\NormalTok{)}
\NormalTok{head2 }\OtherTok{\textless{}{-}} \FunctionTok{gtext}\NormalTok{(}\StringTok{"4.5. Visualize Nebulae"}\NormalTok{, }\AttributeTok{x =} \DecValTok{0}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{0}\NormalTok{)}
\NormalTok{fig }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{grectn}\NormalTok{(), }\FunctionTok{gtext}\NormalTok{(}\StringTok{"Fig."}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{cex =} \DecValTok{3}\NormalTok{)))}
\NormalTok{des }\OtherTok{\textless{}{-}} \FunctionTok{gtext}\NormalTok{(}\StringTok{"Description..."}\NormalTok{, }\AttributeTok{x =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{0}\NormalTok{)}
\NormalTok{code }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{grectn}\NormalTok{(}\StringTok{"grey95"}\NormalTok{, , }\FunctionTok{list}\NormalTok{(}\AttributeTok{col =} \StringTok{"transparent"}\NormalTok{)),}
             \FunctionTok{gtext}\NormalTok{(}\StringTok{"\#\# code"}\NormalTok{,}
                   \FunctionTok{list}\NormalTok{(}\AttributeTok{font =} \FunctionTok{c}\NormalTok{(}\AttributeTok{plain =} \DecValTok{1}\NormalTok{)), }\AttributeTok{x =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{0}\NormalTok{))}
\NormalTok{mores }\OtherTok{\textless{}{-}} \FunctionTok{gltext}\NormalTok{(}\StringTok{"More sections"}\NormalTok{)}
\NormalTok{cont }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{mores =}\NormalTok{ .}\DecValTok{3}\NormalTok{, }\AttributeTok{head =}\NormalTok{ .}\DecValTok{3}\NormalTok{, }\AttributeTok{des =}\NormalTok{ .}\DecValTok{2}\NormalTok{, }\AttributeTok{code =}\NormalTok{ .}\DecValTok{3}\NormalTok{,}
                    \AttributeTok{head2 =}\NormalTok{ .}\DecValTok{3}\NormalTok{, }\AttributeTok{fig =} \DecValTok{1}\NormalTok{, }\AttributeTok{des =}\NormalTok{ .}\DecValTok{2}\NormalTok{, }\AttributeTok{code =}\NormalTok{ .}\DecValTok{3}\NormalTok{, }\AttributeTok{mores =}\NormalTok{ .}\DecValTok{3}\NormalTok{),}
                  \FunctionTok{namel}\NormalTok{(head2, head, fig, des, code, mores))}
\NormalTok{cont }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(cont, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{8}\NormalTok{, .}\DecValTok{8}\NormalTok{))}
\NormalTok{rept }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(rept, cont)}
\DocumentationTok{\#\# final}
\NormalTok{.grob.report }\OtherTok{\textless{}{-}}\NormalTok{ rept}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# gather}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\DocumentationTok{\#\# nebulae \# .size\_subslot \textless{}{-} u(1, npc) {-} u(.5, line)}
\NormalTok{weight.nebulae[[ }\StringTok{"ne\_null"}\NormalTok{ ]] }\OtherTok{\textless{}{-}}\NormalTok{ .}\DecValTok{1}
\NormalTok{weight.nebulae }\OtherTok{\textless{}{-}}\NormalTok{ weight.nebulae[}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{2}\NormalTok{)]}
\NormalTok{.nebulae }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(weight.nebulae, }\FunctionTok{c}\NormalTok{(grobs.nebulae, }\FunctionTok{list}\NormalTok{(}\AttributeTok{ne\_null =} \FunctionTok{nullGrob}\NormalTok{())))}
\DocumentationTok{\#\# more}
\NormalTok{.vis }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{slotNebula =} \DecValTok{1}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{3}\NormalTok{, }\AttributeTok{report =} \DecValTok{1}\NormalTok{),}
                  \FunctionTok{list}\NormalTok{(}\AttributeTok{slotNebula =}\NormalTok{ .nebulae, }\AttributeTok{report =}\NormalTok{ .grob.report, }\AttributeTok{null =} \FunctionTok{nullGrob}\NormalTok{()))}
\NormalTok{.vis }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{vis1 =} \DecValTok{1}\NormalTok{, }\AttributeTok{vis\_null =}\NormalTok{ .}\DecValTok{05}\NormalTok{, }\AttributeTok{vis2 =} \DecValTok{1}\NormalTok{),}
                  \FunctionTok{list}\NormalTok{(}\AttributeTok{vis1 =}\NormalTok{ .vis, }\AttributeTok{vis2 =}\NormalTok{ .grob.vis, }\AttributeTok{vis\_null =} \FunctionTok{nullGrob}\NormalTok{()))}
\DocumentationTok{\#\# panel vp}
\NormalTok{.gene.vp}\FloatTok{.2}\NormalTok{w }\OtherTok{\textless{}{-}}\NormalTok{ .gene.vp}
\NormalTok{.gene.vp}\FloatTok{.2}\NormalTok{w}\SpecialCharTok{$}\NormalTok{width }\OtherTok{\textless{}{-}}\NormalTok{ .gene.vp}\SpecialCharTok{$}\NormalTok{width }\SpecialCharTok{*} \DecValTok{2}
\NormalTok{.nebulae }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(.vis, }\AttributeTok{vp =}\NormalTok{ .gene.vp}\FloatTok{.2}\NormalTok{w)}

\DocumentationTok{\#\# show}
\CommentTok{\# x11(, 7, 11)}
\CommentTok{\# draw(.nebulae)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# line and arrow}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\DocumentationTok{\#\# link}
\NormalTok{link }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \StringTok{"grid\_layout"}\NormalTok{, }\StringTok{"vis2"}\NormalTok{, }\StringTok{"visualize\_all"}\NormalTok{,}
  \StringTok{"viewports"}\NormalTok{, }\StringTok{"vis2"}\NormalTok{, }\StringTok{"visualize\_all"}\NormalTok{,}
  \StringTok{"ggset"}\NormalTok{, }\StringTok{"vis2"}\NormalTok{, }\StringTok{"visualize\_all"}
\NormalTok{)}
\NormalTok{link }\OtherTok{\textless{}{-}} \FunctionTok{split}\NormalTok{(link, }\FunctionTok{rep}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\NormalTok{(}\FunctionTok{length}\NormalTok{(link) }\SpecialCharTok{/} \DecValTok{3}\NormalTok{), }\AttributeTok{each =} \DecValTok{3}\NormalTok{))}
\NormalTok{link }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\FunctionTok{t}\NormalTok{(}\FunctionTok{do.call}\NormalTok{(cbind, link)))}
\FunctionTok{names}\NormalTok{(link) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"from"}\NormalTok{, }\StringTok{"to"}\NormalTok{, }\StringTok{"fun"}\NormalTok{)}
\DocumentationTok{\#\# attributes}
\NormalTok{fun\_pal }\OtherTok{\textless{}{-}}\NormalTok{ ggsci}\SpecialCharTok{::}\FunctionTok{pal\_d3}\NormalTok{(}\StringTok{"category20"}\NormalTok{)(}\DecValTok{20}\NormalTok{)}
\NormalTok{fun\_pal }\OtherTok{\textless{}{-}}\NormalTok{ fun\_pal[}\SpecialCharTok{!}\NormalTok{fun\_pal }\SpecialCharTok{\%in\%} \FunctionTok{unique}\NormalTok{(link\_b}\SpecialCharTok{$}\NormalTok{color)]}
\NormalTok{link }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(link,}
  \AttributeTok{group =} \FunctionTok{agroup}\NormalTok{(to, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, }\FunctionTok{integer}\NormalTok{(}\DecValTok{1}\NormalTok{)),}
  \AttributeTok{color =} \FunctionTok{agroup}\NormalTok{(group, fun\_pal),}
  \AttributeTok{left =}\NormalTok{ F, }\AttributeTok{up =}\NormalTok{ F,}
  \AttributeTok{shift =} \DecValTok{2}\NormalTok{,}
  \AttributeTok{dup =} \FunctionTok{duplicated}\NormalTok{(group)}
\NormalTok{)}

\DocumentationTok{\#\# tools}
\NormalTok{tools\_c }\OtherTok{\textless{}{-}} \FunctionTok{maparrow}\NormalTok{(.nebulae, link, }\FunctionTok{list}\NormalTok{(}\AttributeTok{ggset =} \StringTok{"child\_nebulae.*::ggset"}\NormalTok{))}
\NormalTok{link }\OtherTok{\textless{}{-}}\NormalTok{ tools\_c}\SpecialCharTok{$}\NormalTok{data}

\DocumentationTok{\#\# bafs}
\NormalTok{bafs }\OtherTok{\textless{}{-}} \FunctionTok{unlist}\NormalTok{(tools\_c}\SpecialCharTok{$}\NormalTok{bafs, F)}
\NormalTok{bafs }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(bafs, }\ControlFlowTok{function}\NormalTok{(fun) }\FunctionTok{fun}\NormalTok{(}\FunctionTok{u}\NormalTok{(}\DecValTok{1}\NormalTok{, line), }\FunctionTok{u}\NormalTok{(}\DecValTok{1}\NormalTok{, line)))}
\NormalTok{bafs}\SpecialCharTok{$}\NormalTok{vis2.r }\OtherTok{\textless{}{-}} \ConstantTok{NULL}
\NormalTok{bafs}\SpecialCharTok{$}\NormalTok{vis2 }\OtherTok{\textless{}{-}}\NormalTok{ (\{}
  \ControlFlowTok{function}\NormalTok{()\{}
\NormalTok{    g }\OtherTok{\textless{}{-}}\NormalTok{ tools\_c}\SpecialCharTok{$}\NormalTok{nulls}\SpecialCharTok{$}\NormalTok{vis2}\SpecialCharTok{$}\NormalTok{t}
    \FunctionTok{rectGrob}\NormalTok{(}\FunctionTok{grobX}\NormalTok{(g, }\DecValTok{0}\NormalTok{), }\FunctionTok{grobY}\NormalTok{(g, }\DecValTok{0}\NormalTok{), }\FunctionTok{u}\NormalTok{(}\DecValTok{25}\NormalTok{, line), }\FunctionTok{u}\NormalTok{(.}\DecValTok{05}\NormalTok{, line),}
             \AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{col =} \StringTok{"transparent"}\NormalTok{, }\AttributeTok{fill =}\NormalTok{ link}\SpecialCharTok{$}\NormalTok{color[}\DecValTok{1}\NormalTok{]))}
\NormalTok{  \}\})()}

\DocumentationTok{\#\# arrow}
\NormalTok{arr }\OtherTok{\textless{}{-}} \FunctionTok{apply}\NormalTok{(link, }\DecValTok{1}\NormalTok{, }\AttributeTok{simplify =}\NormalTok{ F,}
             \ControlFlowTok{function}\NormalTok{(v) \{}
\NormalTok{               pos }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(}\FunctionTok{as.logical}\NormalTok{(v[[ }\StringTok{"left"}\NormalTok{ ]]), }\StringTok{"l"}\NormalTok{, }\StringTok{"r"}\NormalTok{)}
\NormalTok{               cur }\OtherTok{\textless{}{-}} \ControlFlowTok{if}\NormalTok{ (pos }\SpecialCharTok{==} \StringTok{"l"}\NormalTok{) }\DecValTok{1} \ControlFlowTok{else} \SpecialCharTok{{-}}\DecValTok{1}
\NormalTok{               cur }\OtherTok{\textless{}{-}} \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{as.logical}\NormalTok{(v[[ }\StringTok{"up"}\NormalTok{ ]])) }\SpecialCharTok{{-}}\NormalTok{cur }\ControlFlowTok{else}\NormalTok{ cur}
               \FunctionTok{garrow}\NormalTok{(tools\_c}\SpecialCharTok{$}\NormalTok{nulls[[ v[[}\StringTok{"from"}\NormalTok{]] ]][[ pos ]],}
\NormalTok{                      tools\_c}\SpecialCharTok{$}\NormalTok{nulls[[ v[[}\StringTok{"to"}\NormalTok{]] ]][[ }\StringTok{"t"}\NormalTok{ ]],}
                      \FunctionTok{list}\NormalTok{(}\AttributeTok{curvature =}\NormalTok{ cur, }\AttributeTok{square =}\NormalTok{ T, }\AttributeTok{ncp =} \DecValTok{1}\NormalTok{,}
                           \AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ v[[}\StringTok{"color"}\NormalTok{]], }\AttributeTok{col =}\NormalTok{ v[[}\StringTok{"color"}\NormalTok{]],}
                                     \AttributeTok{lwd =} \FunctionTok{u}\NormalTok{(}\DecValTok{1}\NormalTok{, line)))}
\NormalTok{               )}
\NormalTok{             \})}

\DocumentationTok{\#\# sagnage}
\NormalTok{cvp }\OtherTok{\textless{}{-}} \FunctionTok{garrow\_city}\NormalTok{(tools\_c}\SpecialCharTok{$}\NormalTok{nulls}\SpecialCharTok{$}\NormalTok{ggset}\SpecialCharTok{$}\NormalTok{r, tools\_c}\SpecialCharTok{$}\NormalTok{nulls}\SpecialCharTok{$}\NormalTok{ggset}\SpecialCharTok{$}\NormalTok{t, F, F,}
                   \FunctionTok{u}\NormalTok{(link}\SpecialCharTok{$}\NormalTok{shift[}\DecValTok{1}\NormalTok{], line), }\FunctionTok{gpar}\NormalTok{())}\SpecialCharTok{@}\NormalTok{cvp}
\NormalTok{sag }\OtherTok{\textless{}{-}}\NormalTok{ tools\_c}\SpecialCharTok{$}\NormalTok{sags[[}\DecValTok{1}\NormalTok{]]}
\NormalTok{sag}\SpecialCharTok{$}\NormalTok{vp[[}\DecValTok{1}\NormalTok{]] }\OtherTok{\textless{}{-}}\NormalTok{ cvp}

\NormalTok{.nebulae }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(ggather, }\FunctionTok{c}\NormalTok{(}\FunctionTok{list}\NormalTok{(.nebulae), bafs, arr, }\FunctionTok{list}\NormalTok{(sag)))}
\CommentTok{\# draw(.nebulae)}

\NormalTok{link\_c }\OtherTok{\textless{}{-}}\NormalTok{ link}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-d_across.r}{%
\section{File: d\_across.R}\label{file-d_across.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# all grobs}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\NormalTok{.over }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{a =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{b =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{c =} \DecValTok{1}\NormalTok{),}
                   \FunctionTok{list}\NormalTok{(}\AttributeTok{a =}\NormalTok{ .project, }\AttributeTok{b =}\NormalTok{ .mcn, }\AttributeTok{c =}\NormalTok{ .nebulae))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# line and arrow}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\DocumentationTok{\#\# pal}
\NormalTok{fun\_pal }\OtherTok{\textless{}{-}}\NormalTok{ ggsci}\SpecialCharTok{::}\FunctionTok{pal\_d3}\NormalTok{(}\StringTok{"category20"}\NormalTok{)(}\DecValTok{20}\NormalTok{)}
\NormalTok{fun\_pal }\OtherTok{\textless{}{-}}\NormalTok{ fun\_pal[}\SpecialCharTok{!}\NormalTok{fun\_pal }\SpecialCharTok{\%in\%} \FunctionTok{unique}\NormalTok{(}\FunctionTok{c}\NormalTok{(link\_b}\SpecialCharTok{$}\NormalTok{color, link\_c}\SpecialCharTok{$}\NormalTok{color))]}
\NormalTok{fun\_pal }\OtherTok{\textless{}{-}}\NormalTok{ fun\_pal[}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{]}

\DocumentationTok{\#\# a\_dataset to b\_dataset}
\CommentTok{\# col \textless{}{-} fun\_pal[1]}
\CommentTok{\# a\_dataset \textless{}{-} setnullvp("a::.*::dataset", list(x = 1, y = .5), .over)}
\CommentTok{\# b\_dataset \textless{}{-} setnullvp("b::.*::dataset", list(x = 0, y = .55), .over)}
\CommentTok{\# arr \textless{}{-} garrow\_snake(a\_dataset, b\_dataset, col)}
\CommentTok{\# sag \textless{}{-} sagnage\_shiny("Fil.", F, col)}
\CommentTok{\# sag \textless{}{-} ggather(sag, vp = viewport(grobX(arr, 90), grobY(arr, 90)))}

\DocumentationTok{\#\# a\_dataset to b\_spectral\_similarity}
\CommentTok{\# col \textless{}{-} fun\_pal[2]}
\CommentTok{\# b\_spec \textless{}{-} setnullvp("b::.*::spectral\_similarity", list(x = 0, y = .5), .over)}
\CommentTok{\# baf2 \textless{}{-} baf(grobX(b\_spec, 0), grobY(b\_spec, 0), u(3, line), u(1, line))}
\CommentTok{\# arr2 \textless{}{-} garrow\_snake(a\_dataset, b\_spec, col, cur = {-}1)}
\CommentTok{\# sag2 \textless{}{-} sagnage\_shiny("Com.", F, col)}
\CommentTok{\# sag2 \textless{}{-} ggather(sag2, vp = viewport(grobX(arr2, 270), grobY(arr2, 270)))}

\DocumentationTok{\#\# b\_nebula\_index to c\_child\_nebula}
\NormalTok{col }\OtherTok{\textless{}{-}}\NormalTok{ fun\_pal[}\DecValTok{3}\NormalTok{]}
\NormalTok{b\_index }\OtherTok{\textless{}{-}} \FunctionTok{setnullvp}\NormalTok{(}\StringTok{"b::.*::nebula\_index"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \DecValTok{1}\NormalTok{, }\AttributeTok{y =}\NormalTok{ .}\DecValTok{5}\NormalTok{), .over)}
\NormalTok{b\_index. }\OtherTok{\textless{}{-}} \FunctionTok{setnullvp}\NormalTok{(}\StringTok{"b::.*::nebula\_index"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \FloatTok{1.2}\NormalTok{, }\AttributeTok{y =}\NormalTok{ .}\DecValTok{5}\NormalTok{), .over)}
\NormalTok{c\_child }\OtherTok{\textless{}{-}} \FunctionTok{setnullvp}\NormalTok{(}\StringTok{"c::.*::child\_nebulae"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \DecValTok{0}\NormalTok{, }\AttributeTok{y =}\NormalTok{ .}\DecValTok{95}\NormalTok{), .over)}
\NormalTok{baf3 }\OtherTok{\textless{}{-}} \FunctionTok{baf}\NormalTok{(}\FunctionTok{grobX}\NormalTok{(b\_index, }\DecValTok{0}\NormalTok{), }\FunctionTok{grobY}\NormalTok{(b\_index, }\DecValTok{0}\NormalTok{), }\FunctionTok{u}\NormalTok{(}\DecValTok{3}\NormalTok{, line), }\FunctionTok{u}\NormalTok{(}\DecValTok{1}\NormalTok{, line))}
\NormalTok{arr3 }\OtherTok{\textless{}{-}} \FunctionTok{garrow\_snake}\NormalTok{(b\_index., c\_child, col)}
\NormalTok{sag3 }\OtherTok{\textless{}{-}} \FunctionTok{sagnage\_shiny}\NormalTok{(}\StringTok{"Cre."}\NormalTok{, F, col)}
\NormalTok{sag3 }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(sag3, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(}\FunctionTok{grobX}\NormalTok{(arr3, }\DecValTok{90}\NormalTok{), }\FunctionTok{grobY}\NormalTok{(arr3, }\DecValTok{90}\NormalTok{)))}

\DocumentationTok{\#\# b ... to c\_vis2}
\NormalTok{col }\OtherTok{\textless{}{-}} \StringTok{"grey50"}
\NormalTok{b\_spec }\OtherTok{\textless{}{-}} \FunctionTok{setnullvp}\NormalTok{(}\StringTok{"b::.*::spectral\_similarity"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \FloatTok{1.2}\NormalTok{, }\AttributeTok{y =}\NormalTok{ .}\DecValTok{5}\NormalTok{), .over)}
\NormalTok{c\_vis2 }\OtherTok{\textless{}{-}} \FunctionTok{setnullvp}\NormalTok{(}\StringTok{"c::.*::vis2"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \DecValTok{0}\NormalTok{, }\AttributeTok{y =}\NormalTok{ .}\DecValTok{1}\NormalTok{), .over)}
\NormalTok{c\_vis2. }\OtherTok{\textless{}{-}} \FunctionTok{setnullvp}\NormalTok{(}\StringTok{"c::.*::vis2"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \DecValTok{0}\NormalTok{, }\AttributeTok{y =}\NormalTok{ .}\DecValTok{6}\NormalTok{), .over)}
\NormalTok{seg.x }\OtherTok{\textless{}{-}} \FunctionTok{ruler}\NormalTok{(b\_spec, c\_vis2.)}
\NormalTok{seg.y }\OtherTok{\textless{}{-}} \FunctionTok{ruler}\NormalTok{(c\_vis2, c\_vis2.)}
\NormalTok{arr4 }\OtherTok{\textless{}{-}} \FunctionTok{parrow}\NormalTok{(, col)}
\NormalTok{vp }\OtherTok{\textless{}{-}} \FunctionTok{viewport}\NormalTok{(}\FunctionTok{grobX}\NormalTok{(seg.y, }\DecValTok{0}\NormalTok{), }\FunctionTok{grobY}\NormalTok{(seg.y, }\DecValTok{0}\NormalTok{), }\FunctionTok{grobWidth}\NormalTok{(seg.x), }\FunctionTok{grobHeight}\NormalTok{(seg.y),}
               \AttributeTok{just =} \FunctionTok{c}\NormalTok{(}\StringTok{"right"}\NormalTok{, }\StringTok{"centre"}\NormalTok{))}
\NormalTok{arr4}\SpecialCharTok{$}\NormalTok{vp }\OtherTok{\textless{}{-}}\NormalTok{ vp}
\NormalTok{sag4 }\OtherTok{\textless{}{-}} \FunctionTok{sagnage\_shiny}\NormalTok{(}\StringTok{"Cus."}\NormalTok{, F, col)}
\NormalTok{sag4 }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(sag4, }\AttributeTok{vp =}\NormalTok{ vp)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# legend}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\NormalTok{le1 }\OtherTok{\textless{}{-}} \FunctionTok{grecti2}\NormalTok{(}\StringTok{"..."}\NormalTok{, }\AttributeTok{tfill =}\NormalTok{ pal[[ }\StringTok{"slot"}\NormalTok{ ]])}
\NormalTok{le2 }\OtherTok{\textless{}{-}} \FunctionTok{grecti2}\NormalTok{(}\StringTok{"..."}\NormalTok{, }\AttributeTok{tfill =}\NormalTok{ pal[[ }\StringTok{"sub.slot"}\NormalTok{ ]])}
\NormalTok{le }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{le1 =} \DecValTok{1}\NormalTok{, }\AttributeTok{leNull =}\NormalTok{ .}\DecValTok{2}\NormalTok{, }\AttributeTok{le2 =} \DecValTok{1}\NormalTok{),}
                \FunctionTok{namel}\NormalTok{(le1, }\AttributeTok{leNull =} \FunctionTok{nullGrob}\NormalTok{(), le2))}
\NormalTok{le.text }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{txt1 =} \DecValTok{1}\NormalTok{, }\AttributeTok{txtNull =}\NormalTok{ .}\DecValTok{2}\NormalTok{, }\AttributeTok{txt2 =} \DecValTok{1}\NormalTok{),}
                     \FunctionTok{list}\NormalTok{(}\AttributeTok{txt1 =} \FunctionTok{gtextp}\NormalTok{(}\StringTok{"slot"}\NormalTok{, }\AttributeTok{x =} \DecValTok{0}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{0}\NormalTok{),}
                          \AttributeTok{txtNull =} \FunctionTok{nullGrob}\NormalTok{(),}
                          \AttributeTok{txt2 =} \FunctionTok{gtextp}\NormalTok{(}\StringTok{"sub slot"}\NormalTok{, }\AttributeTok{x =} \DecValTok{0}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{0}\NormalTok{)))}
\NormalTok{le }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{leNull2 =}\NormalTok{ .}\DecValTok{2}\NormalTok{, }\AttributeTok{le =}\NormalTok{ .}\DecValTok{6}\NormalTok{, }\AttributeTok{leNull2 =}\NormalTok{ .}\DecValTok{2}\NormalTok{, }\AttributeTok{le.text =} \DecValTok{1}\NormalTok{),}
                \FunctionTok{namel}\NormalTok{(le, }\AttributeTok{leNull2 =} \FunctionTok{nullGrob}\NormalTok{(), le.text))}

\NormalTok{dsf\_fpal }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(link\_b, color, fun) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{rbind}\NormalTok{(., dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(link\_c, color, fun)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{rbind}\NormalTok{(.,}
    \CommentTok{\# c(fun\_pal[1], "filter"), c(fun\_pal[2], "compute"),}
    \FunctionTok{c}\NormalTok{(fun\_pal[}\DecValTok{3}\NormalTok{], }\StringTok{"create"}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\StringTok{"grey50"}\NormalTok{, }\StringTok{"custom"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(}\AttributeTok{des =}\NormalTok{ stringr}\SpecialCharTok{::}\FunctionTok{str\_extract}\NormalTok{(fun, }\StringTok{"\^{}[a{-}zA{-}Z]\{1,\}"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{distinct}\NormalTok{(color, des) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{split}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{ des)}
\NormalTok{le3 }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(dsf\_fpal, }\AttributeTok{simplify =}\NormalTok{ F,}
  \ControlFlowTok{function}\NormalTok{(df) \{}
\NormalTok{    n }\OtherTok{\textless{}{-}} \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{nrow}\NormalTok{(df) }\SpecialCharTok{\textgreater{}} \DecValTok{1}\NormalTok{) }\DecValTok{2} \ControlFlowTok{else} \DecValTok{1}
\NormalTok{    sags }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\NormalTok{n,}
      \ControlFlowTok{function}\NormalTok{(n) \{}
\NormalTok{        text }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{substr}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{des[n], }\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{), }\StringTok{"."}\NormalTok{)}
\NormalTok{        sag }\OtherTok{\textless{}{-}} \FunctionTok{sagnage\_shiny}\NormalTok{(text, F, df}\SpecialCharTok{$}\NormalTok{color[n])}
\NormalTok{        arr }\OtherTok{\textless{}{-}} \FunctionTok{garrow\_snake}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{x1 =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{y1 =} \DecValTok{1}\NormalTok{),}
          \FunctionTok{list}\NormalTok{(}\AttributeTok{x2 =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{y2 =} \DecValTok{0}\NormalTok{),}
\NormalTok{          df}\SpecialCharTok{$}\NormalTok{color[n])}
\NormalTok{        size }\OtherTok{\textless{}{-}} \FunctionTok{grobHeight}\NormalTok{(}\FunctionTok{gtext}\NormalTok{(}\StringTok{"text"}\NormalTok{)) }\SpecialCharTok{*} \DecValTok{5}
        \FunctionTok{ggather}\NormalTok{(arr, sag, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , size, size))}
\NormalTok{      \})}
    \ControlFlowTok{if}\NormalTok{ (n  }\SpecialCharTok{==} \DecValTok{2}\NormalTok{)}
\NormalTok{      sags }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{c1 =} \DecValTok{1}\NormalTok{, }\AttributeTok{c2 =} \DecValTok{2}\NormalTok{),}
        \FunctionTok{list}\NormalTok{(}\AttributeTok{c1 =}\NormalTok{ sags[[}\DecValTok{1}\NormalTok{]], }\AttributeTok{c2 =}\NormalTok{ sags[[}\DecValTok{2}\NormalTok{]]))}
    \ControlFlowTok{else}
\NormalTok{      sags[[}\DecValTok{1}\NormalTok{]]}
\NormalTok{  \})}
\NormalTok{le3.obj }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(}\FunctionTok{sort}\NormalTok{(}\FunctionTok{names}\NormalTok{(le3)), }\ControlFlowTok{function}\NormalTok{(name) le3[[ name ]], }\AttributeTok{simplify =}\NormalTok{ F)}
\NormalTok{le3 }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{fill\_list}\NormalTok{(}\FunctionTok{names}\NormalTok{(le3.obj), }\DecValTok{1}\NormalTok{), le3.obj)}
\NormalTok{dup }\OtherTok{\textless{}{-}} \FunctionTok{vapply}\NormalTok{(dsf\_fpal, }\ControlFlowTok{function}\NormalTok{(df) }\ControlFlowTok{if}\NormalTok{ (}\FunctionTok{nrow}\NormalTok{(df) }\SpecialCharTok{\textgreater{}} \DecValTok{1}\NormalTok{) T }\ControlFlowTok{else}\NormalTok{ F, T)}
\NormalTok{texts }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(dup, }\FunctionTok{paste0}\NormalTok{(}\StringTok{"...  "}\NormalTok{, }\FunctionTok{form}\NormalTok{(}\FunctionTok{names}\NormalTok{(le3.obj))), }\FunctionTok{names}\NormalTok{(le3.obj))}
\NormalTok{le3.text }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(texts, }\AttributeTok{simplify =}\NormalTok{ F,}
  \ControlFlowTok{function}\NormalTok{(lab) }\FunctionTok{gtextp}\NormalTok{(lab, }\AttributeTok{x =} \DecValTok{0}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{0}\NormalTok{))}
\NormalTok{le3.text }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{fill\_list}\NormalTok{(}\FunctionTok{names}\NormalTok{(le3.text), }\DecValTok{1}\NormalTok{), le3.text)}
\NormalTok{le3 }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{le3 =} \DecValTok{1}\NormalTok{, }\AttributeTok{le3.text =} \DecValTok{1}\NormalTok{), }\FunctionTok{namel}\NormalTok{(le3, le3.text))}

\NormalTok{legend }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{tit1 =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{le =}\NormalTok{ .}\DecValTok{3}\NormalTok{, }\AttributeTok{legendNull =}\NormalTok{ .}\DecValTok{1}\NormalTok{,}
                      \AttributeTok{tit2 =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{le3 =} \DecValTok{1}\NormalTok{),}
                    \FunctionTok{namel}\NormalTok{(}\AttributeTok{tit1 =} \FunctionTok{gtext}\NormalTok{(}\StringTok{"Object"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{cex =} \FloatTok{1.2}\NormalTok{)), le,}
                          \AttributeTok{tit2 =} \FunctionTok{gtext}\NormalTok{(}\StringTok{"Function"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{cex =} \FloatTok{1.2}\NormalTok{)), le3,}
                          \AttributeTok{legendNull =} \FunctionTok{nullGrob}\NormalTok{()))}
\NormalTok{legend }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(legend, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(.}\DecValTok{2}\NormalTok{, , , .}\DecValTok{8}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# Altogether}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\NormalTok{figure }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(.over, baf3, arr3, sag3, arr4, sag4)}
\NormalTok{figure }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{figure =} \DecValTok{1}\NormalTok{, }\AttributeTok{legend =}\NormalTok{ .}\DecValTok{15}\NormalTok{),}
                    \FunctionTok{namel}\NormalTok{(figure, legend))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# output}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\DocumentationTok{\#\# gather all}
\FunctionTok{pdf}\NormalTok{(}\FunctionTok{tmp\_pdf}\NormalTok{(), }\DecValTok{15}\NormalTok{, }\DecValTok{11}\NormalTok{)}
\FunctionTok{draw}\NormalTok{(figure)}
\FunctionTok{dev.off}\NormalTok{()}
\CommentTok{\# op(tmp\_pdf())}
\CommentTok{\# file.copy(tmp\_pdf(), "\textasciitilde{}/Documents/figure.pdf")}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-a_project.r-1}{%
\section{File: a\_project.R}\label{file-a_project.r-1}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# external grob}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\DocumentationTok{\#\# external element}
\NormalTok{grob.path }\OtherTok{\textless{}{-}} \FunctionTok{ex\_grob}\NormalTok{(}\StringTok{"path"}\NormalTok{)}
\NormalTok{grob.dir }\OtherTok{\textless{}{-}} \FunctionTok{ex\_grob}\NormalTok{(}\StringTok{"dir"}\NormalTok{)}
\NormalTok{grob.api }\OtherTok{\textless{}{-}} \FunctionTok{ex\_grob}\NormalTok{(}\StringTok{"api"}\NormalTok{)}
\NormalTok{grob.files }\OtherTok{\textless{}{-}} \FunctionTok{ex\_grob}\NormalTok{(}\StringTok{"files"}\NormalTok{)}
\CommentTok{\# draw(grob.table)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# sub.frame}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\DocumentationTok{\#\# melody: palette}
\NormalTok{type }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"class"}\NormalTok{, }\StringTok{"slot"}\NormalTok{, }\StringTok{"sub.slot"}\NormalTok{, }\StringTok{"function"}\NormalTok{, }\StringTok{"custom"}\NormalTok{)}
\NormalTok{pal }\OtherTok{\textless{}{-}}\NormalTok{ MCnebula2}\SpecialCharTok{:::}\FunctionTok{.as\_dic}\NormalTok{(}\FunctionTok{palette\_set}\NormalTok{(mcn\_5features)[}\SpecialCharTok{{-}}\DecValTok{3}\NormalTok{], type, }\AttributeTok{na.rm =}\NormalTok{ T)}
\NormalTok{pal[[ }\StringTok{"report"}\NormalTok{ ]] }\OtherTok{\textless{}{-}} \StringTok{"black"}

\DocumentationTok{\#\# weight}
\NormalTok{name.slots }\OtherTok{\textless{}{-}} \FunctionTok{slotNames}\NormalTok{(mcn\_5features)}
\NormalTok{name.project }\OtherTok{\textless{}{-}}\NormalTok{ name.slots[}\FunctionTok{grepl}\NormalTok{(}\StringTok{"\^{}project"}\NormalTok{, name.slots)]}
\NormalTok{weight.project }\OtherTok{\textless{}{-}} \FunctionTok{weight}\NormalTok{(mcn\_5features, name.project)}
\NormalTok{weight.project}\SpecialCharTok{$}\NormalTok{project\_metadata }\OtherTok{\textless{}{-}} \DecValTok{3}
\FunctionTok{names}\NormalTok{(weight.project) }\SpecialCharTok{\%\textless{}\textgreater{}\%} \FunctionTok{gsub}\NormalTok{(}\StringTok{"\^{}project\_"}\NormalTok{, }\StringTok{""}\NormalTok{, .)}
\NormalTok{weight.project }\OtherTok{\textless{}{-}}
  \FunctionTok{sapply}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"dataset"}\NormalTok{, }\StringTok{"api"}\NormalTok{, }\StringTok{"metadata"}\NormalTok{, }\StringTok{"conformation"}\NormalTok{, }\StringTok{"version"}\NormalTok{, }\StringTok{"path"}\NormalTok{),}
         \AttributeTok{simplify =}\NormalTok{ F,}
         \ControlFlowTok{function}\NormalTok{(x) weight.project[[ x ]])}

\NormalTok{grobs.project }\OtherTok{\textless{}{-}} \FunctionTok{lst\_grecti}\NormalTok{(}\FunctionTok{names}\NormalTok{(weight.project), pal, , grecti2)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# content}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\DocumentationTok{\#\# project\_path}
\NormalTok{grobs.project}\SpecialCharTok{$}\NormalTok{path }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(grobs.project}\SpecialCharTok{$}\NormalTok{path, grob.path)}

\DocumentationTok{\#\# project\_metadata}
\NormalTok{grectn }\OtherTok{\textless{}{-}} \FunctionTok{grectn}\NormalTok{(, }\FunctionTok{list}\NormalTok{(}\AttributeTok{width =}\NormalTok{ .}\DecValTok{9}\NormalTok{, }\AttributeTok{height =}\NormalTok{ .}\DecValTok{9}\NormalTok{),}
                 \FunctionTok{gpar}\NormalTok{(}\AttributeTok{lty =} \StringTok{"solid"}\NormalTok{), }\AttributeTok{b =} \FunctionTok{match.fun}\NormalTok{(roundrectGrob))}
\NormalTok{grob.menu }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{fill\_list}\NormalTok{(}\FunctionTok{n}\NormalTok{(f, }\DecValTok{3}\NormalTok{), }\DecValTok{1}\NormalTok{), }\FunctionTok{fill\_list}\NormalTok{(}\FunctionTok{n}\NormalTok{(f, }\DecValTok{3}\NormalTok{), }\FunctionTok{list}\NormalTok{(grectn}\SpecialCharTok{@}\NormalTok{grob)))}
\NormalTok{grob.menu }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{fill\_list}\NormalTok{(}\FunctionTok{n}\NormalTok{(fc, }\DecValTok{3}\NormalTok{), }\DecValTok{1}\NormalTok{), }\FunctionTok{fill\_list}\NormalTok{(}\FunctionTok{n}\NormalTok{(fc, }\DecValTok{3}\NormalTok{), }\FunctionTok{list}\NormalTok{(grob.menu)))}
\NormalTok{grob.menu }\OtherTok{\textless{}{-}} \FunctionTok{gTree}\NormalTok{(}\AttributeTok{children =} \FunctionTok{gList}\NormalTok{(grob.menu), }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{8}\NormalTok{, .}\DecValTok{8}\NormalTok{))}
\NormalTok{grob\_files }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{labels =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{files =} \DecValTok{1}\NormalTok{),}
                        \FunctionTok{list}\NormalTok{(}\AttributeTok{labels =} \FunctionTok{gtext}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{......}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{, }\FunctionTok{gpar}\NormalTok{(}\AttributeTok{cex =} \FloatTok{1.2}\NormalTok{), }\AttributeTok{x =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{y =}\NormalTok{ .}\DecValTok{4}\NormalTok{),}
                             \AttributeTok{files =}\NormalTok{ grob.menu))}
\NormalTok{.grob.meta }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{fill\_list}\NormalTok{(}\FunctionTok{n}\NormalTok{(x, }\DecValTok{3}\NormalTok{), }\DecValTok{1}\NormalTok{), }\FunctionTok{fill\_list}\NormalTok{(}\FunctionTok{n}\NormalTok{(x, }\DecValTok{3}\NormalTok{), }\FunctionTok{list}\NormalTok{(grob.dir)))}
\NormalTok{.grob.meta }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{dirs =} \DecValTok{1}\NormalTok{, }\AttributeTok{table =} \DecValTok{2}\NormalTok{), }\FunctionTok{list}\NormalTok{(}\AttributeTok{dirs =}\NormalTok{ .grob.meta, }\AttributeTok{table =}\NormalTok{ grob\_files))}
\DocumentationTok{\#\# arrow 1}
\NormalTok{a1 }\OtherTok{\textless{}{-}} \FunctionTok{setnullvp}\NormalTok{(}\StringTok{"x2"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =}\NormalTok{ .}\DecValTok{8}\NormalTok{, }\AttributeTok{y =}\NormalTok{ .}\DecValTok{8}\NormalTok{), }\AttributeTok{x =}\NormalTok{ .grob.meta)}
\NormalTok{a1. }\OtherTok{\textless{}{-}} \FunctionTok{setnullvp}\NormalTok{(}\StringTok{"files"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \DecValTok{0}\NormalTok{, }\AttributeTok{y =} \DecValTok{1}\NormalTok{), }\AttributeTok{x =}\NormalTok{ .grob.meta)}
\NormalTok{a1 }\OtherTok{\textless{}{-}} \FunctionTok{garrow}\NormalTok{(a1, a1., }\FunctionTok{list}\NormalTok{(}\AttributeTok{curvature =} \DecValTok{0}\NormalTok{, }\AttributeTok{gp =}\NormalTok{ .gpar\_dashed\_line), }\AttributeTok{fun\_arrow =} \ConstantTok{NULL}\NormalTok{)}
\DocumentationTok{\#\# arrow 2}
\NormalTok{a2 }\OtherTok{\textless{}{-}} \FunctionTok{setnullvp}\NormalTok{(}\StringTok{"x2"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =}\NormalTok{ .}\DecValTok{8}\NormalTok{, }\AttributeTok{y =}\NormalTok{ .}\DecValTok{2}\NormalTok{), .grob.meta)}
\NormalTok{a2. }\OtherTok{\textless{}{-}} \FunctionTok{setnullvp}\NormalTok{(}\StringTok{"files"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \DecValTok{0}\NormalTok{, }\AttributeTok{y =} \DecValTok{0}\NormalTok{), .grob.meta)}
\NormalTok{a2 }\OtherTok{\textless{}{-}} \FunctionTok{garrow}\NormalTok{(a2, a2., }\FunctionTok{list}\NormalTok{(}\AttributeTok{curvature =} \DecValTok{0}\NormalTok{, }\AttributeTok{gp =}\NormalTok{ .gpar\_dashed\_line), }\AttributeTok{fun\_arrow =} \ConstantTok{NULL}\NormalTok{)}
\NormalTok{.grob.meta }\OtherTok{\textless{}{-}} \FunctionTok{gTree}\NormalTok{(}\AttributeTok{children =} \FunctionTok{gList}\NormalTok{(.grob.meta, a1, a2))}
\DocumentationTok{\#\# into}
\NormalTok{grobs.project}\SpecialCharTok{$}\NormalTok{metadata }\SpecialCharTok{\%\textless{}\textgreater{}\%} \FunctionTok{into}\NormalTok{(.grob.meta)}

\DocumentationTok{\#\# project\_dataset}
\FunctionTok{load}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(.expath, }\StringTok{"/toAnno5.rdata"}\NormalTok{))}
\NormalTok{anno }\OtherTok{\textless{}{-}} \FunctionTok{features\_annotation}\NormalTok{(toAnno5)}
\DocumentationTok{\#\# formula}
\NormalTok{fml }\OtherTok{\textless{}{-}}\NormalTok{ anno}\SpecialCharTok{$}\NormalTok{mol.formula[}\DecValTok{5}\NormalTok{]}
\NormalTok{fml }\OtherTok{\textless{}{-}} \FunctionTok{gtext}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"Molecular Formula}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{, fml), }\FunctionTok{gpar}\NormalTok{(}\AttributeTok{fontface =} \StringTok{"plain"}\NormalTok{))}
\NormalTok{grob.formu }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{glayer}\NormalTok{(), fml)}
\CommentTok{\# draw(grob.formu)}
\DocumentationTok{\#\# structure}
\DocumentationTok{\#\# get grob structure}
\NormalTok{smi }\OtherTok{\textless{}{-}}\NormalTok{ anno}\SpecialCharTok{$}\NormalTok{smiles[}\DecValTok{5}\NormalTok{]}
\NormalTok{grob.struc }\OtherTok{\textless{}{-}} \FunctionTok{sym\_chem}\NormalTok{(smi)}
\NormalTok{grob.struc }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(}\FunctionTok{into}\NormalTok{(}\FunctionTok{glayer}\NormalTok{(}\DecValTok{6}\NormalTok{), grob.struc), }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{7}\NormalTok{))}
\DocumentationTok{\#\# classes}
\NormalTok{gp.cir }\OtherTok{\textless{}{-}} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{lwd =} \FunctionTok{u}\NormalTok{(}\DecValTok{3}\NormalTok{, line), }\AttributeTok{lty =} \StringTok{"dotted"}\NormalTok{)}
\NormalTok{grob.gla }\OtherTok{\textless{}{-}} \FunctionTok{gTree}\NormalTok{(}\AttributeTok{children =} \FunctionTok{gList}\NormalTok{(}\FunctionTok{gtext}\NormalTok{(}\StringTok{"?"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{cex =} \FloatTok{1.5}\NormalTok{, }\AttributeTok{col =} \StringTok{"red"}\NormalTok{), }\AttributeTok{x =}\NormalTok{ .}\DecValTok{7}\NormalTok{, }\AttributeTok{y =}\NormalTok{ .}\DecValTok{3}\NormalTok{),}
                                   \FunctionTok{circleGrob}\NormalTok{(, , .}\DecValTok{4}\NormalTok{, }\AttributeTok{gp =}\NormalTok{ gp.cir)))}
\DocumentationTok{\#\# Benzene}
\NormalTok{smi }\OtherTok{\textless{}{-}} \StringTok{"C1=CC=CC=C1"}
\NormalTok{grob.ben }\OtherTok{\textless{}{-}} \FunctionTok{sym\_chem}\NormalTok{(smi)}
\DocumentationTok{\#\# group}
\NormalTok{grob.ben\_gla }\OtherTok{\textless{}{-}} \FunctionTok{gTree}\NormalTok{(}\AttributeTok{children =} \FunctionTok{gList}\NormalTok{(grob.ben, grob.gla))}
\NormalTok{class.n }\OtherTok{\textless{}{-}} \DecValTok{5}
\NormalTok{grob.classes }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{glayer}\NormalTok{(class.n), grob.ben\_gla)}
\DocumentationTok{\#\# omit}
\NormalTok{grob.omit }\OtherTok{\textless{}{-}} \FunctionTok{circleGrob}\NormalTok{(}\FunctionTok{seq}\NormalTok{(.}\DecValTok{2}\NormalTok{, .}\DecValTok{8}\NormalTok{, , }\DecValTok{3}\NormalTok{), .}\DecValTok{5}\NormalTok{, .}\DecValTok{07}\NormalTok{, }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fill =} \StringTok{"grey20"}\NormalTok{))}
\NormalTok{grob.omit }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{glayer}\NormalTok{(class.n), grob.omit)}
\DocumentationTok{\#\# groups}
\NormalTok{grob.groups }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{gomit =} \DecValTok{1}\NormalTok{, }\AttributeTok{gclasses =} \DecValTok{1}\NormalTok{, }\AttributeTok{gomit =} \DecValTok{1}\NormalTok{),}
                         \FunctionTok{list}\NormalTok{(}\AttributeTok{gomit =}\NormalTok{ grob.omit, }\AttributeTok{gclasses =}\NormalTok{ grob.classes))}
\DocumentationTok{\#\# gather}
\NormalTok{more }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(}\FunctionTok{gltext}\NormalTok{(}\StringTok{"More data"}\NormalTok{), }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{7}\NormalTok{))}
\NormalTok{.grob.dataset }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{formu =} \DecValTok{1}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{2}\NormalTok{, }\AttributeTok{struc =} \DecValTok{1}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{2}\NormalTok{, }\AttributeTok{class =} \DecValTok{1}\NormalTok{,}
                                \AttributeTok{null =}\NormalTok{ .}\DecValTok{2}\NormalTok{, }\AttributeTok{more =}\NormalTok{ .}\DecValTok{3}\NormalTok{),}
                          \FunctionTok{list}\NormalTok{(}\AttributeTok{formu =}\NormalTok{ grob.formu, }\AttributeTok{struc =}\NormalTok{ grob.struc, }\AttributeTok{class =}\NormalTok{ grob.groups,}
                               \AttributeTok{null =} \FunctionTok{nullGrob}\NormalTok{(), }\AttributeTok{more =}\NormalTok{ more))}
\NormalTok{.grob.dataset }\OtherTok{\textless{}{-}} \FunctionTok{gTree}\NormalTok{(}\AttributeTok{children =} \FunctionTok{gList}\NormalTok{(.grob.dataset), }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{8}\NormalTok{, .}\DecValTok{8}\NormalTok{))}
\DocumentationTok{\#\# into}
\NormalTok{grobs.project}\SpecialCharTok{$}\NormalTok{dataset }\SpecialCharTok{\%\textless{}\textgreater{}\%} \FunctionTok{into}\NormalTok{(.grob.dataset)}

\DocumentationTok{\#\# project\_conformation}
\NormalTok{text }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\AttributeTok{.id =} \StringTok{"regex"}\NormalTok{, }\AttributeTok{.f2\_formula =} \StringTok{"*.tsv"}\NormalTok{, }\AttributeTok{.f3\_fingerid =} \StringTok{"*.tsv"}\NormalTok{, }
          \AttributeTok{.f3\_canopus =} \StringTok{"*.fpt"}\NormalTok{, }\AttributeTok{... =} \StringTok{"..."}\NormalTok{)}
\NormalTok{text.title }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\AttributeTok{.id =} \StringTok{"id"}\NormalTok{, }\AttributeTok{.f2\_formula =} \StringTok{"form."}\NormalTok{, }\AttributeTok{.f3\_fingerid =} \StringTok{"struc."}\NormalTok{,}
                \AttributeTok{.f3\_canopus =} \StringTok{"class"}\NormalTok{, }\AttributeTok{... =} \StringTok{"..."}\NormalTok{)}
\NormalTok{nodes.text }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(text), }\AttributeTok{simplify =}\NormalTok{ F,}
                     \ControlFlowTok{function}\NormalTok{(name) \{}
                       \FunctionTok{grectN}\NormalTok{(text.title[[ name ]], text[[ name ]], }\AttributeTok{bfill =} \StringTok{"lightblue"}\NormalTok{)}
\NormalTok{                     \})}
\DocumentationTok{\#\# nodes}
\NormalTok{nodes}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{Nnull =} \FloatTok{1.5}\NormalTok{, }\AttributeTok{id =} \DecValTok{1}\NormalTok{, }\AttributeTok{Nnull =} \FloatTok{1.5}\NormalTok{),}
                     \FunctionTok{list}\NormalTok{(}\AttributeTok{Nnull =} \FunctionTok{nullGrob}\NormalTok{(), }\AttributeTok{id =}\NormalTok{ nodes.text[[ }\StringTok{".id"}\NormalTok{ ]]))}
\NormalTok{nodes}\FloatTok{.2} \OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{formu =} \DecValTok{1}\NormalTok{, }\AttributeTok{Nnull =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{fing =} \DecValTok{1}\NormalTok{, }\AttributeTok{Nnull =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{cano =} \DecValTok{1}\NormalTok{),}
                     \FunctionTok{list}\NormalTok{(}\AttributeTok{Nnull =} \FunctionTok{nullGrob}\NormalTok{(), }\AttributeTok{formu =}\NormalTok{ nodes.text[[ }\StringTok{".f2\_formula"}\NormalTok{ ]],}
                          \AttributeTok{fing =}\NormalTok{ nodes.text[[ }\StringTok{".f3\_fingerid"}\NormalTok{ ]],}
                          \AttributeTok{cano =}\NormalTok{ nodes.text[[ }\StringTok{".f3\_canopus"}\NormalTok{ ]]))}
\NormalTok{nodes }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{nodes.1 =} \DecValTok{1}\NormalTok{, }\AttributeTok{Nnull =}\NormalTok{ .}\DecValTok{7}\NormalTok{, }\AttributeTok{nodes.2 =} \DecValTok{1}\NormalTok{),}
                   \FunctionTok{list}\NormalTok{(}\AttributeTok{nodes.1 =}\NormalTok{ nodes}\FloatTok{.1}\NormalTok{, }\AttributeTok{nodes.2 =}\NormalTok{ nodes}\FloatTok{.2}\NormalTok{, }\AttributeTok{Nnull =} \FunctionTok{nullGrob}\NormalTok{()))}
\DocumentationTok{\#\# add arrow}
\NormalTok{a1 }\OtherTok{\textless{}{-}} \FunctionTok{setnullvp}\NormalTok{(}\StringTok{"id"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =}\NormalTok{ .}\DecValTok{4}\NormalTok{, }\AttributeTok{y =} \DecValTok{0}\NormalTok{), nodes)}
\NormalTok{a1. }\OtherTok{\textless{}{-}} \FunctionTok{setnullvp}\NormalTok{(}\StringTok{"formu"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =}\NormalTok{ .}\DecValTok{6}\NormalTok{, }\AttributeTok{y =} \DecValTok{1}\NormalTok{), nodes)}
\NormalTok{a1 }\OtherTok{\textless{}{-}} \FunctionTok{garrow}\NormalTok{(a1, a1., }\FunctionTok{list}\NormalTok{(}\AttributeTok{inflect =}\NormalTok{ T, }\AttributeTok{curvature =} \SpecialCharTok{{-}}\NormalTok{.}\DecValTok{1}\NormalTok{))}
\NormalTok{a2 }\OtherTok{\textless{}{-}} \FunctionTok{setnullvp}\NormalTok{(}\StringTok{"id"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{y =} \DecValTok{0}\NormalTok{), nodes)}
\NormalTok{a2. }\OtherTok{\textless{}{-}} \FunctionTok{setnullvp}\NormalTok{(}\StringTok{"fing"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{y =} \DecValTok{1}\NormalTok{), nodes)}
\NormalTok{a2 }\OtherTok{\textless{}{-}} \FunctionTok{garrow}\NormalTok{(a2, a2., }\FunctionTok{list}\NormalTok{(}\AttributeTok{inflect =}\NormalTok{ T, }\AttributeTok{curvature =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{gp =}\NormalTok{ .gpar\_dotted\_line))}
\NormalTok{a3 }\OtherTok{\textless{}{-}} \FunctionTok{setnullvp}\NormalTok{(}\StringTok{"id"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =}\NormalTok{ .}\DecValTok{6}\NormalTok{, }\AttributeTok{y =} \DecValTok{0}\NormalTok{), nodes)}
\NormalTok{a3. }\OtherTok{\textless{}{-}} \FunctionTok{setnullvp}\NormalTok{(}\StringTok{"cano"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =}\NormalTok{ .}\DecValTok{4}\NormalTok{, }\AttributeTok{y =} \DecValTok{1}\NormalTok{), nodes)}
\NormalTok{a3 }\OtherTok{\textless{}{-}} \FunctionTok{garrow}\NormalTok{(a3, a3., }\FunctionTok{list}\NormalTok{(}\AttributeTok{inflect =}\NormalTok{ T, }\AttributeTok{curvature =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{gp =}\NormalTok{ .gpar\_dotted\_line))}
\NormalTok{.grob.confo }\OtherTok{\textless{}{-}} \FunctionTok{gTree}\NormalTok{(}\AttributeTok{children =} \FunctionTok{gList}\NormalTok{(nodes, a1, a2, a3), }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{8}\NormalTok{, .}\DecValTok{8}\NormalTok{))}
\DocumentationTok{\#\# into}
\NormalTok{grobs.project}\SpecialCharTok{$}\NormalTok{conformation }\SpecialCharTok{\%\textless{}\textgreater{}\%} \FunctionTok{into}\NormalTok{(.grob.confo)}

\DocumentationTok{\#\# project\_api}
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{ID =} \FunctionTok{n}\NormalTok{(ID., }\DecValTok{3}\NormalTok{), }\AttributeTok{Form. =} \FunctionTok{n}\NormalTok{(C.H.O., }\DecValTok{3}\NormalTok{), }\AttributeTok{Struc. =} \FunctionTok{n}\NormalTok{(}\StringTok{"CO=CC."}\NormalTok{, }\DecValTok{3}\NormalTok{))}
\NormalTok{grob\_table }\OtherTok{\textless{}{-}}\NormalTok{ gridExtra}\SpecialCharTok{::}\FunctionTok{tableGrob}\NormalTok{(df, }\AttributeTok{theme =}\NormalTok{ gridExtra}\SpecialCharTok{::}\FunctionTok{ttheme\_default}\NormalTok{(}\DecValTok{8}\NormalTok{))}
\NormalTok{grob\_api }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{pfiles =} \DecValTok{1}\NormalTok{, }\AttributeTok{plug =} \DecValTok{1}\NormalTok{),}
                      \FunctionTok{list}\NormalTok{(}\AttributeTok{pfiles =}\NormalTok{ grob.files, }\AttributeTok{plug =}\NormalTok{ grob.api))}
\NormalTok{.grob.api }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{extract =}\NormalTok{ .}\DecValTok{2}\NormalTok{, }\AttributeTok{gtable =} \DecValTok{1}\NormalTok{),}
                       \FunctionTok{list}\NormalTok{(}\AttributeTok{extract =}\NormalTok{ grob\_api, }\AttributeTok{gtable =}\NormalTok{ grob\_table))}
\NormalTok{a1 }\OtherTok{\textless{}{-}} \FunctionTok{setnullvp}\NormalTok{(}\StringTok{"pfiles"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{y =}\NormalTok{ .}\DecValTok{2}\NormalTok{), .grob.api)}
\NormalTok{a1. }\OtherTok{\textless{}{-}} \FunctionTok{setnullvp}\NormalTok{(}\StringTok{"plug"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{y =}\NormalTok{ .}\DecValTok{8}\NormalTok{), .grob.api)}
\NormalTok{a1 }\OtherTok{\textless{}{-}} \FunctionTok{garrow}\NormalTok{(a1, a1.)}
\NormalTok{a2 }\OtherTok{\textless{}{-}} \FunctionTok{setnullvp}\NormalTok{(}\StringTok{"plug"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =}\NormalTok{ .}\DecValTok{9}\NormalTok{), .grob.api)}
\NormalTok{a2. }\OtherTok{\textless{}{-}} \FunctionTok{setnullvp}\NormalTok{(}\StringTok{"gtable"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =}\NormalTok{ .}\DecValTok{1}\NormalTok{), .grob.api)}
\NormalTok{a2 }\OtherTok{\textless{}{-}} \FunctionTok{garrow}\NormalTok{(a2, a2., }\FunctionTok{list}\NormalTok{(}\AttributeTok{inflect =}\NormalTok{ T))}
\NormalTok{.grob.api }\OtherTok{\textless{}{-}} \FunctionTok{gTree}\NormalTok{(}\AttributeTok{children =} \FunctionTok{gList}\NormalTok{(.grob.api, a1, a2))}
\DocumentationTok{\#\# into}
\NormalTok{grobs.project}\SpecialCharTok{$}\NormalTok{api }\SpecialCharTok{\%\textless{}\textgreater{}\%} \FunctionTok{into}\NormalTok{(.grob.api) }

\DocumentationTok{\#\# project\_version}
\NormalTok{.grob.version }\OtherTok{\textless{}{-}} \FunctionTok{gtext}\NormalTok{(}\StringTok{"sirius.v4}\SpecialCharTok{\textbackslash{}n}\StringTok{..."}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{cex =} \FloatTok{1.5}\NormalTok{))}
\DocumentationTok{\#\# into}
\NormalTok{grobs.project}\SpecialCharTok{$}\NormalTok{version }\SpecialCharTok{\%\textless{}\textgreater{}\%} \FunctionTok{into}\NormalTok{(.grob.version)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# gather}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\NormalTok{if.ex }\OtherTok{\textless{}{-}} \FunctionTok{grepl}\NormalTok{(}\StringTok{"version|path"}\NormalTok{, }\FunctionTok{names}\NormalTok{(weight.project))}
\NormalTok{frame.project }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(weight.project, grobs.project, if.ex)}
\NormalTok{.gene.vp }\OtherTok{\textless{}{-}} \FunctionTok{viewport}\NormalTok{(, , }\AttributeTok{width =} \FunctionTok{unit}\NormalTok{(}\DecValTok{8} \SpecialCharTok{*} \FloatTok{1.5}\NormalTok{, }\StringTok{"line"}\NormalTok{),}
                     \AttributeTok{height =} \FunctionTok{unit}\NormalTok{(}\DecValTok{35} \SpecialCharTok{*} \FloatTok{1.5}\NormalTok{, }\StringTok{"line"}\NormalTok{), }\AttributeTok{clip =} \StringTok{"off"}\NormalTok{)}
\NormalTok{.project }\OtherTok{\textless{}{-}} \FunctionTok{gTree}\NormalTok{(}\AttributeTok{children =} \FunctionTok{gList}\NormalTok{(frame.project), }\AttributeTok{vp =}\NormalTok{ .gene.vp)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# line and arrow}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\NormalTok{pal.collate }\OtherTok{\textless{}{-}} \FunctionTok{colorRampPalette}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"white"}\NormalTok{, }\StringTok{"lightblue"}\NormalTok{))(}\DecValTok{6}\NormalTok{)[}\FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{2}\NormalTok{)]}
\NormalTok{a\_gpar }\OtherTok{\textless{}{-}} 
  \FunctionTok{lapply}\NormalTok{(pal.collate,}
         \ControlFlowTok{function}\NormalTok{(col) \{}
           \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ col, }\AttributeTok{col =}\NormalTok{ col, }\AttributeTok{lwd =} \FunctionTok{u}\NormalTok{(}\DecValTok{2}\NormalTok{, line))}
\NormalTok{         \})}

\NormalTok{a.set }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"path"}\NormalTok{, }\StringTok{"conformation"}\NormalTok{, }\StringTok{"metadata"}\NormalTok{, }\StringTok{"api"}\NormalTok{, }\StringTok{"dataset"}\NormalTok{)}
\NormalTok{baf }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, y, }\AttributeTok{width =} \FunctionTok{u}\NormalTok{(}\DecValTok{1}\NormalTok{, line), }\AttributeTok{height =} \FunctionTok{u}\NormalTok{(}\DecValTok{3}\NormalTok{, line)) \{}
\NormalTok{  rect }\OtherTok{\textless{}{-}} \FunctionTok{grectn}\NormalTok{(}\AttributeTok{bgp\_args =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{lty =} \StringTok{"solid"}\NormalTok{))}\SpecialCharTok{@}\NormalTok{grob}
\NormalTok{  clip }\OtherTok{\textless{}{-}} \FunctionTok{clipGrob}\NormalTok{(, , .}\DecValTok{7}\NormalTok{)}
  \FunctionTok{ggather}\NormalTok{(clip, rect, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(x, y, width, height))}
\NormalTok{\}}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{2}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(a.set)) \{}
\NormalTok{  a1 }\OtherTok{\textless{}{-}} \FunctionTok{setnullvp}\NormalTok{(a.set[i }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{], }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \DecValTok{1}\NormalTok{), .project)}
\NormalTok{  a1. }\OtherTok{\textless{}{-}} \FunctionTok{setnullvp}\NormalTok{(a.set[i], }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \DecValTok{1}\NormalTok{), .project)}
  \FunctionTok{assign}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"arr"}\NormalTok{, i }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{),}
         \FunctionTok{garrow}\NormalTok{(a1, a1., }\FunctionTok{list}\NormalTok{(}\AttributeTok{gp =}\NormalTok{ a\_gpar[[ i }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{ ]]), }\AttributeTok{city =} \FunctionTok{list}\NormalTok{(}\AttributeTok{shift =} \FunctionTok{u}\NormalTok{(}\DecValTok{1}\NormalTok{, line))))}
  \FunctionTok{assign}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"baf"}\NormalTok{, i }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{), }\FunctionTok{baf}\NormalTok{(}\FunctionTok{grobX}\NormalTok{(a1, }\DecValTok{0}\NormalTok{), }\FunctionTok{grobY}\NormalTok{(a1, }\DecValTok{0}\NormalTok{)))}
\NormalTok{\}}
\NormalTok{baf. }\OtherTok{\textless{}{-}} \FunctionTok{baf}\NormalTok{(}\FunctionTok{grobX}\NormalTok{(a1., }\DecValTok{0}\NormalTok{), }\FunctionTok{grobY}\NormalTok{(a1., }\DecValTok{0}\NormalTok{))}

\DocumentationTok{\#\# gather}
\NormalTok{.project }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(.project,}
\NormalTok{                    baf1, baf2, baf3, baf4, baf.,}
\NormalTok{                    arr1, arr2, arr3, arr4)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-b_mcn_dataset.r-1}{%
\section{File: b\_mcn\_dataset.R}\label{file-b_mcn_dataset.r-1}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# sub.frame}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\FunctionTok{load}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(.expath, }\StringTok{"/toBinary5.rdata"}\NormalTok{))}
\NormalTok{weight.mcn }\OtherTok{\textless{}{-}} \FunctionTok{weight}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(toBinary5), }\FunctionTok{slotNames}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(toBinary5)))}
\NormalTok{weight.mcn }\OtherTok{\textless{}{-}} 
  \FunctionTok{sapply}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"dataset"}\NormalTok{, }\StringTok{"reference"}\NormalTok{, }\StringTok{"backtrack"}\NormalTok{), }\AttributeTok{simplify =}\NormalTok{ F,}
         \ControlFlowTok{function}\NormalTok{(x) weight.mcn[[x]])}

\NormalTok{grobs.mcn }\OtherTok{\textless{}{-}} \FunctionTok{lst\_grecti}\NormalTok{(}\FunctionTok{names}\NormalTok{(weight.mcn), pal, }\StringTok{"sub.slot"}\NormalTok{, grecti2)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# content}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\DocumentationTok{\#\# dataset}
\DocumentationTok{\#\# features}
\NormalTok{mshn }\OtherTok{\textless{}{-}} \DecValTok{5}
\NormalTok{mshvp }\OtherTok{\textless{}{-}} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{7}\NormalTok{, .}\DecValTok{7}\NormalTok{)}
\NormalTok{fea }\OtherTok{\textless{}{-}} \FunctionTok{circleGrob}\NormalTok{(}\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fill =} \StringTok{"grey85"}\NormalTok{))}
\NormalTok{fea }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(fea, }\AttributeTok{vp =}\NormalTok{ mshvp)}
\NormalTok{grob\_feas }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{fill\_list}\NormalTok{(}\FunctionTok{n}\NormalTok{(fea, mshn), }\DecValTok{1}\NormalTok{), }\FunctionTok{fill\_list}\NormalTok{(}\FunctionTok{n}\NormalTok{(fea, mshn), }\FunctionTok{list}\NormalTok{(fea)))}
\DocumentationTok{\#\# function to draw}
\NormalTok{mglayer }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(}\AttributeTok{from =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{, }\AttributeTok{n =} \DecValTok{5}\NormalTok{, }\AttributeTok{seed =} \DecValTok{100}\NormalTok{) \{}
  \FunctionTok{set.seed}\NormalTok{(seed)}
\NormalTok{  ns }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(from, n, T)}
\NormalTok{  grobs }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(ns, }\ControlFlowTok{function}\NormalTok{(n) \{}
                    \FunctionTok{ggather}\NormalTok{(}\FunctionTok{glayer}\NormalTok{(n), }\AttributeTok{vp =}\NormalTok{ mshvp)}
\NormalTok{         \})}
\NormalTok{  sig }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"glayer"}\NormalTok{, seed), }\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{)}
  \FunctionTok{names}\NormalTok{(grobs) }\OtherTok{\textless{}{-}}\NormalTok{ sig}
  \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{fill\_list}\NormalTok{(sig, }\DecValTok{1}\NormalTok{), grobs)}
\NormalTok{\}}
\DocumentationTok{\#\# set}
\NormalTok{grob\_fset }\OtherTok{\textless{}{-}} \FunctionTok{mglayer}\NormalTok{(, , }\DecValTok{100}\NormalTok{)}
\NormalTok{grob\_sset }\OtherTok{\textless{}{-}} \FunctionTok{mglayer}\NormalTok{(}\DecValTok{2}\SpecialCharTok{:}\DecValTok{7}\NormalTok{, , }\DecValTok{110}\NormalTok{)}
\NormalTok{grob\_cset }\OtherTok{\textless{}{-}} \FunctionTok{mglayer}\NormalTok{(}\DecValTok{5}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, , }\DecValTok{120}\NormalTok{)}
\DocumentationTok{\#\# titles}
\NormalTok{tit\_fea }\OtherTok{\textless{}{-}} \FunctionTok{gltext}\NormalTok{(}\StringTok{"features"}\NormalTok{)}
\NormalTok{tit\_cand }\OtherTok{\textless{}{-}} \FunctionTok{gltext}\NormalTok{(}\StringTok{"candidates"}\NormalTok{, }\AttributeTok{flip =}\NormalTok{ T)}
\NormalTok{tit\_formu }\OtherTok{\textless{}{-}} \FunctionTok{gtext}\NormalTok{(}\StringTok{"molecular formula"}\NormalTok{, }\FunctionTok{gpar}\NormalTok{(}\AttributeTok{fontface =} \StringTok{"plain"}\NormalTok{))}
\NormalTok{tit\_struc }\OtherTok{\textless{}{-}} \FunctionTok{gtext}\NormalTok{(}\StringTok{"chemical structure"}\NormalTok{, }\FunctionTok{gpar}\NormalTok{(}\AttributeTok{fontface =} \StringTok{"plain"}\NormalTok{))}
\NormalTok{tit\_class }\OtherTok{\textless{}{-}} \FunctionTok{gtext}\NormalTok{(}\StringTok{"chemical classes"}\NormalTok{, }\FunctionTok{gpar}\NormalTok{(}\AttributeTok{fontface =} \StringTok{"plain"}\NormalTok{))}
\DocumentationTok{\#\# combine}
\NormalTok{names }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"grob\_feas"}\NormalTok{, }\StringTok{"tit\_formu"}\NormalTok{, }\StringTok{"grob\_fset"}\NormalTok{,}
           \StringTok{"tit\_struc"}\NormalTok{, }\StringTok{"grob\_sset"}\NormalTok{, }\StringTok{"tit\_class"}\NormalTok{, }\StringTok{"grob\_cset"}\NormalTok{)}
\NormalTok{env }\OtherTok{\textless{}{-}} \FunctionTok{environment}\NormalTok{()}
\NormalTok{mdataset }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{fill\_list}\NormalTok{(names, }\DecValTok{1}\NormalTok{), }\FunctionTok{sapply}\NormalTok{(names, get, }\AttributeTok{envir =}\NormalTok{ env))}
\NormalTok{mdataset }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{tit\_cand =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{mdataset =} \DecValTok{1}\NormalTok{),}
                      \FunctionTok{list}\NormalTok{(}\AttributeTok{tit\_cand =}\NormalTok{ tit\_cand, }\AttributeTok{mdataset =}\NormalTok{ mdataset))}
\NormalTok{mdataset }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{tit\_fea =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{mdataset =} \DecValTok{1}\NormalTok{),}
                      \FunctionTok{list}\NormalTok{(}\AttributeTok{tit\_fea =}\NormalTok{ tit\_fea, }\AttributeTok{mdataset =}\NormalTok{ mdataset))}
\NormalTok{.grob.dataset }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(mdataset, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{9}\NormalTok{, .}\DecValTok{9}\NormalTok{))}
\DocumentationTok{\#\# into}
\NormalTok{grobs.mcn}\SpecialCharTok{$}\NormalTok{dataset }\SpecialCharTok{\%\textless{}\textgreater{}\%} \FunctionTok{into}\NormalTok{(.grob.dataset)}

\DocumentationTok{\#\# reference}
\NormalTok{ref }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(}\FunctionTok{reference}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(toBinary5)))}
\DocumentationTok{\#\# spe.table}
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{.fea\_id =} \FunctionTok{n}\NormalTok{(id., }\DecValTok{3}\NormalTok{), }\AttributeTok{.cand\_id =} \FunctionTok{n}\NormalTok{(cand., }\DecValTok{3}\NormalTok{))}
\NormalTok{grob\_table }\OtherTok{\textless{}{-}}\NormalTok{ gridExtra}\SpecialCharTok{::}\FunctionTok{tableGrob}\NormalTok{(df, }\AttributeTok{theme =}\NormalTok{ gridExtra}\SpecialCharTok{::}\FunctionTok{ttheme\_default}\NormalTok{(}\DecValTok{8}\NormalTok{))}
\NormalTok{grobs\_ref }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(ref, }\AttributeTok{simplify =}\NormalTok{ F,}
                    \ControlFlowTok{function}\NormalTok{(name) \{}
                      \ControlFlowTok{if}\NormalTok{ (name }\SpecialCharTok{==} \StringTok{"nebula\_index"}\NormalTok{)}
\NormalTok{                        res }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{gshiny}\NormalTok{(}\AttributeTok{xn =} \DecValTok{6}\NormalTok{), }\FunctionTok{gtext}\NormalTok{(name))}
                      \ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (name }\SpecialCharTok{==} \StringTok{"specific\_candidate"}\NormalTok{) \{}
\NormalTok{                        res }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{tit =}\NormalTok{ .}\DecValTok{2}\NormalTok{, }\AttributeTok{df =} \DecValTok{1}\NormalTok{),}
                                         \FunctionTok{list}\NormalTok{(}\AttributeTok{tit =} \FunctionTok{gtext}\NormalTok{(name, }\AttributeTok{y =}\NormalTok{ .}\DecValTok{2}\NormalTok{), }\AttributeTok{df =}\NormalTok{ grob\_table))}
\NormalTok{                        res }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{grectn}\NormalTok{(}\StringTok{"transparent"}\NormalTok{), res)}
\NormalTok{                      \} }\ControlFlowTok{else}
\NormalTok{                        res }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{grectn}\NormalTok{(}\StringTok{"transparent"}\NormalTok{), }\FunctionTok{gtext}\NormalTok{(name))}
                      \FunctionTok{ggather}\NormalTok{(res, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{9}\NormalTok{))}
\NormalTok{                    \})}
\NormalTok{weight.ref }\OtherTok{\textless{}{-}} \FunctionTok{vapply}\NormalTok{(ref, }\AttributeTok{FUN.VALUE =} \FunctionTok{numeric}\NormalTok{(}\DecValTok{1}\NormalTok{),}
                     \ControlFlowTok{function}\NormalTok{(name) \{}
                       \ControlFlowTok{if}\NormalTok{ (name }\SpecialCharTok{==} \StringTok{"nebula\_index"}\NormalTok{) .}\DecValTok{5}
                       \ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (name }\SpecialCharTok{==} \StringTok{"specific\_candidate"}\NormalTok{) }\FloatTok{1.3}
                       \ControlFlowTok{else}\NormalTok{ .}\DecValTok{5}
\NormalTok{                     \})}
\NormalTok{grobs\_ref }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(weight.ref, grobs\_ref)}
\NormalTok{grobs.ref }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(grobs\_ref, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{9}\NormalTok{, .}\DecValTok{9}\NormalTok{))}
\DocumentationTok{\#\# into}
\NormalTok{grobs.mcn}\SpecialCharTok{$}\NormalTok{reference }\SpecialCharTok{\%\textless{}\textgreater{}\%} \FunctionTok{into}\NormalTok{(grobs.ref)}

\DocumentationTok{\#\# backtrack}
\NormalTok{grob.trash }\OtherTok{\textless{}{-}} \FunctionTok{ex\_grob}\NormalTok{(}\StringTok{"trash"}\NormalTok{)}
\NormalTok{grob\_trash }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(grob.trash, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{8}\NormalTok{, .}\DecValTok{8}\NormalTok{))}
\NormalTok{grobs.mcn}\SpecialCharTok{$}\NormalTok{backtrack }\SpecialCharTok{\%\textless{}\textgreater{}\%} \FunctionTok{into}\NormalTok{(grob\_trash)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# gather}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\NormalTok{.size\_subslot }\OtherTok{\textless{}{-}} \FunctionTok{u}\NormalTok{(}\DecValTok{1}\NormalTok{, npc) }\SpecialCharTok{{-}} \FunctionTok{u}\NormalTok{(.}\DecValTok{5}\NormalTok{, line)}
\NormalTok{frame.mcn }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(weight.mcn, grobs.mcn)}
\NormalTok{frame.mcn }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(frame.mcn, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .size\_subslot, .size\_subslot))}
\NormalTok{.mcn }\OtherTok{\textless{}{-}} \FunctionTok{grecti2}\NormalTok{(}\FunctionTok{form}\NormalTok{(}\StringTok{"mcn\_dataset"}\NormalTok{), }\AttributeTok{tfill =}\NormalTok{ pal[[ }\StringTok{"slot"}\NormalTok{ ]])}
\NormalTok{.mcn }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(.mcn, frame.mcn)}
\NormalTok{.mcn }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(.mcn, }\AttributeTok{vp =}\NormalTok{ .gene.vp)}

\DocumentationTok{\#\# show}
\CommentTok{\# x11(, 7, 11)}
\CommentTok{\# draw(.mcn)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# line and arrow}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\DocumentationTok{\#\# link}
\NormalTok{link }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"dataset"}\NormalTok{, }\StringTok{"stardust\_classes"}\NormalTok{, }\StringTok{"create\_stardust\_classes"}\NormalTok{,}
          \StringTok{"dataset"}\NormalTok{, }\StringTok{"specific\_candidate"}\NormalTok{, }\StringTok{"create\_reference"}\NormalTok{,}
          \StringTok{"dataset"}\NormalTok{, }\StringTok{"features\_annotation"}\NormalTok{, }\StringTok{"create\_features\_annotation"}\NormalTok{,}
          \StringTok{"specific\_candidate"}\NormalTok{, }\StringTok{"features\_annotation"}\NormalTok{, }\StringTok{"create\_features\_annotation"}\NormalTok{,}
          \StringTok{"hierarchy"}\NormalTok{, }\StringTok{"stardust\_classes"}\NormalTok{, }\StringTok{"create\_stardust\_classes"}\NormalTok{,}
          \StringTok{"features\_annotation"}\NormalTok{, }\StringTok{"nebula\_index"}\NormalTok{, }\StringTok{"create\_nebula\_index"}\NormalTok{,}
          \StringTok{"stardust\_classes"}\NormalTok{, }\StringTok{"nebula\_index"}\NormalTok{, }\StringTok{"create\_nebula\_index"}\NormalTok{,}
          \StringTok{"stardust\_classes"}\NormalTok{, }\StringTok{"backtrack"}\NormalTok{, }\StringTok{"cross\_filter\_stardust"}\NormalTok{,}
          \StringTok{"backtrack"}\NormalTok{, }\StringTok{"stardust\_classes"}\NormalTok{, }\StringTok{"backtrack\_stardust"}
\NormalTok{)}
\NormalTok{link }\OtherTok{\textless{}{-}} \FunctionTok{split}\NormalTok{(link, }\FunctionTok{rep}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\NormalTok{(}\FunctionTok{length}\NormalTok{(link) }\SpecialCharTok{/} \DecValTok{3}\NormalTok{), }\AttributeTok{each =} \DecValTok{3}\NormalTok{))}
\NormalTok{link }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\FunctionTok{t}\NormalTok{(}\FunctionTok{do.call}\NormalTok{(cbind, link)))}
\FunctionTok{names}\NormalTok{(link) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"from"}\NormalTok{, }\StringTok{"to"}\NormalTok{, }\StringTok{"fun"}\NormalTok{)}
\DocumentationTok{\#\# the attributes for arrow}
\NormalTok{fun\_pal }\OtherTok{\textless{}{-}}\NormalTok{ ggsci}\SpecialCharTok{::}\FunctionTok{pal\_d3}\NormalTok{(}\StringTok{"category20"}\NormalTok{)(}\DecValTok{20}\NormalTok{)}
\NormalTok{link }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(link,}
                      \AttributeTok{group =} \FunctionTok{agroup}\NormalTok{(to, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, }\FunctionTok{integer}\NormalTok{(}\DecValTok{1}\NormalTok{)),}
                      \AttributeTok{group =} \FunctionTok{ifelse}\NormalTok{(from }\SpecialCharTok{==} \StringTok{"backtrack"}\NormalTok{, }\FunctionTok{max}\NormalTok{(group) }\SpecialCharTok{+} \DecValTok{1}\NormalTok{, group),}
                      \AttributeTok{color =} \FunctionTok{agroup}\NormalTok{(group, fun\_pal),}
                      \AttributeTok{left =} \FunctionTok{ifelse}\NormalTok{(from }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"dataset"}\NormalTok{, }\StringTok{"specific\_candidate"}\NormalTok{), F, T),}
                      \AttributeTok{left =} \FunctionTok{ifelse}\NormalTok{(to }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"specific\_candidate"}\NormalTok{, }\StringTok{"stardust\_classes"}\NormalTok{),}
                                    \SpecialCharTok{!}\NormalTok{left, left),}
                      \AttributeTok{up =} \FunctionTok{ifelse}\NormalTok{(from }\SpecialCharTok{==} \StringTok{"backtrack"}\NormalTok{, T, F),}
                      \AttributeTok{shift =} \FunctionTok{ifelse}\NormalTok{(from }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"dataset"}\NormalTok{, }\StringTok{"backtrack"}\NormalTok{), }\DecValTok{2}\NormalTok{, }\FloatTok{2.5}\NormalTok{))}

\DocumentationTok{\#\# tools}
\NormalTok{tools }\OtherTok{\textless{}{-}} \FunctionTok{maparrow}\NormalTok{(.mcn, link)}
\NormalTok{link }\OtherTok{\textless{}{-}}\NormalTok{ tools}\SpecialCharTok{$}\NormalTok{data}

\DocumentationTok{\#\# complex arr}
\NormalTok{com\_arr }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(tools}\SpecialCharTok{$}\NormalTok{arr\_city),}
                  \ControlFlowTok{function}\NormalTok{(n) \{}
\NormalTok{                    rect }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"create\_stardust\_classes"}\NormalTok{, }\StringTok{"cross\_filter\_stardust"}\NormalTok{,}
                              \StringTok{"create\_features\_annotation"}\NormalTok{, }\StringTok{"backtrack\_stardust"}\NormalTok{)}
                    \ControlFlowTok{if}\NormalTok{ (link}\SpecialCharTok{$}\NormalTok{fun[[ n ]] }\SpecialCharTok{\%in\%}\NormalTok{ rect }\SpecialCharTok{\&} \SpecialCharTok{!}\NormalTok{link}\SpecialCharTok{$}\NormalTok{dup[[ n ]])}
\NormalTok{                      tools}\SpecialCharTok{$}\NormalTok{arr\_city[[n]]}
                    \ControlFlowTok{else}
\NormalTok{                      tools}\SpecialCharTok{$}\NormalTok{arr\_round[[n]]}
\NormalTok{                  \})}

\DocumentationTok{\#\# modify bafs}
\NormalTok{bafs }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(tools}\SpecialCharTok{$}\NormalTok{bafs), }\AttributeTok{simplify =}\NormalTok{ F,}
               \ControlFlowTok{function}\NormalTok{(name)\{}
\NormalTok{                 sub\_name }\OtherTok{\textless{}{-}} \FunctionTok{gsub}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.[a{-}z]$"}\NormalTok{, }\StringTok{""}\NormalTok{, name)}
\NormalTok{                 fun }\OtherTok{\textless{}{-}}\NormalTok{ tools}\SpecialCharTok{$}\NormalTok{bafs[[name]]}
                 \ControlFlowTok{if}\NormalTok{ (sub\_name }\SpecialCharTok{==} \StringTok{"backtrack"}\NormalTok{)}
                   \FunctionTok{fun}\NormalTok{(}\AttributeTok{h =} \FunctionTok{u}\NormalTok{(}\DecValTok{2}\NormalTok{, line))}
                 \ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (sub\_name }\SpecialCharTok{==} \StringTok{"specific\_candidate"}\NormalTok{)}
                   \FunctionTok{fun}\NormalTok{(}\AttributeTok{w =} \FunctionTok{u}\NormalTok{(}\DecValTok{3}\NormalTok{, line))}
                 \ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (sub\_name }\SpecialCharTok{==} \StringTok{"dataset"}\NormalTok{)}
                   \FunctionTok{fun}\NormalTok{()}
                 \ControlFlowTok{else}
                   \FunctionTok{fun}\NormalTok{(}\FunctionTok{u}\NormalTok{(}\DecValTok{3}\NormalTok{, line), }\FunctionTok{u}\NormalTok{(}\DecValTok{1}\NormalTok{, line))}
\NormalTok{               \})}

\DocumentationTok{\#\# show}
\NormalTok{.mcn }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(ggather, }\FunctionTok{c}\NormalTok{(}\FunctionTok{list}\NormalTok{(.mcn), bafs, com\_arr, tools}\SpecialCharTok{$}\NormalTok{sags))}
\CommentTok{\# draw(.mcn)}

\NormalTok{link\_b }\OtherTok{\textless{}{-}}\NormalTok{ link}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-c_nebulae.r-1}{%
\section{File: c\_nebulae.R}\label{file-c_nebulae.r-1}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# sub.frame}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\NormalTok{weight.nebulae }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\AttributeTok{parent\_nebula =}\NormalTok{ .}\DecValTok{7}\NormalTok{, }\AttributeTok{child\_nebulae =} \FloatTok{1.5}\NormalTok{)}
\NormalTok{grobs.nebulae }\OtherTok{\textless{}{-}} \FunctionTok{lst\_grecti}\NormalTok{(}\FunctionTok{names}\NormalTok{(weight.nebulae), pal, }\StringTok{"slot"}\NormalTok{, grecti2)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# content}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\DocumentationTok{\#\# parent\_nebula}
\NormalTok{keep }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"grid\_layout"}\NormalTok{, }\StringTok{"viewports"}\NormalTok{, }\StringTok{"ggset"}\NormalTok{, }\StringTok{"..."}\NormalTok{)}
\NormalTok{name.par }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"..."}\NormalTok{, }\FunctionTok{slotNames}\NormalTok{(}\FunctionTok{parent\_nebula}\NormalTok{(toBinary5)))}
\NormalTok{fun }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(names) \{}
\NormalTok{  names }\OtherTok{\textless{}{-}}\NormalTok{ names[ names }\SpecialCharTok{\%in\%}\NormalTok{ keep ]}
\NormalTok{  weight }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\DecValTok{10}\NormalTok{, }\FunctionTok{length}\NormalTok{(names))}
\NormalTok{  weight[}\FunctionTok{which}\NormalTok{(names }\SpecialCharTok{==} \StringTok{"..."}\NormalTok{)] }\OtherTok{\textless{}{-}} \DecValTok{2}
  \FunctionTok{names}\NormalTok{(weight) }\OtherTok{\textless{}{-}}\NormalTok{ names}
\NormalTok{  weight}
\NormalTok{\}}
\NormalTok{weight.par }\OtherTok{\textless{}{-}} \FunctionTok{fun}\NormalTok{(name.par)}
\DocumentationTok{\#\# draw}
\NormalTok{grobs.par }\OtherTok{\textless{}{-}} \FunctionTok{lst\_grecti}\NormalTok{(}\FunctionTok{names}\NormalTok{(weight.par), pal, }\StringTok{"sub.slot"}\NormalTok{, grecti2)}
\NormalTok{omit }\OtherTok{\textless{}{-}} \FunctionTok{circleGrob}\NormalTok{(}\FunctionTok{seq}\NormalTok{(.}\DecValTok{2}\NormalTok{, .}\DecValTok{8}\NormalTok{, , }\DecValTok{3}\NormalTok{), .}\DecValTok{5}\NormalTok{, .}\DecValTok{07}\NormalTok{, }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fill =} \StringTok{"grey20"}\NormalTok{),}
                   \AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , }\FunctionTok{u}\NormalTok{(}\FloatTok{1.5}\NormalTok{, line), }\FunctionTok{u}\NormalTok{(}\FloatTok{1.5}\NormalTok{, line)))}
\NormalTok{grobs.par}\SpecialCharTok{$}\NormalTok{... }\OtherTok{\textless{}{-}}\NormalTok{ omit}
\DocumentationTok{\#\# ggset}
\NormalTok{ids }\OtherTok{\textless{}{-}} \FunctionTok{n}\NormalTok{(n, }\DecValTok{5}\NormalTok{)}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{99}\NormalTok{)}
\NormalTok{graph }\OtherTok{\textless{}{-}} \FunctionTok{random\_graph}\NormalTok{(ids, }\AttributeTok{layout =} \StringTok{"kk"}\NormalTok{)}
\NormalTok{theme }\OtherTok{\textless{}{-}} \FunctionTok{theme\_void}\NormalTok{() }\SpecialCharTok{+} \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{)}
\NormalTok{layer0 }\OtherTok{\textless{}{-}}\NormalTok{ ggraph}\SpecialCharTok{::}\FunctionTok{ggraph}\NormalTok{(graph)}
\NormalTok{scale\_size }\OtherTok{\textless{}{-}} \FunctionTok{scale\_size}\NormalTok{(}\AttributeTok{range =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{))}
\NormalTok{layer1 }\OtherTok{\textless{}{-}}\NormalTok{ layer0 }\SpecialCharTok{+}\NormalTok{ ggraph}\SpecialCharTok{::}\FunctionTok{geom\_node\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{size =}\NormalTok{ size), }\AttributeTok{shape =} \DecValTok{21}\NormalTok{) }\SpecialCharTok{+}
\NormalTok{  scale\_size }\SpecialCharTok{+}\NormalTok{ theme}
\NormalTok{layer1 }\OtherTok{\textless{}{-}} \FunctionTok{as\_grob}\NormalTok{(layer1)}
\NormalTok{edge\_color }\OtherTok{\textless{}{-}} \StringTok{"lightblue"}
\NormalTok{layer2 }\OtherTok{\textless{}{-}}\NormalTok{ layer0 }\SpecialCharTok{+}
\NormalTok{  ggraph}\SpecialCharTok{::}\FunctionTok{geom\_edge\_fan}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{edge\_width =}\NormalTok{ width), }\AttributeTok{color =}\NormalTok{ edge\_color) }\SpecialCharTok{+}\NormalTok{ theme}
\NormalTok{layer2 }\OtherTok{\textless{}{-}} \FunctionTok{as\_grob}\NormalTok{(layer2)}
\NormalTok{layer4 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{data.frame}\NormalTok{(}\AttributeTok{x =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{2}\NormalTok{, }\AttributeTok{y =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{2}\NormalTok{, }\AttributeTok{fill =} \FunctionTok{n}\NormalTok{(g, }\DecValTok{2}\NormalTok{))) }\SpecialCharTok{+} 
  \FunctionTok{geom\_tile}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y, }\AttributeTok{fill =}\NormalTok{ fill)) }\SpecialCharTok{+} 
\NormalTok{  ggsci}\SpecialCharTok{::}\FunctionTok{scale\_fill\_npg}\NormalTok{() }\SpecialCharTok{+}\NormalTok{ theme}
\NormalTok{layer4 }\OtherTok{\textless{}{-}} \FunctionTok{as\_grob}\NormalTok{(layer4)}
\NormalTok{layer5 }\OtherTok{\textless{}{-}}\NormalTok{ layer0 }\SpecialCharTok{+} 
\NormalTok{  ggraph}\SpecialCharTok{::}\FunctionTok{geom\_edge\_fan}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{edge\_width =}\NormalTok{ width), }\AttributeTok{color =}\NormalTok{ edge\_color) }\SpecialCharTok{+}
\NormalTok{  ggraph}\SpecialCharTok{::}\FunctionTok{geom\_node\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{size =}\NormalTok{ size, }\AttributeTok{fill =}\NormalTok{ name), }\AttributeTok{shape =} \DecValTok{21}\NormalTok{) }\SpecialCharTok{+}
\NormalTok{  scale\_size }\SpecialCharTok{+}
\NormalTok{  ggsci}\SpecialCharTok{::}\FunctionTok{scale\_fill\_npg}\NormalTok{() }\SpecialCharTok{+}
\NormalTok{  theme}
\NormalTok{layer5 }\OtherTok{\textless{}{-}}\NormalTok{ layer5\_ }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(}\FunctionTok{as\_grob}\NormalTok{(layer5))}
\DocumentationTok{\#\# ggset gather}
\NormalTok{layers }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{namel}\NormalTok{(layer1, layer2, layer4, layer5),}
                 \ControlFlowTok{function}\NormalTok{(lay)\{}
                   \FunctionTok{into}\NormalTok{(}\FunctionTok{grectn}\NormalTok{(), lay)}
\NormalTok{                 \})}
\NormalTok{wei\_ggset }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\AttributeTok{layer1 =} \DecValTok{1}\NormalTok{, }\AttributeTok{plus =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{layer2 =} \DecValTok{1}\NormalTok{, }\AttributeTok{plus =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }
               \AttributeTok{layer4 =} \DecValTok{1}\NormalTok{, }\AttributeTok{equals =} \DecValTok{1}\NormalTok{, }\AttributeTok{layer5 =} \DecValTok{1}\NormalTok{)}
\NormalTok{grob\_ggset }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(wei\_ggset, }\FunctionTok{c}\NormalTok{(layers, }\FunctionTok{list}\NormalTok{(}\AttributeTok{plus =} \FunctionTok{gtext}\NormalTok{(}\StringTok{"+"}\NormalTok{),}
                                                  \AttributeTok{equals =} \FunctionTok{gtext}\NormalTok{(}\StringTok{"=\textgreater{}"}\NormalTok{))))}
\NormalTok{grob\_ggset }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(grob\_ggset, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{9}\NormalTok{, .}\DecValTok{5}\NormalTok{))}
\NormalTok{grobs.par}\SpecialCharTok{$}\NormalTok{ggset }\SpecialCharTok{\%\textless{}\textgreater{}\%} \FunctionTok{into}\NormalTok{(grob\_ggset)}
\DocumentationTok{\#\# parent gather}
\NormalTok{.par }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(weight.par, grobs.par)}
\NormalTok{.par }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(.par, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .size\_subslot, .size\_subslot))}
\DocumentationTok{\#\# into}
\NormalTok{grobs.nebulae}\SpecialCharTok{$}\NormalTok{parent\_nebula }\SpecialCharTok{\%\textless{}\textgreater{}\%} \FunctionTok{into}\NormalTok{(.par)}

\DocumentationTok{\#\# child\_nebulae}
\NormalTok{name.chi }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"..."}\NormalTok{, }\FunctionTok{slotNames}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(toBinary5)), }\StringTok{"..."}\NormalTok{)}
\NormalTok{weight.chi }\OtherTok{\textless{}{-}} \FunctionTok{fun}\NormalTok{(name.chi)}
\DocumentationTok{\#\# draw}
\NormalTok{grobs.chi }\OtherTok{\textless{}{-}} \FunctionTok{lst\_grecti}\NormalTok{(}\FunctionTok{names}\NormalTok{(weight.chi), pal, }\StringTok{"sub.slot"}\NormalTok{, grecti2)}
\NormalTok{grobs.chi}\SpecialCharTok{$}\NormalTok{... }\OtherTok{\textless{}{-}}\NormalTok{ omit}
\DocumentationTok{\#\# signal grid layout}
\NormalTok{n }\OtherTok{\textless{}{-}} \DecValTok{3}
\NormalTok{seq }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(.}\DecValTok{2}\NormalTok{, .}\DecValTok{8}\NormalTok{, }\AttributeTok{length.out =}\NormalTok{ n)}
\NormalTok{grid }\OtherTok{\textless{}{-}} \FunctionTok{segmentsGrob}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{, n), seq),}
                     \FunctionTok{c}\NormalTok{(seq, }\FunctionTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, n)),}
                     \FunctionTok{c}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, n), seq),}
                     \FunctionTok{c}\NormalTok{(seq, }\FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{, n)), }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{lty =} \StringTok{"dashed"}\NormalTok{))}
\NormalTok{grid }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(}\FunctionTok{clipGrob}\NormalTok{(}\AttributeTok{height =}\NormalTok{ .}\DecValTok{8}\NormalTok{), }\FunctionTok{rectGrob}\NormalTok{(), grid, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{8}\NormalTok{, .}\DecValTok{8}\NormalTok{))}
\NormalTok{grobs.chi}\SpecialCharTok{$}\NormalTok{grid\_layout }\SpecialCharTok{\%\textless{}\textgreater{}\%} \FunctionTok{into}\NormalTok{(grid)}
\DocumentationTok{\#\# signal viewport}
\NormalTok{n }\OtherTok{\textless{}{-}} \DecValTok{6}
\NormalTok{seq }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\DecValTok{135}\NormalTok{, }\DecValTok{0}\NormalTok{, }\AttributeTok{length.out =}\NormalTok{ n)}
\NormalTok{seq2 }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\DecValTok{45}\NormalTok{, }\DecValTok{0}\NormalTok{, }\AttributeTok{length.out =}\NormalTok{ n)}
\NormalTok{vps }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(seq),}
              \ControlFlowTok{function}\NormalTok{(n, }\AttributeTok{fx =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{fy =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{x =}\NormalTok{ .}\DecValTok{5}\NormalTok{) \{}
\NormalTok{                ang }\OtherTok{\textless{}{-}}\NormalTok{ seq[n]}
\NormalTok{                ang2 }\OtherTok{\textless{}{-}}\NormalTok{ seq2[n]}
\NormalTok{                vp }\OtherTok{\textless{}{-}} \FunctionTok{viewport}\NormalTok{(}\FunctionTok{cospi}\NormalTok{(ang }\SpecialCharTok{/} \DecValTok{180}\NormalTok{) }\SpecialCharTok{*}\NormalTok{ fx }\SpecialCharTok{+}\NormalTok{ x, }\FunctionTok{sinpi}\NormalTok{(ang }\SpecialCharTok{/} \DecValTok{180}\NormalTok{) }\SpecialCharTok{*}\NormalTok{ fy }\SpecialCharTok{+}\NormalTok{ x,}
                               \FunctionTok{u}\NormalTok{(}\DecValTok{2}\NormalTok{, line), }\FunctionTok{u}\NormalTok{(}\DecValTok{2}\NormalTok{, line), }\AttributeTok{angle =}\NormalTok{ ang2,}
                               \AttributeTok{just =} \FunctionTok{c}\NormalTok{(}\StringTok{"centre"}\NormalTok{, }\StringTok{"bottom"}\NormalTok{))}
                \FunctionTok{ggather}\NormalTok{(}\FunctionTok{rectGrob}\NormalTok{(}\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fill =} \StringTok{"lightyellow"}\NormalTok{, }\AttributeTok{col =}\NormalTok{ pal[[}\StringTok{"sub.slot"}\NormalTok{]])),}
                        \FunctionTok{gtext}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"n"}\NormalTok{, }\FunctionTok{rev}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(seq))[n]),}
                              \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fontface =} \StringTok{"plain"}\NormalTok{), }\AttributeTok{form =}\NormalTok{ F), }\AttributeTok{vp =}\NormalTok{ vp)}
\NormalTok{              \})}
\NormalTok{vps }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(ggather, }\FunctionTok{c}\NormalTok{(vps, }\FunctionTok{list}\NormalTok{(}\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, .}\DecValTok{1}\NormalTok{, .}\DecValTok{5}\NormalTok{, .}\DecValTok{5}\NormalTok{))))}
\NormalTok{grobs.chi}\SpecialCharTok{$}\NormalTok{viewports }\SpecialCharTok{\%\textless{}\textgreater{}\%} \FunctionTok{into}\NormalTok{(vps)}
\DocumentationTok{\#\# signal ggset}
\NormalTok{ggsets }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{n =} \DecValTok{1}\NormalTok{, }\AttributeTok{x =} \DecValTok{1}\NormalTok{, }\AttributeTok{mn =} \DecValTok{1}\NormalTok{),}
                    \FunctionTok{list}\NormalTok{(}\AttributeTok{n =} \FunctionTok{gtext}\NormalTok{(}\StringTok{"n"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{cex =} \FloatTok{2.5}\NormalTok{), }\AttributeTok{form =}\NormalTok{ F),}
                         \AttributeTok{x =} \FunctionTok{gtext}\NormalTok{(}\StringTok{"×"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{cex =} \DecValTok{2}\NormalTok{, }\AttributeTok{font =} \FunctionTok{c}\NormalTok{(}\AttributeTok{plain =} \DecValTok{1}\NormalTok{))),}
                         \AttributeTok{mn =} \FunctionTok{into}\NormalTok{(}\FunctionTok{glayer}\NormalTok{(}\DecValTok{3}\NormalTok{), layer5\_)))}
\NormalTok{ggsets }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(ggsets, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{7}\NormalTok{, .}\DecValTok{7}\NormalTok{))}
\NormalTok{grobs.chi}\SpecialCharTok{$}\NormalTok{ggset }\SpecialCharTok{\%\textless{}\textgreater{}\%} \FunctionTok{into}\NormalTok{(ggsets)}
\DocumentationTok{\#\# child... gather}
\NormalTok{.chi }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(weight.chi, grobs.chi)}
\NormalTok{.chi }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(.chi, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .size\_subslot, .size\_subslot))}
\DocumentationTok{\#\# ino}
\NormalTok{grobs.nebulae}\SpecialCharTok{$}\NormalTok{child\_nebulae }\SpecialCharTok{\%\textless{}\textgreater{}\%} \FunctionTok{into}\NormalTok{(.chi)}

\DocumentationTok{\#\# visualization}
\FunctionTok{load}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(.expath, }\StringTok{"/toActiv30.rdata"}\NormalTok{))}
\NormalTok{test1 }\OtherTok{\textless{}{-}}\NormalTok{ toActiv30}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\DocumentationTok{\#\# filter}
\FunctionTok{reference}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(test1))}\SpecialCharTok{$}\NormalTok{nebula\_index }\SpecialCharTok{\%\textless{}\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(class.name }\SpecialCharTok{\%in\%} \FunctionTok{sample}\NormalTok{(}\FunctionTok{unique}\NormalTok{(class.name), }\DecValTok{9}\NormalTok{))}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_parent\_nebula}\NormalTok{(test1, }\FloatTok{0.01}\NormalTok{, T)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_nebulae}\NormalTok{(test1, }\FloatTok{0.01}\NormalTok{, }\DecValTok{5}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_parent\_layout}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_layouts}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{activate\_nebulae}\NormalTok{(test1)}
\DocumentationTok{\#\# gather child grobs}
\NormalTok{chAsGrob }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(ch, x) \{}
\NormalTok{  ggset }\OtherTok{\textless{}{-}} \FunctionTok{modify\_default\_child}\NormalTok{(ch)}
\NormalTok{  ggset}\SpecialCharTok{@}\NormalTok{layers}\SpecialCharTok{$}\NormalTok{ggtitle}\SpecialCharTok{@}\NormalTok{command\_args}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{\%\textless{}\textgreater{}\%}
    \FunctionTok{gsub}\NormalTok{(}\StringTok{"[a{-}zA{-}Z]"}\NormalTok{, }\StringTok{"."}\NormalTok{, .) }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{gsub}\NormalTok{(}\StringTok{"\^{}...."}\NormalTok{, }\StringTok{"Class"}\NormalTok{, .)}
  \FunctionTok{as\_grob}\NormalTok{(}\FunctionTok{call\_command}\NormalTok{(ggset))}
\NormalTok{\}}
\NormalTok{sets }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{ggset}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(test1)), chAsGrob, }\AttributeTok{x =}\NormalTok{ test1)}
\NormalTok{sets }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(sets),}
               \ControlFlowTok{function}\NormalTok{(name) \{}
                 \FunctionTok{ggather}\NormalTok{(sets[[name]],}
                         \AttributeTok{vp =} \FunctionTok{viewports}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(test1))[[name]])}
\NormalTok{               \})}
\NormalTok{sets\_vp }\OtherTok{\textless{}{-}} \FunctionTok{viewport}\NormalTok{(}\AttributeTok{layout =} \FunctionTok{grid\_layout}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(test1)))}
\NormalTok{sets }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(ggather, }\FunctionTok{c}\NormalTok{(sets, }\FunctionTok{list}\NormalTok{(}\AttributeTok{vp =}\NormalTok{ sets\_vp)))}
\NormalTok{legendH }\OtherTok{\textless{}{-}}\NormalTok{ MCnebula2}\SpecialCharTok{:::}\FunctionTok{.legend\_hierarchy}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(test1), test1)}
\FunctionTok{export\_name}\NormalTok{(test1)[[}\StringTok{"tani.score"}\NormalTok{]] }\OtherTok{\textless{}{-}} \StringTok{"TS"}
\FunctionTok{export\_name}\NormalTok{(test1)[[}\StringTok{"similarity"}\NormalTok{]] }\OtherTok{\textless{}{-}} \StringTok{"SS"}
\NormalTok{legendG }\OtherTok{\textless{}{-}} \FunctionTok{ggset}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(test1))[[}\DecValTok{1}\NormalTok{]] }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{modify\_default\_child}\NormalTok{(}\AttributeTok{x =}\NormalTok{ test1) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{call\_command}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  MCnebula2}\SpecialCharTok{:::}\FunctionTok{.get\_legend}\NormalTok{()}
\DocumentationTok{\#\# integrate}
\NormalTok{vis }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{sets =} \DecValTok{5}\NormalTok{, }\AttributeTok{legendH =}\NormalTok{ .}\DecValTok{5}\NormalTok{), }\FunctionTok{namel}\NormalTok{(sets, legendH))}
\NormalTok{vis }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{vis =} \DecValTok{4}\NormalTok{, }\AttributeTok{legendG =} \DecValTok{1}\NormalTok{), }\FunctionTok{namel}\NormalTok{(vis, legendG))}
\DocumentationTok{\#\# final}
\NormalTok{.grob.vis }\OtherTok{\textless{}{-}}\NormalTok{ vis}

\DocumentationTok{\#\# report}
\NormalTok{rept }\OtherTok{\textless{}{-}} \FunctionTok{grecti}\NormalTok{(}\StringTok{"Report: Title"}\NormalTok{, }\AttributeTok{tfill =}\NormalTok{ pal[[}\StringTok{"report"}\NormalTok{]],}
               \AttributeTok{tgp\_args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{col =} \StringTok{"transparent"}\NormalTok{), }\AttributeTok{borderF =} \FloatTok{1.5}\NormalTok{)}
\NormalTok{head }\OtherTok{\textless{}{-}} \FunctionTok{gtext}\NormalTok{(}\StringTok{"1. Heading"}\NormalTok{, }\AttributeTok{x =} \DecValTok{0}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{0}\NormalTok{)}
\NormalTok{head2 }\OtherTok{\textless{}{-}} \FunctionTok{gtext}\NormalTok{(}\StringTok{"2. Heading"}\NormalTok{, }\AttributeTok{x =} \DecValTok{0}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{0}\NormalTok{)}
\NormalTok{fig }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{grectn}\NormalTok{(), }\FunctionTok{gtext}\NormalTok{(}\StringTok{"Fig."}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{cex =} \DecValTok{3}\NormalTok{)))}
\NormalTok{des }\OtherTok{\textless{}{-}} \FunctionTok{gtext}\NormalTok{(}\StringTok{"Description..."}\NormalTok{, }\AttributeTok{x =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{0}\NormalTok{)}
\NormalTok{code }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{grectn}\NormalTok{(}\StringTok{"grey95"}\NormalTok{, , }\FunctionTok{list}\NormalTok{(}\AttributeTok{col =} \StringTok{"transparent"}\NormalTok{)),}
             \FunctionTok{gtext}\NormalTok{(}\StringTok{"\#\# code"}\NormalTok{,}
                   \FunctionTok{list}\NormalTok{(}\AttributeTok{font =} \FunctionTok{c}\NormalTok{(}\AttributeTok{plain =} \DecValTok{1}\NormalTok{)), }\AttributeTok{x =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{0}\NormalTok{))}
\NormalTok{mores }\OtherTok{\textless{}{-}} \FunctionTok{gltext}\NormalTok{(}\StringTok{"More sections"}\NormalTok{)}
\NormalTok{cont }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{head =}\NormalTok{ .}\DecValTok{3}\NormalTok{, }\AttributeTok{des =}\NormalTok{ .}\DecValTok{2}\NormalTok{, }\AttributeTok{code =}\NormalTok{ .}\DecValTok{3}\NormalTok{,}
                    \AttributeTok{head2 =}\NormalTok{ .}\DecValTok{3}\NormalTok{, }\AttributeTok{fig =} \DecValTok{1}\NormalTok{, }\AttributeTok{des =}\NormalTok{ .}\DecValTok{2}\NormalTok{, }\AttributeTok{code =}\NormalTok{ .}\DecValTok{3}\NormalTok{, }\AttributeTok{mores =}\NormalTok{ .}\DecValTok{3}\NormalTok{),}
                  \FunctionTok{namel}\NormalTok{(head2, head, fig, des, code, mores))}
\NormalTok{cont }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(cont, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{8}\NormalTok{, .}\DecValTok{8}\NormalTok{))}
\NormalTok{rept }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(rept, cont)}
\DocumentationTok{\#\# final}
\NormalTok{.grob.report }\OtherTok{\textless{}{-}}\NormalTok{ rept}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# gather}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\DocumentationTok{\#\# nebulae \# .size\_subslot \textless{}{-} u(1, npc) {-} u(.5, line)}
\NormalTok{weight.nebulae[[ }\StringTok{"ne\_null"}\NormalTok{ ]] }\OtherTok{\textless{}{-}}\NormalTok{ .}\DecValTok{1}
\NormalTok{weight.nebulae }\OtherTok{\textless{}{-}}\NormalTok{ weight.nebulae[}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{2}\NormalTok{)]}
\NormalTok{.nebulae }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(weight.nebulae, }\FunctionTok{c}\NormalTok{(grobs.nebulae, }\FunctionTok{list}\NormalTok{(}\AttributeTok{ne\_null =} \FunctionTok{nullGrob}\NormalTok{())))}
\DocumentationTok{\#\# more}
\NormalTok{.vis }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{slotNebula =} \DecValTok{1}\NormalTok{, }\AttributeTok{null =}\NormalTok{ .}\DecValTok{3}\NormalTok{, }\AttributeTok{report =} \DecValTok{1}\NormalTok{),}
                  \FunctionTok{list}\NormalTok{(}\AttributeTok{slotNebula =}\NormalTok{ .nebulae, }\AttributeTok{report =}\NormalTok{ .grob.report, }\AttributeTok{null =} \FunctionTok{nullGrob}\NormalTok{()))}
\NormalTok{.vis }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{vis1 =} \DecValTok{1}\NormalTok{, }\AttributeTok{vis\_null =}\NormalTok{ .}\DecValTok{05}\NormalTok{, }\AttributeTok{vis2 =} \DecValTok{1}\NormalTok{),}
                  \FunctionTok{list}\NormalTok{(}\AttributeTok{vis1 =}\NormalTok{ .vis, }\AttributeTok{vis2 =}\NormalTok{ .grob.vis, }\AttributeTok{vis\_null =} \FunctionTok{nullGrob}\NormalTok{()))}
\DocumentationTok{\#\# panel vp}
\NormalTok{.gene.vp}\FloatTok{.2}\NormalTok{w }\OtherTok{\textless{}{-}}\NormalTok{ .gene.vp}
\NormalTok{.gene.vp}\FloatTok{.2}\NormalTok{w}\SpecialCharTok{$}\NormalTok{width }\OtherTok{\textless{}{-}}\NormalTok{ .gene.vp}\SpecialCharTok{$}\NormalTok{width }\SpecialCharTok{*} \DecValTok{2}
\NormalTok{.nebulae }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(.vis, }\AttributeTok{vp =}\NormalTok{ .gene.vp}\FloatTok{.2}\NormalTok{w)}

\DocumentationTok{\#\# show}
\CommentTok{\# x11(, 7, 11)}
\CommentTok{\# draw(.nebulae)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# line and arrow}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\DocumentationTok{\#\# link}
\NormalTok{link }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
          \StringTok{"grid\_layout"}\NormalTok{, }\StringTok{"vis2"}\NormalTok{, }\StringTok{"visualize\_all"}\NormalTok{,}
          \StringTok{"viewports"}\NormalTok{, }\StringTok{"vis2"}\NormalTok{, }\StringTok{"visualize\_all"}\NormalTok{,}
          \StringTok{"ggset"}\NormalTok{, }\StringTok{"vis2"}\NormalTok{, }\StringTok{"visualize\_all"}
\NormalTok{)}
\NormalTok{link }\OtherTok{\textless{}{-}} \FunctionTok{split}\NormalTok{(link, }\FunctionTok{rep}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\NormalTok{(}\FunctionTok{length}\NormalTok{(link) }\SpecialCharTok{/} \DecValTok{3}\NormalTok{), }\AttributeTok{each =} \DecValTok{3}\NormalTok{))}
\NormalTok{link }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\FunctionTok{t}\NormalTok{(}\FunctionTok{do.call}\NormalTok{(cbind, link)))}
\FunctionTok{names}\NormalTok{(link) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"from"}\NormalTok{, }\StringTok{"to"}\NormalTok{, }\StringTok{"fun"}\NormalTok{)}
\DocumentationTok{\#\# attributes}
\NormalTok{fun\_pal }\OtherTok{\textless{}{-}}\NormalTok{ ggsci}\SpecialCharTok{::}\FunctionTok{pal\_d3}\NormalTok{(}\StringTok{"category20"}\NormalTok{)(}\DecValTok{20}\NormalTok{)}
\NormalTok{fun\_pal }\OtherTok{\textless{}{-}}\NormalTok{ fun\_pal[}\SpecialCharTok{!}\NormalTok{fun\_pal }\SpecialCharTok{\%in\%} \FunctionTok{unique}\NormalTok{(link\_b}\SpecialCharTok{$}\NormalTok{color)]}
\NormalTok{link }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(link,}
                      \AttributeTok{group =} \FunctionTok{agroup}\NormalTok{(to, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, }\FunctionTok{integer}\NormalTok{(}\DecValTok{1}\NormalTok{)),}
                      \AttributeTok{color =} \FunctionTok{agroup}\NormalTok{(group, fun\_pal),}
                      \AttributeTok{left =}\NormalTok{ F, }\AttributeTok{up =}\NormalTok{ F,}
                      \AttributeTok{shift =} \DecValTok{2}\NormalTok{,}
                      \AttributeTok{dup =} \FunctionTok{duplicated}\NormalTok{(group))}

\DocumentationTok{\#\# tools}
\NormalTok{tools\_c }\OtherTok{\textless{}{-}} \FunctionTok{maparrow}\NormalTok{(.nebulae, link, }\FunctionTok{list}\NormalTok{(}\AttributeTok{ggset =} \StringTok{"child\_nebulae.*::ggset"}\NormalTok{))}
\NormalTok{link }\OtherTok{\textless{}{-}}\NormalTok{ tools\_c}\SpecialCharTok{$}\NormalTok{data}

\DocumentationTok{\#\# bafs}
\NormalTok{bafs }\OtherTok{\textless{}{-}} \FunctionTok{unlist}\NormalTok{(tools\_c}\SpecialCharTok{$}\NormalTok{bafs, F)}
\NormalTok{bafs }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(bafs, }\ControlFlowTok{function}\NormalTok{(fun) }\FunctionTok{fun}\NormalTok{(}\FunctionTok{u}\NormalTok{(}\DecValTok{1}\NormalTok{, line), }\FunctionTok{u}\NormalTok{(}\DecValTok{1}\NormalTok{, line)))}
\NormalTok{bafs}\SpecialCharTok{$}\NormalTok{vis2.r }\OtherTok{\textless{}{-}} \ConstantTok{NULL}
\NormalTok{bafs}\SpecialCharTok{$}\NormalTok{vis2 }\OtherTok{\textless{}{-}}\NormalTok{ (\{}
  \ControlFlowTok{function}\NormalTok{()\{}
\NormalTok{    g }\OtherTok{\textless{}{-}}\NormalTok{ tools\_c}\SpecialCharTok{$}\NormalTok{nulls}\SpecialCharTok{$}\NormalTok{vis2}\SpecialCharTok{$}\NormalTok{t}
    \FunctionTok{rectGrob}\NormalTok{(}\FunctionTok{grobX}\NormalTok{(g, }\DecValTok{0}\NormalTok{), }\FunctionTok{grobY}\NormalTok{(g, }\DecValTok{0}\NormalTok{), }\FunctionTok{u}\NormalTok{(}\DecValTok{25}\NormalTok{, line), }\FunctionTok{u}\NormalTok{(.}\DecValTok{05}\NormalTok{, line),}
             \AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{col =} \StringTok{"transparent"}\NormalTok{, }\AttributeTok{fill =}\NormalTok{ link}\SpecialCharTok{$}\NormalTok{color[}\DecValTok{1}\NormalTok{]))}
\NormalTok{  \}\})()}

\DocumentationTok{\#\# arrow}
\NormalTok{arr }\OtherTok{\textless{}{-}} \FunctionTok{apply}\NormalTok{(link, }\DecValTok{1}\NormalTok{, }\AttributeTok{simplify =}\NormalTok{ F,}
             \ControlFlowTok{function}\NormalTok{(v) \{}
\NormalTok{               pos }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(}\FunctionTok{as.logical}\NormalTok{(v[[ }\StringTok{"left"}\NormalTok{ ]]), }\StringTok{"l"}\NormalTok{, }\StringTok{"r"}\NormalTok{)}
\NormalTok{               cur }\OtherTok{\textless{}{-}} \ControlFlowTok{if}\NormalTok{ (pos }\SpecialCharTok{==} \StringTok{"l"}\NormalTok{) }\DecValTok{1} \ControlFlowTok{else} \SpecialCharTok{{-}}\DecValTok{1}
\NormalTok{               cur }\OtherTok{\textless{}{-}} \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{as.logical}\NormalTok{(v[[ }\StringTok{"up"}\NormalTok{ ]])) }\SpecialCharTok{{-}}\NormalTok{cur }\ControlFlowTok{else}\NormalTok{ cur}
               \FunctionTok{garrow}\NormalTok{(tools\_c}\SpecialCharTok{$}\NormalTok{nulls[[ v[[}\StringTok{"from"}\NormalTok{]] ]][[ pos ]],}
\NormalTok{                      tools\_c}\SpecialCharTok{$}\NormalTok{nulls[[ v[[}\StringTok{"to"}\NormalTok{]] ]][[ }\StringTok{"t"}\NormalTok{ ]],}
                      \FunctionTok{list}\NormalTok{(}\AttributeTok{curvature =}\NormalTok{ cur, }\AttributeTok{square =}\NormalTok{ T, }\AttributeTok{ncp =} \DecValTok{1}\NormalTok{,}
                           \AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ v[[}\StringTok{"color"}\NormalTok{]], }\AttributeTok{col =}\NormalTok{ v[[}\StringTok{"color"}\NormalTok{]],}
                                     \AttributeTok{lwd =} \FunctionTok{u}\NormalTok{(}\DecValTok{1}\NormalTok{, line)))}
\NormalTok{               )}
\NormalTok{             \})}

\DocumentationTok{\#\# sagnage}
\NormalTok{cvp }\OtherTok{\textless{}{-}} \FunctionTok{garrow\_city}\NormalTok{(tools\_c}\SpecialCharTok{$}\NormalTok{nulls}\SpecialCharTok{$}\NormalTok{ggset}\SpecialCharTok{$}\NormalTok{r, tools\_c}\SpecialCharTok{$}\NormalTok{nulls}\SpecialCharTok{$}\NormalTok{ggset}\SpecialCharTok{$}\NormalTok{t, F, F,}
                   \FunctionTok{u}\NormalTok{(link}\SpecialCharTok{$}\NormalTok{shift[}\DecValTok{1}\NormalTok{], line), }\FunctionTok{gpar}\NormalTok{())}\SpecialCharTok{@}\NormalTok{cvp}
\NormalTok{sag }\OtherTok{\textless{}{-}}\NormalTok{ tools\_c}\SpecialCharTok{$}\NormalTok{sags[[}\DecValTok{1}\NormalTok{]]}
\NormalTok{sag}\SpecialCharTok{$}\NormalTok{vp[[}\DecValTok{1}\NormalTok{]] }\OtherTok{\textless{}{-}}\NormalTok{ cvp}

\DocumentationTok{\#\# show}
\NormalTok{.nebulae }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(ggather, }\FunctionTok{c}\NormalTok{(}\FunctionTok{list}\NormalTok{(.nebulae), bafs, arr, }\FunctionTok{list}\NormalTok{(sag)))}
\CommentTok{\# draw(tmp.nebulae)}

\NormalTok{link\_c }\OtherTok{\textless{}{-}}\NormalTok{ link}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-d_across.r-1}{%
\section{File: d\_across.R}\label{file-d_across.r-1}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# all grobs}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\NormalTok{.over }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{a =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{b =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{c =} \DecValTok{1}\NormalTok{),}
                   \FunctionTok{list}\NormalTok{(}\AttributeTok{a =}\NormalTok{ .project, }\AttributeTok{b =}\NormalTok{ .mcn, }\AttributeTok{c =}\NormalTok{ .nebulae))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# line and arrow}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\DocumentationTok{\#\# pal}
\NormalTok{fun\_pal }\OtherTok{\textless{}{-}}\NormalTok{ ggsci}\SpecialCharTok{::}\FunctionTok{pal\_d3}\NormalTok{(}\StringTok{"category20"}\NormalTok{)(}\DecValTok{20}\NormalTok{)}
\NormalTok{fun\_pal }\OtherTok{\textless{}{-}}\NormalTok{ fun\_pal[}\SpecialCharTok{!}\NormalTok{fun\_pal }\SpecialCharTok{\%in\%} \FunctionTok{unique}\NormalTok{(}\FunctionTok{c}\NormalTok{(link\_b}\SpecialCharTok{$}\NormalTok{color, link\_c}\SpecialCharTok{$}\NormalTok{color))]}
\NormalTok{fun\_pal }\OtherTok{\textless{}{-}}\NormalTok{ fun\_pal[}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{]}

\DocumentationTok{\#\# a\_dataset to b\_dataset}
\NormalTok{col }\OtherTok{\textless{}{-}}\NormalTok{ fun\_pal[}\DecValTok{1}\NormalTok{]}
\NormalTok{a\_dataset }\OtherTok{\textless{}{-}} \FunctionTok{setnullvp}\NormalTok{(}\StringTok{"a::.*::dataset"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \DecValTok{1}\NormalTok{, }\AttributeTok{y =}\NormalTok{ .}\DecValTok{5}\NormalTok{), .over)}
\NormalTok{b\_dataset }\OtherTok{\textless{}{-}} \FunctionTok{setnullvp}\NormalTok{(}\StringTok{"b::.*::dataset"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \DecValTok{0}\NormalTok{, }\AttributeTok{y =}\NormalTok{ .}\DecValTok{55}\NormalTok{), .over)}
\NormalTok{arr }\OtherTok{\textless{}{-}} \FunctionTok{garrow\_snake}\NormalTok{(a\_dataset, b\_dataset, col)}
\NormalTok{sag }\OtherTok{\textless{}{-}} \FunctionTok{sagnage\_shiny}\NormalTok{(}\StringTok{"Fil."}\NormalTok{, F, col)}
\NormalTok{sag }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(sag, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(}\FunctionTok{grobX}\NormalTok{(arr, }\DecValTok{90}\NormalTok{), }\FunctionTok{grobY}\NormalTok{(arr, }\DecValTok{90}\NormalTok{)))}

\DocumentationTok{\#\# a\_dataset to b\_spectral\_similarity}
\NormalTok{col }\OtherTok{\textless{}{-}}\NormalTok{ fun\_pal[}\DecValTok{2}\NormalTok{]}
\NormalTok{b\_spec }\OtherTok{\textless{}{-}} \FunctionTok{setnullvp}\NormalTok{(}\StringTok{"b::.*::spectral\_similarity"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \DecValTok{0}\NormalTok{, }\AttributeTok{y =}\NormalTok{ .}\DecValTok{5}\NormalTok{), .over)}
\NormalTok{baf2 }\OtherTok{\textless{}{-}} \FunctionTok{baf}\NormalTok{(}\FunctionTok{grobX}\NormalTok{(b\_spec, }\DecValTok{0}\NormalTok{), }\FunctionTok{grobY}\NormalTok{(b\_spec, }\DecValTok{0}\NormalTok{), }\FunctionTok{u}\NormalTok{(}\DecValTok{3}\NormalTok{, line), }\FunctionTok{u}\NormalTok{(}\DecValTok{1}\NormalTok{, line))}
\NormalTok{arr2 }\OtherTok{\textless{}{-}} \FunctionTok{garrow\_snake}\NormalTok{(a\_dataset, b\_spec, col, }\AttributeTok{cur =} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{)}
\NormalTok{sag2 }\OtherTok{\textless{}{-}} \FunctionTok{sagnage\_shiny}\NormalTok{(}\StringTok{"Com."}\NormalTok{, F, col)}
\NormalTok{sag2 }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(sag2, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(}\FunctionTok{grobX}\NormalTok{(arr2, }\DecValTok{270}\NormalTok{), }\FunctionTok{grobY}\NormalTok{(arr2, }\DecValTok{270}\NormalTok{)))}

\DocumentationTok{\#\# b\_nebula\_index to c\_child\_nebula}
\NormalTok{col }\OtherTok{\textless{}{-}}\NormalTok{ fun\_pal[}\DecValTok{4}\NormalTok{]}
\NormalTok{b\_index }\OtherTok{\textless{}{-}} \FunctionTok{setnullvp}\NormalTok{(}\StringTok{"b::.*::nebula\_index"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \DecValTok{1}\NormalTok{, }\AttributeTok{y =}\NormalTok{ .}\DecValTok{5}\NormalTok{), .over)}
\NormalTok{b\_index. }\OtherTok{\textless{}{-}} \FunctionTok{setnullvp}\NormalTok{(}\StringTok{"b::.*::nebula\_index"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \FloatTok{1.2}\NormalTok{, }\AttributeTok{y =}\NormalTok{ .}\DecValTok{5}\NormalTok{), .over)}
\NormalTok{c\_child }\OtherTok{\textless{}{-}} \FunctionTok{setnullvp}\NormalTok{(}\StringTok{"c::.*::child\_nebulae"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \DecValTok{0}\NormalTok{, }\AttributeTok{y =}\NormalTok{ .}\DecValTok{95}\NormalTok{), .over)}
\NormalTok{baf3 }\OtherTok{\textless{}{-}} \FunctionTok{baf}\NormalTok{(}\FunctionTok{grobX}\NormalTok{(b\_index, }\DecValTok{0}\NormalTok{), }\FunctionTok{grobY}\NormalTok{(b\_index, }\DecValTok{0}\NormalTok{), }\FunctionTok{u}\NormalTok{(}\DecValTok{3}\NormalTok{, line), }\FunctionTok{u}\NormalTok{(}\DecValTok{1}\NormalTok{, line))}
\NormalTok{arr3 }\OtherTok{\textless{}{-}} \FunctionTok{garrow\_snake}\NormalTok{(b\_index., c\_child, col)}
\NormalTok{sag3 }\OtherTok{\textless{}{-}} \FunctionTok{sagnage\_shiny}\NormalTok{(}\StringTok{"Cre."}\NormalTok{, F, col)}
\NormalTok{sag3 }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(sag3, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(}\FunctionTok{grobX}\NormalTok{(arr3, }\DecValTok{90}\NormalTok{), }\FunctionTok{grobY}\NormalTok{(arr3, }\DecValTok{90}\NormalTok{)))}

\DocumentationTok{\#\# b ... to c\_vis2}
\NormalTok{col }\OtherTok{\textless{}{-}} \StringTok{"grey50"}
\NormalTok{b\_spec }\OtherTok{\textless{}{-}} \FunctionTok{setnullvp}\NormalTok{(}\StringTok{"b::.*::spectral\_similarity"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \FloatTok{1.2}\NormalTok{, }\AttributeTok{y =}\NormalTok{ .}\DecValTok{5}\NormalTok{), .over)}
\NormalTok{c\_vis2 }\OtherTok{\textless{}{-}} \FunctionTok{setnullvp}\NormalTok{(}\StringTok{"c::.*::vis2"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \DecValTok{0}\NormalTok{, }\AttributeTok{y =}\NormalTok{ .}\DecValTok{1}\NormalTok{), .over)}
\NormalTok{c\_vis2. }\OtherTok{\textless{}{-}} \FunctionTok{setnullvp}\NormalTok{(}\StringTok{"c::.*::vis2"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \DecValTok{0}\NormalTok{, }\AttributeTok{y =}\NormalTok{ .}\DecValTok{6}\NormalTok{), .over)}
\NormalTok{seg.x }\OtherTok{\textless{}{-}} \FunctionTok{ruler}\NormalTok{(b\_spec, c\_vis2.)}
\NormalTok{seg.y }\OtherTok{\textless{}{-}} \FunctionTok{ruler}\NormalTok{(c\_vis2, c\_vis2.)}
\NormalTok{arr4 }\OtherTok{\textless{}{-}} \FunctionTok{parrow}\NormalTok{(, col)}
\NormalTok{vp }\OtherTok{\textless{}{-}} \FunctionTok{viewport}\NormalTok{(}\FunctionTok{grobX}\NormalTok{(seg.y, }\DecValTok{0}\NormalTok{), }\FunctionTok{grobY}\NormalTok{(seg.y, }\DecValTok{0}\NormalTok{), }\FunctionTok{grobWidth}\NormalTok{(seg.x), }\FunctionTok{grobHeight}\NormalTok{(seg.y),}
               \AttributeTok{just =} \FunctionTok{c}\NormalTok{(}\StringTok{"right"}\NormalTok{, }\StringTok{"centre"}\NormalTok{))}
\NormalTok{arr4}\SpecialCharTok{$}\NormalTok{vp }\OtherTok{\textless{}{-}}\NormalTok{ vp}
\NormalTok{sag4 }\OtherTok{\textless{}{-}} \FunctionTok{sagnage\_shiny}\NormalTok{(}\StringTok{"Cus."}\NormalTok{, F, col)}
\NormalTok{sag4 }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(sag4, }\AttributeTok{vp =}\NormalTok{ vp)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# legend}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\NormalTok{le1 }\OtherTok{\textless{}{-}} \FunctionTok{grecti2}\NormalTok{(}\StringTok{"..."}\NormalTok{, }\AttributeTok{tfill =}\NormalTok{ pal[[ }\StringTok{"slot"}\NormalTok{ ]])}
\NormalTok{le2 }\OtherTok{\textless{}{-}} \FunctionTok{grecti2}\NormalTok{(}\StringTok{"..."}\NormalTok{, }\AttributeTok{tfill =}\NormalTok{ pal[[ }\StringTok{"sub.slot"}\NormalTok{ ]])}
\NormalTok{le }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{le1 =} \DecValTok{1}\NormalTok{, }\AttributeTok{leNull =}\NormalTok{ .}\DecValTok{2}\NormalTok{, }\AttributeTok{le2 =} \DecValTok{1}\NormalTok{),}
                \FunctionTok{namel}\NormalTok{(le1, }\AttributeTok{leNull =} \FunctionTok{nullGrob}\NormalTok{(), le2))}
\NormalTok{le.text }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{txt1 =} \DecValTok{1}\NormalTok{, }\AttributeTok{txtNull =}\NormalTok{ .}\DecValTok{2}\NormalTok{, }\AttributeTok{txt2 =} \DecValTok{1}\NormalTok{),}
                     \FunctionTok{list}\NormalTok{(}\AttributeTok{txt1 =} \FunctionTok{gtextp}\NormalTok{(}\StringTok{"slot"}\NormalTok{, }\AttributeTok{x =} \DecValTok{0}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{0}\NormalTok{),}
                          \AttributeTok{txtNull =} \FunctionTok{nullGrob}\NormalTok{(),}
                          \AttributeTok{txt2 =} \FunctionTok{gtextp}\NormalTok{(}\StringTok{"sub slot"}\NormalTok{, }\AttributeTok{x =} \DecValTok{0}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{0}\NormalTok{)))}
\NormalTok{le }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{leNull2 =}\NormalTok{ .}\DecValTok{2}\NormalTok{, }\AttributeTok{le =}\NormalTok{ .}\DecValTok{6}\NormalTok{, }\AttributeTok{leNull2 =}\NormalTok{ .}\DecValTok{2}\NormalTok{, }\AttributeTok{le.text =} \DecValTok{1}\NormalTok{),}
                \FunctionTok{namel}\NormalTok{(le, }\AttributeTok{leNull2 =} \FunctionTok{nullGrob}\NormalTok{(), le.text))}

\NormalTok{dsf\_fpal }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(link\_b, color, fun) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{rbind}\NormalTok{(., dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(link\_c, color, fun)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{rbind}\NormalTok{(., }\FunctionTok{c}\NormalTok{(fun\_pal[}\DecValTok{1}\NormalTok{], }\StringTok{"filter"}\NormalTok{), }\FunctionTok{c}\NormalTok{(fun\_pal[}\DecValTok{2}\NormalTok{], }\StringTok{"compute"}\NormalTok{),}
        \FunctionTok{c}\NormalTok{(fun\_pal[}\DecValTok{4}\NormalTok{], }\StringTok{"create"}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\StringTok{"grey50"}\NormalTok{, }\StringTok{"custom"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(}\AttributeTok{des =}\NormalTok{ stringr}\SpecialCharTok{::}\FunctionTok{str\_extract}\NormalTok{(fun, }\StringTok{"\^{}[a{-}zA{-}Z]\{1,\}"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{distinct}\NormalTok{(color, des) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{split}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{ des)}
\NormalTok{le3 }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(dsf\_fpal, }\AttributeTok{simplify =}\NormalTok{ F,}
              \ControlFlowTok{function}\NormalTok{(df) \{}
\NormalTok{                n }\OtherTok{\textless{}{-}} \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{nrow}\NormalTok{(df) }\SpecialCharTok{\textgreater{}} \DecValTok{1}\NormalTok{) }\DecValTok{2} \ControlFlowTok{else} \DecValTok{1}
\NormalTok{                sags }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\NormalTok{n,}
                               \ControlFlowTok{function}\NormalTok{(n) \{}
\NormalTok{                                 text }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{substr}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{des[n], }\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{), }\StringTok{"."}\NormalTok{)}
\NormalTok{                                 sag }\OtherTok{\textless{}{-}} \FunctionTok{sagnage\_shiny}\NormalTok{(text, F, df}\SpecialCharTok{$}\NormalTok{color[n])}
\NormalTok{                                 arr }\OtherTok{\textless{}{-}} \FunctionTok{garrow\_snake}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{x1 =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{y1 =} \DecValTok{1}\NormalTok{),}
                                                     \FunctionTok{list}\NormalTok{(}\AttributeTok{x2 =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{y2 =} \DecValTok{0}\NormalTok{),}
\NormalTok{                                                     df}\SpecialCharTok{$}\NormalTok{color[n])}
\NormalTok{                                 size }\OtherTok{\textless{}{-}} \FunctionTok{grobHeight}\NormalTok{(}\FunctionTok{gtext}\NormalTok{(}\StringTok{"text"}\NormalTok{)) }\SpecialCharTok{*} \DecValTok{5}
                                 \FunctionTok{ggather}\NormalTok{(arr, sag, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , size, size))}
\NormalTok{                               \})}
                \ControlFlowTok{if}\NormalTok{ (n  }\SpecialCharTok{==} \DecValTok{2}\NormalTok{)}
\NormalTok{                  sags }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{c1 =} \DecValTok{1}\NormalTok{, }\AttributeTok{c2 =} \DecValTok{2}\NormalTok{),}
                                    \FunctionTok{list}\NormalTok{(}\AttributeTok{c1 =}\NormalTok{ sags[[}\DecValTok{1}\NormalTok{]], }\AttributeTok{c2 =}\NormalTok{ sags[[}\DecValTok{2}\NormalTok{]]))}
                \ControlFlowTok{else}
\NormalTok{                  sags[[}\DecValTok{1}\NormalTok{]]}
\NormalTok{              \})}
\NormalTok{le3.obj }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(}\FunctionTok{sort}\NormalTok{(}\FunctionTok{names}\NormalTok{(le3)), }\ControlFlowTok{function}\NormalTok{(name) le3[[ name ]], }\AttributeTok{simplify =}\NormalTok{ F)}
\NormalTok{le3 }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{fill\_list}\NormalTok{(}\FunctionTok{names}\NormalTok{(le3.obj), }\DecValTok{1}\NormalTok{), le3.obj)}
\NormalTok{dup }\OtherTok{\textless{}{-}} \FunctionTok{vapply}\NormalTok{(dsf\_fpal, }\ControlFlowTok{function}\NormalTok{(df) }\ControlFlowTok{if}\NormalTok{ (}\FunctionTok{nrow}\NormalTok{(df) }\SpecialCharTok{\textgreater{}} \DecValTok{1}\NormalTok{) T }\ControlFlowTok{else}\NormalTok{ F, T)}
\NormalTok{texts }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(dup, }\FunctionTok{paste0}\NormalTok{(}\StringTok{"...  "}\NormalTok{, }\FunctionTok{form}\NormalTok{(}\FunctionTok{names}\NormalTok{(le3.obj))), }\FunctionTok{names}\NormalTok{(le3.obj))}
\NormalTok{le3.text }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(texts, }\AttributeTok{simplify =}\NormalTok{ F,}
                   \ControlFlowTok{function}\NormalTok{(lab) }\FunctionTok{gtextp}\NormalTok{(lab, }\AttributeTok{x =} \DecValTok{0}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{0}\NormalTok{))}
\NormalTok{le3.text }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{fill\_list}\NormalTok{(}\FunctionTok{names}\NormalTok{(le3.text), }\DecValTok{1}\NormalTok{), le3.text)}
\NormalTok{le3 }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{le3 =} \DecValTok{1}\NormalTok{, }\AttributeTok{le3.text =} \DecValTok{1}\NormalTok{), }\FunctionTok{namel}\NormalTok{(le3, le3.text))}

\NormalTok{legend }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{tit1 =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{le =}\NormalTok{ .}\DecValTok{3}\NormalTok{, }\AttributeTok{legendNull =}\NormalTok{ .}\DecValTok{1}\NormalTok{,}
                      \AttributeTok{tit2 =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{le3 =} \DecValTok{1}\NormalTok{),}
                    \FunctionTok{namel}\NormalTok{(}\AttributeTok{tit1 =} \FunctionTok{gtext}\NormalTok{(}\StringTok{"Object"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{cex =} \FloatTok{1.2}\NormalTok{)), le,}
                          \AttributeTok{tit2 =} \FunctionTok{gtext}\NormalTok{(}\StringTok{"Function"}\NormalTok{, }\FunctionTok{list}\NormalTok{(}\AttributeTok{cex =} \FloatTok{1.2}\NormalTok{)), le3,}
                          \AttributeTok{legendNull =} \FunctionTok{nullGrob}\NormalTok{()))}
\NormalTok{legend }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(legend, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(.}\DecValTok{2}\NormalTok{, , , .}\DecValTok{8}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# Altogether}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\NormalTok{figure }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(.over, arr, sag, baf2, arr2, sag2,}
\NormalTok{                  baf3, arr3, sag3, arr4, sag4)}
\NormalTok{figure }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{figure =} \DecValTok{1}\NormalTok{, }\AttributeTok{legend =}\NormalTok{ .}\DecValTok{15}\NormalTok{),}
                    \FunctionTok{namel}\NormalTok{(figure, legend))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# output}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\DocumentationTok{\#\# gather all}
\FunctionTok{pdf}\NormalTok{(}\FunctionTok{tmp\_pdf}\NormalTok{(), }\DecValTok{17}\NormalTok{, }\DecValTok{11}\NormalTok{)}
\FunctionTok{draw}\NormalTok{(figure)}
\FunctionTok{dev.off}\NormalTok{()}
\FunctionTok{op}\NormalTok{(}\FunctionTok{tmp\_pdf}\NormalTok{())}

\CommentTok{\# file.copy(tmp\_pdf(), "\textasciitilde{}/Documents/figure.pdf")}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-merge_into_examples.r}{%
\section{File: merge\_into\_examples.R}\label{file-merge_into_examples.r}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{setwd}\NormalTok{(}\StringTok{"\textasciitilde{}/MCnebula2/R"}\NormalTok{)}
\FunctionTok{library}\NormalTok{(magrittr)}

\NormalTok{script }\OtherTok{\textless{}{-}} \FunctionTok{list.files}\NormalTok{(}\StringTok{"."}\NormalTok{, }\AttributeTok{pattern =} \StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.R$"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{sapply}\NormalTok{(readLines)}

\NormalTok{ex\_path }\OtherTok{\textless{}{-}} \StringTok{"/home/echo/outline/mc.test/example/"}

\NormalTok{dontrun }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(codes)\{}
\NormalTok{  codes }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"\#\textquotesingle{} @examples"}\NormalTok{,}
             \StringTok{"\#\textquotesingle{} }\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{dontrun\{"}\NormalTok{,}
             \FunctionTok{paste0}\NormalTok{(}\StringTok{"\#\textquotesingle{}   "}\NormalTok{, codes),}
             \StringTok{"\#\textquotesingle{} \}"}
\NormalTok{  )}
  \FunctionTok{paste0}\NormalTok{(codes, }\AttributeTok{collapse =} \StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{\}}

\NormalTok{target }\OtherTok{\textless{}{-}} 
  \FunctionTok{lapply}\NormalTok{(script,}
         \ControlFlowTok{function}\NormalTok{(text)\{}
\NormalTok{           sig }\OtherTok{\textless{}{-}} \DecValTok{0}
\NormalTok{           record }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
           \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(text)) \{}
             \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{grepl}\NormalTok{(}\StringTok{"\^{}\#\textquotesingle{}"}\NormalTok{, text[i])) \{}
               \ControlFlowTok{if}\NormalTok{ (sig }\SpecialCharTok{==} \DecValTok{3}\NormalTok{) \{}
                 \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{grepl}\NormalTok{(}\StringTok{"\^{}[a{-}z|A{-}Z|.]"}\NormalTok{, text[i])) \{}
                   \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(record[[tar]])) \{}
\NormalTok{                     sig }\OtherTok{\textless{}{-}} \DecValTok{1}
                     \ControlFlowTok{next}
\NormalTok{                   \}}
\NormalTok{                   record[[tar]] }\OtherTok{\textless{}{-}}\NormalTok{ T}
\NormalTok{                   file }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(ex\_path, tar, }\StringTok{".R"}\NormalTok{)}
\NormalTok{                   codes }\OtherTok{\textless{}{-}} \FunctionTok{readLines}\NormalTok{(file)}
\NormalTok{                   start }\OtherTok{\textless{}{-}} \FunctionTok{grep}\NormalTok{(}\StringTok{"\^{}\#\# codes"}\NormalTok{, codes)[}\DecValTok{1}\NormalTok{] }\SpecialCharTok{+} \DecValTok{1}
                   \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(codes) }\SpecialCharTok{\textless{}}\NormalTok{ start) \{}
                     \ControlFlowTok{next}
\NormalTok{                   \}}
\NormalTok{                   codes }\OtherTok{\textless{}{-}}\NormalTok{ codes[start}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(codes)]}
\NormalTok{                   codes }\OtherTok{\textless{}{-}} \FunctionTok{dontrun}\NormalTok{(codes)}
                   \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{grepl}\NormalTok{(}\StringTok{"\#\textquotesingle{}}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{s\{0,\}$"}\NormalTok{, text[i }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{])) \{}
\NormalTok{                     codes }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"\#\textquotesingle{}}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{, codes)}
\NormalTok{                   \}}
\NormalTok{                   text[i] }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(codes, }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{, text[i])}
\NormalTok{                 \}}
\NormalTok{               \}}
\NormalTok{               sig }\OtherTok{\textless{}{-}} \DecValTok{1}
               \ControlFlowTok{next}
\NormalTok{             \}}
             \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{grepl}\NormalTok{(}\StringTok{"\^{}\#\textquotesingle{} @.\{0,2\}name"}\NormalTok{, text[i])) \{}
               \ControlFlowTok{if}\NormalTok{ (sig }\SpecialCharTok{==} \DecValTok{2}\NormalTok{) \{}
\NormalTok{                 sig }\OtherTok{\textless{}{-}} \DecValTok{3}
\NormalTok{                 tar }\OtherTok{\textless{}{-}}\NormalTok{ stringr}\SpecialCharTok{::}\FunctionTok{str\_extract}\NormalTok{(text[i], }\StringTok{"(?\textless{}=\^{}\#\textquotesingle{} @[a{-}z]\{0,2\}name ).\{1,\}(?=$)"}\NormalTok{)}
\NormalTok{               \}}
               \ControlFlowTok{next}
\NormalTok{             \}}
             \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{grepl}\NormalTok{(}\StringTok{"\^{}\#\textquotesingle{} @param|\^{}\#\textquotesingle{} @inheritParams"}\NormalTok{, text[i])) \{}
\NormalTok{               sig }\OtherTok{\textless{}{-}} \DecValTok{2}
               \ControlFlowTok{next}
\NormalTok{             \}}
\NormalTok{           \}}
\NormalTok{           text}
\NormalTok{         \})}

\FunctionTok{lapply}\NormalTok{(target, writeLines)}

\NormalTok{path }\OtherTok{\textless{}{-}} \StringTok{"\textasciitilde{}/code\_backup/mcnebula2"}
\FunctionTok{dir.create}\NormalTok{(path, }\AttributeTok{recursive =}\NormalTok{ T)}

\FunctionTok{lapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(target),}
       \ControlFlowTok{function}\NormalTok{(name)\{}
         \FunctionTok{writeLines}\NormalTok{(target[[name]], }\FunctionTok{paste0}\NormalTok{(path, }\StringTok{"/"}\NormalTok{, name))}
\NormalTok{       \})}

\FunctionTok{system}\NormalTok{(}\StringTok{"cp \textasciitilde{}/code\_backup/mcnebula2/* {-}t \textasciitilde{}/MCnebula2/R"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-new_examples.r}{%
\section{File: new\_examples.R}\label{file-new_examples.r}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{setwd}\NormalTok{(}\StringTok{"\textasciitilde{}/MCnebula2/R"}\NormalTok{)}
\FunctionTok{library}\NormalTok{(magrittr)}

\NormalTok{script }\OtherTok{\textless{}{-}} \FunctionTok{list.files}\NormalTok{(}\StringTok{"."}\NormalTok{, }\AttributeTok{pattern =} \StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.R$"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{sapply}\NormalTok{(readLines)}

\NormalTok{target }\OtherTok{\textless{}{-}} 
  \FunctionTok{lapply}\NormalTok{(script,}
         \ControlFlowTok{function}\NormalTok{(text)\{}
\NormalTok{           tar }\OtherTok{\textless{}{-}}\NormalTok{ stringr}\SpecialCharTok{::}\FunctionTok{str\_extract}\NormalTok{(text, }\StringTok{"(?\textless{}=\^{}\#\textquotesingle{} @[a{-}z]\{0,2\}name ).\{1,\}(?=$)"}\NormalTok{)}
\NormalTok{           tar }\OtherTok{\textless{}{-}} \FunctionTok{unique}\NormalTok{(tar[}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(tar)])}
\NormalTok{         \})}

\NormalTok{target}

\NormalTok{ex\_path }\OtherTok{\textless{}{-}} \StringTok{"/home/echo/outline/mc.test/example/"}
\FunctionTok{lapply}\NormalTok{(}\FunctionTok{unique}\NormalTok{(}\FunctionTok{unlist}\NormalTok{(target)),}
       \ControlFlowTok{function}\NormalTok{(rd)\{}
\NormalTok{         path }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(ex\_path, rd, }\StringTok{".R"}\NormalTok{)}
         \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{file.exists}\NormalTok{(path))}
           \FunctionTok{writeLines}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{""}\NormalTok{, }\StringTok{"\#\# codes"}\NormalTok{), path)}
\NormalTok{       \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-report_documents.r}{%
\section{File: report\_documents.R}\label{file-report_documents.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# Description of the preset}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\NormalTok{reportDoc }\OtherTok{\textless{}{-}}
  \FunctionTok{list}\NormalTok{(}\AttributeTok{introduction =} \FunctionTok{readLines}\NormalTok{(}\StringTok{"\textasciitilde{}/Documents/mcnebula2/introduction.Rmd"}\NormalTok{),}
       \AttributeTok{setup =} \FunctionTok{readLines}\NormalTok{(}\StringTok{"\textasciitilde{}/Documents/mcnebula2/setup.Rmd"}\NormalTok{),}
       \AttributeTok{abstract =} \FunctionTok{readLines}\NormalTok{(}\StringTok{"\textasciitilde{}/Documents/mcnebula2/abstract.Rmd"}\NormalTok{),}
       \AttributeTok{filter =} \FunctionTok{readLines}\NormalTok{(}\StringTok{"\textasciitilde{}/Documents/mcnebula2/filter.Rmd"}\NormalTok{),}
       \AttributeTok{stardust =} \FunctionTok{readLines}\NormalTok{(}\StringTok{"\textasciitilde{}/Documents/mcnebula2/stardust.Rmd"}\NormalTok{),}
       \AttributeTok{nebulae =} \FunctionTok{readLines}\NormalTok{(}\StringTok{"\textasciitilde{}/Documents/mcnebula2/nebulae.Rmd"}\NormalTok{),}
       \AttributeTok{statistic =} \FunctionTok{readLines}\NormalTok{(}\StringTok{"\textasciitilde{}/Documents/mcnebula2/statistic.Rmd"}\NormalTok{),}
       \AttributeTok{tracer =} \FunctionTok{readLines}\NormalTok{(}\StringTok{"\textasciitilde{}/Documents/mcnebula2/tracer.Rmd"}\NormalTok{),}
       \AttributeTok{annotate =} \FunctionTok{readLines}\NormalTok{(}\StringTok{"\textasciitilde{}/Documents/mcnebula2/annotate.Rmd"}\NormalTok{)}
\NormalTok{  )}

\CommentTok{\# usethis::use\_data(reportDoc)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-separate_functions.r}{%
\section{File: separate\_functions.R}\label{file-separate_functions.r}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{setwd}\NormalTok{(}\StringTok{"\textasciitilde{}/MCnebula2/R"}\NormalTok{)}
\FunctionTok{library}\NormalTok{(magrittr)}

\NormalTok{script }\OtherTok{\textless{}{-}} \FunctionTok{list.files}\NormalTok{(}\StringTok{"."}\NormalTok{, }\AttributeTok{pattern =} \StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.R$"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{sapply}\NormalTok{(readLines)}

\NormalTok{target }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(script,}
                 \ControlFlowTok{function}\NormalTok{(text)\{}
\NormalTok{                   sig }\OtherTok{\textless{}{-}} \DecValTok{0}
                   \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(text)) \{}
                     \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{grepl}\NormalTok{(}\StringTok{"\^{}\#"}\NormalTok{, text[i])) \{}
                       \ControlFlowTok{if}\NormalTok{ (sig }\SpecialCharTok{==} \DecValTok{2}\NormalTok{) \{}
\NormalTok{                         sig }\OtherTok{\textless{}{-}} \DecValTok{1}
\NormalTok{                         text[i] }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{, text[i])}
\NormalTok{                       \}}
                       \ControlFlowTok{next}
\NormalTok{                     \}}
                     \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{grepl}\NormalTok{(}\StringTok{"\^{}NULL"}\NormalTok{, text[i]))}
                       \ControlFlowTok{next}
                     \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{grepl}\NormalTok{(}\StringTok{"\^{}$"}\NormalTok{, text[i])) \{}
\NormalTok{                       sig }\OtherTok{\textless{}{-}} \DecValTok{1}
                       \ControlFlowTok{next}
\NormalTok{                     \}}
                     \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{grepl}\NormalTok{(}\StringTok{"\^{}[a{-}z|A{-}Z|.]"}\NormalTok{, text[i])) \{}
                       \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{grepl}\NormalTok{(}\StringTok{"\^{}setGeneric"}\NormalTok{, text[i]))}
                         \ControlFlowTok{break}
                       \ControlFlowTok{if}\NormalTok{ (sig }\SpecialCharTok{==} \DecValTok{2}\NormalTok{) \{}
\NormalTok{                         text[i] }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{, text[i])}
\NormalTok{                       \}}
\NormalTok{                       sig }\OtherTok{\textless{}{-}} \DecValTok{2}
\NormalTok{                     \}}
\NormalTok{                   \}}
                   \FunctionTok{return}\NormalTok{(text)}
\NormalTok{                 \})}

\FunctionTok{writeLines}\NormalTok{(target[[}\DecValTok{3}\NormalTok{]])}

\NormalTok{path }\OtherTok{\textless{}{-}} \StringTok{"\textasciitilde{}/code\_backup/mcnebula2"}
\FunctionTok{dir.create}\NormalTok{(path, }\AttributeTok{recursive =}\NormalTok{ T)}

\FunctionTok{lapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(target),}
       \ControlFlowTok{function}\NormalTok{(name)\{}
         \FunctionTok{writeLines}\NormalTok{(target[[name]], }\FunctionTok{paste0}\NormalTok{(path, }\StringTok{"/"}\NormalTok{, name))}
\NormalTok{       \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-serum_workflow.r}{%
\section{File: serum\_workflow.R}\label{file-serum_workflow.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# workflow to process data and output report (Serum)}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\DocumentationTok{\#\# Initialize}
\NormalTok{s0 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Initialize analysis"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s0}\FloatTok{.02} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Set SIRIUS project path and its version to initialize mcnebula object."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{mcnebula}\NormalTok{()}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{initialize\_mcnebula}\NormalTok{(mcn, }\StringTok{"sirius.v4"}\NormalTok{, }\StringTok{"."}\NormalTok{)}
    \FunctionTok{ion\_mode}\NormalTok{(mcn) }\OtherTok{\textless{}{-}} \StringTok{"pos"}
\NormalTok{  \}, }\AttributeTok{eval =}\NormalTok{ F)}
\NormalTok{)}

\NormalTok{s0}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Create a temporary folder to store the output data."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    tmp }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"/temp\_data"}\NormalTok{)}
    \FunctionTok{dir.create}\NormalTok{(tmp, F)}
    \FunctionTok{export\_path}\NormalTok{(mcn) }\OtherTok{\textless{}{-}}\NormalTok{ tmp}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s0}\FloatTok{.2} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"In order to demonstrate the process of analyzing data with MCnebula2,"}\NormalTok{,}
    \StringTok{"we provide a \textquotesingle{}mcnebula\textquotesingle{} object that was extracted in advance using the"}\NormalTok{,}
    \StringTok{"\textasciigrave{}collate\_used\textasciigrave{} function, which means that all the data"}\NormalTok{,}
    \StringTok{"used in the subsequent analysis has already stored in this \textquotesingle{}mcnebula\textquotesingle{}"}\NormalTok{,}
    \StringTok{"object, without the need to obtain it from the original Project"}\NormalTok{,}
    \StringTok{"directory. This avoids the hassle of downloading and storing a dozen"}\NormalTok{,}
    \StringTok{"GB of raw files. The following, we"}\NormalTok{,}
    \StringTok{"use the collated dataset containing 6501 features"}\NormalTok{,}
    \StringTok{"with chemical formula identification."}\NormalTok{,}
    \StringTok{"This dataset was origin and processed from the research in article:"}\NormalTok{,}
    \StringTok{"\textless{}https://doi.org/10.1016/j.cell.2020.07.040\textgreater{}"}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    exfiles }\OtherTok{\textless{}{-}} \FunctionTok{system.file}\NormalTok{(}\StringTok{"extdata"}\NormalTok{, }\AttributeTok{package =} \StringTok{"exMCnebula2"}\NormalTok{)}
\NormalTok{  \}))}

\NormalTok{s0}\FloatTok{.3} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Load the \textquotesingle{}.rdata\textquotesingle{} file."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
    \FunctionTok{load}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(exfiles, }\StringTok{"/mcn\_serum6501.rdata"}\NormalTok{))}
\NormalTok{    mcn }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_serum6501}
    \FunctionTok{rm}\NormalTok{(mcn\_serum6501)}
\NormalTok{  \})}
\NormalTok{)}

\DocumentationTok{\#\# Filter candidates}
\NormalTok{s1 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Filter candidates"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s1}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
\NormalTok{  reportDoc}\SpecialCharTok{$}\NormalTok{filter,}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(mcn)}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(mcn)}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(mcn, }\AttributeTok{by\_reference =}\NormalTok{ T)}
\NormalTok{  \})}
\NormalTok{)}

\DocumentationTok{\#\# Filter chemcial classes}
\NormalTok{s2 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Filter chemical classes"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s2}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
\NormalTok{  reportDoc}\SpecialCharTok{$}\NormalTok{stardust,}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{create\_stardust\_classes}\NormalTok{(mcn)}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{create\_features\_annotation}\NormalTok{(mcn)}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{cross\_filter\_stardust}\NormalTok{(mcn, }\AttributeTok{max\_ratio =}\NormalTok{ .}\DecValTok{05}\NormalTok{, }\AttributeTok{cutoff =}\NormalTok{ .}\DecValTok{4}\NormalTok{, }\AttributeTok{identical\_factor =}\NormalTok{ .}\DecValTok{6}\NormalTok{)}
\NormalTok{    classes }\OtherTok{\textless{}{-}} \FunctionTok{unique}\NormalTok{(}\FunctionTok{stardust\_classes}\NormalTok{(mcn)}\SpecialCharTok{$}\NormalTok{class.name)}
\NormalTok{    table.filtered.classes }\OtherTok{\textless{}{-}} \FunctionTok{backtrack\_stardust}\NormalTok{(mcn)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s2}\FloatTok{.5} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Manually filter some repetitive classes or sub{-}structural classes."}\NormalTok{,}
    \StringTok{"By means of Regex matching, we obtained a number of recurring"}\NormalTok{,}
    \StringTok{"name of chemical classes that would contain manay identical compounds"}\NormalTok{,}
    \StringTok{"as their sub{-}structure."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    classes}
\NormalTok{    pattern }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"stero"}\NormalTok{, }\StringTok{"fatty acid"}\NormalTok{, }\StringTok{"pyr"}\NormalTok{, }\StringTok{"hydroxy"}\NormalTok{, }\StringTok{"\^{}orga"}\NormalTok{)}
\NormalTok{    dis }\OtherTok{\textless{}{-}} \FunctionTok{unlist}\NormalTok{(}\FunctionTok{lapply}\NormalTok{(pattern, grep, }\AttributeTok{x =}\NormalTok{ classes, }\AttributeTok{ignore.case =}\NormalTok{ T))}
\NormalTok{    dis }\OtherTok{\textless{}{-}}\NormalTok{ classes[dis]}
\NormalTok{    dis}
\NormalTok{    dis }\OtherTok{\textless{}{-}}\NormalTok{ dis[}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{]}
\NormalTok{  \}, }\AttributeTok{args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{eval =}\NormalTok{ T))}
\NormalTok{)}

\DocumentationTok{\#\# Create Nebulae}
\NormalTok{s3 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Create Nebulae"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s3}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Create Nebula{-}Index data. This data created based on \textquotesingle{}stardust\_classes\textquotesingle{} data."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{backtrack\_stardust}\NormalTok{(mcn, dis, }\AttributeTok{remove =}\NormalTok{ T)}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{create\_nebula\_index}\NormalTok{(mcn)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s3}\FloatTok{.2} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
\NormalTok{  reportDoc}\SpecialCharTok{$}\NormalTok{nebulae,}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{compute\_spectral\_similarity}\NormalTok{(mcn)}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{create\_parent\_nebula}\NormalTok{(mcn)}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_nebulae}\NormalTok{(mcn)}
\NormalTok{  \})}
\NormalTok{)}

\DocumentationTok{\#\# Visualize Nebulae}
\NormalTok{s4 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Visualize Nebulae"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s4}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Create layouts for Parent{-}Nebula or Child{-}Nebulae visualizations."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{create\_parent\_layout}\NormalTok{(mcn)}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_layouts}\NormalTok{(mcn)}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{activate\_nebulae}\NormalTok{(mcn)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s4}\FloatTok{.5} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"The available chemical classes for visualization and its"}\NormalTok{,}
    \StringTok{"sequence in storage."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    table.nebulae }\OtherTok{\textless{}{-}} \FunctionTok{visualize}\NormalTok{(mcn)}
\NormalTok{    table.nebulae}
\NormalTok{  \}, }\AttributeTok{args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{eval =}\NormalTok{ T))}
\NormalTok{)}

\NormalTok{s4}\FloatTok{.6} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Draw and save as .png or .pdf image files."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
    \DocumentationTok{\#\# Parent{-}Nebula}
\NormalTok{    p }\OtherTok{\textless{}{-}} \FunctionTok{visualize}\NormalTok{(mcn, }\StringTok{"parent"}\NormalTok{)}
    \FunctionTok{ggsave}\NormalTok{(f4}\FloatTok{.61} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/parent\_nebula.png"}\NormalTok{), p)}
    \DocumentationTok{\#\# Child{-}Nebulae}
    \FunctionTok{pdf}\NormalTok{(f4}\FloatTok{.62} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/child\_nebula.pdf"}\NormalTok{), }\DecValTok{12}\NormalTok{, }\DecValTok{14}\NormalTok{)}
    \FunctionTok{visualize\_all}\NormalTok{(mcn)}
    \FunctionTok{dev.off}\NormalTok{()}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s4.}\FloatTok{6.}\NormalTok{fig1 }\OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(f4}\FloatTok{.61}\NormalTok{, }\StringTok{"parent"}\NormalTok{, }\StringTok{"Parent{-}Nebula"}\NormalTok{)}
\NormalTok{s4.}\FloatTok{6.}\NormalTok{fig2 }\OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(f4}\FloatTok{.62}\NormalTok{, }\StringTok{"child"}\NormalTok{, }\StringTok{"Child{-}Nebulae"}\NormalTok{)}

\NormalTok{ref }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}\FunctionTok{paste0}\NormalTok{(}\StringTok{"(Fig. "}\NormalTok{, }\FunctionTok{get\_ref}\NormalTok{(x), }\StringTok{")"}\NormalTok{)\}}

\NormalTok{s4}\FloatTok{.7} \OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"In general, Parent{-}Nebulae"}\NormalTok{, }\FunctionTok{ref}\NormalTok{(s4.}\FloatTok{6.}\NormalTok{fig1),}
          \StringTok{"is too informative to show, so Child{-}Nebulae"}\NormalTok{, }\FunctionTok{ref}\NormalTok{(s4.}\FloatTok{6.}\NormalTok{fig2),}
          \StringTok{"was used to dipict the abundant classes of features (metabolites)"}\NormalTok{,}
          \StringTok{"in a grid panel, intuitively. In a bird\textquotesingle{}s eye view of"}\NormalTok{,}
          \StringTok{"Child{-}Nebulae, we can obtain many characteristics of features,"}\NormalTok{,}
          \StringTok{"involving classes distribution, structure identified accuracy, as"}\NormalTok{,}
          \StringTok{"well as spectral similarity within classes."}\NormalTok{)}

\DocumentationTok{\#\# Statistic analysis}
\NormalTok{s5 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Statistic analysis"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s5}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Next we perform a statistical analysis with quantification data of the"}\NormalTok{,}
    \StringTok{"features. Note that the SIRIUS project does not contain quantification"}\NormalTok{,}
    \StringTok{"data of features, so our object \textasciigrave{}mcn\textasciigrave{} naturally does not contain"}\NormalTok{,}
    \StringTok{"that either. We need to get it from elsewhere."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    utils}\SpecialCharTok{::}\FunctionTok{untar}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(exfiles, }\StringTok{"/serum.tar.gz"}\NormalTok{), }\AttributeTok{exdir =}\NormalTok{ tmp)}
\NormalTok{    origin }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{fread}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/serum\_origin\_mmc3.tsv"}\NormalTok{), }\AttributeTok{skip =} \DecValTok{1}\NormalTok{)}
\NormalTok{    origin }\OtherTok{\textless{}{-}}\NormalTok{ tibble}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(origin)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s5}\FloatTok{.2} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Its original data can obtained from:"}\NormalTok{,}
    \FunctionTok{paste0}\NormalTok{(}\StringTok{"\textless{}https://www.cell.com/cms/10.1016/j.cell.2020.07.040/"}\NormalTok{,}
      \StringTok{"attachment/f13178d1{-}d1ee{-}4179{-}9d33{-}227a02e604f1/"}\NormalTok{,}
      \StringTok{"mmc3.xlsx\textgreater{}."}\NormalTok{),}
    \StringTok{"Now, let\textquotesingle{}s check the columns in the table."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    origin}
\NormalTok{  \}, }\AttributeTok{args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{eval =}\NormalTok{ T))}
\NormalTok{)}

\NormalTok{s5}\FloatTok{.3} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Remove the rest of the columns and keep only the columns for ID,"}\NormalTok{,}
    \StringTok{"m/z, retention time, and quantification."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    keep }\OtherTok{\textless{}{-}} \FunctionTok{grep}\NormalTok{(}\StringTok{"\^{}[A{-}Z]\{2\}[0{-}9]\{1,3\}$"}\NormalTok{, }\FunctionTok{colnames}\NormalTok{(origin))}
\NormalTok{    quant }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(origin, }\AttributeTok{oid =} \DecValTok{1}\NormalTok{, }\AttributeTok{mz =} \DecValTok{2}\NormalTok{, }\AttributeTok{rt =} \DecValTok{3}\NormalTok{, dplyr}\SpecialCharTok{::}\FunctionTok{all\_of}\NormalTok{(keep))}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s5}\FloatTok{.4} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"The IDs in the data \textasciigrave{}quant\textasciigrave{} are"}\NormalTok{,}
    \StringTok{"different from the IDs in the object \textasciigrave{}mcn\textasciigrave{}, so we need to align them"}\NormalTok{,}
    \StringTok{"first, according to mz and rt (they originate from the same batch of samples)."}\NormalTok{,}
    \StringTok{"In the following, we have allowed the two sets of data to be merged as"}\NormalTok{, }
    \StringTok{"accurately as possible in the form of evaluation of score:"}\NormalTok{, }\StringTok{""}\NormalTok{,}
    \StringTok{"{-} Score = (1 {-} rt.difference / rt.tolerance) * rt.weight +"}\NormalTok{,}
    \StringTok{"(1 {-} mz.defference / mz.tolerance) * mz.weight"}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    meta\_col }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(}\FunctionTok{features\_annotation}\NormalTok{(mcn), .features\_id, mz, rt.secound)}
\NormalTok{    meta\_col}\SpecialCharTok{$}\NormalTok{rt.min }\OtherTok{\textless{}{-}}\NormalTok{ meta\_col}\SpecialCharTok{$}\NormalTok{rt.secound }\SpecialCharTok{/} \DecValTok{60}
\NormalTok{    merged }\OtherTok{\textless{}{-}} \FunctionTok{align\_merge}\NormalTok{(meta\_col, quant, }\StringTok{".features\_id"}\NormalTok{, }\AttributeTok{rt.main =} \StringTok{"rt.min"}\NormalTok{, }\AttributeTok{rt.sub =} \StringTok{"rt"}\NormalTok{)}
\NormalTok{    merged }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(merged, }\SpecialCharTok{{-}}\NormalTok{mz.main, }\SpecialCharTok{{-}}\NormalTok{mz.sub, }\SpecialCharTok{{-}}\NormalTok{rt.min, }\SpecialCharTok{{-}}\NormalTok{rt, }\SpecialCharTok{{-}}\NormalTok{rt.secound)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s5}\FloatTok{.5} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Due to the differences in feature detection algorithms,"}\NormalTok{,}
    \StringTok{"some of the features inevitably do not get matched."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    merged}
\NormalTok{  \}, }\AttributeTok{args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{eval =}\NormalTok{ T))}
\NormalTok{)}

\NormalTok{s5}\FloatTok{.6} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Create the metadata table and store it in the \textasciigrave{}mcn\textasciigrave{} object"}\NormalTok{,}
    \StringTok{"along with the quantification data."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    gp }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\AttributeTok{NN =} \StringTok{"\^{}NN"}\NormalTok{, }\AttributeTok{HN =} \StringTok{"\^{}HN"}\NormalTok{, }\AttributeTok{HS =} \StringTok{"\^{}HS"}\NormalTok{, }\AttributeTok{HM =} \StringTok{"\^{}HM"}\NormalTok{)}
\NormalTok{    metadata }\OtherTok{\textless{}{-}}\NormalTok{ MCnebula2}\SpecialCharTok{:::}\FunctionTok{group\_strings}\NormalTok{(}\FunctionTok{colnames}\NormalTok{(merged), gp, }\StringTok{"sample"}\NormalTok{)}
\NormalTok{    metadata}\SpecialCharTok{$}\NormalTok{group\_name }\OtherTok{\textless{}{-}}
      \FunctionTok{vapply}\NormalTok{(metadata}\SpecialCharTok{$}\NormalTok{group, }\ControlFlowTok{switch}\NormalTok{, }\AttributeTok{FUN.VALUE =} \FunctionTok{character}\NormalTok{(}\DecValTok{1}\NormalTok{),}
        \AttributeTok{NN =} \StringTok{"non{-}hospital \& non{-}infected"}\NormalTok{,}
        \AttributeTok{HN =} \StringTok{"hospital \& non{-}infected"}\NormalTok{,}
        \AttributeTok{HS =} \StringTok{"hospital \& survival"}\NormalTok{,}
        \AttributeTok{HM =} \StringTok{"hospital \& mortality"}\NormalTok{)}
\NormalTok{    metadata}\SpecialCharTok{$}\NormalTok{supergroup }\OtherTok{\textless{}{-}} 
      \FunctionTok{vapply}\NormalTok{(metadata}\SpecialCharTok{$}\NormalTok{group, }\ControlFlowTok{switch}\NormalTok{, }\AttributeTok{FUN.VALUE =} \FunctionTok{character}\NormalTok{(}\DecValTok{1}\NormalTok{),}
        \AttributeTok{NN =} \StringTok{"control groups"}\NormalTok{,}
        \AttributeTok{HN =} \StringTok{"control groups"}\NormalTok{,}
        \AttributeTok{HS =} \StringTok{"infection groups"}\NormalTok{,}
        \AttributeTok{HM =} \StringTok{"infection groups"}\NormalTok{)}
    \FunctionTok{features\_quantification}\NormalTok{(mcn) }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(merged, }\SpecialCharTok{{-}}\NormalTok{oid)}
    \FunctionTok{sample\_metadata}\NormalTok{(mcn) }\OtherTok{\textless{}{-}}\NormalTok{ metadata}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s5}\FloatTok{.7} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(reportDoc}\SpecialCharTok{$}\NormalTok{statistic, }\StringTok{""}\NormalTok{, }\StringTok{"In the following we use the"}\NormalTok{,}
    \StringTok{"\textasciigrave{}binary\_comparison\textasciigrave{} function for variance analysis. Note that"}\NormalTok{,}
    \StringTok{"the quantification data in \textasciigrave{}origin\textasciigrave{} has been normalized."}\NormalTok{,}
    \StringTok{"To accommodate the downstream analysis of gene"}\NormalTok{,}
    \StringTok{"expression that the \textasciigrave{}limma\textasciigrave{} package was originally used for, we"}\NormalTok{,}
    \StringTok{"should log2{-}transform and centralize this data."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{binary\_comparison}\NormalTok{(mcn, (HS }\SpecialCharTok{+}\NormalTok{ HM) }\SpecialCharTok{{-}}\NormalTok{ (NN }\SpecialCharTok{+}\NormalTok{ HN), HM }\SpecialCharTok{{-}}\NormalTok{ HS,}
      \AttributeTok{fun\_norm =} \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{scale}\NormalTok{(}\FunctionTok{log2}\NormalTok{(x), }\AttributeTok{scale =}\NormalTok{ F))}
\NormalTok{    top.list }\OtherTok{\textless{}{-}} \FunctionTok{top\_table}\NormalTok{(}\FunctionTok{statistic\_set}\NormalTok{(mcn))}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s5}\FloatTok{.8} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"To verify the validity of the above variance analysis, the data"}\NormalTok{,}
    \StringTok{"columns were merged to obtain the IDs from the original analysis."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    top.list }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(top.list, merge,}
      \AttributeTok{y =}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(merged, .features\_id, oid),}
      \AttributeTok{by =} \StringTok{".features\_id"}\NormalTok{, }\AttributeTok{all.x =}\NormalTok{ T, }\AttributeTok{sort =}\NormalTok{ F)}
\NormalTok{    top.list }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(top.list, tibble}\SpecialCharTok{::}\NormalTok{as\_tibble)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s5}\FloatTok{.81} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Verify with the \textasciigrave{}EFS\_Rank\textasciigrave{} and \textasciigrave{}MW\_Rank\textasciigrave{} column in the \textasciigrave{}origin\textasciigrave{} data."}\NormalTok{,}
    \StringTok{"(The original authors used the two methods to rank the features.)"}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    origin\_top50 }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(origin, EFS\_Rank }\SpecialCharTok{\textless{}=} \DecValTok{50} \SpecialCharTok{|}\NormalTok{ MW\_Rank }\SpecialCharTok{\textless{}=} \DecValTok{50}\NormalTok{)}
\NormalTok{    inter. }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(top.list,}
      \ControlFlowTok{function}\NormalTok{(df) \{}
\NormalTok{        match }\OtherTok{\textless{}{-}} \FunctionTok{head}\NormalTok{(df, }\AttributeTok{n =} \DecValTok{50}\NormalTok{)}\SpecialCharTok{$}\NormalTok{oid }\SpecialCharTok{\%in\%}\NormalTok{ origin\_top50}\SpecialCharTok{$}\NormalTok{Unique\_ID}
\NormalTok{        oid }\OtherTok{\textless{}{-}} \FunctionTok{head}\NormalTok{(df, }\AttributeTok{n =} \DecValTok{50}\NormalTok{)}\SpecialCharTok{$}\NormalTok{oid[match]}
        \FunctionTok{list}\NormalTok{(}\AttributeTok{table.match =} \FunctionTok{table}\NormalTok{(match), }\AttributeTok{oid =}\NormalTok{ oid)}
\NormalTok{      \})}
    \FunctionTok{lapply}\NormalTok{(inter., }\ControlFlowTok{function}\NormalTok{(x) x}\SpecialCharTok{$}\NormalTok{table.match)}
\NormalTok{  \}, }\AttributeTok{args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{eval =}\NormalTok{ T))}
\NormalTok{)}

\NormalTok{s5}\FloatTok{.82} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Let\textquotesingle{}s see which compounds were identified that intersected our"}\NormalTok{,}
    \StringTok{"ranking and the original ranking of features."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    inter.compound }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(origin, Unique\_ID }\SpecialCharTok{\%in\%}\NormalTok{ inter.[[}\DecValTok{2}\NormalTok{]]}\SpecialCharTok{$}\NormalTok{oid)}
    \FunctionTok{table}\NormalTok{(inter.compound}\SpecialCharTok{$}\NormalTok{Spectral\_Library\_Match, }\AttributeTok{useNA =} \StringTok{"if"}\NormalTok{)}
\NormalTok{  \}, }\AttributeTok{args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{eval =}\NormalTok{ T))}
\NormalTok{)}

\NormalTok{s5}\FloatTok{.9} \OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Interestingly, these two compounds were critical compounds"}\NormalTok{,}
            \StringTok{"in the original study."}\NormalTok{)}

\DocumentationTok{\#\# Set tracer in Child{-}Nebulae}
\NormalTok{s6 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Set tracer in Child{-}Nebulae"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s6}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
\NormalTok{  reportDoc}\SpecialCharTok{$}\NormalTok{tracer,}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    n }\OtherTok{\textless{}{-}} \DecValTok{50}
\NormalTok{    tops }\OtherTok{\textless{}{-}} \FunctionTok{unique}\NormalTok{(}\FunctionTok{unlist}\NormalTok{(}\FunctionTok{lapply}\NormalTok{(top.list, }\ControlFlowTok{function}\NormalTok{(df) df}\SpecialCharTok{$}\NormalTok{.features\_id[}\DecValTok{1}\SpecialCharTok{:}\NormalTok{n])))}
    \FunctionTok{palette\_set}\NormalTok{(}\FunctionTok{melody}\NormalTok{(mcn)) }\OtherTok{\textless{}{-}} \FunctionTok{colorRampPalette}\NormalTok{(}\FunctionTok{palette\_set}\NormalTok{(mcn))(}\FunctionTok{length}\NormalTok{(tops))}
\NormalTok{    mcn2 }\OtherTok{\textless{}{-}} \FunctionTok{set\_tracer}\NormalTok{(mcn, tops)}
\NormalTok{    mcn2 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_nebulae}\NormalTok{(mcn2)}
\NormalTok{    mcn2 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_layouts}\NormalTok{(mcn2)}
\NormalTok{    mcn2 }\OtherTok{\textless{}{-}} \FunctionTok{activate\_nebulae}\NormalTok{(mcn2)}
\NormalTok{    mcn2 }\OtherTok{\textless{}{-}} \FunctionTok{set\_nodes\_color}\NormalTok{(mcn2, }\AttributeTok{use\_tracer =}\NormalTok{ T)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s6}\FloatTok{.2} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Draw and save the image."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
    \FunctionTok{pdf}\NormalTok{(f6}\FloatTok{.2} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/tracer\_child\_nebula.pdf"}\NormalTok{), }\DecValTok{12}\NormalTok{, }\DecValTok{14}\NormalTok{)}
    \FunctionTok{visualize\_all}\NormalTok{(mcn2)}
    \FunctionTok{dev.off}\NormalTok{()}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s6.}\FloatTok{2.}\NormalTok{fig1 }\OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(f6}\FloatTok{.2}\NormalTok{, }\StringTok{"tracer"}\NormalTok{, }\StringTok{"Tracing top features in Child{-}Nebulae"}\NormalTok{)}

\NormalTok{s6}\FloatTok{.3} \OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"A part of the top features are marked with colored nodes in"}\NormalTok{,}
          \StringTok{"Child{-}Nebulae"}\NormalTok{, }\FunctionTok{ref}\NormalTok{(s6.}\FloatTok{2.}\NormalTok{fig1), }\StringTok{"."}\NormalTok{,}
          \StringTok{"These features are at least identified with chemical molecular"}\NormalTok{,}
          \StringTok{"formula. Those that are not identified, or the Nebula{-}Index data do"}\NormalTok{,}
          \StringTok{"not contain the chemical class to which these features belong, are"}\NormalTok{,}
          \StringTok{"absent from the Figure."}\NormalTok{)}

\DocumentationTok{\#\# Quantification in Child{-}Nebulae}
\NormalTok{s7 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Quantification in Child{-}Nebulae"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s7}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Show Fold Change (HM versus HS) in Child{-}Nebulae."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
    \FunctionTok{palette\_gradient}\NormalTok{(}\FunctionTok{melody}\NormalTok{(mcn2)) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"blue"}\NormalTok{, }\StringTok{"grey90"}\NormalTok{, }\StringTok{"red"}\NormalTok{)}
\NormalTok{    mcn2 }\OtherTok{\textless{}{-}} \FunctionTok{set\_nodes\_color}\NormalTok{(mcn2, }\StringTok{"logFC"}\NormalTok{, top.list[[}\DecValTok{2}\NormalTok{]])}
    \FunctionTok{pdf}\NormalTok{(f7}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/logFC\_child\_nebula.pdf"}\NormalTok{), }\DecValTok{12}\NormalTok{, }\DecValTok{14}\NormalTok{)}
    \FunctionTok{visualize\_all}\NormalTok{(mcn2, }\AttributeTok{fun\_modify =}\NormalTok{ modify\_stat\_child)}
    \FunctionTok{dev.off}\NormalTok{()}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s7.}\FloatTok{1.}\NormalTok{fig1 }\OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(f7}\FloatTok{.1}\NormalTok{, }\StringTok{"logFC"}\NormalTok{, }\StringTok{"Show log2(FC) in Child{-}Nebulae"}\NormalTok{)}

\NormalTok{s7}\FloatTok{.2} \OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Each Child{-}Nebula separately shows the overall content variation of"}\NormalTok{,}
          \StringTok{"the chemical class to which it belongs"}\NormalTok{, }\FunctionTok{ref}\NormalTok{(s7.}\FloatTok{1.}\NormalTok{fig1), }\StringTok{"."}\NormalTok{)}

\DocumentationTok{\#\# Annotate Nebulae}
\NormalTok{s8 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Annotate Nebulae"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s8}\FloatTok{.0} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Now, the available Nebulae contains:"}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    table.nebulae2 }\OtherTok{\textless{}{-}} \FunctionTok{visualize}\NormalTok{(mcn2)}
\NormalTok{    table.nebulae2}
\NormalTok{  \}, }\AttributeTok{args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{eval =}\NormalTok{ T))}
\NormalTok{)}

\NormalTok{s8}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Next, let us focus on Acyl carnitines, a class that was highlighted"}\NormalTok{,}
    \StringTok{"in the original research and also appears in Child{-}Nebulae, marked by"}\NormalTok{,}
    \StringTok{"plural top features (Likewise, we annotated two other chemical"}\NormalTok{,}
    \StringTok{"classes of Nebulae)."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    mcn2 }\OtherTok{\textless{}{-}} \FunctionTok{set\_nodes\_color}\NormalTok{(mcn2, }\AttributeTok{use\_tracer =}\NormalTok{ T)}
    \FunctionTok{palette\_stat}\NormalTok{(}\FunctionTok{melody}\NormalTok{(mcn2)) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
      \AttributeTok{NN =} \StringTok{"\#B6DFB6"}\NormalTok{, }\AttributeTok{HN =} \StringTok{"\#ACDFEE"}\NormalTok{, }\AttributeTok{HS =} \StringTok{"\#EBA9A7"}\NormalTok{, }\AttributeTok{HM =} \StringTok{"grey70"}
\NormalTok{    )}
\NormalTok{    ac }\OtherTok{\textless{}{-}} \StringTok{"Acyl carnitines"}
\NormalTok{    lpc }\OtherTok{\textless{}{-}} \StringTok{"Lysophosphatidylcholines"}
\NormalTok{    ba }\OtherTok{\textless{}{-}} \StringTok{"Bile acids, alcohols and derivatives"}
\NormalTok{    mcn2 }\OtherTok{\textless{}{-}} \FunctionTok{annotate\_nebula}\NormalTok{(mcn2, ac)}
\NormalTok{    mcn2 }\OtherTok{\textless{}{-}} \FunctionTok{annotate\_nebula}\NormalTok{(mcn2, lpc)}
\NormalTok{    mcn2 }\OtherTok{\textless{}{-}} \FunctionTok{annotate\_nebula}\NormalTok{(mcn2, ba)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s8}\FloatTok{.2} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Draw and save the image."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    p }\OtherTok{\textless{}{-}} \FunctionTok{visualize}\NormalTok{(mcn2, ac, }\AttributeTok{annotate =}\NormalTok{ T)}
    \FunctionTok{ggsave}\NormalTok{(f8}\FloatTok{.2} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/ac\_child.pdf"}\NormalTok{), p, }\AttributeTok{height =} \DecValTok{5}\NormalTok{)}
\NormalTok{    p }\OtherTok{\textless{}{-}} \FunctionTok{visualize}\NormalTok{(mcn2, lpc, }\AttributeTok{annotate =}\NormalTok{ T)}
    \FunctionTok{ggsave}\NormalTok{(f8.}\FloatTok{2.2} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/lpc\_child.pdf"}\NormalTok{), p, }\AttributeTok{height =} \DecValTok{5}\NormalTok{)}
\NormalTok{    p }\OtherTok{\textless{}{-}} \FunctionTok{visualize}\NormalTok{(mcn2, ba, }\AttributeTok{annotate =}\NormalTok{ T)}
    \FunctionTok{ggsave}\NormalTok{(f8.}\FloatTok{2.3} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/ba\_child.pdf"}\NormalTok{), p, }\AttributeTok{height =} \DecValTok{5}\NormalTok{)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s8.}\FloatTok{2.}\NormalTok{fig1 }\OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(f8}\FloatTok{.2}\NormalTok{, }\StringTok{"ac"}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(}\StringTok{"Annotated Nebulae: "}\NormalTok{, ac))}

\NormalTok{s8}\FloatTok{.3} \OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"See results"}\NormalTok{, }\FunctionTok{ref}\NormalTok{(s8.}\FloatTok{2.}\NormalTok{fig1), }\StringTok{"."}\NormalTok{, reportDoc}\SpecialCharTok{$}\NormalTok{annotate)}

\NormalTok{s8}\FloatTok{.4} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Use the \textasciigrave{}show\_node\textasciigrave{} function to get the annotation details"}\NormalTok{,}
    \StringTok{"for a feature. For example:"}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    ef }\OtherTok{\textless{}{-}} \StringTok{"2068"}
    \FunctionTok{pdf}\NormalTok{(f8}\FloatTok{.4} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/features\_"}\NormalTok{, ef, }\StringTok{".pdf"}\NormalTok{), }\DecValTok{10}\NormalTok{, }\DecValTok{4}\NormalTok{)}
    \FunctionTok{show\_node}\NormalTok{(mcn2, ef)}
    \FunctionTok{dev.off}\NormalTok{()}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s8.}\FloatTok{4.}\NormalTok{fig1 }\OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(f8}\FloatTok{.4}\NormalTok{, }\StringTok{"ef"}\NormalTok{, }\StringTok{"The annotated feature of ID: 2068"}\NormalTok{)}

\NormalTok{s8}\FloatTok{.5} \OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"See results"}\NormalTok{, }\FunctionTok{ref}\NormalTok{(s8.}\FloatTok{4.}\NormalTok{fig1), }\StringTok{"."}\NormalTok{)}

\NormalTok{notShow1 }\OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Combine the images."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    p.ac }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{grecta}\NormalTok{(}\StringTok{"a"}\NormalTok{), }\FunctionTok{as\_grob}\NormalTok{(}\FunctionTok{visualize}\NormalTok{(mcn2, ac, }\AttributeTok{annotate =}\NormalTok{ T)))}
\NormalTok{    p.lpc }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{grecta}\NormalTok{(}\StringTok{"a"}\NormalTok{), }\FunctionTok{as\_grob}\NormalTok{(}\FunctionTok{visualize}\NormalTok{(mcn2, lpc, }\AttributeTok{annotate =}\NormalTok{ T)))}
\NormalTok{    p.ba }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{grecta}\NormalTok{(}\StringTok{"b"}\NormalTok{), }\FunctionTok{as\_grob}\NormalTok{(}\FunctionTok{visualize}\NormalTok{(mcn2, ba, }\AttributeTok{annotate =}\NormalTok{ T)))}
\NormalTok{    p.node }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{grecta}\NormalTok{(}\StringTok{"b"}\NormalTok{), grid}\SpecialCharTok{::}\FunctionTok{grid.grabExpr}\NormalTok{(}\FunctionTok{show\_node}\NormalTok{(mcn2, ef)))}
    \FunctionTok{dev.off}\NormalTok{()}
\NormalTok{    grob.ac\_node }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{p.ac =} \DecValTok{1}\NormalTok{, }\AttributeTok{p.node =}\NormalTok{ .}\DecValTok{5}\NormalTok{), }\FunctionTok{namel}\NormalTok{(p.ac, p.node))}
\NormalTok{    grob.ac\_node }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(grob.ac\_node, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{95}\NormalTok{, .}\DecValTok{95}\NormalTok{))}
\NormalTok{    grob.lpc\_ba }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{p.lpc =} \DecValTok{1}\NormalTok{, }\AttributeTok{p.ba =} \DecValTok{1}\NormalTok{), }\FunctionTok{namel}\NormalTok{(p.lpc, p.ba))}
\NormalTok{    grob.lpc\_ba }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(grob.lpc\_ba, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{95}\NormalTok{, .}\DecValTok{95}\NormalTok{))}
    \FunctionTok{pdf}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/fig.ac\_node.pdf"}\NormalTok{), }\DecValTok{9}\NormalTok{, }\DecValTok{10}\NormalTok{)}
    \FunctionTok{draw}\NormalTok{(grob.ac\_node)}
    \FunctionTok{dev.off}\NormalTok{()}
    \FunctionTok{pdf}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/fig.lpc\_ba.pdf"}\NormalTok{), }\DecValTok{9}\NormalTok{, }\DecValTok{13}\NormalTok{)}
    \FunctionTok{draw}\NormalTok{(grob.lpc\_ba)}
    \FunctionTok{dev.off}\NormalTok{()}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{notShow1}\FloatTok{.5} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Combine the image..."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
    \DocumentationTok{\#\# b plot: ac}
\NormalTok{    mcn2 }\OtherTok{\textless{}{-}} \FunctionTok{set\_nodes\_color}\NormalTok{(mcn2, }\StringTok{"logFC"}\NormalTok{, top.list[[}\DecValTok{2}\NormalTok{]])}
\NormalTok{    p.logfc.ac }\OtherTok{\textless{}{-}} \FunctionTok{visualize}\NormalTok{(mcn2, ac, modify\_stat\_child)}
\NormalTok{    p.logfc.ac }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{grecta}\NormalTok{(}\StringTok{"b"}\NormalTok{), }\FunctionTok{as\_grob}\NormalTok{(p.logfc.ac))}
    \DocumentationTok{\#\# a plot: ac}
\NormalTok{    mcn2 }\OtherTok{\textless{}{-}} \FunctionTok{set\_nodes\_color}\NormalTok{(mcn2, }\AttributeTok{use\_tracer =}\NormalTok{ T)}
\NormalTok{    p.tracer.ac }\OtherTok{\textless{}{-}} \FunctionTok{visualize}\NormalTok{(mcn2, ac, modify\_set\_labs\_and\_unify\_scale\_limits)}
    \DocumentationTok{\#\# legend for a and b}
\NormalTok{    child\_legend }\OtherTok{\textless{}{-}}\NormalTok{ MCnebula2}\SpecialCharTok{:::}\FunctionTok{.get\_legend}\NormalTok{(p.tracer.ac }\SpecialCharTok{+} \FunctionTok{guides}\NormalTok{(}\AttributeTok{fill =} \StringTok{"none"}\NormalTok{))}
    \DocumentationTok{\#\# a plot: ac revise}
\NormalTok{    p.tracer.ac }\OtherTok{\textless{}{-}} \FunctionTok{visualize}\NormalTok{(mcn2, ac, modify\_default\_child)}
\NormalTok{    p.tracer.ac }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{grecta}\NormalTok{(}\StringTok{"a"}\NormalTok{), }\FunctionTok{as\_grob}\NormalTok{(p.tracer.ac))}
    \DocumentationTok{\#\# c plot: annotated ac}
\NormalTok{    p.ac }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{grecta}\NormalTok{(}\StringTok{"c"}\NormalTok{), }\FunctionTok{as\_grob}\NormalTok{(}\FunctionTok{visualize}\NormalTok{(mcn2, ac, }\AttributeTok{annotate =}\NormalTok{ T)))}
    \DocumentationTok{\#\# d plot: node}
\NormalTok{    p.node }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{grecta}\NormalTok{(}\StringTok{"d"}\NormalTok{), grid}\SpecialCharTok{::}\FunctionTok{grid.grabExpr}\NormalTok{(}\FunctionTok{show\_node}\NormalTok{(mcn2, ef)))}
    \DocumentationTok{\#\# gather theme}
\NormalTok{    vis1 }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}
      \FunctionTok{c}\NormalTok{(}\AttributeTok{p.tracer.ac =} \DecValTok{1}\NormalTok{, }\AttributeTok{p.logfc.ac =} \DecValTok{1}\NormalTok{, }\AttributeTok{child\_legend =}\NormalTok{ .}\DecValTok{5}\NormalTok{),}
      \FunctionTok{namel}\NormalTok{(p.tracer.ac, p.logfc.ac, child\_legend)}
\NormalTok{    )}
\NormalTok{    vis2 }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}
      \FunctionTok{c}\NormalTok{(}\AttributeTok{vis1 =} \DecValTok{1}\NormalTok{, }\AttributeTok{p.ac =} \FloatTok{1.5}\NormalTok{, }\AttributeTok{p.node =} \DecValTok{1}\NormalTok{),}
      \FunctionTok{namel}\NormalTok{(vis1, p.ac, p.node)}
\NormalTok{    )}
\NormalTok{    vis2 }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(vis2, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{95}\NormalTok{, .}\DecValTok{95}\NormalTok{))}
    \FunctionTok{pdf}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/fig.ac\_node2.pdf"}\NormalTok{), }\DecValTok{10}\NormalTok{, }\DecValTok{14}\NormalTok{)}
    \FunctionTok{draw}\NormalTok{(vis2)}
    \FunctionTok{dev.off}\NormalTok{()}
\NormalTok{  \})}
\NormalTok{)}

\DocumentationTok{\#\# Output identification table}
\NormalTok{s10 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Query compounds"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s10}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"The \textasciigrave{}features\_annotation(mcn)\textasciigrave{} contains the main annotation information of all"}\NormalTok{,}
           \StringTok{"the features, i.e., the identity of the  compound. Next, we would"}\NormalTok{,}
           \StringTok{"query the identified compounds based on the \textquotesingle{}inchikey2d\textquotesingle{} column therein."}\NormalTok{,}
           \StringTok{"Note that the stereoisomerism of the compounds is difficult to be"}\NormalTok{,}
           \StringTok{"determined due to the limitations of MS/MS spectra."}\NormalTok{,}
           \StringTok{"Therefore, we used InChIKey 2D (representing the molecular"}\NormalTok{,}
           \StringTok{"backbone of the compound) to query"}\NormalTok{,}
           \StringTok{"the compound instead of InChI."}\NormalTok{)}

\NormalTok{s10}\FloatTok{.2} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"First we need to format and organize the annotated data of"}\NormalTok{,}
    \StringTok{"features to get the non{-}duplicated \textquotesingle{}inchikey2d\textquotesingle{}."}\NormalTok{,}
    \StringTok{"We provide a function with a pre{-}defined filtering algorithm to quickly"}\NormalTok{,}
    \StringTok{"organize the table."}\NormalTok{,}
    \StringTok{"By default, this function filters the data based on"}\NormalTok{,}
    \StringTok{"\textquotesingle{}tani.score\textquotesingle{} (Tanimoto similarity),"}\NormalTok{,}
    \StringTok{"and then sorts and de{-}duplicates it."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    feas }\OtherTok{\textless{}{-}} \FunctionTok{features\_annotation}\NormalTok{(mcn2)}
\NormalTok{    feas }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(feas, top.list[[}\DecValTok{2}\NormalTok{]], }\AttributeTok{by =} \StringTok{".features\_id"}\NormalTok{, }\AttributeTok{all.x =}\NormalTok{ T)}
\NormalTok{    feas }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(feas, }\AttributeTok{arrange.rank =}\NormalTok{ adj.P.Val)}
\NormalTok{    feas }\OtherTok{\textless{}{-}} \FunctionTok{format\_table}\NormalTok{(feas, }\AttributeTok{export\_name =} \ConstantTok{NULL}\NormalTok{)}
\NormalTok{    key2d }\OtherTok{\textless{}{-}}\NormalTok{ feas}\SpecialCharTok{$}\NormalTok{inchikey2d}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s10}\FloatTok{.3} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Create a folder to store the acquired data."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    tmp2 }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/query"}\NormalTok{)}
    \FunctionTok{dir.create}\NormalTok{(tmp2, F)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s10}\FloatTok{.4} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Query the compound\textquotesingle{}s InChIKey, chemical class, IUPUA name."}\NormalTok{,}
    \StringTok{"If your system is not Linux, the multithreading below may pose some problems,"}\NormalTok{,}
    \StringTok{"please remove the parameters \textasciigrave{}curl\_cl = 4\textasciigrave{} and \textasciigrave{}classyfire\_cl = 4\textasciigrave{}."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    key.rdata }\OtherTok{\textless{}{-}} \FunctionTok{query\_inchikey}\NormalTok{(key2d, tmp2, }\AttributeTok{curl\_cl =} \DecValTok{4}\NormalTok{)}
\NormalTok{    class.rdata }\OtherTok{\textless{}{-}} \FunctionTok{query\_classification}\NormalTok{(key2d, tmp2, }\AttributeTok{classyfire\_cl =} \DecValTok{4}\NormalTok{)}
\NormalTok{    iupac.rdata }\OtherTok{\textless{}{-}} \FunctionTok{query\_iupac}\NormalTok{(key2d, tmp2, }\AttributeTok{curl\_cl =} \DecValTok{4}\NormalTok{)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s10}\FloatTok{.5} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"We will also query for synonyms of compounds, but this is done in"}\NormalTok{,}
    \StringTok{"\textquotesingle{}CID\textquotesingle{} (PubChem\textquotesingle{}s ID), so some transformation is required."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    key.set }\OtherTok{\textless{}{-}} \FunctionTok{extract\_rdata\_list}\NormalTok{(key.rdata)}
\NormalTok{    cid }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(key.set, }\ControlFlowTok{function}\NormalTok{(data) data}\SpecialCharTok{$}\NormalTok{CID)}
\NormalTok{    cid }\OtherTok{\textless{}{-}} \FunctionTok{unlist}\NormalTok{(cid, }\AttributeTok{use.names =}\NormalTok{ F)}
\NormalTok{    syno.rdata }\OtherTok{\textless{}{-}} \FunctionTok{query\_synonyms}\NormalTok{(cid, tmp2, }\AttributeTok{curl\_cl =} \DecValTok{4}\NormalTok{)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s10}\FloatTok{.6} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Screen for unique synonyms and chemical classes for all compounds."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    syno }\OtherTok{\textless{}{-}} \FunctionTok{pick\_synonym}\NormalTok{(key2d, key.rdata, syno.rdata, iupac.rdata)}
\NormalTok{    feas}\SpecialCharTok{$}\NormalTok{synonym }\OtherTok{\textless{}{-}}\NormalTok{ syno}
\NormalTok{    class }\OtherTok{\textless{}{-}} \FunctionTok{pick\_class}\NormalTok{(key2d, class.rdata)}
\NormalTok{    feas}\SpecialCharTok{$}\NormalTok{class }\OtherTok{\textless{}{-}}\NormalTok{ class}
\NormalTok{    feas.table }\OtherTok{\textless{}{-}} \FunctionTok{rename\_table}\NormalTok{(feas)}
    \FunctionTok{write\_tsv}\NormalTok{(feas.table, }\FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/compounds\_format.tsv"}\NormalTok{))}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s10}\FloatTok{.7} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"The formatted table as following:"}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    feas.table}
\NormalTok{  \}, }\AttributeTok{args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{eval =}\NormalTok{ T))}
\NormalTok{)}

\NormalTok{s10}\FloatTok{.8} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{( }\StringTok{"Filtering our results based on the ranking of \textquotesingle{}features\textquotesingle{} (top 25 of EFS"}\NormalTok{,}
      \StringTok{"and MWU) and identification by Wozniak et al."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    origin\_top50 }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(}
\NormalTok{      origin\_top50, }\AttributeTok{oid =} \DecValTok{1}\NormalTok{, EFS\_Rank, MW\_Rank,}
\NormalTok{      Spectral\_Library\_Match}
\NormalTok{    )}
\NormalTok{    feas.otop }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(merged, .features\_id, oid)}
\NormalTok{    feas.otop }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(origin\_top50, feas.otop, }\AttributeTok{all.x =}\NormalTok{ T, }\AttributeTok{by =} \StringTok{"oid"}\NormalTok{)}
\NormalTok{    feas.otop }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}
\NormalTok{      feas.otop, }\FunctionTok{features\_annotation}\NormalTok{(mcn2),}
      \AttributeTok{all.x =}\NormalTok{ T, }\AttributeTok{by =} \StringTok{".features\_id"}
\NormalTok{    )}
\NormalTok{    feas.otop.format }\OtherTok{\textless{}{-}} \FunctionTok{format\_table}\NormalTok{(}
\NormalTok{      feas.otop, }\AttributeTok{filter =} \ConstantTok{NULL}\NormalTok{,}
      \AttributeTok{select =} \FunctionTok{c}\NormalTok{(}\StringTok{"oid"}\NormalTok{, }\StringTok{"EFS\_Rank"}\NormalTok{, }\StringTok{"MW\_Rank"}\NormalTok{, }\StringTok{"Spectral\_Library\_Match"}\NormalTok{, .select\_format),}
      \AttributeTok{export\_name =} \FunctionTok{c}\NormalTok{(}\AttributeTok{oid =} \StringTok{"\# Original ID"}\NormalTok{, }\AttributeTok{EFS\_Rank =} \StringTok{"\# EFS\_Rank"}\NormalTok{,}
        \AttributeTok{MW\_Rank =} \StringTok{"\# MW\_Rank"}\NormalTok{,}
        \AttributeTok{Spectral\_Library\_Match =} \StringTok{"\# Spectral\_Library\_Match"}\NormalTok{,}
\NormalTok{        .export\_name)}
\NormalTok{    )}
    \FunctionTok{write\_tsv}\NormalTok{(feas.otop.format, }\FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/oTop50\_compounds\_format.tsv"}\NormalTok{))}
\NormalTok{  \})}
\NormalTok{)}

\DocumentationTok{\#\# Pathway enrichment }
\NormalTok{s11 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Pathway enrichment"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s11}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"A plural number of chemical classes of interest were selected and"}\NormalTok{,}
    \StringTok{"the IDs of their features were obtained. These"}\NormalTok{,}
    \StringTok{"features were filtered with the statistic analysis data"}\NormalTok{,}
    \StringTok{"(Q value \textless{} 0.05)."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    focus }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Acyl carnitines"}\NormalTok{,}
      \StringTok{"Lysophosphatidylcholines"}\NormalTok{,}
      \StringTok{"Bile acids, alcohols and derivatives"}\NormalTok{)}
\NormalTok{    focus }\OtherTok{\textless{}{-}} \FunctionTok{select\_features}\NormalTok{(mcn, focus, }\AttributeTok{q.value =}\NormalTok{ .}\DecValTok{05}\NormalTok{, }\AttributeTok{logfc =}\NormalTok{ .}\DecValTok{3}\NormalTok{, }\AttributeTok{coef =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{2}\NormalTok{)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s11}\FloatTok{.2} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Get the InChIkey 2D of these features, then get the possible"}\NormalTok{,}
    \StringTok{"InChIkey, then get the CID, and finally get the KEGG ID by the"}\NormalTok{,}
    \StringTok{"CID."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    focus.key2d }\OtherTok{\textless{}{-}} \FunctionTok{maps}\NormalTok{(feas, focus, }\StringTok{".features\_id"}\NormalTok{, }\StringTok{"inchikey2d"}\NormalTok{)}
\NormalTok{    focus.cid }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(focus.key2d,}
      \ControlFlowTok{function}\NormalTok{(key2d) \{}
\NormalTok{        set }\OtherTok{\textless{}{-}}\NormalTok{ key.set[ }\FunctionTok{names}\NormalTok{(key.set) }\SpecialCharTok{\%in\%}\NormalTok{ key2d ]}
        \FunctionTok{unlist}\NormalTok{(}\FunctionTok{lapply}\NormalTok{(set, }\ControlFlowTok{function}\NormalTok{(df) df}\SpecialCharTok{$}\NormalTok{CID),}
          \AttributeTok{use.names =}\NormalTok{ F)}
\NormalTok{      \})}
\NormalTok{    keggids }\OtherTok{\textless{}{-}} \FunctionTok{cid.to.kegg}\NormalTok{(}\FunctionTok{unlist}\NormalTok{(focus.cid, }\AttributeTok{use.names =}\NormalTok{ F))}
\NormalTok{    focus.kegg }\OtherTok{\textless{}{-}} \FunctionTok{maps}\NormalTok{(keggids, }\FunctionTok{lapply}\NormalTok{(focus.cid, as.character), }\StringTok{"Query"}\NormalTok{, }\StringTok{"KEGG"}\NormalTok{)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s11}\FloatTok{.3} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Let\textquotesingle{}s see what we get."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    focus.kegg}
\NormalTok{  \}, }\AttributeTok{args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{eval =}\NormalTok{ T))}
\NormalTok{)}

\NormalTok{s11}\FloatTok{.4} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Using package \textquotesingle{}FELLA\textquotesingle{} for pathway enrichment analysis."}\NormalTok{,}
    \StringTok{"The following step create a \textquotesingle{}database\textquotesingle{} for enrichment"}\NormalTok{,}
    \StringTok{"(It is quite time consuming and can take up to 30 minutes)."}\NormalTok{,}
    \StringTok{"Subsequently, load the data."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    db.dir }\OtherTok{\textless{}{-}} \FunctionTok{init\_fella}\NormalTok{(tmp, }\StringTok{"hsa"}\NormalTok{)}
\NormalTok{    db.data }\OtherTok{\textless{}{-}} \FunctionTok{load\_fella}\NormalTok{(db.dir)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s11}\FloatTok{.5} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Perform enrichment."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    focus.enrich }\OtherTok{\textless{}{-}} \FunctionTok{enrich\_fella}\NormalTok{(focus.kegg, db.data)}
\NormalTok{    focus.graph }\OtherTok{\textless{}{-}} \FunctionTok{graph\_fella}\NormalTok{(focus.enrich, db.data, }\StringTok{"pagerank"}\NormalTok{)}
    \FunctionTok{names}\NormalTok{(focus.graph) }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(focus.kegg)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s11}\FloatTok{.6} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Some compounds are not present in the KEGG graph and are only background"}\NormalTok{,}
    \StringTok{"compounds. Let\textquotesingle{}s check the enrichment results."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
    \SpecialCharTok{!}\FunctionTok{vapply}\NormalTok{(focus.graph, is.null, }\FunctionTok{logical}\NormalTok{(}\DecValTok{1}\NormalTok{))}
\NormalTok{  \}, }\AttributeTok{args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{eval =}\NormalTok{ T))}
\NormalTok{)}

\NormalTok{s11}\FloatTok{.7} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Visualization of enrichment results."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    p2 }\OtherTok{\textless{}{-}} \FunctionTok{plotGraph\_fella}\NormalTok{(focus.graph[[}\DecValTok{2}\NormalTok{]])}
    \FunctionTok{ggsave}\NormalTok{(f11}\FloatTok{.71} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/ba\_enrich.pdf"}\NormalTok{), p2)}
\NormalTok{    p3 }\OtherTok{\textless{}{-}} \FunctionTok{plotGraph\_fella}\NormalTok{(focus.graph[[}\DecValTok{3}\NormalTok{]])}
    \FunctionTok{ggsave}\NormalTok{(f11}\FloatTok{.72} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/lpc\_enrich.pdf"}\NormalTok{), p3)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s11.}\FloatTok{7.}\NormalTok{fig1 }\OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(f11}\FloatTok{.71}\NormalTok{, }\StringTok{"ba"}\NormalTok{, }\StringTok{"Enrichment of Pagerank of BA compounds"}\NormalTok{)}
\NormalTok{s11.}\FloatTok{7.}\NormalTok{fig2 }\OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(f11}\FloatTok{.72}\NormalTok{, }\StringTok{"lpc"}\NormalTok{, }\StringTok{"Enrichment of Pagerank of LPC compounds"}\NormalTok{)}

\DocumentationTok{\#\# Heatmap analysis}
\NormalTok{s12 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Heatmap analysis"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s12}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Since the quantitative data obtained by merging contain many missing values,"}\NormalTok{,}
    \StringTok{"they need to be processed before plotting the heat map:"}\NormalTok{,}
    \StringTok{"For each subset of data, the missing values will be filled with the average"}\NormalTok{,}
    \StringTok{"value; if the set is all missing values, they will be filled with zero."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    hp.data }\OtherTok{\textless{}{-}} \FunctionTok{handling\_na}\NormalTok{(}
      \FunctionTok{features\_quantification}\NormalTok{(mcn2),}
      \AttributeTok{metadata =} \FunctionTok{sample\_metadata}\NormalTok{(mcn2)}
\NormalTok{    )}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s12}\FloatTok{.2} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Convert wide data to long data; log transform the values; if there is a"}\NormalTok{,}
    \StringTok{"value 0, replace it with 1/10 of the minimum value of the value column."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    hp.data }\OtherTok{\textless{}{-}} \FunctionTok{log\_trans}\NormalTok{(hp.data)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s12}\FloatTok{.3} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Draw heat maps for three chemical classes."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
    \FunctionTok{names}\NormalTok{(focus) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"ACs"}\NormalTok{, }\StringTok{"BAs"}\NormalTok{, }\StringTok{"LPCs"}\NormalTok{)}
\NormalTok{    hp.lst }\OtherTok{\textless{}{-}} \FunctionTok{plot\_heatmap}\NormalTok{(focus, hp.data, metadata, }\AttributeTok{pal\_group =} \FunctionTok{palette\_stat}\NormalTok{(mcn2))}
    \FunctionTok{ggsave}\NormalTok{(f12}\FloatTok{.31} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/ac\_heatmap.pdf"}\NormalTok{), hp.lst[[}\DecValTok{1}\NormalTok{]], }\AttributeTok{width =} \DecValTok{13}\NormalTok{, }\AttributeTok{height =} \DecValTok{4}\NormalTok{)}
    \FunctionTok{ggsave}\NormalTok{(f12}\FloatTok{.32} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/ba\_heatmap.pdf"}\NormalTok{), hp.lst[[}\DecValTok{2}\NormalTok{]], }\AttributeTok{width =} \DecValTok{13}\NormalTok{, }\AttributeTok{height =} \DecValTok{7}\NormalTok{)}
    \FunctionTok{ggsave}\NormalTok{(f12}\FloatTok{.33} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/lpc\_heatmap.pdf"}\NormalTok{), hp.lst[[}\DecValTok{3}\NormalTok{]], }\AttributeTok{width =} \DecValTok{13}\NormalTok{, }\AttributeTok{height =} \DecValTok{4}\NormalTok{)}
\NormalTok{  \})}
\NormalTok{)}

\CommentTok{\# test \textless{}{-} plot\_heatmap(focus, hp.data, metadata, pal\_group = palette\_stat(mcn2), clust\_col = F)}
\CommentTok{\# test \textless{}{-} lapply(test, function(x) grid.grabExpr(print(x)))}
\CommentTok{\# names(test)}
\CommentTok{\# \# [1] "ACs"  "BAs"  "LPCs"}
\CommentTok{\# test.p \textless{}{-} frame\_row(c(ACs = 1, BAs = 1.5, LPCs = 1), test)}
\CommentTok{\# pdf(paste0(tmp, "/test\_heatmap.pdf"), width = 13, height = 18)}
\CommentTok{\# draw(test.p)}
\CommentTok{\# dev.off()}

\NormalTok{s12.}\FloatTok{4.}\NormalTok{fig1 }\OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(f12}\FloatTok{.31}\NormalTok{, }\StringTok{"acHp"}\NormalTok{, }\StringTok{"Heatmap of ACs"}\NormalTok{)}
\NormalTok{s12.}\FloatTok{4.}\NormalTok{fig2 }\OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(f12}\FloatTok{.32}\NormalTok{, }\StringTok{"baHp"}\NormalTok{, }\StringTok{"Heatmap of BAs"}\NormalTok{)}
\NormalTok{s12.}\FloatTok{4.}\NormalTok{fig3 }\OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(f12}\FloatTok{.33}\NormalTok{, }\StringTok{"lpcHp"}\NormalTok{, }\StringTok{"Heatmap of LPCs"}\NormalTok{)}

\NormalTok{s12}\FloatTok{.5} \OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"As shown in figure,"}\NormalTok{,}
  \FunctionTok{paste0}\NormalTok{(}\StringTok{"Fig. "}\NormalTok{, }\FunctionTok{get\_ref}\NormalTok{(s12.}\FloatTok{4.}\NormalTok{fig1), }\StringTok{", "}\NormalTok{, }\FunctionTok{get\_ref}\NormalTok{(s12.}\FloatTok{4.}\NormalTok{fig2), }\StringTok{", and "}\NormalTok{,}
    \FunctionTok{get\_ref}\NormalTok{(s12.}\FloatTok{4.}\NormalTok{fig3)),}
  \StringTok{"ACs and BAs implied a high correlation with disease,"}\NormalTok{,}
  \StringTok{"while LPCs showed a relatively weak correlation."}
\NormalTok{)}

\NormalTok{notShow2 }\OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Combined heatmap."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    grobs.hp }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(hp.lst, }\ControlFlowTok{function}\NormalTok{(p) grid}\SpecialCharTok{::}\FunctionTok{grid.grabExpr}\NormalTok{(}\FunctionTok{print}\NormalTok{(p)))}
\NormalTok{    grobs.hp }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{3}\NormalTok{,}
      \ControlFlowTok{function}\NormalTok{(n, }\AttributeTok{x =} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"c"}\NormalTok{)) \{}
        \FunctionTok{into}\NormalTok{(}\FunctionTok{grecta}\NormalTok{(x[n]), grobs.hp[[ n ]])}
\NormalTok{      \})}
    \FunctionTok{names}\NormalTok{(grobs.hp) }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(hp.lst)}
\NormalTok{    grobs.hp }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{ACs =} \DecValTok{1}\NormalTok{, }\AttributeTok{BAs =} \FloatTok{1.5}\NormalTok{, }\AttributeTok{LPCs =} \DecValTok{1}\NormalTok{), grobs.hp)}
\NormalTok{    grobs.hp }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(grobs.hp, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{95}\NormalTok{, .}\DecValTok{95}\NormalTok{))}
    \FunctionTok{pdf}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/hps.pdf"}\NormalTok{), }\DecValTok{13}\NormalTok{, }\DecValTok{15}\NormalTok{)}
    \FunctionTok{draw}\NormalTok{(grobs.hp)}
    \FunctionTok{dev.off}\NormalTok{()}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s15 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Verify Identification"}\NormalTok{, }\DecValTok{1}\NormalTok{)}

\NormalTok{s15}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"In research of Wozniak et al, a subset of ACs compounds were identified. In"}\NormalTok{,}
    \StringTok{"addition, four top rank metabolites were identified. However, Most of the"}\NormalTok{,}
    \StringTok{"top 25 metabolites (EFS rank) were not identified."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    ac\_names }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Palmitoyl{-}carnitine"}\NormalTok{, }\StringTok{"Octanoyl{-}carnitine"}\NormalTok{,}
      \StringTok{"Acetyl{-}carnitine"}\NormalTok{, }\StringTok{"Hexanoyl{-}carnitine"}\NormalTok{,}
      \StringTok{"Decanoyl{-}carnitine"}\NormalTok{)}
\NormalTok{    ac\_inchikey2d }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"XOMRRQXKHMYMOC"}\NormalTok{, }\StringTok{"CXTATJFJDMJMIY"}\NormalTok{,}
      \StringTok{"RDHQFKQIGNGIED"}\NormalTok{, }\StringTok{"VVPRQWTYSNDTEA"}\NormalTok{,}
      \StringTok{"LZOSYCMHQXPBFU"}\NormalTok{)}
    \FunctionTok{names}\NormalTok{(ac\_inchikey2d) }\OtherTok{\textless{}{-}}\NormalTok{ ac\_names}
\NormalTok{    other\_4m }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
      \StringTok{"Hepc"}\NormalTok{, }\StringTok{"D{-}erythro{-}Sphingosine{-}1{-}phosphate"}\NormalTok{, }\StringTok{"L{-}THYROXINE"}\NormalTok{,}
      \StringTok{"Decanoyl{-}L{-}carnitine"}
\NormalTok{    )}
\NormalTok{    other\_4m\_inchikey2d }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
      \StringTok{"BDPQVGIMLZYZQA"}\NormalTok{, }\StringTok{"DUYSYHSSBDVJSM"}\NormalTok{, }\StringTok{"XUIIKFGFIJCVMT"}\NormalTok{,}
      \StringTok{"LZOSYCMHQXPBFU"}
\NormalTok{    )}
\NormalTok{    other\_4m.seq }\OtherTok{\textless{}{-}} \FunctionTok{unlist}\NormalTok{(}\FunctionTok{lapply}\NormalTok{(other\_4m, grep,}
        \AttributeTok{x =}\NormalTok{ origin}\SpecialCharTok{$}\NormalTok{Spectral\_Library\_Match, }\AttributeTok{ignore.case =}\NormalTok{ T))}
\NormalTok{    other\_4m }\OtherTok{\textless{}{-}}\NormalTok{ origin[other\_4m.seq, ]}
\NormalTok{    origin.top25 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{349}\NormalTok{, }\DecValTok{746}\NormalTok{, }\DecValTok{854}\NormalTok{, }\DecValTok{228}\NormalTok{, }\DecValTok{320}\NormalTok{, }\DecValTok{971}\NormalTok{, }\DecValTok{2532}\NormalTok{, }\DecValTok{670}\NormalTok{, }\DecValTok{92}\NormalTok{, }\DecValTok{1363}\NormalTok{,}
      \DecValTok{13}\NormalTok{, }\DecValTok{798}\NormalTok{, }\DecValTok{1379}\NormalTok{, }\DecValTok{1947}\NormalTok{, }\DecValTok{4146}\NormalTok{, }\DecValTok{736}\NormalTok{, }\DecValTok{1656}\NormalTok{, }\DecValTok{464}\NormalTok{, }\DecValTok{731}\NormalTok{, }\DecValTok{289}\NormalTok{,}
      \DecValTok{4431}\NormalTok{, }\DecValTok{3865}\NormalTok{, }\DecValTok{476}\NormalTok{, other\_4m}\SpecialCharTok{$}\NormalTok{Unique\_ID)}
\NormalTok{    origin.top25.featureID }\OtherTok{\textless{}{-}}
\NormalTok{      dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(merged, oid }\SpecialCharTok{\%in\%}\NormalTok{ origin.top25)}\SpecialCharTok{$}\NormalTok{.features\_id}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s15}\FloatTok{.2} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Confirm which compounds were identified:"}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    ac\_inchikey2d }\SpecialCharTok{\%in\%} \FunctionTok{features\_annotation}\NormalTok{(mcn2)}\SpecialCharTok{$}\NormalTok{inchikey2d}
\NormalTok{    other\_4m\_inchikey2d }\SpecialCharTok{\%in\%} \FunctionTok{features\_annotation}\NormalTok{(mcn2)}\SpecialCharTok{$}\NormalTok{inchikey2d}
\NormalTok{    reIdentify.origin.top25 }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(}\FunctionTok{features\_annotation}\NormalTok{(mcn2),}
\NormalTok{      .features\_id }\SpecialCharTok{\%in\%}\NormalTok{ origin.top25.featureID)}
\NormalTok{    reIdentify.origin.top25 }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(}
\NormalTok{      reIdentify.origin.top25, .features\_id, tani.score, inchikey2d}
\NormalTok{    )}
    \FunctionTok{print}\NormalTok{(reIdentify.origin.top25, }\AttributeTok{n =} \ConstantTok{Inf}\NormalTok{)}
\NormalTok{  \}, }\AttributeTok{args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{eval =}\NormalTok{ T))}
\NormalTok{)}

\DocumentationTok{\#\# Session infomation}
\NormalTok{s100 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Session infomation"}\NormalTok{, }\DecValTok{1}\NormalTok{)}

\NormalTok{s100}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{rblock}\NormalTok{(\{}
  \FunctionTok{sessionInfo}\NormalTok{()}
\NormalTok{\}, }\AttributeTok{args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{eval =}\NormalTok{ T))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# output report}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\NormalTok{sections }\OtherTok{\textless{}{-}} \FunctionTok{gather\_sections}\NormalTok{()}
\NormalTok{prologue }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}
  \FunctionTok{new\_section}\NormalTok{(}\StringTok{"Abstract"}\NormalTok{, }\DecValTok{1}\NormalTok{, reportDoc}\SpecialCharTok{$}\NormalTok{abstract, }\ConstantTok{NULL}\NormalTok{),}
  \FunctionTok{new\_section}\NormalTok{(}\StringTok{"Introduction"}\NormalTok{, }\DecValTok{1}\NormalTok{, reportDoc}\SpecialCharTok{$}\NormalTok{introduction, }\ConstantTok{NULL}\NormalTok{),}
  \FunctionTok{new\_section}\NormalTok{(}\StringTok{"Set{-}up"}\NormalTok{, }\DecValTok{1}\NormalTok{, reportDoc}\SpecialCharTok{$}\NormalTok{setup,}
    \FunctionTok{rblock}\NormalTok{(\{}
      \FunctionTok{library}\NormalTok{(MCnebula2)}
      \FunctionTok{library}\NormalTok{(exMCnebula2)}
\NormalTok{    \}, F)}
\NormalTok{  )}
\NormalTok{) }
\NormalTok{report }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(new\_report, }\FunctionTok{c}\NormalTok{(prologue, sections))}
\FunctionTok{yaml}\NormalTok{(report)[}\DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"title: Analysis on serum dataset"}\NormalTok{)}

\DocumentationTok{\#\# post{-}modify, add heading}
\NormalTok{h1 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Integrate data and Create Nebulae"}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{h2 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Nebulae for Downstream analysis"}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{seqs }\OtherTok{\textless{}{-}} \FunctionTok{search\_heading}\NormalTok{(report, }\StringTok{"\^{}Initialize|\^{}Statistic"}\NormalTok{)}
\NormalTok{report }\OtherTok{\textless{}{-}} \FunctionTok{insert\_layers}\NormalTok{(report, seqs[}\DecValTok{1}\NormalTok{], h1)}
\NormalTok{report }\OtherTok{\textless{}{-}} \FunctionTok{insert\_layers}\NormalTok{(report, seqs[}\DecValTok{2}\NormalTok{], h2)}

\FunctionTok{render\_report}\NormalTok{(report, file.report }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/report.rmd"}\NormalTok{))}
\NormalTok{rmarkdown}\SpecialCharTok{::}\FunctionTok{render}\NormalTok{(file.report)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# convert as html with biocStyle}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\# library(MCnebula2)}

\CommentTok{\# write\_biocStyle(report, file2 \textless{}{-} paste0(tmp, "/report\_biocStyle\_nofloat.Rmd"),}
\CommentTok{\#   title \textless{}{-} paste0(yaml(report)[1], "\textbackslash{}nauther: \textquotesingle{}LiChuang Huang\textquotesingle{}")}
\CommentTok{\# )}

\CommentTok{\# rmarkdown::render(file2)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# convert to docx version}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\# write\_thesisDocx(report, file3 \textless{}{-} paste0(tmp, "/report\_thesisStyle.Rmd"),}
\CommentTok{\#   title \textless{}{-} yaml(report)[1]}
\CommentTok{\# )}

\CommentTok{\# rmarkdown::render(file3)}
\CommentTok{\# file.copy(gsub("\textbackslash{}\textbackslash{}.Rmd", ".docx", file3),}
\CommentTok{\#   "/mnt/data/wizard/Documents/article/MCnebula2/others/report\_serum.docx", T)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# extra picture}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\# pgg \textless{}{-} modify\_set\_labs(mcn@parent\_nebula@ggset, mcn)}
\CommentTok{\# pgg \textless{}{-} mutate\_layer(pgg, 3, stroke = 0, color = "transparent")}
\CommentTok{\# \# ggsave("herbal\_parent.pdf", call\_command(pgg), width = 7, height = 7)}

\CommentTok{\# mcn@child\_nebulae@ggset \%\textless{}\textgreater{}\%}
\CommentTok{\#   lapply(function(ggset) \{}
\CommentTok{\#     mutate\_layer(ggset, 3, stroke = 0, color = "transparent")}
\CommentTok{\# \})}

\CommentTok{\# pc \textless{}{-} nebulae\_as\_grob(mcn)}
\CommentTok{\# frame \textless{}{-} frame\_col(c(p = 1.2, pc = 1), namel(p = as\_grob(call\_command(pgg)), pc))}
\CommentTok{\# \# dev.new(width = 23, height = 14)}

\CommentTok{\# pdf("parent\_and\_child.pdf", 23 * .8, 14 * .8)}
\CommentTok{\# draw(frame)}
\CommentTok{\# dev.off()}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-site_mcnebula2.r}{%
\section{File: site\_mcnebula2.R}\label{file-site_mcnebula2.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# install.packages("blogdown")}
\FunctionTok{setwd}\NormalTok{(}\StringTok{"\textasciitilde{}/MCnebula2/"}\NormalTok{)}

\CommentTok{\# web\_config \textless{}{-} readLines(file \textless{}{-} "config/production/config.toml")}
\CommentTok{\# web\_config[2] \textless{}{-} "baseURL = \textquotesingle{}https://mcnebula.netlify.app\textquotesingle{}"}
\CommentTok{\# writeLines(web\_config, file)}

\NormalTok{devtools}\SpecialCharTok{::}\FunctionTok{load\_all}\NormalTok{(}\StringTok{"\textasciitilde{}/utils.tool"}\NormalTok{)}
\FunctionTok{set\_hugoDir}\NormalTok{(}\StringTok{"\textasciitilde{}/MCnebula2"}\NormalTok{)}
\FunctionTok{options}\NormalTok{(}\AttributeTok{blogdown.method =} \StringTok{"markdown"}\NormalTok{)}
\NormalTok{blogdown}\SpecialCharTok{::}\FunctionTok{serve\_site}\NormalTok{()}
\CommentTok{\# blogdown::stop\_server()}

\NormalTok{description }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{strwrap}\NormalTok{(}\StringTok{"Critical chemical classes to classify and boost}
\StringTok{    identification by visualization for untargeted LC{-}MS/MS data analysis"}\NormalTok{),}
    \AttributeTok{collapse =} \StringTok{" "}\NormalTok{)}
\NormalTok{addition }\OtherTok{\textless{}{-}} \StringTok{"R package for analysis of non{-}targeted LC{-}MS/MS"}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# basic setting (text)}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\FunctionTok{set\_home}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{title =} \StringTok{"MCnebula2"}\NormalTok{,}
           \AttributeTok{titleSeparator =} \StringTok{" | "}\NormalTok{,}
           \AttributeTok{titleAddition =}\NormalTok{ addition,}
           \AttributeTok{description =}\NormalTok{ description))}

\FunctionTok{set\_index}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{title =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"MCnebula2: "}\NormalTok{, addition),}
            \AttributeTok{lead =}\NormalTok{ description,}
            \AttributeTok{date =} \FunctionTok{record\_time}\NormalTok{(),}
            \AttributeTok{lastmod =} \FunctionTok{record\_time}\NormalTok{()),}
          \StringTok{"en/\_index.Rmd"}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# create scene}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\FunctionTok{new\_scene}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{prologue =} \StringTok{"introduction"}\NormalTok{,}
    \AttributeTok{prologue =} \StringTok{"super\_quick\_start"}\NormalTok{,}
    \AttributeTok{prologue =} \StringTok{"quick\_start"}\NormalTok{,}
    \AttributeTok{prologue =} \StringTok{"usage"}\NormalTok{),}
  \FunctionTok{rep}\NormalTok{(}\DecValTok{110}\NormalTok{, }\DecValTok{4}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\DecValTok{100}\NormalTok{, }\DecValTok{40}\NormalTok{, }\DecValTok{50}\NormalTok{, }\DecValTok{110}\NormalTok{))}

\FunctionTok{new\_scene}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{installation =} \StringTok{"linux"}\NormalTok{,}
            \AttributeTok{installation =} \StringTok{"windows"}\NormalTok{,}
            \AttributeTok{installation =} \StringTok{"macOS"}\NormalTok{),}
          \FunctionTok{rep}\NormalTok{(}\DecValTok{100}\NormalTok{, }\DecValTok{3}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{20}\NormalTok{, }\DecValTok{30}\NormalTok{))}

\FunctionTok{new\_scene}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{recommendation =} \StringTok{"mzmine2"}\NormalTok{,}
            \AttributeTok{recommendation =} \StringTok{"sirius\_4"}\NormalTok{,}
            \AttributeTok{recommendation =} \StringTok{"proteowizard"}\NormalTok{),}
          \FunctionTok{rep}\NormalTok{(}\DecValTok{200}\NormalTok{, }\DecValTok{3}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\DecValTok{220}\NormalTok{, }\DecValTok{230}\NormalTok{, }\DecValTok{210}\NormalTok{))}

\FunctionTok{new\_scene}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{workflow =} \StringTok{"basic\_workflow"}\NormalTok{), }\DecValTok{150}\NormalTok{)}
\FunctionTok{new\_scene}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{workflow =} \StringTok{"metabolic\_workflow"}\NormalTok{), }\DecValTok{152}\NormalTok{)}
\FunctionTok{new\_scene}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{workflow =} \StringTok{"chemical\_workflow"}\NormalTok{), }\DecValTok{153}\NormalTok{)}

\FunctionTok{new\_scene}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{herbal\_eucommia =} \StringTok{"index"}\NormalTok{,}
            \AttributeTok{metabolites\_serum =} \StringTok{"index"}\NormalTok{),}
          \FunctionTok{rep}\NormalTok{(}\DecValTok{500}\NormalTok{, }\DecValTok{3}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\DecValTok{100}\NormalTok{, }\DecValTok{200}\NormalTok{), }\AttributeTok{tar =} \StringTok{"news"}\NormalTok{, }\AttributeTok{index\_Draft =}\NormalTok{ F)}

\FunctionTok{new\_scene}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{help =} \StringTok{"R\_tips"}\NormalTok{), }\DecValTok{5000}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# contact and about}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\FunctionTok{new\_scene}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{contact =} \StringTok{"index"}\NormalTok{), }\DecValTok{1000}\NormalTok{, }\DecValTok{1100}\NormalTok{, }\AttributeTok{tar =} \StringTok{"en"}\NormalTok{, }\AttributeTok{index\_Draft =}\NormalTok{ F)}
\FunctionTok{new\_scene}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{about =} \StringTok{"index"}\NormalTok{), }\DecValTok{2000}\NormalTok{, }\DecValTok{2100}\NormalTok{, }\AttributeTok{tar =} \StringTok{"en"}\NormalTok{, }\AttributeTok{index\_Draft =}\NormalTok{ F)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-subjective_evaluation.r}{%
\section{File: subjective\_evaluation.R}\label{file-subjective_evaluation.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# create the table for subjective\_evaluation}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\NormalTok{menu }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}
  \AttributeTok{identificaiton =} \FunctionTok{c}\NormalTok{(}\StringTok{"MS1"}\NormalTok{, }\StringTok{"library match"}\NormalTok{, }\StringTok{"machine prediction"}\NormalTok{),}
  \AttributeTok{classifying =} \FunctionTok{c}\NormalTok{(}\StringTok{"structure based"}\NormalTok{, }\StringTok{"MS/MS based"}\NormalTok{, }\StringTok{"select classes"}\NormalTok{),}
  \AttributeTok{visualize\_dataset =} \FunctionTok{c}\NormalTok{(}\StringTok{"spectral based"}\NormalTok{, }\StringTok{"classes based"}\NormalTok{, }\StringTok{"indepth annotation"}\NormalTok{),}
  \AttributeTok{others =} \FunctionTok{c}\NormalTok{(}\StringTok{"preprocessing"}\NormalTok{, }\StringTok{"statistics"}\NormalTok{, }\StringTok{"path\_enrichment"}\NormalTok{, }\StringTok{"report"}\NormalTok{),}
  \AttributeTok{usage =} \FunctionTok{c}\NormalTok{(}\StringTok{"software"}\NormalTok{, }\StringTok{"availability"}\NormalTok{, }\StringTok{"difficulty"}\NormalTok{)}
\NormalTok{)}

\NormalTok{methods }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"MCnebula"}\NormalTok{, }\StringTok{"SIRIUS"}\NormalTok{, }\StringTok{"GNPS"}\NormalTok{, }\StringTok{"MZmine"}\NormalTok{, }\StringTok{"XCMS"}\NormalTok{, }\StringTok{"MetaboAnalyst"}\NormalTok{, }\StringTok{"MS{-}DIAL"}\NormalTok{)}

\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(menu, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{data.frame}\NormalTok{(}\AttributeTok{item =}\NormalTok{ x))}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(data, }\AttributeTok{idcol =}\NormalTok{ T)}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{rename}\NormalTok{(data, }\AttributeTok{group =}\NormalTok{ .id)}

\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(methods, }\ControlFlowTok{function}\NormalTok{(name) data, }\AttributeTok{simplify =}\NormalTok{ F)}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(data, }\AttributeTok{idcol =}\NormalTok{ T)}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{rename}\NormalTok{(data, }\AttributeTok{method =}\NormalTok{ .id)}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(}
\NormalTok{  data, }\AttributeTok{eval =} \FunctionTok{integer}\NormalTok{(}\DecValTok{1}\NormalTok{), }
  \AttributeTok{item =} \FunctionTok{factor}\NormalTok{(item, }\AttributeTok{levels =} \FunctionTok{unique}\NormalTok{(item))}
\NormalTok{)}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ tidyr}\SpecialCharTok{::}\FunctionTok{spread}\NormalTok{(data, method, eval)}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{arrange}\NormalTok{(data, item)}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(data, group, item, dplyr}\SpecialCharTok{::}\FunctionTok{all\_of}\NormalTok{(methods))}

\NormalTok{filename }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"subEval\_"}\NormalTok{, }\FunctionTok{Sys.Date}\NormalTok{(), }\StringTok{".csv"}\NormalTok{)}
\NormalTok{data.table}\SpecialCharTok{::}\FunctionTok{fwrite}\NormalTok{(data, filename)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# format the table}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\NormalTok{filename }\OtherTok{\textless{}{-}} \StringTok{"subEval\_2023{-}02{-}21.csv"}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{fread}\NormalTok{(filename)}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(data, item }\SpecialCharTok{!=} \StringTok{"software"}\NormalTok{)}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate\_if}\NormalTok{(}
\NormalTok{  data, is.integer,}
  \ControlFlowTok{function}\NormalTok{(x) \{}
    \FunctionTok{ifelse}\NormalTok{(x }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, }\StringTok{"{-}"}\NormalTok{, }
      \FunctionTok{vapply}\NormalTok{(x, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{paste0}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\StringTok{"*"}\NormalTok{, }\FunctionTok{abs}\NormalTok{(x)), }\AttributeTok{collapse =} \StringTok{""}\NormalTok{), }
        \FunctionTok{character}\NormalTok{(}\DecValTok{1}\NormalTok{)))}
\NormalTok{  \}}
\NormalTok{)}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(data, }\AttributeTok{group =} \FunctionTok{form}\NormalTok{(group), }\AttributeTok{item =} \FunctionTok{form}\NormalTok{(item))}
\FunctionTok{colnames}\NormalTok{(data) }\OtherTok{\textless{}{-}} \FunctionTok{form}\NormalTok{(}\FunctionTok{colnames}\NormalTok{(data))}

\NormalTok{table }\OtherTok{\textless{}{-}} \FunctionTok{pretty\_table}\NormalTok{(}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{group\_by}\NormalTok{(data, Group), }\AttributeTok{title =} \StringTok{"Functional evaluation"}\NormalTok{, }
  \AttributeTok{subtitle =} \StringTok{"Evaluation for software of analysis of LC{-}MS/MS"}
\NormalTok{)}
\NormalTok{data.table}\SpecialCharTok{::}\FunctionTok{fwrite}\NormalTok{(data, }\StringTok{"subEval.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-abstract.r}{%
\section{File: Abstract.R}\label{file-abstract.r}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s0}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_section}\NormalTok{(}\StringTok{"Abstract"}\NormalTok{, }\DecValTok{1}\NormalTok{, reportDoc}\SpecialCharTok{$}\NormalTok{abstract, }\ConstantTok{NULL}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-annotate-nebulae.r}{%
\section{File: Annotate Nebulae.R}\label{file-annotate-nebulae.r}}

\hypertarget{file-create-nebulae.r}{%
\section{File: Create Nebulae.R}\label{file-create-nebulae.r}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s4 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Create Nebulae"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s4}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Create Nebula{-}Index data. This data created based on \textquotesingle{}stardust\_classes\textquotesingle{} data."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{create\_nebula\_index}\NormalTok{(mcn)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s4}\FloatTok{.5} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
\NormalTok{  reportDoc}\SpecialCharTok{$}\NormalTok{nebulae,}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{compute\_spectral\_similarity}\NormalTok{(mcn)}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{create\_parent\_nebula}\NormalTok{(mcn)}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_nebulae}\NormalTok{(mcn)}
\NormalTok{  \})}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-filter-candidates.r}{%
\section{File: Filter candidates.R}\label{file-filter-candidates.r}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s2 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Filter candidates"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s2}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
\NormalTok{  reportDoc}\SpecialCharTok{$}\NormalTok{filter,}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(mcn)}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(mcn)}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(mcn, }\AttributeTok{by\_reference =}\NormalTok{ T)}
\NormalTok{  \})}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-filter-chemical-classes.r}{%
\section{File: Filter chemical classes.R}\label{file-filter-chemical-classes.r}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s3 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Filter chemical classes"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s3}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
\NormalTok{  reportDoc}\SpecialCharTok{$}\NormalTok{stardust,}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{create\_stardust\_classes}\NormalTok{(mcn)}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{create\_features\_annotation}\NormalTok{(mcn)}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{cross\_filter\_stardust}\NormalTok{(mcn)}
\NormalTok{    classes }\OtherTok{\textless{}{-}} \FunctionTok{unique}\NormalTok{(}\FunctionTok{stardust\_classes}\NormalTok{(mcn)}\SpecialCharTok{$}\NormalTok{class.name)}
\NormalTok{    table.filtered.classes }\OtherTok{\textless{}{-}} \FunctionTok{backtrack\_stardust}\NormalTok{(mcn)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s3}\FloatTok{.5} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Manually filter some repetitive classes or sub{-}structural classes."}\NormalTok{,}
    \StringTok{"By means of Regex matching, we obtained a number of recurring"}\NormalTok{,}
    \StringTok{"name of chemical classes that would contain manay identical compounds"}\NormalTok{,}
    \StringTok{"as their sub{-}structure."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    classes}
\NormalTok{    pattern }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"stero"}\NormalTok{, }\StringTok{"fatty acid"}\NormalTok{, }\StringTok{"pyr"}\NormalTok{, }\StringTok{"hydroxy"}\NormalTok{, }\StringTok{"\^{}orga"}\NormalTok{)}
\NormalTok{    dis }\OtherTok{\textless{}{-}} \FunctionTok{unlist}\NormalTok{(}\FunctionTok{lapply}\NormalTok{(pattern, grep, }\AttributeTok{x =}\NormalTok{ classes, }\AttributeTok{ignore.case =}\NormalTok{ T))}
\NormalTok{    dis }\OtherTok{\textless{}{-}}\NormalTok{ classes[dis]}
\NormalTok{    dis}
\NormalTok{    dis }\OtherTok{\textless{}{-}}\NormalTok{ dis[}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{]}
\NormalTok{  \}, }\AttributeTok{args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{eval =}\NormalTok{ T))}
\NormalTok{)}

\NormalTok{s3}\FloatTok{.6} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Remove these classes."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{backtrack\_stardust}\NormalTok{(mcn, dis, }\AttributeTok{remove =}\NormalTok{ T)}
\NormalTok{  \})}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-initialize-analysis.r}{%
\section{File: Initialize analysis.R}\label{file-initialize-analysis.r}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s1 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Initialize analysis"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s1}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Set SIRIUS project path and its version to initialize mcnebula object."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{mcnebula}\NormalTok{()}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{initialize\_mcnebula}\NormalTok{(mcn, }\StringTok{"\textless{}\textless{}\textless{}sirius\_version\textgreater{}\textgreater{}\textgreater{}"}\NormalTok{, }\StringTok{"\textless{}\textless{}\textless{}sirius\_project\textgreater{}\textgreater{}\textgreater{}"}\NormalTok{)}
    \FunctionTok{ion\_mode}\NormalTok{(mcn) }\OtherTok{\textless{}{-}} \StringTok{"\textless{}\textless{}\textless{}ion\_mode\textgreater{}\textgreater{}\textgreater{}"}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s1}\FloatTok{.5} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Create a temporary folder to store the output data."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    tmp }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"/temp\_data"}\NormalTok{)}
    \FunctionTok{dir.create}\NormalTok{(tmp, F)}
    \FunctionTok{export\_path}\NormalTok{(mcn) }\OtherTok{\textless{}{-}}\NormalTok{ tmp}
\NormalTok{  \})}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-integrate-data-and-create-nebulae.r}{%
\section{File: Integrate data and Create Nebulae.R}\label{file-integrate-data-and-create-nebulae.r}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s0}\FloatTok{.9} \OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Integrate data and Create Nebulae"}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-introduction.r}{%
\section{File: Introduction.R}\label{file-introduction.r}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s0}\FloatTok{.2} \OtherTok{\textless{}{-}} \FunctionTok{new\_section}\NormalTok{(}\StringTok{"Introduction"}\NormalTok{, }\DecValTok{1}\NormalTok{, reportDoc}\SpecialCharTok{$}\NormalTok{introduction, }\ConstantTok{NULL}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-pathway-enrichment.r}{%
\section{File: Pathway enrichment.R}\label{file-pathway-enrichment.r}}

\hypertarget{file-quantification-in-child-nebulae.r}{%
\section{File: Quantification in Child-Nebulae.R}\label{file-quantification-in-child-nebulae.r}}

\hypertarget{file-query-compounds.r}{%
\section{File: Query compounds.R}\label{file-query-compounds.r}}

\hypertarget{file-session-infomation.r}{%
\section{File: Session infomation.R}\label{file-session-infomation.r}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s100 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Session infomation"}\NormalTok{, }\DecValTok{1}\NormalTok{)}

\NormalTok{s100}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{rblock}\NormalTok{(\{}
  \FunctionTok{sessionInfo}\NormalTok{()}
\NormalTok{\}, }\AttributeTok{args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{eval =}\NormalTok{ T))}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-set-tracer-in-child-nebulae.r}{%
\section{File: Set tracer in Child-Nebulae.R}\label{file-set-tracer-in-child-nebulae.r}}

\hypertarget{file-set-up.r}{%
\section{File: Set-up.R}\label{file-set-up.r}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s0}\FloatTok{.3} \OtherTok{\textless{}{-}} \FunctionTok{new\_section}\NormalTok{(}\StringTok{"Set{-}up"}\NormalTok{, }\DecValTok{1}\NormalTok{, reportDoc}\SpecialCharTok{$}\NormalTok{setup,}
  \FunctionTok{rblock}\NormalTok{(\{}
    \FunctionTok{library}\NormalTok{(MCnebula2)}
\NormalTok{  \}, F)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-statistic-analysis.r}{%
\section{File: Statistic analysis.R}\label{file-statistic-analysis.r}}

\hypertarget{file-visualize-nebulae.r}{%
\section{File: Visualize Nebulae.R}\label{file-visualize-nebulae.r}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s5 }\OtherTok{\textless{}{-}} \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"Visualize Nebulae"}\NormalTok{, }\DecValTok{2}\NormalTok{)}

\NormalTok{s5}\FloatTok{.1} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Create layouts for Parent{-}Nebula or Child{-}Nebulae visualizations."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{create\_parent\_layout}\NormalTok{(mcn)}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_layouts}\NormalTok{(mcn)}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{activate\_nebulae}\NormalTok{(mcn)}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s5}\FloatTok{.3} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"The available chemical classes for visualization and its"}\NormalTok{,}
    \StringTok{"sequence in storage."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    table.nebulae }\OtherTok{\textless{}{-}} \FunctionTok{visualize}\NormalTok{(mcn)}
\NormalTok{    table.nebulae}
\NormalTok{  \}, }\AttributeTok{args =} \FunctionTok{list}\NormalTok{(}\AttributeTok{eval =}\NormalTok{ T))}
\NormalTok{)}

\NormalTok{s5}\FloatTok{.6} \OtherTok{\textless{}{-}} \FunctionTok{new\_section2}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Draw and save as .png or .pdf image files."}\NormalTok{),}
  \FunctionTok{rblock}\NormalTok{(\{}
\NormalTok{    p }\OtherTok{\textless{}{-}} \FunctionTok{visualize}\NormalTok{(mcn, }\StringTok{"parent"}\NormalTok{)}
    \FunctionTok{ggsave}\NormalTok{(f5}\FloatTok{.61} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/parent\_nebula.png"}\NormalTok{), p)}
    \FunctionTok{pdf}\NormalTok{(f5}\FloatTok{.62} \OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(tmp, }\StringTok{"/child\_nebula.pdf"}\NormalTok{), }\DecValTok{12}\NormalTok{, }\DecValTok{14}\NormalTok{)}
    \FunctionTok{visualize\_all}\NormalTok{(mcn)}
    \FunctionTok{dev.off}\NormalTok{()}
\NormalTok{  \})}
\NormalTok{)}

\NormalTok{s5.}\FloatTok{6.}\NormalTok{fig1 }\OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(f5}\FloatTok{.61}\NormalTok{, }\StringTok{"parent"}\NormalTok{, }\StringTok{"Parent{-}Nebula"}\NormalTok{)}
\NormalTok{s5.}\FloatTok{6.}\NormalTok{fig2 }\OtherTok{\textless{}{-}} \FunctionTok{include\_figure}\NormalTok{(f5}\FloatTok{.62}\NormalTok{, }\StringTok{"child"}\NormalTok{, }\StringTok{"Child{-}Nebulae"}\NormalTok{)}

\NormalTok{ref }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
  \FunctionTok{paste0}\NormalTok{(}\StringTok{"(Fig. "}\NormalTok{, }\FunctionTok{get\_ref}\NormalTok{(x), }\StringTok{")"}\NormalTok{)}
\NormalTok{\}}

\NormalTok{s5}\FloatTok{.8} \OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \StringTok{"In general, Parent{-}Nebulae"}\NormalTok{, }\FunctionTok{ref}\NormalTok{(s5.}\FloatTok{6.}\NormalTok{fig1),}
  \StringTok{"is too informative to show, so Child{-}Nebulae"}\NormalTok{, }\FunctionTok{ref}\NormalTok{(s5.}\FloatTok{6.}\NormalTok{fig2),}
  \StringTok{"was used to dipict the abundant classes of features (metabolites)"}\NormalTok{,}
  \StringTok{"in a grid panel, intuitively. In a bird\textquotesingle{}s eye view of"}\NormalTok{,}
  \StringTok{"Child{-}Nebulae, we can obtain many characteristics of features,"}\NormalTok{,}
  \StringTok{"involving classes distribution, structure identified accuracy, as"}\NormalTok{,}
  \StringTok{"well as spectral similarity within classes."}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-test_collate_sirius.5.r}{%
\section{File: test\_collate\_sirius.5.R}\label{file-test_collate_sirius.5.r}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{fread}\NormalTok{(}\StringTok{"./canopus\_compound\_summary.tsv"}\NormalTok{)}
\NormalTok{t }\OtherTok{\textless{}{-}} \FunctionTok{tolower}\NormalTok{(}\FunctionTok{gsub}\NormalTok{(}\StringTok{"\#| "}\NormalTok{, }\StringTok{"\_"}\NormalTok{, }\FunctionTok{colnames}\NormalTok{(df)))}

\FunctionTok{lapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(t),}
  \ControlFlowTok{function}\NormalTok{(n) \{}
\NormalTok{    x }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(t[n], }\StringTok{" = }\SpecialCharTok{\textbackslash{}"}\StringTok{"}\NormalTok{, }\FunctionTok{colnames}\NormalTok{(df)[n], }\StringTok{"}\SpecialCharTok{\textbackslash{}"}\StringTok{,"}\NormalTok{)}
    \FunctionTok{writeLines}\NormalTok{(x)}
\NormalTok{  \})}

\NormalTok{utils}\SpecialCharTok{::}\FunctionTok{unzip}\NormalTok{(}\StringTok{"./1\_instance5\_gnps1234/test.zip"}\NormalTok{, }\AttributeTok{list =}\NormalTok{ T)}
\NormalTok{t }\OtherTok{\textless{}{-}} \FunctionTok{list.files}\NormalTok{(}\StringTok{"./1\_instance5\_gnps1234/ff/"}\NormalTok{)[}\FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{4}\NormalTok{)]}
\NormalTok{tt }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"./1\_instance5\_gnps1234/fingerid"}\NormalTok{, }\StringTok{"/"}\NormalTok{, t)}



\FunctionTok{setwd}\NormalTok{(}\StringTok{"\textasciitilde{}/operation/sirius\_5\_test/test/"}\NormalTok{)}

\NormalTok{mcn }\OtherTok{\textless{}{-}} \FunctionTok{initialize\_mcnebula}\NormalTok{(}\FunctionTok{mcnebula}\NormalTok{(), }\StringTok{"sirius.v5"}\NormalTok{, }\StringTok{"."}\NormalTok{)}

\NormalTok{mcn1 }\OtherTok{\textless{}{-}} \FunctionTok{collate\_used}\NormalTok{(mcn)}
\FunctionTok{latest}\NormalTok{(}\FunctionTok{filter\_ppcp}\NormalTok{(mcn1))}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-test_comparespectra.r}{%
\section{File: TEST\_compareSpectra.R}\label{file-test_comparespectra.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# \#\# from package ProtGenerics}
\CommentTok{\# setGeneric("compareSpectra", function(x, y, ...)}
\CommentTok{\#     standardGeneric("compareSpectra"))}
\CommentTok{\# \#\# from MSnbase}
\CommentTok{\# setClass("Spectrum",}
\CommentTok{\#          representation = representation(}
\CommentTok{\#              msLevel="integer",}
\CommentTok{\#              peaksCount="integer",}
\CommentTok{\#              rt="numeric",}
\CommentTok{\#              acquisitionNum="integer",}
\CommentTok{\#              scanIndex = "integer",}
\CommentTok{\#              tic = "numeric",}
\CommentTok{\#              mz = "numeric",}
\CommentTok{\#              intensity = "numeric",}
\CommentTok{\#              fromFile = "integer",}
\CommentTok{\#              centroided = "logical",}
\CommentTok{\#              smoothed = "logical",}
\CommentTok{\#              polarity="integer",}
\CommentTok{\#              "VIRTUAL"),}
\CommentTok{\#          contains=c("Versioned"),}
\CommentTok{\#          prototype = prototype(}
\CommentTok{\#              rt = numeric(),}
\CommentTok{\#              polarity = NA\_integer\_,}
\CommentTok{\#              acquisitionNum = NA\_integer\_,}
\CommentTok{\#              msLevel = NA\_integer\_,}
\CommentTok{\#              centroided = NA,}
\CommentTok{\#              smoothed = NA,}
\CommentTok{\#              peaksCount = 0L,}
\CommentTok{\#              tic = 0,}
\CommentTok{\#              scanIndex = integer(),}
\CommentTok{\#              mz = numeric(),}
\CommentTok{\#              intensity = numeric()),}
\CommentTok{\#          validity = function(object)}
\CommentTok{\#              validSpectrum(object)}
\CommentTok{\#          )}

\CommentTok{\# setClass("Spectrum2",}
\CommentTok{\#          representation = representation(}
\CommentTok{\#              merged="numeric",}
\CommentTok{\#              precScanNum="integer",}
\CommentTok{\#              precursorMz="numeric",}
\CommentTok{\#              precursorIntensity = "numeric",}
\CommentTok{\#              precursorCharge = "integer",}
\CommentTok{\#              collisionEnergy = "numeric"),}
\CommentTok{\#          contains=c("Spectrum"),}
\CommentTok{\#          prototype = prototype(}
\CommentTok{\#              merged = 1,}
\CommentTok{\#              acquisitionNum = integer(),}
\CommentTok{\#              precScanNum = integer(),}
\CommentTok{\#              precursorMz = numeric(),}
\CommentTok{\#              precursorIntensity = numeric(),}
\CommentTok{\#              msLevel = as.integer(2),}
\CommentTok{\#              precursorCharge = integer(),}
\CommentTok{\#              collisionEnergy = numeric()),}
\CommentTok{\#          validity = function(object) \{}
\CommentTok{\#              msg \textless{}{-} validMsg(NULL, NULL)}
\CommentTok{\#              msl \textless{}{-} object@msLevel}
\CommentTok{\#              if (msl \textless{} as.integer(2))}
\CommentTok{\#                  msg \textless{}{-} validMsg(msg,}
\CommentTok{\#                                  paste0("Object of class ",}
\CommentTok{\#                                         class(object),}
\CommentTok{\#                                         " but msLevel is ", msl,}
\CommentTok{\#                                         " (should be \textgreater{} 1)"))}
\CommentTok{\#              if (is.null(msg)) TRUE}
\CommentTok{\#              else msg}
\CommentTok{\#          \})}


\CommentTok{\# setMethod("compareSpectra", c("Spectrum", "Spectrum"),}
\CommentTok{\#           function(x, y, fun=c("common", "cor", "dotproduct"),}
\CommentTok{\#                    ...) \{}
\CommentTok{\#               compare\_Spectra(x, y, fun = fun, ...)}
\CommentTok{\#           \})}

\CommentTok{\# \#\textquotesingle{} calculate similarity between spectra (between their intensity profile)}
\CommentTok{\# \#\textquotesingle{} @param x spectrum1 (MSnbase::Spectrum)}
\CommentTok{\# \#\textquotesingle{} @param y spectrum2 (MSnbase::Spectrum)}
\CommentTok{\# \#\textquotesingle{} @param fun similarity function (must take two spectra and ... as arguments)}
\CommentTok{\# \#\textquotesingle{} @param ... further arguments passed to "fun"}
\CommentTok{\# \#\textquotesingle{} @return double, similarity score}
\CommentTok{\# \#\textquotesingle{} @noRd}
\CommentTok{\# compare\_Spectra \textless{}{-} function(x, y,}
\CommentTok{\#                             fun=c("common", "cor", "dotproduct"),}
\CommentTok{\#                             ...) \{}
\CommentTok{\#   if (is.character(fun)) \{}
\CommentTok{\#     fun \textless{}{-} match.arg(fun)}
\CommentTok{\#     if (fun == "cor" || fun == "dotproduct") \{}
\CommentTok{\#       binnedSpectra \textless{}{-} bin\_Spectra(x, y, ...)}
\CommentTok{\#       inten \textless{}{-} lapply(binnedSpectra, intensity)}
\CommentTok{\#       return(do.call(fun, inten))}
\CommentTok{\#     \} else if (fun == "common") \{}
\CommentTok{\#       return(numberOfCommonPeaks(x, y, ...))}
\CommentTok{\#     \}}
\CommentTok{\#   \} else if (is.function(fun)) \{}
\CommentTok{\#     return(fun(x, y, ...))}
\CommentTok{\#   \}}
\CommentTok{\#   return(NA)}
\CommentTok{\# \}}


\CommentTok{\# setMethod("mz", "Spectrum", function(object) object@mz)}
\CommentTok{\# setMethod("intensity", "Spectrum", function(object) object@intensity)}

\CommentTok{\# bin\_Spectra \textless{}{-} function(object1, object2, binSize = 1L,}
\CommentTok{\#                         breaks = seq(floor(min(c(mz(object1), mz(object2)))),}
\CommentTok{\#                                      ceiling(max(c(mz(object1), mz(object2)))),}
\CommentTok{\#                                      by = binSize)) \{}
\CommentTok{\#     breaks \textless{}{-} .fix\_breaks(breaks, range(mz(object1), mz(object2)))}
\CommentTok{\#     list(bin\_Spectrum(object1, breaks = breaks),}
\CommentTok{\#          bin\_Spectrum(object2, breaks = breaks))}
\CommentTok{\# \}}

\CommentTok{\# bin\_Spectrum \textless{}{-} function(object, binSize = 1L,}
\CommentTok{\#                          breaks = seq(floor(min(mz(object))),}
\CommentTok{\#                                       ceiling(max(mz(object))),}
\CommentTok{\#                                       by = binSize),}
\CommentTok{\#                          fun = sum,}
\CommentTok{\#                          msLevel.) \{}
\CommentTok{\#     \#\# If msLevel. not missing, perform the trimming only if the msLevel}
\CommentTok{\#     \#\# of the spectrum matches (any of) the specified msLevels.}
\CommentTok{\#     if (!missing(msLevel.)) \{}
\CommentTok{\#         if (!(msLevel(object) \%in\% msLevel.))}
\CommentTok{\#             return(object)}
\CommentTok{\#     \}}
\CommentTok{\#     bins \textless{}{-} .bin\_values(object@intensity, object@mz, binSize = binSize,}
\CommentTok{\#                         breaks = breaks, fun = fun)}
\CommentTok{\#     object@mz \textless{}{-} bins$mids}
\CommentTok{\#     object@intensity \textless{}{-} bins$x}
\CommentTok{\#     object@tic \textless{}{-} sum(object@intensity)}
\CommentTok{\#     object@peaksCount \textless{}{-} length(object@mz)}
\CommentTok{\#     if (validObject(object))}
\CommentTok{\#         return(object)}
\CommentTok{\# \}}

\CommentTok{\# \#\textquotesingle{} The function aggregates \textasciigrave{}x\textasciigrave{} for \textasciigrave{}toBin\textasciigrave{} falling into bins defined}
\CommentTok{\# \#\textquotesingle{} by \textasciigrave{}breaks\textasciigrave{} using the \textasciigrave{}fun\textasciigrave{} function.}
\CommentTok{\# \#\textquotesingle{}}
\CommentTok{\# \#\textquotesingle{} @details}
\CommentTok{\# \#\textquotesingle{}}
\CommentTok{\# \#\textquotesingle{} This is a combination of the code from the former bin\_Spectrum.}
\CommentTok{\# \#\textquotesingle{}}
\CommentTok{\# \#\textquotesingle{} @param x \textasciigrave{}numeric\textasciigrave{} with the values that should be binned.}
\CommentTok{\# \#\textquotesingle{}}
\CommentTok{\# \#\textquotesingle{} @param toBin \textasciigrave{}numeric\textasciigrave{}, same length than \textasciigrave{}x\textasciigrave{}, with values to be used for the}
\CommentTok{\# \#\textquotesingle{}     binning.}
\CommentTok{\# \#\textquotesingle{}}
\CommentTok{\# \#\textquotesingle{} @param binSize \textasciigrave{}numeric(1)\textasciigrave{} with the size of the bins.}
\CommentTok{\# \#\textquotesingle{}}
\CommentTok{\# \#\textquotesingle{} @param breaks \textasciigrave{}numeric\textasciigrave{} defining the breaks/bins.}
\CommentTok{\# \#\textquotesingle{}}
\CommentTok{\# \#\textquotesingle{} @param fun \textasciigrave{}function\textasciigrave{} to be used to aggregate values of \textasciigrave{}x\textasciigrave{} falling into the}
\CommentTok{\# \#\textquotesingle{}     bins defined by \textasciigrave{}breaks\textasciigrave{}.}
\CommentTok{\# \#\textquotesingle{}}
\CommentTok{\# \#\textquotesingle{} @return \textasciigrave{}list\textasciigrave{} with elements \textasciigrave{}x\textasciigrave{} and \textasciigrave{}mids\textasciigrave{} being the aggregated values}
\CommentTok{\# \#\textquotesingle{}     of \textasciigrave{}x\textasciigrave{} for values in \textasciigrave{}toBin\textasciigrave{} falling within each bin and the bin mid}
\CommentTok{\# \#\textquotesingle{}     points.}
\CommentTok{\# \#\textquotesingle{}}
\CommentTok{\# \#\textquotesingle{} @author Johannes Rainer, Sebastian Gibb}
\CommentTok{\# \#\textquotesingle{}}
\CommentTok{\# \#\textquotesingle{} @noRd}
\CommentTok{\# .bin\_values \textless{}{-} function(x, toBin, binSize = 1, breaks = seq(floor(min(toBin)),}
\CommentTok{\#                                                             ceiling(max(toBin)),}
\CommentTok{\#                                                             by = binSize),}
\CommentTok{\#                         fun = max) \{}
\CommentTok{\#     if (length(x) != length(toBin))}
\CommentTok{\#         stop("lengths of \textquotesingle{}x\textquotesingle{} and \textquotesingle{}toBin\textquotesingle{} have to match.")}
\CommentTok{\#     fun \textless{}{-} match.fun(fun)}
\CommentTok{\#     breaks \textless{}{-} .fix\_breaks(breaks, range(toBin))}
\CommentTok{\#     nbrks \textless{}{-} length(breaks)}
\CommentTok{\#     idx \textless{}{-} findInterval(toBin, breaks)}
\CommentTok{\#     \#\# Ensure that indices are within breaks.}
\CommentTok{\#     idx[which(idx \textless{} 1L)] \textless{}{-} 1L}
\CommentTok{\#     idx[which(idx \textgreater{}= nbrks)] \textless{}{-} nbrks {-} 1L}

\CommentTok{\#     ints \textless{}{-} double(nbrks {-} 1L)}
\CommentTok{\#     ints[unique(idx)] \textless{}{-} unlist(lapply(base::split(x, idx), fun),}
\CommentTok{\#                                 use.names = FALSE)}
\CommentTok{\#     list(x = ints, mids = (breaks[{-}nbrks] + breaks[{-}1L]) / 2L)}
\CommentTok{\# \}}



\CommentTok{\# \#\textquotesingle{} calculate the dot product between two vectors}
\CommentTok{\# \#\textquotesingle{}}
\CommentTok{\# \#\textquotesingle{} Stein, S. E., and Scott, D. R. (1994).}
\CommentTok{\# \#\textquotesingle{} Optimization and testing of mass spectral library search algorithms for}
\CommentTok{\# \#\textquotesingle{} compound identification.}
\CommentTok{\# \#\textquotesingle{} Journal of the American Society for Mass Spectrometry, 5(9), 859{-}866.}
\CommentTok{\# \#\textquotesingle{} doi: https://doi.org/10.1016/1044{-}0305(94)87009{-}8}
\CommentTok{\# \#\textquotesingle{}}
\CommentTok{\# \#\textquotesingle{} Lam, H., Deutsch, E. W., Eddes, J. S., Eng, J. K., King, N., Stein, S. E.}
\CommentTok{\# \#\textquotesingle{} and Aebersold, R. (2007)}
\CommentTok{\# \#\textquotesingle{} Development and validation of a spectral library searching method for peptide}
\CommentTok{\# \#\textquotesingle{} identification from MS/MS.}
\CommentTok{\# \#\textquotesingle{} Proteomics, 7: 655{-}667.}
\CommentTok{\# \#\textquotesingle{} doi: https://doi.org/10.1002/pmic.200600625}
\CommentTok{\# \#\textquotesingle{}}
\CommentTok{\# \#\textquotesingle{} @param x double}
\CommentTok{\# \#\textquotesingle{} @param y double}
\CommentTok{\# \#\textquotesingle{} @return double, length == 1}
\CommentTok{\# \#\textquotesingle{} @noRd}
\CommentTok{\# dotproduct \textless{}{-} function(x, y) \{}
\CommentTok{\#   as.vector(x \%*\% y) / (sqrt(sum(x*x)) * sqrt(sum(y*y)))}
\CommentTok{\# \}}



\CommentTok{\# \#\textquotesingle{} Simple function to ensure that breaks (for binning) are span al leat the}
\CommentTok{\# \#\textquotesingle{} expected range.}
\CommentTok{\# \#\textquotesingle{}}
\CommentTok{\# \#\textquotesingle{} @param brks \textasciigrave{}numeric\textasciigrave{} with *breaks* such as calculated by \textasciigrave{}seq\textasciigrave{}.}
\CommentTok{\# \#\textquotesingle{}}
\CommentTok{\# \#\textquotesingle{} @param rng \textasciigrave{}numeric(2)\textasciigrave{} with the range of original numeric values on which}
\CommentTok{\# \#\textquotesingle{}     the breaks were calculated.}
\CommentTok{\# \#\textquotesingle{}}
\CommentTok{\# \#\textquotesingle{} @noRd}
\CommentTok{\# .fix\_breaks \textless{}{-} function(brks, rng) \{}
\CommentTok{\#     \#\# Assuming breaks being sorted.}
\CommentTok{\#     if (brks[length(brks)] \textless{}= rng[2])}
\CommentTok{\#         brks \textless{}{-} c(brks, max((rng[2] + 1e{-}6),}
\CommentTok{\#                             brks[length(brks)] + mean(diff(brks))))}
\CommentTok{\#     brks}
\CommentTok{\# \}}

\CommentTok{\# \#\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} }

\CommentTok{\# numberOfCommonPeaks \textless{}{-} function(x, y, tolerance=25e{-}6, relative=TRUE) \{}
\CommentTok{\#   sum(commonPeaks(x, y, tolerance=tolerance, relative=relative))}
\CommentTok{\# \}}
\CommentTok{\# commonPeaks \textless{}{-} function(x, y, method=c("highest", "closest"),}
\CommentTok{\#                          tolerance=25e{-}6, relative=TRUE) \{}
\CommentTok{\#   m \textless{}{-} matchPeaks(x, y, method=match.arg(method), tolerance=tolerance,}
\CommentTok{\#                   relative=relative)}

\CommentTok{\#   m[which(is.na(m))] \textless{}{-} 0L}

\CommentTok{\#   as.logical(m)}
\CommentTok{\# \}}

\CommentTok{\# matchPeaks \textless{}{-} function(x, y, method=c("highest", "closest", "all"),}
\CommentTok{\#                        tolerance=25e{-}6, relative=TRUE) \{}
\CommentTok{\#   method \textless{}{-} match.arg(method)}

\CommentTok{\#   if (inherits(y, "Spectrum")) \{}
\CommentTok{\#     y \textless{}{-} mz(y)}
\CommentTok{\#   \}}

\CommentTok{\#   if (peaksCount(x) == 0 || length(y) == 0) \{}
\CommentTok{\#     return(integer(peaksCount(x)))}
\CommentTok{\#   \}}

\CommentTok{\#   m \textless{}{-} relaxedMatch(mz(x), y, nomatch=NA, tolerance=tolerance,}
\CommentTok{\#                     relative=relative)}

\CommentTok{\#   if (anyDuplicated(m)) \{}
\CommentTok{\#     if (method == "highest") \{}
\CommentTok{\#       o \textless{}{-} order(intensity(x), decreasing=TRUE)}
\CommentTok{\#     \} else if (method == "closest") \{}
\CommentTok{\#       o \textless{}{-} order(abs(mz(x){-}y[m]))}
\CommentTok{\#     \} else \{}
\CommentTok{\#       o \textless{}{-} 1:length(x)}
\CommentTok{\#     \}}
\CommentTok{\#     sortedMatches \textless{}{-} m[o]}

\CommentTok{\#     if (method != "all") \{}
\CommentTok{\#       sortedMatches[which(duplicated(sortedMatches))] \textless{}{-} NA}
\CommentTok{\#     \}}
\CommentTok{\#     m[o] \textless{}{-} sortedMatches}
\CommentTok{\#   \}}

\CommentTok{\#   as.integer(m)}
\CommentTok{\# \}}

\CommentTok{\# relaxedMatch \textless{}{-} function(x, table, nomatch=NA\_integer\_, tolerance=25e{-}6,}
\CommentTok{\#                          relative=TRUE) \{}

\CommentTok{\#   if (relative) \{}
\CommentTok{\#     if (tolerance \textgreater{} 1L) \{}
\CommentTok{\#       stop(sQuote("tolerance"),}
\CommentTok{\#            " must be smaller than 1 for relative deviations.")}
\CommentTok{\#     \}}
\CommentTok{\#     tolerance \textless{}{-} table*tolerance}
\CommentTok{\#   \}}

\CommentTok{\#   match.closest(x, table, tolerance=tolerance, nomatch=nomatch)}
\CommentTok{\# \}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-test_mcnebula2.r}{%
\section{File: TEST\_mcnebula2.R}\label{file-test_mcnebula2.r}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{setwd}\NormalTok{(}\StringTok{"\textasciitilde{}/operation/sirius.mcn"}\NormalTok{)}
\CommentTok{\# library(MCnebula2)}
\NormalTok{mcn }\OtherTok{\textless{}{-}} \FunctionTok{initialize\_mcnebula}\NormalTok{(}\FunctionTok{mcnebula}\NormalTok{())}

\NormalTok{mcn1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(mcn)}
\NormalTok{mcn1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(mcn1)}
\NormalTok{mcn1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(mcn1, }\AttributeTok{by\_reference=}\NormalTok{T)}

\NormalTok{mcn1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_stardust\_classes}\NormalTok{(mcn1)}
\NormalTok{mcn1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_features\_annotation}\NormalTok{(mcn1)}
\NormalTok{mcn1 }\OtherTok{\textless{}{-}} \FunctionTok{cross\_filter\_stardust}\NormalTok{(mcn1, }\DecValTok{5}\NormalTok{, }\DecValTok{1}\NormalTok{)}

\NormalTok{ids }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(}\FunctionTok{features\_annotation}\NormalTok{(mcn1)}\SpecialCharTok{$}\NormalTok{.features\_id, }\DecValTok{8}\NormalTok{)}
\NormalTok{mcn1 }\OtherTok{\textless{}{-}} \FunctionTok{draw\_structures}\NormalTok{(mcn1, }\AttributeTok{.features\_id =}\NormalTok{ ids)}
\CommentTok{\# plot\_msms\_mirrors(mcn1, ids)}

\NormalTok{mcn1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_nebula\_index}\NormalTok{(mcn1)}
\NormalTok{mcn1 }\OtherTok{\textless{}{-}} \FunctionTok{compute\_spectral\_similarity}\NormalTok{(mcn1)}
\NormalTok{mcn1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_parent\_nebula}\NormalTok{(mcn1, }\FloatTok{0.01}\NormalTok{, }\DecValTok{5}\NormalTok{, T)}
\NormalTok{mcn1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_nebulae}\NormalTok{(mcn1, }\FloatTok{0.01}\NormalTok{, }\DecValTok{5}\NormalTok{)}

\NormalTok{mcn1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_parent\_layout}\NormalTok{(mcn1)}
\NormalTok{mcn1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_layouts}\NormalTok{(mcn1)}
\NormalTok{mcn1 }\OtherTok{\textless{}{-}} \FunctionTok{activate\_nebulae}\NormalTok{(mcn1)}

\FunctionTok{pdf}\NormalTok{(}\StringTok{"instance.pdf"}\NormalTok{, }\AttributeTok{width =} \DecValTok{8}\NormalTok{, }\AttributeTok{height =} \FloatTok{8.5}\NormalTok{)}
\FunctionTok{visualize\_all}\NormalTok{(mcn1)}
\FunctionTok{dev.off}\NormalTok{()}

\NormalTok{pdftools}\SpecialCharTok{::}\FunctionTok{pdf\_convert}\NormalTok{(}\StringTok{"instance.pdf"}\NormalTok{, }\AttributeTok{dpi =} \DecValTok{150}\NormalTok{)}

\NormalTok{re }\OtherTok{\textless{}{-}} \FunctionTok{history\_rblock}\NormalTok{(, }\StringTok{"initialize\_mcnebula}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{("}\NormalTok{, }\StringTok{"activate\_nebulae}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{("}\NormalTok{)}

\NormalTok{mcn1 }\OtherTok{\textless{}{-}} \FunctionTok{.simulate\_quant\_set}\NormalTok{(mcn1)}
\NormalTok{mcn1 }\OtherTok{\textless{}{-}} \FunctionTok{set\_ppcp\_data}\NormalTok{(mcn1)}
\NormalTok{mcn1 }\OtherTok{\textless{}{-}} \FunctionTok{set\_ration\_data}\NormalTok{(mcn1)}
\NormalTok{mcn1 }\OtherTok{\textless{}{-}} \FunctionTok{binary\_comparison}\NormalTok{(mcn1, control }\SpecialCharTok{{-}}\NormalTok{ model,}
\NormalTok{                           model }\SpecialCharTok{{-}}\NormalTok{ control, }\DecValTok{2} \SpecialCharTok{*}\NormalTok{ model }\SpecialCharTok{{-}}\NormalTok{ control)}

\NormalTok{mcn1 }\OtherTok{\textless{}{-}} \FunctionTok{draw\_structures}\NormalTok{(mcn1, }\StringTok{"Fatty Acyls"}\NormalTok{)}
\NormalTok{mcn1 }\OtherTok{\textless{}{-}} \FunctionTok{draw\_nodes}\NormalTok{(mcn1, }\StringTok{"Fatty Acyls"}\NormalTok{)}
\NormalTok{mcn1 }\OtherTok{\textless{}{-}} \FunctionTok{annotate\_nebula}\NormalTok{(mcn1, }\StringTok{"Fatty Acyls"}\NormalTok{)}
\FunctionTok{visualize}\NormalTok{(mcn1, }\StringTok{"Fatty Acyls"}\NormalTok{, }\AttributeTok{annotate =}\NormalTok{ T)}

\CommentTok{\# pdf("child\_nebulae.pdf", width = 10, height = 12)}
\CommentTok{\# visualize\_all(mcn1)}
\CommentTok{\# dev.off()}

\NormalTok{des }\OtherTok{\textless{}{-}} \StringTok{"see Table }\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{\ref{tab:table1}"}
\NormalTok{re }\OtherTok{\textless{}{-}} \FunctionTok{new\_report}\NormalTok{(}\AttributeTok{yaml =} \FunctionTok{.yaml\_default}\NormalTok{(}\StringTok{"de"}\NormalTok{),}
                 \FunctionTok{document\_mc\_workflow}\NormalTok{(}\StringTok{"abstract"}\NormalTok{),}
                 \FunctionTok{document\_mc\_workflow}\NormalTok{(}\StringTok{"introduction"}\NormalTok{),}
                 \FunctionTok{document\_mc\_workflow}\NormalTok{(}\StringTok{"setup"}\NormalTok{),}
                 \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"analysis"}\NormalTok{, }\DecValTok{1}\NormalTok{),}
                 \FunctionTok{new\_section}\NormalTok{(}\StringTok{"step1"}\NormalTok{),}
                 \FunctionTok{new\_section}\NormalTok{(}\StringTok{"step2"}\NormalTok{),}
                 \FunctionTok{new\_heading}\NormalTok{(}\StringTok{"statistic"}\NormalTok{, }\DecValTok{1}\NormalTok{),}
                 \FunctionTok{new\_section}\NormalTok{(}\ConstantTok{NULL}\NormalTok{, }\AttributeTok{paragraph =} \StringTok{"the flowing is figure..."}\NormalTok{),}
                 \FunctionTok{new\_section}\NormalTok{(}\ConstantTok{NULL}\NormalTok{, }\AttributeTok{paragraph =}\NormalTok{ des),}
                 \CommentTok{\# include\_figure("child\_8.pdf", "plot1", "child{-}nebulae"),}
                 \CommentTok{\# include\_table(df, "table1", "top features"),}
                 \FunctionTok{new\_section}\NormalTok{(}\ConstantTok{NULL}\NormalTok{, }\AttributeTok{code\_block =}
                             \FunctionTok{new\_code\_block}\NormalTok{(}\AttributeTok{codes =} \StringTok{"re"}\NormalTok{))}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-test_test_pkg.r}{%
\section{File: TEST\_test\_pkg.R}\label{file-test_test_pkg.r}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{setwd}\NormalTok{(}\StringTok{"\textasciitilde{}/MCnebula2"}\NormalTok{)}
\NormalTok{devtools}\SpecialCharTok{::}\FunctionTok{check}\NormalTok{()}
\NormalTok{devtools}\SpecialCharTok{::}\FunctionTok{install}\NormalTok{()}
\NormalTok{devtools}\SpecialCharTok{::}\FunctionTok{test}\NormalTok{()}
\NormalTok{usethis}\SpecialCharTok{::}\FunctionTok{use\_package}\NormalTok{(}\StringTok{"methods"}\NormalTok{)}
\NormalTok{usethis}\SpecialCharTok{::}\FunctionTok{use\_test}\NormalTok{(}\StringTok{"baseWorkflow.R"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-utools_external_collate_evaluation.r}{%
\section{File: utools\_external\_collate\_evaluation.R}\label{file-utools_external_collate_evaluation.r}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{Sys.time}\NormalTok{()}
\CommentTok{\# [1] "2023{-}01{-}30 14:44:43 CST"}
\FunctionTok{Sys.info}\NormalTok{()}
\CommentTok{\#                                                            sysname }
\CommentTok{\#                                                            "Linux" }
\CommentTok{\#                                                            release }
\CommentTok{\#                                          "5.17.5{-}76051705{-}generic" }
\CommentTok{\#                                                            version }
\CommentTok{\# "\#202204271406\textasciitilde{}1653440576\textasciitilde{}22.04\textasciitilde{}6277a18 SMP PREEMPT Wed May 25 01" }
\CommentTok{\#                                                           nodename }
\CommentTok{\#                                                           "pop{-}os" }
\CommentTok{\#                                                            machine }
\CommentTok{\#                                                           "x86\_64" }
\CommentTok{\#                                                              login }
\CommentTok{\#                                                             "echo" }
\CommentTok{\#                                                               user }
\CommentTok{\#                                                             "echo" }
\CommentTok{\#                                                     effective\_user }
\CommentTok{\#                                                             "echo" }

\NormalTok{devtools}\SpecialCharTok{::}\FunctionTok{load\_all}\NormalTok{(}\StringTok{"\textasciitilde{}/MCnebula2"}\NormalTok{)}

\NormalTok{dirs }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \StringTok{"/media/echo/DATA/yellow/iso\_gnps\_pos"}\NormalTok{,}
  \StringTok{"/media/echo/DATA/yellow/noise\_gnps\_pos"}\NormalTok{,}
  \StringTok{"/media/echo/DATA/yellow/h\_noise\_gnps\_pos"}
\NormalTok{)}

\NormalTok{lst }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(dirs,}
  \ControlFlowTok{function}\NormalTok{(dir) \{}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{mcnebula}\NormalTok{()}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{initialize\_mcnebula}\NormalTok{(mcn, }\StringTok{"sirius.v4"}\NormalTok{, dir)}
\NormalTok{    mcn }\OtherTok{\textless{}{-}} \FunctionTok{collate\_used}\NormalTok{(mcn)}
    \DocumentationTok{\#\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} decrease size}
    \DocumentationTok{\#\# structure}
\NormalTok{    df }\OtherTok{\textless{}{-}} \FunctionTok{entity}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(mcn))[[ }\StringTok{".f3\_fingerid"}\NormalTok{ ]])}
\NormalTok{    df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(df, }\AttributeTok{links =} \FunctionTok{character}\NormalTok{(}\DecValTok{1}\NormalTok{), }\AttributeTok{pubmed.ids =} \FunctionTok{character}\NormalTok{(}\DecValTok{1}\NormalTok{))}
\NormalTok{    df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate\_if}\NormalTok{(df, is.numeric, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{round}\NormalTok{(x, }\DecValTok{2}\NormalTok{))}
    \FunctionTok{entity}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(mcn))[[ }\StringTok{".f3\_fingerid"}\NormalTok{ ]]) }\OtherTok{\textless{}{-}}\NormalTok{ df}
    \DocumentationTok{\#\# formula}
\NormalTok{    df2 }\OtherTok{\textless{}{-}} \FunctionTok{entity}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(mcn))[[ }\StringTok{".f2\_formula"}\NormalTok{ ]])}
\NormalTok{    df2 }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate\_if}\NormalTok{(df2, is.numeric, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{round}\NormalTok{(x, }\DecValTok{2}\NormalTok{))}
    \FunctionTok{entity}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(mcn))[[ }\StringTok{".f2\_formula"}\NormalTok{ ]]) }\OtherTok{\textless{}{-}}\NormalTok{ df2}
    \DocumentationTok{\#\# class}
\NormalTok{    df3 }\OtherTok{\textless{}{-}} \FunctionTok{entity}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(mcn))[[ }\StringTok{".f3\_canopus"}\NormalTok{ ]])}
\NormalTok{    df3 }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate\_if}\NormalTok{(df3, is.numeric, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{round}\NormalTok{(x, }\DecValTok{2}\NormalTok{))}
\NormalTok{    df3 }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(df3, }\AttributeTok{description =} \FunctionTok{character}\NormalTok{(}\DecValTok{1}\NormalTok{),}
      \AttributeTok{rel.index =} \FunctionTok{as.integer}\NormalTok{(rel.index))}
    \FunctionTok{entity}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(mcn))[[ }\StringTok{".f3\_canopus"}\NormalTok{ ]]) }\OtherTok{\textless{}{-}}\NormalTok{ df3}
\NormalTok{    mcn}
\NormalTok{  \})}

\FunctionTok{names}\NormalTok{(lst) }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{""}\NormalTok{, }\StringTok{"median\_noise\_"}\NormalTok{, }\StringTok{"high\_noise\_"}\NormalTok{), }\StringTok{"gnps\_pos.rdata"}\NormalTok{)}

\FunctionTok{format}\NormalTok{(}\FunctionTok{object.size}\NormalTok{(lst), }\AttributeTok{units =} \StringTok{"MB"}\NormalTok{)}
\DocumentationTok{\#\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} save}

\FunctionTok{lapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(lst),}
  \ControlFlowTok{function}\NormalTok{(name) \{}
\NormalTok{    mcn }\OtherTok{\textless{}{-}}\NormalTok{ lst[[ name ]]}
    \FunctionTok{save}\NormalTok{(mcn, }\AttributeTok{file =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"\textasciitilde{}/utils.tool/inst/extdata/evaluation/"}\NormalTok{, name))}
\NormalTok{  \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-utools_external_collate_herbal.r}{%
\section{File: utools\_external\_collate\_herbal.R}\label{file-utools_external_collate_herbal.r}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{Sys.time}\NormalTok{()}
\CommentTok{\# [1] "2023{-}01{-}02 15:33:34 CST"}
\FunctionTok{Sys.info}\NormalTok{()}
\CommentTok{\#                                                            sysname }
\CommentTok{\#                                                            "Linux" }
\CommentTok{\#                                                            release }
\CommentTok{\#                                          "5.17.5{-}76051705{-}generic" }
\CommentTok{\#                                                            version }
\CommentTok{\# "\#202204271406\textasciitilde{}1653440576\textasciitilde{}22.04\textasciitilde{}6277a18 SMP PREEMPT Wed May 25 01" }
\CommentTok{\#                                                           nodename }
\CommentTok{\#                                                           "pop{-}os" }
\CommentTok{\#                                                            machine }
\CommentTok{\#                                                           "x86\_64" }
\CommentTok{\#                                                              login }
\CommentTok{\#                                                             "echo" }
\CommentTok{\#                                                               user }
\CommentTok{\#                                                             "echo" }
\CommentTok{\#                                                     effective\_user }
\CommentTok{\#                                                             "echo" }

\NormalTok{devtools}\SpecialCharTok{::}\FunctionTok{load\_all}\NormalTok{(}\StringTok{"\textasciitilde{}/MCnebula2"}\NormalTok{)}
\NormalTok{mcn\_herbal }\OtherTok{\textless{}{-}} \FunctionTok{mcnebula}\NormalTok{()}
\NormalTok{mcn\_herbal }\OtherTok{\textless{}{-}} \FunctionTok{initialize\_mcnebula}\NormalTok{(mcn\_herbal, }\StringTok{"sirius.v4"}\NormalTok{, }\StringTok{"/media/echo/DATA/yellow/eucommia/neg/"}\NormalTok{)}
\NormalTok{mcn\_herbal }\OtherTok{\textless{}{-}} \FunctionTok{collate\_used}\NormalTok{(mcn\_herbal)}
\CommentTok{\# latest(mcn\_herbal, , ".f2\_formula")}

\DocumentationTok{\#\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} decrease size}
\DocumentationTok{\#\# structure}
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{entity}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(mcn\_herbal))[[ }\StringTok{".f3\_fingerid"}\NormalTok{ ]])}
\NormalTok{df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(df, }\AttributeTok{links =} \FunctionTok{character}\NormalTok{(}\DecValTok{1}\NormalTok{), }\AttributeTok{pubmed.ids =} \FunctionTok{character}\NormalTok{(}\DecValTok{1}\NormalTok{))}
\NormalTok{df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate\_if}\NormalTok{(df, is.numeric, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{round}\NormalTok{(x, }\DecValTok{2}\NormalTok{))}
\FunctionTok{entity}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(mcn\_herbal))[[ }\StringTok{".f3\_fingerid"}\NormalTok{ ]]) }\OtherTok{\textless{}{-}}\NormalTok{ df}

\DocumentationTok{\#\# formula}
\NormalTok{df2 }\OtherTok{\textless{}{-}} \FunctionTok{entity}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(mcn\_herbal))[[ }\StringTok{".f2\_formula"}\NormalTok{ ]])}
\NormalTok{df2 }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate\_if}\NormalTok{(df2, is.numeric, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{round}\NormalTok{(x, }\DecValTok{2}\NormalTok{))}
\FunctionTok{entity}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(mcn\_herbal))[[ }\StringTok{".f2\_formula"}\NormalTok{ ]]) }\OtherTok{\textless{}{-}}\NormalTok{ df2}

\DocumentationTok{\#\# class}
\NormalTok{df3 }\OtherTok{\textless{}{-}} \FunctionTok{entity}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(mcn\_herbal))[[ }\StringTok{".f3\_canopus"}\NormalTok{ ]])}
\NormalTok{df3 }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate\_if}\NormalTok{(df3, is.numeric, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{round}\NormalTok{(x, }\DecValTok{2}\NormalTok{))}
\NormalTok{df3 }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(df3, }\AttributeTok{description =} \FunctionTok{character}\NormalTok{(}\DecValTok{1}\NormalTok{),}
                     \AttributeTok{rel.index =} \FunctionTok{as.integer}\NormalTok{(rel.index))}
\FunctionTok{entity}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(mcn\_herbal))[[ }\StringTok{".f3\_canopus"}\NormalTok{ ]]) }\OtherTok{\textless{}{-}}\NormalTok{ df3}

\DocumentationTok{\#\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} save}
\NormalTok{mcn\_herbal1612 }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_herbal}
\FunctionTok{format}\NormalTok{(}\FunctionTok{object.size}\NormalTok{(mcn\_herbal1612), }\AttributeTok{units =} \StringTok{"MB"}\NormalTok{)}
\FunctionTok{save}\NormalTok{(mcn\_herbal1612, }\AttributeTok{file =} \StringTok{"\textasciitilde{}/utils.tool/inst/extdata/mcn\_herbal1612.rdata"}\NormalTok{)}
\CommentTok{\# load("\textasciitilde{}/utils.tool/inst/extdata/mcn\_herbal1612.rdata")}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-utools_external_collate_serum.r}{%
\section{File: utools\_external\_collate\_serum.R}\label{file-utools_external_collate_serum.r}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{Sys.time}\NormalTok{()}
\CommentTok{\# [1] "2022{-}12{-}12 14:56:25 CST"}
\FunctionTok{Sys.info}\NormalTok{()}
\CommentTok{\#                                                            sysname }
\CommentTok{\#                                                            "Linux" }
\CommentTok{\#                                                            release }
\CommentTok{\#                                          "5.17.5{-}76051705{-}generic" }
\CommentTok{\#                                                            version }
\CommentTok{\# "\#202204271406\textasciitilde{}1653440576\textasciitilde{}22.04\textasciitilde{}6277a18 SMP PREEMPT Wed May 25 01" }
\CommentTok{\#                                                           nodename }
\CommentTok{\#                                                           "pop{-}os" }
\CommentTok{\#                                                            machine }
\CommentTok{\#                                                           "x86\_64" }
\CommentTok{\#                                                              login }
\CommentTok{\#                                                             "echo" }
\CommentTok{\#                                                               user }
\CommentTok{\#                                                             "echo" }
\CommentTok{\#                                                     effective\_user }
\CommentTok{\#                                                             "echo" }

\NormalTok{devtools}\SpecialCharTok{::}\FunctionTok{load\_all}\NormalTok{(}\StringTok{"\textasciitilde{}/MCnebula2"}\NormalTok{)}
\NormalTok{mcn\_serum }\OtherTok{\textless{}{-}} \FunctionTok{mcnebula}\NormalTok{()}
\NormalTok{mcn\_serum }\OtherTok{\textless{}{-}} \FunctionTok{initialize\_mcnebula}\NormalTok{(mcn\_serum, }\StringTok{"sirius.v4"}\NormalTok{, }\StringTok{"/media/echo/DATA/yellow/massive/cell/massive.ucsd.edu/MSV000083593/ccms\_peak/mzXML/mcnebula2/serum"}\NormalTok{)}
\NormalTok{mcn\_serum }\OtherTok{\textless{}{-}} \FunctionTok{collate\_used}\NormalTok{(mcn\_serum)}
\CommentTok{\# latest(mcn\_serum, , ".f2\_formula")}

\DocumentationTok{\#\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} decrease size}
\DocumentationTok{\#\# structure}
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{entity}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(mcn\_serum))[[ }\StringTok{".f3\_fingerid"}\NormalTok{ ]])}
\NormalTok{df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(df, }\AttributeTok{links =} \FunctionTok{character}\NormalTok{(}\DecValTok{1}\NormalTok{), }\AttributeTok{pubmed.ids =} \FunctionTok{character}\NormalTok{(}\DecValTok{1}\NormalTok{))}
\NormalTok{df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate\_if}\NormalTok{(df, is.numeric, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{round}\NormalTok{(x, }\DecValTok{2}\NormalTok{))}
\FunctionTok{entity}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(mcn\_serum))[[ }\StringTok{".f3\_fingerid"}\NormalTok{ ]]) }\OtherTok{\textless{}{-}}\NormalTok{ df}

\DocumentationTok{\#\# formula}
\NormalTok{df2 }\OtherTok{\textless{}{-}} \FunctionTok{entity}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(mcn\_serum))[[ }\StringTok{".f2\_formula"}\NormalTok{ ]])}
\NormalTok{df2 }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate\_if}\NormalTok{(df2, is.numeric, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{round}\NormalTok{(x, }\DecValTok{2}\NormalTok{))}
\FunctionTok{entity}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(mcn\_serum))[[ }\StringTok{".f2\_formula"}\NormalTok{ ]]) }\OtherTok{\textless{}{-}}\NormalTok{ df2}

\DocumentationTok{\#\# class}
\NormalTok{df3 }\OtherTok{\textless{}{-}} \FunctionTok{entity}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(mcn\_serum))[[ }\StringTok{".f3\_canopus"}\NormalTok{ ]])}
\NormalTok{df3 }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate\_if}\NormalTok{(df3, is.numeric, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{round}\NormalTok{(x, }\DecValTok{2}\NormalTok{))}
\NormalTok{df3 }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(df3, }\AttributeTok{description =} \FunctionTok{character}\NormalTok{(}\DecValTok{1}\NormalTok{),}
                     \AttributeTok{rel.index =} \FunctionTok{as.integer}\NormalTok{(rel.index))}
\FunctionTok{entity}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(mcn\_serum))[[ }\StringTok{".f3\_canopus"}\NormalTok{ ]]) }\OtherTok{\textless{}{-}}\NormalTok{ df3}

\DocumentationTok{\#\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} save}
\NormalTok{mcn\_serum6501 }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_serum}
\FunctionTok{format}\NormalTok{(}\FunctionTok{object.size}\NormalTok{(mcn\_serum6501), }\AttributeTok{units =} \StringTok{"MB"}\NormalTok{)}
\FunctionTok{save}\NormalTok{(mcn\_serum6501, }\AttributeTok{file =} \StringTok{"\textasciitilde{}/utils.tool/inst/extdata/mcn\_serum6501.rdata"}\NormalTok{)}
\CommentTok{\# load("\textasciitilde{}/utils.tool/inst/extdata/mcn\_serum6501.rdata")}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-utools_external_mcn.r}{%
\section{File: utools\_external\_mcn.R}\label{file-utools_external_mcn.r}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{test }\OtherTok{\textless{}{-}}\NormalTok{ mcn\_5features}

\NormalTok{e1 }\OtherTok{\textless{}{-}} \FunctionTok{substitute}\NormalTok{(\{}
\NormalTok{  test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(test)}
\NormalTok{  test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(test1)}
\NormalTok{  test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(test1, }\AttributeTok{by\_reference=}\NormalTok{T)}
\NormalTok{  test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_stardust\_classes}\NormalTok{(test1)}
\NormalTok{  test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_features\_annotation}\NormalTok{(test1)}
\NormalTok{\})}
\FunctionTok{eval}\NormalTok{(e1)}

\NormalTok{toAnno }\OtherTok{\textless{}{-}}\NormalTok{ test1}
\FunctionTok{save}\NormalTok{(toAnno5, }\StringTok{"\textasciitilde{}/utils.tool/inst/extdata/toAnno5.rdata"}\NormalTok{)}

\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{cross\_filter\_stardust}\NormalTok{(test1, }\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_nebula\_index}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{compute\_spectral\_similarity}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_parent\_nebula}\NormalTok{(test1, }\FloatTok{0.01}\NormalTok{, T)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_nebulae}\NormalTok{(test1, }\FloatTok{0.01}\NormalTok{, }\DecValTok{5}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_parent\_layout}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_layouts}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{activate\_nebulae}\NormalTok{(test1)}

\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{.simulate\_quant\_set}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{set\_ppcp\_data}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{set\_ration\_data}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{binary\_comparison}\NormalTok{(test1, control }\SpecialCharTok{{-}}\NormalTok{ model,}
\NormalTok{                           model }\SpecialCharTok{{-}}\NormalTok{ control, }\DecValTok{2} \SpecialCharTok{*}\NormalTok{ model }\SpecialCharTok{{-}}\NormalTok{ control)}

\NormalTok{toBinary5 }\OtherTok{\textless{}{-}}\NormalTok{ test1}
\FunctionTok{save}\NormalTok{(toBinary5, }\AttributeTok{file =} \StringTok{"\textasciitilde{}/utils.tool/inst/extdata/toBinary5.rdata"}\NormalTok{)}

\CommentTok{\# test1 \textless{}{-} draw\_structures(test1, "Fatty Acyls")}
\CommentTok{\# test1 \textless{}{-} draw\_nodes(test1, "Fatty Acyls")}
\CommentTok{\# test1 \textless{}{-} annotate\_nebula(test1, "Fatty Acyls")}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# 30 features}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\FunctionTok{setwd}\NormalTok{(}\StringTok{"\textasciitilde{}/operation/sirius.test"}\NormalTok{)}

\NormalTok{test }\OtherTok{\textless{}{-}} \FunctionTok{initialize\_mcnebula}\NormalTok{(}\FunctionTok{mcnebula}\NormalTok{())}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(test)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(test1, }\AttributeTok{by\_reference=}\NormalTok{T)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_stardust\_classes}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_features\_annotation}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{cross\_filter\_stardust}\NormalTok{(test1, }\DecValTok{5}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_nebula\_index}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{compute\_spectral\_similarity}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_parent\_nebula}\NormalTok{(test1, }\FloatTok{0.01}\NormalTok{, T)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_nebulae}\NormalTok{(test1, }\FloatTok{0.01}\NormalTok{, }\DecValTok{5}\NormalTok{)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_parent\_layout}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{create\_child\_layouts}\NormalTok{(test1)}
\NormalTok{test1 }\OtherTok{\textless{}{-}} \FunctionTok{activate\_nebulae}\NormalTok{(test1)}

\NormalTok{toActiv30 }\OtherTok{\textless{}{-}}\NormalTok{ test1}
\FunctionTok{save}\NormalTok{(toActiv30, }\AttributeTok{file =} \StringTok{"\textasciitilde{}/utils.tool/inst/extdata/toActiv30.rdata"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}


\end{document}
