% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\usepackage{caption} \captionsetup{font={footnotesize},width=6in} \renewcommand{\dblfloatpagefraction}{.9} \makeatletter \renewenvironment{figure} {\def\@captype{figure}} \makeatletter \definecolor{shadecolor}{RGB}{242,242,242} \usepackage{xeCJK} \usepackage{setspace} \setstretch{1.3}
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={Bash codes of `practice'},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{Bash codes of `practice'}
\author{}
\date{\vspace{-2.5em}}

\begin{document}
\maketitle

{
\setcounter{tocdepth}{3}
\tableofcontents
}
\hypertarget{file-back_eucommia_analysis.sh}{%
\section{File: back\_eucommia\_analysis.sh}\label{file-back_eucommia_analysis.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\# Similar{-}fragmentation{-}network based multidimensional data analysis}
\NormalTok{mzmine\_path}\OtherTok{=}\StringTok{"../0924\_neg\_RT.tsv.csv"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"results/0924\_neg\_RT.tsv"}
\NormalTok{version}\OtherTok{=}\ErrorTok{$}\NormalTok{(echo }\SpecialCharTok{|}\NormalTok{ awk }\StringTok{\textquotesingle{}\{l=asort(a,b);print l\}\textquotesingle{}}\NormalTok{)}
    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{$}\NormalTok{version }\SpecialCharTok{==} \DecValTok{0}\NormalTok{ ]}
\NormalTok{    then}
\NormalTok{    mzmine\_data}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F , }\StringTok{\textquotesingle{}}
\StringTok{        \{}
\StringTok{        if(NR==1)}
\StringTok{            \{}
\StringTok{            for(i=4; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                col\_sample[$i]=i}
\StringTok{                \}}
\StringTok{            l=asorti(col\_sample,b)}
\StringTok{            \textbackslash{}}
\StringTok{            printf $1 "}\SpecialCharTok{\textbackslash{}t}\StringTok{" $2 "}\SpecialCharTok{\textbackslash{}t}\StringTok{" $3}
\StringTok{            \textbackslash{}}
\StringTok{            for(i=1; i\textless{}l; i++)}
\StringTok{                \{}
\StringTok{                printf b[i] "}\SpecialCharTok{\textbackslash{}t}\StringTok{"}
\StringTok{                \}}
\StringTok{            printf b[l] "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{            \}}
\StringTok{        if(NR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            printf $1"}\SpecialCharTok{\textbackslash{}t}\StringTok{" $2"}\SpecialCharTok{\textbackslash{}t}\StringTok{" $3}
\StringTok{            \textbackslash{}}
\StringTok{            for(i=1; i\textless{}l; i++)}
\StringTok{                \{}
\StringTok{                printf $col\_sample[b[i]] "}\SpecialCharTok{\textbackslash{}t}\StringTok{"}
\StringTok{                \}}
\StringTok{            printf $col\_sample[b[l]] "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{mzmine\_path)}
\NormalTok{    echo }\StringTok{"$mzmine\_data"} \SpecialCharTok{\textgreater{}} \ErrorTok{$}\NormalTok{savepath}
\NormalTok{    fi;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{climit}\OtherTok{=}\StringTok{"0.95"}
\NormalTok{numlimit}\OtherTok{=}\StringTok{"0.2"}
\NormalTok{data1}\OtherTok{=}\StringTok{"results/canopus\_pp\_filter.tsv"}
\NormalTok{data2}\OtherTok{=}\StringTok{"r\_network/mzmine\_table.tsv"}
\NormalTok{compar1}\OtherTok{=}\StringTok{"Raw"}
\NormalTok{compar2}\OtherTok{=}\StringTok{"Pro"}
\NormalTok{log}\OtherTok{=}\DecValTok{10}
\NormalTok{log\_to}\OtherTok{=}\DecValTok{2}
\NormalTok{stat}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v }\AttributeTok{OFS=}\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==1)}
\StringTok{        \{}
\StringTok{        for(i=2; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            class[i]=$i}
\StringTok{            num[i]=0}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        for(i=2; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if($i\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{climit}\StringTok{\textquotesingle{})}
\StringTok{                \{}
\StringTok{                num[i]+=1;}
\StringTok{                id[i,NR]=$1;}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{    for(i=2; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{        p=num[i]/(NR{-}1)}
\StringTok{        \textbackslash{}}
\StringTok{        if(p\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{numlimit}\StringTok{\textquotesingle{}) \#}
\StringTok{            \{}
\StringTok{            printf class[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  num[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}
\StringTok{            \textbackslash{}}
\StringTok{            for(j=2; j\textless{}=NR; j++)}
\StringTok{                \{}
\StringTok{                if(id[i,j]!="")}
\StringTok{                    \{}
\StringTok{                    printf id[i,j]"@";}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{|}\NormalTok{ sed }\StringTok{\textquotesingle{}s/@$//g\textquotesingle{}}\NormalTok{)}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F [}\StringTok{"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}\SpecialCharTok{@}\NormalTok{] }\SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    BEGIN\{}
\StringTok{        maxNF=0}
\StringTok{        \textbackslash{}}
\StringTok{        rows=0}
\StringTok{        \textbackslash{}}
\StringTok{        compar1n=0}
\StringTok{        \textbackslash{}}
\StringTok{        compar2n=0}
\StringTok{        \}}
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        rows+=1}
\StringTok{        if(maxNF\textless{}NF)}
\StringTok{            \{}
\StringTok{            maxNF=NF}
\StringTok{            \}}
\StringTok{        class[FNR]=$1}
\StringTok{        \textbackslash{}}
\StringTok{        num[FNR]=$2}
\StringTok{        \textbackslash{}}
\StringTok{        for(j=3; j\textless{}=NF; j++)}
\StringTok{            \{}
\StringTok{            id[FNR,j]=$j}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    else}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if(($i\textasciitilde{}/\textquotesingle{}}\SpecialCharTok{$}\NormalTok{compar1}\StringTok{\textquotesingle{}/))}
\StringTok{                    \{}
\StringTok{                    colum1[i]=i}
\StringTok{                    compar1n+=1}
\StringTok{                    \}}
\StringTok{                if(($i\textasciitilde{}/\textquotesingle{}}\SpecialCharTok{$}\NormalTok{compar2}\StringTok{\textquotesingle{}/))}
\StringTok{                    \{}
\StringTok{                    colum2[i]=i}
\StringTok{                    compar2n+=1}
\StringTok{                    \}}
\StringTok{                if(($i\textasciitilde{}/retention/))}
\StringTok{                    \{}
\StringTok{                    rtcolum=i}
\StringTok{                    \}}
\StringTok{                if(($i\textasciitilde{}/m\textbackslash{}/z/))}
\StringTok{                    \{}
\StringTok{                    mzcolum=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            sum[1,$1]=0}
\StringTok{            \textbackslash{}}
\StringTok{            sum[2,$1]=0}
\StringTok{            \textbackslash{}}
\StringTok{            rt[$1]=$rtcolum}
\StringTok{            \textbackslash{}}
\StringTok{            mz[$1]=$mzcolum}
\StringTok{            \textbackslash{}}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if(i==colum1[i] \&\& colum1[i]!="")}
\StringTok{                    \{}
\StringTok{                    sum[1,$1]+=$i}
\StringTok{                    \}}
\StringTok{                if(i==colum2[i] \&\& colum2[i]!="")}
\StringTok{                    \{}
\StringTok{                    sum[2,$1]+=$i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        printf "class}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "log\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log}\StringTok{\textquotesingle{}\_raw}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "log\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log}\StringTok{\textquotesingle{}\_pro}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        "log\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log}\StringTok{\textquotesingle{}\_delta\_area}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "pro\_to\_raw}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "log\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log\_to}\StringTok{\textquotesingle{}\_pro\_to\_raw}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "variety}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "number}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{} "boxplot.tsv"}
\StringTok{        \textbackslash{}}
\StringTok{        printf "rt}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "m/z}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "boxplot.tsv"}
\StringTok{        \textbackslash{}}
\StringTok{        for(i=1; i\textless{}=rows; i++)}
\StringTok{            \{}
\StringTok{            for(j=3; j\textless{}=maxNF; j++)}
\StringTok{                \{}
\StringTok{                if(id[i,j]!="")}
\StringTok{                    \{}
\StringTok{                    raw=(sum[1,id[i,j]]/compar1n)}
\StringTok{                    \textbackslash{}}
\StringTok{                    pro=(sum[2,id[i,j]]/compar2n)}
\StringTok{                    \textbackslash{}}
\StringTok{                    log\_raw=log(raw)/log(\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log}\StringTok{\textquotesingle{})}
\StringTok{                    \textbackslash{}}
\StringTok{                    log\_pro=log(pro)/log(\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log}\StringTok{\textquotesingle{})}
\StringTok{                    \textbackslash{}}
\StringTok{                    delta\_area=pro{-}raw}
\StringTok{                    \textbackslash{}}
\StringTok{                    if(raw!=0)}
\StringTok{                        \{}
\StringTok{                        to\_raw=pro/raw}
\StringTok{                        \textbackslash{}}
\StringTok{                        norm\_to\_raw=log(to\_raw)/log(\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log\_to}\StringTok{\textquotesingle{})}
\StringTok{                        \}}
\StringTok{                    else}
\StringTok{                        \{}
\StringTok{                        to\_raw="infinity"}
\StringTok{                        \textbackslash{}}
\StringTok{                        norm\_to\_raw="infinity"}
\StringTok{                        \}}
\StringTok{                    if(delta\_area\textgreater{}0)}
\StringTok{                        \{}
\StringTok{                        norm\_delta=log(delta\_area)/log(\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log}\StringTok{\textquotesingle{})}
\StringTok{                        \textbackslash{}}
\StringTok{                        variety="increase"}
\StringTok{                        \}}
\StringTok{                    else if(delta\_area\textless{}0)}
\StringTok{                        \{}
\StringTok{                        norm\_delta={-}1*(log({-}1*delta\_area)/log(\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log}\StringTok{\textquotesingle{}))}
\StringTok{                        \textbackslash{}}
\StringTok{                        variety="decrease"}
\StringTok{                        \}}
\StringTok{                    else}
\StringTok{                        \{}
\StringTok{                        norm\_delta=0}
\StringTok{                        \}}
\StringTok{                    printf class[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  id[i,j]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  log\_raw"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  log\_pro"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                    \textbackslash{}}
\StringTok{                    norm\_delta"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  to\_raw"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  norm\_to\_raw"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  variety"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  num[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                    \textbackslash{}}
\StringTok{                    rt[id[i,j]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  mz[id[i,j]]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "boxplot.tsv"}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$stat"}\NormalTok{) }\SpecialCharTok{$}\NormalTok{data2}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{keywords\_1}\OtherTok{=}\StringTok{"lignans"}
\NormalTok{keywords\_2}\OtherTok{=}\StringTok{"iridoids"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==1)}
\StringTok{        \{}
\StringTok{        print "id","rt","m/z","classification","variety","pro/raw","log10\_raw","norm\_delta" \textgreater{} "lignans\_and\_iridoids.tsv"}
\StringTok{        \textbackslash{}}
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if($i\textasciitilde{}/\^{}id/)}
\StringTok{                \{}
\StringTok{                col\_id=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/\^{}rt/)}
\StringTok{                \{}
\StringTok{                col\_rt=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/m\textbackslash{}/z/)}
\StringTok{                \{}
\StringTok{                col\_mz=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/class/)}
\StringTok{                \{}
\StringTok{                col\_class=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/variety/)}
\StringTok{                \{}
\StringTok{                col\_variety=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/\^{}pro\_to\_raw/)}
\StringTok{                \{}
\StringTok{                col\_ratio=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/log10\_raw/)}
\StringTok{                \{}
\StringTok{                col\_log10\_raw=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/delta\_area/)}
\StringTok{                \{}
\StringTok{                col\_delta=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if((tolower($col\_class)\textasciitilde{}/\textquotesingle{}}\SpecialCharTok{$}\NormalTok{keywords\_1}\StringTok{\textquotesingle{}/) || (tolower($col\_class)\textasciitilde{}/\textquotesingle{}}\SpecialCharTok{$}\NormalTok{keywords\_2}\StringTok{\textquotesingle{}/))}
\StringTok{        \{}
\StringTok{        print $col\_id, $col\_rt, $col\_mz, $col\_class, $col\_variety, $col\_ratio, $col\_log10\_raw, $col\_delta \textgreater{}\textgreater{} "lignans\_and\_iridoids.tsv"}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}}\NormalTok{ boxplot.tsv}
\NormalTok{data}\OtherTok{=}\StringTok{"results/fingerid\_first\_score.tsv"}
\NormalTok{list}\OtherTok{=}\StringTok{"lignans\_and\_iridoids.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}  }
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/\^{}id/)}
\StringTok{                    \{}
\StringTok{                    col\_id=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/similarity/)}
\StringTok{                    \{}
\StringTok{                    col\_simi=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/name/)}
\StringTok{                    \{}
\StringTok{                    col\_name=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/formula/)}
\StringTok{                    \{}
\StringTok{                    col\_formula=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/\^{}inchi$/)}
\StringTok{                    \{}
\StringTok{                    col\_inchi=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/smiles/)}
\StringTok{                    \{}
\StringTok{                    col\_smiles=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/score/)}
\StringTok{                    \{}
\StringTok{                    col\_score=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/xlogp/)}
\StringTok{                    \{}
\StringTok{                    col\_xlogp=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/inchikey2D/)}
\StringTok{                    \{}
\StringTok{                    col\_inchikey2D=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/links/)}
\StringTok{                    \{}
\StringTok{                    col\_links=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            simi[$col\_id]=$col\_simi}
\StringTok{            \textbackslash{}}
\StringTok{            name[$col\_id]=$col\_name}
\StringTok{            \textbackslash{}}
\StringTok{            formula[$col\_id]=$col\_formula}
\StringTok{            \textbackslash{}}
\StringTok{            smiles[$col\_id]=$col\_smiles}
\StringTok{            \textbackslash{}}
\StringTok{            inchi[$col\_id]=$col\_inchi}
\StringTok{            \textbackslash{}}
\StringTok{            inchikey2D[$col\_id]=$col\_inchikey2D}
\StringTok{            \textbackslash{}}
\StringTok{            score[$col\_id]=$col\_score}
\StringTok{            \textbackslash{}}
\StringTok{            xlogp[$col\_id]=$col\_xlogp}
\StringTok{            \textbackslash{}}
\StringTok{            links[$col\_id]=$col\_links}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR!=FNR)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/\^{}id/)}
\StringTok{                    \{}
\StringTok{                    col\_list\_id=i}
\StringTok{                    \}}
\StringTok{                printf $i"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{} "com\_lignans\_and\_iridoids.tsv"}
\StringTok{                \}}
\StringTok{            printf "similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "formula}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "xlogp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "smiles}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{            \textbackslash{}}
\StringTok{            "inchi}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchikey2D}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "links}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "com\_lignans\_and\_iridoids.tsv"}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                printf $i"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "com\_lignans\_and\_iridoids.tsv"}
\StringTok{                \}}
\StringTok{            printf simi[$col\_list\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  name[$col\_list\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  formula[$col\_list\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  xlogp[$col\_list\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{            \textbackslash{}}
\StringTok{            smiles[$col\_list\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" inchi[$col\_list\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  inchikey2D[$col\_list\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{            \textbackslash{}}
\StringTok{            links[$col\_list\_id]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "com\_lignans\_and\_iridoids.tsv"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data }\SpecialCharTok{$}\NormalTok{list}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \CommentTok{\#sort }
\NormalTok{ data\_o}\OtherTok{=}\StringTok{"com\_lignans\_and\_iridoids.tsv"}
\NormalTok{ data\_r}\OtherTok{=}\ErrorTok{$}\NormalTok{(cat }\SpecialCharTok{\textless{}}\NormalTok{(head }\SpecialCharTok{{-}}\NormalTok{n }\DecValTok{1} \SpecialCharTok{$}\NormalTok{data\_o) }\SpecialCharTok{\textless{}}\NormalTok{(sort }\SpecialCharTok{{-}}\NormalTok{t }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{k }\DecValTok{6} \SpecialCharTok{{-}}\NormalTok{n }\SpecialCharTok{{-}}\NormalTok{r }\SpecialCharTok{\textless{}}\NormalTok{(sed }\StringTok{\textquotesingle{}1d\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data\_o)))}
\NormalTok{ echo }\StringTok{"$data\_r"} \SpecialCharTok{\textgreater{}}\NormalTok{ com\_lignans\_and\_iridoids.tsv}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \CommentTok{\#data (MS1) idenfication}
\NormalTok{data1}\OtherTok{=}\StringTok{"../data\_chi.tsv"}
\NormalTok{data2}\OtherTok{=}\StringTok{"../data\_eng.tsv"}
\NormalTok{data3}\OtherTok{=}\StringTok{"com\_lignans\_and\_iridoids.tsv"}
\NormalTok{tolerance}\OtherTok{=}\FloatTok{0.02} \CommentTok{\# mass\_window}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(max=="" || max\textless{}FNR)}
\StringTok{        \{}
\StringTok{        max=FNR}
\StringTok{        \}}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/Num/)}
\StringTok{                    \{}
\StringTok{                    num=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/Compound/)}
\StringTok{                    \{}
\StringTok{                    compound=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/Precursor/)}
\StringTok{                    \{}
\StringTok{                    precursor=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            chi\_num[FNR]=$num}
\StringTok{            \textbackslash{}}
\StringTok{            chi\_com[FNR]=$compound}
\StringTok{            \textbackslash{}}
\StringTok{            chi\_pre[FNR]=$precursor}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FILENAME\textasciitilde{}/eng/)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            close("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data1}\StringTok{\textquotesingle{}")}
\StringTok{            \textbackslash{}}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/Num/)}
\StringTok{                    \{}
\StringTok{                    num=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/Compound/)}
\StringTok{                    \{}
\StringTok{                    compound=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/Precursor/)}
\StringTok{                    \{}
\StringTok{                    precursor=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            eng\_num[FNR]=$num}
\StringTok{            \textbackslash{}}
\StringTok{            eng\_com[FNR]=$compound}
\StringTok{            \textbackslash{}}
\StringTok{            eng\_pre[FNR]=$precursor}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FILENAME\textasciitilde{}/com/)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            close("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data2}\StringTok{\textquotesingle{}")}
\StringTok{            \textbackslash{}}
\StringTok{            printf $0"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "ms1\_candidate}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "identi\_1\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data3}\StringTok{\textquotesingle{}"}
\StringTok{            \textbackslash{}}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/m\textbackslash{}/z/)}
\StringTok{                    \{}
\StringTok{                    mass=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            printf $0 "}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "identi\_1\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data3}\StringTok{\textquotesingle{}"}
\StringTok{            \textbackslash{}}
\StringTok{            for(i=1; i\textless{}=max; i++)}
\StringTok{                \{}
\StringTok{                if($mass\textgreater{}=chi\_pre[i]{-}\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tolerance}\StringTok{\textquotesingle{} \&\& $mass\textless{}=chi\_pre[i]+\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tolerance}\StringTok{\textquotesingle{})}
\StringTok{                    \{}
\StringTok{                    printf chi\_num[i]  "\_"  chi\_com[i]  "\_"  chi\_pre[i]  " | " \textgreater{}\textgreater{} "identi\_1\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data3}\StringTok{\textquotesingle{}"}
\StringTok{                    \}}
\StringTok{                if($mass\textgreater{}=eng\_pre[i]{-}\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tolerance}\StringTok{\textquotesingle{} \&\& $mass\textless{}=eng\_pre[i]+\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tolerance}\StringTok{\textquotesingle{})}
\StringTok{                    \{}
\StringTok{                    printf eng\_num[i]  "\_"  eng\_com[i]  "\_"  eng\_pre[i]  " | " \textgreater{}\textgreater{} "identi\_1\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data3}\StringTok{\textquotesingle{}"}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "identi\_1\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data3}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#database idenfication }
\NormalTok{ data1}\OtherTok{=}\StringTok{"../identi\_1.tsv"}
\NormalTok{ data2}\OtherTok{=}\StringTok{"r\_network/ms2\_figures/*.tsv"}
\NormalTok{ data\_origin}\OtherTok{=}\StringTok{"origin"}
\NormalTok{ database}\OtherTok{=}\StringTok{"../MSMS{-}Public{-}Neg{-}VS15.msp"}
\NormalTok{ data3}\OtherTok{=}\StringTok{"../database.msp"}
\NormalTok{ tolerance}\OtherTok{=}\FloatTok{0.01}
\NormalTok{ ms2\_tolerance}\OtherTok{=}\FloatTok{0.2}
\NormalTok{ in\_tolerance}\OtherTok{=}\DecValTok{20}
\NormalTok{ weight1}\OtherTok{=}\DecValTok{80}
\NormalTok{ weight2}\OtherTok{=}\DecValTok{20}
\NormalTok{ point\_limit}\OtherTok{=}\DecValTok{80}
\NormalTok{ sed }\StringTok{\textquotesingle{}s/}\SpecialCharTok{\textbackslash{}r}\StringTok{//g\textquotesingle{}} \SpecialCharTok{$}\NormalTok{database }\SpecialCharTok{\textgreater{}}\NormalTok{ ..}\SpecialCharTok{/}\NormalTok{database.msp}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        if(NR==1)}
\StringTok{            \{}
\StringTok{            p\_file=FILENAME}
\StringTok{            \textbackslash{}}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/\^{}id/)}
\StringTok{                    \{}
\StringTok{                    col\_id=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/m\textbackslash{}/z/)}
\StringTok{                    \{}
\StringTok{                    col\_mz=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(NR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            pre\_mz[$col\_id]=$col\_mz}
\StringTok{            \textbackslash{}}
\StringTok{            printf "info: datafile1 is ready. The data is " $col\_id " to " $col\_mz "}\SpecialCharTok{\textbackslash{}n}\StringTok{"  \#info}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FILENAME\textasciitilde{}/ms2\_figures/)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            close(p\_file)}
\StringTok{            \textbackslash{}}
\StringTok{            p\_file=FILENAME}
\StringTok{            \textbackslash{}}
\StringTok{            n=split(FILENAME,a,"[/]")}
\StringTok{            \textbackslash{}}
\StringTok{            split(a[n],b,"[.]")}
\StringTok{            \textbackslash{}}
\StringTok{            id=b[1]}
\StringTok{            \textbackslash{}}
\StringTok{            printf "info: datafile2 is ready. The id number is " id "}\SpecialCharTok{\textbackslash{}n}\StringTok{"  \#info}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            if("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data\_origin}\StringTok{\textquotesingle{}"=="sirius")}
\StringTok{                \{}
\StringTok{                if($2+0\textless{}0)}
\StringTok{                    \{}
\StringTok{                    count[id]+=1}
\StringTok{                    \textbackslash{}}
\StringTok{                    data2\_mz[id,count[id]]=$1}
\StringTok{                    \textbackslash{}}
\StringTok{                    data2\_in[id,count[id]]=$2*({-}1)}
\StringTok{                    \textbackslash{}}
\StringTok{                    printf "info: The ms2 peak is " count[id] " " $1 " " data2\_in[id,count[id]] "}\SpecialCharTok{\textbackslash{}n}\StringTok{"  \#info}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            else}
\StringTok{                \{}
\StringTok{                if($2+0\textgreater{}0)}
\StringTok{                    \{}
\StringTok{                    count[id]+=1}
\StringTok{                    \textbackslash{}}
\StringTok{                    data2\_mz[id,count[id]]=$1}
\StringTok{                    \textbackslash{}}
\StringTok{                    data2\_in[id,count[id]]=$2}
\StringTok{                    \textbackslash{}}
\StringTok{                    printf "info: The ms2 peak is " count[id] " " $1 " " data2\_in[id,count[id]] "}\SpecialCharTok{\textbackslash{}n}\StringTok{"  \#info}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FILENAME\textasciitilde{}/.msp/)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            msp\_num+=1}
\StringTok{            \textbackslash{}}
\StringTok{            FS="[:][ ]||[}\SpecialCharTok{\textbackslash{}t}\StringTok{]"}
\StringTok{            \textbackslash{}}
\StringTok{            close(p\_file)}
\StringTok{            \textbackslash{}}
\StringTok{            p\_file=FILENAME}
\StringTok{            \textbackslash{}}
\StringTok{            n=split($0,c,"[:][ ]")}
\StringTok{            \textbackslash{}}
\StringTok{            name=c[n]}
\StringTok{            \textbackslash{}}
\StringTok{            printf "info: datafile3 is ready. The first name is " name "}\SpecialCharTok{\textbackslash{}n}\StringTok{"  \#info}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            if($1\textasciitilde{}/NAME/)}
\StringTok{                \{}
\StringTok{                if(belong\_id[msp\_num]+0\textgreater{}=1)}
\StringTok{                    \{}
\StringTok{                    for(i=1; i\textless{}=database\_count[msp\_num]; i++)}
\StringTok{                        \{}
\StringTok{                        mz=data3\_mz[msp\_num,i]}
\StringTok{                        \textbackslash{}}
\StringTok{                        intensity=(data3\_in[msp\_num,i]/max\_in[msp\_num])*100}
\StringTok{                        \textbackslash{}}
\StringTok{                        if(intensity+0\textgreater{}=5)}
\StringTok{                            \{}
\StringTok{                            point=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{weight1}\StringTok{\textquotesingle{}}
\StringTok{                            \textbackslash{}}
\StringTok{                            full\_marks[msp\_num]+=point}
\StringTok{                            \}}
\StringTok{                        else}
\StringTok{                            \{}
\StringTok{                            point=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{weight2}\StringTok{\textquotesingle{}}
\StringTok{                            \textbackslash{}}
\StringTok{                            full\_marks[msp\_num]+=point}
\StringTok{                            \}}
\StringTok{                        for(j=1; j\textless{}=belong\_id[msp\_num]; j++)}
\StringTok{                            \{}
\StringTok{                            for(k=1; k\textless{}=count[subdirectory[msp\_num,j]]; k++)}
\StringTok{                                \{}
\StringTok{                                l1=data2\_mz[subdirectory[msp\_num,j],k]{-}\textquotesingle{}}\SpecialCharTok{$}\NormalTok{ms2\_tolerance}\StringTok{\textquotesingle{}}
\StringTok{                                \textbackslash{}}
\StringTok{                                m1=data2\_mz[subdirectory[msp\_num,j],k]+\textquotesingle{}}\SpecialCharTok{$}\NormalTok{ms2\_tolerance}\StringTok{\textquotesingle{}}
\StringTok{                                \textbackslash{}}
\StringTok{                                if(mz+0\textgreater{}=l1+0 \&\& mz+0\textless{}=m1+0)}
\StringTok{                                    \{}
\StringTok{                                    l2=data2\_in[subdirectory[msp\_num,j],k]{-}\textquotesingle{}}\SpecialCharTok{$}\NormalTok{in\_tolerance}\StringTok{\textquotesingle{}}
\StringTok{                                    \textbackslash{}}
\StringTok{                                    m2=data2\_in[subdirectory[msp\_num,j],k]+\textquotesingle{}}\SpecialCharTok{$}\NormalTok{in\_tolerance}\StringTok{\textquotesingle{}}
\StringTok{                                    \textbackslash{}}
\StringTok{                                    if(intensity+0\textgreater{}=l2+0 \&\& intensity+0\textless{}=m2+0)}
\StringTok{                                        \{}
\StringTok{                                        assign\_point[subdirectory[msp\_num,j],msp\_num]+=point;}
\StringTok{                                        \textbackslash{}}
\StringTok{                                        break;}
\StringTok{                                        \}}
\StringTok{                                    \}}
\StringTok{                                \}}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                msp\_num+=1}
\StringTok{                \textbackslash{}}
\StringTok{                name=$2}
\StringTok{                \}}
\StringTok{            if($1\textasciitilde{}/PRECURSORMZ/)}
\StringTok{                \{}
\StringTok{                for(i in pre\_mz)}
\StringTok{                    \{}
\StringTok{                    if($2+0\textgreater{}=pre\_mz[i]{-}\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tolerance}\StringTok{\textquotesingle{} \&\& $2+0\textless{}=pre\_mz[i]+\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tolerance}\StringTok{\textquotesingle{})}
\StringTok{                        \{}
\StringTok{                        printf "info: the MS1 are " $2 " vs " pre\_mz[i] "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{                        data3\_mz[msp\_num]=$2}
\StringTok{                        belong\_id[msp\_num]+=1}
\StringTok{                        subdirectory[msp\_num,belong\_id[msp\_num]]=i}
\StringTok{                        assign[i,msp\_num]=name}
\StringTok{                        sep[i,msp\_num]=msp\_num}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            if(belong\_id[msp\_num]+0\textgreater{}=1)}
\StringTok{                \{}
\StringTok{                if($1\textasciitilde{}/PRECURSORTYPE/)}
\StringTok{                    \{}
\StringTok{                    data3\_type[msp\_num]=$2; getline;}
\StringTok{                    \textbackslash{}}
\StringTok{                    data3\_formula[msp\_num]=$2; getline;}
\StringTok{                    \textbackslash{}}
\StringTok{                    data3\_ontology[msp\_num]=$2; getline;}
\StringTok{                    \textbackslash{}}
\StringTok{                    data3\_inchikey[msp\_num]=$2; getline;}
\StringTok{                    \textbackslash{}}
\StringTok{                    data3\_smiles[msp\_num]=$2; getline;}
\StringTok{                    \textbackslash{}}
\StringTok{                    data3\_rt[msp\_num]=$2; getline;}
\StringTok{                    \textbackslash{}}
\StringTok{                    data3\_ccs[msp\_num]=$2;}
\StringTok{                    \}}
\StringTok{                if($1\textasciitilde{}/Num Peaks/)}
\StringTok{                    \{}
\StringTok{                    data3\_peaks[msp\_num]=$2}
\StringTok{                    \}}
\StringTok{                if($1\textasciitilde{}/\^{}[0{-}9]/)}
\StringTok{                    \{}
\StringTok{                    database\_count[msp\_num]+=1}
\StringTok{                    \textbackslash{}}
\StringTok{                    data3\_mz[msp\_num,database\_count[msp\_num]]=$1}
\StringTok{                    \textbackslash{}}
\StringTok{                    data3\_in[msp\_num,database\_count[msp\_num]]=$2}
\StringTok{                    \textbackslash{}}
\StringTok{                    if(max\_in[msp\_num]\textless{}$2)}
\StringTok{                        \{}
\StringTok{                        max\_in[msp\_num]=$2}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(msp\_num!="" \&\& (FILENAME\textasciitilde{}"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data1}\StringTok{\textquotesingle{}"))}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            FS="}\SpecialCharTok{\textbackslash{}t}\StringTok{"}
\StringTok{            \textbackslash{}}
\StringTok{            close(p\_file)}
\StringTok{            \textbackslash{}}
\StringTok{            printf $0"}\SpecialCharTok{\textbackslash{}t}\StringTok{" "custom\_idenfication}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "../identi\_2\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data\_origin}\StringTok{\textquotesingle{}.tsv"}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            printf $0 \textgreater{}\textgreater{} "../identi\_2\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data\_origin}\StringTok{\textquotesingle{}.tsv"}
\StringTok{            \textbackslash{}}
\StringTok{            for(i in assign\_point)}
\StringTok{                \{}
\StringTok{                if(i\textasciitilde{}"\^{}"$1"}\SpecialCharTok{\textbackslash{}034}\StringTok{" \&\& assign\_point[i]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{point\_limit}\StringTok{\textquotesingle{})}
\StringTok{                    \{}
\StringTok{                    score[i]=assign\_point[i]}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            for(n=asort(score,sort\_score); n\textgreater{}=1; n{-}{-})}
\StringTok{                \{}
\StringTok{                for(i in score)}
\StringTok{                    \{}
\StringTok{                    if(score[i]==sort\_score[n])}
\StringTok{                        \{}
\StringTok{                        printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{" score[i] "("  full\_marks[sep[i]]  ")"  " | " \textbackslash{}}
\StringTok{                        \textbackslash{}}
\StringTok{                        data3\_type[sep[i]] " | "  \textbackslash{}}
\StringTok{                        \textbackslash{}}
\StringTok{                        data3\_formula[sep[i]] " | " \textbackslash{}}
\StringTok{                        \textbackslash{}}
\StringTok{                        data3\_ontology[sep[i]] " | " \textbackslash{}}
\StringTok{                        \textbackslash{}}
\StringTok{                        assign[i] " | " \textbackslash{}}
\StringTok{                        \textbackslash{}}
\StringTok{                        \textgreater{}\textgreater{} "../identi\_2\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data\_origin}\StringTok{\textquotesingle{}.tsv"}
\StringTok{                        \textbackslash{}}
\StringTok{                        delete score[i]; break;}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            delete score}
\StringTok{            \textbackslash{}}
\StringTok{            printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "../identi\_2\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data\_origin}\StringTok{\textquotesingle{}.tsv"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3 }\SpecialCharTok{$}\NormalTok{data1}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#find name from pubchem}
\NormalTok{ data1}\OtherTok{=}\StringTok{"../identi\_2\_origin.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==1)}
\StringTok{        \{}
\StringTok{        FS="[}\SpecialCharTok{\textbackslash{}t}\StringTok{]||[;][ ]"}
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if($i\textasciitilde{}/\^{}id/)}
\StringTok{                \{}
\StringTok{                col\_id=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/links/)}
\StringTok{                \{}
\StringTok{                col\_links=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        printf "" \textgreater{} "id\_links.tsv"}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        printf $col\_id"}\SpecialCharTok{\textbackslash{}t}\StringTok{" $col\_links"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "id\_links.tsv"}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\NormalTok{ data2}\OtherTok{=}\StringTok{"id\_links.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\StringTok{"[}\SpecialCharTok{\textbackslash{}t}\StringTok{]||[;][ ]"} \StringTok{\textquotesingle{}}
\StringTok{    BEGIN\{}
\StringTok{        printf "" \textgreater{} "id\_links\_sep1.tsv"}
\StringTok{        \}}
\StringTok{    \{}
\StringTok{    for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{        if(i!=NF)}
\StringTok{            \{}
\StringTok{            printf $i"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "id\_links\_sep1.tsv"}
\StringTok{            \}}
\StringTok{        else}
\StringTok{            \{}
\StringTok{            printf $i"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "id\_links\_sep1.tsv"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data2}
\NormalTok{ data3}\OtherTok{=}\StringTok{"id\_links\_sep1.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    BEGIN\{}
\StringTok{        printf "" \textgreater{} "id\_cid.tsv"}
\StringTok{        \}}
\StringTok{    \{}
\StringTok{    if($2\textasciitilde{}/PubChem/)}
\StringTok{        \{}
\StringTok{        split($2,a,"[(]||[,]||[)]")}
\StringTok{        \textbackslash{}}
\StringTok{        if(a[2]\textasciitilde{}/\^{}[0{-}9]/)}
\StringTok{            \{}
\StringTok{            printf $1 "}\SpecialCharTok{\textbackslash{}t}\StringTok{" a[2] "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "id\_cid.tsv"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data3}
\NormalTok{ data4}\OtherTok{=}\StringTok{"id\_cid.tsv"}
\NormalTok{ arg}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}\{printf $1"\_"$2"@"\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data4 }\SpecialCharTok{|}\NormalTok{ sed }\StringTok{\textquotesingle{}s/@$//g\textquotesingle{}}\NormalTok{)}
\NormalTok{script}\OtherTok{=}\ErrorTok{$}\NormalTok{(echo }\StringTok{\textquotesingle{}}
\StringTok{import sys}
\StringTok{import pubchempy as pcp}
\StringTok{data=sys.argv[1]}
\StringTok{id\_cids=data.split("@")}
\StringTok{for i in id\_cids:}
\StringTok{ data\_file=open("synonyms.tsv","a+")}
\StringTok{ essemble=i.split("\_")}
\StringTok{ id=essemble[0]}
\StringTok{ cid=essemble[1]}
\StringTok{ compound=pcp.Compound.from\_cid(cid)}
\StringTok{ smiles=compound.isomeric\_smiles}
\StringTok{ print(str(id)+"}\SpecialCharTok{\textbackslash{}t}\StringTok{",end="",file=data\_file)}
\StringTok{ for name in compound.synonyms:}
\StringTok{  print(name,end=" | ",file=data\_file)}
\StringTok{ print("}\SpecialCharTok{\textbackslash{}t}\StringTok{"+smiles,file=data\_file)}
\StringTok{ print("Info: the data of "+str(id)+"\_"+str(cid)+" has been collected.")}
\StringTok{ data\_file.close()\textquotesingle{}}\NormalTok{)}
\NormalTok{python }\SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$script"}\NormalTok{) }\SpecialCharTok{$}\NormalTok{arg}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\# transform principle}
\NormalTok{ data}\OtherTok{=}\StringTok{"../identi\_2\_origin.tsv"}
\NormalTok{ tolerance}\OtherTok{=}\StringTok{"0.1"}
\NormalTok{ ratio\_limit}\OtherTok{=}\StringTok{"1.2"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==1)}
\StringTok{        \{}
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if($i\textasciitilde{}/\^{}id/)}
\StringTok{                \{}
\StringTok{                col\_id=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/norm\_delta/)}
\StringTok{                \{}
\StringTok{                col\_delta=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/class/)}
\StringTok{                \{}
\StringTok{                col\_class=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/pro\textbackslash{}/raw/)}
\StringTok{                \{}
\StringTok{                col\_ratio=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        id[FNR]=$col\_id}
\StringTok{        \textbackslash{}}
\StringTok{        norm\_delta[$col\_id]=$col\_delta}
\StringTok{        \textbackslash{}}
\StringTok{        class[$col\_id]=$col\_class}
\StringTok{        \textbackslash{}}
\StringTok{        ratio[$col\_id]=$col\_ratio}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        printf "source}\SpecialCharTok{\textbackslash{}t}\StringTok{" "target}\SpecialCharTok{\textbackslash{}t}\StringTok{" "source\_delta}\SpecialCharTok{\textbackslash{}t}\StringTok{" "target\_delta}\SpecialCharTok{\textbackslash{}t}\StringTok{" "trans\_probability}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        "ratio}\SpecialCharTok{\textbackslash{}t}\StringTok{" "classification}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "principle\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tolerance}\StringTok{\textquotesingle{}\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{ratio\_limit}\StringTok{\textquotesingle{}.tsv"}
\StringTok{        \textbackslash{}}
\StringTok{        for(i in id)}
\StringTok{            \{}
\StringTok{            if(ratio[id[i]]+0\textgreater{}="\textquotesingle{}}\SpecialCharTok{$}\NormalTok{ratio\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{                \{}
\StringTok{                for(j in norm\_delta)}
\StringTok{                    \{}
\StringTok{                    if(norm\_delta[id[i]]+0\textgreater{}0 \&\& norm\_delta[j]+0\textless{}0 || norom\_delta[id[i]]+0\textless{}0 \&\& norm\_delta[j]+0\textgreater{}0)}
\StringTok{                        \{}
\StringTok{                        l=(norm\_delta[j])*({-}1){-}"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tolerance}\StringTok{\textquotesingle{}"}
\StringTok{                        \textbackslash{}}
\StringTok{                        m=(norm\_delta[j])*({-}1)+"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tolerance}\StringTok{\textquotesingle{}"}
\StringTok{                        \textbackslash{}}
\StringTok{                        if(norm\_delta[id[i]]+0\textgreater{}=l \&\& norm\_delta[id[i]]\textless{}=m \&\& class[id[i]]==class[j])}
\StringTok{                            \{}
\StringTok{                            trans=norm\_delta[id[i]]+norm\_delta[j]}
\StringTok{                            \textbackslash{}}
\StringTok{                            if(trans+0\textless{}0)}
\StringTok{                                \{}
\StringTok{                                trans*=({-}1)}
\StringTok{                                \}}
\StringTok{                            if(id[i]+0\textgreater{}j)}
\StringTok{                                \{}
\StringTok{                                printf id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" j"}\SpecialCharTok{\textbackslash{}t}\StringTok{" norm\_delta[id[i]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" norm\_delta[j]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                                \textbackslash{}}
\StringTok{                                trans"}\SpecialCharTok{\textbackslash{}t}\StringTok{" id[i]":"ratio[id[i]]" | "j":"ratio[j]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                                \textbackslash{}}
\StringTok{                                class[id[i]]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "principle\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tolerance}\StringTok{\textquotesingle{}\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{ratio\_limit}\StringTok{\textquotesingle{}.tsv"}
\StringTok{                                \}}
\StringTok{                            if(id[i]+0\textless{}j)}
\StringTok{                                \{}
\StringTok{                                printf j"}\SpecialCharTok{\textbackslash{}t}\StringTok{" id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" norm\_delta[j]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" norm\_delta[id[i]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                                \textbackslash{}}
\StringTok{                                trans"}\SpecialCharTok{\textbackslash{}t}\StringTok{" j":"ratio[j]" | "id[i]":"ratio[id[i]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                                \textbackslash{}}
\StringTok{                                class[id[i]]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "principle\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tolerance}\StringTok{\textquotesingle{}\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{ratio\_limit}\StringTok{\textquotesingle{}.tsv"}
\StringTok{                                \}}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            delete norm\_delta[id[i]]}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\# classification arrangement}
\NormalTok{ data1}\OtherTok{=}\StringTok{"canopus\_summary.tsv"}
\NormalTok{ data2}\OtherTok{=}\StringTok{"canopus.tsv"}
\NormalTok{ data3}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\NormalTok{ definition\_limit}\OtherTok{=}\StringTok{"0.9"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            p\_file=FILENAME}
\StringTok{            \textbackslash{}}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/name/)}
\StringTok{                    \{}
\StringTok{                    col\_id=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/specific/)}
\StringTok{                    \{}
\StringTok{                    col\_specific=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/level/)}
\StringTok{                    \{}
\StringTok{                    col\_level=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/subclass/)}
\StringTok{                    \{}
\StringTok{                    col\_subclass=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/\^{}class/)}
\StringTok{                    \{}
\StringTok{                    col\_class=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/superclass/)}
\StringTok{                    \{}
\StringTok{                    col\_superclass=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            n=split($col\_id,a,"[\_]")}
\StringTok{            \textbackslash{}}
\StringTok{            id=a[n]}
\StringTok{            \textbackslash{}}
\StringTok{            specific[id]=$col\_specific}
\StringTok{            \textbackslash{}}
\StringTok{            level[id]=$col\_level}
\StringTok{            \textbackslash{}}
\StringTok{            subclass[id]=$col\_subclass}
\StringTok{            \textbackslash{}}
\StringTok{            class[id]=$col\_class}
\StringTok{            \textbackslash{}}
\StringTok{            superclass[id]=$col\_superclass}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FILENAME\textasciitilde{}/canopus.tsv/)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            close(p\_file)}
\StringTok{            \textbackslash{}}
\StringTok{            p\_file=FILENAME}
\StringTok{            \textbackslash{}}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/name/)}
\StringTok{                    \{}
\StringTok{                    col\_name=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/description/)}
\StringTok{                    \{}
\StringTok{                    col\_description=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            description[$col\_name]=$col\_description}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FILENAME\textasciitilde{}"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data3}\StringTok{\textquotesingle{}")}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            close(p\_file)}
\StringTok{            \textbackslash{}}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/\^{}id$/)}
\StringTok{                    \{}
\StringTok{                    col\_id=i}
\StringTok{                    \}}
\StringTok{                if(i\textgreater{}=2)}
\StringTok{                    \{}
\StringTok{                    col\_class\_name[i]=$i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition\_source}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition\_description}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{            \textbackslash{}}
\StringTok{            "specific}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "specific\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "level\_5}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "level\_5\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{            \textbackslash{}}
\StringTok{            "subclass}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "subclass\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "class}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "class\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "superclass}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "superclass\_pp}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "stat\_classification.tsv"}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            for(i=2; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                c\_pp[col\_class\_name[i]]=sprintf("\%.4f",$i)}
\StringTok{                \}}
\StringTok{            if(level[$col\_id] != "" \&\& c\_pp[level[$col\_id]]+0 \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{                \{}
\StringTok{                definition\_source="level\_5"}
\StringTok{                \textbackslash{}}
\StringTok{                definition=level[$col\_id]}
\StringTok{                \}}
\StringTok{            else if(subclass[$col\_id] != "" \&\& c\_pp[subclass[$col\_id]]+0 \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{                \{}
\StringTok{                definition\_source="subclass"}
\StringTok{                \textbackslash{}}
\StringTok{                definition=subclass[$col\_id]}
\StringTok{                \}}
\StringTok{            else if(class[$col\_id] != "" \&\& c\_pp[class[$col\_id]]+0 \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{                \{}
\StringTok{                definition\_source="class"}
\StringTok{                \textbackslash{}}
\StringTok{                definition=class[$col\_id]}
\StringTok{                \}}
\StringTok{            else if(superclass[$col\_id] != "" \&\& c\_pp[superclass[$col\_id]]+0 \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{                \{}
\StringTok{                definition\_source="superclass"}
\StringTok{                \textbackslash{}}
\StringTok{                definition=superclass[$col\_id]}
\StringTok{                \}}
\StringTok{            else}
\StringTok{                \{}
\StringTok{                definition\_source="null"}
\StringTok{                \textbackslash{}}
\StringTok{                definition="null"}
\StringTok{                \textbackslash{}}
\StringTok{                c\_pp[definition]="null"}
\StringTok{                \textbackslash{}}
\StringTok{                description[definition]="null"}
\StringTok{                \}}
\StringTok{            printf $col\_id"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  definition\_source"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  definition"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[definition]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  description[definition]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{            \textbackslash{}}
\StringTok{            specific[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[specific[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  level[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[level[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{            \textbackslash{}}
\StringTok{            subclass[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[subclass[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  class[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[class[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{            \textbackslash{}}
\StringTok{            superclass[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[superclass[$col\_id]]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "stat\_classification.tsv"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\# translate}
\NormalTok{ data}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==1)}
\StringTok{        \{}
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if($i\textasciitilde{}/\^{}definition$/)}
\StringTok{                \{}
\StringTok{                col\_definition=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}=2 \&\& $col\_definition!="null")}
\StringTok{        \{}
\StringTok{        print $col\_definition}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}}\NormalTok{ stat\_classification.tsv }\SpecialCharTok{|}\NormalTok{ sort }\SpecialCharTok{|}\NormalTok{ uniq)}
\NormalTok{ trans }\SpecialCharTok{:}\NormalTok{zh }\SpecialCharTok{{-}}\NormalTok{b }\SpecialCharTok{\textless{}}\ErrorTok{\textless{}\textless{}}\NormalTok{ echo }\StringTok{"$data"}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\# new algorithm (transform principle)}
 \DocumentationTok{\#\#\#\#\#\#\#\# here the low pp will be filtered}
\NormalTok{ data}\OtherTok{=}\StringTok{"results/stat\_classification.tsv"}
\NormalTok{ stat}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==1)}
\StringTok{        \{}
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if($i\textasciitilde{}/\^{}id$/)}
\StringTok{                \{}
\StringTok{                col\_id=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/\^{}definition$/)}
\StringTok{                \{}
\StringTok{                col\_definition=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        if($col\_definition!="null")}
\StringTok{            \{}
\StringTok{            id\_class[$col\_id]=$col\_definition}
\StringTok{            class\_num[$col\_definition]+=1}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        for(i in class\_num)}
\StringTok{            \{}
\StringTok{            printf i"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  class\_num[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}
\StringTok{            \textbackslash{}}
\StringTok{            for(j in id\_class)}
\StringTok{                \{}
\StringTok{                if(id\_class[j]==i)}
\StringTok{                    \{}
\StringTok{                    printf j"@"}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data }\SpecialCharTok{|}\NormalTok{ sed }\StringTok{\textquotesingle{}s/@$//g\textquotesingle{}}\NormalTok{)}
\NormalTok{ data2}\OtherTok{=}\StringTok{"results/re\_neg\_RT.tsv"}
\NormalTok{ data3}\OtherTok{=}\StringTok{"results/neg\_RT.tsv"}
\NormalTok{ compar1}\OtherTok{=}\StringTok{"Raw"}
\NormalTok{ compar2}\OtherTok{=}\StringTok{"Pro"}
\NormalTok{ log}\OtherTok{=}\DecValTok{10}
\NormalTok{ log\_to}\OtherTok{=}\DecValTok{2}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F [}\StringTok{"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}\SpecialCharTok{@}\NormalTok{] }\SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    BEGIN\{}
\StringTok{        maxNF=0}
\StringTok{        \textbackslash{}}
\StringTok{        rows=0}
\StringTok{        \textbackslash{}}
\StringTok{        compar1n=0}
\StringTok{        \textbackslash{}}
\StringTok{        compar2n=0}
\StringTok{        \}}
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        rows+=1}
\StringTok{        if(maxNF\textless{}NF)}
\StringTok{            \{}
\StringTok{            maxNF=NF}
\StringTok{            \}}
\StringTok{        class[FNR]=$1}
\StringTok{        \textbackslash{}}
\StringTok{        num[FNR]=$2}
\StringTok{        \textbackslash{}}
\StringTok{        for(j=3; j\textless{}=NF; j++)}
\StringTok{            \{}
\StringTok{            id[FNR,j]=$j}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    else}
\StringTok{        \{}
\StringTok{        if(FNR==1 \&\& FILENAME\textasciitilde{}/re\_/)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if(($i\textasciitilde{}/\textquotesingle{}}\SpecialCharTok{$}\NormalTok{compar1}\StringTok{\textquotesingle{}/) \&\& $i\textasciitilde{}/area/)}
\StringTok{                    \{}
\StringTok{                    colum1[i]=i}
\StringTok{                    compar1n+=1}
\StringTok{                    \}}
\StringTok{                if(($i\textasciitilde{}/\textquotesingle{}}\SpecialCharTok{$}\NormalTok{compar2}\StringTok{\textquotesingle{}/) \&\& $i\textasciitilde{}/area/)}
\StringTok{                    \{}
\StringTok{                    colum2[i]=i}
\StringTok{                    compar2n+=1}
\StringTok{                    \}}
\StringTok{                if(($i\textasciitilde{}/retention/))}
\StringTok{                    \{}
\StringTok{                    rtcolum=i}
\StringTok{                    \}}
\StringTok{                if(($i\textasciitilde{}/m\textbackslash{}/z/))}
\StringTok{                    \{}
\StringTok{                    mzcolum=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            if(sum[1,$1]=="" \&\& sum[2,$1]=="") \#\#\#\#\#\#\#\# revise data }
\StringTok{                \{}
\StringTok{                sum[1,$1]=0}
\StringTok{                \textbackslash{}}
\StringTok{                sum[2,$1]=0}
\StringTok{                \textbackslash{}}
\StringTok{                rt[$1]=$rtcolum}
\StringTok{                \textbackslash{}}
\StringTok{                mz[$1]=$mzcolum}
\StringTok{                \textbackslash{}}
\StringTok{                for(i=1; i\textless{}=NF; i++)}
\StringTok{                    \{}
\StringTok{                    if(i==colum1[i] \&\& colum1[i]!="")}
\StringTok{                        \{}
\StringTok{                        sum[1,$1]+=$i}
\StringTok{                        \}}
\StringTok{                    if(i==colum2[i] \&\& colum2[i]!="")}
\StringTok{                        \{}
\StringTok{                        sum[2,$1]+=$i}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        printf "class}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "log\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log}\StringTok{\textquotesingle{}\_raw}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "log\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log}\StringTok{\textquotesingle{}\_pro}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        "log\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log}\StringTok{\textquotesingle{}\_delta\_area}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "pro\_to\_raw}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "log\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log\_to}\StringTok{\textquotesingle{}\_pro\_to\_raw}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "variety}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "number}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{} "algorithm.tsv"}
\StringTok{        \textbackslash{}}
\StringTok{        printf "rt}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "m/z}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "algorithm.tsv"}
\StringTok{        \textbackslash{}}
\StringTok{        for(i=1; i\textless{}=rows; i++)}
\StringTok{            \{}
\StringTok{            for(j=3; j\textless{}=maxNF; j++)}
\StringTok{                \{}
\StringTok{                if(id[i,j]!="")}
\StringTok{                    \{}
\StringTok{                    raw=(sum[1,id[i,j]]/compar1n)}
\StringTok{                    \textbackslash{}}
\StringTok{                    pro=(sum[2,id[i,j]]/compar2n)}
\StringTok{                    \textbackslash{}}
\StringTok{                    log\_raw=log(raw)/log(\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log}\StringTok{\textquotesingle{})}
\StringTok{                    \textbackslash{}}
\StringTok{                    log\_pro=log(pro)/log(\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log}\StringTok{\textquotesingle{})}
\StringTok{                    \textbackslash{}}
\StringTok{                    delta\_area=pro{-}raw}
\StringTok{                    \textbackslash{}}
\StringTok{                    if(raw!=0)}
\StringTok{                        \{}
\StringTok{                        to\_raw=pro/raw}
\StringTok{                        \textbackslash{}}
\StringTok{                        norm\_to\_raw=log(to\_raw)/log(\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log\_to}\StringTok{\textquotesingle{})}
\StringTok{                        \}}
\StringTok{                    else}
\StringTok{                        \{}
\StringTok{                        to\_raw="infinity"}
\StringTok{                        \textbackslash{}}
\StringTok{                        norm\_to\_raw="infinity"}
\StringTok{                        \}}
\StringTok{                    if(delta\_area+0\textgreater{}0)}
\StringTok{                        \{}
\StringTok{                        norm\_delta=log(delta\_area)/log(\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log}\StringTok{\textquotesingle{})}
\StringTok{                        \textbackslash{}}
\StringTok{                        variety="increase"}
\StringTok{                        \}}
\StringTok{                    else if(delta\_area\textless{}0)}
\StringTok{                        \{}
\StringTok{                        norm\_delta={-}1*(log({-}1*delta\_area)/log(\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log}\StringTok{\textquotesingle{}))}
\StringTok{                        \textbackslash{}}
\StringTok{                        variety="decrease"}
\StringTok{                        \}}
\StringTok{                    else}
\StringTok{                        \{}
\StringTok{                        norm\_delta=0}
\StringTok{                        \}}
\StringTok{                    printf class[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  id[i,j]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  log\_raw"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  log\_pro"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                    \textbackslash{}}
\StringTok{                    norm\_delta"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  to\_raw"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  norm\_to\_raw"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  variety"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  num[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                    \textbackslash{}}
\StringTok{                    rt[id[i,j]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  mz[id[i,j]]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "algorithm.tsv"}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$stat"}\NormalTok{) }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ data}\OtherTok{=}\StringTok{"algorithm.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==1)}
\StringTok{        \{}
\StringTok{        print "id","rt","m/z","classification","variety","pro/raw","log10\_raw","log10\_pro","norm\_delta" \textgreater{} "compound.tsv"}
\StringTok{        \textbackslash{}}
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if($i\textasciitilde{}/\^{}id/)}
\StringTok{                \{}
\StringTok{                col\_id=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/\^{}rt/)}
\StringTok{                \{}
\StringTok{                col\_rt=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/m\textbackslash{}/z/)}
\StringTok{                \{}
\StringTok{                col\_mz=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/class/)}
\StringTok{                \{}
\StringTok{                col\_class=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/variety/)}
\StringTok{                \{}
\StringTok{                col\_variety=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/\^{}pro\_to\_raw/)}
\StringTok{                \{}
\StringTok{                col\_ratio=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/log10\_raw/)}
\StringTok{                \{}
\StringTok{                col\_log10\_raw=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/log10\_pro/)}
\StringTok{                \{}
\StringTok{                col\_log10\_pro=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/delta\_area/)}
\StringTok{                \{}
\StringTok{                col\_delta=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        print $col\_id, $col\_rt, sprintf("\%.5f",$col\_mz), $col\_class, $col\_variety, $col\_ratio, $col\_log10\_raw, $col\_log10\_pro, \textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        $col\_delta \textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        \textgreater{}\textgreater{} "compound.tsv"}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ data}\OtherTok{=}\StringTok{"results/fingerid\_first\_score.tsv"}
\NormalTok{ list}\OtherTok{=}\StringTok{"compound.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{} }
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/\^{}id/)}
\StringTok{                    \{}
\StringTok{                    col\_id=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/similarity/)}
\StringTok{                    \{}
\StringTok{                    col\_simi=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/name/)}
\StringTok{                    \{}
\StringTok{                    col\_name=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/formula/)}
\StringTok{                    \{}
\StringTok{                    col\_formula=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/\^{}inchi$/)}
\StringTok{                    \{}
\StringTok{                    col\_inchi=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/smiles/)}
\StringTok{                    \{}
\StringTok{                    col\_smiles=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/score/)}
\StringTok{                    \{}
\StringTok{                    col\_score=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/xlogp/)}
\StringTok{                    \{}
\StringTok{                    col\_xlogp=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/inchikey2D/)}
\StringTok{                    \{}
\StringTok{                    col\_inchikey2D=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/links/)}
\StringTok{                    \{}
\StringTok{                    col\_links=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            simi[$col\_id]=$col\_simi}
\StringTok{            \textbackslash{}}
\StringTok{            name[$col\_id]=$col\_name}
\StringTok{            \textbackslash{}}
\StringTok{            formula[$col\_id]=$col\_formula}
\StringTok{            \textbackslash{}}
\StringTok{            smiles[$col\_id]=$col\_smiles}
\StringTok{            \textbackslash{}}
\StringTok{            inchi[$col\_id]=$col\_inchi}
\StringTok{            \textbackslash{}}
\StringTok{            inchikey2D[$col\_id]=$col\_inchikey2D}
\StringTok{            \textbackslash{}}
\StringTok{            score[$col\_id]=$col\_score}
\StringTok{            \textbackslash{}}
\StringTok{            xlogp[$col\_id]=$col\_xlogp}
\StringTok{            \textbackslash{}}
\StringTok{            links[$col\_id]=$col\_links}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR!=FNR)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/\^{}id/)}
\StringTok{                    \{}
\StringTok{                    col\_list\_id=i}
\StringTok{                    \}}
\StringTok{                printf $i"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{} "com\_compound.tsv"}
\StringTok{                \}}
\StringTok{            printf "similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "formula}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "xlogp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "smiles}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{            \textbackslash{}}
\StringTok{            "inchi}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchikey2D}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "links}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "com\_compound.tsv"}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                printf $i"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "com\_compound.tsv"}
\StringTok{                \}}
\StringTok{            printf simi[$col\_list\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  name[$col\_list\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  formula[$col\_list\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  xlogp[$col\_list\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{            \textbackslash{}}
\StringTok{            smiles[$col\_list\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" inchi[$col\_list\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  inchikey2D[$col\_list\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{            \textbackslash{}}
\StringTok{            links[$col\_list\_id]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "com\_compound.tsv"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data }\SpecialCharTok{$}\NormalTok{list}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \CommentTok{\#sort }
\NormalTok{ data\_o}\OtherTok{=}\StringTok{"com\_compound.tsv"}
\NormalTok{ data\_r}\OtherTok{=}\ErrorTok{$}\NormalTok{(cat }\SpecialCharTok{\textless{}}\NormalTok{(head }\SpecialCharTok{{-}}\NormalTok{n }\DecValTok{1} \SpecialCharTok{$}\NormalTok{data\_o) }\SpecialCharTok{\textless{}}\NormalTok{(sort }\SpecialCharTok{{-}}\NormalTok{t }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{k }\DecValTok{6} \SpecialCharTok{{-}}\NormalTok{n }\SpecialCharTok{{-}}\NormalTok{r }\SpecialCharTok{\textless{}}\NormalTok{(sed }\StringTok{\textquotesingle{}1d\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data\_o)))}
\NormalTok{ echo }\StringTok{"$data\_r"} \SpecialCharTok{\textgreater{}}\NormalTok{ com\_compound.tsv}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
  \DocumentationTok{\#\# transform principle}
\NormalTok{ data1}\OtherTok{=}\StringTok{"com\_compound.tsv"}
\NormalTok{ data2}\OtherTok{=}\StringTok{"results/stat\_classification.tsv"}
\NormalTok{ tolerance}\OtherTok{=}\StringTok{"0.01"}
\NormalTok{ ratio\_limit}\OtherTok{=}\StringTok{"1.5"}
 \CommentTok{\#similarity\_limit="0.5"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        if(NR==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/\^{}id/)}
\StringTok{                    \{}
\StringTok{                    col\_id=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/norm\_delta/)}
\StringTok{                    \{}
\StringTok{                    col\_delta=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/class/)}
\StringTok{                    \{}
\StringTok{                    col\_class=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/pro\textbackslash{}/raw/)}
\StringTok{                    \{}
\StringTok{                    col\_ratio=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(NR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            id[FNR]=$col\_id}
\StringTok{            \textbackslash{}}
\StringTok{            norm\_delta[$col\_id]=$col\_delta}
\StringTok{            \textbackslash{}}
\StringTok{            class[$col\_id]=$col\_class}
\StringTok{            \textbackslash{}}
\StringTok{            ratio[$col\_id]=$col\_ratio}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR!=FNR)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/\^{}id$/)}
\StringTok{                    \{}
\StringTok{                    col\_id=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/definition\_source/)}
\StringTok{                    \{}
\StringTok{                    col\_source=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/\^{}definition$/)}
\StringTok{                    \{}
\StringTok{                    col\_definition=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/\^{}level\_5$/)}
\StringTok{                    \{}
\StringTok{                    col\_level=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/\^{}subclass$/)}
\StringTok{                    \{}
\StringTok{                    col\_subclass=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/\^{}class$/)}
\StringTok{                    \{}
\StringTok{                    col\_class=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/\^{}superclass$/)}
\StringTok{                    \{}
\StringTok{                    col\_superclass=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            if($col\_class!="")}
\StringTok{                \{}
\StringTok{                comparison[$col\_id]=$col\_class}
\StringTok{                \}}
\StringTok{            else}
\StringTok{                \{}
\StringTok{                comparison[$col\_id]=$col\_superclass}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        printf "source}\SpecialCharTok{\textbackslash{}t}\StringTok{" "target}\SpecialCharTok{\textbackslash{}t}\StringTok{" "source\_delta}\SpecialCharTok{\textbackslash{}t}\StringTok{" "target\_delta}\SpecialCharTok{\textbackslash{}t}\StringTok{" "trans\_probability}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        "ratio}\SpecialCharTok{\textbackslash{}t}\StringTok{" "co\_classification}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "all\_principle\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tolerance}\StringTok{\textquotesingle{}\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{ratio\_limit}\StringTok{\textquotesingle{}.tsv"}
\StringTok{        \textbackslash{}}
\StringTok{        for(i in id)}
\StringTok{            \{}
\StringTok{            if(ratio[id[i]]+0\textgreater{}="\textquotesingle{}}\SpecialCharTok{$}\NormalTok{ratio\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{                \{}
\StringTok{                for(j in norm\_delta)}
\StringTok{                    \{}
\StringTok{                    if(norm\_delta[id[i]]+0\textgreater{}0 \&\& norm\_delta[j]+0\textless{}0 || norom\_delta[id[i]]+0\textless{}0 \&\& norm\_delta[j]+0\textgreater{}0)}
\StringTok{                        \{}
\StringTok{                        l=(norm\_delta[j])*({-}1){-}"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tolerance}\StringTok{\textquotesingle{}"}
\StringTok{                        \textbackslash{}}
\StringTok{                        m=(norm\_delta[j])*({-}1)+"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tolerance}\StringTok{\textquotesingle{}"}
\StringTok{                        \textbackslash{}}
\StringTok{                        if(norm\_delta[id[i]]+0\textgreater{}=l \&\& norm\_delta[id[i]]+0\textless{}=m \&\& comparison[id[i]]+0==comparison[j])}
\StringTok{                            \{}
\StringTok{                            trans=norm\_delta[id[i]]+norm\_delta[j]}
\StringTok{                            \textbackslash{}}
\StringTok{                            if(trans+0\textless{}0)}
\StringTok{                                \{}
\StringTok{                                trans*=({-}1)}
\StringTok{                                \}}
\StringTok{                            if(id[i]+0\textgreater{}j)}
\StringTok{                                \{}
\StringTok{                                printf id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" j"}\SpecialCharTok{\textbackslash{}t}\StringTok{" norm\_delta[id[i]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" norm\_delta[j]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                                \textbackslash{}}
\StringTok{                                trans"}\SpecialCharTok{\textbackslash{}t}\StringTok{" id[i]":"ratio[id[i]]" | "j":"ratio[j]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                                \textbackslash{}}
\StringTok{                                comparison[id[i]]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "all\_principle\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tolerance}\StringTok{\textquotesingle{}\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{ratio\_limit}\StringTok{\textquotesingle{}.tsv"}
\StringTok{                                \}}
\StringTok{                            if(id[i]+0\textless{}j)}
\StringTok{                                \{}
\StringTok{                                printf j"}\SpecialCharTok{\textbackslash{}t}\StringTok{" id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" norm\_delta[j]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" norm\_delta[id[i]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                                \textbackslash{}}
\StringTok{                                trans"}\SpecialCharTok{\textbackslash{}t}\StringTok{" j":"ratio[j]" | "id[i]":"ratio[id[i]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                                \textbackslash{}}
\StringTok{                                comparison[id[i]]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "all\_principle\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tolerance}\StringTok{\textquotesingle{}\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{ratio\_limit}\StringTok{\textquotesingle{}.tsv"}
\StringTok{                                \}}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            delete norm\_delta[id[i]]}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \CommentTok{\#data(alignment)}
\NormalTok{ data1}\OtherTok{=}\NormalTok{neg.csv}
\NormalTok{ data2}\OtherTok{=}\NormalTok{pos.csv}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\StringTok{","} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/row ID/)}
\StringTok{                    \{}
\StringTok{                    col\_id=i}
\StringTok{                    \}}
\StringTok{                else if($i\textasciitilde{}/row m\textbackslash{}/z/)}
\StringTok{                    \{}
\StringTok{                    col\_mz=i}
\StringTok{                    \}}
\StringTok{                else if($i\textasciitilde{}/row retention time/)}
\StringTok{                    \{}
\StringTok{                    col\_rt=i}
\StringTok{                    \}}
\StringTok{                else}
\StringTok{                    \{}
\StringTok{                    col\_name[$i]=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            n=asorti(col\_name,sort\_name)}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=n; i++)}
\StringTok{                \{}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \CommentTok{\#search glycosides}
\NormalTok{ data}\OtherTok{=}\StringTok{"com\_compound.tsv"}
\NormalTok{ savename}\OtherTok{=}\StringTok{"com\_lignans\_and\_iridoids.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(FNR==1)}
\StringTok{        \{}
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if($i\textasciitilde{}/class/)}
\StringTok{                \{}
\StringTok{                col\_classification=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savename}\StringTok{\textquotesingle{}"}
\StringTok{        \}}
\StringTok{    if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        if(tolower($col\_classification)\textasciitilde{}/iridoid/)}
\StringTok{            \{}
\StringTok{            printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savename}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        if(tolower($col\_classification)\textasciitilde{}/lignan/)}
\StringTok{            \{}
\StringTok{            printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savename}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
 \DocumentationTok{\#\#database idenfication (mgf vs msp)}
\NormalTok{ data1}\OtherTok{=}\StringTok{"com\_lignans\_and\_iridoids.tsv"}
\NormalTok{ datasource}\OtherTok{=}\StringTok{"../initial\_8\_neg.mgf"}
\NormalTok{ data2}\OtherTok{=}\StringTok{"../datasource.mgf"}
\NormalTok{ database}\OtherTok{=}\StringTok{"../MSMS{-}Public{-}Neg{-}VS15.msp"}
\NormalTok{ data3}\OtherTok{=}\StringTok{"../database.msp"}
\NormalTok{ tolerance}\OtherTok{=}\FloatTok{0.01}
\NormalTok{ ms2\_tolerance}\OtherTok{=}\FloatTok{0.2}
\NormalTok{ in\_tolerance}\OtherTok{=}\DecValTok{100}
\NormalTok{ weight1}\OtherTok{=}\DecValTok{80}
\NormalTok{ weight2}\OtherTok{=}\DecValTok{20}
\NormalTok{ point\_limit}\OtherTok{=}\DecValTok{80}
\NormalTok{ sed }\StringTok{\textquotesingle{}s/}\SpecialCharTok{\textbackslash{}r}\StringTok{//g\textquotesingle{}} \SpecialCharTok{$}\NormalTok{database }\SpecialCharTok{\textgreater{}}\NormalTok{ ..}\SpecialCharTok{/}\NormalTok{database.msp}
\NormalTok{ sed }\StringTok{\textquotesingle{}s/}\SpecialCharTok{\textbackslash{}r}\StringTok{//g\textquotesingle{}} \SpecialCharTok{$}\NormalTok{datasource }\SpecialCharTok{\textgreater{}}\NormalTok{ ..}\SpecialCharTok{/}\NormalTok{datasource.mgf}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        if(NR==1)}
\StringTok{            \{}
\StringTok{            p\_file=FILENAME}
\StringTok{            \textbackslash{}}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/\^{}id/)}
\StringTok{                    \{}
\StringTok{                    col\_id=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/m\textbackslash{}/z/)}
\StringTok{                    \{}
\StringTok{                    col\_mz=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(NR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            pre\_mz[$col\_id]=$col\_mz}
\StringTok{            \textbackslash{}}
\StringTok{            printf "info: datafile1 is ready. The data is " $col\_id " to " $col\_mz "}\SpecialCharTok{\textbackslash{}n}\StringTok{"  \#info}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FILENAME\textasciitilde{}/datasource.mgf/)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            close(p\_file)}
\StringTok{            \textbackslash{}}
\StringTok{            p\_file=FILENAME}
\StringTok{            \textbackslash{}}
\StringTok{            FS="[=]||[ ]"}
\StringTok{            \textbackslash{}}
\StringTok{            printf "info: datafile2 is ready." \#info}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            if($0\textasciitilde{}/FEATURE\_ID/)}
\StringTok{                \{}
\StringTok{                id=$2}
\StringTok{                \}}
\StringTok{            if($0\textasciitilde{}/MSLEVEL/)}
\StringTok{                \{}
\StringTok{                ms\_level=$2}
\StringTok{                \}}
\StringTok{            if(($0\textasciitilde{}/\^{}[0{-}9]/) \&\& ms\_level=2)}
\StringTok{                \{}
\StringTok{                count[id]+=1}
\StringTok{                \textbackslash{}}
\StringTok{                data2\_mz[id,count[id]]=$1}
\StringTok{                \textbackslash{}}
\StringTok{                data2\_in[id,count[id]]=$2}
\StringTok{                \textbackslash{}}
\StringTok{                if(data2\_max\_intensity[id]\textless{}$2)}
\StringTok{                    \{}
\StringTok{                    data2\_max\_intensity[id]=$2}
\StringTok{                    \}}
\StringTok{                printf "Info: "$1"\_"$2" \textgreater{}\textgreater{}\textgreater{} "id"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FILENAME\textasciitilde{}/.msp/)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            for(i in data2\_in)}
\StringTok{                \{}
\StringTok{                split(i,p,"[}\SpecialCharTok{\textbackslash{}034}\StringTok{]")}
\StringTok{                \textbackslash{}}
\StringTok{                data2\_in[i]*=(100/data2\_max\_intensity[p[1]])}
\StringTok{                \}}
\StringTok{            msp\_num+=1}
\StringTok{            \textbackslash{}}
\StringTok{            FS="[:][ ]||[}\SpecialCharTok{\textbackslash{}t}\StringTok{]"}
\StringTok{            \textbackslash{}}
\StringTok{            close(p\_file)}
\StringTok{            \textbackslash{}}
\StringTok{            p\_file=FILENAME}
\StringTok{            \textbackslash{}}
\StringTok{            n=split($0,c,"[:][ ]")}
\StringTok{            \textbackslash{}}
\StringTok{            name=c[n]}
\StringTok{            \textbackslash{}}
\StringTok{            printf "Info: datafile3 is ready. The first name is " name "}\SpecialCharTok{\textbackslash{}n}\StringTok{"  \#info}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            if($1\textasciitilde{}/NAME/)}
\StringTok{                \{}
\StringTok{                if(belong\_id[msp\_num]+0\textgreater{}=1)}
\StringTok{                    \{}
\StringTok{                    for(i=1; i\textless{}=database\_count[msp\_num]; i++)}
\StringTok{                        \{}
\StringTok{                        mz=data3\_mz[msp\_num,i]}
\StringTok{                        \textbackslash{}}
\StringTok{                        intensity=(data3\_in[msp\_num,i]/max\_in[msp\_num])*100}
\StringTok{                        \textbackslash{}}
\StringTok{                        if(intensity+0\textgreater{}=5)}
\StringTok{                            \{}
\StringTok{                            point=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{weight1}\StringTok{\textquotesingle{}}
\StringTok{                            \textbackslash{}}
\StringTok{                            full\_marks[msp\_num]+=point}
\StringTok{                            \}}
\StringTok{                        else}
\StringTok{                            \{}
\StringTok{                            point=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{weight2}\StringTok{\textquotesingle{}}
\StringTok{                            \textbackslash{}}
\StringTok{                            full\_marks[msp\_num]+=point}
\StringTok{                            \}}
\StringTok{                        for(j=1; j\textless{}=belong\_id[msp\_num]; j++)}
\StringTok{                            \{}
\StringTok{                            for(k=1; k\textless{}=count[subdirectory[msp\_num,j]]; k++)}
\StringTok{                                \{}
\StringTok{                                l1=data2\_mz[subdirectory[msp\_num,j],k]{-}\textquotesingle{}}\SpecialCharTok{$}\NormalTok{ms2\_tolerance}\StringTok{\textquotesingle{}}
\StringTok{                                \textbackslash{}}
\StringTok{                                m1=data2\_mz[subdirectory[msp\_num,j],k]+\textquotesingle{}}\SpecialCharTok{$}\NormalTok{ms2\_tolerance}\StringTok{\textquotesingle{}}
\StringTok{                                \textbackslash{}}
\StringTok{                                if(mz+0\textgreater{}=l1 \&\& mz+0\textless{}=m1+0)}
\StringTok{                                    \{}
\StringTok{                                    l2=data2\_in[subdirectory[msp\_num,j],k]{-}\textquotesingle{}}\SpecialCharTok{$}\NormalTok{in\_tolerance}\StringTok{\textquotesingle{}}
\StringTok{                                    \textbackslash{}}
\StringTok{                                    m2=data2\_in[subdirectory[msp\_num,j],k]+\textquotesingle{}}\SpecialCharTok{$}\NormalTok{in\_tolerance}\StringTok{\textquotesingle{}}
\StringTok{                                    \textbackslash{}}
\StringTok{                                    if(intensity+0\textgreater{}=l2+0 \&\& intensity+0\textless{}=m2+0)}
\StringTok{                                        \{}
\StringTok{                                        assign\_point[subdirectory[msp\_num,j],msp\_num]+=point;}
\StringTok{                                        \textbackslash{}}
\StringTok{                                        break;}
\StringTok{                                        \}}
\StringTok{                                    \}}
\StringTok{                                \}}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                msp\_num+=1}
\StringTok{                \textbackslash{}}
\StringTok{                name=$2}
\StringTok{                \}}
\StringTok{            if($1\textasciitilde{}/PRECURSORMZ/)}
\StringTok{                \{}
\StringTok{                for(i in pre\_mz)}
\StringTok{                    \{}
\StringTok{                    if($2+0\textgreater{}=pre\_mz[i]{-}\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tolerance}\StringTok{\textquotesingle{} \&\& $2\textless{}=pre\_mz[i]+\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tolerance}\StringTok{\textquotesingle{})}
\StringTok{                        \{}
\StringTok{                        printf "Info: the MS1 are " $2 " vs " pre\_mz[i] "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{                        \textbackslash{}}
\StringTok{                        data3\_mz[msp\_num]=$2}
\StringTok{                        \textbackslash{}}
\StringTok{                        belong\_id[msp\_num]+=1}
\StringTok{                        \textbackslash{}}
\StringTok{                        subdirectory[msp\_num,belong\_id[msp\_num]]=i}
\StringTok{                        \textbackslash{}}
\StringTok{                        assign[i,msp\_num]=name}
\StringTok{                        \textbackslash{}}
\StringTok{                        sep[i,msp\_num]=msp\_num}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            if(belong\_id[msp\_num]+0\textgreater{}=1)}
\StringTok{                \{}
\StringTok{                if($1\textasciitilde{}/PRECURSORTYPE/)}
\StringTok{                    \{}
\StringTok{                    data3\_type[msp\_num]=$2; getline;}
\StringTok{                    \textbackslash{}}
\StringTok{                    data3\_formula[msp\_num]=$2; getline;}
\StringTok{                    \textbackslash{}}
\StringTok{                    data3\_ontology[msp\_num]=$2; getline;}
\StringTok{                    \textbackslash{}}
\StringTok{                    data3\_inchikey[msp\_num]=$2; getline;}
\StringTok{                    \textbackslash{}}
\StringTok{                    data3\_smiles[msp\_num]=$2; getline;}
\StringTok{                    \textbackslash{}}
\StringTok{                    data3\_rt[msp\_num]=$2; getline;}
\StringTok{                    \textbackslash{}}
\StringTok{                    data3\_ccs[msp\_num]=$2;}
\StringTok{                    \}}
\StringTok{                if($1\textasciitilde{}/Num Peaks/)}
\StringTok{                    \{}
\StringTok{                    data3\_peaks[msp\_num]=$2}
\StringTok{                    \}}
\StringTok{                if($1\textasciitilde{}/\^{}[0{-}9]/)}
\StringTok{                    \{}
\StringTok{                    database\_count[msp\_num]+=1}
\StringTok{                    \textbackslash{}}
\StringTok{                    data3\_mz[msp\_num,database\_count[msp\_num]]=$1}
\StringTok{                    \textbackslash{}}
\StringTok{                    data3\_in[msp\_num,database\_count[msp\_num]]=$2}
\StringTok{                    \textbackslash{}}
\StringTok{                    if(max\_in[msp\_num]\textless{}$2)}
\StringTok{                        \{}
\StringTok{                        max\_in[msp\_num]=$2}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(msp\_num!="" \&\& (FILENAME\textasciitilde{}"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data1}\StringTok{\textquotesingle{}"))}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            FS="}\SpecialCharTok{\textbackslash{}t}\StringTok{"}
\StringTok{            \textbackslash{}}
\StringTok{            close(p\_file)}
\StringTok{            \textbackslash{}}
\StringTok{            printf $0"}\SpecialCharTok{\textbackslash{}t}\StringTok{" "custom\_idenfication}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "../idenfication\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data1}\StringTok{\textquotesingle{}.tsv"}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            printf $0 \textgreater{}\textgreater{} "../idenfication\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data1}\StringTok{\textquotesingle{}.tsv"}
\StringTok{            \textbackslash{}}
\StringTok{            for(i in assign\_point)}
\StringTok{                \{}
\StringTok{                if(i\textasciitilde{}"\^{}"$1"}\SpecialCharTok{\textbackslash{}034}\StringTok{" \&\& assign\_point[i]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{point\_limit}\StringTok{\textquotesingle{})}
\StringTok{                    \{}
\StringTok{                    score[i]=assign\_point[i]}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            for(n=asort(score,sort\_score); n\textgreater{}=1; n{-}{-})}
\StringTok{                \{}
\StringTok{                for(i in score)}
\StringTok{                    \{}
\StringTok{                    if(score[i]==sort\_score[n])}
\StringTok{                        \{}
\StringTok{                        printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{" score[i] "("  full\_marks[sep[i]]  ")"  " | " \textbackslash{}}
\StringTok{                        \textbackslash{}}
\StringTok{                        data3\_type[sep[i]] " | "  \textbackslash{}}
\StringTok{                        \textbackslash{}}
\StringTok{                        data3\_formula[sep[i]] " | " \textbackslash{}}
\StringTok{                        \textbackslash{}}
\StringTok{                        data3\_ontology[sep[i]] " | " \textbackslash{}}
\StringTok{                        \textbackslash{}}
\StringTok{                        assign[i] " | " \textbackslash{}}
\StringTok{                        \textbackslash{}}
\StringTok{                        \textgreater{}\textgreater{} "../idenfication\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data1}\StringTok{\textquotesingle{}.tsv"}
\StringTok{                        \textbackslash{}}
\StringTok{                        delete score[i]; break;}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            delete score}
\StringTok{            \textbackslash{}}
\StringTok{            printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "../idenfication\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data1}\StringTok{\textquotesingle{}.tsv"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3 }\SpecialCharTok{$}\NormalTok{data1}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \CommentTok{\#test xlogp parameter}
\NormalTok{ data}\OtherTok{=}\StringTok{"com\_lignans\_and\_iridoids.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==1)}
\StringTok{        \{}
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if($i\textasciitilde{}/similarity/)}
\StringTok{                \{}
\StringTok{                col\_similarity=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "0.4\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data}\StringTok{\textquotesingle{}"}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        if($col\_similarity+0\textgreater{}=0.4)}
\StringTok{            \{}
\StringTok{            printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "0.4\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\NormalTok{ data}\OtherTok{=}\StringTok{"0.5\_com\_compound.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==1)}
\StringTok{        \{}
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if($i\textasciitilde{}/similarity/)}
\StringTok{                \{}
\StringTok{                col\_similarity=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/\^{}rt$/)}
\StringTok{                \{}
\StringTok{                col\_rt=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/xlogp/)}
\StringTok{                \{}
\StringTok{                col\_xlogp=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/m\textbackslash{}/z/)}
\StringTok{                \{}
\StringTok{                col\_mz=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        if($col\_xlogp!="" \&\& $col\_mz+0\textgreater{}=400 \&\& $col\_mz+0\textless{}=800)}
\StringTok{            \{}
\StringTok{            n+=1}
\StringTok{            \textbackslash{}}
\StringTok{            sum\_x+=$col\_rt}
\StringTok{            \textbackslash{}}
\StringTok{            figure\_x[n]=$col\_rt}
\StringTok{            \textbackslash{}}
\StringTok{            sum\_y+=$col\_xlogp}
\StringTok{            \textbackslash{}}
\StringTok{            figure\_y[n]=$col\_xlogp}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        average\_x=sum\_x/n}
\StringTok{        \textbackslash{}}
\StringTok{        average\_y=sum\_y/n}
\StringTok{        \textbackslash{}}
\StringTok{        for(i=1; i\textless{}=n; i++)}
\StringTok{            \{}
\StringTok{            b\_up+=((figure\_x[i]{-}average\_x)*(figure\_y[i]+({-}1)*average\_y))}
\StringTok{            \textbackslash{}}
\StringTok{            b\_down+=((figure\_x[i]{-}average\_x)\^{}2)}
\StringTok{            \textbackslash{}}
\StringTok{            r\_up\_square\_root=b\_up}
\StringTok{            \textbackslash{}}
\StringTok{            r\_down\_1+=((figure\_x[i]{-}average\_x)\^{}2)}
\StringTok{            \textbackslash{}}
\StringTok{            r\_down\_2+=((figure\_y[i]+({-}1)*average\_y)\^{}2)}
\StringTok{            \}}
\StringTok{        b=b\_up/b\_down}
\StringTok{        \textbackslash{}}
\StringTok{        a=average\_y{-}b*average\_x}
\StringTok{        \textbackslash{}}
\StringTok{        r\_square=(r\_up\_square\_root\^{}2)/(r\_down\_1*r\_down\_2)}
\StringTok{        \textbackslash{}}
\StringTok{        printf "b="b  "}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "a="a  "}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "y=" b "x+" a "}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "r²="r\_square  "}\SpecialCharTok{\textbackslash{}n}\StringTok{"  average\_x "}\SpecialCharTok{\textbackslash{}t}\StringTok{"  average\_y "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\#B\_ratio}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\# need revise}
\NormalTok{ data1}\OtherTok{=}\StringTok{"../mobile\_phase\_system.tsv"}
\NormalTok{ data2}\OtherTok{=}\StringTok{"0.5\_com\_compound.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/\^{}time/)}
\StringTok{                    \{}
\StringTok{                    col\_time=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/\^{}B/)}
\StringTok{                    \{}
\StringTok{                    col\_B=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            x\_rt[FNR{-}1]=$col\_time}
\StringTok{            max\_rows=FNR{-}1}
\StringTok{            x1=$col\_time}
\StringTok{            y1=$col\_B}
\StringTok{            getline; }
\StringTok{            x2=$col\_time}
\StringTok{            y2=$col\_B}
\StringTok{            if(x2!="")}
\StringTok{                \{}
\StringTok{                b[FNR{-}1]=(y2{-}y1)/(x2{-}x1)}
\StringTok{                a[FNR{-}1]=y1{-}b[FNR{-}1]*x1}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FILENAME\textasciitilde{}/\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data2}\StringTok{\textquotesingle{}/)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            printf "" \textgreater{} "b\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data2}\StringTok{\textquotesingle{}"}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/\^{}rt$/)}
\StringTok{                    \{}
\StringTok{                    col\_rt=i}
\StringTok{                    \}}
\StringTok{                printf $i \textgreater{}\textgreater{} "b\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data2}\StringTok{\textquotesingle{}"}
\StringTok{                if(i!=NF)}
\StringTok{                    \{}
\StringTok{                    printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "b\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data2}\StringTok{\textquotesingle{}"}
\StringTok{                    \}}
\StringTok{                else}
\StringTok{                    \{}
\StringTok{                    printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "b\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data2}\StringTok{\textquotesingle{}"}
\StringTok{                    \}}
\StringTok{                if(col\_rt==i)}
\StringTok{                    \{}
\StringTok{                    printf "B\_ratio}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "b\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data2}\StringTok{\textquotesingle{}"}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                printf $i \textgreater{}\textgreater{} "b\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data2}\StringTok{\textquotesingle{}"}
\StringTok{                if(i!=NF)}
\StringTok{                    \{}
\StringTok{                    printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "b\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data2}\StringTok{\textquotesingle{}"}
\StringTok{                    \}}
\StringTok{                else}
\StringTok{                    \{}
\StringTok{                    printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "b\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data2}\StringTok{\textquotesingle{}"}
\StringTok{                    \}}
\StringTok{                if(col\_rt==i)}
\StringTok{                    \{}
\StringTok{                    for(j=1; j\textless{}=max\_rows; j++)}
\StringTok{                        \{}
\StringTok{                        if(x\_rt[j]+0\textless{}=$col\_rt+0 \&\& x\_rt[j+1]+0\textgreater{}=$col\_rt+0)}
\StringTok{                            \{}
\StringTok{                            B\_ratio=b[j]*$col\_rt+a[j]}
\StringTok{                            printf B\_ratio \textgreater{}\textgreater{} "b\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data2}\StringTok{\textquotesingle{}"}
\StringTok{                            break;}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                    printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "b\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data2}\StringTok{\textquotesingle{}"}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\# filter\_class}
\NormalTok{ data}\OtherTok{=}\StringTok{"results/stat\_classification.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(FNR==1)}
\StringTok{        \{}
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if($i\textasciitilde{}/\^{}definition$/)}
\StringTok{                \{}
\StringTok{                col\_class=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        class[$col\_class]=$col\_class}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        for(i in class)}
\StringTok{            \{}
\StringTok{            printf "" \textgreater{} "filter\_0\_class.tsv"}
\StringTok{            printf class[i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "filter\_0\_class.tsv"}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\NormalTok{ cat filter\_0\_class.tsv }\SpecialCharTok{|}\NormalTok{ trans }\SpecialCharTok{:}\NormalTok{zh }\SpecialCharTok{{-}}\NormalTok{b }\SpecialCharTok{\textgreater{}}\NormalTok{ filter\_0\_trans\_class.tsv}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ data1}\OtherTok{=}\StringTok{"filter\_0\_class.tsv"}
\NormalTok{ data2}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\NormalTok{ savepath}\OtherTok{=}\StringTok{"results/canopus\_pp\_filter.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}FNR)}
\StringTok{        \{}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ data1}\OtherTok{=}\StringTok{"filter\_class.tsv"}
\NormalTok{ data2}\OtherTok{=}\StringTok{"com\_compound.tsv"}
\NormalTok{ savename}\OtherTok{=}\StringTok{"less\_com\_compound.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        filter\_class[$2]=$1}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}FNR)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/classification/)}
\StringTok{                    \{}
\StringTok{                    col\_class=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/pro\textbackslash{}/raw/)}
\StringTok{                    \{}
\StringTok{                    col\_ratio=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savename}\StringTok{\textquotesingle{}"}
\StringTok{            print col\_class,col\_ratio}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            for(i in filter\_class)}
\StringTok{                \{}
\StringTok{                if($col\_class==filter\_class[i] \&\& $col\_ratio+0\textgreater{}=0)}
\StringTok{                    \{}
\StringTok{                    printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savename}\StringTok{\textquotesingle{}"}
\StringTok{                    \textbackslash{}}
\StringTok{                    break;}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \CommentTok{\#boxplot}
\NormalTok{ Rscript}\OtherTok{=}\ErrorTok{$}\NormalTok{(echo }\StringTok{\textquotesingle{}}
\StringTok{library(ggplot2)}
\StringTok{source\textless{}{-}read.table(file="boxplot.tsv",header=T,sep="}\SpecialCharTok{\textbackslash{}t}\StringTok{")}
\StringTok{boxplot\textless{}{-}ggplot(source,aes(x=classification,y=pro.raw,fill=classification))+}
\StringTok{  stat\_boxplot(geom="errorbar",width=0.3)+}
\StringTok{  geom\_boxplot()+}
\StringTok{  geom\_point(position="jitter",shape=21,size=3)+}
\StringTok{  theme(}
\StringTok{       legend.position="none",}
\StringTok{       axis.text.x = element\_blank(),}
\StringTok{       text = element\_text(size=30),}
\StringTok{       )+}
\StringTok{  geom\_text(data=source, aes(x=classification, y=30, label=classification),}
\StringTok{        color="black", fontface="bold", size=8, angle= 90, }
\StringTok{        inherit.aes = FALSE )+}
\StringTok{  stat\_summary(fun="mean",geom="point",shape=23,size=2.5,fill="grey")+}
\StringTok{  facet\_zoom(ylim = c(0, 10))}
\StringTok{pdf("boxplot.pdf",width=25,height=15)}
\StringTok{boxplot}
\StringTok{dev.off()}
\StringTok{\textquotesingle{}}\NormalTok{)}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\#for sunplot}
 \CommentTok{\#data1="filter\_class.tsv"}
\NormalTok{ data1}\OtherTok{=}\StringTok{"filter\_class.csv"} \CommentTok{\#lignans and iridoids}
\NormalTok{ data2}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\NormalTok{ data3}\OtherTok{=}\StringTok{"com\_compound.tsv"}
\NormalTok{ savename}\OtherTok{=}\StringTok{"for\_sun.tsv"}
 \CommentTok{\#ex\_export="com\_lignans\_and\_iridoids.tsv"}
\NormalTok{ ex\_export}\OtherTok{=}\StringTok{"com\_carboxylic\_acids.tsv"}
\NormalTok{ similarity\_limit}\OtherTok{=}\StringTok{"0.4"}
\NormalTok{ class\_pp\_limit}\OtherTok{=}\StringTok{"0.9"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        filter\_class[$1]=$2}
\StringTok{        \}}
\StringTok{    if(FILENAME\textasciitilde{}/canopus/)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            col\_id=1}
\StringTok{            for(i=2; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                for(j in filter\_class)}
\StringTok{                    \{}
\StringTok{                    if(j==$i)}
\StringTok{                        \{}
\StringTok{                        col\_class[j]=i}
\StringTok{                        print i}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            for(i in col\_class)}
\StringTok{                \{}
\StringTok{                if(sprintf("\%.3f",$col\_class[i])+0\textgreater{}="\textquotesingle{}}\SpecialCharTok{$}\NormalTok{class\_pp\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{                    \{}
\StringTok{                    class\_set[i,$col\_id]=i}
\StringTok{                    print i,$col\_class[i]}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FILENAME\textasciitilde{}/\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data3}\StringTok{\textquotesingle{}/)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/\^{}id/)}
\StringTok{                    \{}
\StringTok{                    col\_id=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/log10\_raw/)}
\StringTok{                    \{}
\StringTok{                    col\_log\_raw=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/log10\_pro/)}
\StringTok{                    \{}
\StringTok{                    col\_log\_pro=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/similarity/)}
\StringTok{                    \{}
\StringTok{                    col\_similarity=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "classification}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "log10\_raw}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "log10\_pro}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savename}\StringTok{\textquotesingle{}"}
\StringTok{            \textbackslash{}}
\StringTok{            printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{ex\_export}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            if($col\_similarity+0 \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{similarity\_limit}\StringTok{\textquotesingle{}")}
\StringTok{                \{}
\StringTok{                for(i in class\_set)}
\StringTok{                    \{}
\StringTok{                    if(i\textasciitilde{}"}\SpecialCharTok{\textbackslash{}034}\StringTok{"$col\_id"$")}
\StringTok{                        \{}
\StringTok{                        printf $col\_id"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  class\_set[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $col\_log\_raw"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $col\_log\_pro"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textbackslash{}}
\StringTok{                        \textbackslash{}}
\StringTok{                        \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savename}\StringTok{\textquotesingle{}"}
\StringTok{                        \textbackslash{}}
\StringTok{                        printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{ex\_export}\StringTok{\textquotesingle{}"}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\#sun.tsv}
 \DocumentationTok{\#\#\#matrix}
\CommentTok{\#    id classification  log10\_raw   log10\_pro}
\CommentTok{\#   147 Lignans, neolignans and related compounds   6.11895 6.51289}
\CommentTok{\#   147 Furofuran lignans   6.11895 6.51289}
\CommentTok{\#   147 O{-}methylated flavonoids 6.11895 6.51289}
\CommentTok{\#   147 Coumaric acids and derivatives  6.11895 6.51289}
\CommentTok{\#   147 Amino acids and derivatives 6.11895 6.51289}
\CommentTok{\#   147 Terpene glycosides  6.11895 6.51289}
\NormalTok{ data}\OtherTok{=}\StringTok{"for\_sun.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==1)}
\StringTok{        \{}
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if($i\textasciitilde{}/\^{}id/)}
\StringTok{                \{}
\StringTok{                col\_id=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/class/)}
\StringTok{                \{}
\StringTok{                col\_class=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/log10\_raw/)}
\StringTok{                \{}
\StringTok{                col\_log\_raw=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/log10\_pro/)}
\StringTok{                \{}
\StringTok{                col\_log\_pro=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        id[FNR]=$col\_id}
\StringTok{        class[FNR]=$col\_class}
\StringTok{        uniq\_class[$col\_class]=$col\_class}
\StringTok{        log\_raw[FNR]=$col\_log\_raw}
\StringTok{        log\_pro[FNR]=$col\_log\_pro}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        printf "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "group}\SpecialCharTok{\textbackslash{}t}\StringTok{"}
\StringTok{        for(i=2; i\textless{}=NR; i++)}
\StringTok{            \{}
\StringTok{            if(i\textless{}NR)}
\StringTok{                \{}
\StringTok{                printf "raw\_"id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "pro\_"id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}
\StringTok{                \}}
\StringTok{            if(i==NR)}
\StringTok{                \{}
\StringTok{                printf "raw\_"id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "pro\_"id[i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        for(i in uniq\_class)}
\StringTok{            \{}
\StringTok{            printf uniq\_class[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "NA}\SpecialCharTok{\textbackslash{}t}\StringTok{"}
\StringTok{                \{}
\StringTok{                for(j=2; j\textless{}=NR; j++)}
\StringTok{                    \{}
\StringTok{                    if(j\textless{}NR)}
\StringTok{                        \{}
\StringTok{                        if(class[j]==uniq\_class[i])}
\StringTok{                            \{}
\StringTok{                            if(log\_raw[j]!="{-}inf")}
\StringTok{                                \{}
\StringTok{                                printf log\_raw[j]*({-}1)"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  log\_pro[j]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}
\StringTok{                                \}}
\StringTok{                            else}
\StringTok{                                \{}
\StringTok{                                printf 0"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  log\_pro[j]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}
\StringTok{                                \}}
\StringTok{                            \}}
\StringTok{                        else}
\StringTok{                            \{}
\StringTok{                            printf "0}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "0}\SpecialCharTok{\textbackslash{}t}\StringTok{"}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                    else}
\StringTok{                        \{}
\StringTok{                        if(class[j]==uniq\_class[i])}
\StringTok{                            \{}
\StringTok{                            if(log\_raw[j]!="{-}inf")}
\StringTok{                                \{}
\StringTok{                                printf log\_raw[j]*({-}1)"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  log\_pro[j]"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{                                \}}
\StringTok{                            else}
\StringTok{                                \{}
\StringTok{                                printf 0"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  log\_pro[j]"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{                                \}}
\StringTok{                            \}}
\StringTok{                        else}
\StringTok{                            \{}
\StringTok{                            printf "0}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "0}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \textquotesingle{}} \SpecialCharTok{$}\NormalTok{data }\SpecialCharTok{\textgreater{}}\NormalTok{ sun.tsv}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ sort }\SpecialCharTok{{-}}\NormalTok{t }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{k }\DecValTok{7} \SpecialCharTok{{-}}\NormalTok{n com\_lignans\_and\_iridoids.tsv }\SpecialCharTok{\textgreater{}}\NormalTok{ test.tsv}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==1)}
\StringTok{        \{}
\StringTok{        printf "rank}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "log10\_pro}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{        rank=255}
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if($i\textasciitilde{}/pro\textbackslash{}/raw/)}
\StringTok{                \{}
\StringTok{                col\_ratio=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/log10\_raw/)}
\StringTok{                \{}
\StringTok{                col\_log\_raw=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        printf rank"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $col\_log\_raw+log($col\_log\_raw)/log(10)"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{        rank{-}=1}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}}\NormalTok{ test.tsv }\SpecialCharTok{\textgreater{}}\NormalTok{ rank.tsv}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#xcms}
\NormalTok{ data}\OtherTok{=}\StringTok{"com\_lignans\_and\_iridoids.tsv"}
\NormalTok{ savepath}\OtherTok{=}\StringTok{"../thermo\_mzML\_0518/EIC\_metadata.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==1)}
\StringTok{        \{}
\StringTok{        for(i=i; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if($i\textasciitilde{}/\^{}id$/)}
\StringTok{                \{}
\StringTok{                col\_id=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/m\textbackslash{}/z/)}
\StringTok{                \{}
\StringTok{                col\_mz=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "m/z}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        printf $col\_id"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $col\_mz"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \CommentTok{\#peak during time Correction}
\NormalTok{ data1}\OtherTok{=}\StringTok{"results/neg\_RT.tsv"}
\NormalTok{ data2}\OtherTok{=}\StringTok{"results/0924\_neg\_RT.tsv"}
\NormalTok{ savepath}\OtherTok{=}\StringTok{"results/re\_neg\_RT.tsv"}
\NormalTok{ mz\_tolerance}\OtherTok{=}\FloatTok{0.005}
\NormalTok{ rt\_tolerance}\OtherTok{=}\FloatTok{0.1}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/ID/)}
\StringTok{                    \{}
\StringTok{                    col\_id=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/retention/)}
\StringTok{                    \{}
\StringTok{                    col\_rt=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/m\textbackslash{}/z/)}
\StringTok{                    \{}
\StringTok{                    col\_mz=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            data1\_mz[$col\_id]=$col\_mz}
\StringTok{            data1\_rt[$col\_id]=$col\_rt}
\StringTok{            set[$col\_id]=$col\_id}
\StringTok{            dataset[$col\_id]=$0}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}FNR)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/ID/)}
\StringTok{                    \{}
\StringTok{                    col\_id=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/retention/)}
\StringTok{                    \{}
\StringTok{                    col\_rt=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/m\textbackslash{}/z/)}
\StringTok{                    \{}
\StringTok{                    col\_mz=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            data2\_mz[$col\_id]=$col\_mz}
\StringTok{            data2\_rt[$col\_id]=$col\_rt}
\StringTok{            for(i in data1\_mz)}
\StringTok{                \{}
\StringTok{                if(data1\_mz[i]\textless{}=$col\_mz+"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{mz\_tolerance}\StringTok{\textquotesingle{}" \&\& data1\_mz[i]\textgreater{}=$col\_mz{-}"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{mz\_tolerance}\StringTok{\textquotesingle{}")}
\StringTok{                    \{}
\StringTok{                    if(data1\_rt[i]\textless{}=$col\_rt+"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{rt\_tolerance}\StringTok{\textquotesingle{}" \&\& data1\_rt[i]\textgreater{}=$col\_rt{-}"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{rt\_tolerance}\StringTok{\textquotesingle{}")}
\StringTok{                        \{}
\StringTok{                        data1\_num[i]+=1}
\StringTok{                        delete set[i];}
\StringTok{                        print "data1",i,"\textgreater{}\textgreater{}\textgreater{}","data2",$col\_id,"\textgreater{}\textgreater{}\textgreater{}",data1\_num[i]}
\StringTok{                        printf i"}\SpecialCharTok{\textbackslash{}t}\StringTok{" data1\_mz[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" data1\_rt[i] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                        for(j=4; j\textless{}=NF; j++)}
\StringTok{                            \{}
\StringTok{                            printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"$j \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                            \}}
\StringTok{                        printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        for(i in set)}
\StringTok{            \{}
\StringTok{            printf dataset[i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            printf set[i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ datapath}\OtherTok{=}\StringTok{"/media/wizard/back/thermo\_mzML\_0518/EIC"}
\NormalTok{ mkdir }\SpecialCharTok{$}\NormalTok{datapath}\SpecialCharTok{/}\NormalTok{EIC\_merge}
\NormalTok{ echo }\StringTok{""} \SpecialCharTok{\textgreater{}} \ErrorTok{$}\NormalTok{datapath}\SpecialCharTok{/}\NormalTok{file.tsv}
\NormalTok{ data1}\OtherTok{=}\StringTok{"$datapath/../metadata.tsv"}
\NormalTok{ data2}\OtherTok{=}\StringTok{"$datapath/EIC*.mzML/*.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        if(NR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            total\_id[FNR]=$1}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FILENAME\textasciitilde{}/intensity/)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            n=split(FILENAME,f,"[/]")}
\StringTok{            split(f[n{-}1], g,"[\_]")}
\StringTok{            samplename=g[2]}
\StringTok{            split(f[n], a, "[\_]")}
\StringTok{            id=a[1]}
\StringTok{            if(samplename!=p\_samplename)}
\StringTok{                \{}
\StringTok{                num\_sample+=1}
\StringTok{                sample[num\_sample]=samplename}
\StringTok{                \}}
\StringTok{            p\_samplename=samplename}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=1)}
\StringTok{            \{}
\StringTok{            data\_scan[samplename,id,FNR]=$1}
\StringTok{            if($2!="NA")}
\StringTok{                \{}
\StringTok{                data\_intensity[samplename,id,FNR]=$2}
\StringTok{                \}}
\StringTok{            else}
\StringTok{                \{}
\StringTok{                data\_intensity[samplename,id,FNR]="0"}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FILENAME\textasciitilde{}/rt.tsv/)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            n=split(FILENAME,f,"[/]")}
\StringTok{            split(f[n{-}1], g,"[\_]")}
\StringTok{            samplename=g[2]}
\StringTok{            printf samplename"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=1)}
\StringTok{            \{}
\StringTok{            data\_scan[samplename,FNR]=$1}
\StringTok{            data\_rt[samplename,FNR]=$2}
\StringTok{            max\_rows[samplename]=FNR}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        for(i in total\_id)}
\StringTok{            \{}
\StringTok{            printf "rt}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "intensity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "sample}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{datapath}\StringTok{\textquotesingle{}/EIC\_merge/" total\_id[i] ".tsv"}
\StringTok{            for(j in sample)}
\StringTok{                \{}
\StringTok{                for(k=1; k\textless{}=max\_rows[sample[j]]; k++)}
\StringTok{                    \{}
\StringTok{                    printf data\_rt[sample[j],k]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  data\_intensity[sample[j],total\_id[i],k]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  sample[j]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textbackslash{}}
\StringTok{                    \textbackslash{}}
\StringTok{                    \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{datapath}\StringTok{\textquotesingle{}/EIC\_merge/" total\_id[i] ".tsv"}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ mkdir results}\SpecialCharTok{/}\NormalTok{EIC\_rt\_during}
\NormalTok{ data1}\OtherTok{=}\StringTok{"/media/wizard/back/thermo\_mzML\_0518/EIC/metadata.tsv"}
\NormalTok{ data2}\OtherTok{=}\StringTok{"results/re\_neg\_RT.tsv"}
\NormalTok{ data3}\OtherTok{=}\StringTok{"/media/wizard/back/thermo\_mzML\_0518/EIC/EIC\_merge/*.tsv"}
\NormalTok{ savepath}\OtherTok{=}\StringTok{"results/EIC\_rt\_during/"}
\NormalTok{ excess\_time}\OtherTok{=}\StringTok{"0.1"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        group\_name[$1]=$2}
\StringTok{        \}}
\StringTok{    if(FILENAME\textasciitilde{}/results/)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            p\_file=FILENAME}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/ID/)}
\StringTok{                    \{}
\StringTok{                    col\_id=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/m\textbackslash{}/z/)}
\StringTok{                    \{}
\StringTok{                    col\_mz=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/retention/)}
\StringTok{                    \{}
\StringTok{                    col\_rt=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/start$/)}
\StringTok{                    \{}
\StringTok{                    split($i,a,"[ ]")}
\StringTok{                    samplename=a[1]}
\StringTok{                    \# print samplename}
\StringTok{                    col\_start[samplename]=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/end$/)}
\StringTok{                    \{}
\StringTok{                    split($i,a,"[ ]")}
\StringTok{                    samplename=a[1]}
\StringTok{                    col\_end[samplename]=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            mz[$col\_id]=$col\_mz}
\StringTok{            \# print $col\_mz}
\StringTok{            center\_rt[$col\_id]=$col\_rt}
\StringTok{            for(i in col\_start)}
\StringTok{                \{}
\StringTok{                if($col\_start[i]!="0")}
\StringTok{                    \{}
\StringTok{                    rt\_start[$col\_id,i]=$col\_start[i]}
\StringTok{                    \# print $col\_start[i]}
\StringTok{                    \}}
\StringTok{                else if(reference\_sample[$col\_id]=="")}
\StringTok{                    \{}
\StringTok{                    for(j in col\_start)}
\StringTok{                        \{}
\StringTok{                        if($col\_start[j]!="0")}
\StringTok{                            \{}
\StringTok{                            rt\_start[$col\_id,i]=$col\_start[j]}
\StringTok{                            reference\_sample[$col\_id]=j}
\StringTok{                            break;}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                else}
\StringTok{                    \{}
\StringTok{                    rt\_start[$col\_id,i]=$col\_start[reference\_sample[$col\_id]]}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            for(i in col\_end)}
\StringTok{                \{}
\StringTok{                if($col\_end[i]!="0")}
\StringTok{                    \{}
\StringTok{                    rt\_end[$col\_id,i]=$col\_end[i]}
\StringTok{                    \}}
\StringTok{                else}
\StringTok{                    \{}
\StringTok{                    rt\_end[$col\_id,i]=$col\_end[reference\_sample[$col\_id]]}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FILENAME\textasciitilde{}/EIC\_merge/)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            close(p\_file)}
\StringTok{            p\_file=FILENAME}
\StringTok{            close("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" p\_id ".tsv")}
\StringTok{            num\_id+=1}
\StringTok{            n=split(FILENAME,a,"[/]||[.]")}
\StringTok{            id=a[n{-}1]}
\StringTok{            \# print id}
\StringTok{            p\_id=id}
\StringTok{            if(num\_id==1)}
\StringTok{                \{}
\StringTok{                for(i=1; i\textless{}=NF; i++)}
\StringTok{                    \{}
\StringTok{                    if($i\textasciitilde{}/\^{}rt/)}
\StringTok{                        \{}
\StringTok{                        col\_rt=i}
\StringTok{                        \}}
\StringTok{                    if($i\textasciitilde{}/intensity/)}
\StringTok{                        \{}
\StringTok{                        col\_intensity=i}
\StringTok{                        \}}
\StringTok{                    if($i\textasciitilde{}/sample/)}
\StringTok{                        \{}
\StringTok{                        col\_sample=i}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            printf $0"}\SpecialCharTok{\textbackslash{}t}\StringTok{" "group}\SpecialCharTok{\textbackslash{}t}\StringTok{" "label}\SpecialCharTok{\textbackslash{}t}\StringTok{" "color}\SpecialCharTok{\textbackslash{}t}\StringTok{" "mz}\SpecialCharTok{\textbackslash{}t}\StringTok{" "center\_rt}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" id ".tsv"}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            rt\_min=($col\_rt)/60}
\StringTok{            if(threshold[id,$col\_sample]=="")}
\StringTok{                \{}
\StringTok{                threshold[id,$col\_sample]=rt\_start[id,$col\_sample]+(rt\_end[id,$col\_sample]{-}rt\_start[id,$col\_sample])*(1/2)}
\StringTok{                \}}
\StringTok{            if(rt\_min\textgreater{}=rt\_start[id,$col\_sample]{-}"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{excess\_time}\StringTok{\textquotesingle{}" \&\& rt\_min\textless{}=rt\_end[id,$col\_sample]+"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{excess\_time}\StringTok{\textquotesingle{}")}
\StringTok{                \{}
\StringTok{                if(rt\_min+0\textgreater{}=threshold[id,$col\_sample] \&\& end\_sig[id,$col\_sample]!="1")}
\StringTok{                    \{}
\StringTok{                    label\_sig[id,$col\_sample]=1}
\StringTok{                    end\_sig[id,$col\_sample]=1}
\StringTok{                    \}}
\StringTok{                else}
\StringTok{                    \{}
\StringTok{                    label\_sig[id,$col\_sample]=0}
\StringTok{                    \}}
\StringTok{                if(rt\_min+0\textgreater{}=rt\_start[id,$col\_sample]+0 \&\& rt\_min+0\textless{}=rt\_end[id,$col\_sample]+0)}
\StringTok{                    \{}
\StringTok{                    color[id,$col\_sample]=group\_name[$col\_sample]}
\StringTok{                    \}}
\StringTok{                else}
\StringTok{                    \{}
\StringTok{                    color[id,$col\_sample]="Non feature"}
\StringTok{                    \}}
\StringTok{                printf sprintf("\%.2f",rt\_min)"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $col\_intensity"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $col\_sample"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  group\_name[$col\_sample]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                label\_sig[id,$col\_sample]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  color[id,$col\_sample] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" id ".tsv"}
\StringTok{                \textbackslash{}}
\StringTok{                start\_FNR[id]+=1}
\StringTok{                \textbackslash{}}
\StringTok{                if(start\_FNR[id]=="1")}
\StringTok{                    \{}
\StringTok{                    printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"sprintf("\%.4f",mz[id])  "}\SpecialCharTok{\textbackslash{}t}\StringTok{"sprintf("\%.2f",center\_rt[id]) \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" id ".tsv"}
\StringTok{                    \}}
\StringTok{                printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" id ".tsv"}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#use python rdkit }
\NormalTok{ conda activate my}\SpecialCharTok{{-}}\NormalTok{rdkit}\SpecialCharTok{{-}}\NormalTok{env}
\NormalTok{ savepath}\OtherTok{=}\StringTok{"results/structure\_2d"}
\NormalTok{ cd }\SpecialCharTok{$}\NormalTok{savepath}
\NormalTok{ data}\OtherTok{=}\StringTok{"../../com\_compound.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(FNR==1)}
\StringTok{        \{}
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if($i\textasciitilde{}/\^{}id/)}
\StringTok{                \{}
\StringTok{                col\_id=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/smiles/)}
\StringTok{                \{}
\StringTok{                col\_smiles=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        printf $col\_id "\_" $col\_smiles "|||"}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data }\SpecialCharTok{\textgreater{}}\NormalTok{ list}
\NormalTok{ python\_script}\OtherTok{=}\StringTok{"/home/wizard/Downloads/codes/python\_files/draw\_structure.py"}
\NormalTok{ python }\SpecialCharTok{$}\NormalTok{python\_script list}
 \DocumentationTok{\#\#\#\# build instance data}
\NormalTok{ data1}\OtherTok{=}\StringTok{"0703\_all/lignans\_and\_iridoids.tsv"}
\NormalTok{ data2}\OtherTok{=}\StringTok{"0703\_all/ftalign.tsv"}
\NormalTok{ savepath}\OtherTok{=}\StringTok{"instance\_data.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/\^{}id/)}
\StringTok{                    \{}
\StringTok{                    col\_id=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/\^{}classification/)}
\StringTok{                    \{}
\StringTok{                    col\_class=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            if($col\_class\textasciitilde{}/Lignans/)}
\StringTok{                \{}
\StringTok{                the\_id[$col\_id]=$col\_id}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}FNR)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            printf $1 \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            for(i=2; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                n=split($i, a, "[\_]")}
\StringTok{                for(j in the\_id)}
\StringTok{                    \{}
\StringTok{                    if(a[n]\textasciitilde{}"\^{}"j"$")}
\StringTok{                        \{}
\StringTok{                        col\_the\_id[a[n]]=i}
\StringTok{                        printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"a[n] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                        break;}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            n=split($1, b, "[\_]")}
\StringTok{            printf "Get row of "  FNR  " \textgreater{}\textgreater{}\textgreater{} " b[n] "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{            for(k in the\_id)}
\StringTok{                \{}
\StringTok{                if(b[n]==k)}
\StringTok{                    \{}
\StringTok{                    printf b[n] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                    for(i=2; i\textless{}=NF; i++)}
\StringTok{                        \{}
\StringTok{                        for(j in col\_the\_id)}
\StringTok{                            \{}
\StringTok{                            if(i==col\_the\_id[j])}
\StringTok{                                \{}
\StringTok{                                printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"$i \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                                break}
\StringTok{                                \}}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                    printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                    break;}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }
 \DocumentationTok{\#\#\#\# norm the instance data}
\NormalTok{ data}\OtherTok{=}\StringTok{"instance\_data.tsv"}
\NormalTok{ savepath}\OtherTok{=}\StringTok{"norm\_instance\_data.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{        raw[NR,i]=$i}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{    }
\StringTok{        printf raw[1,1] \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        for(i=2; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"raw[1,i] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        printf"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        for(a=2; a\textless{}=NR; a++)}
\StringTok{            \{}
\StringTok{            printf raw[a,1] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            for(b=2; b\textless{}=NF; b++)}
\StringTok{                \{}
\StringTok{                norm1[a,b]=raw[a,b]/raw[a,a];}
\StringTok{                norm2[a,b]=raw[a,b]/raw[b,b];}
\StringTok{                norms[a,b]=(norm1[a,b]+norm2[a,b])/2;}
\StringTok{                printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"norms[a,b] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                \}}
\StringTok{            printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
 \DocumentationTok{\#\#\#\# cut the data}
\NormalTok{ data1}\OtherTok{=}\StringTok{"instance\_data.tsv"}
\NormalTok{ data2}\OtherTok{=}\StringTok{"norm\_instance\_data.tsv"}
\NormalTok{ cut}\OtherTok{=}\StringTok{"51"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        if(FNR\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{cut}\StringTok{\textquotesingle{})}
\StringTok{            \{}
\StringTok{            printf $1 \textgreater{} "cut\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data1}\StringTok{\textquotesingle{}"}
\StringTok{            for(i=2; i\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{cut}\StringTok{\textquotesingle{}; i++)}
\StringTok{                \{}
\StringTok{                printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"$i \textgreater{}\textgreater{} "cut\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data1}\StringTok{\textquotesingle{}"}
\StringTok{                \}}
\StringTok{            printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "cut\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data1}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}FNR)}
\StringTok{        \{}
\StringTok{        if(FNR\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{cut}\StringTok{\textquotesingle{})}
\StringTok{            \{}
\StringTok{            printf $1 \textgreater{} "cut\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data2}\StringTok{\textquotesingle{}"}
\StringTok{            for(i=2; i\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{cut}\StringTok{\textquotesingle{}; i++)}
\StringTok{                \{}
\StringTok{                printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"$i \textgreater{}\textgreater{} "cut\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data2}\StringTok{\textquotesingle{}"}
\StringTok{                \}}
\StringTok{            printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "cut\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data2}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
 \DocumentationTok{\#\#\#\#}
\NormalTok{ Rscript }\SpecialCharTok{\textasciitilde{}}\ErrorTok{/}\NormalTok{Downloads}\SpecialCharTok{/}\NormalTok{codes}\SpecialCharTok{/}\NormalTok{ggplot2\_heatmap.R}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\# Add to Methodology Content \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\#\# violin plot}
\NormalTok{ mkdir multi\_pp\_class}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ data1}\OtherTok{=}\StringTok{"filter\_0\_class.tsv"} \CommentTok{\#lignans and iridoids}
\NormalTok{ data2}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\NormalTok{ data3}\OtherTok{=}\StringTok{"com\_compound.tsv"}
\NormalTok{ ex\_export}\OtherTok{=}\StringTok{"com\_1011.tsv"}
\NormalTok{ similarity\_limit}\OtherTok{=}\StringTok{"0.4"}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \ControlFlowTok{for}\NormalTok{ i }\ControlFlowTok{in} \FloatTok{0.4} \FloatTok{0.5} \FloatTok{0.6} \FloatTok{0.7} \FloatTok{0.8} \FloatTok{0.9} \FloatTok{0.95} \FloatTok{0.99}
\NormalTok{ do}
\NormalTok{ class\_pp\_limit}\OtherTok{=}\ErrorTok{$}\NormalTok{i}
 \CommentTok{\#class\_pp\_limit="0.9"}
\NormalTok{ savename}\OtherTok{=}\StringTok{"multi\_pp\_class/for\_sun\_$class\_pp\_limit.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        filter\_class[$1]=$2}
\StringTok{        \}}
\StringTok{    if(FILENAME\textasciitilde{}/canopus/)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            col\_id=1}
\StringTok{            for(i=2; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                for(j in filter\_class)}
\StringTok{                    \{}
\StringTok{                    if(j==$i)}
\StringTok{                        \{}
\StringTok{                        col\_class[j]=i}
\StringTok{                        print i}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            for(i in col\_class)}
\StringTok{                \{}
\StringTok{                if(sprintf("\%.3f",$col\_class[i])+0\textgreater{}="\textquotesingle{}}\SpecialCharTok{$}\NormalTok{class\_pp\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{                    \{}
\StringTok{                    class\_set[i,$col\_id]=i}
\StringTok{                    print i,$col\_class[i]}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FILENAME\textasciitilde{}/\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data3}\StringTok{\textquotesingle{}/)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/\^{}id/)}
\StringTok{                    \{}
\StringTok{                    col\_id=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/log10\_raw/)}
\StringTok{                    \{}
\StringTok{                    col\_log\_raw=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/log10\_pro/)}
\StringTok{                    \{}
\StringTok{                    col\_log\_pro=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/similarity/)}
\StringTok{                    \{}
\StringTok{                    col\_similarity=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "classification}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "log10\_raw}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "log10\_pro}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savename}\StringTok{\textquotesingle{}"}
\StringTok{            \textbackslash{}}
\StringTok{            printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{ex\_export}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            if($col\_similarity+0 \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{similarity\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{                \{}
\StringTok{                for(i in class\_set)}
\StringTok{                    \{}
\StringTok{                    if(i\textasciitilde{}"}\SpecialCharTok{\textbackslash{}034}\StringTok{"$col\_id"$")}
\StringTok{                        \{}
\StringTok{                        printf $col\_id"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  class\_set[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $col\_log\_raw"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $col\_log\_pro"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textbackslash{}}
\StringTok{                        \textbackslash{}}
\StringTok{                        \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savename}\StringTok{\textquotesingle{}"}
\StringTok{                        \textbackslash{}}
\StringTok{                        printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{ex\_export}\StringTok{\textquotesingle{}"}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\NormalTok{ done}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\#\# stat num}
 \ControlFlowTok{for}\NormalTok{ i }\ControlFlowTok{in} \FloatTok{0.4} \FloatTok{0.5} \FloatTok{0.6} \FloatTok{0.7} \FloatTok{0.8} \FloatTok{0.9} \FloatTok{0.95} \FloatTok{0.99}
\NormalTok{ do}
\NormalTok{ class\_pp\_limit}\OtherTok{=}\ErrorTok{$}\NormalTok{i}
\NormalTok{ data}\OtherTok{=}\StringTok{"multi\_pp\_class/for\_sun\_$class\_pp\_limit.tsv"}
\NormalTok{ savepath}\OtherTok{=}\StringTok{"multi\_pp\_class/for\_violin\_$\{class\_pp\_limit\}\_pattern.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(FNR==1)}
\StringTok{        \{}
\StringTok{        printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        \}}
\StringTok{    num[$2]+=1}
\StringTok{    data[FNR]=$0}
\StringTok{    class[FNR]=$2}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        for(i in num)}
\StringTok{            \{}
\StringTok{            print i,num[i]}
\StringTok{            if(num[i]+0\textgreater{}=50)}
\StringTok{                \{}
\StringTok{                for(j in class)}
\StringTok{                    \{}
\StringTok{                    if(class[j]==i)}
\StringTok{                        \{}
\StringTok{                        printf data[j]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\NormalTok{ done;}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#  the former is network\_facet}
 \ControlFlowTok{for}\NormalTok{ i }\ControlFlowTok{in} \FloatTok{0.4} \FloatTok{0.5} \FloatTok{0.6} \FloatTok{0.7} \FloatTok{0.8} \FloatTok{0.9} \FloatTok{0.95} \FloatTok{0.99}
\NormalTok{ do}
\NormalTok{ class\_pp\_limit}\OtherTok{=}\ErrorTok{$}\NormalTok{i}
\NormalTok{ mkdir results}\SpecialCharTok{/}\NormalTok{network\_facet\_ladder2\_}\SpecialCharTok{$}\NormalTok{class\_pp\_limit}
\NormalTok{ data1}\OtherTok{=}\StringTok{"multi\_pp\_class/for\_violin\_$\{class\_pp\_limit\}\_pattern.tsv"}
\NormalTok{ data2}\OtherTok{=}\StringTok{"results/source\_target\_tree\_0.4.tsv"} \CommentTok{\# "results/source\_target\_tree\_0.4.tsv"}
\NormalTok{ save\_class}\OtherTok{=}\StringTok{"results/filter\_child\_class.tsv"}
\NormalTok{ savepath}\OtherTok{=}\StringTok{"results/network\_facet\_ladder2\_$class\_pp\_limit/"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/classification/)}
\StringTok{                    \{}
\StringTok{                    col\_class=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/\^{}id$/)}
\StringTok{                    \{}
\StringTok{                    col\_id=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            class[$col\_class]=$col\_class}
\StringTok{            class\_id[$col\_class,$col\_id]=$col\_id}
\StringTok{            stat\_id[$col\_class,$col\_id]=$col\_id}
\StringTok{            belong[$col\_class,$col\_id]=$col\_class}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}FNR)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            printf "" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{save\_class}\StringTok{\textquotesingle{}"}
\StringTok{            for(i in class)}
\StringTok{                \{}
\StringTok{                printf i"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{save\_class}\StringTok{\textquotesingle{}"}
\StringTok{                printf $0"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "facet}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" i ".tsv"}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            for(i in class)}
\StringTok{                \{}
\StringTok{                if( class\_id[i,$1]==$1 \&\& class\_id[i,$2]==$2 )}
\StringTok{                    \{}
\StringTok{                    printf $0"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  i"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" i ".tsv"}
\StringTok{                    delete stat\_id[i,$1]}
\StringTok{                    delete stat\_id[i,$2]}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        for(i in stat\_id)}
\StringTok{            \{}
\StringTok{            \#\# source target similarity delta\_mz fp fp class}
\StringTok{            printf stat\_id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" stat\_id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "1}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "0}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "null}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "null}\SpecialCharTok{\textbackslash{}t}\StringTok{"  belong[i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textbackslash{}}
\StringTok{            \textbackslash{}}
\StringTok{            \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" belong[i] ".tsv"}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
\NormalTok{ done;}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\# for ring plot}
\NormalTok{ data1}\OtherTok{=}\StringTok{"canopus.tsv"}
\NormalTok{ data2}\OtherTok{=}\StringTok{"results/filter\_child\_class.tsv"}
\NormalTok{ data3}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\NormalTok{ savepath}\OtherTok{=}\StringTok{"results/canopus\_pp\_filter.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(FILENAME\textasciitilde{}/canopus.tsv/)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/absolute/)}
\StringTok{                    \{}
\StringTok{                    col\_index=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/\^{}id/)}
\StringTok{                    \{}
\StringTok{                    col\_chemid=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/name/)}
\StringTok{                    \{}
\StringTok{                    col\_name=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/description/)}
\StringTok{                    \{}
\StringTok{                    col\_des=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}2)}
\StringTok{            \{}
\StringTok{            ab\_index[$col\_name]=$col\_index}
\StringTok{            chemid[$col\_name]=$col\_chemid}
\StringTok{            des[$col\_name]=$col\_des}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FILENAME\textasciitilde{}/filter\_child\_class/)}
\StringTok{        \{}
\StringTok{        class[$1]=$1}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            printf "index}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "chem\_id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "description}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/child\_class.tsv"}
\StringTok{            \}}
\StringTok{        printf ab\_index[$1]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  chemid[$1]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $1"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  des[$1]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/child\_class.tsv"}
\StringTok{        \}}
\StringTok{    if(FILENAME\textasciitilde{}/canopus\_pp/)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            printf $1 \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            for(i=2; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if(class[$i]!="")}
\StringTok{                    \{}
\StringTok{                    n+=1}
\StringTok{                    printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{C"ab\_index[$i] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                    col\_set[n]=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            printf $1 \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            for(i=1; i\textless{}=n; i++)}
\StringTok{                \{}
\StringTok{                printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"$col\_set[i] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                \}}
\StringTok{            printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\# Eucommia peak erea normalized}
 \CommentTok{\# accoding: com\_lignans\_and\_iridoids.tsv }
\NormalTok{ data}\OtherTok{=}\NormalTok{com\_lignans\_and\_iridoids.tsv}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
 \DocumentationTok{\#\#\#\# \#\#\#\#\#\#\#\#\#\#\#\#  instance for 3d plot}
 \DocumentationTok{\#\#\# step1 RT \textasciitilde{} intensity}
\NormalTok{ Rscript }\SpecialCharTok{\textasciitilde{}}\ErrorTok{/}\NormalTok{Downloads}\SpecialCharTok{/}\NormalTok{codes}\SpecialCharTok{/}\NormalTok{instance\_3d\_xcms.R}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#  json tree }
\NormalTok{ mkdir json\_tree}
\NormalTok{ data1}\OtherTok{=}\StringTok{"com\_lignans\_and\_iridoids.tsv"}
\NormalTok{ id}\OtherTok{=}\DecValTok{2268}
\NormalTok{ formula}\OtherTok{=}\NormalTok{C17H24O10}
\NormalTok{ data2}\OtherTok{=}\StringTok{"/media/wizard/back/0703\_all/*\_$id/trees/$formula*.json"} \DocumentationTok{\#\#\#\#\#\#\# in media}
\NormalTok{ cp }\SpecialCharTok{$}\NormalTok{data2 json\_tree}\SpecialCharTok{/}\NormalTok{tree\_}\SpecialCharTok{$}\NormalTok{id.json}
 \CommentTok{\# id   rt  m/z classification  variety pro/raw}
 \CommentTok{\# 3918 13.2883753333333    701.22926   Terpene glycosides  increase    52.5192 }
 \CommentTok{\# 2529 11.5328771666667    699.24926   Lignan glycosides   increase    4.73482}
 \CommentTok{\# 3674 7.13257936666667    551.16124   Iridoid O{-}glycosides    increase    3.91387}
 \CommentTok{\# 3380 12.6588768333333    613.21304   Terpene glycosides  increase    3.9104}
\NormalTok{ data}\OtherTok{=}\StringTok{"json\_tree/tree\_$id.json"}
\NormalTok{ savepath}\OtherTok{=}\StringTok{"json\_tree/"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\StringTok{"[ ][:][ ]||[,]"} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if($0\textasciitilde{}/"root"/)}
\StringTok{        \{}
\StringTok{        root=$2}
\StringTok{        \}}
\StringTok{    if($0\textasciitilde{}/"id"/)}
\StringTok{        \{}
\StringTok{        id[$2]=$2;}
\StringTok{        the\_id=$2}
\StringTok{        getline;}
\StringTok{        formula[the\_id]=$2}
\StringTok{        \}}
\StringTok{    if($0\textasciitilde{}/"source"/)}
\StringTok{        \{}
\StringTok{        source[$2]=$2}
\StringTok{        link[$2]+=1}
\StringTok{        the\_source=$2}
\StringTok{        getline;}
\StringTok{        target[the\_source, link[the\_source]]=$2}
\StringTok{        getline;}
\StringTok{        formula\_edge[the\_source, link[the\_source]]=$2}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{" "label}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"  "nodes\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{id}\StringTok{\textquotesingle{}.tsv"}
\StringTok{        printf "from}\SpecialCharTok{\textbackslash{}t}\StringTok{" "to}\SpecialCharTok{\textbackslash{}t}\StringTok{" "label}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"  "edges\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{id}\StringTok{\textquotesingle{}.tsv"}
\StringTok{        \#\#\#\#\#}
\StringTok{        printf "root}\SpecialCharTok{\textbackslash{}t}\StringTok{" root"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"  "nodes\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{id}\StringTok{\textquotesingle{}.tsv"}
\StringTok{        for(i in id)}
\StringTok{            \{}
\StringTok{            printf i"}\SpecialCharTok{\textbackslash{}t}\StringTok{" formula[i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"  "nodes\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{id}\StringTok{\textquotesingle{}.tsv"}
\StringTok{            \}}
\StringTok{        for(i in source)}
\StringTok{            \{}
\StringTok{            for(j=1; j\textless{}=link[i]; j++)}
\StringTok{                \{}
\StringTok{                printf i"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  target[i,j]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" formula\_edge[i,j]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"  "edges\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{id}\StringTok{\textquotesingle{}.tsv"}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ Rscript }\SpecialCharTok{\textasciitilde{}}\ErrorTok{/}\NormalTok{Downloads}\SpecialCharTok{/}\NormalTok{codes}\SpecialCharTok{/}\NormalTok{json\_tree.R}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\# Image reshape}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ metadata}\OtherTok{=}\StringTok{"canopus\_neg.tsv"}
 \CommentTok{\#data="/media/wizard/back/0703\_all/490\_initial\_8\_neg\_495/canopus/C17H24O10\_[M{-}H]{-}.fpt"}
\NormalTok{ savepath}\OtherTok{=}\StringTok{"canopus\_parent\_index.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(FNR==1)}
\StringTok{        \{}
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if($i\textasciitilde{}/\^{}id/)}
\StringTok{                \{}
\StringTok{                col\_id=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/\^{}parent/)}
\StringTok{                \{}
\StringTok{                col\_parent=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        parent[$col\_id]=$col\_parent}
\StringTok{        rows[FNR]=$col\_id}
\StringTok{        \#print rows[FNR]}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        print "END"}
\StringTok{        printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "parentid}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "num}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        for(i=2; i\textless{}=FNR; i++)}
\StringTok{            \{}
\StringTok{            root=rows[i]}
\StringTok{            num[root]+=1}
\StringTok{            index\_id[rows[i]]=root}
\StringTok{            while(root!="")}
\StringTok{                \{}
\StringTok{                if(parent[root]!="")}
\StringTok{                    \{}
\StringTok{                    index\_id[rows[i]]=parent[root]"{-}"index\_id[rows[i]]}
\StringTok{                    num[parent[root]]+=1}
\StringTok{                    \}}
\StringTok{                root=parent[root]}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        for(i=2; i\textless{}=FNR; i++)}
\StringTok{            \{}
\StringTok{            printf rows[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  index\_id[rows[i]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  num[rows[i]]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{metadata}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\#\# 1028 violin plot}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ data1}\OtherTok{=}\StringTok{"filter\_0\_class.tsv"} \CommentTok{\#lignans and iridoids}
\NormalTok{ data2}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\NormalTok{ data3}\OtherTok{=}\StringTok{"com\_compound.tsv"}
\NormalTok{ ex\_export}\OtherTok{=}\StringTok{"com\_1011.tsv"}
\NormalTok{ similarity\_limit}\OtherTok{=}\StringTok{"0.4"}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ class\_pp\_limit}\OtherTok{=}\StringTok{"0.9"}
\NormalTok{ savename}\OtherTok{=}\StringTok{"for\_sun\_$class\_pp\_limit.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        filter\_class[$1]=$2}
\StringTok{        \}}
\StringTok{    if(FILENAME\textasciitilde{}/canopus/)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            col\_id=1}
\StringTok{            for(i=2; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                for(j in filter\_class)}
\StringTok{                    \{}
\StringTok{                    if(j==$i)}
\StringTok{                        \{}
\StringTok{                        col\_class[j]=i}
\StringTok{                        print i}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            for(i in col\_class)}
\StringTok{                \{}
\StringTok{                if(sprintf("\%.3f",$col\_class[i])+0 \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{class\_pp\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{                    \{}
\StringTok{                    class\_set[i,$col\_id]=i}
\StringTok{                    print i,$col\_class[i]}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FILENAME\textasciitilde{}/\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data3}\StringTok{\textquotesingle{}/)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/\^{}id/)}
\StringTok{                    \{}
\StringTok{                    col\_id=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/log10\_raw/)}
\StringTok{                    \{}
\StringTok{                    col\_log\_raw=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/log10\_pro/)}
\StringTok{                    \{}
\StringTok{                    col\_log\_pro=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/similarity/)}
\StringTok{                    \{}
\StringTok{                    col\_similarity=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "classification}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "log10\_raw}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "log10\_pro}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savename}\StringTok{\textquotesingle{}"}
\StringTok{            \textbackslash{}}
\StringTok{            printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{ex\_export}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            if($col\_similarity+0 \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{similarity\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{                \{}
\StringTok{                for(i in class\_set)}
\StringTok{                    \{}
\StringTok{                    if(i\textasciitilde{}"}\SpecialCharTok{\textbackslash{}034}\StringTok{"$col\_id"$")}
\StringTok{                        \{}
\StringTok{                        printf $col\_id"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  class\_set[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $col\_log\_raw"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $col\_log\_pro"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textbackslash{}}
\StringTok{                        \textbackslash{}}
\StringTok{                        \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savename}\StringTok{\textquotesingle{}"}
\StringTok{                        \textbackslash{}}
\StringTok{                        printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{ex\_export}\StringTok{\textquotesingle{}"}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\#\# stat num}
\NormalTok{ class\_pp\_limit}\OtherTok{=}\FloatTok{0.9}
\NormalTok{ data}\OtherTok{=}\StringTok{"for\_sun\_$class\_pp\_limit.tsv"}
\NormalTok{ savepath}\OtherTok{=}\StringTok{"for\_violin\_$\{class\_pp\_limit\}.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(FNR==1)}
\StringTok{        \{}
\StringTok{        printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        \}}
\StringTok{    num[$2]+=1}
\StringTok{    data[FNR]=$0}
\StringTok{    class[FNR]=$2}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        for(i in num)}
\StringTok{            \{}
\StringTok{            print i,num[i]}
\StringTok{            if(num[i]+0\textgreater{}=50)}
\StringTok{                \{}
\StringTok{                for(j in class)}
\StringTok{                    \{}
\StringTok{                    if(class[j]==i)}
\StringTok{                        \{}
\StringTok{                        printf data[j]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-blender.sh}{%
\section{File: blender.sh}\label{file-blender.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{source activate parl}
\NormalTok{tmux new }\SpecialCharTok{{-}}\NormalTok{s parl}
\NormalTok{tmux attach }\SpecialCharTok{{-}}\NormalTok{t parl}
\NormalTok{cd }\SpecialCharTok{\textasciitilde{}}\ErrorTok{/}\NormalTok{ParlAI; python setup.py develop}
\NormalTok{python projects}\SpecialCharTok{/}\NormalTok{personachat}\SpecialCharTok{/}\NormalTok{scripts}\SpecialCharTok{/}\NormalTok{kvmemnn\_interactive.py}
\NormalTok{python parlai}\SpecialCharTok{/}\NormalTok{scripts}\SpecialCharTok{/}\NormalTok{safe\_interactive.py }\SpecialCharTok{{-}}\NormalTok{mf zoo}\SpecialCharTok{:}\NormalTok{blender}\SpecialCharTok{/}\NormalTok{blender\_9B}\SpecialCharTok{/}\NormalTok{model }\SpecialCharTok{{-}}\NormalTok{t blended\_skill\_talk}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-cas_reformate.sh}{%
\section{File: cas\_reformate.sh}\label{file-cas_reformate.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{data}\OtherTok{=}\StringTok{"cas"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"cas\_arrange.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\StringTok{"[:]||[\textquotesingle{}][,][ ][\textquotesingle{}]||[\textquotesingle{}][,][ ][}\SpecialCharTok{\textbackslash{}"}\StringTok{]||[}\SpecialCharTok{\textbackslash{}"}\StringTok{][,][ ][}\SpecialCharTok{\textbackslash{}"}\StringTok{]||[}\SpecialCharTok{\textbackslash{}"}\StringTok{][,][ ][\textquotesingle{}]"} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if($1\textasciitilde{}/\^{}\textbackslash{}[/)}
\StringTok{        \{}
\StringTok{        name=$1}
\StringTok{        id\_num+=1}
\StringTok{        id[id\_num]=name}
\StringTok{        print id\_num, id[id\_num]}
\StringTok{        \}}
\StringTok{    if($1\textasciitilde{}/BEGIN\_compound/)}
\StringTok{        \{}
\StringTok{        num[id\_num]+=1}
\StringTok{        getline;}
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if($i \textasciitilde{} /[0{-}9](.*){-}[0{-}9][0{-}9]{-}[0{-}9](.*)$/ || $i \textasciitilde{} /\^{}CAS/)}
\StringTok{                \{}
\StringTok{                data[id\_num,num[id\_num]]=$i}
\StringTok{                break;}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        printf "number}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "cas}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        for(i=1; i\textless{}=id\_num; i++)}
\StringTok{            \{}
\StringTok{            printf i"}\SpecialCharTok{\textbackslash{}t}\StringTok{"id[i] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            print i"}\SpecialCharTok{\textbackslash{}t}\StringTok{"id[i]}
\StringTok{            for(j=1; j\textless{}=num[i]; j++)}
\StringTok{                \{}
\StringTok{                printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"data[i,j] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                \}}
\StringTok{            printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{data}\OtherTok{=}\StringTok{"cas\_arrange.tsv"}
\NormalTok{sed }\SpecialCharTok{{-}}\NormalTok{i }\SpecialCharTok{{-}}\NormalTok{e }\StringTok{\textquotesingle{}s/\textbackslash{}[//g; s/\textbackslash{}]//g; s/\{//g; s/\}//g\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-clamscan.sh}{%
\section{File: clamscan.sh}\label{file-clamscan.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{clamscan }\SpecialCharTok{{-}}\NormalTok{r }\SpecialCharTok{{-}{-}}\NormalTok{bell }\SpecialCharTok{{-}}\NormalTok{i }\SpecialCharTok{/}\NormalTok{home}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-colorful_line_eucommia_bash.sh}{%
\section{File: colorful\_line\_eucommia\_bash.sh}\label{file-colorful_line_eucommia_bash.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{datapath}\OtherTok{=}\StringTok{"/media/wizard/back/thermo\_mzML\_0518/EIC"}
\NormalTok{mkdir }\SpecialCharTok{$}\NormalTok{datapath}\SpecialCharTok{/}\NormalTok{EIC\_merge}
\NormalTok{echo }\StringTok{""} \SpecialCharTok{\textgreater{}} \ErrorTok{$}\NormalTok{datapath}\SpecialCharTok{/}\NormalTok{file.tsv}
\NormalTok{data1}\OtherTok{=}\StringTok{"$datapath/../metadata.tsv"}
\NormalTok{data2}\OtherTok{=}\StringTok{"$datapath/EIC*.mzML/*.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{      if(NR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          total\_id[FNR]=$1}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FILENAME\textasciitilde{}/intensity/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          n=split(FILENAME,f,"[/]")}
\StringTok{          split(f[n{-}1], g,"[\_]")}
\StringTok{          samplename=g[2]}
\StringTok{          split(f[n], a, "[\_]")}
\StringTok{          id=a[1]}
\StringTok{          if(samplename!=p\_samplename)}
\StringTok{            \{}
\StringTok{              num\_sample+=1}
\StringTok{              sample[num\_sample]=samplename}
\StringTok{            \}}
\StringTok{          p\_samplename=samplename}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=1)}
\StringTok{        \{}
\StringTok{          data\_scan[samplename,id,FNR]=$1}
\StringTok{          if($2!="NA")}
\StringTok{            \{}
\StringTok{              data\_intensity[samplename,id,FNR]=$2}
\StringTok{            \}}
\StringTok{        else}
\StringTok{          \{}
\StringTok{            data\_intensity[samplename,id,FNR]="0"}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{if(FILENAME\textasciitilde{}/rt.tsv/)}
\StringTok{  \{}
\StringTok{    if(FNR==1)}
\StringTok{      \{}
\StringTok{        n=split(FILENAME,f,"[/]")}
\StringTok{        split(f[n{-}1], g,"[\_]")}
\StringTok{        samplename=g[2]}
\StringTok{        printf samplename"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{      \}}
\StringTok{    if(FNR\textgreater{}=1)}
\StringTok{      \{}
\StringTok{        data\_scan[samplename,FNR]=$1}
\StringTok{        data\_rt[samplename,FNR]=$2}
\StringTok{        max\_rows[samplename]=FNR}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{\}}
\StringTok{END\{}
\StringTok{for(i in total\_id)}
\StringTok{  \{}
\StringTok{    printf "rt}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "intensity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "sample}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{datapath}\StringTok{\textquotesingle{}/EIC\_merge/" total\_id[i] ".tsv"}
\StringTok{    for(j in sample)}
\StringTok{      \{}
\StringTok{        for(k=1; k\textless{}=max\_rows[sample[j]]; k++)}
\StringTok{          \{}
\StringTok{            printf data\_rt[sample[j],k]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  data\_intensity[sample[j],total\_id[i],k]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  sample[j]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textbackslash{}}
\StringTok{              \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{datapath}\StringTok{\textquotesingle{}/EIC\_merge/" total\_id[i] ".tsv"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{mkdir results}\SpecialCharTok{/}\NormalTok{EIC\_rt\_during}
\NormalTok{data1}\OtherTok{=}\StringTok{"/media/wizard/back/thermo\_mzML\_0518/EIC/metadata.tsv"}
\NormalTok{data2}\OtherTok{=}\StringTok{"results/re\_neg\_RT.tsv"}
\NormalTok{data3}\OtherTok{=}\StringTok{"/media/wizard/back/thermo\_mzML\_0518/EIC/EIC\_merge/*.tsv"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"results/EIC\_rt\_during/"}
\NormalTok{excess\_time}\OtherTok{=}\StringTok{"0.1"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{      group\_name[$1]=$2}
\StringTok{    \}}
\StringTok{  if(FILENAME\textasciitilde{}/results/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          p\_file=FILENAME}
\StringTok{          for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if($i\textasciitilde{}/ID/)}
\StringTok{                \{}
\StringTok{                  col\_id=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/m\textbackslash{}/z/)}
\StringTok{                \{}
\StringTok{                  col\_mz=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/retention/)}
\StringTok{                \{}
\StringTok{                  col\_rt=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/start$/)}
\StringTok{                \{}
\StringTok{                  split($i,a,"[ ]")}
\StringTok{                  samplename=a[1]}
\StringTok{                  \# print samplename}
\StringTok{                  col\_start[samplename]=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/end$/)}
\StringTok{                \{}
\StringTok{                  split($i,a,"[ ]")}
\StringTok{                  samplename=a[1]}
\StringTok{                  col\_end[samplename]=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          mz[$col\_id]=$col\_mz}
\StringTok{          \# print $col\_mz}
\StringTok{          center\_rt[$col\_id]=$col\_rt}
\StringTok{          for(i in col\_start)}
\StringTok{            \{}
\StringTok{              if($col\_start[i]!="0")}
\StringTok{                \{}
\StringTok{                  rt\_start[$col\_id,i]=$col\_start[i]}
\StringTok{                  \# print $col\_start[i]}
\StringTok{                \}}
\StringTok{            else if(reference\_sample[$col\_id]=="")}
\StringTok{              \{}
\StringTok{                for(j in col\_start)}
\StringTok{                  \{}
\StringTok{                    if($col\_start[j]!="0")}
\StringTok{                      \{}
\StringTok{                        rt\_start[$col\_id,i]=$col\_start[j]}
\StringTok{                        reference\_sample[$col\_id]=j}
\StringTok{                        break;}
\StringTok{                      \}}
\StringTok{                  \}}
\StringTok{              \}}
\StringTok{          else}
\StringTok{            \{}
\StringTok{              rt\_start[$col\_id,i]=$col\_start[reference\_sample[$col\_id]]}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      for(i in col\_end)}
\StringTok{        \{}
\StringTok{          if($col\_end[i]!="0")}
\StringTok{            \{}
\StringTok{              rt\_end[$col\_id,i]=$col\_end[i]}
\StringTok{            \}}
\StringTok{        else}
\StringTok{          \{}
\StringTok{            rt\_end[$col\_id,i]=$col\_end[reference\_sample[$col\_id]]}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{\}}
\StringTok{if(FILENAME\textasciitilde{}/EIC\_merge/)}
\StringTok{  \{}
\StringTok{    if(FNR==1)}
\StringTok{      \{}
\StringTok{        close(p\_file)}
\StringTok{        p\_file=FILENAME}
\StringTok{        close("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" p\_id ".tsv")}
\StringTok{        num\_id+=1}
\StringTok{        n=split(FILENAME,a,"[/]||[.]")}
\StringTok{        id=a[n{-}1]}
\StringTok{        \# print id}
\StringTok{        p\_id=id}
\StringTok{        if(num\_id==1)}
\StringTok{          \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{              \{}
\StringTok{                if($i\textasciitilde{}/\^{}rt/)}
\StringTok{                  \{}
\StringTok{                    col\_rt=i}
\StringTok{                  \}}
\StringTok{                if($i\textasciitilde{}/intensity/)}
\StringTok{                  \{}
\StringTok{                    col\_intensity=i}
\StringTok{                  \}}
\StringTok{                if($i\textasciitilde{}/sample/)}
\StringTok{                  \{}
\StringTok{                    col\_sample=i}
\StringTok{                  \}}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{        printf $0"}\SpecialCharTok{\textbackslash{}t}\StringTok{" "group}\SpecialCharTok{\textbackslash{}t}\StringTok{" "label}\SpecialCharTok{\textbackslash{}t}\StringTok{" "color}\SpecialCharTok{\textbackslash{}t}\StringTok{" "mz}\SpecialCharTok{\textbackslash{}t}\StringTok{" "center\_rt}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" id ".tsv"}
\StringTok{      \}}
\StringTok{    if(FNR\textgreater{}=2)}
\StringTok{      \{}
\StringTok{        rt\_min=($col\_rt)/60}
\StringTok{        if(threshold[id,$col\_sample]=="")}
\StringTok{          \{}
\StringTok{            threshold[id,$col\_sample]=rt\_start[id,$col\_sample]+(rt\_end[id,$col\_sample]{-}rt\_start[id,$col\_sample])*(1/2)}
\StringTok{          \}}
\StringTok{        if(rt\_min\textgreater{}=rt\_start[id,$col\_sample]{-}"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{excess\_time}\StringTok{\textquotesingle{}" \&\& rt\_min\textless{}=rt\_end[id,$col\_sample]+"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{excess\_time}\StringTok{\textquotesingle{}")}
\StringTok{          \{}
\StringTok{            if(rt\_min+0\textgreater{}=threshold[id,$col\_sample] \&\& end\_sig[id,$col\_sample]!="1")}
\StringTok{              \{}
\StringTok{                label\_sig[id,$col\_sample]=1}
\StringTok{                end\_sig[id,$col\_sample]=1}
\StringTok{              \}}
\StringTok{          else}
\StringTok{            \{}
\StringTok{              label\_sig[id,$col\_sample]=0}
\StringTok{            \}}
\StringTok{          if(rt\_min+0\textgreater{}=rt\_start[id,$col\_sample]+0 \&\& rt\_min+0\textless{}=rt\_end[id,$col\_sample]+0)}
\StringTok{            \{}
\StringTok{              color[id,$col\_sample]=group\_name[$col\_sample]}
\StringTok{            \}}
\StringTok{        else}
\StringTok{          \{}
\StringTok{            color[id,$col\_sample]="Non feature"}
\StringTok{          \}}
\StringTok{        printf sprintf("\%.2f",rt\_min)"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $col\_intensity"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $col\_sample"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  group\_name[$col\_sample]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" label\_sig[id,$col\_sample]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  color[id,$col\_sample] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" id ".tsv"}
\StringTok{        start\_FNR[id]+=1}
\StringTok{        if(start\_FNR[id]=="1")}
\StringTok{          \{}
\StringTok{            printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"sprintf("\%.4f",mz[id])  "}\SpecialCharTok{\textbackslash{}t}\StringTok{"sprintf("\%.2f",center\_rt[id]) \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" id ".tsv"}
\StringTok{          \}}
\StringTok{        printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" id ".tsv"}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{\}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-convert_margin.sh}{%
\section{File: convert\_margin.sh}\label{file-convert_margin.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{convert cluster\_accuracy\_bar.png \textbackslash{}}
\SpecialCharTok{{-}}\NormalTok{define trim}\SpecialCharTok{:}\NormalTok{edges}\OtherTok{=}\NormalTok{north,east,south,west \textbackslash{}}
\SpecialCharTok{{-}}\NormalTok{background white \textbackslash{}}
\SpecialCharTok{{-}}\NormalTok{fuzz }\DecValTok{90}\NormalTok{\% \textbackslash{}}
\SpecialCharTok{{-}}\NormalTok{trim \textbackslash{}}
\NormalTok{test.png}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-display.sh}{%
\section{File: display.sh}\label{file-display.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"The Display Mode \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ parameter}
\ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{$}\NormalTok{parameter }\SpecialCharTok{==} \DecValTok{0}\NormalTok{ ]}
\NormalTok{then}
\NormalTok{  i}\OtherTok{=}\DecValTok{0}
\NormalTok{elif [ }\SpecialCharTok{$}\NormalTok{parameter }\SpecialCharTok{==} \DecValTok{1}\NormalTok{ ]}
\NormalTok{then}
\NormalTok{  i}\OtherTok{=}\DecValTok{9}
\NormalTok{fi}
\NormalTok{xrandr }\SpecialCharTok{{-}}\NormalTok{s }\SpecialCharTok{$}\NormalTok{i}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-eucommia_analysis.sh}{%
\section{File: eucommia\_analysis.sh}\label{file-eucommia_analysis.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# new algorithm (transform principle)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\# here the low pp will be filtered}
\NormalTok{data}\OtherTok{=}\StringTok{"results/stat\_classification.tsv"}
\NormalTok{stat}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==1)}
\StringTok{    \{}
\StringTok{      for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{          if($i\textasciitilde{}/\^{}id$/)}
\StringTok{            \{}
\StringTok{              col\_id=i}
\StringTok{            \}}
\StringTok{          if($i\textasciitilde{}/\^{}definition$/)}
\StringTok{            \{}
\StringTok{              col\_definition=i}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(NR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{      if($col\_definition!="null")}
\StringTok{        \{}
\StringTok{          id\_class[$col\_id]=$col\_definition}
\StringTok{          class\_num[$col\_definition]+=1}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{\}}
\StringTok{END\{}
\StringTok{for(i in class\_num)}
\StringTok{  \{}
\StringTok{    printf i"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  class\_num[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}
\StringTok{    for(j in id\_class)}
\StringTok{      \{}
\StringTok{        if(id\_class[j]==i)}
\StringTok{          \{}
\StringTok{            printf j"@"}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{    printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{  \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data }\SpecialCharTok{|}\NormalTok{ sed }\StringTok{\textquotesingle{}s/@$//g\textquotesingle{}}\NormalTok{)}
\NormalTok{data2}\OtherTok{=}\StringTok{"results/re\_neg\_RT.tsv"}
\NormalTok{echo }\StringTok{""} \SpecialCharTok{\textgreater{}}\NormalTok{ results}\SpecialCharTok{/}\NormalTok{neg\_RT.tsv}
\NormalTok{data3}\OtherTok{=}\StringTok{"results/neg\_RT.tsv"}
\NormalTok{compar1}\OtherTok{=}\StringTok{"Raw"}
\NormalTok{compar2}\OtherTok{=}\StringTok{"Pro"}
\NormalTok{log}\OtherTok{=}\DecValTok{10}
\NormalTok{log\_to}\OtherTok{=}\DecValTok{2}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F [}\StringTok{"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}\SpecialCharTok{@}\NormalTok{] }\SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{BEGIN\{}
\StringTok{maxNF=0}
\StringTok{rows=0}
\StringTok{compar1n=0}
\StringTok{compar2n=0}
\StringTok{\}}
\StringTok{\{}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{      rows+=1}
\StringTok{      if(maxNF\textless{}NF)}
\StringTok{        \{}
\StringTok{          maxNF=NF}
\StringTok{        \}}
\StringTok{      class[FNR]=$1}
\StringTok{      num[FNR]=$2}
\StringTok{      for(j=3; j\textless{}=NF; j++)}
\StringTok{        \{}
\StringTok{          id[FNR,j]=$j}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{else}
\StringTok{  \{}
\StringTok{    if(FNR==1 \&\& FILENAME\textasciitilde{}/re\_/)}
\StringTok{      \{}
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{          \{}
\StringTok{            if(($i\textasciitilde{}/\textquotesingle{}}\SpecialCharTok{$}\NormalTok{compar1}\StringTok{\textquotesingle{}/) \&\& $i\textasciitilde{}/area/)}
\StringTok{              \{}
\StringTok{                colum1[i]=i}
\StringTok{                compar1n+=1}
\StringTok{              \}}
\StringTok{            if(($i\textasciitilde{}/\textquotesingle{}}\SpecialCharTok{$}\NormalTok{compar2}\StringTok{\textquotesingle{}/) \&\& $i\textasciitilde{}/area/)}
\StringTok{              \{}
\StringTok{                colum2[i]=i}
\StringTok{                compar2n+=1}
\StringTok{              \}}
\StringTok{            if(($i\textasciitilde{}/retention/))}
\StringTok{              \{}
\StringTok{                rtcolum=i}
\StringTok{              \}}
\StringTok{            if(($i\textasciitilde{}/m\textbackslash{}/z/))}
\StringTok{              \{}
\StringTok{                mzcolum=i}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{    if(FNR\textgreater{}=2 \&\& $0!="")}
\StringTok{      \{}
\StringTok{        if(sum[1,$1]=="" \&\& sum[2,$1]=="") \#\#\#\#\#\#\#\# revise data }
\StringTok{          \{}
\StringTok{            sum[1,$1]=0}
\StringTok{            sum[2,$1]=0}
\StringTok{            rt[$1]=$rtcolum}
\StringTok{            mz[$1]=$mzcolum}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{              \{}
\StringTok{                if(i==colum1[i] \&\& colum1[i]!="")}
\StringTok{                  \{}
\StringTok{                    sum[1,$1]+=$i}
\StringTok{                  \}}
\StringTok{                if(i==colum2[i] \&\& colum2[i]!="")}
\StringTok{                  \{}
\StringTok{                    sum[2,$1]+=$i}
\StringTok{                  \}}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{\}}
\StringTok{END\{}
\StringTok{printf "class}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "log\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log}\StringTok{\textquotesingle{}\_raw}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "log\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log}\StringTok{\textquotesingle{}\_pro}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{  "log\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log}\StringTok{\textquotesingle{}\_delta\_area}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "pro\_to\_raw}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "log\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log\_to}\StringTok{\textquotesingle{}\_pro\_to\_raw}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "variety}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "number}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{} "algorithm.tsv"}
\StringTok{  printf "rt}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "m/z}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "algorithm.tsv"}
\StringTok{  for(i=1; i\textless{}=rows; i++)}
\StringTok{    \{}
\StringTok{      for(j=3; j\textless{}=maxNF; j++)}
\StringTok{        \{}
\StringTok{          if(id[i,j]!="")}
\StringTok{            \{}
\StringTok{              raw=(sum[1,id[i,j]]/compar1n)}
\StringTok{              pro=(sum[2,id[i,j]]/compar2n)}
\StringTok{              log\_raw=log(raw)/log(\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log}\StringTok{\textquotesingle{})}
\StringTok{              log\_pro=log(pro)/log(\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log}\StringTok{\textquotesingle{})}
\StringTok{              delta\_area=pro{-}raw}
\StringTok{              if(raw!=0)}
\StringTok{                \{}
\StringTok{                  to\_raw=pro/raw}
\StringTok{                  norm\_to\_raw=log(to\_raw)/log(\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log\_to}\StringTok{\textquotesingle{})}
\StringTok{                \}}
\StringTok{            else}
\StringTok{              \{}
\StringTok{                to\_raw="infinity"}
\StringTok{                norm\_to\_raw="infinity"}
\StringTok{              \}}
\StringTok{            if(delta\_area+0\textgreater{}0)}
\StringTok{              \{}
\StringTok{                norm\_delta=log(delta\_area)/log(\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log}\StringTok{\textquotesingle{})}
\StringTok{                variety="increase"}
\StringTok{              \}}
\StringTok{          else if(delta\_area\textless{}0)}
\StringTok{            \{}
\StringTok{              norm\_delta={-}1*(log({-}1*delta\_area)/log(\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log}\StringTok{\textquotesingle{}))}
\StringTok{              variety="decrease"}
\StringTok{            \}}
\StringTok{        else}
\StringTok{          \{}
\StringTok{            norm\_delta=0}
\StringTok{          \}}
\StringTok{        printf class[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  id[i,j]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  log\_raw"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  log\_pro"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{          norm\_delta"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  to\_raw"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  norm\_to\_raw"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  variety"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  num[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{          rt[id[i,j]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  mz[id[i,j]]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "algorithm.tsv"}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{\}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$stat"}\NormalTok{) }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{data}\OtherTok{=}\StringTok{"algorithm.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==1)}
\StringTok{    \{}
\StringTok{      print "id","rt","m/z","classification","variety","pro/raw","log10\_raw","log10\_pro","norm\_delta" \textgreater{} "compound.tsv"}
\StringTok{      for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{          if($i\textasciitilde{}/\^{}id/)}
\StringTok{            \{}
\StringTok{              col\_id=i}
\StringTok{            \}}
\StringTok{          if($i\textasciitilde{}/\^{}rt/)}
\StringTok{            \{}
\StringTok{              col\_rt=i}
\StringTok{            \}}
\StringTok{          if($i\textasciitilde{}/m\textbackslash{}/z/)}
\StringTok{            \{}
\StringTok{              col\_mz=i}
\StringTok{            \}}
\StringTok{          if($i\textasciitilde{}/class/)}
\StringTok{            \{}
\StringTok{              col\_class=i}
\StringTok{            \}}
\StringTok{          if($i\textasciitilde{}/variety/)}
\StringTok{            \{}
\StringTok{              col\_variety=i}
\StringTok{            \}}
\StringTok{          if($i\textasciitilde{}/\^{}pro\_to\_raw/)}
\StringTok{            \{}
\StringTok{              col\_ratio=i}
\StringTok{            \}}
\StringTok{          if($i\textasciitilde{}/log10\_raw/)}
\StringTok{            \{}
\StringTok{              col\_log10\_raw=i}
\StringTok{            \}}
\StringTok{          if($i\textasciitilde{}/log10\_pro/)}
\StringTok{            \{}
\StringTok{              col\_log10\_pro=i}
\StringTok{            \}}
\StringTok{          if($i\textasciitilde{}/delta\_area/)}
\StringTok{            \{}
\StringTok{              col\_delta=i}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(NR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{      print $col\_id, $col\_rt, sprintf("\%.5f",$col\_mz), $col\_class, $col\_variety, $col\_ratio, $col\_log10\_raw, $col\_log10\_pro, \textbackslash{}}
\StringTok{        $col\_delta \textbackslash{}}
\StringTok{        \textgreater{}\textgreater{} "compound.tsv"}
\StringTok{      \}}
\StringTok{  \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{data}\OtherTok{=}\StringTok{"results/fingerid\_first\_score.tsv"}
\NormalTok{list}\OtherTok{=}\StringTok{"compound.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}  }
\StringTok{\{}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if($i\textasciitilde{}/\^{}id/)}
\StringTok{                \{}
\StringTok{                  col\_id=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/similarity/)}
\StringTok{                \{}
\StringTok{                  col\_simi=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/name/)}
\StringTok{                \{}
\StringTok{                  col\_name=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/formula/)}
\StringTok{                \{}
\StringTok{                  col\_formula=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/\^{}inchi$/)}
\StringTok{                \{}
\StringTok{                  col\_inchi=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/smiles/)}
\StringTok{                \{}
\StringTok{                  col\_smiles=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/score/)}
\StringTok{                \{}
\StringTok{                  col\_score=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/xlogp/)}
\StringTok{                \{}
\StringTok{                  col\_xlogp=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/inchikey2D/)}
\StringTok{                \{}
\StringTok{                  col\_inchikey2D=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/links/)}
\StringTok{                \{}
\StringTok{                  col\_links=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          simi[$col\_id]=$col\_simi}
\StringTok{          name[$col\_id]=$col\_name}
\StringTok{          formula[$col\_id]=$col\_formula}
\StringTok{          smiles[$col\_id]=$col\_smiles}
\StringTok{          inchi[$col\_id]=$col\_inchi}
\StringTok{          inchikey2D[$col\_id]=$col\_inchikey2D}
\StringTok{          score[$col\_id]=$col\_score}
\StringTok{          xlogp[$col\_id]=$col\_xlogp}
\StringTok{          links[$col\_id]=$col\_links}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(NR!=FNR)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if($i\textasciitilde{}/\^{}id/)}
\StringTok{                \{}
\StringTok{                  col\_list\_id=i}
\StringTok{                \}}
\StringTok{              printf $i"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{} "com\_compound.tsv"}
\StringTok{            \}}
\StringTok{          printf "similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "formula}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "xlogp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "smiles}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{            "inchi}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchikey2D}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "links}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "com\_compound.tsv"}
\StringTok{          \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{          \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{              \{}
\StringTok{                printf $i"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "com\_compound.tsv"}
\StringTok{              \}}
\StringTok{            printf simi[$col\_list\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  name[$col\_list\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  formula[$col\_list\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  xlogp[$col\_list\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{              smiles[$col\_list\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" inchi[$col\_list\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  inchikey2D[$col\_list\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{              links[$col\_list\_id]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "com\_compound.tsv"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data }\SpecialCharTok{$}\NormalTok{list}
  \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
  \CommentTok{\#search }
\NormalTok{  data}\OtherTok{=}\StringTok{"com\_compound.tsv"}
\NormalTok{  savename}\OtherTok{=}\StringTok{"com\_lignans\_and\_iridoids.tsv"}
\NormalTok{  awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  \{}
\StringTok{    if(FNR==1)}
\StringTok{      \{}
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{          \{}
\StringTok{            if($i\textasciitilde{}/class/)}
\StringTok{              \{}
\StringTok{                col\_classification=i}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{        printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savename}\StringTok{\textquotesingle{}"}
\StringTok{      \}}
\StringTok{    if(FNR\textgreater{}=2)}
\StringTok{      \{}
\StringTok{        if(tolower($col\_classification)\textasciitilde{}/iridoid/)}
\StringTok{          \{}
\StringTok{            printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savename}\StringTok{\textquotesingle{}"}
\StringTok{          \}}
\StringTok{        if(tolower($col\_classification)\textasciitilde{}/lignan/)}
\StringTok{          \{}
\StringTok{            printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savename}\StringTok{\textquotesingle{}"}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{  \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\DocumentationTok{\#\#\# filter\_class}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}

 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\#sun.tsv}
 \DocumentationTok{\#\#\#matrix}
 \CommentTok{\#   id classification  log10\_raw   log10\_pro}
 \CommentTok{\#  147 Lignans, neolignans and related compounds   6.11895 6.51289}
 \CommentTok{\#  147 Furofuran lignans   6.11895 6.51289}
 \CommentTok{\#  147 O{-}methylated flavonoids 6.11895 6.51289}
 \CommentTok{\#  147 Coumaric acids and derivatives  6.11895 6.51289}
 \CommentTok{\#  147 Amino acids and derivatives 6.11895 6.51289}
 \CommentTok{\#  147 Terpene glycosides  6.11895 6.51289}
\NormalTok{ data}\OtherTok{=}\StringTok{"for\_sun.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{ \{}
\StringTok{   if(NR==1)}
\StringTok{     \{}
\StringTok{       for(i=1; i\textless{}=NF; i++)}
\StringTok{         \{}
\StringTok{           if($i\textasciitilde{}/\^{}id/)}
\StringTok{             \{}
\StringTok{               col\_id=i}
\StringTok{             \}}
\StringTok{           if($i\textasciitilde{}/class/)}
\StringTok{             \{}
\StringTok{               col\_class=i}
\StringTok{             \}}
\StringTok{           if($i\textasciitilde{}/log10\_raw/)}
\StringTok{             \{}
\StringTok{               col\_log\_raw=i}
\StringTok{             \}}
\StringTok{           if($i\textasciitilde{}/log10\_pro/)}
\StringTok{             \{}
\StringTok{               col\_log\_pro=i}
\StringTok{             \}}
\StringTok{         \}}
\StringTok{     \}}
\StringTok{   if(NR\textgreater{}=2)}
\StringTok{     \{}
\StringTok{       id[FNR]=$col\_id}
\StringTok{       class[FNR]=$col\_class}
\StringTok{       uniq\_class[$col\_class]=$col\_class}
\StringTok{       log\_raw[FNR]=$col\_log\_raw}
\StringTok{       log\_pro[FNR]=$col\_log\_pro}
\StringTok{     \}}
\StringTok{ \}}
\StringTok{END\{}
\StringTok{printf "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "group}\SpecialCharTok{\textbackslash{}t}\StringTok{"}
\StringTok{for(i=2; i\textless{}=NR; i++)}
\StringTok{  \{}
\StringTok{    if(i\textless{}NR)}
\StringTok{      \{}
\StringTok{        printf "raw\_"id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "pro\_"id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}
\StringTok{      \}}
\StringTok{    if(i==NR)}
\StringTok{      \{}
\StringTok{        printf "raw\_"id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "pro\_"id[i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{for(i in uniq\_class)}
\StringTok{  \{}
\StringTok{    printf uniq\_class[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "NA}\SpecialCharTok{\textbackslash{}t}\StringTok{"}
\StringTok{    \{}
\StringTok{      for(j=2; j\textless{}=NR; j++)}
\StringTok{        \{}
\StringTok{          if(j\textless{}NR)}
\StringTok{            \{}
\StringTok{              if(class[j]==uniq\_class[i])}
\StringTok{                \{}
\StringTok{                  if(log\_raw[j]!="{-}inf")}
\StringTok{                    \{}
\StringTok{                      printf log\_raw[j]*({-}1)"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  log\_pro[j]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}
\StringTok{                    \}}
\StringTok{                else}
\StringTok{                  \{}
\StringTok{                    printf 0"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  log\_pro[j]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}
\StringTok{                  \}}
\StringTok{              \}}
\StringTok{          else}
\StringTok{            \{}
\StringTok{              printf "0}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "0}\SpecialCharTok{\textbackslash{}t}\StringTok{"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    else}
\StringTok{      \{}
\StringTok{        if(class[j]==uniq\_class[i])}
\StringTok{          \{}
\StringTok{            if(log\_raw[j]!="{-}inf")}
\StringTok{              \{}
\StringTok{                printf log\_raw[j]*({-}1)"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  log\_pro[j]"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{              \}}
\StringTok{          else}
\StringTok{            \{}
\StringTok{              printf 0"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  log\_pro[j]"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    else}
\StringTok{      \{}
\StringTok{        printf "0}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "0}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{\}}
\StringTok{\}}
\StringTok{\}}
\StringTok{\}}
\StringTok{\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data }\SpecialCharTok{\textgreater{}}\NormalTok{ sun.tsv}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#}
\NormalTok{sort }\SpecialCharTok{{-}}\NormalTok{t }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{k }\DecValTok{7} \SpecialCharTok{{-}}\NormalTok{n com\_lignans\_and\_iridoids.tsv }\SpecialCharTok{\textgreater{}}\NormalTok{ test.tsv}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==1)}
\StringTok{    \{}
\StringTok{      printf "rank}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "log10\_pro}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{      rank=255}
\StringTok{      for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{          if($i\textasciitilde{}/pro\textbackslash{}/raw/)}
\StringTok{            \{}
\StringTok{              col\_ratio=i}
\StringTok{            \}}
\StringTok{          if($i\textasciitilde{}/log10\_raw/)}
\StringTok{            \{}
\StringTok{              col\_log\_raw=i}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(NR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{      printf rank"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $col\_log\_raw+log($col\_log\_raw)/log(10)"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{      rank{-}=1}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}}\NormalTok{ test.tsv }\SpecialCharTok{\textgreater{}}\NormalTok{ rank.tsv}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\DocumentationTok{\#\#xcms}
\NormalTok{data}\OtherTok{=}\StringTok{"com\_lignans\_and\_iridoids.tsv"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"../thermo\_mzML\_0518/EIC\_metadata.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==1)}
\StringTok{    \{}
\StringTok{      for(i=i; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{          if($i\textasciitilde{}/\^{}id$/)}
\StringTok{            \{}
\StringTok{              col\_id=i}
\StringTok{            \}}
\StringTok{          if($i\textasciitilde{}/m\textbackslash{}/z/)}
\StringTok{            \{}
\StringTok{              col\_mz=i}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "m/z}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{    \}}
\StringTok{  if(NR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{      printf $col\_id"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $col\_mz"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\CommentTok{\#peak during time Correction}
\NormalTok{data1}\OtherTok{=}\StringTok{"results/neg\_RT.tsv"}
\NormalTok{data2}\OtherTok{=}\StringTok{"results/0924\_neg\_RT.tsv"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"results/re\_neg\_RT.tsv"}
\NormalTok{mz\_tolerance}\OtherTok{=}\FloatTok{0.005}
\NormalTok{rt\_tolerance}\OtherTok{=}\FloatTok{0.1}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if($i\textasciitilde{}/ID/)}
\StringTok{                \{}
\StringTok{                  col\_id=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/retention/)}
\StringTok{                \{}
\StringTok{                  col\_rt=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/m\textbackslash{}/z/)}
\StringTok{                \{}
\StringTok{                  col\_mz=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          data1\_mz[$col\_id]=$col\_mz}
\StringTok{          data1\_rt[$col\_id]=$col\_rt}
\StringTok{          set[$col\_id]=$col\_id}
\StringTok{          dataset[$col\_id]=$0}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(NR\textgreater{}FNR)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{          for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if($i\textasciitilde{}/ID/)}
\StringTok{                \{}
\StringTok{                  col\_id=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/retention/)}
\StringTok{                \{}
\StringTok{                  col\_rt=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/m\textbackslash{}/z/)}
\StringTok{                \{}
\StringTok{                  col\_mz=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          data2\_mz[$col\_id]=$col\_mz}
\StringTok{          data2\_rt[$col\_id]=$col\_rt}
\StringTok{          for(i in data1\_mz)}
\StringTok{            \{}
\StringTok{              if(data1\_mz[i]\textless{}=$col\_mz+"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{mz\_tolerance}\StringTok{\textquotesingle{}" \&\& data1\_mz[i]\textgreater{}=$col\_mz{-}"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{mz\_tolerance}\StringTok{\textquotesingle{}")}
\StringTok{                \{}
\StringTok{                  if(data1\_rt[i]\textless{}=$col\_rt+"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{rt\_tolerance}\StringTok{\textquotesingle{}" \&\& data1\_rt[i]\textgreater{}=$col\_rt{-}"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{rt\_tolerance}\StringTok{\textquotesingle{}")}
\StringTok{                    \{}
\StringTok{                      data1\_num[i]+=1}
\StringTok{                      delete set[i];}
\StringTok{                      print "data1",i,"\textgreater{}\textgreater{}\textgreater{}","data2",$col\_id,"\textgreater{}\textgreater{}\textgreater{}",data1\_num[i]}
\StringTok{                      printf i"}\SpecialCharTok{\textbackslash{}t}\StringTok{" data1\_mz[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" data1\_rt[i] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                      for(j=4; j\textless{}=NF; j++)}
\StringTok{                        \{}
\StringTok{                          printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"$j \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                        \}}
\StringTok{                      printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{\}}
\StringTok{END\{}
\StringTok{for(i in set)}
\StringTok{  \{}
\StringTok{    printf dataset[i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{    printf set[i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{  \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{datapath}\OtherTok{=}\StringTok{"/media/wizard/back/thermo\_mzML\_0518/EIC"}
\NormalTok{mkdir }\SpecialCharTok{$}\NormalTok{datapath}\SpecialCharTok{/}\NormalTok{EIC\_merge}
\NormalTok{echo }\StringTok{""} \SpecialCharTok{\textgreater{}} \ErrorTok{$}\NormalTok{datapath}\SpecialCharTok{/}\NormalTok{file.tsv}
\NormalTok{data1}\OtherTok{=}\StringTok{"$datapath/../metadata.tsv"}
\NormalTok{data2}\OtherTok{=}\StringTok{"$datapath/EIC*.mzML/*.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{      if(NR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          total\_id[FNR]=$1}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FILENAME\textasciitilde{}/intensity/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          n=split(FILENAME,f,"[/]")}
\StringTok{          split(f[n{-}1], g,"[\_]")}
\StringTok{          samplename=g[2]}
\StringTok{          split(f[n], a, "[\_]")}
\StringTok{          id=a[1]}
\StringTok{          if(samplename!=p\_samplename)}
\StringTok{            \{}
\StringTok{              num\_sample+=1}
\StringTok{              sample[num\_sample]=samplename}
\StringTok{            \}}
\StringTok{          p\_samplename=samplename}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=1)}
\StringTok{        \{}
\StringTok{          data\_scan[samplename,id,FNR]=$1}
\StringTok{          if($2!="NA")}
\StringTok{            \{}
\StringTok{              data\_intensity[samplename,id,FNR]=$2}
\StringTok{            \}}
\StringTok{        else}
\StringTok{          \{}
\StringTok{            data\_intensity[samplename,id,FNR]="0"}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{if(FILENAME\textasciitilde{}/rt.tsv/)}
\StringTok{  \{}
\StringTok{    if(FNR==1)}
\StringTok{      \{}
\StringTok{        n=split(FILENAME,f,"[/]")}
\StringTok{        split(f[n{-}1], g,"[\_]")}
\StringTok{        samplename=g[2]}
\StringTok{        printf samplename"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{      \}}
\StringTok{    if(FNR\textgreater{}=1)}
\StringTok{      \{}
\StringTok{        data\_scan[samplename,FNR]=$1}
\StringTok{        data\_rt[samplename,FNR]=$2}
\StringTok{        max\_rows[samplename]=FNR}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{\}}
\StringTok{END\{}
\StringTok{for(i in total\_id)}
\StringTok{  \{}
\StringTok{    printf "rt}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "intensity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "sample}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{datapath}\StringTok{\textquotesingle{}/EIC\_merge/" total\_id[i] ".tsv"}
\StringTok{    for(j in sample)}
\StringTok{      \{}
\StringTok{        for(k=1; k\textless{}=max\_rows[sample[j]]; k++)}
\StringTok{          \{}
\StringTok{            printf data\_rt[sample[j],k]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  data\_intensity[sample[j],total\_id[i],k]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  sample[j]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textbackslash{}}
\StringTok{              \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{datapath}\StringTok{\textquotesingle{}/EIC\_merge/" total\_id[i] ".tsv"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{mkdir results}\SpecialCharTok{/}\NormalTok{EIC\_rt\_during}
\NormalTok{data1}\OtherTok{=}\StringTok{"/media/wizard/back/thermo\_mzML\_0518/EIC/metadata.tsv"}
\NormalTok{data2}\OtherTok{=}\StringTok{"results/re\_neg\_RT.tsv"}
\NormalTok{data3}\OtherTok{=}\StringTok{"/media/wizard/back/thermo\_mzML\_0518/EIC/EIC\_merge/*.tsv"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"results/EIC\_rt\_during/"}
\NormalTok{excess\_time}\OtherTok{=}\StringTok{"0.1"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{      group\_name[$1]=$2}
\StringTok{    \}}
\StringTok{  if(FILENAME\textasciitilde{}/results/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          p\_file=FILENAME}
\StringTok{          for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if($i\textasciitilde{}/ID/)}
\StringTok{                \{}
\StringTok{                  col\_id=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/m\textbackslash{}/z/)}
\StringTok{                \{}
\StringTok{                  col\_mz=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/retention/)}
\StringTok{                \{}
\StringTok{                  col\_rt=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/start$/)}
\StringTok{                \{}
\StringTok{                  split($i,a,"[ ]")}
\StringTok{                  samplename=a[1]}
\StringTok{                  \# print samplename}
\StringTok{                  col\_start[samplename]=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/end$/)}
\StringTok{                \{}
\StringTok{                  split($i,a,"[ ]")}
\StringTok{                  samplename=a[1]}
\StringTok{                  col\_end[samplename]=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          mz[$col\_id]=$col\_mz}
\StringTok{          \# print $col\_mz}
\StringTok{          center\_rt[$col\_id]=$col\_rt}
\StringTok{          for(i in col\_start)}
\StringTok{            \{}
\StringTok{              if($col\_start[i]!="0")}
\StringTok{                \{}
\StringTok{                  rt\_start[$col\_id,i]=$col\_start[i]}
\StringTok{                  \# print $col\_start[i]}
\StringTok{                \}}
\StringTok{            else if(reference\_sample[$col\_id]=="")}
\StringTok{              \{}
\StringTok{                for(j in col\_start)}
\StringTok{                  \{}
\StringTok{                    if($col\_start[j]!="0")}
\StringTok{                      \{}
\StringTok{                        rt\_start[$col\_id,i]=$col\_start[j]}
\StringTok{                        reference\_sample[$col\_id]=j}
\StringTok{                        break;}
\StringTok{                      \}}
\StringTok{                  \}}
\StringTok{              \}}
\StringTok{          else}
\StringTok{            \{}
\StringTok{              rt\_start[$col\_id,i]=$col\_start[reference\_sample[$col\_id]]}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      for(i in col\_end)}
\StringTok{        \{}
\StringTok{          if($col\_end[i]!="0")}
\StringTok{            \{}
\StringTok{              rt\_end[$col\_id,i]=$col\_end[i]}
\StringTok{            \}}
\StringTok{        else}
\StringTok{          \{}
\StringTok{            rt\_end[$col\_id,i]=$col\_end[reference\_sample[$col\_id]]}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{\}}
\StringTok{if(FILENAME\textasciitilde{}/EIC\_merge/)}
\StringTok{  \{}
\StringTok{    if(FNR==1)}
\StringTok{      \{}
\StringTok{        close(p\_file)}
\StringTok{        p\_file=FILENAME}
\StringTok{        close("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" p\_id ".tsv")}
\StringTok{        num\_id+=1}
\StringTok{        n=split(FILENAME,a,"[/]||[.]")}
\StringTok{        id=a[n{-}1]}
\StringTok{        \# print id}
\StringTok{        p\_id=id}
\StringTok{        if(num\_id==1)}
\StringTok{          \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{              \{}
\StringTok{                if($i\textasciitilde{}/\^{}rt/)}
\StringTok{                  \{}
\StringTok{                    col\_rt=i}
\StringTok{                  \}}
\StringTok{                if($i\textasciitilde{}/intensity/)}
\StringTok{                  \{}
\StringTok{                    col\_intensity=i}
\StringTok{                  \}}
\StringTok{                if($i\textasciitilde{}/sample/)}
\StringTok{                  \{}
\StringTok{                    col\_sample=i}
\StringTok{                  \}}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{        printf $0"}\SpecialCharTok{\textbackslash{}t}\StringTok{" "group}\SpecialCharTok{\textbackslash{}t}\StringTok{" "label}\SpecialCharTok{\textbackslash{}t}\StringTok{" "color}\SpecialCharTok{\textbackslash{}t}\StringTok{" "mz}\SpecialCharTok{\textbackslash{}t}\StringTok{" "center\_rt}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" id ".tsv"}
\StringTok{      \}}
\StringTok{    if(FNR\textgreater{}=2)}
\StringTok{      \{}
\StringTok{        rt\_min=($col\_rt)/60}
\StringTok{        if(threshold[id,$col\_sample]=="")}
\StringTok{          \{}
\StringTok{            threshold[id,$col\_sample]=rt\_start[id,$col\_sample]+(rt\_end[id,$col\_sample]{-}rt\_start[id,$col\_sample])*(1/2)}
\StringTok{          \}}
\StringTok{        if(rt\_min\textgreater{}=rt\_start[id,$col\_sample]{-}"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{excess\_time}\StringTok{\textquotesingle{}" \&\& rt\_min\textless{}=rt\_end[id,$col\_sample]+"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{excess\_time}\StringTok{\textquotesingle{}")}
\StringTok{          \{}
\StringTok{            if(rt\_min+0\textgreater{}=threshold[id,$col\_sample] \&\& end\_sig[id,$col\_sample]!="1")}
\StringTok{              \{}
\StringTok{                label\_sig[id,$col\_sample]=1}
\StringTok{                end\_sig[id,$col\_sample]=1}
\StringTok{              \}}
\StringTok{          else}
\StringTok{            \{}
\StringTok{              label\_sig[id,$col\_sample]=0}
\StringTok{            \}}
\StringTok{          if(rt\_min+0\textgreater{}=rt\_start[id,$col\_sample]+0 \&\& rt\_min+0\textless{}=rt\_end[id,$col\_sample]+0)}
\StringTok{            \{}
\StringTok{              color[id,$col\_sample]=group\_name[$col\_sample]}
\StringTok{            \}}
\StringTok{        else}
\StringTok{          \{}
\StringTok{            color[id,$col\_sample]="Non feature"}
\StringTok{          \}}
\StringTok{        printf sprintf("\%.2f",rt\_min)"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $col\_intensity"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $col\_sample"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  group\_name[$col\_sample]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" label\_sig[id,$col\_sample]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  color[id,$col\_sample] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" id ".tsv"}
\StringTok{        start\_FNR[id]+=1}
\StringTok{        if(start\_FNR[id]=="1")}
\StringTok{          \{}
\StringTok{            printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"sprintf("\%.4f",mz[id])  "}\SpecialCharTok{\textbackslash{}t}\StringTok{"sprintf("\%.2f",center\_rt[id]) \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" id ".tsv"}
\StringTok{          \}}
\StringTok{        printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" id ".tsv"}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{\}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\# violin plot}
\NormalTok{mkdir multi\_pp\_class}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{data1}\OtherTok{=}\StringTok{"filter\_0\_class.tsv"} \CommentTok{\#lignans and iridoids}
\NormalTok{data2}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\NormalTok{data3}\OtherTok{=}\StringTok{"com\_compound.tsv"}
\NormalTok{ex\_export}\OtherTok{=}\StringTok{"com\_1011.tsv"}
\NormalTok{similarity\_limit}\OtherTok{=}\StringTok{"0.4"}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\ControlFlowTok{for}\NormalTok{ i }\ControlFlowTok{in} \FloatTok{0.4} \FloatTok{0.5} \FloatTok{0.6} \FloatTok{0.7} \FloatTok{0.8} \FloatTok{0.9} \FloatTok{0.95} \FloatTok{0.99}
\NormalTok{do}
\NormalTok{  class\_pp\_limit}\OtherTok{=}\ErrorTok{$}\NormalTok{i}
  \CommentTok{\#class\_pp\_limit="0.9"}
\NormalTok{  savename}\OtherTok{=}\StringTok{"multi\_pp\_class/for\_sun\_$class\_pp\_limit.tsv"}
\NormalTok{  awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  \{}
\StringTok{    if(NR==FNR)}
\StringTok{      \{}
\StringTok{        filter\_class[$1]=$2}
\StringTok{      \}}
\StringTok{    if(FILENAME\textasciitilde{}/canopus/)}
\StringTok{      \{}
\StringTok{        if(FNR==1)}
\StringTok{          \{}
\StringTok{            col\_id=1}
\StringTok{            for(i=2; i\textless{}=NF; i++)}
\StringTok{              \{}
\StringTok{                for(j in filter\_class)}
\StringTok{                  \{}
\StringTok{                    if(j==$i)}
\StringTok{                      \{}
\StringTok{                        col\_class[j]=i}
\StringTok{                        print i}
\StringTok{                      \}}
\StringTok{                  \}}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{          \{}
\StringTok{            for(i in col\_class)}
\StringTok{              \{}
\StringTok{                if(sprintf("\%.3f",$col\_class[i])+0\textgreater{}="\textquotesingle{}}\SpecialCharTok{$}\NormalTok{class\_pp\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{                  \{}
\StringTok{                    class\_set[i,$col\_id]=i}
\StringTok{                    print i,$col\_class[i]}
\StringTok{                  \}}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{    if(FILENAME\textasciitilde{}/\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data3}\StringTok{\textquotesingle{}/)}
\StringTok{      \{}
\StringTok{        if(FNR==1)}
\StringTok{          \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{              \{}
\StringTok{                if($i\textasciitilde{}/\^{}id/)}
\StringTok{                  \{}
\StringTok{                    col\_id=i}
\StringTok{                  \}}
\StringTok{                if($i\textasciitilde{}/log10\_raw/)}
\StringTok{                  \{}
\StringTok{                    col\_log\_raw=i}
\StringTok{                  \}}
\StringTok{                if($i\textasciitilde{}/log10\_pro/)}
\StringTok{                  \{}
\StringTok{                    col\_log\_pro=i}
\StringTok{                  \}}
\StringTok{                if($i\textasciitilde{}/similarity/)}
\StringTok{                  \{}
\StringTok{                    col\_similarity=i}
\StringTok{                  \}}
\StringTok{              \}}
\StringTok{            printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "classification}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "log10\_raw}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "log10\_pro}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savename}\StringTok{\textquotesingle{}"}
\StringTok{            printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{ex\_export}\StringTok{\textquotesingle{}"}
\StringTok{          \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{          \{}
\StringTok{            if($col\_similarity+0 \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{similarity\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{              \{}
\StringTok{                for(i in class\_set)}
\StringTok{                  \{}
\StringTok{                    if(i\textasciitilde{}"}\SpecialCharTok{\textbackslash{}034}\StringTok{"$col\_id"$")}
\StringTok{                      \{}
\StringTok{                        printf $col\_id"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  class\_set[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $col\_log\_raw"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $col\_log\_pro"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savename}\StringTok{\textquotesingle{}"}
\StringTok{                        printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{ex\_export}\StringTok{\textquotesingle{}"}
\StringTok{                      \}}
\StringTok{                  \}}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{  \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\NormalTok{done}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\# stat num}
\ControlFlowTok{for}\NormalTok{ i }\ControlFlowTok{in} \FloatTok{0.4} \FloatTok{0.5} \FloatTok{0.6} \FloatTok{0.7} \FloatTok{0.8} \FloatTok{0.9} \FloatTok{0.95} \FloatTok{0.99}
\NormalTok{do}
\NormalTok{  class\_pp\_limit}\OtherTok{=}\ErrorTok{$}\NormalTok{i}
\NormalTok{  data}\OtherTok{=}\StringTok{"multi\_pp\_class/for\_sun\_$class\_pp\_limit.tsv"}
\NormalTok{  savepath}\OtherTok{=}\StringTok{"multi\_pp\_class/for\_violin\_$\{class\_pp\_limit\}\_pattern.tsv"}
\NormalTok{  awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  \{}
\StringTok{    if(FNR==1)}
\StringTok{      \{}
\StringTok{        printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{      \}}
\StringTok{    num[$2]+=1}
\StringTok{    data[FNR]=$0}
\StringTok{    class[FNR]=$2}
\StringTok{  \}}
\StringTok{END\{}
\StringTok{for(i in num)}
\StringTok{  \{}
\StringTok{    print i,num[i]}
\StringTok{    if(num[i]+0\textgreater{}=50)}
\StringTok{      \{}
\StringTok{        for(j in class)}
\StringTok{          \{}
\StringTok{            if(class[j]==i)}
\StringTok{              \{}
\StringTok{                printf data[j]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\NormalTok{done;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#  the former is network\_facet}
\ControlFlowTok{for}\NormalTok{ i }\ControlFlowTok{in} \FloatTok{0.4} \FloatTok{0.5} \FloatTok{0.6} \FloatTok{0.7} \FloatTok{0.8} \FloatTok{0.9} \FloatTok{0.95} \FloatTok{0.99}
\NormalTok{do}
\NormalTok{  class\_pp\_limit}\OtherTok{=}\ErrorTok{$}\NormalTok{i}
\NormalTok{  mkdir results}\SpecialCharTok{/}\NormalTok{network\_facet\_ladder2\_}\SpecialCharTok{$}\NormalTok{class\_pp\_limit}
\NormalTok{  data1}\OtherTok{=}\StringTok{"multi\_pp\_class/for\_violin\_$\{class\_pp\_limit\}\_pattern.tsv"}
\NormalTok{  data2}\OtherTok{=}\StringTok{"results/source\_target\_tree\_0.4.tsv"} \CommentTok{\# "results/source\_target\_tree\_0.4.tsv"}
\NormalTok{  save\_class}\OtherTok{=}\StringTok{"results/filter\_child\_class.tsv"}
\NormalTok{  savepath}\OtherTok{=}\StringTok{"results/network\_facet\_ladder2\_$class\_pp\_limit/"}
\NormalTok{  awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  \{}
\StringTok{    if(NR==FNR)}
\StringTok{      \{}
\StringTok{        if(FNR==1)}
\StringTok{          \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{              \{}
\StringTok{                if($i\textasciitilde{}/classification/)}
\StringTok{                  \{}
\StringTok{                    col\_class=i}
\StringTok{                  \}}
\StringTok{                if($i\textasciitilde{}/\^{}id$/)}
\StringTok{                  \{}
\StringTok{                    col\_id=i}
\StringTok{                  \}}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{          \{}
\StringTok{            class[$col\_class]=$col\_class}
\StringTok{            class\_id[$col\_class,$col\_id]=$col\_id}
\StringTok{            stat\_id[$col\_class,$col\_id]=$col\_id}
\StringTok{            belong[$col\_class,$col\_id]=$col\_class}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{    if(NR\textgreater{}FNR)}
\StringTok{      \{}
\StringTok{        if(FNR==1)}
\StringTok{          \{}
\StringTok{            printf "" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{save\_class}\StringTok{\textquotesingle{}"}
\StringTok{            for(i in class)}
\StringTok{              \{}
\StringTok{                printf i"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{save\_class}\StringTok{\textquotesingle{}"}
\StringTok{                printf $0"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "facet}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" i ".tsv"}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{          \{}
\StringTok{            for(i in class)}
\StringTok{              \{}
\StringTok{                if( class\_id[i,$1]==$1 \&\& class\_id[i,$2]==$2 )}
\StringTok{                  \{}
\StringTok{                    printf $0"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  i"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" i ".tsv"}
\StringTok{                    delete stat\_id[i,$1]}
\StringTok{                    delete stat\_id[i,$2]}
\StringTok{                  \}}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{END\{}
\StringTok{for(i in stat\_id)}
\StringTok{  \{}
\StringTok{    \#\# source target similarity delta\_mz fp fp class}
\StringTok{    printf stat\_id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" stat\_id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "1}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "0}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "null}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "null}\SpecialCharTok{\textbackslash{}t}\StringTok{"  belong[i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" belong[i] ".tsv"}
\StringTok{  \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
\NormalTok{done;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\DocumentationTok{\#\#\# for ring plot}
\NormalTok{data1}\OtherTok{=}\StringTok{"canopus.tsv"}
\NormalTok{data2}\OtherTok{=}\StringTok{"results/filter\_child\_class.tsv"}
\NormalTok{data3}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"results/canopus\_pp\_filter.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(FILENAME\textasciitilde{}/canopus.tsv/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if($i\textasciitilde{}/absolute/)}
\StringTok{                \{}
\StringTok{                  col\_index=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/\^{}id/)}
\StringTok{                \{}
\StringTok{                  col\_chemid=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/name/)}
\StringTok{                \{}
\StringTok{                  col\_name=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/description/)}
\StringTok{                \{}
\StringTok{                  col\_des=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}2)}
\StringTok{        \{}
\StringTok{          ab\_index[$col\_name]=$col\_index}
\StringTok{          chemid[$col\_name]=$col\_chemid}
\StringTok{          des[$col\_name]=$col\_des}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FILENAME\textasciitilde{}/filter\_child\_class/)}
\StringTok{    \{}
\StringTok{      class[$1]=$1}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          printf "index}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "chem\_id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "description}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/child\_class.tsv"}
\StringTok{        \}}
\StringTok{      printf ab\_index[$1]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  chemid[$1]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $1"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  des[$1]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/child\_class.tsv"}
\StringTok{    \}}
\StringTok{  if(FILENAME\textasciitilde{}/canopus\_pp/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          printf $1 \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{          for(i=2; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if(class[$i]!="")}
\StringTok{                \{}
\StringTok{                  n+=1}
\StringTok{                  printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{C"ab\_index[$i] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                  col\_set[n]=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{          printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          printf $1 \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{          for(i=1; i\textless{}=n; i++)}
\StringTok{            \{}
\StringTok{              printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"$col\_set[i] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{          printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\DocumentationTok{\#\# Eucommia peak erea normalized}
\CommentTok{\# accoding: com\_lignans\_and\_iridoids.tsv }
\NormalTok{data}\OtherTok{=}\NormalTok{com\_lignans\_and\_iridoids.tsv}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\# \#\#\#\#\#\#\#\#\#\#\#\#  instance for 3d plot}
\DocumentationTok{\#\#\# step1 RT \textasciitilde{} intensity}
\NormalTok{Rscript }\SpecialCharTok{\textasciitilde{}}\ErrorTok{/}\NormalTok{Downloads}\SpecialCharTok{/}\NormalTok{codes}\SpecialCharTok{/}\NormalTok{instance\_3d\_xcms.R}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#  json tree }
\NormalTok{mkdir json\_tree}
\NormalTok{data1}\OtherTok{=}\StringTok{"com\_lignans\_and\_iridoids.tsv"}
\NormalTok{id}\OtherTok{=}\DecValTok{2268}
\NormalTok{formula}\OtherTok{=}\NormalTok{C17H24O10}
\NormalTok{data2}\OtherTok{=}\StringTok{"/media/wizard/back/0703\_all/*\_$id/trees/$formula*.json"} \DocumentationTok{\#\#\#\#\#\#\# in media}
\NormalTok{cp }\SpecialCharTok{$}\NormalTok{data2 json\_tree}\SpecialCharTok{/}\NormalTok{tree\_}\SpecialCharTok{$}\NormalTok{id.json}
\CommentTok{\# id    rt  m/z classification  variety pro/raw}
\CommentTok{\# 3918  13.2883753333333    701.22926   Terpene glycosides  increase    52.5192 }
\CommentTok{\# 2529  11.5328771666667    699.24926   Lignan glycosides   increase    4.73482}
\CommentTok{\# 3674  7.13257936666667    551.16124   Iridoid O{-}glycosides    increase    3.91387}
\CommentTok{\# 3380  12.6588768333333    613.21304   Terpene glycosides  increase    3.9104}
\NormalTok{data}\OtherTok{=}\StringTok{"json\_tree/tree\_$id.json"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"json\_tree/"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\StringTok{"[ ][:][ ]||[,]"} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if($0\textasciitilde{}/"root"/)}
\StringTok{    \{}
\StringTok{      root=$2}
\StringTok{    \}}
\StringTok{  if($0\textasciitilde{}/"id"/)}
\StringTok{    \{}
\StringTok{      id[$2]=$2;}
\StringTok{      the\_id=$2}
\StringTok{      getline;}
\StringTok{      formula[the\_id]=$2}
\StringTok{    \}}
\StringTok{  if($0\textasciitilde{}/"source"/)}
\StringTok{    \{}
\StringTok{      source[$2]=$2}
\StringTok{      link[$2]+=1}
\StringTok{      the\_source=$2}
\StringTok{      getline;}
\StringTok{      target[the\_source, link[the\_source]]=$2}
\StringTok{      getline;}
\StringTok{      formula\_edge[the\_source, link[the\_source]]=$2}
\StringTok{    \}}
\StringTok{\}}
\StringTok{END\{}
\StringTok{printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{" "label}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"  "nodes\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{id}\StringTok{\textquotesingle{}.tsv"}
\StringTok{printf "from}\SpecialCharTok{\textbackslash{}t}\StringTok{" "to}\SpecialCharTok{\textbackslash{}t}\StringTok{" "label}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"  "edges\_\textquotesingle{}}\SpecialCharTok{$}\NormalTok{id}\StringTok{\textquotesingle{}.tsv"}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#}
\NormalTok{printf }\StringTok{"root}\SpecialCharTok{\textbackslash{}t}\StringTok{"}\NormalTok{ root}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"} \SpecialCharTok{\textgreater{}}\ErrorTok{\textgreater{}} \StringTok{"\textquotesingle{}$savepath\textquotesingle{}"}  \StringTok{"nodes\_\textquotesingle{}$id\textquotesingle{}.tsv"}
\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in}\NormalTok{ id)}
\NormalTok{  \{}
\NormalTok{    printf i}\StringTok{"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}\NormalTok{ formula[i]}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"} \SpecialCharTok{\textgreater{}}\ErrorTok{\textgreater{}} \StringTok{"\textquotesingle{}$savepath\textquotesingle{}"}  \StringTok{"nodes\_\textquotesingle{}$id\textquotesingle{}.tsv"}
\NormalTok{  \}}
\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in}\NormalTok{ source)}
\NormalTok{  \{}
    \ControlFlowTok{for}\NormalTok{(}\AttributeTok{j=}\DecValTok{1}\NormalTok{; j}\SpecialCharTok{\textless{}=}\NormalTok{link[i]; j}\SpecialCharTok{++}\NormalTok{)}
\NormalTok{      \{}
\NormalTok{        printf i}\StringTok{"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}\NormalTok{  target[i,j]}\StringTok{"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}\NormalTok{ formula\_edge[i,j]}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"} \SpecialCharTok{\textgreater{}}\ErrorTok{\textgreater{}} \StringTok{"\textquotesingle{}$savepath\textquotesingle{}"}  \StringTok{"edges\_\textquotesingle{}$id\textquotesingle{}.tsv"}
\NormalTok{      \}}
\NormalTok{  \}}
\ErrorTok{\}}\StringTok{\textquotesingle{} $data}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{Rscript }\SpecialCharTok{\textasciitilde{}}\ErrorTok{/}\NormalTok{Downloads}\SpecialCharTok{/}\NormalTok{codes}\SpecialCharTok{/}\NormalTok{json\_tree.R}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\DocumentationTok{\#\# Image reshape}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{metadata}\OtherTok{=}\StringTok{"canopus\_neg.tsv"}
\CommentTok{\#data="/media/wizard/back/0703\_all/490\_initial\_8\_neg\_495/canopus/C17H24O10\_[M{-}H]{-}.fpt"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"canopus\_parent\_index.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(FNR==1)}
\StringTok{    \{}
\StringTok{      for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{          if($i\textasciitilde{}/\^{}id/)}
\StringTok{            \{}
\StringTok{              col\_id=i}
\StringTok{            \}}
\StringTok{          if($i\textasciitilde{}/\^{}parent/)}
\StringTok{            \{}
\StringTok{              col\_parent=i}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FNR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{      parent[$col\_id]=$col\_parent}
\StringTok{      rows[FNR]=$col\_id}
\StringTok{      \#print rows[FNR]}
\StringTok{    \}}
\StringTok{\}}
\StringTok{END\{}
\StringTok{print "END"}
\StringTok{printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "parentid}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "num}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{for(i=2; i\textless{}=FNR; i++)}
\StringTok{  \{}
\StringTok{    root=rows[i]}
\StringTok{    num[root]+=1}
\StringTok{    index\_id[rows[i]]=root}
\StringTok{    while(root!="")}
\StringTok{      \{}
\StringTok{        if(parent[root]!="")}
\StringTok{          \{}
\StringTok{            index\_id[rows[i]]=parent[root]"{-}"index\_id[rows[i]]}
\StringTok{            num[parent[root]]+=1}
\StringTok{          \}}
\StringTok{        root=parent[root]}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{for(i=2; i\textless{}=FNR; i++)}
\StringTok{  \{}
\StringTok{    printf rows[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  index\_id[rows[i]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  num[rows[i]]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{  \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{metadata}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\# 1028 violin plot}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{data1}\OtherTok{=}\StringTok{"results/filter\_child\_class.tsv"}
\NormalTok{data2}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\NormalTok{data3}\OtherTok{=}\StringTok{"com\_compound.tsv"}
\NormalTok{ex\_export}\OtherTok{=}\StringTok{"com\_1011.tsv"}
\NormalTok{similarity\_limit}\OtherTok{=}\StringTok{"0.4"}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{class\_pp\_limit}\OtherTok{=}\StringTok{"0.5"}
\NormalTok{savename}\OtherTok{=}\StringTok{"for\_sun\_$class\_pp\_limit.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{      filter\_class[$1]=$2}
\StringTok{    \}}
\StringTok{  if(FILENAME\textasciitilde{}/canopus/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          col\_id=1}
\StringTok{          for(i=2; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              for(j in filter\_class)}
\StringTok{                \{}
\StringTok{                  if(j==$i)}
\StringTok{                    \{}
\StringTok{                      col\_class[j]=i}
\StringTok{                      print i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          for(i in col\_class)}
\StringTok{            \{}
\StringTok{              if(sprintf("\%.3f",$col\_class[i])+0 \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{class\_pp\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{                \{}
\StringTok{                  class\_set[i,$col\_id]=i}
\StringTok{                  print i,$col\_class[i]}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FILENAME\textasciitilde{}/\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data3}\StringTok{\textquotesingle{}/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if($i\textasciitilde{}/\^{}id/)}
\StringTok{                \{}
\StringTok{                  col\_id=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/log10\_raw/)}
\StringTok{                \{}
\StringTok{                  col\_log\_raw=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/log10\_pro/)}
\StringTok{                \{}
\StringTok{                  col\_log\_pro=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/similarity/)}
\StringTok{                \{}
\StringTok{                  col\_similarity=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{          printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "classification}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "log10\_raw}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "log10\_pro}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savename}\StringTok{\textquotesingle{}"}
\StringTok{          printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{ex\_export}\StringTok{\textquotesingle{}"}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          if($col\_similarity+0 \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{similarity\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{            \{}
\StringTok{              for(i in class\_set)}
\StringTok{                \{}
\StringTok{                  if(i\textasciitilde{}"}\SpecialCharTok{\textbackslash{}034}\StringTok{"$col\_id"$")}
\StringTok{                    \{}
\StringTok{                      printf $col\_id"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  class\_set[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $col\_log\_raw"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $col\_log\_pro"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savename}\StringTok{\textquotesingle{}"}
\StringTok{                      printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{ex\_export}\StringTok{\textquotesingle{}"}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\# stat num}
\NormalTok{class\_pp\_limit}\OtherTok{=}\FloatTok{0.5}
\NormalTok{data}\OtherTok{=}\StringTok{"for\_sun\_$class\_pp\_limit.tsv"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"for\_violin\_$\{class\_pp\_limit\}.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(FNR==1)}
\StringTok{    \{}
\StringTok{      printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{    \}}
\StringTok{  num[$2]+=1}
\StringTok{  data[FNR]=$0}
\StringTok{  class[FNR]=$2}
\StringTok{\}}
\StringTok{END\{}
\StringTok{for(i in num)}
\StringTok{  \{}
\StringTok{    print i,num[i]}
\StringTok{    if(num[i]+0\textgreater{}=10)}
\StringTok{      \{}
\StringTok{        for(j in class)}
\StringTok{          \{}
\StringTok{            if(class[j]==i)}
\StringTok{              \{}
\StringTok{                printf data[j]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{data1}\OtherTok{=}\StringTok{"filter\_class.csv"} \CommentTok{\#lignans and iridoids}
\NormalTok{data2}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\NormalTok{data3}\OtherTok{=}\StringTok{"com\_compound.tsv"}
\NormalTok{ex\_export}\OtherTok{=}\StringTok{"results/com\_lignans\_and\_iridoids.tsv"}
\NormalTok{similarity\_limit}\OtherTok{=}\StringTok{"0.4"}
\NormalTok{class\_pp\_limit}\OtherTok{=}\StringTok{"0.5"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{      filter\_class[$1]=$1}
\StringTok{    \}}
\StringTok{  if(FILENAME\textasciitilde{}/canopus/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          col\_id=1}
\StringTok{          for(i=2; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              for(j in filter\_class)}
\StringTok{                \{}
\StringTok{                  if(j==$i)}
\StringTok{                    \{}
\StringTok{                      col\_class[j]=i}
\StringTok{                      print i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          for(i in col\_class)}
\StringTok{            \{}
\StringTok{              if(sprintf("\%.3f",$col\_class[i])+0\textgreater{}="\textquotesingle{}}\SpecialCharTok{$}\NormalTok{class\_pp\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{                \{}
\StringTok{                  class\_set[i,$col\_id]=i}
\StringTok{                  print i,$col\_class[i]}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FILENAME\textasciitilde{}/\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data3}\StringTok{\textquotesingle{}/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if($i\textasciitilde{}/\^{}id/)}
\StringTok{                \{}
\StringTok{                  col\_id=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/log10\_raw/)}
\StringTok{                \{}
\StringTok{                  col\_log\_raw=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/log10\_pro/)}
\StringTok{                \{}
\StringTok{                  col\_log\_pro=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/similarity/)}
\StringTok{                \{}
\StringTok{                  col\_similarity=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{          printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{ex\_export}\StringTok{\textquotesingle{}"}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          if($col\_similarity+0 \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{similarity\_limit}\StringTok{\textquotesingle{}")}
\StringTok{            \{}
\StringTok{              for(i in class\_set)}
\StringTok{                \{}
\StringTok{                  if(i\textasciitilde{}"}\SpecialCharTok{\textbackslash{}034}\StringTok{"$col\_id"$")}
\StringTok{                    \{}
\StringTok{                      printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{ex\_export}\StringTok{\textquotesingle{}"}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-for_com_lignans_and_iridoids.sh}{%
\section{File: for\_com\_lignans\_and\_iridoids.sh}\label{file-for_com_lignans_and_iridoids.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{list}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}\{print NR\}\textquotesingle{}}\NormalTok{ filter\_class.csv)}
\ControlFlowTok{for}\NormalTok{ i }\ControlFlowTok{in} \SpecialCharTok{$}\NormalTok{list }
\NormalTok{do}
\NormalTok{  data1}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}\{if(NR==\textquotesingle{}}\SpecialCharTok{$}\NormalTok{i}\StringTok{\textquotesingle{})\{printf $0\}\}\textquotesingle{}}\NormalTok{ filter\_class.csv) }\CommentTok{\#lignans and iridoids}
\NormalTok{  data2}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\NormalTok{  data3}\OtherTok{=}\StringTok{"com\_compound.tsv"}
\NormalTok{  ex\_export}\OtherTok{=}\StringTok{"results/com\_$\{i\}.tsv"}
\NormalTok{  similarity\_limit}\OtherTok{=}\StringTok{"0.4"}
\NormalTok{  class\_pp\_limit}\OtherTok{=}\StringTok{"0.5"}
\NormalTok{  awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  \{}
\StringTok{    if(NR==FNR)}
\StringTok{      \{}
\StringTok{        filter\_class[$1]=$1}
\StringTok{        index\_class=$1}
\StringTok{      \}}
\StringTok{    if(FILENAME\textasciitilde{}/canopus/)}
\StringTok{      \{}
\StringTok{        if(FNR==1)}
\StringTok{          \{}
\StringTok{            col\_id=1}
\StringTok{            for(i=2; i\textless{}=NF; i++)}
\StringTok{              \{}
\StringTok{                for(j in filter\_class)}
\StringTok{                  \{}
\StringTok{                    if(j==$i)}
\StringTok{                      \{}
\StringTok{                        col\_class[j]=i}
\StringTok{                        print i}
\StringTok{                      \}}
\StringTok{                  \}}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{          \{}
\StringTok{            for(i in col\_class)}
\StringTok{              \{}
\StringTok{                if(sprintf("\%.3f",$col\_class[i])+0\textgreater{}="\textquotesingle{}}\SpecialCharTok{$}\NormalTok{class\_pp\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{                  \{}
\StringTok{                    class\_set[i,$col\_id]=i}
\StringTok{                    print i,$col\_class[i]}
\StringTok{                  \}}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{    if(FILENAME\textasciitilde{}/\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data3}\StringTok{\textquotesingle{}/)}
\StringTok{      \{}
\StringTok{        if(FNR==1)}
\StringTok{          \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{              \{}
\StringTok{                if($i\textasciitilde{}/\^{}id/)}
\StringTok{                  \{}
\StringTok{                    col\_id=i}
\StringTok{                  \}}
\StringTok{                if($i\textasciitilde{}/log10\_raw/)}
\StringTok{                  \{}
\StringTok{                    col\_log\_raw=i}
\StringTok{                  \}}
\StringTok{                if($i\textasciitilde{}/log10\_pro/)}
\StringTok{                  \{}
\StringTok{                    col\_log\_pro=i}
\StringTok{                  \}}
\StringTok{                if($i\textasciitilde{}/similarity/)}
\StringTok{                  \{}
\StringTok{                    col\_similarity=i}
\StringTok{                  \}}
\StringTok{              \}}
\StringTok{            printf "Index}\SpecialCharTok{\textbackslash{}t}\StringTok{"$0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{ex\_export}\StringTok{\textquotesingle{}"}
\StringTok{          \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{          \{}
\StringTok{            if($col\_similarity+0 \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{similarity\_limit}\StringTok{\textquotesingle{}")}
\StringTok{              \{}
\StringTok{                for(i in class\_set)}
\StringTok{                  \{}
\StringTok{                    if(i\textasciitilde{}"}\SpecialCharTok{\textbackslash{}034}\StringTok{"$col\_id"$")}
\StringTok{                      \{}
\StringTok{                        printf index\_class"}\SpecialCharTok{\textbackslash{}t}\StringTok{"$0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{ex\_export}\StringTok{\textquotesingle{}"}
\StringTok{                      \}}
\StringTok{                  \}}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{  \}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$data1"}\NormalTok{) }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\NormalTok{done;}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-for_gnps_facet.sh}{%
\section{File: for\_gnps\_facet.sh}\label{file-for_gnps_facet.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plimit}\OtherTok{=}\DecValTok{0}
\NormalTok{until [[ }\StringTok{"$plimit"} \SpecialCharTok{\textgreater{}} \StringTok{"0.5"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$plimit"} \SpecialCharTok{\textless{}} \StringTok{"0.99"}\NormalTok{ ]]}
\NormalTok{do}
\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"If the minimum alignment similarity is greater than 0.3, this step will automatic calculate the discrepancy fingerprint between alignment features(in beta). Please enter the minimum posterior probability of the molecular fingerprint(plimit\_1) to be filtered. 0.9{-}0.99 is recommended. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ plimit;}
\NormalTok{done;}
\NormalTok{plimit2}\OtherTok{=}\DecValTok{0}
\NormalTok{until [[ }\StringTok{"$plimit2"} \SpecialCharTok{\textgreater{}} \StringTok{"0.1"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$plimit2"} \SpecialCharTok{\textless{}} \StringTok{"$plimit"}\NormalTok{ ]]}
\NormalTok{do}
\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"The minimum posterior probability of the molecular fingerprint(plimit\_2) to be controled. 0.1{-}0.5 may work well. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ plimit2;}
\NormalTok{done;}
\NormalTok{tlimit}\OtherTok{=}\ErrorTok{$}\NormalTok{(ls temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{filter\_net\_}\SpecialCharTok{*} \ErrorTok{|}\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F \_ }\StringTok{\textquotesingle{}\{print $NF\}\textquotesingle{}}\NormalTok{)}
\NormalTok{check\_rep}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}END\{print NR\}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$tlimit"}\NormalTok{))}
\ControlFlowTok{if}\NormalTok{ [[ }\StringTok{"$check\_rep"} \SpecialCharTok{\textgreater{}} \StringTok{"1"}\NormalTok{ ]]}
\NormalTok{then}
\NormalTok{  tlimit}\OtherTok{=}\DecValTok{0}
\NormalTok{  until [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{filter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit ]}
\NormalTok{  do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Plural and different fragment\_tree\_network files were found to exist locally. Please select a tlimit parameter you have utilized to run fragment\_tree\_network\_delta. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ tlimit;}
\NormalTok{  done;}
\NormalTok{fi;}
\ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{refilter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit ]}
\NormalTok{then rm temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{refilter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit}
\NormalTok{fi;}
\ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{fpsample ]}
\NormalTok{then rm temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{fpsample}
\NormalTok{fi;}
\NormalTok{echo }\StringTok{"Running delta\_fingerprint computation..."}
\NormalTok{echo }\StringTok{"Aquiring data from sirius index..."}
\NormalTok{data1}\OtherTok{=}\StringTok{"*\_*/compound.info"}
\NormalTok{data2}\OtherTok{=}\StringTok{"temp/ftaligntemp/filter\_net\_$tlimit"}
\NormalTok{echo }\StringTok{"Run fragment\_tree\_network\_delta."}
\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/ms\_data\_$tlimit"}
\NormalTok{echo }\StringTok{"step 1: ms data"}
\ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{savepath ]}
\NormalTok{then}
\NormalTok{  awk }\SpecialCharTok{{-}}\NormalTok{F }\StringTok{"[}\SpecialCharTok{\textbackslash{}t}\StringTok{]||[:]||[\_]"} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  BEGIN\{  }
\StringTok{  printf "..."}
\StringTok{  printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "m/z}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "rt}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{\}}
\StringTok{\{}
\StringTok{  if(FILENAME\textasciitilde{}/compound.info/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          printf "Info: catch \textgreater{}\textgreater{}\textgreater{} "FILENAME"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{        \}}
\StringTok{      if($1=="name")}
\StringTok{        \{}
\StringTok{          i+=1;}
\StringTok{          id[i]=$NF;}
\StringTok{          n=split($NF,a,"[\_]")}
\StringTok{          printf a[n]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{        \}}
\StringTok{      if($1=="ionMass")}
\StringTok{        \{}
\StringTok{          mz[id[i]]=$NF}
\StringTok{          printf sprintf("\%.4f",$NF)"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{        \}}
\StringTok{      if($1=="ionType")}
\StringTok{        \{}
\StringTok{          type[id[i]]=$NF}
\StringTok{        \}}
\StringTok{      if($1=="rt")}
\StringTok{        \{}
\StringTok{          rt[id[i]]=$2;}
\StringTok{          printf sprintf("\%.2f",$2/60)"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FILENAME\textasciitilde{}/ftaligntemp/)}
\StringTok{    \{}
\StringTok{      \#source  target  ftalign  delta\_mz  delta\_rt  source\_iontype  target\_iontype;}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          printf "" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        \}}
\StringTok{      print $1,$2,$3,sprintf("\%.3f",mz[$2]{-}mz[$1]),sprintf("\%.2f",rt[$2]{-}rt[$1]),type[$1],type[$2]  \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
\NormalTok{fi;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{echo }\StringTok{"step 2: data path"}
\NormalTok{source\_file}\OtherTok{=}\StringTok{"temp/Mo\_filename"}
\NormalTok{data}\OtherTok{=}\StringTok{"temp/ms\_data\_$tlimit"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/datapath\_$tlimit"}
\ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{savepath ]}
\NormalTok{then}
\NormalTok{  awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  \{}
\StringTok{    if(NR==FNR)}
\StringTok{      \{}
\StringTok{        n=split($2, a, "[\_]")}
\StringTok{        file[a[n]]=$2}
\StringTok{        formu\_type[a[n]]=$3}
\StringTok{      \}}
\StringTok{    if(NR!=FNR)}
\StringTok{      \{}
\StringTok{        \#\textless{}path\textgreater{}sourceFormula  \textless{}path\textgreater{}targetFormula}
\StringTok{        path1=file[$1]"/fingerprints/"formu\_type[$1]".fpt"}
\StringTok{        path2=file[$2]"/fingerprints/"formu\_type[$2]".fpt"}
\StringTok{        data[path1]=path1}
\StringTok{        data[path2]=path2}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{END\{}
\StringTok{for(i in data)}
\StringTok{  \{}
\StringTok{    n+=1}
\StringTok{    print "Check file:",n}
\StringTok{    if(getline\textless{}i=={-}1)}
\StringTok{      \{}
\StringTok{        printf "Escape filename: " i "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{      \}}
\StringTok{  else}
\StringTok{    \{}
\StringTok{      printf i" " \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{    \}}
\StringTok{  close(i)}
\StringTok{\}}
\StringTok{print "Sum:",n}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{source\_file }\SpecialCharTok{$}\NormalTok{data}
\NormalTok{fi;}
\NormalTok{datapath}\OtherTok{=}\ErrorTok{$}\NormalTok{(cat temp}\SpecialCharTok{/}\NormalTok{datapath\_}\SpecialCharTok{$}\NormalTok{tlimit)}
\NormalTok{echo }\StringTok{"step 3: fingerprint"}
\NormalTok{data\_allfp}\OtherTok{=}\StringTok{"temp/data\_allfp\_$tlimit"}
\ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{data\_allfp ]}
\NormalTok{then}
\NormalTok{  awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  BEGIN\{}
\StringTok{  n=0}
\StringTok{\}}
\StringTok{\{}
\StringTok{  if(FNR==1)}
\StringTok{    \{}
\StringTok{      if(n\textgreater{}1)}
\StringTok{        \{}
\StringTok{          close(file)}
\StringTok{        \}}
\StringTok{      file=FILENAME;}
\StringTok{      print "Get fingerprints: ",FILENAME}
\StringTok{      n+=1;}
\StringTok{      printf FILENAME"}\SpecialCharTok{\textbackslash{}n}\StringTok{"$0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data\_allfp}\StringTok{\textquotesingle{}"}
\StringTok{    \}}
\StringTok{else}
\StringTok{  \{}
\StringTok{    print $0 \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data\_allfp}\StringTok{\textquotesingle{}"}
\StringTok{  \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{datapath}
\NormalTok{fi;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==1)}
\StringTok{    \{}
\StringTok{      for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{          if($i\textasciitilde{}/absolute/)}
\StringTok{            \{}
\StringTok{              col\_index=i}
\StringTok{            \}}
\StringTok{          if($i\textasciitilde{}/description/)}
\StringTok{            \{}
\StringTok{              col\_description=i}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(NR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{      print $col\_index,$col\_description}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}}\NormalTok{ csi\_fingerid.tsv }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{pos\_fingerprint\_index;}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==1)}
\StringTok{    \{}
\StringTok{      for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{          if($i\textasciitilde{}/absolute/)}
\StringTok{            \{}
\StringTok{              col\_index=i}
\StringTok{            \}}
\StringTok{          if($i\textasciitilde{}/description/)}
\StringTok{            \{}
\StringTok{              col\_description=i}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(NR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{      print $col\_index,$col\_description}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}}\NormalTok{ csi\_fingerid\_neg.tsv }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{neg\_fingerprint\_index;}
\NormalTok{posindex}\OtherTok{=}\StringTok{"temp/ftaligntemp/pos\_fingerprint\_index"}
\NormalTok{negindex}\OtherTok{=}\StringTok{"temp/ftaligntemp/neg\_fingerprint\_index"}
\NormalTok{data}\OtherTok{=}\StringTok{"temp/ms\_data\_$tlimit"}
\NormalTok{echo }\StringTok{"step 4: merge data"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{BEGIN\{}
\StringTok{file=0}
\StringTok{x=0}
\StringTok{count=0}
\StringTok{f=0}
\StringTok{posnum=0}
\StringTok{negnum=0}
\StringTok{\}}
\StringTok{\{}
\StringTok{  if(FNR==1)}
\StringTok{    \{}
\StringTok{      file+=1}
\StringTok{    \}}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{      if(($1\textasciitilde{}/fingerprint/))}
\StringTok{        \{}
\StringTok{          if(x+0\textgreater{}f+0)}
\StringTok{            \{}
\StringTok{              f=x  \# calculate the max index.}
\StringTok{            \}}
\StringTok{          count+=1;  \# calculate the all fingerprints file number.}
\StringTok{          split($1,a,"[/]"); e=split(a[1],b,"[\_]"); id=b[e]; \#catch the id.}
\StringTok{          x=0;}
\StringTok{        \}}
\StringTok{    else}
\StringTok{      \{}
\StringTok{        x+=1;}
\StringTok{        fp[id,x]=$1;}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{if(file==2)}
\StringTok{  \{}
\StringTok{    pos[FNR]=$1}
\StringTok{    posnum+=1}
\StringTok{  \}}
\StringTok{if(file==3)}
\StringTok{  \{}
\StringTok{    neg[FNR]=$1}
\StringTok{    negnum+=1}
\StringTok{  \}}
\StringTok{if(file==4)}
\StringTok{  \{}
\StringTok{    if("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tlimit}\StringTok{\textquotesingle{}"+0 \textgreater{}= 0.3)}
\StringTok{      \{}
\StringTok{        if(fp[$1,1]!="" \&\& fp[$2,1]!="")}
\StringTok{          \{}
\StringTok{            n1=split($6, g, "[]]");}
\StringTok{            n2=split($7, h, "[]]");}
\StringTok{            if(g[n1]=="+" \&\& h[n2]=="+")}
\StringTok{              \{}
\StringTok{                for(x=1; x\textless{}=posnum; x++)}
\StringTok{                  \{}
\StringTok{                    if(fp[$1,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                      \{}
\StringTok{                        data\_s[FNR,x]=pos[x]}
\StringTok{                      \}}
\StringTok{                  else if(fp[$2,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                    \{}
\StringTok{                      data\_t[FNR,x]=pos[x]}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{          if(g[n1]=="{-}" \&\& h[n2]=="{-}")}
\StringTok{            \{}
\StringTok{              for(x=1; x\textless{}=negnum; x++)}
\StringTok{                \{}
\StringTok{                  if(fp[$1,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                    \{}
\StringTok{                      data\_s[FNR,x]=neg[x]}
\StringTok{                    \}}
\StringTok{                else if(fp[$2,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                  \{}
\StringTok{                    data\_t[FNR,x]=neg[x]}
\StringTok{                  \}}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{        if(g[n1]=="{-}" \&\& h[n2]=="+" || h[n2]=="{-}" \&\& g[n1]=="+")}
\StringTok{          \{}
\StringTok{            for(i=1; i\textless{}=posnum; i++)}
\StringTok{              \{}
\StringTok{                for(j=1; j\textless{}=negnum; j++)}
\StringTok{                  \{}
\StringTok{                    if(pos[i]==neg[j])}
\StringTok{                      \{}
\StringTok{                        mirror[i]=j  \#if pos=i, the identical index of neg is mirror[i]}
\StringTok{                      \}}
\StringTok{                  \}}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{        if(g[n1]=="{-}" \&\& h[n2]=="+") }
\StringTok{          \{}
\StringTok{            for(x=1; x\textless{}=f; x++)}
\StringTok{              \{}
\StringTok{                if(fp[$1,mirror[x]]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                  \{}
\StringTok{                    data\_s[FNR,x]=neg[mirror[x]]}
\StringTok{                  \}}
\StringTok{              else if(fp[$2,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,mirror[x]]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                \{}
\StringTok{                  data\_t[FNR,x]=neg[mirror[x]]}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      if(h[n2]=="{-}" \&\& g[n1]=="+")}
\StringTok{        \{}
\StringTok{          for(x=1; x\textless{}=f; x++)}
\StringTok{            \{}
\StringTok{              if(fp[$1,x]+0\textgreater{}= \textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,mirror[x]]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                \{}
\StringTok{                  data\_s[FNR,x]=neg[mirror[x]]}
\StringTok{                \}}
\StringTok{            else if(fp[$2,mirror[x]]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{              \{}
\StringTok{                data\_t[FNR,x]=neg[mirror[x]]}
\StringTok{              \}}
\StringTok{          \}   }
\StringTok{      \}}
\StringTok{  \}}
\StringTok{\}}
\StringTok{if(FNR==1)}
\StringTok{  \{}
\StringTok{    printf "source}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "target}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "ftalign\_similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "delta\_m/z}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "source\_fp\_uniq}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "target\_fp\_uniq}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{  \}}
\StringTok{else}
\StringTok{  \{}
\StringTok{    printf $1"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $2"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $3"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $4"}\SpecialCharTok{\textbackslash{}t}\StringTok{";}
\StringTok{    if(\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tlimit}\StringTok{\textquotesingle{}+0 \textgreater{}= 0.3)}
\StringTok{      \{}
\StringTok{        if(fp[$1,1]=="" || fp[$2,1]=="")}
\StringTok{          \{}
\StringTok{            printf "NA@NA}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{          \}}
\StringTok{      else}
\StringTok{        \{}
\StringTok{          printf "source:"  \#the source fingerprint uniq.}
\StringTok{          for(x=1; x\textless{}=f; x++)}
\StringTok{            \{}
\StringTok{              if(data\_s[FNR,x]!="")}
\StringTok{                \{}
\StringTok{                  printf data\_s[FNR,x]","}
\StringTok{                \}}
\StringTok{            \};}
\StringTok{          printf "@target:"  \#the target fingerprint uniq.}
\StringTok{          for(x=1; x\textless{}=f; x++)}
\StringTok{            \{}
\StringTok{              if(data\_t[FNR,x]!="")}
\StringTok{                \{}
\StringTok{                  printf data\_t[FNR,x]","}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{          printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{else}
\StringTok{  \{}
\StringTok{    printf "NA@NA}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{  \}}
\StringTok{\}}
\StringTok{\}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data\_allfp }\SpecialCharTok{$}\NormalTok{posindex }\SpecialCharTok{$}\NormalTok{negindex }\SpecialCharTok{$}\NormalTok{data }\SpecialCharTok{|}\NormalTok{ sed }\SpecialCharTok{{-}}\NormalTok{e }\StringTok{\textquotesingle{}s/,@/}\SpecialCharTok{\textbackslash{}t}\StringTok{/g; s/,$//g; s/@/}\SpecialCharTok{\textbackslash{}t}\StringTok{/g\textquotesingle{}}  \SpecialCharTok{\textgreater{}}\NormalTok{ results}\SpecialCharTok{/}\NormalTok{source\_target\_tree\_}\SpecialCharTok{$}\NormalTok{tlimit.tsv;}
\NormalTok{echo }\StringTok{"All instances have written into \textless{}results/source\_target\_tree\_$tlimit.tsv\textgreater{}."}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{echo }\StringTok{"step 5: separate child{-}nebula from parent{-}nebula."}
\NormalTok{data}\OtherTok{=}\StringTok{"results/stat\_classification.tsv"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/filter\_0\_class.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(FNR==1)}
\StringTok{    \{}
\StringTok{      for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{          if($i\textasciitilde{}/\^{}definition$/)}
\StringTok{            \{}
\StringTok{              col\_class=i}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FNR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{      class[$col\_class]=$col\_class}
\StringTok{    \}}
\StringTok{\}}
\StringTok{END\{}
\StringTok{for(i in class)}
\StringTok{  \{}
\StringTok{    printf class[i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{  \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{data1}\OtherTok{=}\StringTok{"temp/filter\_0\_class.tsv"} 
\NormalTok{data2}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\NormalTok{data3}\OtherTok{=}\StringTok{"results/fingerid\_first\_score.tsv"}
\NormalTok{until [[ }\StringTok{"$similarity\_limit"} \SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$similarity\_limit"} \SpecialCharTok{\textless{}} \DecValTok{1}\NormalTok{ ]]}
\NormalTok{do}
\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please set the Tanimoto similarity threshold contribute to child{-}nebula. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ similarity\_limit;}
\NormalTok{done;}
\NormalTok{until [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textgreater{}} \FloatTok{0.01}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textless{}} \DecValTok{1}\NormalTok{ ]]}
\NormalTok{do}
\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the classes posterior probabilities limition. 0.5\textasciitilde{}0.99 may work well. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ definition\_limit;}
\NormalTok{done;}
\NormalTok{class\_pp\_limit}\OtherTok{=}\ErrorTok{$}\NormalTok{definition\_limit}
\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/idenfication\_filter\_$class\_pp\_limit.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{      filter\_class[$1]=$1}
\StringTok{    \}}
\StringTok{  if(FILENAME\textasciitilde{}/canopus/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          col\_id=1}
\StringTok{          for(i=2; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              for(j in filter\_class)}
\StringTok{                \{}
\StringTok{                  if(j==$i)}
\StringTok{                    \{}
\StringTok{                      col\_class[j]=i}
\StringTok{                      print i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          for(i in col\_class)}
\StringTok{            \{}
\StringTok{              if(sprintf("\%.3f",$col\_class[i])+0\textgreater{}="\textquotesingle{}}\SpecialCharTok{$}\NormalTok{class\_pp\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{                \{}
\StringTok{                  class\_set[i,$col\_id]=i}
\StringTok{                  print "ID: ",$1,i,$col\_class[i]}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FILENAME\textasciitilde{}/fingerid\_first\_score/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if($i\textasciitilde{}/\^{}id/)}
\StringTok{                \{}
\StringTok{                  col\_id=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/similarity/)}
\StringTok{                \{}
\StringTok{                  col\_similarity=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{          printf "class\_nebula\_facet}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          if($col\_similarity+0 \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{similarity\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{            \{}
\StringTok{              for(i in class\_set)}
\StringTok{                \{}
\StringTok{                  if(i\textasciitilde{}"}\SpecialCharTok{\textbackslash{}034}\StringTok{"$col\_id"$")}
\StringTok{                    \{}
\StringTok{                      printf class\_set[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{data}\OtherTok{=}\StringTok{"temp/idenfication\_filter\_$class\_pp\_limit.tsv"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/idenfication\_filter2\_$\{class\_pp\_limit\}.tsv"}
\NormalTok{until [[ }\StringTok{"$num\_limit\_1"} \SpecialCharTok{{-}}\NormalTok{gt }\DecValTok{0}\NormalTok{ ]]}
\NormalTok{do}
\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the features number threshold contribute to child{-}nebula (min number). \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ num\_limit\_1;}
\NormalTok{done;}
\NormalTok{until [[ }\StringTok{"$num\_limit\_2"} \SpecialCharTok{{-}}\NormalTok{gt }\StringTok{"$num\_limit\_1"}\NormalTok{ ]]}
\NormalTok{do}
\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the features number threshold contribute to child{-}nebula (max number). \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ num\_limit\_2;}
\NormalTok{done;}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(FNR==1)}
\StringTok{    \{}
\StringTok{      printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{      for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{          if($i\textasciitilde{}/class\_nebula\_facet/)}
\StringTok{            \{}
\StringTok{              col\_class=i}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FNR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{      num[$col\_class]+=1}
\StringTok{      data[FNR]=$0}
\StringTok{      class[FNR]=$col\_class}
\StringTok{    \}}
\StringTok{\}}
\StringTok{END\{}
\StringTok{for(i in num)}
\StringTok{  \{}
\StringTok{    if(num[i]+0 \textgreater{}= \textquotesingle{}}\SpecialCharTok{$}\NormalTok{num\_limit\_1}\StringTok{\textquotesingle{}+0 \&\& num[i]+0 \textless{}= \textquotesingle{}}\SpecialCharTok{$}\NormalTok{num\_limit\_2}\StringTok{\textquotesingle{})}
\StringTok{      \{}
\StringTok{        printf "The nodes number of the child{-}nebula is " num[i] ".}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{        for(j in class)}
\StringTok{          \{}
\StringTok{            if(class[j]==i)}
\StringTok{              \{}
\StringTok{                printf data[j]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{mkdir results}\SpecialCharTok{/}\NormalTok{network\_facet\_}\SpecialCharTok{$}\NormalTok{class\_pp\_limit}
\NormalTok{data1}\OtherTok{=}\StringTok{"temp/idenfication\_filter2\_$\{class\_pp\_limit\}.tsv"}
\NormalTok{data2}\OtherTok{=}\StringTok{"results/source\_target\_tree\_$tlimit.tsv"} \CommentTok{\# "results/source\_target\_tree\_0.4.tsv"}
\NormalTok{save\_class}\OtherTok{=}\StringTok{"results/filter\_child\_class.tsv"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"results/network\_facet\_$class\_pp\_limit/"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if($i\textasciitilde{}/class\_nebula\_facet/)}
\StringTok{                \{}
\StringTok{                  col\_class=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/\^{}id$/)}
\StringTok{                \{}
\StringTok{                  col\_id=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          class[$col\_class]=$col\_class}
\StringTok{          class\_id[$col\_class,$col\_id]=$col\_id}
\StringTok{          stat\_id[$col\_class,$col\_id]=$col\_id}
\StringTok{          belong[$col\_class,$col\_id]=$col\_class}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(NR\textgreater{}FNR)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          for(i in class)}
\StringTok{            \{}
\StringTok{              printf i"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{save\_class}\StringTok{\textquotesingle{}"}
\StringTok{              printf $0"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "facet}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" i ".tsv"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          for(i in class)}
\StringTok{            \{}
\StringTok{              if( class\_id[i,$1]==$1 \&\& class\_id[i,$2]==$2 )}
\StringTok{                \{}
\StringTok{                  printf $0"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  i"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" i ".tsv"}
\StringTok{                  delete stat\_id[i,$1]}
\StringTok{                  delete stat\_id[i,$2]}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{\}}
\StringTok{END\{}
\StringTok{for(i in stat\_id)}
\StringTok{  \{}
\StringTok{    \#\# source target similarity delta\_mz fp fp class}
\StringTok{    printf stat\_id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" stat\_id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "1}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "0}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "null}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "null}\SpecialCharTok{\textbackslash{}t}\StringTok{"  belong[i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{"  \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" belong[i] ".tsv"}
\StringTok{  \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{data1}\OtherTok{=}\StringTok{"canopus.tsv"}
\NormalTok{data2}\OtherTok{=}\StringTok{"results/filter\_child\_class.tsv"}
\NormalTok{data3}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"results/canopus\_pp\_filter.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(FILENAME\textasciitilde{}/canopus.tsv/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if($i\textasciitilde{}/absolute/)}
\StringTok{                \{}
\StringTok{                  col\_index=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/\^{}id/)}
\StringTok{                \{}
\StringTok{                  col\_chemid=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/name/)}
\StringTok{                \{}
\StringTok{                  col\_name=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/description/)}
\StringTok{                \{}
\StringTok{                  col\_des=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}2)}
\StringTok{        \{}
\StringTok{          ab\_index[$col\_name]=$col\_index}
\StringTok{          chemid[$col\_name]=$col\_chemid}
\StringTok{          des[$col\_name]=$col\_des}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FILENAME\textasciitilde{}/filter\_child\_class/)}
\StringTok{    \{}
\StringTok{      class[$1]=$1}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          printf "index}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "chem\_id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "description}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/child\_class.tsv"}
\StringTok{        \}}
\StringTok{      printf ab\_index[$1]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  chemid[$1]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $1"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  des[$1]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/child\_class.tsv"}
\StringTok{    \}}
\StringTok{  if(FILENAME\textasciitilde{}/canopus\_pp/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          printf $1 \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{          for(i=2; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if(class[$i]!="")}
\StringTok{                \{}
\StringTok{                  n+=1}
\StringTok{                  printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{C"ab\_index[$i] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                  col\_set[n]=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{          printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          printf $1 \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{          for(i=1; i\textless{}=n; i++)}
\StringTok{            \{}
\StringTok{              printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"$col\_set[i] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{          printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\NormalTok{mv results}\SpecialCharTok{/}\NormalTok{network\_facet\_}\SpecialCharTok{$}\NormalTok{class\_pp\_limit results}\SpecialCharTok{/}\NormalTok{gnps\_network\_facet\_}\SpecialCharTok{$}\NormalTok{class\_pp\_limit}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-for_violin.sh}{%
\section{File: for\_violin.sh}\label{file-for_violin.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data1}\OtherTok{=}\StringTok{"results/filter\_child\_class.tsv"}
\NormalTok{data2}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\NormalTok{data3}\OtherTok{=}\StringTok{"com\_compound.tsv"}
\NormalTok{ex\_export}\OtherTok{=}\StringTok{"com\_1011.tsv"}
\NormalTok{similarity\_limit}\OtherTok{=}\StringTok{"0.4"}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{class\_pp\_limit}\OtherTok{=}\StringTok{"0.5"}
\NormalTok{savename}\OtherTok{=}\StringTok{"for\_sun\_$class\_pp\_limit.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{      filter\_class[$1]=$2}
\StringTok{    \}}
\StringTok{  if(FILENAME\textasciitilde{}/canopus/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          col\_id=1}
\StringTok{          for(i=2; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              for(j in filter\_class)}
\StringTok{                \{}
\StringTok{                  if(j==$i)}
\StringTok{                    \{}
\StringTok{                      col\_class[j]=i}
\StringTok{                      print i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          for(i in col\_class)}
\StringTok{            \{}
\StringTok{              if(sprintf("\%.3f",$col\_class[i])+0 \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{class\_pp\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{                \{}
\StringTok{                  class\_set[i,$col\_id]=i}
\StringTok{                  print i,$col\_class[i]}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FILENAME\textasciitilde{}/\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data3}\StringTok{\textquotesingle{}/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if($i\textasciitilde{}/\^{}id/)}
\StringTok{                \{}
\StringTok{                  col\_id=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/log10\_raw/)}
\StringTok{                \{}
\StringTok{                  col\_log\_raw=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/log10\_pro/)}
\StringTok{                \{}
\StringTok{                  col\_log\_pro=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/similarity/)}
\StringTok{                \{}
\StringTok{                  col\_similarity=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{          printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "classification}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "log10\_raw}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "log10\_pro}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savename}\StringTok{\textquotesingle{}"}
\StringTok{          printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{ex\_export}\StringTok{\textquotesingle{}"}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          if($col\_similarity+0 \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{similarity\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{            \{}
\StringTok{              for(i in class\_set)}
\StringTok{                \{}
\StringTok{                  if(i\textasciitilde{}"}\SpecialCharTok{\textbackslash{}034}\StringTok{"$col\_id"$")}
\StringTok{                    \{}
\StringTok{                      printf $col\_id"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  class\_set[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $col\_log\_raw"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $col\_log\_pro"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savename}\StringTok{\textquotesingle{}"}
\StringTok{                      printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{ex\_export}\StringTok{\textquotesingle{}"}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\# stat num}
\NormalTok{class\_pp\_limit}\OtherTok{=}\FloatTok{0.5}
\NormalTok{data}\OtherTok{=}\StringTok{"for\_sun\_$class\_pp\_limit.tsv"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"for\_violin\_$\{class\_pp\_limit\}.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(FNR==1)}
\StringTok{    \{}
\StringTok{      printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{    \}}
\StringTok{  num[$2]+=1}
\StringTok{  data[FNR]=$0}
\StringTok{  class[FNR]=$2}
\StringTok{\}}
\StringTok{END\{}
\StringTok{for(i in num)}
\StringTok{  \{}
\StringTok{    print i,num[i]}
\StringTok{    if(num[i]+0\textgreater{}=10)}
\StringTok{      \{}
\StringTok{        for(j in class)}
\StringTok{          \{}
\StringTok{            if(class[j]==i)}
\StringTok{              \{}
\StringTok{                printf data[j]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-ftp_delete.sh}{%
\section{File: ftp\_delete.sh}\label{file-ftp_delete.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#!/bin/bash}
\NormalTok{path}\OtherTok{=}\ErrorTok{$}\DecValTok{1}
\NormalTok{PUTFILE}\OtherTok{=}\ErrorTok{$}\DecValTok{2}
\NormalTok{ftp }\SpecialCharTok{{-}}\NormalTok{ivn }\SpecialCharTok{\textless{}}\ErrorTok{\textless{}}\NormalTok{EOF}
\NormalTok{passive}
\NormalTok{open ccms}\SpecialCharTok{{-}}\NormalTok{ftp01.ucsd.edu }\DecValTok{21}
\NormalTok{user Yellow xxk123456}
\NormalTok{binary}
\NormalTok{cd }\SpecialCharTok{$}\NormalTok{path}
\NormalTok{prompt}
\NormalTok{delete }\SpecialCharTok{$}\NormalTok{PUTFILE}
\NormalTok{by}
\NormalTok{EOF}
\NormalTok{echo }\StringTok{"up file end . . ."}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-ftp_upload_target_dir.sh}{%
\section{File: ftp\_upload\_target\_dir.sh}\label{file-ftp_upload_target_dir.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#!/bin/bash}
\NormalTok{path}\OtherTok{=}\ErrorTok{$}\DecValTok{1}
\NormalTok{PUTFILE}\OtherTok{=}\ErrorTok{$}\DecValTok{2}
\NormalTok{target}\OtherTok{=}\ErrorTok{$}\DecValTok{3}
\NormalTok{ftp }\SpecialCharTok{{-}}\NormalTok{ivn }\SpecialCharTok{\textless{}}\ErrorTok{\textless{}}\NormalTok{EOF}
\NormalTok{passive}
\NormalTok{open ccms}\SpecialCharTok{{-}}\NormalTok{ftp01.ucsd.edu }\DecValTok{21}
\NormalTok{user Yellow xxk123456}
\NormalTok{binary}
\NormalTok{cd }\SpecialCharTok{$}\NormalTok{target}
\NormalTok{lcd }\SpecialCharTok{$}\NormalTok{path}
\NormalTok{prompt}
\NormalTok{put }\SpecialCharTok{$}\NormalTok{PUTFILE}
\NormalTok{by}
\NormalTok{EOF}
\NormalTok{echo }\StringTok{"up file end . . ."}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-ftp_upload.sh}{%
\section{File: ftp\_upload.sh}\label{file-ftp_upload.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#!/bin/bash}
\NormalTok{path}\OtherTok{=}\ErrorTok{$}\DecValTok{1}
\NormalTok{PUTFILE}\OtherTok{=}\ErrorTok{$}\DecValTok{2}
\NormalTok{ftp }\SpecialCharTok{{-}}\NormalTok{ivn }\SpecialCharTok{\textless{}}\ErrorTok{\textless{}}\NormalTok{EOF}
\NormalTok{passive}
\NormalTok{open ccms}\SpecialCharTok{{-}}\NormalTok{ftp01.ucsd.edu }\DecValTok{21}
\NormalTok{user Yellow xxk123456}
\NormalTok{binary}
\NormalTok{cd .}
\NormalTok{lcd }\SpecialCharTok{$}\NormalTok{path}
\NormalTok{prompt}
\NormalTok{put }\SpecialCharTok{$}\NormalTok{PUTFILE}
\NormalTok{by}
\NormalTok{EOF}
\NormalTok{echo }\StringTok{"up file end . . ."}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-git.sh}{%
\section{File: git.sh}\label{file-git.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Wed Mar  2 10:57:48 AM CST 2022}
\CommentTok{\# git config {-}{-}global user.name "chi{-}med{-}pro"}
\CommentTok{\# git config {-}{-}global user.email "202011114011074@zcmu.edu.cn"}
\DocumentationTok{\#\# ssh{-}keygen {-}t rsa {-}C "202011114011074@zcmu.edu.cn"}
\DocumentationTok{\#\# ssh{-}add \textasciitilde{}/.ssh/id\_rsa\_r}
\NormalTok{git remote add origin git}\SpecialCharTok{@}\NormalTok{github.com}\SpecialCharTok{:}\NormalTok{chi}\SpecialCharTok{{-}}\NormalTok{med}\SpecialCharTok{{-}}\NormalTok{pro}\SpecialCharTok{/}\NormalTok{MCnebula.git}
\NormalTok{git add .}
\NormalTok{git commit }\SpecialCharTok{{-}}\NormalTok{m }\StringTok{"initial submit"}
\NormalTok{git pull origin master}
\CommentTok{\# git add/rm .gitignore}
\CommentTok{\# git rebase {-}{-}continue}
\NormalTok{git push }\SpecialCharTok{{-}}\NormalTok{u origin master}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-install_name_iupuc.sh}{%
\section{File: install\_name\_iupuc.sh}\label{file-install_name_iupuc.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# download the smi\_to\_iupac model}
\NormalTok{URL}\OtherTok{=}\StringTok{"https://bwsyncandshare.kit.edu/s/bRWQ4Y8bZmWnBEt/download"}
\NormalTok{GZ}\OtherTok{=}\StringTok{"./chem\_iupac/download"}

\ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{d }\StringTok{"./chem\_iupac/download"}\NormalTok{ ]; then}
\NormalTok{    echo }\StringTok{"Dataset has already been downloaded."}
\ControlFlowTok{else}
\NormalTok{    wget }\StringTok{"$URL"} \SpecialCharTok{{-}}\NormalTok{P }\StringTok{"./chem\_iupac/"}

    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{GZ ]; then}
\NormalTok{        echo }\StringTok{"Dataset successfully downloaded."}
    \ControlFlowTok{else}
\NormalTok{        echo }\StringTok{"Dataset not successfully downloaded."}
\NormalTok{        exit}
\NormalTok{    fi}
\NormalTok{    tar zxvf }\SpecialCharTok{$}\NormalTok{GZ }\SpecialCharTok{{-}}\NormalTok{C .}\SpecialCharTok{/}\NormalTok{chem\_iupac}\SpecialCharTok{/}
\NormalTok{fi}


\CommentTok{\# download opsin}
\NormalTok{URL}\OtherTok{=}\StringTok{"https://github.com/dan2097/opsin/releases/download/2.4.0/opsin{-}2.4.0{-}jar{-}with{-}dependencies.jar"}
\NormalTok{GZ}\OtherTok{=}\StringTok{"./chem\_iupac/opsin/opsin{-}2.4.0{-}jar{-}with{-}dependencies.jar"}

\ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{d }\StringTok{"./chem\_iupac/opsin/opsin{-}2.4.0{-}jar{-}with{-}dependencies.jar"}\NormalTok{ ]; then}
\NormalTok{    echo }\StringTok{"Opsin has already been downloaded."}
\ControlFlowTok{else}
\NormalTok{    wget }\StringTok{"$URL"} \SpecialCharTok{{-}}\NormalTok{P }\StringTok{"./chem\_iupac/opsin/"}

    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{GZ ]; then}
\NormalTok{        echo }\StringTok{"Opsin successfully downloaded."}
    \ControlFlowTok{else}
\NormalTok{        echo }\StringTok{"Opsin not successfully downloaded."}
\NormalTok{        exit}
\NormalTok{    fi}
\NormalTok{fi}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-kegg_catch_smiles.sh}{%
\section{File: kegg\_catch\_smiles.sh}\label{file-kegg_catch_smiles.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# location="\textasciitilde{}/operation/re\_fecal\_neg/kegg"”}
\NormalTok{cd }\SpecialCharTok{\textasciitilde{}}\ErrorTok{/}\NormalTok{operation}\SpecialCharTok{/}\NormalTok{re\_fecal\_neg}\SpecialCharTok{/}\NormalTok{kegg}
\NormalTok{savepath}\OtherTok{=}\StringTok{"cnumber\_cid.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\StringTok{"[:][ ]"} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(FNR==1)}
\StringTok{    \{}
\StringTok{      printf "kegg number}\SpecialCharTok{\textbackslash{}t}\StringTok{" "pubchem id" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{    \}}
\StringTok{  if($0\textasciitilde{}/BEGIN\_COMPOUND/)}
\StringTok{    \{}
\StringTok{      getline}
\StringTok{      if($0\textasciitilde{}/C[0{-}9]*/)}
\StringTok{        \{}
\StringTok{          cnum=$0}
\StringTok{          next\_sub=1}
\StringTok{          print "Catch C number: ", $0}
\StringTok{          printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{"cnum \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        \}}
\StringTok{    else}
\StringTok{      \{}
\StringTok{        next\_sub=0}
\StringTok{        print "Invalid sublist."}
\StringTok{      \}}
\StringTok{    \}}
\StringTok{  if($1\textasciitilde{}/PubChem/ \&\& next\_sub==1)}
\StringTok{    \{}
\StringTok{      printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"$2 \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}}\NormalTok{ dblink.list }
\DocumentationTok{\#\# filter the blank and output the list}
\NormalTok{data}\OtherTok{=}\StringTok{"cnumber\_cid.tsv"}
\NormalTok{nlimit}\OtherTok{=}\DecValTok{100}
\NormalTok{list}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if($1\textasciitilde{}/C[0{-}9]*/)}
\StringTok{    \{}
\StringTok{      if($2=="")}
\StringTok{        \{}
\StringTok{          print "Escape CID of",$1}
\StringTok{        \}}
\StringTok{      if($2!="")}
\StringTok{        \{}
\StringTok{          gsub(/ /,"",$2)}
\StringTok{          if(n\textgreater{}\textquotesingle{}}\SpecialCharTok{$}\NormalTok{nlimit}\StringTok{\textquotesingle{})}
\StringTok{            \{}
\StringTok{              n=0}
\StringTok{              print cid\_set}
\StringTok{            \}}
\StringTok{          n+=1}
\StringTok{          if(n==1)}
\StringTok{            \{}
\StringTok{              cid\_set=$2}
\StringTok{            \}}
\StringTok{        else}
\StringTok{          \{}
\StringTok{            cid\_set=cid\_set","$2}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{\}}
\StringTok{END\{}
\StringTok{print cid\_set}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data)}
\DocumentationTok{\#\# nrow}
\NormalTok{nrow}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}END\{print NR\}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$list"}\NormalTok{))}
\DocumentationTok{\#\#}
\ControlFlowTok{for}\NormalTok{ i }\ControlFlowTok{in} \SpecialCharTok{$}\NormalTok{(seq }\SpecialCharTok{$}\NormalTok{nrow)}
\NormalTok{do}
\NormalTok{  cids}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}\{if(NR==\textquotesingle{}}\SpecialCharTok{$}\NormalTok{i}\StringTok{\textquotesingle{})\{print $0\}\}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$list"}\NormalTok{))}
\NormalTok{  check}\OtherTok{=}\ErrorTok{$}\NormalTok{(echo }\StringTok{"$cids"} \SpecialCharTok{|}\NormalTok{ awk }\StringTok{\textquotesingle{}\{if($0\textasciitilde{}/\^{}[0{-}9]/)\{printf 0\}else\{printf 1\}\}\textquotesingle{}}\NormalTok{)}
  \ControlFlowTok{while}\NormalTok{ [ }\SpecialCharTok{$}\NormalTok{check }\SpecialCharTok{==} \DecValTok{0}\NormalTok{ ]}
\NormalTok{  do}
\NormalTok{    echo }\StringTok{"Try catch pubchem API ($\{i\}/$\{nrow\})..."}
    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{\{i\}\_smiles.csv ]}
\NormalTok{    then}
\NormalTok{      check}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}}
\StringTok{      \{}
\StringTok{        if(FNR==1)}
\StringTok{          \{}
\StringTok{            if($0\textasciitilde{}/CID/)}
\StringTok{              \{}
\StringTok{                printf "1"}
\StringTok{              \}}
\StringTok{          else}
\StringTok{            \{}
\StringTok{              printf "0"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  END\{}
\StringTok{  if(FNR==0)}
\StringTok{    \{}
\StringTok{      printf "0"}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{\{i\}\_smiles.csv)}
\NormalTok{    fi;}
\ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{$}\NormalTok{check }\SpecialCharTok{==} \DecValTok{0}\NormalTok{ ]}
\NormalTok{then}
\NormalTok{  curl }\SpecialCharTok{{-}{-}}\NormalTok{connect}\SpecialCharTok{{-}}\NormalTok{timeout }\DecValTok{20} \SpecialCharTok{{-}{-}}\NormalTok{retry }\DecValTok{100} \SpecialCharTok{{-}{-}}\NormalTok{retry}\SpecialCharTok{{-}}\NormalTok{delay }\DecValTok{30}\NormalTok{ https}\SpecialCharTok{:}\ErrorTok{//}\NormalTok{pubchem.ncbi.nlm.nih.gov}\SpecialCharTok{/}\NormalTok{rest}\SpecialCharTok{/}\NormalTok{pug}\SpecialCharTok{/}\NormalTok{compound}\SpecialCharTok{/}\NormalTok{cid}\SpecialCharTok{/}\ErrorTok{$}\NormalTok{\{cids\}}\SpecialCharTok{/}\NormalTok{property}\SpecialCharTok{/}\NormalTok{CanonicalSMILES,IsomericSMILES}\SpecialCharTok{/}\NormalTok{CSV }\SpecialCharTok{\textgreater{}} \ErrorTok{$}\NormalTok{\{i\}\_smiles.csv}
\NormalTok{fi;}
\NormalTok{done;}
\NormalTok{done;}
\DocumentationTok{\#\# merge and reformat}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\StringTok{"[,]"} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==1)}
\StringTok{    \{}
\StringTok{      printf $1}
\StringTok{      for(i=2; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{          printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"$i}
\StringTok{        \}}
\StringTok{      printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{    \}}
\StringTok{  if(FNR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{      printf $1}
\StringTok{      for(i=2; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{          printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"$i}
\StringTok{        \}}
\StringTok{      printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{*}\NormalTok{\_smiles.csv }\SpecialCharTok{|}\NormalTok{ sed }\StringTok{\textquotesingle{}s/}\SpecialCharTok{\textbackslash{}"}\StringTok{//g\textquotesingle{}} \SpecialCharTok{|}\NormalTok{ awk }\StringTok{\textquotesingle{}\{if($2!="")\{print $0\}\}\textquotesingle{}} \SpecialCharTok{\textgreater{}}\NormalTok{ merge\_smiles.tsv}
\DocumentationTok{\#\# as sirius db}
\NormalTok{Rscript }\SpecialCharTok{\textasciitilde{}}\ErrorTok{/}\NormalTok{Downloads}\SpecialCharTok{/}\NormalTok{codes}\SpecialCharTok{/}\NormalTok{sirius\_db.R}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-ladder.sh}{%
\section{File: ladder.sh}\label{file-ladder.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ similarity\_limit}\OtherTok{=}\FloatTok{0.4}
\NormalTok{ num\_limit\_1}\OtherTok{=}\DecValTok{30}
\NormalTok{ num\_limit\_2}\OtherTok{=}\DecValTok{500}
\NormalTok{ tlimit}\OtherTok{=}\FloatTok{0.4}
 \ControlFlowTok{for}\NormalTok{ i }\ControlFlowTok{in} \FloatTok{0.4} \FloatTok{0.5} \FloatTok{0.6} \FloatTok{0.7} \FloatTok{0.8} \FloatTok{0.9} \FloatTok{0.95} \FloatTok{0.99}
\NormalTok{ do}
\NormalTok{ definition\_limit}\OtherTok{=}\ErrorTok{$}\NormalTok{i}
\NormalTok{ data1}\OtherTok{=}\StringTok{"temp/filter\_0\_class.tsv"} 
\NormalTok{ data2}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\NormalTok{ data3}\OtherTok{=}\StringTok{"results/fingerid\_first\_score.tsv"}
\NormalTok{ class\_pp\_limit}\OtherTok{=}\ErrorTok{$}\NormalTok{definition\_limit}
\NormalTok{ savepath}\OtherTok{=}\StringTok{"temp/idenfication\_filter\_$class\_pp\_limit.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{   \{}
\StringTok{   if(NR==FNR)}
\StringTok{     \{}
\StringTok{     filter\_class[$1]=$1}
\StringTok{     \}}
\StringTok{   if(FILENAME\textasciitilde{}/canopus/)}
\StringTok{     \{}
\StringTok{     if(FNR==1)}
\StringTok{       \{}
\StringTok{       col\_id=1}
\StringTok{       for(i=2; i\textless{}=NF; i++)}
\StringTok{         \{}
\StringTok{         for(j in filter\_class)}
\StringTok{           \{}
\StringTok{           if(j==$i)}
\StringTok{             \{}
\StringTok{             col\_class[j]=i}
\StringTok{             print i}
\StringTok{             \}}
\StringTok{           \}}
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     if(FNR\textgreater{}=2)}
\StringTok{       \{}
\StringTok{       for(i in col\_class)}
\StringTok{         \{}
\StringTok{         if(sprintf("\%.3f",$col\_class[i])+0\textgreater{}="\textquotesingle{}}\SpecialCharTok{$}\NormalTok{class\_pp\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{           \{}
\StringTok{           class\_set[i,$col\_id]=i}
\StringTok{           print "ID: ",$1,i,$col\_class[i]}
\StringTok{           \}}
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     \}}
\StringTok{   if(FILENAME\textasciitilde{}/fingerid\_first\_score/)}
\StringTok{     \{}
\StringTok{     if(FNR==1)}
\StringTok{       \{}
\StringTok{       for(i=1; i\textless{}=NF; i++)}
\StringTok{         \{}
\StringTok{         if($i\textasciitilde{}/\^{}id/)}
\StringTok{         \{}
\StringTok{         col\_id=i}
\StringTok{         \}}
\StringTok{       if($i\textasciitilde{}/similarity/)}
\StringTok{         \{}
\StringTok{         col\_similarity=i}
\StringTok{         \}}
\StringTok{         \}}
\StringTok{       printf "class\_nebula\_facet}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{       \}}
\StringTok{     if(FNR\textgreater{}=2)}
\StringTok{       \{}
\StringTok{       if($col\_similarity+0 \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{similarity\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{         \{}
\StringTok{        for(i in class\_set)}
\StringTok{          \{}
\StringTok{          if(i\textasciitilde{}"}\SpecialCharTok{\textbackslash{}034}\StringTok{"$col\_id"$")}
\StringTok{            \{}
\StringTok{            printf class\_set[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{          \}}
\StringTok{        \}}
\StringTok{       \}}
\StringTok{     \}}
\StringTok{   \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ data}\OtherTok{=}\StringTok{"temp/idenfication\_filter\_$class\_pp\_limit.tsv"}
\NormalTok{ savepath}\OtherTok{=}\StringTok{"temp/idenfication\_filter2\_$\{class\_pp\_limit\}.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{   \{}
\StringTok{   if(FNR==1)}
\StringTok{     \{}
\StringTok{     printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{     for(i=1; i\textless{}=NF; i++)}
\StringTok{       \{}
\StringTok{       if($i\textasciitilde{}/class\_nebula\_facet/)}
\StringTok{         \{}
\StringTok{         col\_class=i}
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     \}}
\StringTok{ if(FNR\textgreater{}=2)}
\StringTok{   \{}
\StringTok{   num[$col\_class]+=1}
\StringTok{   data[FNR]=$0}
\StringTok{     class[FNR]=$col\_class}
\StringTok{   \}}
\StringTok{  \}}
\StringTok{   END\{}
\StringTok{     for(i in num)}
\StringTok{       \{}
\StringTok{       if(num[i]+0 \textgreater{}= \textquotesingle{}}\SpecialCharTok{$}\NormalTok{num\_limit\_1}\StringTok{\textquotesingle{}+0 \&\& num[i]+0 \textless{}= \textquotesingle{}}\SpecialCharTok{$}\NormalTok{num\_limit\_2}\StringTok{\textquotesingle{})}
\StringTok{         \{}
\StringTok{         printf "The nodes number of the child{-}nebula is " num[i] ".}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{         for(j in class)}
\StringTok{           \{}
\StringTok{           if(class[j]==i)}
\StringTok{             \{}
\StringTok{             printf data[j]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{             \}}
\StringTok{           \}}
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ mkdir results}\SpecialCharTok{/}\NormalTok{network\_facet\_}\SpecialCharTok{$}\NormalTok{class\_pp\_limit}
\NormalTok{ data1}\OtherTok{=}\StringTok{"temp/idenfication\_filter2\_$\{class\_pp\_limit\}.tsv"}
\NormalTok{ data2}\OtherTok{=}\StringTok{"results/source\_target\_tree\_$tlimit.tsv"} \CommentTok{\# "results/source\_target\_tree\_0.4.tsv"}
\NormalTok{ save\_class}\OtherTok{=}\StringTok{"results/filter\_child\_class.tsv"}
\NormalTok{ savepath}\OtherTok{=}\StringTok{"results/network\_facet\_$class\_pp\_limit/"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{   \{}
\StringTok{   if(NR==FNR)}
\StringTok{     \{}
\StringTok{     if(FNR==1)}
\StringTok{       \{}
\StringTok{       for(i=1; i\textless{}=NF; i++)}
\StringTok{         \{}
\StringTok{         if($i\textasciitilde{}/class\_nebula\_facet/)}
\StringTok{           \{}
\StringTok{           col\_class=i}
\StringTok{           \}}
\StringTok{         if($i\textasciitilde{}/\^{}id$/)}
\StringTok{           \{}
\StringTok{           col\_id=i}
\StringTok{           \}}
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     if(FNR\textgreater{}=2)}
\StringTok{       \{}
\StringTok{       class[$col\_class]=$col\_class}
\StringTok{       class\_id[$col\_class,$col\_id]=$col\_id}
\StringTok{       stat\_id[$col\_class,$col\_id]=$col\_id}
\StringTok{       belong[$col\_class,$col\_id]=$col\_class}
\StringTok{       \}}
\StringTok{     \}}
\StringTok{   if(NR\textgreater{}FNR)}
\StringTok{     \{}
\StringTok{     if(FNR==1)}
\StringTok{       \{}
\StringTok{       for(i in class)}
\StringTok{         \{}
\StringTok{         printf i"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{save\_class}\StringTok{\textquotesingle{}"}
\StringTok{         printf $0"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "facet}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" i ".tsv"}
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     if(FNR\textgreater{}=2)}
\StringTok{       \{}
\StringTok{       for(i in class)}
\StringTok{         \{}
\StringTok{         if( class\_id[i,$1]==$1 \&\& class\_id[i,$2]==$2 )}
\StringTok{           \{}
\StringTok{           printf $0"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  i"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" i ".tsv"}
\StringTok{           delete stat\_id[i,$1]}
\StringTok{           delete stat\_id[i,$2]}
\StringTok{           \}}
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     \}}
\StringTok{   \}}
\StringTok{   END\{}
\StringTok{     for(i in stat\_id)}
\StringTok{       \{}
\StringTok{       \#\# source target similarity delta\_mz fp fp class}
\StringTok{       printf stat\_id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" stat\_id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "1}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "0}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "null}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "null}\SpecialCharTok{\textbackslash{}t}\StringTok{"  belong[i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textbackslash{}}
\StringTok{       \textbackslash{}}
\StringTok{       \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" belong[i] ".tsv"}
\StringTok{       \}}
\StringTok{     \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
\NormalTok{ done;}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-marvin.sh}{%
\section{File: marvin.sh}\label{file-marvin.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\# marvin}
\DocumentationTok{\#\# location \textasciitilde{}/operation/back/0703\_all}
\NormalTok{data}\OtherTok{=}\StringTok{"results/fingerid\_first\_score.tsv"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"results/structure\_2d/smiles\_draw"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(FNR==1)}
\StringTok{    \{}
\StringTok{      for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{          if($i\textasciitilde{}/\^{}id/)}
\StringTok{            \{}
\StringTok{              col\_id=i}
\StringTok{            \}}
\StringTok{          if($i\textasciitilde{}/smiles/)}
\StringTok{            \{}
\StringTok{              col\_smiles=i}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FNR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{      system("molconvert mol }\SpecialCharTok{\textbackslash{}"}\StringTok{"  $col\_smiles  "}\SpecialCharTok{\textbackslash{}"}\StringTok{ {-}o \textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}/"  $col\_id  ".mol")}
\StringTok{      close("molconvert mol }\SpecialCharTok{\textbackslash{}"}\StringTok{"  $col\_smiles  "}\SpecialCharTok{\textbackslash{}"}\StringTok{ {-}o \textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}/"  $col\_id  ".mol")}
\StringTok{      printf "Info: the ID is "$col\_id". Row number:"FNR".}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\DocumentationTok{\#\#\# use obabel to convert mol format}
\NormalTok{ls results}\SpecialCharTok{/}\NormalTok{structure\_2d}\SpecialCharTok{/}\NormalTok{smiles\_draw}\SpecialCharTok{/}\NormalTok{[}\DecValTok{0{-}9}\NormalTok{]}\SpecialCharTok{*}\NormalTok{.mol }\SpecialCharTok{|}\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  split($0, a, "[.][m][o][l]")}
\StringTok{  system("obabel "  $0  " {-}imol {-}osvg {-}O "  a[1]  ".mol.svg")}
\StringTok{  close("obabel "  $0  " {-}imol {-}osvg {-}O "  a[1]  ".mol.svg")}
\StringTok{  print a[1]".svg"}
\StringTok{\}\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{sed }\SpecialCharTok{{-}}\NormalTok{i }\SpecialCharTok{{-}}\NormalTok{e }\StringTok{\textquotesingle{}s/white/transparent/g; s/stroke{-}width="2.0"/stroke{-}width="4.0"/g;\textquotesingle{}}\NormalTok{ results}\SpecialCharTok{/}\NormalTok{structure\_2d}\SpecialCharTok{/}\NormalTok{smiles\_draw}\SpecialCharTok{/}\NormalTok{[}\DecValTok{0{-}9}\NormalTok{]}\SpecialCharTok{*}\NormalTok{.mol.svg}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ls results}\SpecialCharTok{/}\NormalTok{structure\_2d}\SpecialCharTok{/}\NormalTok{smiles\_draw}\SpecialCharTok{/}\NormalTok{[}\DecValTok{0{-}9}\NormalTok{]}\SpecialCharTok{*}\NormalTok{.mol.svg }\SpecialCharTok{|}\NormalTok{ awk }\StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if($0\textasciitilde{}/cairo/)}
\StringTok{    \{}
\StringTok{      next}
\StringTok{    \}}
\StringTok{else}
\StringTok{  \{}
\StringTok{    system("cairosvg "  $0  " {-}o "  $0 ".cairo.svg")}
\StringTok{    close("cairosvg "  $0  " {-}o "  $0 ".cairo.svg")}
\StringTok{    printf "Info: the filename is "$0"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{  \}}
\StringTok{\}\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#              candidate structure}
\CommentTok{\#mkdir results/structure\_2d/candidate}
\NormalTok{data}\OtherTok{=}\StringTok{"results/structure\_2d/candidate/*\_class.tsv"}
\NormalTok{id\_set}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(FNR==1)}
\StringTok{    \{}
\StringTok{      for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{          if($i\textasciitilde{}/"group\_sub"/ || $i\textasciitilde{}/\^{}group\_sub$/)}
\StringTok{            \{}
\StringTok{              col\_group\_sub=i}
\StringTok{              \#print i,NF}
\StringTok{            \}}
\StringTok{          if($i\textasciitilde{}/"group"/ || $i\textasciitilde{}/\^{}group$/)}
\StringTok{            \{}
\StringTok{              col\_group=i}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FNR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{      id[$col\_group\_sub]=$col\_group\_sub}
\StringTok{      id[$col\_group]=$col\_group}
\StringTok{    \}}
\StringTok{\}}
\StringTok{END\{}
\StringTok{for(i in id)}
\StringTok{  \{}
\StringTok{    n+=1}
\StringTok{    if(n==1)}
\StringTok{      \{}
\StringTok{        printf i}
\StringTok{      \}}
\StringTok{  else}
\StringTok{    \{}
\StringTok{      printf "\_"i}
\StringTok{    \}}
\StringTok{\}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{path}\OtherTok{=}\StringTok{"/media/wizard/back/0703\_all"}
\NormalTok{awk }\StringTok{\textquotesingle{}}
\StringTok{BEGIN\{}
\StringTok{path="\textquotesingle{}}\SpecialCharTok{$}\NormalTok{path}\StringTok{\textquotesingle{}"}
\StringTok{file\_set="\textquotesingle{}}\SpecialCharTok{$}\NormalTok{id\_set}\StringTok{\textquotesingle{}"}
\StringTok{n=split(file\_set, a, "[\_]")}
\StringTok{for(i=1; i\textless{}=n; i++)}
\StringTok{  \{}
\StringTok{    "ls {-}d "  path  "/*\_" a[i] | getline}
\StringTok{    close("ls {-}d "  path  "/*\_" a[i] | getline)}
\StringTok{    name=name""$0"/structure\_candidates.tsv "}
\StringTok{  \}}
\StringTok{printf name \textgreater{} "tmp"}
\StringTok{\}\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{savepath}\OtherTok{=}\StringTok{"results/structure\_2d/candidate"}
\NormalTok{can\_num}\OtherTok{=}\DecValTok{30}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(FNR==1)}
\StringTok{    \{}
\StringTok{      n=split(FILENAME, a, "[/]")}
\StringTok{      for(i=1; i\textless{}=n; i++)}
\StringTok{        \{}
\StringTok{          if(a[i]\textasciitilde{}/[0{-}9](.*)\_(.*)\_(.*)[0{-}9]/)}
\StringTok{            \{}
\StringTok{              file=a[i]}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      n=split(file, b, "[\_]")}
\StringTok{      id=b[n]}
\StringTok{      for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{          if($i\textasciitilde{}/smiles/)}
\StringTok{            \{}
\StringTok{              col\_smiles=i}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FNR\textgreater{}=2 \&\& FNR \textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{can\_num}\StringTok{\textquotesingle{})}
\StringTok{    \{}
\StringTok{      num[id]+=1}
\StringTok{      system("molconvert mol }\SpecialCharTok{\textbackslash{}"}\StringTok{" $col\_smiles "}\SpecialCharTok{\textbackslash{}"}\StringTok{ {-}o \textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}/" id "\_can\_" num[id] ".mol")}
\StringTok{      close("molconvert mol }\SpecialCharTok{\textbackslash{}"}\StringTok{" $col\_smiles "}\SpecialCharTok{\textbackslash{}"}\StringTok{ {-}o \textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}/" id "\_can\_" num[id] ".mol")}
\StringTok{      printf id " \textgreater{}\textgreater{}\textgreater{} " num[id] "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{(cat tmp)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ls results}\SpecialCharTok{/}\NormalTok{structure\_2d}\SpecialCharTok{/}\NormalTok{candidate}\SpecialCharTok{/}\NormalTok{3918\_}\SpecialCharTok{*}\NormalTok{.mol }\SpecialCharTok{|}\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  split($0, a, "[.][m][o][l]")}
\StringTok{  system("obabel "  $0  " {-}imol {-}osvg {-}O "  a[1]  ".mol.svg")}
\StringTok{  close("obabel "  $0  " {-}imol {-}osvg {-}O "  a[1]  ".mol.svg")}
\StringTok{  print a[1]".svg"}
\StringTok{\}\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{sed }\SpecialCharTok{{-}}\NormalTok{i }\SpecialCharTok{{-}}\NormalTok{e }\StringTok{\textquotesingle{}s/white/transparent/g\textquotesingle{}}\NormalTok{ results}\SpecialCharTok{/}\NormalTok{structure\_2d}\SpecialCharTok{/}\NormalTok{candidate}\SpecialCharTok{/}\NormalTok{3918\_}\SpecialCharTok{*}\NormalTok{.mol.svg}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ls results}\SpecialCharTok{/}\NormalTok{structure\_2d}\SpecialCharTok{/}\NormalTok{candidate}\SpecialCharTok{/}\NormalTok{3918\_}\SpecialCharTok{*}\NormalTok{.mol.svg }\SpecialCharTok{|}\NormalTok{ awk }\StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if($0\textasciitilde{}/cairo/)}
\StringTok{    \{}
\StringTok{      next}
\StringTok{    \}}
\StringTok{else}
\StringTok{  \{}
\StringTok{    system("cairosvg "  $0  " {-}o "  $0 ".cairo.svg")}
\StringTok{    close("cairosvg "  $0  " {-}o "  $0 ".cairo.svg")}
\StringTok{    printf "Info: the filename is "$0"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{  \}}
\StringTok{\}\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-mcnebula_1.0.sh}{%
\section{File: MCnebula\_1.0.sh}\label{file-mcnebula_1.0.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# bin/bash}

\NormalTok{echo }\StringTok{"We are all in the gutter, }
\StringTok{but some of us are looking at the stars."}\NormalTok{;}
\NormalTok{PS3}\OtherTok{=}\StringTok{\textquotesingle{}Please select the workflow to be executed. \textgreater{}\textgreater{}\textgreater{} \textquotesingle{}}
\NormalTok{select command }\ControlFlowTok{in}\NormalTok{ \textbackslash{}}
  \StringTok{"MCnebula\_workflow"}\NormalTok{ \textbackslash{}}
  \StringTok{"structure\_extract"}\NormalTok{ \textbackslash{}}
  \StringTok{"classification\_extract\_sum"}\NormalTok{ \textbackslash{}}
  \StringTok{"classification\_extract\_filter"}\NormalTok{ \textbackslash{}}
  \StringTok{"fragment\_tree\_network"}\NormalTok{ \textbackslash{}}
  \StringTok{"fragment\_tree\_network\_delta"}\NormalTok{ \textbackslash{}}
  \StringTok{"structure\_candidate\_top10"}\NormalTok{ \textbackslash{}}
  \StringTok{"(beta)"}\NormalTok{ \textbackslash{}}
  \StringTok{"exit"} 
\NormalTok{do}
  \ControlFlowTok{if}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{command }\SpecialCharTok{==} \StringTok{"MCnebula\_workflow"}\NormalTok{ ]]}
\NormalTok{  then}
\NormalTok{    confirm}\OtherTok{=}\DecValTok{0}
\NormalTok{    until [[ }\SpecialCharTok{$}\NormalTok{confirm }\SpecialCharTok{==} \StringTok{"yes"}\NormalTok{ ]] }\SpecialCharTok{||}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{confirm }\SpecialCharTok{==} \StringTok{"no"}\NormalTok{ ]]}
\NormalTok{    do}
\NormalTok{      read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Running all proccesses sequentially? [yes/no] \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ confirm}
\NormalTok{    done;}
    \ControlFlowTok{if}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{confirm }\SpecialCharTok{==} \StringTok{"no"}\NormalTok{ ]]}
\NormalTok{    then exit}
\NormalTok{    fi;}
\NormalTok{    default}\OtherTok{=}\StringTok{"structure\_extract classification\_extract\_sum classification\_extract\_filter fragment\_tree\_network fragment\_tree\_network\_delta"}
\NormalTok{    list}\OtherTok{=}\ErrorTok{$}\NormalTok{(echo }\SpecialCharTok{$}\NormalTok{default);}
  \ControlFlowTok{else}\NormalTok{ list}\OtherTok{=}\ErrorTok{$}\NormalTok{( echo }\SpecialCharTok{$}\NormalTok{command)}
\NormalTok{  fi;}
  \ControlFlowTok{for}\NormalTok{ option }\ControlFlowTok{in} \SpecialCharTok{$}\NormalTok{(echo }\SpecialCharTok{$}\NormalTok{list)}
\NormalTok{  do}
\NormalTok{    case }\SpecialCharTok{$}\NormalTok{option }\ControlFlowTok{in}
      \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
      \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
      \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
      \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{      structure\_extract}\ErrorTok{)}
\NormalTok{      echo }\StringTok{"Run structure\_extract."}
\NormalTok{      projectpath}\OtherTok{=}\DecValTok{0}
\NormalTok{      until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{canopus\_summary.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{      do}
\NormalTok{        read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{      done;}
\NormalTok{      cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{      mkdir results;}
\NormalTok{      mkdir temp;}
\NormalTok{      mkdir temp}\SpecialCharTok{/}\NormalTok{fintemp;}
      \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{Mo\_filename ]}
\NormalTok{      then rm temp}\SpecialCharTok{/}\NormalTok{Mo\_filename}
\NormalTok{      fi;}
\NormalTok{      data}\OtherTok{=}\StringTok{"*\_*/fingerid/*.tsv"}
\NormalTok{      awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{      BEGIN\{}
\StringTok{      all\_id=0}
\StringTok{      max\_id={-}1}
\StringTok{      p\_id="null"}
\StringTok{      printf "Info: loading the data..."}
\StringTok{    \}}
\StringTok{  \{}
\StringTok{    if(FNR==1)}
\StringTok{      \{}
\StringTok{        if(NR\textgreater{}FNR)}
\StringTok{          \{}
\StringTok{            close(pfile)}
\StringTok{          \}}
\StringTok{        f=split(FILENAME,a,"[/]");}
\StringTok{        n=split(a[1],b,"[\_]");}
\StringTok{        id=b[n];}
\StringTok{        if(id!=p\_id)}
\StringTok{          \{}
\StringTok{            all\_id+=1}
\StringTok{            if(id\textgreater{}max\_id)}
\StringTok{              \{}
\StringTok{                max\_id=id}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{        file[id]=a[1]}
\StringTok{        split(a[f], g, "[.]")}
\StringTok{        formu\_type[id]=g[1]}
\StringTok{        if(all\_id==1)}
\StringTok{          \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{              \{}
\StringTok{                if(($i\textasciitilde{}/inchikey2D/))}
\StringTok{                  \{}
\StringTok{                    col\_2D=i}
\StringTok{                  \}}
\StringTok{                if($i=="inchi")}
\StringTok{                  \{}
\StringTok{                    col\_inchi=i}
\StringTok{                  \}}
\StringTok{                if(($i\textasciitilde{}/Formula/))}
\StringTok{                  \{}
\StringTok{                    col\_formu=i}
\StringTok{                  \}}
\StringTok{                if($i=="score")}
\StringTok{                  \{}
\StringTok{                    col\_score=i}
\StringTok{                  \}}
\StringTok{                if($i=="name")}
\StringTok{                  \{}
\StringTok{                    col\_name=i}
\StringTok{                  \}}
\StringTok{                if($i=="smiles")}
\StringTok{                  \{}
\StringTok{                    col\_smiles=i}
\StringTok{                  \}}
\StringTok{                if($i=="xlogp")}
\StringTok{                  \{}
\StringTok{                    col\_x=i}
\StringTok{                  \}}
\StringTok{                if(($i\textasciitilde{}/imilarity/))}
\StringTok{                  \{}
\StringTok{                    col\_simi=i}
\StringTok{                  \}}
\StringTok{                if($i\textasciitilde{}/links/)}
\StringTok{                  \{}
\StringTok{                    col\_links=i}
\StringTok{                  \}}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{        pfile=FILENAME}
\StringTok{        printf g[1]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"formu\_type[id]"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{        printf "Info: the data of " id " (ID) has input. The filename is " FILENAME ".}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{      \}}
\StringTok{    if(FNR\textgreater{}=2)}
\StringTok{      \{}
\StringTok{        row\_score=$col\_score}
\StringTok{        row\_simi=$col\_simi}
\StringTok{        if(max["score",id]=="" || max["score",id]+0\textless{}row\_score+0)}
\StringTok{          \{}
\StringTok{            max["score",id]=row\_score}
\StringTok{            name["score",id]=$col\_name}
\StringTok{            formula["score",id]=$col\_formu}
\StringTok{            formu\_type["score",id]=formu\_type[id]}
\StringTok{            simi["score",id]=$col\_simi}
\StringTok{            smiles["score",id]=$col\_smiles}
\StringTok{            inchi["score",id]=$col\_inchi}
\StringTok{            in2D["score",id]=$col\_2D}
\StringTok{            score["score",id]=$col\_score}
\StringTok{            xlogp["score",id]=$col\_x}
\StringTok{            links["score",id]=$col\_links}
\StringTok{          \}}
\StringTok{        if(max["simi",id]=="" || max["simi",id]+0\textless{}row\_simi+0)}
\StringTok{          \{}
\StringTok{            max["simi",id]=row\_simi}
\StringTok{            name["simi",id]=$col\_name}
\StringTok{            formula["simi",id]=$col\_formu}
\StringTok{            formu\_type["simi",id]=formu\_type[id]}
\StringTok{            simi["simi",id]=$col\_simi}
\StringTok{            smiles["simi",id]=$col\_smiles}
\StringTok{            inchi["simi",id]=$col\_inchi}
\StringTok{            in2D["simi",id]=$col\_2D}
\StringTok{            score["simi",id]=$col\_score}
\StringTok{            xlogp["simi",id]=$col\_x}
\StringTok{            links["simi",id]=$col\_links}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{END\{}
\StringTok{printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "formula}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "smiles}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchi}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchikey2D}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "score}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "xlogp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "links}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/fingerid\_sum.tsv"}
\StringTok{for(l in file)}
\StringTok{  \{}
\StringTok{    if(max["score",l]!="")}
\StringTok{      \{}
\StringTok{        printf l"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  name["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  formula["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  simi["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  smiles["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  inchi["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  in2D["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  score["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  xlogp["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  links["score",l]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/fingerid\_sum.tsv"}
\StringTok{        printf formula["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  file[l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  formu\_type["score",l]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "temp/Mo\_filename"}
\StringTok{      \}}
\StringTok{    if(max["simi",l]!="" \&\& max["simi",l]!=max["score",l])}
\StringTok{      \{}
\StringTok{        printf l"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  name["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  formula["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  simi["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  smiles["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  inchi["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  in2D["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  score["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  xlogp["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  links["simi",l]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/fingerid\_sum.tsv"}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\NormalTok{data\_sum}\OtherTok{=}\StringTok{"results/fingerid\_sum.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==1)}
\StringTok{    \{}
\StringTok{      for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{          if($i\textasciitilde{}/id/)}
\StringTok{            \{}
\StringTok{              col\_id=i}
\StringTok{            \}}
\StringTok{          if($i\textasciitilde{}/score/)}
\StringTok{            \{}
\StringTok{              col\_score=i}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(NR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{      id=$col\_id}
\StringTok{      if(max\_id+0\textless{}id || max\_id=="")}
\StringTok{        \{}
\StringTok{          max\_id=id}
\StringTok{        \}}
\StringTok{      if(score[id]+0\textless{}$col\_score+0 || score[id]=="")}
\StringTok{        \{}
\StringTok{          score[id]=$col\_score}
\StringTok{          data[id]=$0}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{\}}
\StringTok{END\{}
\StringTok{printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "formula}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "smiles}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchi}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchikey2D}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "score}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "xlogp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "links}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/fingerid\_first\_score.tsv"}
\StringTok{for(i=1; i\textless{}=max\_id; i++)}
\StringTok{  \{}
\StringTok{    if(data[i]!="")}
\StringTok{      \{}
\StringTok{        printf data[i] "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/fingerid\_first\_score.tsv"}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data\_sum}
\NormalTok{echo }\StringTok{"structure\_extract results have been successfully assembled into \textless{}results/fingerid\_sum.tsv\textgreater{} and \textless{}results/fingerid\_first\_score.tsv\textgreater{}"}\NormalTok{;}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{classification\_extract\_sum}\ErrorTok{)}
\NormalTok{echo }\StringTok{"Run classification\_extract\_sum."}\NormalTok{;}
\ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{Mo\_filename ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f canopus.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f canopus\_neg.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f .format ]}
\NormalTok{then}
\NormalTok{  echo }\StringTok{"Project path acknowledged."}
\ControlFlowTok{else}
\NormalTok{  until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{canopus.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{  do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{  done;}
\NormalTok{  cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{fi;}
\NormalTok{data1}\OtherTok{=}\StringTok{"temp/Mo\_filename"}
\NormalTok{data2}\OtherTok{=}\StringTok{"canopus.tsv"}
\NormalTok{data3}\OtherTok{=}\StringTok{"canopus\_neg.tsv"}
\NormalTok{datas}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  x=$2"/canopus/"$3".fpt"}
\StringTok{  if(getline \textless{} x == 1)}
\StringTok{    \{}
\StringTok{      printf x" "}
\StringTok{    \}}
\StringTok{  close(x)}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{      i=split($2,s,"[\_]")}
\StringTok{      the\_id[FNR]=s[i]}
\StringTok{      n=FNR}
\StringTok{    \}}
\StringTok{  if(FILENAME \textasciitilde{} /canopus.tsv/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if($i \textasciitilde{} /\^{}name/)}
\StringTok{                \{}
\StringTok{                  col\_class=i}
\StringTok{                \}}
\StringTok{              if($i \textasciitilde{} /absolute/)}
\StringTok{                \{}
\StringTok{                  col\_abindex=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          abindex[1,FNR]=$col\_abindex}
\StringTok{          indexset[$col\_abindex]=$col\_class}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FILENAME \textasciitilde{} /canopus\_neg.tsv/)}
\StringTok{    \{}
\StringTok{      p\_filename=FILENAME}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if($i \textasciitilde{} /name/)}
\StringTok{                \{}
\StringTok{                  col\_class=i}
\StringTok{                \}}
\StringTok{              if($i \textasciitilde{} /absolute/)}
\StringTok{                \{}
\StringTok{                  col\_abindex=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          abindex[2,FNR]=$col\_abindex}
\StringTok{          indexset[$col\_abindex]=$col\_class}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FILENAME \textasciitilde{} /.fpt/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          close(p\_filename)}
\StringTok{          printf "Info: data\_file name of " p\_filename " has been input.}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{          p\_filename=FILENAME}
\StringTok{          split(FILENAME,a,"[/]");}
\StringTok{          m=split(a[1],b,"[\_]");}
\StringTok{          id=b[m];}
\StringTok{          if(FILENAME \textasciitilde{} /\textbackslash{}+.fpt/)}
\StringTok{            \{}
\StringTok{              ion=1}
\StringTok{            \}}
\StringTok{          if(FILENAME \textasciitilde{} /\textbackslash{}{-}.fpt/)}
\StringTok{            \{}
\StringTok{              ion=2}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      pp[id,abindex[ion,FNR+1]]=sprintf("\%.3f",$1)}
\StringTok{    \}}
\StringTok{\}}
\StringTok{END\{}
\StringTok{printf "id" \textgreater{} "results/canopus\_pp.tsv"}
\StringTok{for(i in indexset)}
\StringTok{  \{}
\StringTok{    ord+=1}
\StringTok{    orderlist[ord]=i}
\StringTok{    printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"indexset[i] \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{  \}}
\StringTok{printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{for(i=1; i\textless{}=n; i++)}
\StringTok{  \{}
\StringTok{    printf the\_id[i] \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{    for(j=1; j\textless{}=ord; j++)}
\StringTok{      \{}
\StringTok{        if(pp[the\_id[i],orderlist[j]]=="")}
\StringTok{          \{}
\StringTok{            pp[the\_id[i],orderlist[j]]=0}
\StringTok{          \}}
\StringTok{        printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"pp[the\_id[i],orderlist[j]] \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{      \}}
\StringTok{    printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{  \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3 }\SpecialCharTok{$}\NormalTok{datas}
\NormalTok{echo }\StringTok{"classiication\_extract\_sum have been successfully written into \textless{}results/canopus\_pp.tsv\textgreater{}"}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{classification\_extract\_filter}\ErrorTok{)}
\NormalTok{echo }\StringTok{"Run classification\_extract\_filter."}\NormalTok{;}
\ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f results}\SpecialCharTok{/}\NormalTok{canopus\_pp.tsv ]}
\NormalTok{then}
\NormalTok{  echo }\StringTok{"Project path acknowledged."}
\ControlFlowTok{else}
\NormalTok{  until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{results}\SpecialCharTok{/}\NormalTok{canopus\_pp.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{results}\SpecialCharTok{/}\NormalTok{canopus\_summary.tsv ]}
\NormalTok{  do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{  done;}
\NormalTok{  cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{fi; }
\NormalTok{check}\OtherTok{=}\DecValTok{0}
\NormalTok{until [[ }\StringTok{"$check"} \SpecialCharTok{==} \StringTok{"yes"}\NormalTok{ ]] }\SpecialCharTok{||}\NormalTok{ [[ }\StringTok{"$check"} \SpecialCharTok{==} \StringTok{"no"}\NormalTok{ ]]}
\NormalTok{do}
\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Collate the posterior probabilities of the classification of each feature? [yes/no] \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ check;}
\NormalTok{done;}
\ControlFlowTok{if}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{check }\SpecialCharTok{==} \StringTok{"yes"}\NormalTok{ ]]}
\NormalTok{then}
\NormalTok{  definition\_limit}\OtherTok{=}\DecValTok{0}
\NormalTok{  until [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textgreater{}} \StringTok{"0.01"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textless{}} \StringTok{"1"}\NormalTok{ ]]}
\NormalTok{  do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the classes posterior probabilities limition. 0.5\textasciitilde{}0.99 may work well. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ definition\_limit;}
\NormalTok{  done;}
\NormalTok{  data1}\OtherTok{=}\StringTok{"canopus\_summary.tsv"}
\NormalTok{  data2}\OtherTok{=}\StringTok{"canopus.tsv"}
\NormalTok{  data3}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\NormalTok{  awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  \{}
\StringTok{    if(NR==FNR)}
\StringTok{      \{}
\StringTok{        if(FNR==1)}
\StringTok{          \{}
\StringTok{            p\_file=FILENAME}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{              \{}
\StringTok{                if($i\textasciitilde{}/name/)}
\StringTok{                  \{}
\StringTok{                    col\_id=i}
\StringTok{                  \}}
\StringTok{                if($i\textasciitilde{}/specific/)}
\StringTok{                  \{}
\StringTok{                    col\_specific=i}
\StringTok{                  \}}
\StringTok{                if($i\textasciitilde{}/level/)}
\StringTok{                  \{}
\StringTok{                    col\_level=i}
\StringTok{                  \}}
\StringTok{                if($i\textasciitilde{}/subclass/)}
\StringTok{                  \{}
\StringTok{                    col\_subclass=i}
\StringTok{                  \}}
\StringTok{                if($i\textasciitilde{}/\^{}class/)}
\StringTok{                  \{}
\StringTok{                    col\_class=i}
\StringTok{                  \}}
\StringTok{                if($i\textasciitilde{}/superclass/)}
\StringTok{                  \{}
\StringTok{                    col\_superclass=i}
\StringTok{                  \}}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{          \{}
\StringTok{            n=split($col\_id,a,"[\_]")}
\StringTok{            id=a[n]}
\StringTok{            specific[id]=$col\_specific}
\StringTok{            level[id]=$col\_level}
\StringTok{            subclass[id]=$col\_subclass}
\StringTok{            class[id]=$col\_class}
\StringTok{            superclass[id]=$col\_superclass}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{    if(FILENAME\textasciitilde{}/canopus.tsv/)}
\StringTok{      \{}
\StringTok{        if(FNR==1)}
\StringTok{          \{}
\StringTok{            close(p\_file)}
\StringTok{            p\_file=FILENAME}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{              \{}
\StringTok{                if($i\textasciitilde{}/name/)}
\StringTok{                  \{}
\StringTok{                    col\_name=i}
\StringTok{                  \}}
\StringTok{                if($i\textasciitilde{}/description/)}
\StringTok{                  \{}
\StringTok{                    col\_description=i}
\StringTok{                  \}}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{          \{}
\StringTok{            description[$col\_name]=$col\_description}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{    if(FILENAME\textasciitilde{}"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data3}\StringTok{\textquotesingle{}")}
\StringTok{      \{}
\StringTok{        if(FNR==1)}
\StringTok{          \{}
\StringTok{            close(p\_file)}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{              \{}
\StringTok{                if($i\textasciitilde{}/\^{}id$/)}
\StringTok{                  \{}
\StringTok{                    col\_id=i}
\StringTok{                  \}}
\StringTok{                if(i\textgreater{}=2)}
\StringTok{                  \{}
\StringTok{                    col\_class\_name[i]=$i}
\StringTok{                  \}}
\StringTok{              \}}
\StringTok{            printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition\_source}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition\_description}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "specific}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "specific\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "level\_5}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "level\_5\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "subclass}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "subclass\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "class}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "class\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "superclass}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "superclass\_pp}\SpecialCharTok{\textbackslash{}n}\StringTok{"  \textgreater{} "results/stat\_classification.tsv"}
\StringTok{          \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{          \{}
\StringTok{            for(i=2; i\textless{}=NF; i++)}
\StringTok{              \{}
\StringTok{                c\_pp[col\_class\_name[i]]=sprintf("\%.4f",$i)}
\StringTok{              \}}
\StringTok{            if(level[$col\_id] != "" \&\& c\_pp[level[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{              \{}
\StringTok{                definition\_source="level\_5"}
\StringTok{                definition=level[$col\_id]}
\StringTok{              \}}
\StringTok{          else if(subclass[$col\_id] != "" \&\& c\_pp[subclass[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{            \{}
\StringTok{              definition\_source="subclass"}
\StringTok{              definition=subclass[$col\_id]}
\StringTok{            \}}
\StringTok{        else if(class[$col\_id] != "" \&\& c\_pp[class[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{          \{}
\StringTok{            definition\_source="class"}
\StringTok{            definition=class[$col\_id]}
\StringTok{          \}}
\StringTok{      else if(superclass[$col\_id] != "" \&\& c\_pp[superclass[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{        \{}
\StringTok{          definition\_source="superclass"}
\StringTok{          definition=superclass[$col\_id]}
\StringTok{        \}}
\StringTok{    else}
\StringTok{      \{}
\StringTok{        definition\_source="null"}
\StringTok{        definition="null"}
\StringTok{        c\_pp[definition]="null"}
\StringTok{        description[definition]="null"}
\StringTok{      \}}
\StringTok{    printf $col\_id"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  definition\_source"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  definition"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[definition]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  description[definition]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  specific[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[specific[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  level[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[level[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  subclass[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[subclass[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  class[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[class[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  superclass[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[superclass[$col\_id]]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/stat\_classification.tsv"}
\StringTok{  \}}
\StringTok{\}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\NormalTok{echo }\StringTok{"classification\_extract\_filter have been successfully written into \textless{}results/stat\_classification.tsv\textgreater{}"}
\NormalTok{fi;}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{fragment\_tree\_network}\ErrorTok{)}
\NormalTok{echo }\StringTok{"Run fragment\_tree\_network."}\NormalTok{;}
\ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{d temp ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f .format ]}
\NormalTok{then}
\NormalTok{  echo }\StringTok{"Project path acknowledged."}
\ControlFlowTok{else}
\NormalTok{  until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{  do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project. Make sure you have moved the fragment tree alignment results to the directory where the project is located. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{  done;}
\NormalTok{  cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{fi;}
\NormalTok{echo }\StringTok{"Please enter the minimum alignment similarity(tlimit) that you want to filter."}
\NormalTok{tlimit}\OtherTok{=}\DecValTok{0}
\NormalTok{until [[ }\StringTok{"$tlimit"} \SpecialCharTok{\textgreater{}} \StringTok{"0.01"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$tlimit"} \SpecialCharTok{\textless{}} \StringTok{"0.99"}\NormalTok{ ]]}
\NormalTok{do}
\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"0.4{-}0.7 is recommended \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ tlimit;}
\NormalTok{done;}
\ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{d temp}\SpecialCharTok{/}\NormalTok{ftaligntemp ]}
\NormalTok{then }
\NormalTok{  mkdir temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}
\NormalTok{fi;}
\NormalTok{data}\OtherTok{=}\StringTok{"ftalign.tsv"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/ftaligntemp/tmp"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  printf "Info: NR = " NR ". FNR = " FNR ".}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{      for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{          if(NR==1 \&\& i!=1 || NR!=1 \&\& i==1)}
\StringTok{            \{}
\StringTok{              n=split($i,x,"[\_]")}
\StringTok{              raw[NR,i]=x[n]}
\StringTok{            \}}
\StringTok{        else}
\StringTok{          \{}
\StringTok{            if(NR==i)}
\StringTok{              \{}
\StringTok{                raw\_norm[NR,i]=$i}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{if(NR\textgreater{}FNR \&\& FNR\textgreater{}=2)}
\StringTok{  \{}
\StringTok{    for(i=2; i\textless{}=NF; i++)}
\StringTok{      \{}
\StringTok{        norm1=$i/raw\_norm[i,i]}
\StringTok{        norm2=$i/raw\_norm[FNR,FNR]}
\StringTok{        norms=sprintf("\%.2f", ((norm1+norm2)/2))}
\StringTok{        if((norms+0 \textgreater{} \textquotesingle{}}\SpecialCharTok{$}\NormalTok{tlimit}\StringTok{\textquotesingle{}+0))}
\StringTok{          \{}
\StringTok{            if(raw[FNR,1]+0\textgreater{}=raw[1,i]+0)}
\StringTok{              \{}
\StringTok{                print raw[FNR,1], raw[1,i], norms \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{              \}}
\StringTok{            if(raw[FNR,1]+0\textless{}raw[1,i]+0)}
\StringTok{              \{}
\StringTok{                print raw[1,i], raw[FNR,1], norms \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data }\SpecialCharTok{$}\NormalTok{data}
\NormalTok{sort }\SpecialCharTok{{-}}\NormalTok{u }\SpecialCharTok{$}\NormalTok{savepath }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{tmp2}
\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/ftaligntemp/filter\_net\_$tlimit"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{      if($1!=$2)}
\StringTok{        \{}
\StringTok{          replink[$1]=$1}
\StringTok{          replink[$2]=$2}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(NR!=FNR)}
\StringTok{    \{}
\StringTok{      if($1!=$2)}
\StringTok{        \{}
\StringTok{          printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" }
\StringTok{        \} }
\StringTok{      if($1==$2)}
\StringTok{        \{}
\StringTok{          if(replink[$1]=="")}
\StringTok{            \{}
\StringTok{              printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{tmp2 temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{tmp2}
\NormalTok{echo }\StringTok{"fragment\_tree\_network have been successfully written into \textless{}temp/ftaligntemp/filter\_net\_$tlimit\textgreater{}"}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{fragment\_tree\_network\_delta}\ErrorTok{)}
\ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{d temp ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f .format ]}
\NormalTok{then}
\NormalTok{  echo }\StringTok{"Project path acknowledged."}
\ControlFlowTok{else}
\NormalTok{  until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{  do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{  done;}
\NormalTok{  cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{fi;}
\NormalTok{echo }\StringTok{"The following module attempts to compute the differential fingerprints of connected clusters based on the molecular fingerprint results of sirius 4."}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{plimit}\OtherTok{=}\DecValTok{0}
\NormalTok{until [[ }\StringTok{"$plimit"} \SpecialCharTok{\textgreater{}} \StringTok{"0.5"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$plimit"} \SpecialCharTok{\textless{}} \StringTok{"0.99"}\NormalTok{ ]]}
\NormalTok{do}
\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"If the minimum alignment similarity is greater than 0.3, this step will automatic calculate the discrepancy fingerprint between alignment features(in beta). Please enter the minimum posterior probability of the molecular fingerprint(plimit\_1) to be filtered. 0.9{-}0.99 is recommended. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ plimit;}
\NormalTok{done;}
\NormalTok{plimit2}\OtherTok{=}\DecValTok{0}
\NormalTok{until [[ }\StringTok{"$plimit2"} \SpecialCharTok{\textgreater{}} \StringTok{"0.1"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$plimit2"} \SpecialCharTok{\textless{}} \StringTok{"$plimit"}\NormalTok{ ]]}
\NormalTok{do}
\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"The minimum posterior probability of the molecular fingerprint(plimit\_2) to be controled. 0.1{-}0.5 may work well. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ plimit2;}
\NormalTok{done;}
\NormalTok{tlimit}\OtherTok{=}\ErrorTok{$}\NormalTok{(ls temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{filter\_net\_}\SpecialCharTok{*} \ErrorTok{|}\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F \_ }\StringTok{\textquotesingle{}\{print $NF\}\textquotesingle{}}\NormalTok{)}
\NormalTok{check\_rep}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}END\{print NR\}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$tlimit"}\NormalTok{))}
\ControlFlowTok{if}\NormalTok{ [[ }\StringTok{"$check\_rep"} \SpecialCharTok{\textgreater{}} \StringTok{"1"}\NormalTok{ ]]}
\NormalTok{then}
\NormalTok{  tlimit}\OtherTok{=}\DecValTok{0}
\NormalTok{  until [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{filter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit ]}
\NormalTok{  do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Plural and different fragment\_tree\_network files were found to exist locally. Please select a tlimit parameter you have utilized to run fragment\_tree\_network\_delta. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ tlimit;}
\NormalTok{  done;}
\NormalTok{fi;}
\ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{refilter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit ]}
\NormalTok{then rm temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{refilter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit}
\NormalTok{fi;}
\ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{fpsample ]}
\NormalTok{then rm temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{fpsample}
\NormalTok{fi;}
\NormalTok{echo }\StringTok{"Running delta\_fingerprint computation..."}
\NormalTok{echo }\StringTok{"Aquiring data from sirius index..."}
\NormalTok{data1}\OtherTok{=}\StringTok{"*\_*/compound.info"}
\NormalTok{data2}\OtherTok{=}\StringTok{"temp/ftaligntemp/filter\_net\_$tlimit"}
\NormalTok{echo }\StringTok{"Run fragment\_tree\_network\_delta."}
\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/ms\_data\_$tlimit"}
\NormalTok{echo }\StringTok{"step 1: ms data"}
\ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{savepath ]}
\NormalTok{then}
\NormalTok{  awk }\SpecialCharTok{{-}}\NormalTok{F }\StringTok{"[}\SpecialCharTok{\textbackslash{}t}\StringTok{]||[:]||[\_]"} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  BEGIN\{  }
\StringTok{  printf "..."}
\StringTok{  printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "m/z}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "rt}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{\}}
\StringTok{\{}
\StringTok{  if(FILENAME\textasciitilde{}/compound.info/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          printf "Info: catch \textgreater{}\textgreater{}\textgreater{} "FILENAME"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{        \}}
\StringTok{      if($1=="name")}
\StringTok{        \{}
\StringTok{          i+=1;}
\StringTok{          id[i]=$NF;}
\StringTok{          n=split($NF,a,"[\_]")}
\StringTok{          printf a[n]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{        \}}
\StringTok{      if($1=="ionMass")}
\StringTok{        \{}
\StringTok{          mz[id[i]]=$NF}
\StringTok{          printf sprintf("\%.4f",$NF)"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{        \}}
\StringTok{      if($1=="ionType")}
\StringTok{        \{}
\StringTok{          type[id[i]]=$NF}
\StringTok{        \}}
\StringTok{      if($1=="rt")}
\StringTok{        \{}
\StringTok{          rt[id[i]]=$2;}
\StringTok{          printf sprintf("\%.2f",$2/60)"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FILENAME\textasciitilde{}/ftaligntemp/)}
\StringTok{    \{}
\StringTok{      \#source  target  ftalign  delta\_mz  delta\_rt  source\_iontype  target\_iontype;}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          printf "" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        \}}
\StringTok{      print $1,$2,$3,sprintf("\%.3f",mz[$2]{-}mz[$1]),sprintf("\%.2f",rt[$2]{-}rt[$1]),type[$1],type[$2]  \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
\NormalTok{fi;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{echo }\StringTok{"step 2: data path"}
\NormalTok{source\_file}\OtherTok{=}\StringTok{"temp/Mo\_filename"}
\NormalTok{data}\OtherTok{=}\StringTok{"temp/ms\_data\_$tlimit"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/datapath\_$tlimit"}
\ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{savepath ]}
\NormalTok{then}
\NormalTok{  awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  \{}
\StringTok{    if(NR==FNR)}
\StringTok{      \{}
\StringTok{        n=split($2, a, "[\_]")}
\StringTok{        file[a[n]]=$2}
\StringTok{        formu\_type[a[n]]=$3}
\StringTok{      \}}
\StringTok{    if(NR!=FNR)}
\StringTok{      \{}
\StringTok{        \#\textless{}path\textgreater{}sourceFormula  \textless{}path\textgreater{}targetFormula}
\StringTok{        path1=file[$1]"/fingerprints/"formu\_type[$1]".fpt"}
\StringTok{        path2=file[$2]"/fingerprints/"formu\_type[$2]".fpt"}
\StringTok{        data[path1]=path1}
\StringTok{        data[path2]=path2}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{END\{}
\StringTok{for(i in data)}
\StringTok{  \{}
\StringTok{    n+=1}
\StringTok{    print "Check file:",n}
\StringTok{    if(getline\textless{}i=={-}1)}
\StringTok{      \{}
\StringTok{        printf "Escape filename: " i "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{      \}}
\StringTok{  else}
\StringTok{    \{}
\StringTok{      printf i" " \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{    \}}
\StringTok{  close(i)}
\StringTok{\}}
\StringTok{print "Sum:",n}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{source\_file }\SpecialCharTok{$}\NormalTok{data}
\NormalTok{fi;}
\NormalTok{datapath}\OtherTok{=}\ErrorTok{$}\NormalTok{(cat temp}\SpecialCharTok{/}\NormalTok{datapath\_}\SpecialCharTok{$}\NormalTok{tlimit)}
\NormalTok{echo }\StringTok{"step 3: fingerprint"}
\NormalTok{data\_allfp}\OtherTok{=}\StringTok{"temp/data\_allfp\_$tlimit"}
\ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{data\_allfp ]}
\NormalTok{then}
\NormalTok{  awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  BEGIN\{}
\StringTok{  n=0}
\StringTok{\}}
\StringTok{\{}
\StringTok{  if(FNR==1)}
\StringTok{    \{}
\StringTok{      if(n\textgreater{}1)}
\StringTok{        \{}
\StringTok{          close(file)}
\StringTok{        \}}
\StringTok{      file=FILENAME;}
\StringTok{      print "Get fingerprints: ",FILENAME}
\StringTok{      n+=1;}
\StringTok{      printf FILENAME"}\SpecialCharTok{\textbackslash{}n}\StringTok{"$0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data\_allfp}\StringTok{\textquotesingle{}"}
\StringTok{    \}}
\StringTok{else}
\StringTok{  \{}
\StringTok{    print $0 \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data\_allfp}\StringTok{\textquotesingle{}"}
\StringTok{  \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{datapath}
\NormalTok{fi;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==1)}
\StringTok{    \{}
\StringTok{      for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{          if($i\textasciitilde{}/absolute/)}
\StringTok{            \{}
\StringTok{              col\_index=i}
\StringTok{            \}}
\StringTok{          if($i\textasciitilde{}/description/)}
\StringTok{            \{}
\StringTok{              col\_description=i}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(NR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{      print $col\_index,$col\_description}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}}\NormalTok{ csi\_fingerid.tsv }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{pos\_fingerprint\_index;}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==1)}
\StringTok{    \{}
\StringTok{      for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{          if($i\textasciitilde{}/absolute/)}
\StringTok{            \{}
\StringTok{              col\_index=i}
\StringTok{            \}}
\StringTok{          if($i\textasciitilde{}/description/)}
\StringTok{            \{}
\StringTok{              col\_description=i}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(NR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{      print $col\_index,$col\_description}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}}\NormalTok{ csi\_fingerid\_neg.tsv }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{neg\_fingerprint\_index;}
\NormalTok{posindex}\OtherTok{=}\StringTok{"temp/ftaligntemp/pos\_fingerprint\_index"}
\NormalTok{negindex}\OtherTok{=}\StringTok{"temp/ftaligntemp/neg\_fingerprint\_index"}
\NormalTok{data}\OtherTok{=}\StringTok{"temp/ms\_data\_$tlimit"}
\NormalTok{echo }\StringTok{"step 4: merge data"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{BEGIN\{}
\StringTok{file=0}
\StringTok{x=0}
\StringTok{count=0}
\StringTok{f=0}
\StringTok{posnum=0}
\StringTok{negnum=0}
\StringTok{\}}
\StringTok{\{}
\StringTok{  if(FNR==1)}
\StringTok{    \{}
\StringTok{      file+=1}
\StringTok{    \}}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{      if(($1\textasciitilde{}/fingerprint/))}
\StringTok{        \{}
\StringTok{          if(x+0\textgreater{}f+0)}
\StringTok{            \{}
\StringTok{              f=x  \# calculate the max index.}
\StringTok{            \}}
\StringTok{          count+=1;  \# calculate the all fingerprints file number.}
\StringTok{          split($1,a,"[/]"); e=split(a[1],b,"[\_]"); id=b[e]; \#catch the id.}
\StringTok{          x=0;}
\StringTok{        \}}
\StringTok{    else}
\StringTok{      \{}
\StringTok{        x+=1;}
\StringTok{        fp[id,x]=$1;}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{if(file==2)}
\StringTok{  \{}
\StringTok{    pos[FNR]=$1}
\StringTok{    posnum+=1}
\StringTok{  \}}
\StringTok{if(file==3)}
\StringTok{  \{}
\StringTok{    neg[FNR]=$1}
\StringTok{    negnum+=1}
\StringTok{  \}}
\StringTok{if(file==4)}
\StringTok{  \{}
\StringTok{    if("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tlimit}\StringTok{\textquotesingle{}"+0 \textgreater{}= 0.3)}
\StringTok{      \{}
\StringTok{        if(fp[$1,1]!="" \&\& fp[$2,1]!="")}
\StringTok{          \{}
\StringTok{            n1=split($6, g, "[]]");}
\StringTok{            n2=split($7, h, "[]]");}
\StringTok{            if(g[n1]=="+" \&\& h[n2]=="+")}
\StringTok{              \{}
\StringTok{                for(x=1; x\textless{}=posnum; x++)}
\StringTok{                  \{}
\StringTok{                    if(fp[$1,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                      \{}
\StringTok{                        data\_s[FNR,x]=pos[x]}
\StringTok{                      \}}
\StringTok{                  else if(fp[$2,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                    \{}
\StringTok{                      data\_t[FNR,x]=pos[x]}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{          if(g[n1]=="{-}" \&\& h[n2]=="{-}")}
\StringTok{            \{}
\StringTok{              for(x=1; x\textless{}=negnum; x++)}
\StringTok{                \{}
\StringTok{                  if(fp[$1,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                    \{}
\StringTok{                      data\_s[FNR,x]=neg[x]}
\StringTok{                    \}}
\StringTok{                else if(fp[$2,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                  \{}
\StringTok{                    data\_t[FNR,x]=neg[x]}
\StringTok{                  \}}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{        if(g[n1]=="{-}" \&\& h[n2]=="+" || h[n2]=="{-}" \&\& g[n1]=="+")}
\StringTok{          \{}
\StringTok{            for(i=1; i\textless{}=posnum; i++)}
\StringTok{              \{}
\StringTok{                for(j=1; j\textless{}=negnum; j++)}
\StringTok{                  \{}
\StringTok{                    if(pos[i]==neg[j])}
\StringTok{                      \{}
\StringTok{                        mirror[i]=j  \#if pos=i, the identical index of neg is mirror[i]}
\StringTok{                      \}}
\StringTok{                  \}}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{        if(g[n1]=="{-}" \&\& h[n2]=="+") }
\StringTok{          \{}
\StringTok{            for(x=1; x\textless{}=f; x++)}
\StringTok{              \{}
\StringTok{                if(fp[$1,mirror[x]]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                  \{}
\StringTok{                    data\_s[FNR,x]=neg[mirror[x]]}
\StringTok{                  \}}
\StringTok{              else if(fp[$2,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,mirror[x]]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                \{}
\StringTok{                  data\_t[FNR,x]=neg[mirror[x]]}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      if(h[n2]=="{-}" \&\& g[n1]=="+")}
\StringTok{        \{}
\StringTok{          for(x=1; x\textless{}=f; x++)}
\StringTok{            \{}
\StringTok{              if(fp[$1,x]+0\textgreater{}= \textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,mirror[x]]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                \{}
\StringTok{                  data\_s[FNR,x]=neg[mirror[x]]}
\StringTok{                \}}
\StringTok{            else if(fp[$2,mirror[x]]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{              \{}
\StringTok{                data\_t[FNR,x]=neg[mirror[x]]}
\StringTok{              \}}
\StringTok{          \}   }
\StringTok{      \}}
\StringTok{  \}}
\StringTok{\}}
\StringTok{if(FNR==1)}
\StringTok{  \{}
\StringTok{    printf "source}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "target}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "ftalign\_similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "delta\_m/z}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "source\_fp\_uniq}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "target\_fp\_uniq}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{  \}}
\StringTok{else}
\StringTok{  \{}
\StringTok{    printf $1"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $2"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $3"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $4"}\SpecialCharTok{\textbackslash{}t}\StringTok{";}
\StringTok{    if(\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tlimit}\StringTok{\textquotesingle{}+0 \textgreater{}= 0.3)}
\StringTok{      \{}
\StringTok{        if(fp[$1,1]=="" || fp[$2,1]=="")}
\StringTok{          \{}
\StringTok{            printf "NA@NA}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{          \}}
\StringTok{      else}
\StringTok{        \{}
\StringTok{          printf "source:"  \#the source fingerprint uniq.}
\StringTok{          for(x=1; x\textless{}=f; x++)}
\StringTok{            \{}
\StringTok{              if(data\_s[FNR,x]!="")}
\StringTok{                \{}
\StringTok{                  printf data\_s[FNR,x]","}
\StringTok{                \}}
\StringTok{            \};}
\StringTok{          printf "@target:"  \#the target fingerprint uniq.}
\StringTok{          for(x=1; x\textless{}=f; x++)}
\StringTok{            \{}
\StringTok{              if(data\_t[FNR,x]!="")}
\StringTok{                \{}
\StringTok{                  printf data\_t[FNR,x]","}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{          printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{else}
\StringTok{  \{}
\StringTok{    printf "NA@NA}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{  \}}
\StringTok{\}}
\StringTok{\}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data\_allfp }\SpecialCharTok{$}\NormalTok{posindex }\SpecialCharTok{$}\NormalTok{negindex }\SpecialCharTok{$}\NormalTok{data }\SpecialCharTok{|}\NormalTok{ sed }\SpecialCharTok{{-}}\NormalTok{e }\StringTok{\textquotesingle{}s/,@/}\SpecialCharTok{\textbackslash{}t}\StringTok{/g; s/,$//g; s/@/}\SpecialCharTok{\textbackslash{}t}\StringTok{/g\textquotesingle{}}  \SpecialCharTok{\textgreater{}}\NormalTok{ results}\SpecialCharTok{/}\NormalTok{source\_target\_tree\_}\SpecialCharTok{$}\NormalTok{tlimit.tsv;}
\NormalTok{echo }\StringTok{"All instances have written into \textless{}results/source\_target\_tree\_$tlimit.tsv\textgreater{}."}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{echo }\StringTok{"step 5: separate child{-}nebula from parent{-}nebula."}
\NormalTok{data}\OtherTok{=}\StringTok{"results/stat\_classification.tsv"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/filter\_0\_class.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(FNR==1)}
\StringTok{    \{}
\StringTok{      for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{          if($i\textasciitilde{}/\^{}definition$/)}
\StringTok{            \{}
\StringTok{              col\_class=i}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FNR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{      class[$col\_class]=$col\_class}
\StringTok{    \}}
\StringTok{\}}
\StringTok{END\{}
\StringTok{for(i in class)}
\StringTok{  \{}
\StringTok{    printf class[i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{  \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{data1}\OtherTok{=}\StringTok{"temp/filter\_0\_class.tsv"} 
\NormalTok{data2}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\NormalTok{data3}\OtherTok{=}\StringTok{"results/fingerid\_first\_score.tsv"}
\NormalTok{until [[ }\StringTok{"$similarity\_limit"} \SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$similarity\_limit"} \SpecialCharTok{\textless{}} \DecValTok{1}\NormalTok{ ]]}
\NormalTok{do}
\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please set the Tanimoto similarity threshold contribute to child{-}nebula. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ similarity\_limit;}
\NormalTok{done;}
\NormalTok{until [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textgreater{}} \FloatTok{0.01}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textless{}} \DecValTok{1}\NormalTok{ ]]}
\NormalTok{do}
\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the classes posterior probabilities limition. 0.5\textasciitilde{}0.99 may work well. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ definition\_limit;}
\NormalTok{done;}
\NormalTok{class\_pp\_limit}\OtherTok{=}\ErrorTok{$}\NormalTok{definition\_limit}
\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/idenfication\_filter\_$class\_pp\_limit.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{      filter\_class[$1]=$1}
\StringTok{    \}}
\StringTok{  if(FILENAME\textasciitilde{}/canopus/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          col\_id=1}
\StringTok{          for(i=2; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              for(j in filter\_class)}
\StringTok{                \{}
\StringTok{                  if(j==$i)}
\StringTok{                    \{}
\StringTok{                      col\_class[j]=i}
\StringTok{                      print i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          for(i in col\_class)}
\StringTok{            \{}
\StringTok{              if(sprintf("\%.3f",$col\_class[i])+0\textgreater{}="\textquotesingle{}}\SpecialCharTok{$}\NormalTok{class\_pp\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{                \{}
\StringTok{                  class\_set[i,$col\_id]=i}
\StringTok{                  print "ID: ",$1,i,$col\_class[i]}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FILENAME\textasciitilde{}/fingerid\_first\_score/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if($i\textasciitilde{}/\^{}id/)}
\StringTok{                \{}
\StringTok{                  col\_id=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/similarity/)}
\StringTok{                \{}
\StringTok{                  col\_similarity=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{          printf "class\_nebula\_facet}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          if($col\_similarity+0 \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{similarity\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{            \{}
\StringTok{              for(i in class\_set)}
\StringTok{                \{}
\StringTok{                  if(i\textasciitilde{}"}\SpecialCharTok{\textbackslash{}034}\StringTok{"$col\_id"$")}
\StringTok{                    \{}
\StringTok{                      printf class\_set[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{data}\OtherTok{=}\StringTok{"temp/idenfication\_filter\_$class\_pp\_limit.tsv"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/idenfication\_filter2\_$\{class\_pp\_limit\}.tsv"}
\NormalTok{until [[ }\StringTok{"$num\_limit\_1"} \SpecialCharTok{{-}}\NormalTok{gt }\DecValTok{0}\NormalTok{ ]]}
\NormalTok{do}
\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the features number threshold contribute to child{-}nebula (min number). \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ num\_limit\_1;}
\NormalTok{done;}
\NormalTok{until [[ }\StringTok{"$num\_limit\_2"} \SpecialCharTok{{-}}\NormalTok{gt }\StringTok{"$num\_limit\_1"}\NormalTok{ ]]}
\NormalTok{do}
\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the features number threshold contribute to child{-}nebula (max number). \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ num\_limit\_2;}
\NormalTok{done;}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(FNR==1)}
\StringTok{    \{}
\StringTok{      printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{      for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{          if($i\textasciitilde{}/class\_nebula\_facet/)}
\StringTok{            \{}
\StringTok{              col\_class=i}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FNR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{      num[$col\_class]+=1}
\StringTok{      data[FNR]=$0}
\StringTok{      class[FNR]=$col\_class}
\StringTok{    \}}
\StringTok{\}}
\StringTok{END\{}
\StringTok{for(i in num)}
\StringTok{  \{}
\StringTok{    if(num[i]+0 \textgreater{}= \textquotesingle{}}\SpecialCharTok{$}\NormalTok{num\_limit\_1}\StringTok{\textquotesingle{}+0 \&\& num[i]+0 \textless{}= \textquotesingle{}}\SpecialCharTok{$}\NormalTok{num\_limit\_2}\StringTok{\textquotesingle{})}
\StringTok{      \{}
\StringTok{        printf "The nodes number of the child{-}nebula is " num[i] ".}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{        for(j in class)}
\StringTok{          \{}
\StringTok{            if(class[j]==i)}
\StringTok{              \{}
\StringTok{                printf data[j]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{mkdir results}\SpecialCharTok{/}\NormalTok{network\_facet\_}\SpecialCharTok{$}\NormalTok{class\_pp\_limit}
\NormalTok{data1}\OtherTok{=}\StringTok{"temp/idenfication\_filter2\_$\{class\_pp\_limit\}.tsv"}
\NormalTok{data2}\OtherTok{=}\StringTok{"results/source\_target\_tree\_$tlimit.tsv"} \CommentTok{\# "results/source\_target\_tree\_0.4.tsv"}
\NormalTok{save\_class}\OtherTok{=}\StringTok{"results/filter\_child\_class.tsv"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"results/network\_facet\_$class\_pp\_limit/"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if($i\textasciitilde{}/class\_nebula\_facet/)}
\StringTok{                \{}
\StringTok{                  col\_class=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/\^{}id$/)}
\StringTok{                \{}
\StringTok{                  col\_id=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          class[$col\_class]=$col\_class}
\StringTok{          class\_id[$col\_class,$col\_id]=$col\_id}
\StringTok{          stat\_id[$col\_class,$col\_id]=$col\_id}
\StringTok{          belong[$col\_class,$col\_id]=$col\_class}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(NR\textgreater{}FNR)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          for(i in class)}
\StringTok{            \{}
\StringTok{              printf i"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{save\_class}\StringTok{\textquotesingle{}"}
\StringTok{              printf $0"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "facet}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" i ".tsv"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          for(i in class)}
\StringTok{            \{}
\StringTok{              if( class\_id[i,$1]==$1 \&\& class\_id[i,$2]==$2 )}
\StringTok{                \{}
\StringTok{                  printf $0"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  i"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" i ".tsv"}
\StringTok{                  delete stat\_id[i,$1]}
\StringTok{                  delete stat\_id[i,$2]}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{\}}
\StringTok{END\{}
\StringTok{for(i in stat\_id)}
\StringTok{  \{}
\StringTok{    \#\# source target similarity delta\_mz fp fp class}
\StringTok{    printf stat\_id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" stat\_id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "1}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "0}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "null}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "null}\SpecialCharTok{\textbackslash{}t}\StringTok{"  belong[i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{"  \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" belong[i] ".tsv"}
\StringTok{  \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{data1}\OtherTok{=}\StringTok{"canopus.tsv"}
\NormalTok{data2}\OtherTok{=}\StringTok{"results/filter\_child\_class.tsv"}
\NormalTok{data3}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"results/canopus\_pp\_filter.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(FILENAME\textasciitilde{}/canopus.tsv/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if($i\textasciitilde{}/absolute/)}
\StringTok{                \{}
\StringTok{                  col\_index=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/\^{}id/)}
\StringTok{                \{}
\StringTok{                  col\_chemid=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/name/)}
\StringTok{                \{}
\StringTok{                  col\_name=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/description/)}
\StringTok{                \{}
\StringTok{                  col\_des=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}2)}
\StringTok{        \{}
\StringTok{          ab\_index[$col\_name]=$col\_index}
\StringTok{          chemid[$col\_name]=$col\_chemid}
\StringTok{          des[$col\_name]=$col\_des}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FILENAME\textasciitilde{}/filter\_child\_class/)}
\StringTok{    \{}
\StringTok{      class[$1]=$1}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          printf "index}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "chem\_id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "description}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/child\_class.tsv"}
\StringTok{        \}}
\StringTok{      printf ab\_index[$1]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  chemid[$1]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $1"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  des[$1]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/child\_class.tsv"}
\StringTok{    \}}
\StringTok{  if(FILENAME\textasciitilde{}/canopus\_pp/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          printf $1 \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{          for(i=2; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if(class[$i]!="")}
\StringTok{                \{}
\StringTok{                  n+=1}
\StringTok{                  printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{C"ab\_index[$i] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                  col\_set[n]=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{          printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          printf $1 \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{          for(i=1; i\textless{}=n; i++)}
\StringTok{            \{}
\StringTok{              printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"$col\_set[i] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{          printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{structure\_candidate\_top10}\ErrorTok{)}
\NormalTok{echo }\StringTok{"structure\_candidate\_top10 (awk version ≥ 3.1)."}
\NormalTok{projectpath}\OtherTok{=}\DecValTok{0}
\NormalTok{until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{do}
\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{done;}
\NormalTok{cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f results ]}
\NormalTok{then echo }\StringTok{"Expand into target dir \textless{}results\textgreater{}"}
\ControlFlowTok{else}\NormalTok{ mkdir results}
\NormalTok{  mkdir temp}
\NormalTok{  mkdir temp}\SpecialCharTok{/}\NormalTok{fintemp;}
\NormalTok{fi;}
\DocumentationTok{\#\# gather all structure candidate}
\NormalTok{data}\OtherTok{=}\StringTok{"*\_*/fingerid/*.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{BEGIN\{}
\StringTok{all\_id=0}
\StringTok{max\_id={-}1}
\StringTok{p\_id="null"}
\StringTok{printf "Info: loading the data..."}
\StringTok{\}}
\StringTok{\{}
\StringTok{  if(FNR==1)}
\StringTok{    \{}
\StringTok{      if(NR\textgreater{}FNR)}
\StringTok{        \{}
\StringTok{          close(pfile)}
\StringTok{        \}}
\StringTok{      f=split(FILENAME,a,"[/]");}
\StringTok{      n=split(a[1],b,"[\_]");}
\StringTok{      id=b[n];}
\StringTok{      if(id!=p\_id)}
\StringTok{        \{}
\StringTok{          all\_id+=1}
\StringTok{          if(id\textgreater{}max\_id)}
\StringTok{            \{}
\StringTok{              max\_id=id}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      file[id]=a[1]}
\StringTok{      split(a[f], g, "[.]")}
\StringTok{      formu\_type[id]=g[1]}
\StringTok{      if(all\_id==1)}
\StringTok{        \{}
\StringTok{          printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "formula}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "smiles}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchi}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchikey2D}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "score}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "xlogp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "links}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/fingerid\_candidate\_all.tsv"}
\StringTok{          targetfile="results/fingerid\_candidate\_all.tsv"}
\StringTok{          for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if(($i\textasciitilde{}/inchikey2D/))}
\StringTok{                \{}
\StringTok{                  col\_2D=i}
\StringTok{                \}}
\StringTok{              if($i=="inchi")}
\StringTok{                \{}
\StringTok{                  col\_inchi=i}
\StringTok{                \}}
\StringTok{              if(($i\textasciitilde{}/Formula/))}
\StringTok{                \{}
\StringTok{                  col\_formu=i}
\StringTok{                \}}
\StringTok{              if($i=="score")}
\StringTok{                \{}
\StringTok{                  col\_score=i}
\StringTok{                \}}
\StringTok{              if($i=="name")}
\StringTok{                \{}
\StringTok{                  col\_name=i}
\StringTok{                \}}
\StringTok{              if($i=="smiles")}
\StringTok{                \{}
\StringTok{                  col\_smiles=i}
\StringTok{                \}}
\StringTok{              if($i=="xlogp")}
\StringTok{                \{}
\StringTok{                  col\_x=i}
\StringTok{                \}}
\StringTok{              if(($i\textasciitilde{}/imilarity/))}
\StringTok{                \{}
\StringTok{                  col\_simi=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/links/)}
\StringTok{                \{}
\StringTok{                  col\_links=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      pfile=FILENAME}
\StringTok{      printf g[1]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"formu\_type[id]"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{      printf "Info: the data of " id " (ID) has input. The filename is " FILENAME ".}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{    \}}
\StringTok{  if(FNR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{    \#\#  "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "formula}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "smiles}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchi}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchikey2D}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "score}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "xlogp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "links}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} targetfile}
\StringTok{    printf id"}\SpecialCharTok{\textbackslash{}t}\StringTok{" $col\_name"}\SpecialCharTok{\textbackslash{}t}\StringTok{" $col\_formu"}\SpecialCharTok{\textbackslash{}t}\StringTok{" $col\_simi"}\SpecialCharTok{\textbackslash{}t}\StringTok{" $col\_smiles"}\SpecialCharTok{\textbackslash{}t}\StringTok{" $col\_inchi"}\SpecialCharTok{\textbackslash{}t}\StringTok{" $col\_2D"}\SpecialCharTok{\textbackslash{}t}\StringTok{" $col\_score"}\SpecialCharTok{\textbackslash{}t}\StringTok{" $col\_x"}\SpecialCharTok{\textbackslash{}t}\StringTok{" $col\_links"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} targetfile}
\StringTok{    \}}
\StringTok{\} \textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\DocumentationTok{\#\# sort the candidates to get top 10}
\NormalTok{data}\OtherTok{=}\StringTok{"results/fingerid\_candidate\_all.tsv"}
\NormalTok{version}\OtherTok{=}\DecValTok{0}
\NormalTok{version}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}BEGIN\{a[1]=1; asort(a, b); print b[1]\}\textquotesingle{}}\NormalTok{)}
\ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{$}\NormalTok{version }\SpecialCharTok{!=} \DecValTok{1}\NormalTok{ ]}
\NormalTok{then}
\NormalTok{  echo }\StringTok{"Awk version ≤ 3.1. Function \textless{}asort\textgreater{} not available."}
\NormalTok{fi}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(FNR==1)}
\StringTok{    \{}
\StringTok{      printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "formula}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "smiles}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchi}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchikey2D}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "score}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "xlogp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "links}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/fingerid\_candidate\_top10.tsv"}
\StringTok{      targetfile="results/fingerid\_candidate\_top10.tsv"}
\StringTok{      for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{          if($i\textasciitilde{}/\^{}id$/)}
\StringTok{            \{}
\StringTok{              col\_id=i}
\StringTok{            \}}
\StringTok{          if($i\textasciitilde{}/\^{}score/)}
\StringTok{            \{}
\StringTok{              col\_score=i}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FNR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{      if(id!=$col\_id)}
\StringTok{        \{}
\StringTok{          \#\# output data top10}
\StringTok{          if(id!="")}
\StringTok{            \{}
\StringTok{              j=asort(score, a)}
\StringTok{              for(i=j; i\textgreater{}=(j{-}9); i{-}{-})}
\StringTok{                \{}
\StringTok{                  if(i==0)}
\StringTok{                    \{}
\StringTok{                      break}
\StringTok{                    \}}
\StringTok{                  if(data[a[i]]=="")}
\StringTok{                    \{}
\StringTok{                      print "yes"}
\StringTok{                    \}}
\StringTok{                  printf data[a[i]]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} targetfile}
\StringTok{                \}}
\StringTok{              delete data}
\StringTok{              delete score}
\StringTok{            \}}
\StringTok{          \#\# gather first row of the id}
\StringTok{          n=1}
\StringTok{          score[n]=$col\_score}
\StringTok{          if(data[$col\_score]!="")}
\StringTok{            \{}
\StringTok{              $col\_score+=0.00000001}
\StringTok{            \}}
\StringTok{          data[$col\_score]=$0}
\StringTok{        \}}
\StringTok{    else}
\StringTok{        \{}
\StringTok{          n+=1}
\StringTok{          score[n]=$col\_score}
\StringTok{          if(data[$col\_score]!="")}
\StringTok{            \{}
\StringTok{              $col\_score+=0.00000001}
\StringTok{            \}}
\StringTok{          data[$col\_score]=$0}
\StringTok{        \}}
\StringTok{      id=$col\_id}
\StringTok{    \}}
\StringTok{\}}
\StringTok{END\{}
\StringTok{\{}
\StringTok{  j=asort(score, a)}
\StringTok{  for(i=j; i\textgreater{}=j{-}9; i{-}{-})}
\StringTok{    \{}
\StringTok{      if(i==0)}
\StringTok{        \{}
\StringTok{          break}
\StringTok{        \}}
\StringTok{      printf data[a[i]]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} targetfile}
\StringTok{    \}}
\StringTok{\}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\NormalTok{exit}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\StringTok{"(beta)"}\ErrorTok{)}
\NormalTok{exit;}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{exit}\ErrorTok{)}
\NormalTok{echo }\StringTok{"The mystery of creation is like the darkness of night{-}{-}it is great.}
\StringTok{Delusions of knowledge are like the fog of the morning."}
\NormalTok{exit;}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{*}\ErrorTok{)}
\NormalTok{echo }\StringTok{"error"}
\NormalTok{exit;}
\NormalTok{;;}
\NormalTok{esac;}
\NormalTok{done;}\CommentTok{\#(for)}
\NormalTok{done;}\CommentTok{\#(select)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-mcnebula1023.sh}{%
\section{File: mcnebula1023.sh}\label{file-mcnebula1023.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{echo }\StringTok{"We are all in the gutter, }
\StringTok{but some of us are looking at the stars."}\NormalTok{;}

\NormalTok{PS3}\OtherTok{=}\StringTok{\textquotesingle{}Please select the workflow to be executed. \textgreater{}\textgreater{}\textgreater{} \textquotesingle{}}

\NormalTok{select command }\ControlFlowTok{in}\NormalTok{ \textbackslash{}}
\NormalTok{    \textbackslash{}}
    \StringTok{"default"}\NormalTok{ \textbackslash{}}
\NormalTok{    \textbackslash{}}
    \StringTok{"structure\_extract"}\NormalTok{ \textbackslash{}}
\NormalTok{    \textbackslash{}}
    \StringTok{"classification\_extract\_sum"}\NormalTok{ \textbackslash{}}
\NormalTok{    \textbackslash{}}
    \StringTok{"classification\_extract\_filter"}\NormalTok{ \textbackslash{}}
\NormalTok{    \textbackslash{}}
    \StringTok{"fragment\_tree\_network"}\NormalTok{ \textbackslash{}}
\NormalTok{    \textbackslash{}}
    \StringTok{"fragment\_tree\_network\_delta"}\NormalTok{ \textbackslash{}}
\NormalTok{    \textbackslash{}}
    \StringTok{"compound\_idenfication"}\NormalTok{ \textbackslash{}}
\NormalTok{    \textbackslash{}}
    \StringTok{"double\_ion\_network"}\NormalTok{ \textbackslash{}}
\NormalTok{    \textbackslash{}}
    \StringTok{"exit"} 
\NormalTok{do}
    
    \ControlFlowTok{if}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{command }\SpecialCharTok{==} \StringTok{"default"}\NormalTok{ ]]}
\NormalTok{    then}
    
\NormalTok{    confirm}\OtherTok{=}\DecValTok{0}
    
\NormalTok{        until [[ }\SpecialCharTok{$}\NormalTok{confirm }\SpecialCharTok{==} \StringTok{"yes"}\NormalTok{ ]] }\SpecialCharTok{||}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{confirm }\SpecialCharTok{==} \StringTok{"no"}\NormalTok{ ]]}
\NormalTok{        do}
\NormalTok{        read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Running all proccesses sequentially? [yes/no] \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ confirm}
\NormalTok{        done;}
        \ControlFlowTok{if}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{confirm }\SpecialCharTok{==} \StringTok{"no"}\NormalTok{ ]]}
\NormalTok{        then exit}
\NormalTok{        fi;}
        
\NormalTok{    default}\OtherTok{=}\StringTok{"structure\_extract classification\_extract\_sum classification\_extract\_filter fragment\_tree\_network fragment\_tree\_network\_delta"}
    
\NormalTok{    list}\OtherTok{=}\ErrorTok{$}\NormalTok{(echo }\SpecialCharTok{$}\NormalTok{default);}
    
    \ControlFlowTok{else}\NormalTok{ list}\OtherTok{=}\ErrorTok{$}\NormalTok{( echo }\SpecialCharTok{$}\NormalTok{command)}
\NormalTok{    fi;}
    
    \ControlFlowTok{for}\NormalTok{ option }\ControlFlowTok{in} \SpecialCharTok{$}\NormalTok{(echo }\SpecialCharTok{$}\NormalTok{list)}
\NormalTok{    do}
\NormalTok{        case }\SpecialCharTok{$}\NormalTok{option }\ControlFlowTok{in}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{structure\_extract}\ErrorTok{)}
\NormalTok{echo }\StringTok{"Run structure\_extract."}
\NormalTok{projectpath}\OtherTok{=}\DecValTok{0}
\NormalTok{    until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{canopus\_summary.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{    do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{    done;}
    
\NormalTok{cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{mkdir results;}
\NormalTok{mkdir temp;}
\NormalTok{mkdir temp}\SpecialCharTok{/}\NormalTok{fintemp;}

    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{Mo\_filename ]}
\NormalTok{    then rm temp}\SpecialCharTok{/}\NormalTok{Mo\_filename}
\NormalTok{    fi;}

\NormalTok{data}\OtherTok{=}\StringTok{"*\_*/fingerid/*.tsv"}

\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    BEGIN\{}
\StringTok{        all\_id=0}
\StringTok{        \textbackslash{}}
\StringTok{        max\_id={-}1}
\StringTok{        \textbackslash{}}
\StringTok{        p\_id="null"}
\StringTok{        \textbackslash{}}
\StringTok{        printf "Info: loading the data..."}
\StringTok{        \}}
\StringTok{    \{}
\StringTok{    if(FNR==1)}
\StringTok{        \{}
\StringTok{        if(NR\textgreater{}FNR)}
\StringTok{            \{}
\StringTok{            close(pfile)}
\StringTok{            \}}
\StringTok{        f=split(FILENAME,a,"[/]");}
\StringTok{    }
\StringTok{        n=split(a[1],b,"[\_]");}
\StringTok{    }
\StringTok{        id=b[n];}
\StringTok{    }
\StringTok{        if(id!=p\_id)}
\StringTok{            \{}
\StringTok{            all\_id+=1}
\StringTok{            \textbackslash{}}
\StringTok{            if(id\textgreater{}max\_id)}
\StringTok{                \{}
\StringTok{                max\_id=id}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        file[id]=a[1]}
\StringTok{        }
\StringTok{        split(a[f], g, "[.]")}
\StringTok{        }
\StringTok{        formu\_type[id]=g[1]}
\StringTok{        }
\StringTok{        if(all\_id==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if(($i\textasciitilde{}/inchikey2D/))}
\StringTok{                    \{}
\StringTok{                    col\_2D=i}
\StringTok{                    \}}
\StringTok{                if($i=="inchi")}
\StringTok{                    \{}
\StringTok{                    col\_inchi=i}
\StringTok{                    \}}
\StringTok{                if(($i\textasciitilde{}/Formula/))}
\StringTok{                    \{}
\StringTok{                    col\_formu=i}
\StringTok{                    \}}
\StringTok{                if($i=="score")}
\StringTok{                    \{}
\StringTok{                    col\_score=i}
\StringTok{                    \}}
\StringTok{                if($i=="name")}
\StringTok{                    \{}
\StringTok{                    col\_name=i}
\StringTok{                    \}}
\StringTok{                if($i=="smiles")}
\StringTok{                    \{}
\StringTok{                    col\_smiles=i}
\StringTok{                    \}}
\StringTok{                if($i=="xlogp")}
\StringTok{                    \{}
\StringTok{                    col\_x=i}
\StringTok{                    \}}
\StringTok{                if(($i\textasciitilde{}/imilarity/))}
\StringTok{                    \{}
\StringTok{                    col\_simi=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/links/)}
\StringTok{                    \{}
\StringTok{                    col\_links=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        pfile=FILENAME}
\StringTok{        }
\StringTok{        printf g[1]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"formu\_type[id]"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{        }
\StringTok{        printf "Info: the data of " id " (ID) has input. The filename is " FILENAME ".}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{        \}}
\StringTok{    if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        row\_score=$col\_score}
\StringTok{        }
\StringTok{        row\_simi=$col\_simi}
\StringTok{        }
\StringTok{        if(max["score",id]=="" || max["score",id]+0\textless{}row\_score+0)}
\StringTok{            \{}
\StringTok{            max["score",id]=row\_score}
\StringTok{            }
\StringTok{            name["score",id]=$col\_name}
\StringTok{        }
\StringTok{            formula["score",id]=$col\_formu}
\StringTok{            }
\StringTok{            simi["score",id]=$col\_simi}
\StringTok{        }
\StringTok{            smiles["score",id]=$col\_smiles}
\StringTok{        }
\StringTok{            inchi["score",id]=$col\_inchi}
\StringTok{        }
\StringTok{            in2D["score",id]=$col\_2D}
\StringTok{            }
\StringTok{            score["score",id]=$col\_score}
\StringTok{        }
\StringTok{            xlogp["score",id]=$col\_x}
\StringTok{            }
\StringTok{            links["score",id]=$col\_links}
\StringTok{            \}}
\StringTok{        if(max["simi",id]=="" || max["simi",id]+0\textless{}row\_simi+0)}
\StringTok{            \{}
\StringTok{            max["simi",id]=row\_simi}
\StringTok{            }
\StringTok{            name["simi",id]=$col\_name}
\StringTok{        }
\StringTok{            formula["simi",id]=$col\_formu}
\StringTok{            }
\StringTok{            simi["simi",id]=$col\_simi}
\StringTok{        }
\StringTok{            smiles["simi",id]=$col\_smiles}
\StringTok{        }
\StringTok{            inchi["simi",id]=$col\_inchi}

\StringTok{            in2D["simi",id]=$col\_2D}
\StringTok{            }
\StringTok{            score["simi",id]=$col\_score}
\StringTok{         }
\StringTok{            xlogp["simi",id]=$col\_x}
\StringTok{            }
\StringTok{            links["simi",id]=$col\_links}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "formula}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "smiles}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchi}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchikey2D}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        "score}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "xlogp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "links}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/fingerid\_sum.tsv"}
\StringTok{        \textbackslash{}}
\StringTok{        printf "" \textgreater{} "temp/Mo\_filename"}
\StringTok{        }
\StringTok{        for(l in file)}
\StringTok{            \{}
\StringTok{            if(max["score",l]!="")}
\StringTok{                \{}
\StringTok{                printf l"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                name["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  formula["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  simi["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                smiles["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  inchi["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  in2D["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                score["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  xlogp["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  links["score",l]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/fingerid\_sum.tsv"}
\StringTok{                }
\StringTok{                printf formula["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  file[l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  formu\_type[l]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "temp/Mo\_filename"}
\StringTok{                \}}
\StringTok{            if(max["simi",l]!="" \&\& max["simi",l]!=max["score",l])}
\StringTok{                \{}
\StringTok{                printf l"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                name["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  formula["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  simi["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                smiles["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  inchi["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  in2D["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                score["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  xlogp["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  links["simi",l]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/fingerid\_sum.tsv"}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}

\NormalTok{data\_sum}\OtherTok{=}\StringTok{"results/fingerid\_sum.tsv"}

\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==1)}
\StringTok{        \{}
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if($i\textasciitilde{}/id/)}
\StringTok{                \{}
\StringTok{                col\_id=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/score/)}
\StringTok{                \{}
\StringTok{                col\_score=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        id=$col\_id}
\StringTok{        \textbackslash{}}
\StringTok{        if(max\_id+0\textless{}id || max\_id=="")}
\StringTok{            \{}
\StringTok{            max\_id=id}
\StringTok{            \}}
\StringTok{        if(score[id]+0\textless{}$col\_score+0 || score[id]=="")}
\StringTok{            \{}
\StringTok{            score[id]=$col\_score}
\StringTok{            \textbackslash{}}
\StringTok{            data[id]=$0}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "formula}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "smiles}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchi}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchikey2D}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        "score}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "xlogp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "links}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/fingerid\_first\_score.tsv"}
\StringTok{        \textbackslash{}}
\StringTok{        for(i=1; i\textless{}=max\_id; i++)}
\StringTok{            \{}
\StringTok{            if(data[i]!="")}
\StringTok{                \{}
\StringTok{                printf data[i] "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/fingerid\_first\_score.tsv"}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data\_sum}

\NormalTok{echo }\StringTok{"structure\_extract results have been successfully assembled into \textless{}results/fingerid\_sum.tsv\textgreater{} and \textless{}results/fingerid\_first\_score.tsv\textgreater{}"}\NormalTok{;}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{classification\_extract\_sum}\ErrorTok{)}

\NormalTok{echo }\StringTok{"Run classification\_extract\_sum."}\NormalTok{;}
    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{Mo\_filename ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f canopus.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f canopus\_neg.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f .format ]}
\NormalTok{    then}
\NormalTok{    echo }\StringTok{"Project path acknowledged."}
    \ControlFlowTok{else}
\NormalTok{        until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{canopus.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{        do}
\NormalTok{        read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{        done;}
\NormalTok{        cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{    fi;}
    
\NormalTok{data1}\OtherTok{=}\StringTok{"temp/Mo\_filename"}

\NormalTok{data2}\OtherTok{=}\StringTok{"canopus.tsv"}

\NormalTok{data3}\OtherTok{=}\StringTok{"canopus\_neg.tsv"}

\NormalTok{datas}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(getline \textless{} $2"/canopus/"$3".fpt"=={-}1)}
\StringTok{        \{}
\StringTok{        printf ""}
\StringTok{        \}}
\StringTok{    else}
\StringTok{        \{}
\StringTok{        printf $2"/canopus/"$3".fpt "}
\StringTok{        \}}
\StringTok{    close($2"/canopus/"$3".fpt")}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1)}
    
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        file[FNR]=$2}
\StringTok{        }
\StringTok{        mo[$2]=$1}
\StringTok{        }
\StringTok{        i=split($2,s,"[\_]")}
\StringTok{        }
\StringTok{        the\_id[FNR]=s[i]}
\StringTok{        }
\StringTok{        n=FNR}
\StringTok{        \}}
\StringTok{    if((FILENAME \textasciitilde{} /\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data2}\StringTok{\textquotesingle{}/))}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            close("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data1}\StringTok{\textquotesingle{}")}
\StringTok{            }
\StringTok{            printf "Info: data\_file name of \textquotesingle{}}\SpecialCharTok{$}\NormalTok{data1}\StringTok{\textquotesingle{} has been input.}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{            }
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if(($i \textasciitilde{} /name/))}
\StringTok{                    \{}
\StringTok{                    col\_class=i}
\StringTok{                    \}}
\StringTok{                if(($i \textasciitilde{} /absolute/))}
\StringTok{                    \{}
\StringTok{                    col\_abindex=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            abindex[1,FNR]=$col\_abindex}
\StringTok{            }
\StringTok{            class[1,$col\_abindex]=$col\_class}
\StringTok{            }
\StringTok{            rows\_data2=FNR}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if((FILENAME \textasciitilde{} /\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data3}\StringTok{\textquotesingle{}/))}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            close("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data2}\StringTok{\textquotesingle{}")}
\StringTok{            }
\StringTok{            printf "Info: data\_file name of \textquotesingle{}}\SpecialCharTok{$}\NormalTok{data2}\StringTok{\textquotesingle{} has been input.}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{            }
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if(($i \textasciitilde{} /name/))}
\StringTok{                    \{}
\StringTok{                    col\_class=i}
\StringTok{                    \}}
\StringTok{                if(($i \textasciitilde{} /absolute/))}
\StringTok{                    \{}
\StringTok{                    col\_abindex=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            abindex[2,FNR]=$col\_abindex}
\StringTok{            }
\StringTok{            class[2,$col\_abindex]=$col\_class}
\StringTok{            }
\StringTok{            rows\_data3=FNR}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if((FILENAME \textasciitilde{} /fpt/))}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            if(p\_filename=="")}
\StringTok{                \{}
\StringTok{                close("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data3}\StringTok{\textquotesingle{}")}
\StringTok{                \}}
\StringTok{            else if(FILENAME!=p\_filename)}
\StringTok{                \{}
\StringTok{                close(p\_filename)}
\StringTok{                }
\StringTok{                printf "Info: data\_file name of " p\_filename " has been input.}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{                \}}
\StringTok{            p\_filename=FILENAME}
\StringTok{            \textbackslash{}}
\StringTok{            for(i=1; i\textless{}=n; i++)}
\StringTok{                \{}
\StringTok{                if((FILENAME \textasciitilde{} file[i]) \&\& (FILENAME \textasciitilde{} mo[file[i]]))}
\StringTok{                    \{}
\StringTok{                    break}
\StringTok{                    \}}
\StringTok{                else}
\StringTok{                    \{}
\StringTok{                    x=i+1}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            if(x==n+1)}
\StringTok{                \{}
\StringTok{                nextfile}
\StringTok{                \}}
\StringTok{            split(FILENAME,a,"[/]");}

\StringTok{            m=split(a[1],b,"[\_]");}

\StringTok{            id=b[m];}

\StringTok{            if((FILENAME \textasciitilde{} /\textbackslash{}+.fpt/))}
\StringTok{                \{}
\StringTok{                ion=1}
\StringTok{                \}}
\StringTok{            else}
\StringTok{                \{}
\StringTok{                ion=2}
\StringTok{                \}}
\StringTok{            pp[id,abindex[ion,2]]=$1}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            pp[id,abindex[ion,FNR+1]]=$1}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        if(abindex[1,rows\_data2] \textgreater{} abindex[2,rows\_data3])}
\StringTok{            \{}
\StringTok{            maxindex=abindex[1,rows\_data2]}
\StringTok{            \}}
\StringTok{        else}
\StringTok{            \{}
\StringTok{            maxindex=abindex[2,rows\_data3]}
\StringTok{            \}}
\StringTok{        printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{} "results/canopus\_pp.tsv"}
\StringTok{        \textbackslash{}}
\StringTok{        for(i=0; i\textless{}=maxindex; i++)}
\StringTok{            \{}
\StringTok{            if(class[1,i]!="" \&\& i!=maxindex)}
\StringTok{                \{}
\StringTok{                printf class[1,i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{                \}}
\StringTok{            else if(class[2,i]!="" \&\& i!=maxindex)}
\StringTok{                \{}
\StringTok{                printf class[2,i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{                \}}
\StringTok{            else if(i==maxindex \&\& class[1,i]!="")}
\StringTok{                \{}
\StringTok{                printf class[1,i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{                \}}
\StringTok{            else if(i==maxindex \&\& class[2,i]!="")}
\StringTok{                \{}
\StringTok{                printf class[2,i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        for(i=1; i\textless{}=n; i++)}
\StringTok{            \{}
\StringTok{            printf the\_id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{            }
\StringTok{            for(j=0; j\textless{}=maxindex; j++)}
\StringTok{                \{}
\StringTok{                if(class[1,j]!="" \&\& j!=maxindex || class[2,j]!="" \&\& j!=maxindex)}
\StringTok{                    \{}
\StringTok{                    if(pp[the\_id[i],j]=="")}
\StringTok{                        \{}
\StringTok{                        printf 0"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{                        \}}
\StringTok{                    else}
\StringTok{                        \{}
\StringTok{                        printf pp[the\_id[i],j]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                else if(class[1,j]!="" \&\& j==maxindex || class[2,j]!="" \&\& j==maxindex)}
\StringTok{                    \{}
\StringTok{                    if(pp[the\_id[i],j]=="")}
\StringTok{                        \{}
\StringTok{                        printf 0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{                        \}}
\StringTok{                    else}
\StringTok{                        \{}
\StringTok{                        printf pp[the\_id[i],j]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3 }\SpecialCharTok{$}\NormalTok{datas}

\NormalTok{echo }\StringTok{"classification\_extract\_sum have been successfully written into \textless{}results/canopus\_pp.tsv\textgreater{}"}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}

\NormalTok{classification\_extract\_filter}\ErrorTok{)}
\NormalTok{echo }\StringTok{"Run classification\_extract\_filter."}\NormalTok{;}
    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f results}\SpecialCharTok{/}\NormalTok{canopus\_pp.tsv ]}
\NormalTok{    then}
\NormalTok{    echo }\StringTok{"Project path acknowledged."}
    \ControlFlowTok{else}
\NormalTok{        until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{results}\SpecialCharTok{/}\NormalTok{canopus\_pp.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{results}\SpecialCharTok{/}\NormalTok{canopus\_summary.tsv ]}
\NormalTok{        do}
\NormalTok{        read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{        done;}
\NormalTok{        cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{    fi; }
    
\NormalTok{check}\OtherTok{=}\DecValTok{0}
\NormalTok{    until [[ }\StringTok{"$check"} \SpecialCharTok{==} \StringTok{"yes"}\NormalTok{ ]] }\SpecialCharTok{||}\NormalTok{ [[ }\StringTok{"$check"} \SpecialCharTok{==} \StringTok{"no"}\NormalTok{ ]]}
\NormalTok{    do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Collate the posterior probabilities of the classification of each feature? [yes/no] \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ check;}
\NormalTok{    done;}
    
    \ControlFlowTok{if}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{check }\SpecialCharTok{==} \StringTok{"yes"}\NormalTok{ ]]}
\NormalTok{    then}
\NormalTok{    definition\_limit}\OtherTok{=}\DecValTok{0}
    
\NormalTok{        until [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textgreater{}} \StringTok{"0.01"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textless{}} \StringTok{"1"}\NormalTok{ ]]}
\NormalTok{        do}
\NormalTok{        read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the classes posterior probabilities limition. 0.5\textasciitilde{}0.99 may work well. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ definition\_limit;}
\NormalTok{        done;}
    
\NormalTok{    data1}\OtherTok{=}\StringTok{"canopus\_summary.tsv"}
 
\NormalTok{    data2}\OtherTok{=}\StringTok{"canopus.tsv"}
 
\NormalTok{    data3}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
    
\NormalTok{    awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{        \{}
\StringTok{        if(NR==FNR)}
\StringTok{            \{}
\StringTok{            if(FNR==1)}
\StringTok{                \{}
\StringTok{                p\_file=FILENAME}
\StringTok{                \textbackslash{}}
\StringTok{                for(i=1; i\textless{}=NF; i++)}
\StringTok{                    \{}
\StringTok{                    if($i\textasciitilde{}/name/)}
\StringTok{                        \{}
\StringTok{                        col\_id=i}
\StringTok{                        \}}
\StringTok{                    if($i\textasciitilde{}/specific/)}
\StringTok{                        \{}
\StringTok{                        col\_specific=i}
\StringTok{                        \}}
\StringTok{                    if($i\textasciitilde{}/level/)}
\StringTok{                        \{}
\StringTok{                        col\_level=i}
\StringTok{                        \}}
\StringTok{                    if($i\textasciitilde{}/subclass/)}
\StringTok{                        \{}
\StringTok{                        col\_subclass=i}
\StringTok{                        \}}
\StringTok{                    if($i\textasciitilde{}/\^{}class/)}
\StringTok{                        \{}
\StringTok{                        col\_class=i}
\StringTok{                        \}}
\StringTok{                    if($i\textasciitilde{}/superclass/)}
\StringTok{                        \{}
\StringTok{                        col\_superclass=i}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            if(FNR\textgreater{}=2)}
\StringTok{                \{}
\StringTok{                n=split($col\_id,a,"[\_]")}
\StringTok{                \textbackslash{}}
\StringTok{                id=a[n]}
\StringTok{                \textbackslash{}}
\StringTok{                specific[id]=$col\_specific}
\StringTok{                \textbackslash{}}
\StringTok{                level[id]=$col\_level}
\StringTok{                \textbackslash{}}
\StringTok{                subclass[id]=$col\_subclass}
\StringTok{                \textbackslash{}}
\StringTok{                class[id]=$col\_class}
\StringTok{                \textbackslash{}}
\StringTok{                superclass[id]=$col\_superclass}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FILENAME\textasciitilde{}/canopus.tsv/)}
\StringTok{            \{}
\StringTok{            if(FNR==1)}
\StringTok{                \{}
\StringTok{                close(p\_file)}
\StringTok{                \textbackslash{}}
\StringTok{                p\_file=FILENAME}
\StringTok{                \textbackslash{}}
\StringTok{                for(i=1; i\textless{}=NF; i++)}
\StringTok{                    \{}
\StringTok{                    if($i\textasciitilde{}/name/)}
\StringTok{                        \{}
\StringTok{                        col\_name=i}
\StringTok{                        \}}
\StringTok{                    if($i\textasciitilde{}/description/)}
\StringTok{                        \{}
\StringTok{                        col\_description=i}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            if(FNR\textgreater{}=2)}
\StringTok{                \{}
\StringTok{                description[$col\_name]=$col\_description}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FILENAME\textasciitilde{}"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data3}\StringTok{\textquotesingle{}")}
\StringTok{            \{}
\StringTok{            if(FNR==1)}
\StringTok{                \{}
\StringTok{                close(p\_file)}
\StringTok{                \textbackslash{}}
\StringTok{                for(i=1; i\textless{}=NF; i++)}
\StringTok{                    \{}
\StringTok{                    if($i\textasciitilde{}/\^{}id$/)}
\StringTok{                        \{}
\StringTok{                        col\_id=i}
\StringTok{                        \}}
\StringTok{                    if(i\textgreater{}=2)}
\StringTok{                        \{}
\StringTok{                        col\_class\_name[i]=$i}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition\_source}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition\_description}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                "specific}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "specific\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "level\_5}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "level\_5\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                "subclass}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "subclass\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "class}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "class\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "superclass}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "superclass\_pp}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                \textgreater{} "results/stat\_classification.tsv"}
\StringTok{                \}}
\StringTok{            if(FNR\textgreater{}=2)}
\StringTok{                \{}
\StringTok{                for(i=2; i\textless{}=NF; i++)}
\StringTok{                    \{}
\StringTok{                    c\_pp[col\_class\_name[i]]=sprintf("\%.4f",$i)}
\StringTok{                    \}}
\StringTok{                if(level[$col\_id] != "" \&\& c\_pp[level[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{                    \{}
\StringTok{                    definition\_source="level\_5"}
\StringTok{                    \textbackslash{}}
\StringTok{                    definition=level[$col\_id]}
\StringTok{                    \}}
\StringTok{                else if(subclass[$col\_id] != "" \&\& c\_pp[subclass[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{                    \{}
\StringTok{                    definition\_source="subclass"}
\StringTok{                    \textbackslash{}}
\StringTok{                    definition=subclass[$col\_id]}
\StringTok{                    \}}
\StringTok{                else if(class[$col\_id] != "" \&\& c\_pp[class[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{                    \{}
\StringTok{                    definition\_source="class"}
\StringTok{                    \textbackslash{}}
\StringTok{                    definition=class[$col\_id]}
\StringTok{                    \}}
\StringTok{                else if(superclass[$col\_id] != "" \&\& c\_pp[superclass[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{                    \{}
\StringTok{                    definition\_source="superclass"}
\StringTok{                    \textbackslash{}}
\StringTok{                    definition=superclass[$col\_id]}
\StringTok{                    \}}
\StringTok{                else}
\StringTok{                    \{}
\StringTok{                    definition\_source="null"}
\StringTok{                    \textbackslash{}}
\StringTok{                    definition="null"}
\StringTok{                    \textbackslash{}}
\StringTok{                    c\_pp[definition]="null"}
\StringTok{                    \textbackslash{}}
\StringTok{                    description[definition]="null"}
\StringTok{                    \}}
\StringTok{                printf $col\_id"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  definition\_source"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  definition"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[definition]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  description[definition]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                specific[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[specific[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  level[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[level[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                subclass[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[subclass[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  class[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[class[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                superclass[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[superclass[$col\_id]]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/stat\_classification.tsv"}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
    
\NormalTok{    echo }\StringTok{"classification\_extract\_filter have been successfully written into \textless{}results/stat\_classification.tsv\textgreater{}"}
    
\NormalTok{    fi;}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{fragment\_tree\_network}\ErrorTok{)}

\NormalTok{echo }\StringTok{"Run fragment\_tree\_network."}\NormalTok{;}

    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{d temp ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f .format ]}
\NormalTok{    then}
\NormalTok{    echo }\StringTok{"Project path acknowledged."}
    
    \ControlFlowTok{else}
\NormalTok{        until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{        do}
\NormalTok{        read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project. Make sure you have moved the fragment tree alignment results to the directory where the project is located. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{        done;}
\NormalTok{        cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{    fi;}

\NormalTok{echo }\StringTok{"Please enter the minimum alignment similarity(tlimit) that you want to filter."}

\NormalTok{tlimit}\OtherTok{=}\DecValTok{0}
\NormalTok{    until [[ }\StringTok{"$tlimit"} \SpecialCharTok{\textgreater{}} \StringTok{"0.01"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$tlimit"} \SpecialCharTok{\textless{}} \StringTok{"0.99"}\NormalTok{ ]]}
\NormalTok{    do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"0.4{-}0.7 is recommended \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ tlimit;}
\NormalTok{    done;}

    \ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{d temp}\SpecialCharTok{/}\NormalTok{ftaligntemp ]}
\NormalTok{    then }
\NormalTok{    mkdir temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}
\NormalTok{    fi;}
    
\NormalTok{data}\OtherTok{=}\StringTok{"ftalign.tsv"}

\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/ftaligntemp/tmp"}

\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    print NR,FNR}
\StringTok{    }
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if(NR==1 \&\& i!=1 || NR!=1 \&\& i==1)}
\StringTok{                \{}
\StringTok{                n=split($i,x,"[\_]")}
\StringTok{                \textbackslash{}}
\StringTok{                raw[NR,i]=x[n]}
\StringTok{                \}}
\StringTok{            else}
\StringTok{                \{}
\StringTok{                if(NR==i)}
\StringTok{                    \{}
\StringTok{                    raw\_norm[NR,i]=$i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}FNR \&\& FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        for(i=2; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            norm1=$\{i\}/raw\_norm[i,i]}
\StringTok{                }
\StringTok{            norm2=$\{i\}/raw\_norm[FNR,FNR]}
\StringTok{                }
\StringTok{            norms=sprintf("\%.2f", ((norm1+norm2)/2))}
\StringTok{            }
\StringTok{            if((norms+0 \textgreater{} \textquotesingle{}}\SpecialCharTok{$}\NormalTok{tlimit}\StringTok{\textquotesingle{}+0) \&\& (norms+0 \textless{} 1+0))}
\StringTok{                \{}
\StringTok{                if(raw[FNR,1]+0\textgreater{}=raw[1,i]+0)}
\StringTok{                    \{}
\StringTok{                    print raw[FNR,1], raw[1,i], norms \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                    \}}
\StringTok{                if(raw[FNR,1]+0\textless{}raw[1,i]+0)}
\StringTok{                    \{}
\StringTok{                    print raw[1,i], raw[FNR,1], norms \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data }\SpecialCharTok{$}\NormalTok{data}

\NormalTok{sort }\SpecialCharTok{{-}}\NormalTok{u }\SpecialCharTok{$}\NormalTok{savepath }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{filter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit}

\NormalTok{echo }\StringTok{"fragment\_tree\_network have been successfully written into \textless{}temp/ftaligntemp/filter\_net\_$tlimit\textgreater{}"}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}

\NormalTok{fragment\_tree\_network\_delta}\ErrorTok{)}

    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{d temp ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f .format ]}
\NormalTok{    then}
\NormalTok{    echo }\StringTok{"Project path acknowledged."}
    \ControlFlowTok{else}
\NormalTok{        until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{        do}
\NormalTok{        read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{        done;}
\NormalTok{    cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{    fi;}
\NormalTok{echo }\StringTok{"The following module attempts to compute the differential fingerprints of connected clusters based on the molecular fingerprint results of sirius 4."}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}

\NormalTok{plimit}\OtherTok{=}\DecValTok{0}
\NormalTok{    until [[ }\StringTok{"$plimit"} \SpecialCharTok{\textgreater{}} \StringTok{"0.5"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$plimit"} \SpecialCharTok{\textless{}} \StringTok{"0.99"}\NormalTok{ ]]}
\NormalTok{    do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"If the minimum alignment similarity is greater than 0.3, this step will automatic calculate the discrepancy fingerprint between alignment features(in beta). Please enter the minimum posterior probability of the molecular fingerprint(plimit\_1) to be filtered. 0.9{-}0.99 is recommended. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ plimit;}
\NormalTok{    done;}

\NormalTok{plimit2}\OtherTok{=}\DecValTok{0}
\NormalTok{    until [[ }\StringTok{"$plimit2"} \SpecialCharTok{\textgreater{}} \StringTok{"0.1"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$plimit2"} \SpecialCharTok{\textless{}} \StringTok{"$plimit"}\NormalTok{ ]]}
\NormalTok{    do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"The minimum posterior probability of the molecular fingerprint(plimit\_2) to be controled. 0.1{-}0.5 may work well. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ plimit2;}
\NormalTok{    done;}
    
\NormalTok{tlimit}\OtherTok{=}\ErrorTok{$}\NormalTok{(ls temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{filter\_net\_}\SpecialCharTok{*} \ErrorTok{|}\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F \_ }\StringTok{\textquotesingle{}\{print $NF\}\textquotesingle{}}\NormalTok{)}

\NormalTok{check\_rep}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}END\{print NR\}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$tlimit"}\NormalTok{))}

    \ControlFlowTok{if}\NormalTok{ [[ }\StringTok{"$check\_rep"} \SpecialCharTok{\textgreater{}} \StringTok{"1"}\NormalTok{ ]]}
\NormalTok{    then}
\NormalTok{    tlimit}\OtherTok{=}\DecValTok{0}
\NormalTok{        until [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{filter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit ]}
\NormalTok{        do}
\NormalTok{        read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Plural and different fragment\_tree\_network files were found to exist locally. Please select a tlimit parameter you have utilized to run fragment\_tree\_network\_delta. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ tlimit;}
\NormalTok{        done;}
\NormalTok{    fi;}
    
    
    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{refilter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit ]}
\NormalTok{    then rm temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{refilter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit}
\NormalTok{    fi;}
    
    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{fpsample ]}
\NormalTok{    then rm temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{fpsample}
\NormalTok{    fi;}

\NormalTok{echo }\StringTok{"Running delta\_fingerprint computation..."}

\NormalTok{echo }\StringTok{"Aquiring data from sirius index..."}

\NormalTok{data1}\OtherTok{=}\StringTok{"*\_*/compound.info"}

\NormalTok{data2}\OtherTok{=}\StringTok{"temp/ftaligntemp/filter\_net\_$tlimit"}

\NormalTok{echo }\StringTok{"Run fragment\_tree\_network\_delta."}

\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/ms\_data\_$tlimit"}

\NormalTok{echo }\StringTok{"step 1: ms data"}

    \ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{savepath ]}
\NormalTok{    then}

\NormalTok{    awk }\SpecialCharTok{{-}}\NormalTok{F }\StringTok{"[}\SpecialCharTok{\textbackslash{}t}\StringTok{]||[:]||[\_]"} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}

\StringTok{        BEGIN\{  }
\StringTok{            printf "..."}
\StringTok{            }
\StringTok{            printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "m/z}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "rt}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{            \}}
\StringTok{        \{}
\StringTok{        if(FILENAME\textasciitilde{}/compound.info/)}
\StringTok{            \{}
\StringTok{            if(FNR==1)}
\StringTok{                \{}
\StringTok{                printf "Info: catch \textgreater{}\textgreater{}\textgreater{} "FILENAME"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{                \}}
\StringTok{            if($1=="name")}
\StringTok{                \{}
\StringTok{                i+=1;}
\StringTok{                }
\StringTok{                id[i]=$NF;}
\StringTok{                }
\StringTok{                n=split($NF,a,"[\_]")}
\StringTok{                }
\StringTok{                printf a[n]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{                \}}
\StringTok{            if($1=="ionMass")}
\StringTok{                \{}
\StringTok{                mz[id[i]]=$NF}
\StringTok{                }
\StringTok{                printf sprintf("\%.4f",$NF)"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{                \}}
\StringTok{            if($1=="ionType")}
\StringTok{                \{}
\StringTok{                type[id[i]]=$NF}
\StringTok{                \}}
\StringTok{            if($1=="rt")}
\StringTok{                \{}
\StringTok{                rt[id[i]]=$2;}
\StringTok{                }
\StringTok{                printf sprintf("\%.2f",$2/60)"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FILENAME\textasciitilde{}/ftaligntemp/)}
\StringTok{            \{}
\StringTok{            \#source  target  ftalign  delta\_mz  delta\_rt  source\_iontype  target\_iontype;}
\StringTok{            }
\StringTok{            if(FNR==1)}
\StringTok{                \{}
\StringTok{                printf "" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                \}}
\StringTok{            print $1,$2,$3,sprintf("\%.3f",mz[$2]{-}mz[$1]),sprintf("\%.2f",rt[$2]{-}rt[$1]),type[$1],type[$2] \textbackslash{}}
\StringTok{            \textbackslash{}}
\StringTok{            \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
\NormalTok{     fi;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}

\NormalTok{echo }\StringTok{"step 2: data path"}

\NormalTok{source\_file}\OtherTok{=}\StringTok{"temp/Mo\_filename"}

\NormalTok{data}\OtherTok{=}\StringTok{"temp/ms\_data\_$tlimit"}

\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/datapath\_$tlimit"}

    \ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{savepath ]}
\NormalTok{    then}
    
\NormalTok{    awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{        \{}
\StringTok{        if(NR==FNR)}
\StringTok{            \{}
\StringTok{            n=split($2, a, "[\_]")}
\StringTok{            }
\StringTok{            file[a[n]]=$2}
\StringTok{            }
\StringTok{            formu\_type[a[n]]=$3}
\StringTok{            \}}
\StringTok{        if(NR!=FNR)}
\StringTok{            \{}
\StringTok{            \#\textless{}path\textgreater{}sourceFormula  \textless{}path\textgreater{}targetFormula}
\StringTok{            }
\StringTok{            path1=file[$1]"/fingerprints/"formu\_type[$1]".fpt"}
\StringTok{            }
\StringTok{            path2=file[$2]"/fingerprints/"formu\_type[$2]".fpt"}
\StringTok{            }
\StringTok{            data[path1]=path1}
\StringTok{            }
\StringTok{            data[path2]=path2}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{        END\{}
\StringTok{            for(i in data)}
\StringTok{                \{}
\StringTok{                n+=1}
\StringTok{                }
\StringTok{                print "Check file:",n}
\StringTok{                }
\StringTok{                if(getline\textless{}i=={-}1)}
\StringTok{                    \{}
\StringTok{                    printf "Escape filename: " i "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{                    \}}
\StringTok{                else}
\StringTok{                    \{}
\StringTok{                    printf i" " \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                    \}}
\StringTok{                close(i)}
\StringTok{                \}}
\StringTok{            print "Sum:",n}
\StringTok{            }
\StringTok{            \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{source\_file }\SpecialCharTok{$}\NormalTok{data}
\NormalTok{    fi;}
    
\NormalTok{datapath}\OtherTok{=}\ErrorTok{$}\NormalTok{(cat temp}\SpecialCharTok{/}\NormalTok{datapath\_}\SpecialCharTok{$}\NormalTok{tlimit)}

\NormalTok{echo }\StringTok{"step 3: fingerprint"}
    
\NormalTok{data\_allfp}\OtherTok{=}\StringTok{"temp/data\_allfp\_$tlimit"}

    \ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{data\_allfp ]}
\NormalTok{    then}
    
\NormalTok{    awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{        BEGIN\{}
\StringTok{            n=0}
\StringTok{            \}}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            if(n\textgreater{}1)}
\StringTok{                \{}
\StringTok{                close(file)}
\StringTok{                \}}
\StringTok{            file=FILENAME;}
\StringTok{            }
\StringTok{            print "Get fingerprints: ",FILENAME}
\StringTok{            }
\StringTok{            n+=1;}
\StringTok{            }
\StringTok{            printf FILENAME"}\SpecialCharTok{\textbackslash{}n}\StringTok{"$0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data\_allfp}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        else}
\StringTok{            \{}
\StringTok{            print $0 \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data\_allfp}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{datapath}
        
\NormalTok{    fi;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}


\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==1)}
\StringTok{        \{}
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if($i\textasciitilde{}/absolute/)}
\StringTok{                \{}
\StringTok{                col\_index=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/description/)}
\StringTok{                \{}
\StringTok{                col\_description=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        print $col\_index,$col\_description}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}}\NormalTok{ csi\_fingerid.tsv }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{pos\_fingerprint\_index;}

\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==1)}
\StringTok{        \{}
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if($i\textasciitilde{}/absolute/)}
\StringTok{                \{}
\StringTok{                col\_index=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/description/)}
\StringTok{                \{}
\StringTok{                col\_description=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        print $col\_index,$col\_description}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}}\NormalTok{ csi\_fingerid\_neg.tsv }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{neg\_fingerprint\_index;}

\NormalTok{posindex}\OtherTok{=}\StringTok{"temp/ftaligntemp/pos\_fingerprint\_index"}

\NormalTok{negindex}\OtherTok{=}\StringTok{"temp/ftaligntemp/neg\_fingerprint\_index"}

\NormalTok{data}\OtherTok{=}\StringTok{"temp/ms\_data\_$tlimit"}

\NormalTok{echo }\StringTok{"step 4: merge data"}

\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    BEGIN\{}
\StringTok{        file=0}
\StringTok{        x=0}
\StringTok{        count=0}
\StringTok{        f=0}
\StringTok{        posnum=0}
\StringTok{        negnum=0}
\StringTok{        \}}
\StringTok{    \{}
\StringTok{    if(FNR==1)}
\StringTok{        \{}
\StringTok{        file+=1}
\StringTok{        \}}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        if(($1\textasciitilde{}/fingerprint/))}
\StringTok{            \{}
\StringTok{            if(x+0\textgreater{}f+0)}
\StringTok{                \{}
\StringTok{                f=x  \# calculate the max index.}
\StringTok{                \}}
\StringTok{            count+=1;  \# calculate the all fingerprints file number.}
\StringTok{            \textbackslash{}}
\StringTok{            split($1,a,"[/]"); e=split(a[1],b,"[\_]"); id=b[e]; \#catch the id.}
\StringTok{            \textbackslash{}}
\StringTok{            x=0;}
\StringTok{            \}}
\StringTok{        else}
\StringTok{            \{}
\StringTok{            x+=1;}
\StringTok{            \textbackslash{}}
\StringTok{            fp[id,x]=$1;}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(file==2)}
\StringTok{        \{}
\StringTok{        pos[FNR]=$1}
\StringTok{        }
\StringTok{        posnum+=1}
\StringTok{        \}}
\StringTok{    if(file==3)}
\StringTok{        \{}
\StringTok{        neg[FNR]=$1}
\StringTok{        }
\StringTok{        negnum+=1}
\StringTok{        \}}
\StringTok{    if(file==4)}
\StringTok{        \{}
\StringTok{        if("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tlimit}\StringTok{\textquotesingle{}"+0 \textgreater{}= 0.3)}
\StringTok{            \{}
\StringTok{            if(fp[$1,1]!="" \&\& fp[$2,1]!="")}
\StringTok{                \{}
\StringTok{                n1=split($6, g, "[]]");}
\StringTok{                }
\StringTok{                n2=split($7, h, "[]]");}
\StringTok{                }
\StringTok{                if(g[n1]=="+" \&\& h[n2]=="+")}
\StringTok{                    \{}
\StringTok{                    for(x=1; x\textless{}=posnum; x++)}
\StringTok{                        \{}
\StringTok{                        if(fp[$1,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                            \{}
\StringTok{                            data\_s[FNR,x]=pos[x]}
\StringTok{                            \}}
\StringTok{                        else if(fp[$2,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                            \{}
\StringTok{                            data\_t[FNR,x]=pos[x]}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                if(g[n1]=="{-}" \&\& h[n2]=="{-}")}
\StringTok{                    \{}
\StringTok{                    for(x=1; x\textless{}=negnum; x++)}
\StringTok{                        \{}
\StringTok{                        if(fp[$1,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                            \{}
\StringTok{                            data\_s[FNR,x]=neg[x]}
\StringTok{                            \}}
\StringTok{                        else if(fp[$2,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                            \{}
\StringTok{                            data\_t[FNR,x]=neg[x]}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                if(g[n1]=="{-}" \&\& h[n2]=="+" || h[n2]=="{-}" \&\& g[n1]=="+")}
\StringTok{                    \{}
\StringTok{                    for(i=1; i\textless{}=posnum; i++)}
\StringTok{                        \{}
\StringTok{                        for(j=1; j\textless{}=negnum; j++)}
\StringTok{                            \{}
\StringTok{                            if(pos[i]==neg[j])}
\StringTok{                                \{}
\StringTok{                                mirror[i]=j     \#if pos=i, the identical index of neg is mirror[i]}
\StringTok{                                \}}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                if(g[n1]=="{-}" \&\& h[n2]=="+")    }
\StringTok{                    \{}
\StringTok{                    for(x=1; x\textless{}=f; x++)}
\StringTok{                        \{}
\StringTok{                        if(fp[$1,mirror[x]]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                            \{}
\StringTok{                            data\_s[FNR,x]=neg[mirror[x]]}
\StringTok{                            \}}
\StringTok{                        else if(fp[$2,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,mirror[x]]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                            \{}
\StringTok{                            data\_t[FNR,x]=neg[mirror[x]]}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                if(h[n2]=="{-}" \&\& g[n1]=="+")}
\StringTok{                    \{}
\StringTok{                    for(x=1; x\textless{}=f; x++)}
\StringTok{                        \{}
\StringTok{                        if(fp[$1,x]+0\textgreater{}= \textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,mirror[x]]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                            \{}
\StringTok{                            data\_s[FNR,x]=neg[mirror[x]]}
\StringTok{                            \}}
\StringTok{                        else if(fp[$2,mirror[x]]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                            \{}
\StringTok{                            data\_t[FNR,x]=neg[mirror[x]]}
\StringTok{                            \}}
\StringTok{                        \}       }
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            printf "source}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "target}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "ftalign\_similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "delta\_m/z}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "source\_fp\_uniq}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "target\_fp\_uniq}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{            \}}
\StringTok{        else}
\StringTok{            \{}
\StringTok{            printf $1"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $2"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $3"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $4"}\SpecialCharTok{\textbackslash{}t}\StringTok{";}
\StringTok{            \textbackslash{}}
\StringTok{            if(\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tlimit}\StringTok{\textquotesingle{}+0 \textgreater{}= 0.3)}
\StringTok{                \{}
\StringTok{                if(fp[$1,1]=="" || fp[$2,1]=="")}
\StringTok{                    \{}
\StringTok{                    printf "NA@NA}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{                    \}}
\StringTok{                else}
\StringTok{                    \{}
\StringTok{                    printf "source:"  \#the source fingerprint uniq.}
\StringTok{                    \textbackslash{}}
\StringTok{                    for(x=1; x\textless{}=f; x++)}
\StringTok{                        \{}
\StringTok{                        if(data\_s[FNR,x]!="")}
\StringTok{                            \{}
\StringTok{                            printf data\_s[FNR,x]","}
\StringTok{                            \}}
\StringTok{                        \};}
\StringTok{                    printf "@target:"  \#the target fingerprint uniq.}
\StringTok{                    \textbackslash{}}
\StringTok{                    for(x=1; x\textless{}=f; x++)}
\StringTok{                        \{}
\StringTok{                        if(data\_t[FNR,x]!="")}
\StringTok{                            \{}
\StringTok{                            printf data\_t[FNR,x]","}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                    printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            else}
\StringTok{                \{}
\StringTok{                printf "NA@NA}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data\_allfp }\SpecialCharTok{$}\NormalTok{posindex }\SpecialCharTok{$}\NormalTok{negindex }\SpecialCharTok{$}\NormalTok{data }\SpecialCharTok{|}\NormalTok{ sed }\SpecialCharTok{{-}}\NormalTok{e }\StringTok{\textquotesingle{}s/,@/}\SpecialCharTok{\textbackslash{}t}\StringTok{/g; s/,$//g; s/@/}\SpecialCharTok{\textbackslash{}t}\StringTok{/g\textquotesingle{}}\NormalTok{ \textbackslash{}}
\NormalTok{    \textbackslash{}}
    \SpecialCharTok{\textgreater{}}\NormalTok{ results}\SpecialCharTok{/}\NormalTok{source\_target\_tree\_}\SpecialCharTok{$}\NormalTok{tlimit.tsv;}

\NormalTok{echo }\StringTok{"All instances have written into \textless{}results/source\_target\_tree\_$tlimit.tsv\textgreater{}."}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}

\NormalTok{echo }\StringTok{"step 5: separate child{-}nebula from parent{-}nebula."}

\NormalTok{data}\OtherTok{=}\StringTok{"results/stat\_classification.tsv"}

\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/filter\_0\_class.tsv"}

\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(FNR==1)}
\StringTok{        \{}
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if($i\textasciitilde{}/\^{}definition$/)}
\StringTok{                \{}
\StringTok{                col\_class=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        class[$col\_class]=$col\_class}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        for(i in class)}
\StringTok{            \{}
\StringTok{            printf class[i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
 
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 
\NormalTok{ data1}\OtherTok{=}\StringTok{"temp/filter\_0\_class.tsv"} \CommentTok{\#lignans and iridoids}
 
\NormalTok{ data2}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
 
\NormalTok{ data3}\OtherTok{=}\StringTok{"results/fingerid\_first\_score.tsv"}

\NormalTok{    until [[ }\StringTok{"$similarity\_limit"} \SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$similarity\_limit"} \SpecialCharTok{\textless{}} \DecValTok{1}\NormalTok{ ]]}
\NormalTok{    do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please set the Tanimoto similarity threshold contribute to child{-}nebula. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ similarity\_limit;}
\NormalTok{    done;}
 
\NormalTok{    until [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textgreater{}} \FloatTok{0.01}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textless{}} \DecValTok{1}\NormalTok{ ]]}
\NormalTok{    do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the classes posterior probabilities limition. 0.5\textasciitilde{}0.99 may work well. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ definition\_limit;}
\NormalTok{    done;}
 
\NormalTok{ class\_pp\_limit}\OtherTok{=}\ErrorTok{$}\NormalTok{definition\_limit}
 
\NormalTok{ savepath}\OtherTok{=}\StringTok{"temp/idenfication\_filter\_$class\_pp\_limit.tsv"}
 
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        filter\_class[$1]=$1}
\StringTok{        \}}
\StringTok{    if(FILENAME\textasciitilde{}/canopus/)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            col\_id=1}
\StringTok{            }
\StringTok{            for(i=2; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                for(j in filter\_class)}
\StringTok{                    \{}
\StringTok{                    if(j==$i)}
\StringTok{                        \{}
\StringTok{                        col\_class[j]=i}
\StringTok{                        }
\StringTok{                        print i}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            for(i in col\_class)}
\StringTok{                \{}
\StringTok{                if(sprintf("\%.3f",$col\_class[i])+0\textgreater{}="\textquotesingle{}}\SpecialCharTok{$}\NormalTok{class\_pp\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{                    \{}
\StringTok{                    class\_set[i,$col\_id]=i}
\StringTok{                    }
\StringTok{                    print "ID: ",$1,i,$col\_class[i]}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FILENAME\textasciitilde{}/fingerid\_first\_score/)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/\^{}id/)}
\StringTok{                    \{}
\StringTok{                    col\_id=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/similarity/)}
\StringTok{                    \{}
\StringTok{                    col\_similarity=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            printf "class\_nebula\_facet}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            if($col\_similarity+0 \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{similarity\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{                \{}
\StringTok{                for(i in class\_set)}
\StringTok{                    \{}
\StringTok{                    if(i\textasciitilde{}"}\SpecialCharTok{\textbackslash{}034}\StringTok{"$col\_id"$")}
\StringTok{                        \{}
\StringTok{                        printf class\_set[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 
\NormalTok{ data}\OtherTok{=}\StringTok{"temp/idenfication\_filter\_$class\_pp\_limit.tsv"}
 
\NormalTok{ savepath}\OtherTok{=}\StringTok{"temp/idenfication\_filter2\_$\{class\_pp\_limit\}.tsv"}
 
\NormalTok{    until [[ }\StringTok{"$num\_limit"} \SpecialCharTok{{-}}\NormalTok{gt }\DecValTok{0}\NormalTok{ ]]}
\NormalTok{    do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the features number threshold contribute to child{-}nebula. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ num\_limit;}
\NormalTok{    done;}
 
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(FNR==1)}
\StringTok{        \{}
\StringTok{        printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        }
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if($i\textasciitilde{}/class\_nebula\_facet/)}
\StringTok{                \{}
\StringTok{                col\_class=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        num[$col\_class]+=1}
\StringTok{        }
\StringTok{        data[FNR]=$0}
\StringTok{        }
\StringTok{        class[FNR]=$col\_class}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        for(i in num)}
\StringTok{            \{}
\StringTok{            print num[i]    }
\StringTok{            if(num[i] \textgreater{}= \textquotesingle{}}\SpecialCharTok{$}\NormalTok{num\_limit}\StringTok{\textquotesingle{})}
\StringTok{                \{}
\StringTok{                for(j in class)}
\StringTok{                    \{}
\StringTok{                    if(class[j]==i)}
\StringTok{                        \{}
\StringTok{                        printf data[j]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
 
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 
\NormalTok{ mkdir results}\SpecialCharTok{/}\NormalTok{network\_facet\_}\SpecialCharTok{$}\NormalTok{class\_pp\_limit}
 
\NormalTok{ data1}\OtherTok{=}\StringTok{"temp/idenfication\_filter2\_$\{class\_pp\_limit\}.tsv"}
 
\NormalTok{ data2}\OtherTok{=}\StringTok{"results/source\_target\_tree\_$tlimit.tsv"} \CommentTok{\# "results/source\_target\_tree\_0.4.tsv"}
 
\NormalTok{ save\_class}\OtherTok{=}\StringTok{"results/filter\_child\_class.tsv"}
 
\NormalTok{ savepath}\OtherTok{=}\StringTok{"results/network\_facet\_$class\_pp\_limit/"}
 
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/class\_nebula\_facet/)}
\StringTok{                    \{}
\StringTok{                    col\_class=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/\^{}id$/)}
\StringTok{                    \{}
\StringTok{                    col\_id=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            class[$col\_class]=$col\_class}
\StringTok{            }
\StringTok{            class\_id[$col\_class,$col\_id]=$col\_id}
\StringTok{            }
\StringTok{            stat\_id[$col\_class,$col\_id]=$col\_id}
\StringTok{            }
\StringTok{            belong[$col\_class,$col\_id]=$col\_class}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}FNR)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            for(i in class)}
\StringTok{                \{}
\StringTok{                printf i"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{save\_class}\StringTok{\textquotesingle{}"}
\StringTok{                }
\StringTok{                printf $0"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "facet}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" i ".tsv"}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            for(i in class)}
\StringTok{                \{}
\StringTok{                if( class\_id[i,$1]==$1 \&\& class\_id[i,$2]==$2 )}
\StringTok{                    \{}
\StringTok{                    printf $0"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  i"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" i ".tsv"}
\StringTok{                    }
\StringTok{                    delete stat\_id[i,$1]}
\StringTok{                    }
\StringTok{                    delete stat\_id[i,$2]}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        for(i in stat\_id)}
\StringTok{            \{}
\StringTok{            \#\# source target similarity delta\_mz fp fp class}
\StringTok{            }
\StringTok{            printf stat\_id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" stat\_id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "1}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "0}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "null}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "null}\SpecialCharTok{\textbackslash{}t}\StringTok{"  belong[i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textbackslash{}}
\StringTok{            \textbackslash{}}
\StringTok{            \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" belong[i] ".tsv"}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
 
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{compound\_idenfication}\ErrorTok{)}

\NormalTok{echo }\StringTok{"Run compound\_idenfication."}







\NormalTok{echo }\StringTok{"compound\_idenfication "}

\NormalTok{exit}

\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{double\_ion\_network}\ErrorTok{)}

\NormalTok{exit;}

\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{exit}\ErrorTok{)}
\NormalTok{echo }\StringTok{"The mystery of creation is like the darkness of night{-}{-}it is great.}
\StringTok{Delusions of knowledge are like the fog of the morning."}
\NormalTok{exit;}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{*}\ErrorTok{)}
\NormalTok{echo }\StringTok{"error"}
\NormalTok{exit;}
\NormalTok{;;}
\NormalTok{esac;}
\NormalTok{done;}\CommentTok{\#(for)}
\NormalTok{done;}\CommentTok{\#(select)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-mcnebula1110.sh}{%
\section{File: mcnebula1110.sh}\label{file-mcnebula1110.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{echo }\StringTok{"We are all in the gutter, }
\StringTok{but some of us are looking at the stars."}\NormalTok{;}
\NormalTok{PS3}\OtherTok{=}\StringTok{\textquotesingle{}Please select the workflow to be executed. \textgreater{}\textgreater{}\textgreater{} \textquotesingle{}}
\NormalTok{select command }\ControlFlowTok{in}\NormalTok{ \textbackslash{}}
\NormalTok{   \textbackslash{}}
  \StringTok{"default"}\NormalTok{ \textbackslash{}}
\NormalTok{  \textbackslash{}}
  \StringTok{"structure\_extract"}\NormalTok{ \textbackslash{}}
\NormalTok{  \textbackslash{}}
  \StringTok{"classification\_extract\_sum"}\NormalTok{ \textbackslash{}}
\NormalTok{  \textbackslash{}}
  \StringTok{"classification\_extract\_filter"}\NormalTok{ \textbackslash{}}
\NormalTok{  \textbackslash{}}
  \StringTok{"fragment\_tree\_network"}\NormalTok{ \textbackslash{}}
\NormalTok{  \textbackslash{}}
  \StringTok{"fragment\_tree\_network\_delta"}\NormalTok{ \textbackslash{}}
\NormalTok{  \textbackslash{}}
  \StringTok{"compound\_idenfication"}\NormalTok{ \textbackslash{}}
\NormalTok{  \textbackslash{}}
  \StringTok{"double\_ion\_network"}\NormalTok{ \textbackslash{}}
\NormalTok{  \textbackslash{}}
  \StringTok{"exit"} 
\NormalTok{do}
 \ControlFlowTok{if}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{command }\SpecialCharTok{==} \StringTok{"default"}\NormalTok{ ]]}
\NormalTok{ then}
\NormalTok{ confirm}\OtherTok{=}\DecValTok{0}
\NormalTok{   until [[ }\SpecialCharTok{$}\NormalTok{confirm }\SpecialCharTok{==} \StringTok{"yes"}\NormalTok{ ]] }\SpecialCharTok{||}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{confirm }\SpecialCharTok{==} \StringTok{"no"}\NormalTok{ ]]}
\NormalTok{   do}
\NormalTok{   read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Running all proccesses sequentially? [yes/no] \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ confirm}
\NormalTok{   done;}
   \ControlFlowTok{if}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{confirm }\SpecialCharTok{==} \StringTok{"no"}\NormalTok{ ]]}
\NormalTok{   then exit}
\NormalTok{   fi;}
\NormalTok{ default}\OtherTok{=}\StringTok{"structure\_extract classification\_extract\_sum classification\_extract\_filter fragment\_tree\_network fragment\_tree\_network\_delta"}
\NormalTok{ list}\OtherTok{=}\ErrorTok{$}\NormalTok{(echo }\SpecialCharTok{$}\NormalTok{default);}
 \ControlFlowTok{else}\NormalTok{ list}\OtherTok{=}\ErrorTok{$}\NormalTok{( echo }\SpecialCharTok{$}\NormalTok{command)}
\NormalTok{ fi;}
 \ControlFlowTok{for}\NormalTok{ option }\ControlFlowTok{in} \SpecialCharTok{$}\NormalTok{(echo }\SpecialCharTok{$}\NormalTok{list)}
\NormalTok{ do}
\NormalTok{   case }\SpecialCharTok{$}\NormalTok{option }\ControlFlowTok{in}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{structure\_extract}\ErrorTok{)}
\NormalTok{echo }\StringTok{"Run structure\_extract."}
\NormalTok{projectpath}\OtherTok{=}\DecValTok{0}
\NormalTok{ until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{canopus\_summary.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{ do}
\NormalTok{ read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{ done;}
\NormalTok{cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{mkdir results;}
\NormalTok{mkdir temp;}
\NormalTok{mkdir temp}\SpecialCharTok{/}\NormalTok{fintemp;}
 \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{Mo\_filename ]}
\NormalTok{ then rm temp}\SpecialCharTok{/}\NormalTok{Mo\_filename}
\NormalTok{ fi;}
\NormalTok{data}\OtherTok{=}\StringTok{"*\_*/fingerid/*.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  BEGIN\{}
\StringTok{    all\_id=0}
\StringTok{    \textbackslash{}}
\StringTok{    max\_id={-}1}
\StringTok{    \textbackslash{}}
\StringTok{    p\_id="null"}
\StringTok{    \textbackslash{}}
\StringTok{    printf "Info: loading the data..."}
\StringTok{    \}}
\StringTok{  \{}
\StringTok{  if(FNR==1)}
\StringTok{    \{}
\StringTok{    if(NR\textgreater{}FNR)}
\StringTok{      \{}
\StringTok{      close(pfile)}
\StringTok{      \}}
\StringTok{    f=split(FILENAME,a,"[/]");}
\StringTok{    n=split(a[1],b,"[\_]");}
\StringTok{    id=b[n];}
\StringTok{    if(id!=p\_id)}
\StringTok{      \{}
\StringTok{      all\_id+=1}
\StringTok{      \textbackslash{}}
\StringTok{      if(id\textgreater{}max\_id)}
\StringTok{        \{}
\StringTok{        max\_id=id}
\StringTok{        \}}
\StringTok{      \}}
\StringTok{    file[id]=a[1]}
\StringTok{    split(a[f], g, "[.]")}
\StringTok{    formu\_type[id]=g[1]}
\StringTok{    if(all\_id==1)}
\StringTok{      \{}
\StringTok{      for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{        if(($i\textasciitilde{}/inchikey2D/))}
\StringTok{          \{}
\StringTok{          col\_2D=i}
\StringTok{          \}}
\StringTok{        if($i=="inchi")}
\StringTok{          \{}
\StringTok{          col\_inchi=i}
\StringTok{          \}}
\StringTok{        if(($i\textasciitilde{}/Formula/))}
\StringTok{          \{}
\StringTok{          col\_formu=i}
\StringTok{          \}}
\StringTok{        if($i=="score")}
\StringTok{          \{}
\StringTok{          col\_score=i}
\StringTok{          \}}
\StringTok{        if($i=="name")}
\StringTok{          \{}
\StringTok{          col\_name=i}
\StringTok{          \}}
\StringTok{        if($i=="smiles")}
\StringTok{          \{}
\StringTok{          col\_smiles=i}
\StringTok{          \}}
\StringTok{        if($i=="xlogp")}
\StringTok{          \{}
\StringTok{          col\_x=i}
\StringTok{          \}}
\StringTok{        if(($i\textasciitilde{}/imilarity/))}
\StringTok{          \{}
\StringTok{          col\_simi=i}
\StringTok{          \}}
\StringTok{        if($i\textasciitilde{}/links/)}
\StringTok{          \{}
\StringTok{          col\_links=i}
\StringTok{          \}}
\StringTok{        \}}
\StringTok{      \}}
\StringTok{    pfile=FILENAME}
\StringTok{    printf g[1]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"formu\_type[id]"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{    printf "Info: the data of " id " (ID) has input. The filename is " FILENAME ".}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{    \}}
\StringTok{  if(FNR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{    row\_score=$col\_score}
\StringTok{    row\_simi=$col\_simi}
\StringTok{    if(max["score",id]=="" || max["score",id]+0\textless{}row\_score+0)}
\StringTok{     \{}
\StringTok{      max["score",id]=row\_score}
\StringTok{      name["score",id]=$col\_name}
\StringTok{      formula["score",id]=$col\_formu}
\StringTok{      simi["score",id]=$col\_simi}
\StringTok{      smiles["score",id]=$col\_smiles}
\StringTok{      inchi["score",id]=$col\_inchi}
\StringTok{      in2D["score",id]=$col\_2D}
\StringTok{      score["score",id]=$col\_score}
\StringTok{      xlogp["score",id]=$col\_x}
\StringTok{      links["score",id]=$col\_links}
\StringTok{      \}}
\StringTok{    if(max["simi",id]=="" || max["simi",id]+0\textless{}row\_simi+0)}
\StringTok{     \{}
\StringTok{      max["simi",id]=row\_simi}
\StringTok{      name["simi",id]=$col\_name}
\StringTok{      formula["simi",id]=$col\_formu}
\StringTok{      simi["simi",id]=$col\_simi}
\StringTok{      smiles["simi",id]=$col\_smiles}
\StringTok{      inchi["simi",id]=$col\_inchi}
\StringTok{      in2D["simi",id]=$col\_2D}
\StringTok{      score["simi",id]=$col\_score}
\StringTok{      xlogp["simi",id]=$col\_x}
\StringTok{      links["simi",id]=$col\_links}
\StringTok{      \}}
\StringTok{    \}}
\StringTok{  \}}
\StringTok{  END\{}
\StringTok{    printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "formula}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "smiles}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchi}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchikey2D}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{    \textbackslash{}}
\StringTok{    "score}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "xlogp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "links}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/fingerid\_sum.tsv"}
\StringTok{    \textbackslash{}}
\StringTok{    printf "" \textgreater{} "temp/Mo\_filename"}
\StringTok{    for(l in file)}
\StringTok{      \{}
\StringTok{      if(max["score",l]!="")}
\StringTok{        \{}
\StringTok{        printf l"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        name["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  formula["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  simi["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        smiles["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  inchi["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  in2D["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        score["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  xlogp["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  links["score",l]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/fingerid\_sum.tsv"}
\StringTok{        printf formula["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  file[l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  formu\_type[l]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "temp/Mo\_filename"}
\StringTok{        \}}
\StringTok{      if(max["simi",l]!="" \&\& max["simi",l]!=max["score",l])}
\StringTok{        \{}
\StringTok{        printf l"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        name["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  formula["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  simi["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        smiles["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  inchi["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  in2D["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        score["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  xlogp["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  links["simi",l]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/fingerid\_sum.tsv"}
\StringTok{        \}}
\StringTok{      \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\NormalTok{data\_sum}\OtherTok{=}\StringTok{"results/fingerid\_sum.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  \{}
\StringTok{  if(NR==1)}
\StringTok{    \{}
\StringTok{    for(i=1; i\textless{}=NF; i++)}
\StringTok{      \{}
\StringTok{      if($i\textasciitilde{}/id/)}
\StringTok{        \{}
\StringTok{        col\_id=i}
\StringTok{        \}}
\StringTok{      if($i\textasciitilde{}/score/)}
\StringTok{        \{}
\StringTok{        col\_score=i}
\StringTok{        \}}
\StringTok{      \}}
\StringTok{    \}}
\StringTok{  if(NR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{    id=$col\_id}
\StringTok{    \textbackslash{}}
\StringTok{    if(max\_id+0\textless{}id || max\_id=="")}
\StringTok{      \{}
\StringTok{      max\_id=id}
\StringTok{      \}}
\StringTok{    if(score[id]+0\textless{}$col\_score+0 || score[id]=="")}
\StringTok{      \{}
\StringTok{      score[id]=$col\_score}
\StringTok{      \textbackslash{}}
\StringTok{      data[id]=$0}
\StringTok{      \}}
\StringTok{    \}}
\StringTok{  \}}
\StringTok{  END\{}
\StringTok{    printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "formula}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "smiles}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchi}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchikey2D}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{    \textbackslash{}}
\StringTok{    "score}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "xlogp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "links}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/fingerid\_first\_score.tsv"}
\StringTok{    \textbackslash{}}
\StringTok{    for(i=1; i\textless{}=max\_id; i++)}
\StringTok{      \{}
\StringTok{      if(data[i]!="")}
\StringTok{        \{}
\StringTok{        printf data[i] "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/fingerid\_first\_score.tsv"}
\StringTok{        \}}
\StringTok{      \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data\_sum}
\NormalTok{echo }\StringTok{"structure\_extract results have been successfully assembled into \textless{}results/fingerid\_sum.tsv\textgreater{} and \textless{}results/fingerid\_first\_score.tsv\textgreater{}"}\NormalTok{;}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{classification\_extract\_sum}\ErrorTok{)}
\NormalTok{echo }\StringTok{"Run classification\_extract\_sum."}\NormalTok{;}
 \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{Mo\_filename ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f canopus.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f canopus\_neg.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f .format ]}
\NormalTok{ then}
\NormalTok{ echo }\StringTok{"Project path acknowledged."}
 \ControlFlowTok{else}
\NormalTok{   until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{canopus.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{   do}
\NormalTok{   read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{   done;}
\NormalTok{   cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{ fi;}
\NormalTok{data1}\OtherTok{=}\StringTok{"temp/Mo\_filename"}
\NormalTok{data2}\OtherTok{=}\StringTok{"canopus.tsv"}
\NormalTok{data3}\OtherTok{=}\StringTok{"canopus\_neg.tsv"}
\NormalTok{datas}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  \{}
\StringTok{  x=$2"/canopus/"$3".fpt"}
\StringTok{  if(getline \textless{} x == 1)}
\StringTok{    \{}
\StringTok{    printf x" "}
\StringTok{    \}}
\StringTok{  close(x)}
\StringTok{  \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1)}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  \{}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{    file[FNR]=$2}
\StringTok{    mo[$2]=$1}
\StringTok{    i=split($2,s,"[\_]")}
\StringTok{    the\_id[FNR]=s[i]}
\StringTok{    n=FNR}
\StringTok{    \}}
\StringTok{  if((FILENAME \textasciitilde{} /\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data2}\StringTok{\textquotesingle{}/))}
\StringTok{    \{}
\StringTok{    if(FNR==1)}
\StringTok{      \{}
\StringTok{      close("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data1}\StringTok{\textquotesingle{}")}
\StringTok{      printf "Info: data\_file name of \textquotesingle{}}\SpecialCharTok{$}\NormalTok{data1}\StringTok{\textquotesingle{} has been input.}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{      for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{        if(($i \textasciitilde{} /name/))}
\StringTok{          \{}
\StringTok{          col\_class=i}
\StringTok{          \}}
\StringTok{        if(($i \textasciitilde{} /absolute/))}
\StringTok{          \{}
\StringTok{          col\_abindex=i}
\StringTok{          \}}
\StringTok{        \}}
\StringTok{      \}}
\StringTok{    if(FNR\textgreater{}=2)}
\StringTok{      \{}
\StringTok{      abindex[1,FNR]=$col\_abindex}
\StringTok{      class[1,$col\_abindex]=$col\_class}
\StringTok{      rows\_data2=FNR}
\StringTok{      \}}
\StringTok{    \}}
\StringTok{  if((FILENAME \textasciitilde{} /\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data3}\StringTok{\textquotesingle{}/))}
\StringTok{    \{}
\StringTok{    if(FNR==1)}
\StringTok{      \{}
\StringTok{      close("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data2}\StringTok{\textquotesingle{}")}
\StringTok{      printf "Info: data\_file name of \textquotesingle{}}\SpecialCharTok{$}\NormalTok{data2}\StringTok{\textquotesingle{} has been input.}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{      for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{        if(($i \textasciitilde{} /name/))}
\StringTok{          \{}
\StringTok{          col\_class=i}
\StringTok{          \}}
\StringTok{        if(($i \textasciitilde{} /absolute/))}
\StringTok{          \{}
\StringTok{          col\_abindex=i}
\StringTok{          \}}
\StringTok{        \}}
\StringTok{      \}}
\StringTok{    if(FNR\textgreater{}=2)}
\StringTok{      \{}
\StringTok{      abindex[2,FNR]=$col\_abindex}
\StringTok{      class[2,$col\_abindex]=$col\_class}
\StringTok{      rows\_data3=FNR}
\StringTok{      \}}
\StringTok{    \}}
\StringTok{  if((FILENAME \textasciitilde{} /fpt/))}
\StringTok{    \{}
\StringTok{    if(FNR==1)}
\StringTok{      \{}
\StringTok{      if(p\_filename=="")}
\StringTok{        \{}
\StringTok{        close("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data3}\StringTok{\textquotesingle{}")}
\StringTok{        \}}
\StringTok{      else if(FILENAME!=p\_filename)}
\StringTok{        \{}
\StringTok{        close(p\_filename)}
\StringTok{        printf "Info: data\_file name of " p\_filename " has been input.}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{        \}}
\StringTok{      p\_filename=FILENAME}
\StringTok{      for(i=1; i\textless{}=n; i++)}
\StringTok{        \{}
\StringTok{        if((FILENAME \textasciitilde{} file[i]) \&\& (FILENAME \textasciitilde{} mo[file[i]]))}
\StringTok{          \{}
\StringTok{          break}
\StringTok{          \}}
\StringTok{        else}
\StringTok{          \{}
\StringTok{          x=i+1}
\StringTok{          \}}
\StringTok{        \}}
\StringTok{      if(x==n+1)}
\StringTok{        \{}
\StringTok{        nextfile}
\StringTok{        \}}
\StringTok{      split(FILENAME,a,"[/]");}
\StringTok{      m=split(a[1],b,"[\_]");}
\StringTok{      id=b[m];}
\StringTok{      if(FILENAME \textasciitilde{} /\textbackslash{}+.fpt/)}
\StringTok{        \{}
\StringTok{        ion=1}
\StringTok{        \}}
\StringTok{      if(FILENAME \textasciitilde{} /\textbackslash{}{-}.fpt/)}
\StringTok{        \{}
\StringTok{        ion=2}
\StringTok{        \}}
\StringTok{      pp[id,abindex[ion,2]]=$1}
\StringTok{      \}}
\StringTok{    if(FNR\textgreater{}=2)}
\StringTok{      \{}
\StringTok{      pp[id,abindex[ion,FNR+1]]=$1}
\StringTok{      \}}
\StringTok{    \}}
\StringTok{  \}}
\StringTok{  END\{}
\StringTok{    if(abindex[1,rows\_data2]+0 \textgreater{} abindex[2,rows\_data3]+0)}
\StringTok{      \{}
\StringTok{      maxindex=abindex[1,rows\_data2]}
\StringTok{      \}}
\StringTok{    else}
\StringTok{      \{}
\StringTok{      maxindex=abindex[2,rows\_data3]}
\StringTok{      \}}
\StringTok{    printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{} "results/canopus\_pp.tsv"}
\StringTok{    \textbackslash{}}
\StringTok{    for(i=0; i\textless{}=maxindex; i++)}
\StringTok{      \{}
\StringTok{      if(class[1,i]!="" \&\& i!=maxindex)}
\StringTok{        \{}
\StringTok{        printf class[1,i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{        \}}
\StringTok{      else if(class[2,i]!="" \&\& i!=maxindex)}
\StringTok{        \{}
\StringTok{        printf class[2,i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{        \}}
\StringTok{      else if(i==maxindex \&\& class[1,i]!="")}
\StringTok{        \{}
\StringTok{        printf class[1,i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{        \}}
\StringTok{      else if(i==maxindex \&\& class[2,i]!="")}
\StringTok{        \{}
\StringTok{        printf class[2,i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{        \}}
\StringTok{      \}}
\StringTok{    for(i=1; i\textless{}=n; i++)}
\StringTok{      \{}
\StringTok{      printf the\_id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{      for(j=0; j\textless{}=maxindex; j++)}
\StringTok{        \{}
\StringTok{        if(class[1,j]!="" \&\& j!=maxindex || class[2,j]!="" \&\& j!=maxindex)}
\StringTok{          \{}
\StringTok{          if(pp[the\_id[i],j]=="")}
\StringTok{            \{}
\StringTok{            printf 0"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{            \}}
\StringTok{          else}
\StringTok{            \{}
\StringTok{            printf pp[the\_id[i],j]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{            \}}
\StringTok{          \}}
\StringTok{        else if(class[1,j]!="" \&\& j==maxindex || class[2,j]!="" \&\& j==maxindex)}
\StringTok{          \{}
\StringTok{          if(pp[the\_id[i],j]=="")}
\StringTok{            \{}
\StringTok{            printf 0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{            \}}
\StringTok{          else}
\StringTok{            \{}
\StringTok{            printf pp[the\_id[i],j]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{            \}}
\StringTok{          \}}
\StringTok{        \}}
\StringTok{      \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3 }\SpecialCharTok{$}\NormalTok{datas}
\NormalTok{echo }\StringTok{"classification\_extract\_sum have been successfully written into \textless{}results/canopus\_pp.tsv\textgreater{}"}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{classification\_extract\_filter}\ErrorTok{)}
\NormalTok{echo }\StringTok{"Run classification\_extract\_filter."}\NormalTok{;}
 \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f results}\SpecialCharTok{/}\NormalTok{canopus\_pp.tsv ]}
\NormalTok{ then}
\NormalTok{ echo }\StringTok{"Project path acknowledged."}
 \ControlFlowTok{else}
\NormalTok{   until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{results}\SpecialCharTok{/}\NormalTok{canopus\_pp.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{results}\SpecialCharTok{/}\NormalTok{canopus\_summary.tsv ]}
\NormalTok{   do}
\NormalTok{   read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{   done;}
\NormalTok{   cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{ fi; }
\NormalTok{check}\OtherTok{=}\DecValTok{0}
\NormalTok{ until [[ }\StringTok{"$check"} \SpecialCharTok{==} \StringTok{"yes"}\NormalTok{ ]] }\SpecialCharTok{||}\NormalTok{ [[ }\StringTok{"$check"} \SpecialCharTok{==} \StringTok{"no"}\NormalTok{ ]]}
\NormalTok{ do}
\NormalTok{ read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Collate the posterior probabilities of the classification of each feature? [yes/no] \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ check;}
\NormalTok{ done;}
 \ControlFlowTok{if}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{check }\SpecialCharTok{==} \StringTok{"yes"}\NormalTok{ ]]}
\NormalTok{ then}
\NormalTok{ definition\_limit}\OtherTok{=}\DecValTok{0}
\NormalTok{   until [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textgreater{}} \StringTok{"0.01"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textless{}} \StringTok{"1"}\NormalTok{ ]]}
\NormalTok{   do}
\NormalTok{   read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the classes posterior probabilities limition. 0.5\textasciitilde{}0.99 may work well. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ definition\_limit;}
\NormalTok{   done;}
\NormalTok{ data1}\OtherTok{=}\StringTok{"canopus\_summary.tsv"}
\NormalTok{  data2}\OtherTok{=}\StringTok{"canopus.tsv"}
\NormalTok{  data3}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{   \{}
\StringTok{   if(NR==FNR)}
\StringTok{     \{}
\StringTok{     if(FNR==1)}
\StringTok{       \{}
\StringTok{       p\_file=FILENAME}
\StringTok{       \textbackslash{}}
\StringTok{       for(i=1; i\textless{}=NF; i++)}
\StringTok{         \{}
\StringTok{         if($i\textasciitilde{}/name/)}
\StringTok{           \{}
\StringTok{           col\_id=i}
\StringTok{           \}}
\StringTok{         if($i\textasciitilde{}/specific/)}
\StringTok{           \{}
\StringTok{           col\_specific=i}
\StringTok{           \}}
\StringTok{         if($i\textasciitilde{}/level/)}
\StringTok{           \{}
\StringTok{           col\_level=i}
\StringTok{           \}}
\StringTok{         if($i\textasciitilde{}/subclass/)}
\StringTok{           \{}
\StringTok{           col\_subclass=i}
\StringTok{           \}}
\StringTok{         if($i\textasciitilde{}/\^{}class/)}
\StringTok{           \{}
\StringTok{           col\_class=i}
\StringTok{           \}}
\StringTok{         if($i\textasciitilde{}/superclass/)}
\StringTok{           \{}
\StringTok{           col\_superclass=i}
\StringTok{           \}}
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     if(FNR\textgreater{}=2)}
\StringTok{       \{}
\StringTok{       n=split($col\_id,a,"[\_]")}
\StringTok{       \textbackslash{}}
\StringTok{       id=a[n]}
\StringTok{       \textbackslash{}}
\StringTok{       specific[id]=$col\_specific}
\StringTok{       \textbackslash{}}
\StringTok{       level[id]=$col\_level}
\StringTok{       \textbackslash{}}
\StringTok{       subclass[id]=$col\_subclass}
\StringTok{       \textbackslash{}}
\StringTok{       class[id]=$col\_class}
\StringTok{       \textbackslash{}}
\StringTok{       superclass[id]=$col\_superclass}
\StringTok{       \}}
\StringTok{     \}}
\StringTok{   if(FILENAME\textasciitilde{}/canopus.tsv/)}
\StringTok{     \{}
\StringTok{     if(FNR==1)}
\StringTok{       \{}
\StringTok{       close(p\_file)}
\StringTok{       \textbackslash{}}
\StringTok{       p\_file=FILENAME}
\StringTok{       \textbackslash{}}
\StringTok{       for(i=1; i\textless{}=NF; i++)}
\StringTok{         \{}
\StringTok{         if($i\textasciitilde{}/name/)}
\StringTok{           \{}
\StringTok{           col\_name=i}
\StringTok{           \}}
\StringTok{         if($i\textasciitilde{}/description/)}
\StringTok{           \{}
\StringTok{           col\_description=i}
\StringTok{           \}}
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     if(FNR\textgreater{}=2)}
\StringTok{       \{}
\StringTok{       description[$col\_name]=$col\_description}
\StringTok{       \}}
\StringTok{     \}}
\StringTok{   if(FILENAME\textasciitilde{}"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data3}\StringTok{\textquotesingle{}")}
\StringTok{     \{}
\StringTok{     if(FNR==1)}
\StringTok{       \{}
\StringTok{       close(p\_file)}
\StringTok{       \textbackslash{}}
\StringTok{       for(i=1; i\textless{}=NF; i++)}
\StringTok{         \{}
\StringTok{         if($i\textasciitilde{}/\^{}id$/)}
\StringTok{           \{}
\StringTok{           col\_id=i}
\StringTok{           \}}
\StringTok{         if(i\textgreater{}=2)}
\StringTok{           \{}
\StringTok{           col\_class\_name[i]=$i}
\StringTok{           \}}
\StringTok{         \}}
\StringTok{       printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition\_source}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition\_description}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{       \textbackslash{}}
\StringTok{       "specific}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "specific\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "level\_5}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "level\_5\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{       \textbackslash{}}
\StringTok{       "subclass}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "subclass\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "class}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "class\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "superclass}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "superclass\_pp}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textbackslash{}}
\StringTok{       \textbackslash{}}
\StringTok{       \textgreater{} "results/stat\_classification.tsv"}
\StringTok{       \}}
\StringTok{     if(FNR\textgreater{}=2)}
\StringTok{       \{}
\StringTok{       for(i=2; i\textless{}=NF; i++)}
\StringTok{         \{}
\StringTok{         c\_pp[col\_class\_name[i]]=sprintf("\%.4f",$i)}
\StringTok{         \}}
\StringTok{       if(level[$col\_id] != "" \&\& c\_pp[level[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{         \{}
\StringTok{         definition\_source="level\_5"}
\StringTok{         \textbackslash{}}
\StringTok{         definition=level[$col\_id]}
\StringTok{         \}}
\StringTok{       else if(subclass[$col\_id] != "" \&\& c\_pp[subclass[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{         \{}
\StringTok{         definition\_source="subclass"}
\StringTok{         \textbackslash{}}
\StringTok{         definition=subclass[$col\_id]}
\StringTok{         \}}
\StringTok{       else if(class[$col\_id] != "" \&\& c\_pp[class[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{         \{}
\StringTok{         definition\_source="class"}
\StringTok{         \textbackslash{}}
\StringTok{         definition=class[$col\_id]}
\StringTok{         \}}
\StringTok{       else if(superclass[$col\_id] != "" \&\& c\_pp[superclass[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{         \{}
\StringTok{         definition\_source="superclass"}
\StringTok{         \textbackslash{}}
\StringTok{         definition=superclass[$col\_id]}
\StringTok{         \}}
\StringTok{       else}
\StringTok{         \{}
\StringTok{         definition\_source="null"}
\StringTok{         \textbackslash{}}
\StringTok{         definition="null"}
\StringTok{         \textbackslash{}}
\StringTok{         c\_pp[definition]="null"}
\StringTok{         \textbackslash{}}
\StringTok{         description[definition]="null"}
\StringTok{         \}}
\StringTok{       printf $col\_id"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  definition\_source"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  definition"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[definition]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  description[definition]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{       \textbackslash{}}
\StringTok{       specific[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[specific[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  level[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[level[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{       \textbackslash{}}
\StringTok{       subclass[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[subclass[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  class[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[class[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{       \textbackslash{}}
\StringTok{       superclass[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[superclass[$col\_id]]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/stat\_classification.tsv"}
\StringTok{       \}}
\StringTok{     \}}
\StringTok{   \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\NormalTok{  echo }\StringTok{"classification\_extract\_filter have been successfully written into \textless{}results/stat\_classification.tsv\textgreater{}"}
\NormalTok{  fi;}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{fragment\_tree\_network}\ErrorTok{)}
\NormalTok{echo }\StringTok{"Run fragment\_tree\_network."}\NormalTok{;}
 \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{d temp ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f .format ]}
\NormalTok{ then}
\NormalTok{ echo }\StringTok{"Project path acknowledged."}
 \ControlFlowTok{else}
\NormalTok{   until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{   do}
\NormalTok{   read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project. Make sure you have moved the fragment tree alignment results to the directory where the project is located. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{   done;}
\NormalTok{   cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{ fi;}
\NormalTok{echo }\StringTok{"Please enter the minimum alignment similarity(tlimit) that you want to filter."}
\NormalTok{tlimit}\OtherTok{=}\DecValTok{0}
\NormalTok{ until [[ }\StringTok{"$tlimit"} \SpecialCharTok{\textgreater{}} \StringTok{"0.01"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$tlimit"} \SpecialCharTok{\textless{}} \StringTok{"0.99"}\NormalTok{ ]]}
\NormalTok{ do}
\NormalTok{ read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"0.4{-}0.7 is recommended \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ tlimit;}
\NormalTok{ done;}
  \ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{d temp}\SpecialCharTok{/}\NormalTok{ftaligntemp ]}
\NormalTok{ then }
\NormalTok{ mkdir temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}
\NormalTok{  fi;}
\NormalTok{data}\OtherTok{=}\StringTok{"ftalign.tsv"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/ftaligntemp/tmp"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  \{}
\StringTok{  printf "Info: NR = " NR ". FNR = " FNR ".}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{   for(i=1; i\textless{}=NF; i++)}
\StringTok{     \{}
\StringTok{     if(NR==1 \&\& i!=1 || NR!=1 \&\& i==1)}
\StringTok{       \{}
\StringTok{       n=split($i,x,"[\_]")}
\StringTok{       \textbackslash{}}
\StringTok{       raw[NR,i]=x[n]}
\StringTok{       \}}
\StringTok{     else}
\StringTok{       \{}
\StringTok{       if(NR==i)}
\StringTok{         \{}
\StringTok{         raw\_norm[NR,i]=$i}
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     \}}
\StringTok{   \}}
\StringTok{ if(NR\textgreater{}FNR \&\& FNR\textgreater{}=2)}
\StringTok{   \{}
\StringTok{   for(i=2; i\textless{}=NF; i++)}
\StringTok{     \{}
\StringTok{     norm1=$i/raw\_norm[i,i]}
\StringTok{     norm2=$i/raw\_norm[FNR,FNR]}
\StringTok{     norms=sprintf("\%.2f", ((norm1+norm2)/2))}
\StringTok{     if((norms+0 \textgreater{} \textquotesingle{}}\SpecialCharTok{$}\NormalTok{tlimit}\StringTok{\textquotesingle{}+0))}
\StringTok{       \{}
\StringTok{       if(raw[FNR,1]+0\textgreater{}=raw[1,i]+0)}
\StringTok{         \{}
\StringTok{         print raw[FNR,1], raw[1,i], norms \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{         \}}
\StringTok{       if(raw[FNR,1]+0\textless{}raw[1,i]+0)}
\StringTok{         \{}
\StringTok{         print raw[1,i], raw[FNR,1], norms \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     \}}
\StringTok{   \}}
\StringTok{  \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data }\SpecialCharTok{$}\NormalTok{data}
\NormalTok{sort }\SpecialCharTok{{-}}\NormalTok{u }\SpecialCharTok{$}\NormalTok{savepath }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{tmp2}
\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/ftaligntemp/filter\_net\_$tlimit"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{      if($1!=$2)}
\StringTok{        \{}
\StringTok{          replink[$1]=$1}
\StringTok{          replink[$2]=$2}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(NR!=FNR)}
\StringTok{    \{}
\StringTok{      if($1!=$2)}
\StringTok{        \{}
\StringTok{          printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" }
\StringTok{        \} }
\StringTok{      if($1==$2)}
\StringTok{        \{}
\StringTok{          if(replink[$1]=="")}
\StringTok{            \{}
\StringTok{              printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{tmp2 temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{tmp2}
\NormalTok{echo }\StringTok{"fragment\_tree\_network have been successfully written into \textless{}temp/ftaligntemp/filter\_net\_$tlimit\textgreater{}"}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{fragment\_tree\_network\_delta}\ErrorTok{)}
 \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{d temp ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f .format ]}
\NormalTok{ then}
\NormalTok{ echo }\StringTok{"Project path acknowledged."}
 \ControlFlowTok{else}
\NormalTok{   until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{   do}
\NormalTok{   read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{   done;}
\NormalTok{ cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{ fi;}
\NormalTok{echo }\StringTok{"The following module attempts to compute the differential fingerprints of connected clusters based on the molecular fingerprint results of sirius 4."}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{plimit}\OtherTok{=}\DecValTok{0}
\NormalTok{ until [[ }\StringTok{"$plimit"} \SpecialCharTok{\textgreater{}} \StringTok{"0.5"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$plimit"} \SpecialCharTok{\textless{}} \StringTok{"0.99"}\NormalTok{ ]]}
\NormalTok{ do}
\NormalTok{ read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"If the minimum alignment similarity is greater than 0.3, this step will automatic calculate the discrepancy fingerprint between alignment features(in beta). Please enter the minimum posterior probability of the molecular fingerprint(plimit\_1) to be filtered. 0.9{-}0.99 is recommended. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ plimit;}
\NormalTok{ done;}
\NormalTok{plimit2}\OtherTok{=}\DecValTok{0}
\NormalTok{ until [[ }\StringTok{"$plimit2"} \SpecialCharTok{\textgreater{}} \StringTok{"0.1"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$plimit2"} \SpecialCharTok{\textless{}} \StringTok{"$plimit"}\NormalTok{ ]]}
\NormalTok{ do}
\NormalTok{ read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"The minimum posterior probability of the molecular fingerprint(plimit\_2) to be controled. 0.1{-}0.5 may work well. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ plimit2;}
\NormalTok{ done;}
\NormalTok{tlimit}\OtherTok{=}\ErrorTok{$}\NormalTok{(ls temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{filter\_net\_}\SpecialCharTok{*} \ErrorTok{|}\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F \_ }\StringTok{\textquotesingle{}\{print $NF\}\textquotesingle{}}\NormalTok{)}
\NormalTok{check\_rep}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}END\{print NR\}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$tlimit"}\NormalTok{))}
 \ControlFlowTok{if}\NormalTok{ [[ }\StringTok{"$check\_rep"} \SpecialCharTok{\textgreater{}} \StringTok{"1"}\NormalTok{ ]]}
\NormalTok{ then}
\NormalTok{ tlimit}\OtherTok{=}\DecValTok{0}
\NormalTok{   until [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{filter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit ]}
\NormalTok{   do}
\NormalTok{   read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Plural and different fragment\_tree\_network files were found to exist locally. Please select a tlimit parameter you have utilized to run fragment\_tree\_network\_delta. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ tlimit;}
\NormalTok{   done;}
\NormalTok{ fi;}
 \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{refilter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit ]}
\NormalTok{ then rm temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{refilter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit}
\NormalTok{ fi;}
 \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{fpsample ]}
\NormalTok{ then rm temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{fpsample}
\NormalTok{ fi;}
\NormalTok{echo }\StringTok{"Running delta\_fingerprint computation..."}
\NormalTok{echo }\StringTok{"Aquiring data from sirius index..."}
\NormalTok{data1}\OtherTok{=}\StringTok{"*\_*/compound.info"}
\NormalTok{data2}\OtherTok{=}\StringTok{"temp/ftaligntemp/filter\_net\_$tlimit"}
\NormalTok{echo }\StringTok{"Run fragment\_tree\_network\_delta."}
\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/ms\_data\_$tlimit"}
\NormalTok{echo }\StringTok{"step 1: ms data"}
  \ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{savepath ]}
\NormalTok{  then}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\StringTok{"[}\SpecialCharTok{\textbackslash{}t}\StringTok{]||[:]||[\_]"} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{   BEGIN\{  }
\StringTok{     printf "..."}
\StringTok{     printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "m/z}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "rt}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{     \}}
\StringTok{   \{}
\StringTok{   if(FILENAME\textasciitilde{}/compound.info/)}
\StringTok{     \{}
\StringTok{     if(FNR==1)}
\StringTok{       \{}
\StringTok{       printf "Info: catch \textgreater{}\textgreater{}\textgreater{} "FILENAME"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{       \}}
\StringTok{     if($1=="name")}
\StringTok{       \{}
\StringTok{       i+=1;}
\StringTok{       id[i]=$NF;}
\StringTok{       n=split($NF,a,"[\_]")}
\StringTok{       printf a[n]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{       \}}
\StringTok{     if($1=="ionMass")}
\StringTok{       \{}
\StringTok{       mz[id[i]]=$NF}
\StringTok{       printf sprintf("\%.4f",$NF)"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{       \}}
\StringTok{     if($1=="ionType")}
\StringTok{       \{}
\StringTok{       type[id[i]]=$NF}
\StringTok{       \}}
\StringTok{     if($1=="rt")}
\StringTok{       \{}
\StringTok{       rt[id[i]]=$2;}
\StringTok{       printf sprintf("\%.2f",$2/60)"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{       \}}
\StringTok{     \}}
\StringTok{   if(FILENAME\textasciitilde{}/ftaligntemp/)}
\StringTok{     \{}
\StringTok{     \#source  target  ftalign  delta\_mz  delta\_rt  source\_iontype  target\_iontype;}
\StringTok{     if(FNR==1)}
\StringTok{       \{}
\StringTok{       printf "" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{       \}}
\StringTok{     print $1,$2,$3,sprintf("\%.3f",mz[$2]{-}mz[$1]),sprintf("\%.2f",rt[$2]{-}rt[$1]),type[$1],type[$2] \textbackslash{}}
\StringTok{     \textbackslash{}}
\StringTok{     \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{     \}}
\StringTok{   \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
\NormalTok{  fi;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{echo }\StringTok{"step 2: data path"}
\NormalTok{source\_file}\OtherTok{=}\StringTok{"temp/Mo\_filename"}
\NormalTok{data}\OtherTok{=}\StringTok{"temp/ms\_data\_$tlimit"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/datapath\_$tlimit"}
  \ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{savepath ]}
\NormalTok{  then}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{   \{}
\StringTok{   if(NR==FNR)}
\StringTok{     \{}
\StringTok{     n=split($2, a, "[\_]")}
\StringTok{     file[a[n]]=$2}
\StringTok{     formu\_type[a[n]]=$3}
\StringTok{     \}}
\StringTok{   if(NR!=FNR)}
\StringTok{     \{}
\StringTok{     \#\textless{}path\textgreater{}sourceFormula  \textless{}path\textgreater{}targetFormula}
\StringTok{     path1=file[$1]"/fingerprints/"formu\_type[$1]".fpt"}
\StringTok{     path2=file[$2]"/fingerprints/"formu\_type[$2]".fpt"}
\StringTok{     data[path1]=path1}
\StringTok{     data[path2]=path2}
\StringTok{     \}}
\StringTok{   \}}
\StringTok{   END\{}
\StringTok{     for(i in data)}
\StringTok{       \{}
\StringTok{       n+=1}
\StringTok{       print "Check file:",n}
\StringTok{       if(getline\textless{}i=={-}1)}
\StringTok{         \{}
\StringTok{         printf "Escape filename: " i "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{         \}}
\StringTok{       else}
\StringTok{         \{}
\StringTok{         printf i" " \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{         \}}
\StringTok{       close(i)}
\StringTok{       \}}
\StringTok{     print "Sum:",n}
\StringTok{     \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{source\_file }\SpecialCharTok{$}\NormalTok{data}
\NormalTok{   fi;}
\NormalTok{datapath}\OtherTok{=}\ErrorTok{$}\NormalTok{(cat temp}\SpecialCharTok{/}\NormalTok{datapath\_}\SpecialCharTok{$}\NormalTok{tlimit)}
\NormalTok{echo }\StringTok{"step 3: fingerprint"}
\NormalTok{data\_allfp}\OtherTok{=}\StringTok{"temp/data\_allfp\_$tlimit"}
  \ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{data\_allfp ]}
\NormalTok{  then}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{   BEGIN\{}
\StringTok{     n=0}
\StringTok{     \}}
\StringTok{   \{}
\StringTok{   if(FNR==1)}
\StringTok{     \{}
\StringTok{     if(n\textgreater{}1)}
\StringTok{       \{}
\StringTok{       close(file)}
\StringTok{       \}}
\StringTok{     file=FILENAME;}
\StringTok{     print "Get fingerprints: ",FILENAME}
\StringTok{     n+=1;}
\StringTok{     printf FILENAME"}\SpecialCharTok{\textbackslash{}n}\StringTok{"$0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data\_allfp}\StringTok{\textquotesingle{}"}
\StringTok{     \}}
\StringTok{   else}
\StringTok{     \{}
\StringTok{     print $0 \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data\_allfp}\StringTok{\textquotesingle{}"}
\StringTok{     \}}
\StringTok{   \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{datapath}
\NormalTok{  fi;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  \{}
\StringTok{  if(NR==1)}
\StringTok{    \{}
\StringTok{    for(i=1; i\textless{}=NF; i++)}
\StringTok{      \{}
\StringTok{      if($i\textasciitilde{}/absolute/)}
\StringTok{        \{}
\StringTok{        col\_index=i}
\StringTok{        \}}
\StringTok{      if($i\textasciitilde{}/description/)}
\StringTok{        \{}
\StringTok{        col\_description=i}
\StringTok{        \}}
\StringTok{      \}}
\StringTok{    \}}
\StringTok{  if(NR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{    print $col\_index,$col\_description}
\StringTok{    \}}
\StringTok{  \}\textquotesingle{}}\NormalTok{ csi\_fingerid.tsv }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{pos\_fingerprint\_index;}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  \{}
\StringTok{  if(NR==1)}
\StringTok{    \{}
\StringTok{    for(i=1; i\textless{}=NF; i++)}
\StringTok{      \{}
\StringTok{      if($i\textasciitilde{}/absolute/)}
\StringTok{        \{}
\StringTok{        col\_index=i}
\StringTok{        \}}
\StringTok{      if($i\textasciitilde{}/description/)}
\StringTok{        \{}
\StringTok{        col\_description=i}
\StringTok{        \}}
\StringTok{      \}}
\StringTok{    \}}
\StringTok{  if(NR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{    print $col\_index,$col\_description}
\StringTok{    \}}
\StringTok{  \}\textquotesingle{}}\NormalTok{ csi\_fingerid\_neg.tsv }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{neg\_fingerprint\_index;}
\NormalTok{posindex}\OtherTok{=}\StringTok{"temp/ftaligntemp/pos\_fingerprint\_index"}
\NormalTok{negindex}\OtherTok{=}\StringTok{"temp/ftaligntemp/neg\_fingerprint\_index"}
\NormalTok{data}\OtherTok{=}\StringTok{"temp/ms\_data\_$tlimit"}
\NormalTok{echo }\StringTok{"step 4: merge data"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  BEGIN\{}
\StringTok{    file=0}
\StringTok{    x=0}
\StringTok{    count=0}
\StringTok{    f=0}
\StringTok{    posnum=0}
\StringTok{    negnum=0}
\StringTok{    \}}
\StringTok{  \{}
\StringTok{  if(FNR==1)}
\StringTok{    \{}
\StringTok{    file+=1}
\StringTok{    \}}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{    if(($1\textasciitilde{}/fingerprint/))}
\StringTok{      \{}
\StringTok{      if(x+0\textgreater{}f+0)}
\StringTok{        \{}
\StringTok{        f=x  \# calculate the max index.}
\StringTok{        \}}
\StringTok{      count+=1;  \# calculate the all fingerprints file number.}
\StringTok{      \textbackslash{}}
\StringTok{      split($1,a,"[/]"); e=split(a[1],b,"[\_]"); id=b[e]; \#catch the id.}
\StringTok{      \textbackslash{}}
\StringTok{      x=0;}
\StringTok{      \}}
\StringTok{    else}
\StringTok{      \{}
\StringTok{      x+=1;}
\StringTok{      \textbackslash{}}
\StringTok{      fp[id,x]=$1;}
\StringTok{      \}}
\StringTok{    \}}
\StringTok{  if(file==2)}
\StringTok{    \{}
\StringTok{    pos[FNR]=$1}
\StringTok{    posnum+=1}
\StringTok{    \}}
\StringTok{  if(file==3)}
\StringTok{    \{}
\StringTok{    neg[FNR]=$1}
\StringTok{    negnum+=1}
\StringTok{    \}}
\StringTok{  if(file==4)}
\StringTok{    \{}
\StringTok{    if("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tlimit}\StringTok{\textquotesingle{}"+0 \textgreater{}= 0.3)}
\StringTok{      \{}
\StringTok{     if(fp[$1,1]!="" \&\& fp[$2,1]!="")}
\StringTok{       \{}
\StringTok{       n1=split($6, g, "[]]");}
\StringTok{       n2=split($7, h, "[]]");}
\StringTok{       if(g[n1]=="+" \&\& h[n2]=="+")}
\StringTok{         \{}
\StringTok{         for(x=1; x\textless{}=posnum; x++)}
\StringTok{           \{}
\StringTok{           if(fp[$1,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{             \{}
\StringTok{             data\_s[FNR,x]=pos[x]}
\StringTok{             \}}
\StringTok{           else if(fp[$2,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{             \{}
\StringTok{             data\_t[FNR,x]=pos[x]}
\StringTok{             \}}
\StringTok{           \}}
\StringTok{         \}}
\StringTok{       if(g[n1]=="{-}" \&\& h[n2]=="{-}")}
\StringTok{         \{}
\StringTok{         for(x=1; x\textless{}=negnum; x++)}
\StringTok{           \{}
\StringTok{           if(fp[$1,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{             \{}
\StringTok{             data\_s[FNR,x]=neg[x]}
\StringTok{             \}}
\StringTok{           else if(fp[$2,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{             \{}
\StringTok{             data\_t[FNR,x]=neg[x]}
\StringTok{             \}}
\StringTok{           \}}
\StringTok{         \}}
\StringTok{       if(g[n1]=="{-}" \&\& h[n2]=="+" || h[n2]=="{-}" \&\& g[n1]=="+")}
\StringTok{         \{}
\StringTok{         for(i=1; i\textless{}=posnum; i++)}
\StringTok{           \{}
\StringTok{           for(j=1; j\textless{}=negnum; j++)}
\StringTok{             \{}
\StringTok{             if(pos[i]==neg[j])}
\StringTok{               \{}
\StringTok{               mirror[i]=j  \#if pos=i, the identical index of neg is mirror[i]}
\StringTok{               \}}
\StringTok{             \}}
\StringTok{           \}}
\StringTok{         \}}
\StringTok{       if(g[n1]=="{-}" \&\& h[n2]=="+") }
\StringTok{         \{}
\StringTok{         for(x=1; x\textless{}=f; x++)}
\StringTok{           \{}
\StringTok{           if(fp[$1,mirror[x]]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{             \{}
\StringTok{             data\_s[FNR,x]=neg[mirror[x]]}
\StringTok{             \}}
\StringTok{           else if(fp[$2,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,mirror[x]]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{             \{}
\StringTok{             data\_t[FNR,x]=neg[mirror[x]]}
\StringTok{             \}}
\StringTok{           \}}
\StringTok{         \}}
\StringTok{       if(h[n2]=="{-}" \&\& g[n1]=="+")}
\StringTok{         \{}
\StringTok{         for(x=1; x\textless{}=f; x++)}
\StringTok{           \{}
\StringTok{           if(fp[$1,x]+0\textgreater{}= \textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,mirror[x]]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{             \{}
\StringTok{             data\_s[FNR,x]=neg[mirror[x]]}
\StringTok{             \}}
\StringTok{           else if(fp[$2,mirror[x]]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{             \{}
\StringTok{             data\_t[FNR,x]=neg[mirror[x]]}
\StringTok{             \}}
\StringTok{           \}   }
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     \}}
\StringTok{    if(FNR==1)}
\StringTok{      \{}
\StringTok{      printf "source}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "target}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "ftalign\_similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "delta\_m/z}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "source\_fp\_uniq}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "target\_fp\_uniq}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{      \}}
\StringTok{    else}
\StringTok{      \{}
\StringTok{      printf $1"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $2"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $3"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $4"}\SpecialCharTok{\textbackslash{}t}\StringTok{";}
\StringTok{      \textbackslash{}}
\StringTok{      if(\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tlimit}\StringTok{\textquotesingle{}+0 \textgreater{}= 0.3)}
\StringTok{        \{}
\StringTok{       if(fp[$1,1]=="" || fp[$2,1]=="")}
\StringTok{         \{}
\StringTok{         printf "NA@NA}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{         \}}
\StringTok{       else}
\StringTok{         \{}
\StringTok{         printf "source:"  \#the source fingerprint uniq.}
\StringTok{         \textbackslash{}}
\StringTok{         for(x=1; x\textless{}=f; x++)}
\StringTok{           \{}
\StringTok{           if(data\_s[FNR,x]!="")}
\StringTok{             \{}
\StringTok{             printf data\_s[FNR,x]","}
\StringTok{             \}}
\StringTok{           \};}
\StringTok{         printf "@target:"  \#the target fingerprint uniq.}
\StringTok{         \textbackslash{}}
\StringTok{         for(x=1; x\textless{}=f; x++)}
\StringTok{           \{}
\StringTok{           if(data\_t[FNR,x]!="")}
\StringTok{             \{}
\StringTok{             printf data\_t[FNR,x]","}
\StringTok{             \}}
\StringTok{           \}}
\StringTok{         printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     else}
\StringTok{       \{}
\StringTok{       printf "NA@NA}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{       \}}
\StringTok{      \}}
\StringTok{    \}}
\StringTok{  \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data\_allfp }\SpecialCharTok{$}\NormalTok{posindex }\SpecialCharTok{$}\NormalTok{negindex }\SpecialCharTok{$}\NormalTok{data }\SpecialCharTok{|}\NormalTok{ sed }\SpecialCharTok{{-}}\NormalTok{e }\StringTok{\textquotesingle{}s/,@/}\SpecialCharTok{\textbackslash{}t}\StringTok{/g; s/,$//g; s/@/}\SpecialCharTok{\textbackslash{}t}\StringTok{/g\textquotesingle{}}\NormalTok{ \textbackslash{}}
\NormalTok{  \textbackslash{}}
  \SpecialCharTok{\textgreater{}}\NormalTok{ results}\SpecialCharTok{/}\NormalTok{source\_target\_tree\_}\SpecialCharTok{$}\NormalTok{tlimit.tsv;}
\NormalTok{echo }\StringTok{"All instances have written into \textless{}results/source\_target\_tree\_$tlimit.tsv\textgreater{}."}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{echo }\StringTok{"step 5: separate child{-}nebula from parent{-}nebula."}
\NormalTok{data}\OtherTok{=}\StringTok{"results/stat\_classification.tsv"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/filter\_0\_class.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  \{}
\StringTok{  if(FNR==1)}
\StringTok{    \{}
\StringTok{    for(i=1; i\textless{}=NF; i++)}
\StringTok{      \{}
\StringTok{      if($i\textasciitilde{}/\^{}definition$/)}
\StringTok{        \{}
\StringTok{        col\_class=i}
\StringTok{        \}}
\StringTok{      \}}
\StringTok{    \}}
\StringTok{  if(FNR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{    class[$col\_class]=$col\_class}
\StringTok{    \}}
\StringTok{  \}}
\StringTok{  END\{}
\StringTok{   for(i in class)}
\StringTok{      \{}
\StringTok{      printf class[i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{      \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ data1}\OtherTok{=}\StringTok{"temp/filter\_0\_class.tsv"} 
\NormalTok{ data2}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\NormalTok{ data3}\OtherTok{=}\StringTok{"results/fingerid\_first\_score.tsv"}
\NormalTok{ until [[ }\StringTok{"$similarity\_limit"} \SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$similarity\_limit"} \SpecialCharTok{\textless{}} \DecValTok{1}\NormalTok{ ]]}
\NormalTok{ do}
\NormalTok{ read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please set the Tanimoto similarity threshold contribute to child{-}nebula. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ similarity\_limit;}
\NormalTok{ done;}
\NormalTok{  until [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textgreater{}} \FloatTok{0.01}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textless{}} \DecValTok{1}\NormalTok{ ]]}
\NormalTok{  do}
\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the classes posterior probabilities limition. 0.5\textasciitilde{}0.99 may work well. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ definition\_limit;}
\NormalTok{  done;}
\NormalTok{ class\_pp\_limit}\OtherTok{=}\ErrorTok{$}\NormalTok{definition\_limit}
\NormalTok{ savepath}\OtherTok{=}\StringTok{"temp/idenfication\_filter\_$class\_pp\_limit.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{   \{}
\StringTok{   if(NR==FNR)}
\StringTok{     \{}
\StringTok{     filter\_class[$1]=$1}
\StringTok{     \}}
\StringTok{   if(FILENAME\textasciitilde{}/canopus/)}
\StringTok{     \{}
\StringTok{     if(FNR==1)}
\StringTok{       \{}
\StringTok{       col\_id=1}
\StringTok{       for(i=2; i\textless{}=NF; i++)}
\StringTok{         \{}
\StringTok{         for(j in filter\_class)}
\StringTok{           \{}
\StringTok{           if(j==$i)}
\StringTok{             \{}
\StringTok{             col\_class[j]=i}
\StringTok{             print i}
\StringTok{             \}}
\StringTok{           \}}
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     if(FNR\textgreater{}=2)}
\StringTok{       \{}
\StringTok{       for(i in col\_class)}
\StringTok{         \{}
\StringTok{         if(sprintf("\%.3f",$col\_class[i])+0\textgreater{}="\textquotesingle{}}\SpecialCharTok{$}\NormalTok{class\_pp\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{           \{}
\StringTok{           class\_set[i,$col\_id]=i}
\StringTok{           print "ID: ",$1,i,$col\_class[i]}
\StringTok{           \}}
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     \}}
\StringTok{   if(FILENAME\textasciitilde{}/fingerid\_first\_score/)}
\StringTok{     \{}
\StringTok{     if(FNR==1)}
\StringTok{       \{}
\StringTok{       for(i=1; i\textless{}=NF; i++)}
\StringTok{         \{}
\StringTok{         if($i\textasciitilde{}/\^{}id/)}
\StringTok{         \{}
\StringTok{         col\_id=i}
\StringTok{         \}}
\StringTok{       if($i\textasciitilde{}/similarity/)}
\StringTok{         \{}
\StringTok{         col\_similarity=i}
\StringTok{         \}}
\StringTok{         \}}
\StringTok{       printf "class\_nebula\_facet}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{       \}}
\StringTok{     if(FNR\textgreater{}=2)}
\StringTok{       \{}
\StringTok{       if($col\_similarity+0 \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{similarity\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{         \{}
\StringTok{        for(i in class\_set)}
\StringTok{          \{}
\StringTok{          if(i\textasciitilde{}"}\SpecialCharTok{\textbackslash{}034}\StringTok{"$col\_id"$")}
\StringTok{            \{}
\StringTok{            printf class\_set[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{          \}}
\StringTok{        \}}
\StringTok{       \}}
\StringTok{     \}}
\StringTok{   \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ data}\OtherTok{=}\StringTok{"temp/idenfication\_filter\_$class\_pp\_limit.tsv"}
\NormalTok{ savepath}\OtherTok{=}\StringTok{"temp/idenfication\_filter2\_$\{class\_pp\_limit\}.tsv"}
\NormalTok{  until [[ }\StringTok{"$num\_limit\_1"} \SpecialCharTok{{-}}\NormalTok{gt }\DecValTok{0}\NormalTok{ ]]}
\NormalTok{  do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the features number threshold contribute to child{-}nebula (min number). \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ num\_limit\_1;}
\NormalTok{  done;}
\NormalTok{  until [[ }\StringTok{"$num\_limit\_2"} \SpecialCharTok{{-}}\NormalTok{gt }\StringTok{"$num\_limit\_1"}\NormalTok{ ]]}
\NormalTok{  do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the features number threshold contribute to child{-}nebula (max number). \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ num\_limit\_2;}
\NormalTok{  done;}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{   \{}
\StringTok{   if(FNR==1)}
\StringTok{     \{}
\StringTok{     printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{     for(i=1; i\textless{}=NF; i++)}
\StringTok{       \{}
\StringTok{       if($i\textasciitilde{}/class\_nebula\_facet/)}
\StringTok{         \{}
\StringTok{         col\_class=i}
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     \}}
\StringTok{ if(FNR\textgreater{}=2)}
\StringTok{   \{}
\StringTok{   num[$col\_class]+=1}
\StringTok{   data[FNR]=$0}
\StringTok{     class[FNR]=$col\_class}
\StringTok{   \}}
\StringTok{  \}}
\StringTok{   END\{}
\StringTok{     for(i in num)}
\StringTok{       \{}
\StringTok{       if(num[i]+0 \textgreater{}= \textquotesingle{}}\SpecialCharTok{$}\NormalTok{num\_limit\_1}\StringTok{\textquotesingle{}+0 \&\& num[i]+0 \textless{}= \textquotesingle{}}\SpecialCharTok{$}\NormalTok{num\_limit\_2}\StringTok{\textquotesingle{})}
\StringTok{         \{}
\StringTok{         printf "The nodes number of the child{-}nebula is " num[i] ".}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{         for(j in class)}
\StringTok{           \{}
\StringTok{           if(class[j]==i)}
\StringTok{             \{}
\StringTok{             printf data[j]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{             \}}
\StringTok{           \}}
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ mkdir results}\SpecialCharTok{/}\NormalTok{network\_facet\_}\SpecialCharTok{$}\NormalTok{class\_pp\_limit}
\NormalTok{ data1}\OtherTok{=}\StringTok{"temp/idenfication\_filter2\_$\{class\_pp\_limit\}.tsv"}
\NormalTok{ data2}\OtherTok{=}\StringTok{"results/source\_target\_tree\_$tlimit.tsv"} \CommentTok{\# "results/source\_target\_tree\_0.4.tsv"}
\NormalTok{ save\_class}\OtherTok{=}\StringTok{"results/filter\_child\_class.tsv"}
\NormalTok{ savepath}\OtherTok{=}\StringTok{"results/network\_facet\_$class\_pp\_limit/"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{   \{}
\StringTok{   if(NR==FNR)}
\StringTok{     \{}
\StringTok{     if(FNR==1)}
\StringTok{       \{}
\StringTok{       for(i=1; i\textless{}=NF; i++)}
\StringTok{         \{}
\StringTok{         if($i\textasciitilde{}/class\_nebula\_facet/)}
\StringTok{           \{}
\StringTok{           col\_class=i}
\StringTok{           \}}
\StringTok{         if($i\textasciitilde{}/\^{}id$/)}
\StringTok{           \{}
\StringTok{           col\_id=i}
\StringTok{           \}}
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     if(FNR\textgreater{}=2)}
\StringTok{       \{}
\StringTok{       class[$col\_class]=$col\_class}
\StringTok{       class\_id[$col\_class,$col\_id]=$col\_id}
\StringTok{       stat\_id[$col\_class,$col\_id]=$col\_id}
\StringTok{       belong[$col\_class,$col\_id]=$col\_class}
\StringTok{       \}}
\StringTok{     \}}
\StringTok{   if(NR\textgreater{}FNR)}
\StringTok{     \{}
\StringTok{     if(FNR==1)}
\StringTok{       \{}
\StringTok{       for(i in class)}
\StringTok{         \{}
\StringTok{         printf i"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{save\_class}\StringTok{\textquotesingle{}"}
\StringTok{         printf $0"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "facet}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" i ".tsv"}
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     if(FNR\textgreater{}=2)}
\StringTok{       \{}
\StringTok{       for(i in class)}
\StringTok{         \{}
\StringTok{         if( class\_id[i,$1]==$1 \&\& class\_id[i,$2]==$2 )}
\StringTok{           \{}
\StringTok{           printf $0"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  i"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" i ".tsv"}
\StringTok{           delete stat\_id[i,$1]}
\StringTok{           delete stat\_id[i,$2]}
\StringTok{           \}}
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     \}}
\StringTok{   \}}
\StringTok{   END\{}
\StringTok{     for(i in stat\_id)}
\StringTok{       \{}
\StringTok{       \#\# source target similarity delta\_mz fp fp class}
\StringTok{       printf stat\_id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" stat\_id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "1}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "0}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "null}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "null}\SpecialCharTok{\textbackslash{}t}\StringTok{"  belong[i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textbackslash{}}
\StringTok{       \textbackslash{}}
\StringTok{       \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" belong[i] ".tsv"}
\StringTok{       \}}
\StringTok{     \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ data1}\OtherTok{=}\StringTok{"canopus.tsv"}
\NormalTok{ data2}\OtherTok{=}\StringTok{"results/filter\_child\_class.tsv"}
\NormalTok{ data3}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\NormalTok{ savepath}\OtherTok{=}\StringTok{"results/canopus\_pp\_filter.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(FILENAME\textasciitilde{}/canopus.tsv/)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/absolute/)}
\StringTok{                    \{}
\StringTok{                    col\_index=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/\^{}id/)}
\StringTok{                    \{}
\StringTok{                    col\_chemid=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/name/)}
\StringTok{                    \{}
\StringTok{                    col\_name=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/description/)}
\StringTok{                    \{}
\StringTok{                    col\_des=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}2)}
\StringTok{            \{}
\StringTok{            ab\_index[$col\_name]=$col\_index}
\StringTok{            chemid[$col\_name]=$col\_chemid}
\StringTok{            des[$col\_name]=$col\_des}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FILENAME\textasciitilde{}/filter\_child\_class/)}
\StringTok{        \{}
\StringTok{        class[$1]=$1}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            printf "index}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "chem\_id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "description}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/child\_class.tsv"}
\StringTok{            \}}
\StringTok{        printf ab\_index[$1]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  chemid[$1]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $1"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  des[$1]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/child\_class.tsv"}
\StringTok{        \}}
\StringTok{    if(FILENAME\textasciitilde{}/canopus\_pp/)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            printf $1 \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            for(i=2; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if(class[$i]!="")}
\StringTok{                    \{}
\StringTok{                    n+=1}
\StringTok{                    printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{C"ab\_index[$i] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                    col\_set[n]=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            printf $1 \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            for(i=1; i\textless{}=n; i++)}
\StringTok{                \{}
\StringTok{                printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"$col\_set[i] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                \}}
\StringTok{            printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{compound\_idenfication}\ErrorTok{)}
\NormalTok{echo }\StringTok{"Run compound\_idenfication."}
\NormalTok{echo }\StringTok{"compound\_idenfication "}
\NormalTok{exit}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{double\_ion\_network}\ErrorTok{)}
\NormalTok{exit;}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{exit}\ErrorTok{)}
\NormalTok{echo }\StringTok{"The mystery of creation is like the darkness of night{-}{-}it is great.}
\StringTok{Delusions of knowledge are like the fog of the morning."}
\NormalTok{exit;}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{*}\ErrorTok{)}
\NormalTok{echo }\StringTok{"error"}
\NormalTok{exit;}
\NormalTok{;;}
\NormalTok{esac;}
\NormalTok{done;}\CommentTok{\#(for)}
\NormalTok{done;}\CommentTok{\#(select)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-mcnebula1126.sh}{%
\section{File: mcnebula1126.sh}\label{file-mcnebula1126.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{echo }\StringTok{"We are all in the gutter, }
\StringTok{but some of us are looking at the stars."}\NormalTok{;}
\NormalTok{PS3}\OtherTok{=}\StringTok{\textquotesingle{}Please select the workflow to be executed. \textgreater{}\textgreater{}\textgreater{} \textquotesingle{}}
\NormalTok{select command }\ControlFlowTok{in}\NormalTok{ \textbackslash{}}
\NormalTok{   \textbackslash{}}
  \StringTok{"default"}\NormalTok{ \textbackslash{}}
\NormalTok{  \textbackslash{}}
  \StringTok{"structure\_extract"}\NormalTok{ \textbackslash{}}
\NormalTok{  \textbackslash{}}
  \StringTok{"classification\_extract\_sum"}\NormalTok{ \textbackslash{}}
\NormalTok{  \textbackslash{}}
  \StringTok{"classification\_extract\_filter"}\NormalTok{ \textbackslash{}}
\NormalTok{  \textbackslash{}}
  \StringTok{"fragment\_tree\_network"}\NormalTok{ \textbackslash{}}
\NormalTok{  \textbackslash{}}
  \StringTok{"fragment\_tree\_network\_delta"}\NormalTok{ \textbackslash{}}
\NormalTok{  \textbackslash{}}
  \StringTok{"compound\_idenfication"}\NormalTok{ \textbackslash{}}
\NormalTok{  \textbackslash{}}
  \StringTok{"double\_ion\_network"}\NormalTok{ \textbackslash{}}
\NormalTok{  \textbackslash{}}
  \StringTok{"exit"} 
\NormalTok{do}
 \ControlFlowTok{if}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{command }\SpecialCharTok{==} \StringTok{"default"}\NormalTok{ ]]}
\NormalTok{ then}
\NormalTok{ confirm}\OtherTok{=}\DecValTok{0}
\NormalTok{   until [[ }\SpecialCharTok{$}\NormalTok{confirm }\SpecialCharTok{==} \StringTok{"yes"}\NormalTok{ ]] }\SpecialCharTok{||}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{confirm }\SpecialCharTok{==} \StringTok{"no"}\NormalTok{ ]]}
\NormalTok{   do}
\NormalTok{   read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Running all proccesses sequentially? [yes/no] \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ confirm}
\NormalTok{   done;}
   \ControlFlowTok{if}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{confirm }\SpecialCharTok{==} \StringTok{"no"}\NormalTok{ ]]}
\NormalTok{   then exit}
\NormalTok{   fi;}
\NormalTok{ default}\OtherTok{=}\StringTok{"structure\_extract classification\_extract\_sum classification\_extract\_filter fragment\_tree\_network fragment\_tree\_network\_delta"}
\NormalTok{ list}\OtherTok{=}\ErrorTok{$}\NormalTok{(echo }\SpecialCharTok{$}\NormalTok{default);}
 \ControlFlowTok{else}\NormalTok{ list}\OtherTok{=}\ErrorTok{$}\NormalTok{( echo }\SpecialCharTok{$}\NormalTok{command)}
\NormalTok{ fi;}
 \ControlFlowTok{for}\NormalTok{ option }\ControlFlowTok{in} \SpecialCharTok{$}\NormalTok{(echo }\SpecialCharTok{$}\NormalTok{list)}
\NormalTok{ do}
\NormalTok{   case }\SpecialCharTok{$}\NormalTok{option }\ControlFlowTok{in}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{structure\_extract}\ErrorTok{)}
\NormalTok{echo }\StringTok{"Run structure\_extract."}
\NormalTok{projectpath}\OtherTok{=}\DecValTok{0}
\NormalTok{ until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{canopus\_summary.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{ do}
\NormalTok{ read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{ done;}
\NormalTok{cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{mkdir results;}
\NormalTok{mkdir temp;}
\NormalTok{mkdir temp}\SpecialCharTok{/}\NormalTok{fintemp;}
 \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{Mo\_filename ]}
\NormalTok{ then rm temp}\SpecialCharTok{/}\NormalTok{Mo\_filename}
\NormalTok{ fi;}
\NormalTok{data}\OtherTok{=}\StringTok{"*\_*/fingerid/*.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  BEGIN\{}
\StringTok{    all\_id=0}
\StringTok{    \textbackslash{}}
\StringTok{    max\_id={-}1}
\StringTok{    \textbackslash{}}
\StringTok{    p\_id="null"}
\StringTok{    \textbackslash{}}
\StringTok{    printf "Info: loading the data..."}
\StringTok{    \}}
\StringTok{  \{}
\StringTok{  if(FNR==1)}
\StringTok{    \{}
\StringTok{    if(NR\textgreater{}FNR)}
\StringTok{      \{}
\StringTok{      close(pfile)}
\StringTok{      \}}
\StringTok{    f=split(FILENAME,a,"[/]");}
\StringTok{    n=split(a[1],b,"[\_]");}
\StringTok{    id=b[n];}
\StringTok{    if(id!=p\_id)}
\StringTok{      \{}
\StringTok{      all\_id+=1}
\StringTok{      \textbackslash{}}
\StringTok{      if(id\textgreater{}max\_id)}
\StringTok{        \{}
\StringTok{        max\_id=id}
\StringTok{        \}}
\StringTok{      \}}
\StringTok{    file[id]=a[1]}
\StringTok{    split(a[f], g, "[.]")}
\StringTok{    formu\_type[id]=g[1]}
\StringTok{    if(all\_id==1)}
\StringTok{      \{}
\StringTok{      for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{        if(($i\textasciitilde{}/inchikey2D/))}
\StringTok{          \{}
\StringTok{          col\_2D=i}
\StringTok{          \}}
\StringTok{        if($i=="inchi")}
\StringTok{          \{}
\StringTok{          col\_inchi=i}
\StringTok{          \}}
\StringTok{        if(($i\textasciitilde{}/Formula/))}
\StringTok{          \{}
\StringTok{          col\_formu=i}
\StringTok{          \}}
\StringTok{        if($i=="score")}
\StringTok{          \{}
\StringTok{          col\_score=i}
\StringTok{          \}}
\StringTok{        if($i=="name")}
\StringTok{          \{}
\StringTok{          col\_name=i}
\StringTok{          \}}
\StringTok{        if($i=="smiles")}
\StringTok{          \{}
\StringTok{          col\_smiles=i}
\StringTok{          \}}
\StringTok{        if($i=="xlogp")}
\StringTok{          \{}
\StringTok{          col\_x=i}
\StringTok{          \}}
\StringTok{        if(($i\textasciitilde{}/imilarity/))}
\StringTok{          \{}
\StringTok{          col\_simi=i}
\StringTok{          \}}
\StringTok{        if($i\textasciitilde{}/links/)}
\StringTok{          \{}
\StringTok{          col\_links=i}
\StringTok{          \}}
\StringTok{        \}}
\StringTok{      \}}
\StringTok{    pfile=FILENAME}
\StringTok{    printf g[1]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"formu\_type[id]"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{    printf "Info: the data of " id " (ID) has input. The filename is " FILENAME ".}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{    \}}
\StringTok{  if(FNR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{    row\_score=$col\_score}
\StringTok{    row\_simi=$col\_simi}
\StringTok{    if(max["score",id]=="" || max["score",id]+0\textless{}row\_score+0)}
\StringTok{     \{}
\StringTok{      max["score",id]=row\_score}
\StringTok{      name["score",id]=$col\_name}
\StringTok{      formula["score",id]=$col\_formu}
\StringTok{      formu\_type["score",id]=formu\_type[id]}
\StringTok{      simi["score",id]=$col\_simi}
\StringTok{      smiles["score",id]=$col\_smiles}
\StringTok{      inchi["score",id]=$col\_inchi}
\StringTok{      in2D["score",id]=$col\_2D}
\StringTok{      score["score",id]=$col\_score}
\StringTok{      xlogp["score",id]=$col\_x}
\StringTok{      links["score",id]=$col\_links}
\StringTok{      \}}
\StringTok{    if(max["simi",id]=="" || max["simi",id]+0\textless{}row\_simi+0)}
\StringTok{     \{}
\StringTok{      max["simi",id]=row\_simi}
\StringTok{      name["simi",id]=$col\_name}
\StringTok{      formula["simi",id]=$col\_formu}
\StringTok{      formu\_type["simi",id]=formu\_type[id]}
\StringTok{      simi["simi",id]=$col\_simi}
\StringTok{      smiles["simi",id]=$col\_smiles}
\StringTok{      inchi["simi",id]=$col\_inchi}
\StringTok{      in2D["simi",id]=$col\_2D}
\StringTok{      score["simi",id]=$col\_score}
\StringTok{      xlogp["simi",id]=$col\_x}
\StringTok{      links["simi",id]=$col\_links}
\StringTok{      \}}
\StringTok{    \}}
\StringTok{  \}}
\StringTok{  END\{}
\StringTok{    printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "formula}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "smiles}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchi}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchikey2D}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{    "score}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "xlogp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "links}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/fingerid\_sum.tsv"}
\StringTok{    for(l in file)}
\StringTok{      \{}
\StringTok{      if(max["score",l]!="")}
\StringTok{        \{}
\StringTok{        printf l"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        name["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  formula["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  simi["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        smiles["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  inchi["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  in2D["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        score["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  xlogp["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  links["score",l]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/fingerid\_sum.tsv"}
\StringTok{        printf formula["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  file[l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  formu\_type["score",l]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "temp/Mo\_filename"}
\StringTok{        \}}
\StringTok{      if(max["simi",l]!="" \&\& max["simi",l]!=max["score",l])}
\StringTok{        \{}
\StringTok{        printf l"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        name["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  formula["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  simi["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        smiles["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  inchi["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  in2D["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        score["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  xlogp["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  links["simi",l]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/fingerid\_sum.tsv"}
\StringTok{        \}}
\StringTok{      \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\NormalTok{data\_sum}\OtherTok{=}\StringTok{"results/fingerid\_sum.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  \{}
\StringTok{  if(NR==1)}
\StringTok{    \{}
\StringTok{    for(i=1; i\textless{}=NF; i++)}
\StringTok{      \{}
\StringTok{      if($i\textasciitilde{}/id/)}
\StringTok{        \{}
\StringTok{        col\_id=i}
\StringTok{        \}}
\StringTok{      if($i\textasciitilde{}/score/)}
\StringTok{        \{}
\StringTok{        col\_score=i}
\StringTok{        \}}
\StringTok{      \}}
\StringTok{    \}}
\StringTok{  if(NR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{    id=$col\_id}
\StringTok{    \textbackslash{}}
\StringTok{    if(max\_id+0\textless{}id || max\_id=="")}
\StringTok{      \{}
\StringTok{      max\_id=id}
\StringTok{      \}}
\StringTok{    if(score[id]+0\textless{}$col\_score+0 || score[id]=="")}
\StringTok{      \{}
\StringTok{      score[id]=$col\_score}
\StringTok{      \textbackslash{}}
\StringTok{      data[id]=$0}
\StringTok{      \}}
\StringTok{    \}}
\StringTok{  \}}
\StringTok{  END\{}
\StringTok{    printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "formula}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "smiles}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchi}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchikey2D}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{    \textbackslash{}}
\StringTok{    "score}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "xlogp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "links}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/fingerid\_first\_score.tsv"}
\StringTok{    \textbackslash{}}
\StringTok{    for(i=1; i\textless{}=max\_id; i++)}
\StringTok{      \{}
\StringTok{      if(data[i]!="")}
\StringTok{        \{}
\StringTok{        printf data[i] "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/fingerid\_first\_score.tsv"}
\StringTok{        \}}
\StringTok{      \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data\_sum}
\NormalTok{echo }\StringTok{"structure\_extract results have been successfully assembled into \textless{}results/fingerid\_sum.tsv\textgreater{} and \textless{}results/fingerid\_first\_score.tsv\textgreater{}"}\NormalTok{;}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{classification\_extract\_sum}\ErrorTok{)}
\NormalTok{echo }\StringTok{"Run classification\_extract\_sum."}\NormalTok{;}
 \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{Mo\_filename ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f canopus.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f canopus\_neg.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f .format ]}
\NormalTok{ then}
\NormalTok{ echo }\StringTok{"Project path acknowledged."}
 \ControlFlowTok{else}
\NormalTok{   until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{canopus.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{   do}
\NormalTok{   read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{   done;}
\NormalTok{   cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{ fi;}
\NormalTok{data1}\OtherTok{=}\StringTok{"temp/Mo\_filename"}
\NormalTok{data2}\OtherTok{=}\StringTok{"canopus.tsv"}
\NormalTok{data3}\OtherTok{=}\StringTok{"canopus\_neg.tsv"}
\NormalTok{datas}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  \{}
\StringTok{  x=$2"/canopus/"$3".fpt"}
\StringTok{  if(getline \textless{} x == 1)}
\StringTok{    \{}
\StringTok{    printf x" "}
\StringTok{    \}}
\StringTok{  close(x)}
\StringTok{  \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{      i=split($2,s,"[\_]")}
\StringTok{      the\_id[FNR]=s[i]}
\StringTok{      n=FNR}
\StringTok{    \}}
\StringTok{  if(FILENAME \textasciitilde{} /canopus.tsv/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if($i \textasciitilde{} /\^{}name/)}
\StringTok{                \{}
\StringTok{                  col\_class=i}
\StringTok{                \}}
\StringTok{              if($i \textasciitilde{} /absolute/)}
\StringTok{                \{}
\StringTok{                  col\_abindex=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          abindex[1,FNR]=$col\_abindex}
\StringTok{          indexset[$col\_abindex]=$col\_class}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FILENAME \textasciitilde{} /canopus\_neg.tsv/)}
\StringTok{    \{}
\StringTok{      p\_filename=FILENAME}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if($i \textasciitilde{} /name/)}
\StringTok{                \{}
\StringTok{                  col\_class=i}
\StringTok{                \}}
\StringTok{              if($i \textasciitilde{} /absolute/)}
\StringTok{                \{}
\StringTok{                  col\_abindex=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          abindex[2,FNR]=$col\_abindex}
\StringTok{          indexset[$col\_abindex]=$col\_class}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FILENAME \textasciitilde{} /.fpt/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          close(p\_filename)}
\StringTok{          printf "Info: data\_file name of " p\_filename " has been input.}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{          p\_filename=FILENAME}
\StringTok{          split(FILENAME,a,"[/]");}
\StringTok{          m=split(a[1],b,"[\_]");}
\StringTok{          id=b[m];}
\StringTok{          if(FILENAME \textasciitilde{} /\textbackslash{}+.fpt/)}
\StringTok{            \{}
\StringTok{              ion=1}
\StringTok{            \}}
\StringTok{          if(FILENAME \textasciitilde{} /\textbackslash{}{-}.fpt/)}
\StringTok{            \{}
\StringTok{              ion=2}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      pp[id,abindex[ion,FNR+1]]=sprintf("\%.3f",$1)}
\StringTok{    \}}
\StringTok{\}}
\StringTok{END\{}
\StringTok{printf "id" \textgreater{} "results/canopus\_pp.tsv"}
\StringTok{for(i in indexset)}
\StringTok{  \{}
\StringTok{    ord+=1}
\StringTok{    orderlist[ord]=i}
\StringTok{    printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"indexset[i] \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{  \}}
\StringTok{printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{for(i=1; i\textless{}=n; i++)}
\StringTok{  \{}
\StringTok{    printf the\_id[i] \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{    for(j=1; j\textless{}=ord; j++)}
\StringTok{      \{}
\StringTok{        if(pp[the\_id[i],orderlist[j]]=="")}
\StringTok{          \{}
\StringTok{            pp[the\_id[i],orderlist[j]]=0}
\StringTok{          \}}
\StringTok{        printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"pp[the\_id[i],orderlist[j]] \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{      \}}
\StringTok{    printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{  \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3 }\SpecialCharTok{$}\NormalTok{datas}
\NormalTok{echo }\StringTok{"classiication\_extract\_sum have been successfully written into \textless{}results/canopus\_pp.tsv\textgreater{}"}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{classification\_extract\_filter}\ErrorTok{)}
\NormalTok{echo }\StringTok{"Run classification\_extract\_filter."}\NormalTok{;}
 \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f results}\SpecialCharTok{/}\NormalTok{canopus\_pp.tsv ]}
\NormalTok{ then}
\NormalTok{ echo }\StringTok{"Project path acknowledged."}
 \ControlFlowTok{else}
\NormalTok{   until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{results}\SpecialCharTok{/}\NormalTok{canopus\_pp.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{results}\SpecialCharTok{/}\NormalTok{canopus\_summary.tsv ]}
\NormalTok{   do}
\NormalTok{   read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{   done;}
\NormalTok{   cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{ fi; }
\NormalTok{check}\OtherTok{=}\DecValTok{0}
\NormalTok{ until [[ }\StringTok{"$check"} \SpecialCharTok{==} \StringTok{"yes"}\NormalTok{ ]] }\SpecialCharTok{||}\NormalTok{ [[ }\StringTok{"$check"} \SpecialCharTok{==} \StringTok{"no"}\NormalTok{ ]]}
\NormalTok{ do}
\NormalTok{ read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Collate the posterior probabilities of the classification of each feature? [yes/no] \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ check;}
\NormalTok{ done;}
 \ControlFlowTok{if}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{check }\SpecialCharTok{==} \StringTok{"yes"}\NormalTok{ ]]}
\NormalTok{ then}
\NormalTok{ definition\_limit}\OtherTok{=}\DecValTok{0}
\NormalTok{   until [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textgreater{}} \StringTok{"0.01"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textless{}} \StringTok{"1"}\NormalTok{ ]]}
\NormalTok{   do}
\NormalTok{   read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the classes posterior probabilities limition. 0.5\textasciitilde{}0.99 may work well. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ definition\_limit;}
\NormalTok{   done;}
\NormalTok{ data1}\OtherTok{=}\StringTok{"canopus\_summary.tsv"}
\NormalTok{  data2}\OtherTok{=}\StringTok{"canopus.tsv"}
\NormalTok{  data3}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{   \{}
\StringTok{   if(NR==FNR)}
\StringTok{     \{}
\StringTok{     if(FNR==1)}
\StringTok{       \{}
\StringTok{       p\_file=FILENAME}
\StringTok{       \textbackslash{}}
\StringTok{       for(i=1; i\textless{}=NF; i++)}
\StringTok{         \{}
\StringTok{         if($i\textasciitilde{}/name/)}
\StringTok{           \{}
\StringTok{           col\_id=i}
\StringTok{           \}}
\StringTok{         if($i\textasciitilde{}/specific/)}
\StringTok{           \{}
\StringTok{           col\_specific=i}
\StringTok{           \}}
\StringTok{         if($i\textasciitilde{}/level/)}
\StringTok{           \{}
\StringTok{           col\_level=i}
\StringTok{           \}}
\StringTok{         if($i\textasciitilde{}/subclass/)}
\StringTok{           \{}
\StringTok{           col\_subclass=i}
\StringTok{           \}}
\StringTok{         if($i\textasciitilde{}/\^{}class/)}
\StringTok{           \{}
\StringTok{           col\_class=i}
\StringTok{           \}}
\StringTok{         if($i\textasciitilde{}/superclass/)}
\StringTok{           \{}
\StringTok{           col\_superclass=i}
\StringTok{           \}}
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     if(FNR\textgreater{}=2)}
\StringTok{       \{}
\StringTok{       n=split($col\_id,a,"[\_]")}
\StringTok{       \textbackslash{}}
\StringTok{       id=a[n]}
\StringTok{       \textbackslash{}}
\StringTok{       specific[id]=$col\_specific}
\StringTok{       \textbackslash{}}
\StringTok{       level[id]=$col\_level}
\StringTok{       \textbackslash{}}
\StringTok{       subclass[id]=$col\_subclass}
\StringTok{       \textbackslash{}}
\StringTok{       class[id]=$col\_class}
\StringTok{       \textbackslash{}}
\StringTok{       superclass[id]=$col\_superclass}
\StringTok{       \}}
\StringTok{     \}}
\StringTok{   if(FILENAME\textasciitilde{}/canopus.tsv/)}
\StringTok{     \{}
\StringTok{     if(FNR==1)}
\StringTok{       \{}
\StringTok{       close(p\_file)}
\StringTok{       \textbackslash{}}
\StringTok{       p\_file=FILENAME}
\StringTok{       \textbackslash{}}
\StringTok{       for(i=1; i\textless{}=NF; i++)}
\StringTok{         \{}
\StringTok{         if($i\textasciitilde{}/name/)}
\StringTok{           \{}
\StringTok{           col\_name=i}
\StringTok{           \}}
\StringTok{         if($i\textasciitilde{}/description/)}
\StringTok{           \{}
\StringTok{           col\_description=i}
\StringTok{           \}}
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     if(FNR\textgreater{}=2)}
\StringTok{       \{}
\StringTok{       description[$col\_name]=$col\_description}
\StringTok{       \}}
\StringTok{     \}}
\StringTok{   if(FILENAME\textasciitilde{}"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data3}\StringTok{\textquotesingle{}")}
\StringTok{     \{}
\StringTok{     if(FNR==1)}
\StringTok{       \{}
\StringTok{       close(p\_file)}
\StringTok{       \textbackslash{}}
\StringTok{       for(i=1; i\textless{}=NF; i++)}
\StringTok{         \{}
\StringTok{         if($i\textasciitilde{}/\^{}id$/)}
\StringTok{           \{}
\StringTok{           col\_id=i}
\StringTok{           \}}
\StringTok{         if(i\textgreater{}=2)}
\StringTok{           \{}
\StringTok{           col\_class\_name[i]=$i}
\StringTok{           \}}
\StringTok{         \}}
\StringTok{       printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition\_source}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition\_description}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{       \textbackslash{}}
\StringTok{       "specific}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "specific\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "level\_5}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "level\_5\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{       \textbackslash{}}
\StringTok{       "subclass}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "subclass\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "class}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "class\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "superclass}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "superclass\_pp}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textbackslash{}}
\StringTok{       \textbackslash{}}
\StringTok{       \textgreater{} "results/stat\_classification.tsv"}
\StringTok{       \}}
\StringTok{     if(FNR\textgreater{}=2)}
\StringTok{       \{}
\StringTok{       for(i=2; i\textless{}=NF; i++)}
\StringTok{         \{}
\StringTok{         c\_pp[col\_class\_name[i]]=sprintf("\%.4f",$i)}
\StringTok{         \}}
\StringTok{       if(level[$col\_id] != "" \&\& c\_pp[level[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{         \{}
\StringTok{         definition\_source="level\_5"}
\StringTok{         \textbackslash{}}
\StringTok{         definition=level[$col\_id]}
\StringTok{         \}}
\StringTok{       else if(subclass[$col\_id] != "" \&\& c\_pp[subclass[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{         \{}
\StringTok{         definition\_source="subclass"}
\StringTok{         \textbackslash{}}
\StringTok{         definition=subclass[$col\_id]}
\StringTok{         \}}
\StringTok{       else if(class[$col\_id] != "" \&\& c\_pp[class[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{         \{}
\StringTok{         definition\_source="class"}
\StringTok{         \textbackslash{}}
\StringTok{         definition=class[$col\_id]}
\StringTok{         \}}
\StringTok{       else if(superclass[$col\_id] != "" \&\& c\_pp[superclass[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{         \{}
\StringTok{         definition\_source="superclass"}
\StringTok{         \textbackslash{}}
\StringTok{         definition=superclass[$col\_id]}
\StringTok{         \}}
\StringTok{       else}
\StringTok{         \{}
\StringTok{         definition\_source="null"}
\StringTok{         \textbackslash{}}
\StringTok{         definition="null"}
\StringTok{         \textbackslash{}}
\StringTok{         c\_pp[definition]="null"}
\StringTok{         \textbackslash{}}
\StringTok{         description[definition]="null"}
\StringTok{         \}}
\StringTok{       printf $col\_id"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  definition\_source"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  definition"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[definition]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  description[definition]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{       \textbackslash{}}
\StringTok{       specific[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[specific[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  level[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[level[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{       \textbackslash{}}
\StringTok{       subclass[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[subclass[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  class[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[class[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{       \textbackslash{}}
\StringTok{       superclass[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[superclass[$col\_id]]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/stat\_classification.tsv"}
\StringTok{       \}}
\StringTok{     \}}
\StringTok{   \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\NormalTok{  echo }\StringTok{"classification\_extract\_filter have been successfully written into \textless{}results/stat\_classification.tsv\textgreater{}"}
\NormalTok{  fi;}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{fragment\_tree\_network}\ErrorTok{)}
\NormalTok{echo }\StringTok{"Run fragment\_tree\_network."}\NormalTok{;}
 \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{d temp ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f .format ]}
\NormalTok{ then}
\NormalTok{ echo }\StringTok{"Project path acknowledged."}
 \ControlFlowTok{else}
\NormalTok{   until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{   do}
\NormalTok{   read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project. Make sure you have moved the fragment tree alignment results to the directory where the project is located. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{   done;}
\NormalTok{   cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{ fi;}
\NormalTok{echo }\StringTok{"Please enter the minimum alignment similarity(tlimit) that you want to filter."}
\NormalTok{tlimit}\OtherTok{=}\DecValTok{0}
\NormalTok{ until [[ }\StringTok{"$tlimit"} \SpecialCharTok{\textgreater{}} \StringTok{"0.01"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$tlimit"} \SpecialCharTok{\textless{}} \StringTok{"0.99"}\NormalTok{ ]]}
\NormalTok{ do}
\NormalTok{ read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"0.4{-}0.7 is recommended \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ tlimit;}
\NormalTok{ done;}
  \ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{d temp}\SpecialCharTok{/}\NormalTok{ftaligntemp ]}
\NormalTok{ then }
\NormalTok{ mkdir temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}
\NormalTok{  fi;}
\NormalTok{data}\OtherTok{=}\StringTok{"ftalign.tsv"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/ftaligntemp/tmp"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  \{}
\StringTok{  printf "Info: NR = " NR ". FNR = " FNR ".}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{   for(i=1; i\textless{}=NF; i++)}
\StringTok{     \{}
\StringTok{     if(NR==1 \&\& i!=1 || NR!=1 \&\& i==1)}
\StringTok{       \{}
\StringTok{       n=split($i,x,"[\_]")}
\StringTok{       \textbackslash{}}
\StringTok{       raw[NR,i]=x[n]}
\StringTok{       \}}
\StringTok{     else}
\StringTok{       \{}
\StringTok{       if(NR==i)}
\StringTok{         \{}
\StringTok{         raw\_norm[NR,i]=$i}
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     \}}
\StringTok{   \}}
\StringTok{ if(NR\textgreater{}FNR \&\& FNR\textgreater{}=2)}
\StringTok{   \{}
\StringTok{   for(i=2; i\textless{}=NF; i++)}
\StringTok{     \{}
\StringTok{     norm1=$i/raw\_norm[i,i]}
\StringTok{     norm2=$i/raw\_norm[FNR,FNR]}
\StringTok{     norms=sprintf("\%.2f", ((norm1+norm2)/2))}
\StringTok{     if((norms+0 \textgreater{} \textquotesingle{}}\SpecialCharTok{$}\NormalTok{tlimit}\StringTok{\textquotesingle{}+0))}
\StringTok{       \{}
\StringTok{       if(raw[FNR,1]+0\textgreater{}=raw[1,i]+0)}
\StringTok{         \{}
\StringTok{         print raw[FNR,1], raw[1,i], norms \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{         \}}
\StringTok{       if(raw[FNR,1]+0\textless{}raw[1,i]+0)}
\StringTok{         \{}
\StringTok{         print raw[1,i], raw[FNR,1], norms \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     \}}
\StringTok{   \}}
\StringTok{  \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data }\SpecialCharTok{$}\NormalTok{data}
\NormalTok{sort }\SpecialCharTok{{-}}\NormalTok{u }\SpecialCharTok{$}\NormalTok{savepath }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{tmp2}
\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/ftaligntemp/filter\_net\_$tlimit"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{      if($1!=$2)}
\StringTok{        \{}
\StringTok{          replink[$1]=$1}
\StringTok{          replink[$2]=$2}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(NR!=FNR)}
\StringTok{    \{}
\StringTok{      if($1!=$2)}
\StringTok{        \{}
\StringTok{          printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" }
\StringTok{        \} }
\StringTok{      if($1==$2)}
\StringTok{        \{}
\StringTok{          if(replink[$1]=="")}
\StringTok{            \{}
\StringTok{              printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{tmp2 temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{tmp2}
\NormalTok{echo }\StringTok{"fragment\_tree\_network have been successfully written into \textless{}temp/ftaligntemp/filter\_net\_$tlimit\textgreater{}"}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{fragment\_tree\_network\_delta}\ErrorTok{)}
 \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{d temp ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f .format ]}
\NormalTok{ then}
\NormalTok{ echo }\StringTok{"Project path acknowledged."}
 \ControlFlowTok{else}
\NormalTok{   until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{   do}
\NormalTok{   read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{   done;}
\NormalTok{ cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{ fi;}
\NormalTok{echo }\StringTok{"The following module attempts to compute the differential fingerprints of connected clusters based on the molecular fingerprint results of sirius 4."}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{plimit}\OtherTok{=}\DecValTok{0}
\NormalTok{ until [[ }\StringTok{"$plimit"} \SpecialCharTok{\textgreater{}} \StringTok{"0.5"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$plimit"} \SpecialCharTok{\textless{}} \StringTok{"0.99"}\NormalTok{ ]]}
\NormalTok{ do}
\NormalTok{ read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"If the minimum alignment similarity is greater than 0.3, this step will automatic calculate the discrepancy fingerprint between alignment features(in beta). Please enter the minimum posterior probability of the molecular fingerprint(plimit\_1) to be filtered. 0.9{-}0.99 is recommended. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ plimit;}
\NormalTok{ done;}
\NormalTok{plimit2}\OtherTok{=}\DecValTok{0}
\NormalTok{ until [[ }\StringTok{"$plimit2"} \SpecialCharTok{\textgreater{}} \StringTok{"0.1"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$plimit2"} \SpecialCharTok{\textless{}} \StringTok{"$plimit"}\NormalTok{ ]]}
\NormalTok{ do}
\NormalTok{ read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"The minimum posterior probability of the molecular fingerprint(plimit\_2) to be controled. 0.1{-}0.5 may work well. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ plimit2;}
\NormalTok{ done;}
\NormalTok{tlimit}\OtherTok{=}\ErrorTok{$}\NormalTok{(ls temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{filter\_net\_}\SpecialCharTok{*} \ErrorTok{|}\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F \_ }\StringTok{\textquotesingle{}\{print $NF\}\textquotesingle{}}\NormalTok{)}
\NormalTok{check\_rep}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}END\{print NR\}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$tlimit"}\NormalTok{))}
 \ControlFlowTok{if}\NormalTok{ [[ }\StringTok{"$check\_rep"} \SpecialCharTok{\textgreater{}} \StringTok{"1"}\NormalTok{ ]]}
\NormalTok{ then}
\NormalTok{ tlimit}\OtherTok{=}\DecValTok{0}
\NormalTok{   until [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{filter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit ]}
\NormalTok{   do}
\NormalTok{   read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Plural and different fragment\_tree\_network files were found to exist locally. Please select a tlimit parameter you have utilized to run fragment\_tree\_network\_delta. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ tlimit;}
\NormalTok{   done;}
\NormalTok{ fi;}
 \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{refilter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit ]}
\NormalTok{ then rm temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{refilter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit}
\NormalTok{ fi;}
 \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{fpsample ]}
\NormalTok{ then rm temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{fpsample}
\NormalTok{ fi;}
\NormalTok{echo }\StringTok{"Running delta\_fingerprint computation..."}
\NormalTok{echo }\StringTok{"Aquiring data from sirius index..."}
\NormalTok{data1}\OtherTok{=}\StringTok{"*\_*/compound.info"}
\NormalTok{data2}\OtherTok{=}\StringTok{"temp/ftaligntemp/filter\_net\_$tlimit"}
\NormalTok{echo }\StringTok{"Run fragment\_tree\_network\_delta."}
\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/ms\_data\_$tlimit"}
\NormalTok{echo }\StringTok{"step 1: ms data"}
  \ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{savepath ]}
\NormalTok{  then}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\StringTok{"[}\SpecialCharTok{\textbackslash{}t}\StringTok{]||[:]||[\_]"} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{   BEGIN\{  }
\StringTok{     printf "..."}
\StringTok{     printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "m/z}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "rt}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{     \}}
\StringTok{   \{}
\StringTok{   if(FILENAME\textasciitilde{}/compound.info/)}
\StringTok{     \{}
\StringTok{     if(FNR==1)}
\StringTok{       \{}
\StringTok{       printf "Info: catch \textgreater{}\textgreater{}\textgreater{} "FILENAME"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{       \}}
\StringTok{     if($1=="name")}
\StringTok{       \{}
\StringTok{       i+=1;}
\StringTok{       id[i]=$NF;}
\StringTok{       n=split($NF,a,"[\_]")}
\StringTok{       printf a[n]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{       \}}
\StringTok{     if($1=="ionMass")}
\StringTok{       \{}
\StringTok{       mz[id[i]]=$NF}
\StringTok{       printf sprintf("\%.4f",$NF)"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{       \}}
\StringTok{     if($1=="ionType")}
\StringTok{       \{}
\StringTok{       type[id[i]]=$NF}
\StringTok{       \}}
\StringTok{     if($1=="rt")}
\StringTok{       \{}
\StringTok{       rt[id[i]]=$2;}
\StringTok{       printf sprintf("\%.2f",$2/60)"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{       \}}
\StringTok{     \}}
\StringTok{   if(FILENAME\textasciitilde{}/ftaligntemp/)}
\StringTok{     \{}
\StringTok{     \#source  target  ftalign  delta\_mz  delta\_rt  source\_iontype  target\_iontype;}
\StringTok{     if(FNR==1)}
\StringTok{       \{}
\StringTok{       printf "" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{       \}}
\StringTok{     print $1,$2,$3,sprintf("\%.3f",mz[$2]{-}mz[$1]),sprintf("\%.2f",rt[$2]{-}rt[$1]),type[$1],type[$2] \textbackslash{}}
\StringTok{     \textbackslash{}}
\StringTok{     \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{     \}}
\StringTok{   \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
\NormalTok{  fi;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{echo }\StringTok{"step 2: data path"}
\NormalTok{source\_file}\OtherTok{=}\StringTok{"temp/Mo\_filename"}
\NormalTok{data}\OtherTok{=}\StringTok{"temp/ms\_data\_$tlimit"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/datapath\_$tlimit"}
  \ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{savepath ]}
\NormalTok{  then}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{   \{}
\StringTok{   if(NR==FNR)}
\StringTok{     \{}
\StringTok{     n=split($2, a, "[\_]")}
\StringTok{     file[a[n]]=$2}
\StringTok{     formu\_type[a[n]]=$3}
\StringTok{     \}}
\StringTok{   if(NR!=FNR)}
\StringTok{     \{}
\StringTok{     \#\textless{}path\textgreater{}sourceFormula  \textless{}path\textgreater{}targetFormula}
\StringTok{     path1=file[$1]"/fingerprints/"formu\_type[$1]".fpt"}
\StringTok{     path2=file[$2]"/fingerprints/"formu\_type[$2]".fpt"}
\StringTok{     data[path1]=path1}
\StringTok{     data[path2]=path2}
\StringTok{     \}}
\StringTok{   \}}
\StringTok{   END\{}
\StringTok{     for(i in data)}
\StringTok{       \{}
\StringTok{       n+=1}
\StringTok{       print "Check file:",n}
\StringTok{       if(getline\textless{}i=={-}1)}
\StringTok{         \{}
\StringTok{         printf "Escape filename: " i "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{         \}}
\StringTok{       else}
\StringTok{         \{}
\StringTok{         printf i" " \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{         \}}
\StringTok{       close(i)}
\StringTok{       \}}
\StringTok{     print "Sum:",n}
\StringTok{     \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{source\_file }\SpecialCharTok{$}\NormalTok{data}
\NormalTok{   fi;}
\NormalTok{datapath}\OtherTok{=}\ErrorTok{$}\NormalTok{(cat temp}\SpecialCharTok{/}\NormalTok{datapath\_}\SpecialCharTok{$}\NormalTok{tlimit)}
\NormalTok{echo }\StringTok{"step 3: fingerprint"}
\NormalTok{data\_allfp}\OtherTok{=}\StringTok{"temp/data\_allfp\_$tlimit"}
  \ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{data\_allfp ]}
\NormalTok{  then}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{   BEGIN\{}
\StringTok{     n=0}
\StringTok{     \}}
\StringTok{   \{}
\StringTok{   if(FNR==1)}
\StringTok{     \{}
\StringTok{     if(n\textgreater{}1)}
\StringTok{       \{}
\StringTok{       close(file)}
\StringTok{       \}}
\StringTok{     file=FILENAME;}
\StringTok{     print "Get fingerprints: ",FILENAME}
\StringTok{     n+=1;}
\StringTok{     printf FILENAME"}\SpecialCharTok{\textbackslash{}n}\StringTok{"$0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data\_allfp}\StringTok{\textquotesingle{}"}
\StringTok{     \}}
\StringTok{   else}
\StringTok{     \{}
\StringTok{     print $0 \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data\_allfp}\StringTok{\textquotesingle{}"}
\StringTok{     \}}
\StringTok{   \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{datapath}
\NormalTok{  fi;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  \{}
\StringTok{  if(NR==1)}
\StringTok{    \{}
\StringTok{    for(i=1; i\textless{}=NF; i++)}
\StringTok{      \{}
\StringTok{      if($i\textasciitilde{}/absolute/)}
\StringTok{        \{}
\StringTok{        col\_index=i}
\StringTok{        \}}
\StringTok{      if($i\textasciitilde{}/description/)}
\StringTok{        \{}
\StringTok{        col\_description=i}
\StringTok{        \}}
\StringTok{      \}}
\StringTok{    \}}
\StringTok{  if(NR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{    print $col\_index,$col\_description}
\StringTok{    \}}
\StringTok{  \}\textquotesingle{}}\NormalTok{ csi\_fingerid.tsv }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{pos\_fingerprint\_index;}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  \{}
\StringTok{  if(NR==1)}
\StringTok{    \{}
\StringTok{    for(i=1; i\textless{}=NF; i++)}
\StringTok{      \{}
\StringTok{      if($i\textasciitilde{}/absolute/)}
\StringTok{        \{}
\StringTok{        col\_index=i}
\StringTok{        \}}
\StringTok{      if($i\textasciitilde{}/description/)}
\StringTok{        \{}
\StringTok{        col\_description=i}
\StringTok{        \}}
\StringTok{      \}}
\StringTok{    \}}
\StringTok{  if(NR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{    print $col\_index,$col\_description}
\StringTok{    \}}
\StringTok{  \}\textquotesingle{}}\NormalTok{ csi\_fingerid\_neg.tsv }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{neg\_fingerprint\_index;}
\NormalTok{posindex}\OtherTok{=}\StringTok{"temp/ftaligntemp/pos\_fingerprint\_index"}
\NormalTok{negindex}\OtherTok{=}\StringTok{"temp/ftaligntemp/neg\_fingerprint\_index"}
\NormalTok{data}\OtherTok{=}\StringTok{"temp/ms\_data\_$tlimit"}
\NormalTok{echo }\StringTok{"step 4: merge data"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  BEGIN\{}
\StringTok{    file=0}
\StringTok{    x=0}
\StringTok{    count=0}
\StringTok{    f=0}
\StringTok{    posnum=0}
\StringTok{    negnum=0}
\StringTok{    \}}
\StringTok{  \{}
\StringTok{  if(FNR==1)}
\StringTok{    \{}
\StringTok{    file+=1}
\StringTok{    \}}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{    if(($1\textasciitilde{}/fingerprint/))}
\StringTok{      \{}
\StringTok{      if(x+0\textgreater{}f+0)}
\StringTok{        \{}
\StringTok{        f=x  \# calculate the max index.}
\StringTok{        \}}
\StringTok{      count+=1;  \# calculate the all fingerprints file number.}
\StringTok{      \textbackslash{}}
\StringTok{      split($1,a,"[/]"); e=split(a[1],b,"[\_]"); id=b[e]; \#catch the id.}
\StringTok{      \textbackslash{}}
\StringTok{      x=0;}
\StringTok{      \}}
\StringTok{    else}
\StringTok{      \{}
\StringTok{      x+=1;}
\StringTok{      \textbackslash{}}
\StringTok{      fp[id,x]=$1;}
\StringTok{      \}}
\StringTok{    \}}
\StringTok{  if(file==2)}
\StringTok{    \{}
\StringTok{    pos[FNR]=$1}
\StringTok{    posnum+=1}
\StringTok{    \}}
\StringTok{  if(file==3)}
\StringTok{    \{}
\StringTok{    neg[FNR]=$1}
\StringTok{    negnum+=1}
\StringTok{    \}}
\StringTok{  if(file==4)}
\StringTok{    \{}
\StringTok{    if("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tlimit}\StringTok{\textquotesingle{}"+0 \textgreater{}= 0.3)}
\StringTok{      \{}
\StringTok{     if(fp[$1,1]!="" \&\& fp[$2,1]!="")}
\StringTok{       \{}
\StringTok{       n1=split($6, g, "[]]");}
\StringTok{       n2=split($7, h, "[]]");}
\StringTok{       if(g[n1]=="+" \&\& h[n2]=="+")}
\StringTok{         \{}
\StringTok{         for(x=1; x\textless{}=posnum; x++)}
\StringTok{           \{}
\StringTok{           if(fp[$1,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{             \{}
\StringTok{             data\_s[FNR,x]=pos[x]}
\StringTok{             \}}
\StringTok{           else if(fp[$2,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{             \{}
\StringTok{             data\_t[FNR,x]=pos[x]}
\StringTok{             \}}
\StringTok{           \}}
\StringTok{         \}}
\StringTok{       if(g[n1]=="{-}" \&\& h[n2]=="{-}")}
\StringTok{         \{}
\StringTok{         for(x=1; x\textless{}=negnum; x++)}
\StringTok{           \{}
\StringTok{           if(fp[$1,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{             \{}
\StringTok{             data\_s[FNR,x]=neg[x]}
\StringTok{             \}}
\StringTok{           else if(fp[$2,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{             \{}
\StringTok{             data\_t[FNR,x]=neg[x]}
\StringTok{             \}}
\StringTok{           \}}
\StringTok{         \}}
\StringTok{       if(g[n1]=="{-}" \&\& h[n2]=="+" || h[n2]=="{-}" \&\& g[n1]=="+")}
\StringTok{         \{}
\StringTok{         for(i=1; i\textless{}=posnum; i++)}
\StringTok{           \{}
\StringTok{           for(j=1; j\textless{}=negnum; j++)}
\StringTok{             \{}
\StringTok{             if(pos[i]==neg[j])}
\StringTok{               \{}
\StringTok{               mirror[i]=j  \#if pos=i, the identical index of neg is mirror[i]}
\StringTok{               \}}
\StringTok{             \}}
\StringTok{           \}}
\StringTok{         \}}
\StringTok{       if(g[n1]=="{-}" \&\& h[n2]=="+") }
\StringTok{         \{}
\StringTok{         for(x=1; x\textless{}=f; x++)}
\StringTok{           \{}
\StringTok{           if(fp[$1,mirror[x]]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{             \{}
\StringTok{             data\_s[FNR,x]=neg[mirror[x]]}
\StringTok{             \}}
\StringTok{           else if(fp[$2,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,mirror[x]]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{             \{}
\StringTok{             data\_t[FNR,x]=neg[mirror[x]]}
\StringTok{             \}}
\StringTok{           \}}
\StringTok{         \}}
\StringTok{       if(h[n2]=="{-}" \&\& g[n1]=="+")}
\StringTok{         \{}
\StringTok{         for(x=1; x\textless{}=f; x++)}
\StringTok{           \{}
\StringTok{           if(fp[$1,x]+0\textgreater{}= \textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,mirror[x]]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{             \{}
\StringTok{             data\_s[FNR,x]=neg[mirror[x]]}
\StringTok{             \}}
\StringTok{           else if(fp[$2,mirror[x]]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{             \{}
\StringTok{             data\_t[FNR,x]=neg[mirror[x]]}
\StringTok{             \}}
\StringTok{           \}   }
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     \}}
\StringTok{    if(FNR==1)}
\StringTok{      \{}
\StringTok{      printf "source}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "target}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "ftalign\_similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "delta\_m/z}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "source\_fp\_uniq}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "target\_fp\_uniq}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{      \}}
\StringTok{    else}
\StringTok{      \{}
\StringTok{      printf $1"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $2"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $3"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $4"}\SpecialCharTok{\textbackslash{}t}\StringTok{";}
\StringTok{      \textbackslash{}}
\StringTok{      if(\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tlimit}\StringTok{\textquotesingle{}+0 \textgreater{}= 0.3)}
\StringTok{        \{}
\StringTok{       if(fp[$1,1]=="" || fp[$2,1]=="")}
\StringTok{         \{}
\StringTok{         printf "NA@NA}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{         \}}
\StringTok{       else}
\StringTok{         \{}
\StringTok{         printf "source:"  \#the source fingerprint uniq.}
\StringTok{         \textbackslash{}}
\StringTok{         for(x=1; x\textless{}=f; x++)}
\StringTok{           \{}
\StringTok{           if(data\_s[FNR,x]!="")}
\StringTok{             \{}
\StringTok{             printf data\_s[FNR,x]","}
\StringTok{             \}}
\StringTok{           \};}
\StringTok{         printf "@target:"  \#the target fingerprint uniq.}
\StringTok{         \textbackslash{}}
\StringTok{         for(x=1; x\textless{}=f; x++)}
\StringTok{           \{}
\StringTok{           if(data\_t[FNR,x]!="")}
\StringTok{             \{}
\StringTok{             printf data\_t[FNR,x]","}
\StringTok{             \}}
\StringTok{           \}}
\StringTok{         printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     else}
\StringTok{       \{}
\StringTok{       printf "NA@NA}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{       \}}
\StringTok{      \}}
\StringTok{    \}}
\StringTok{  \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data\_allfp }\SpecialCharTok{$}\NormalTok{posindex }\SpecialCharTok{$}\NormalTok{negindex }\SpecialCharTok{$}\NormalTok{data }\SpecialCharTok{|}\NormalTok{ sed }\SpecialCharTok{{-}}\NormalTok{e }\StringTok{\textquotesingle{}s/,@/}\SpecialCharTok{\textbackslash{}t}\StringTok{/g; s/,$//g; s/@/}\SpecialCharTok{\textbackslash{}t}\StringTok{/g\textquotesingle{}}\NormalTok{ \textbackslash{}}
\NormalTok{  \textbackslash{}}
  \SpecialCharTok{\textgreater{}}\NormalTok{ results}\SpecialCharTok{/}\NormalTok{source\_target\_tree\_}\SpecialCharTok{$}\NormalTok{tlimit.tsv;}
\NormalTok{echo }\StringTok{"All instances have written into \textless{}results/source\_target\_tree\_$tlimit.tsv\textgreater{}."}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{echo }\StringTok{"step 5: separate child{-}nebula from parent{-}nebula."}
\NormalTok{data}\OtherTok{=}\StringTok{"results/stat\_classification.tsv"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/filter\_0\_class.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  \{}
\StringTok{  if(FNR==1)}
\StringTok{    \{}
\StringTok{    for(i=1; i\textless{}=NF; i++)}
\StringTok{      \{}
\StringTok{      if($i\textasciitilde{}/\^{}definition$/)}
\StringTok{        \{}
\StringTok{        col\_class=i}
\StringTok{        \}}
\StringTok{      \}}
\StringTok{    \}}
\StringTok{  if(FNR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{    class[$col\_class]=$col\_class}
\StringTok{    \}}
\StringTok{  \}}
\StringTok{  END\{}
\StringTok{   for(i in class)}
\StringTok{      \{}
\StringTok{      printf class[i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{      \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ data1}\OtherTok{=}\StringTok{"temp/filter\_0\_class.tsv"} 
\NormalTok{ data2}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\NormalTok{ data3}\OtherTok{=}\StringTok{"results/fingerid\_first\_score.tsv"}
\NormalTok{ until [[ }\StringTok{"$similarity\_limit"} \SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$similarity\_limit"} \SpecialCharTok{\textless{}} \DecValTok{1}\NormalTok{ ]]}
\NormalTok{ do}
\NormalTok{ read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please set the Tanimoto similarity threshold contribute to child{-}nebula. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ similarity\_limit;}
\NormalTok{ done;}
\NormalTok{  until [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textgreater{}} \FloatTok{0.01}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textless{}} \DecValTok{1}\NormalTok{ ]]}
\NormalTok{  do}
\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the classes posterior probabilities limition. 0.5\textasciitilde{}0.99 may work well. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ definition\_limit;}
\NormalTok{  done;}
\NormalTok{ class\_pp\_limit}\OtherTok{=}\ErrorTok{$}\NormalTok{definition\_limit}
\NormalTok{ savepath}\OtherTok{=}\StringTok{"temp/idenfication\_filter\_$class\_pp\_limit.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{   \{}
\StringTok{   if(NR==FNR)}
\StringTok{     \{}
\StringTok{     filter\_class[$1]=$1}
\StringTok{     \}}
\StringTok{   if(FILENAME\textasciitilde{}/canopus/)}
\StringTok{     \{}
\StringTok{     if(FNR==1)}
\StringTok{       \{}
\StringTok{       col\_id=1}
\StringTok{       for(i=2; i\textless{}=NF; i++)}
\StringTok{         \{}
\StringTok{         for(j in filter\_class)}
\StringTok{           \{}
\StringTok{           if(j==$i)}
\StringTok{             \{}
\StringTok{             col\_class[j]=i}
\StringTok{             print i}
\StringTok{             \}}
\StringTok{           \}}
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     if(FNR\textgreater{}=2)}
\StringTok{       \{}
\StringTok{       for(i in col\_class)}
\StringTok{         \{}
\StringTok{         if(sprintf("\%.3f",$col\_class[i])+0\textgreater{}="\textquotesingle{}}\SpecialCharTok{$}\NormalTok{class\_pp\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{           \{}
\StringTok{           class\_set[i,$col\_id]=i}
\StringTok{           print "ID: ",$1,i,$col\_class[i]}
\StringTok{           \}}
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     \}}
\StringTok{   if(FILENAME\textasciitilde{}/fingerid\_first\_score/)}
\StringTok{     \{}
\StringTok{     if(FNR==1)}
\StringTok{       \{}
\StringTok{       for(i=1; i\textless{}=NF; i++)}
\StringTok{         \{}
\StringTok{         if($i\textasciitilde{}/\^{}id/)}
\StringTok{         \{}
\StringTok{         col\_id=i}
\StringTok{         \}}
\StringTok{       if($i\textasciitilde{}/similarity/)}
\StringTok{         \{}
\StringTok{         col\_similarity=i}
\StringTok{         \}}
\StringTok{         \}}
\StringTok{       printf "class\_nebula\_facet}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{       \}}
\StringTok{     if(FNR\textgreater{}=2)}
\StringTok{       \{}
\StringTok{       if($col\_similarity+0 \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{similarity\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{         \{}
\StringTok{        for(i in class\_set)}
\StringTok{          \{}
\StringTok{          if(i\textasciitilde{}"}\SpecialCharTok{\textbackslash{}034}\StringTok{"$col\_id"$")}
\StringTok{            \{}
\StringTok{            printf class\_set[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{          \}}
\StringTok{        \}}
\StringTok{       \}}
\StringTok{     \}}
\StringTok{   \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ data}\OtherTok{=}\StringTok{"temp/idenfication\_filter\_$class\_pp\_limit.tsv"}
\NormalTok{ savepath}\OtherTok{=}\StringTok{"temp/idenfication\_filter2\_$\{class\_pp\_limit\}.tsv"}
\NormalTok{  until [[ }\StringTok{"$num\_limit\_1"} \SpecialCharTok{{-}}\NormalTok{gt }\DecValTok{0}\NormalTok{ ]]}
\NormalTok{  do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the features number threshold contribute to child{-}nebula (min number). \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ num\_limit\_1;}
\NormalTok{  done;}
\NormalTok{  until [[ }\StringTok{"$num\_limit\_2"} \SpecialCharTok{{-}}\NormalTok{gt }\StringTok{"$num\_limit\_1"}\NormalTok{ ]]}
\NormalTok{  do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the features number threshold contribute to child{-}nebula (max number). \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ num\_limit\_2;}
\NormalTok{  done;}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{   \{}
\StringTok{   if(FNR==1)}
\StringTok{     \{}
\StringTok{     printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{     for(i=1; i\textless{}=NF; i++)}
\StringTok{       \{}
\StringTok{       if($i\textasciitilde{}/class\_nebula\_facet/)}
\StringTok{         \{}
\StringTok{         col\_class=i}
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     \}}
\StringTok{ if(FNR\textgreater{}=2)}
\StringTok{   \{}
\StringTok{   num[$col\_class]+=1}
\StringTok{   data[FNR]=$0}
\StringTok{     class[FNR]=$col\_class}
\StringTok{   \}}
\StringTok{  \}}
\StringTok{   END\{}
\StringTok{     for(i in num)}
\StringTok{       \{}
\StringTok{       if(num[i]+0 \textgreater{}= \textquotesingle{}}\SpecialCharTok{$}\NormalTok{num\_limit\_1}\StringTok{\textquotesingle{}+0 \&\& num[i]+0 \textless{}= \textquotesingle{}}\SpecialCharTok{$}\NormalTok{num\_limit\_2}\StringTok{\textquotesingle{})}
\StringTok{         \{}
\StringTok{         printf "The nodes number of the child{-}nebula is " num[i] ".}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{         for(j in class)}
\StringTok{           \{}
\StringTok{           if(class[j]==i)}
\StringTok{             \{}
\StringTok{             printf data[j]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{             \}}
\StringTok{           \}}
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ mkdir results}\SpecialCharTok{/}\NormalTok{network\_facet\_}\SpecialCharTok{$}\NormalTok{class\_pp\_limit}
\NormalTok{ data1}\OtherTok{=}\StringTok{"temp/idenfication\_filter2\_$\{class\_pp\_limit\}.tsv"}
\NormalTok{ data2}\OtherTok{=}\StringTok{"results/source\_target\_tree\_$tlimit.tsv"} \CommentTok{\# "results/source\_target\_tree\_0.4.tsv"}
\NormalTok{ save\_class}\OtherTok{=}\StringTok{"results/filter\_child\_class.tsv"}
\NormalTok{ savepath}\OtherTok{=}\StringTok{"results/network\_facet\_$class\_pp\_limit/"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{   \{}
\StringTok{   if(NR==FNR)}
\StringTok{     \{}
\StringTok{     if(FNR==1)}
\StringTok{       \{}
\StringTok{       for(i=1; i\textless{}=NF; i++)}
\StringTok{         \{}
\StringTok{         if($i\textasciitilde{}/class\_nebula\_facet/)}
\StringTok{           \{}
\StringTok{           col\_class=i}
\StringTok{           \}}
\StringTok{         if($i\textasciitilde{}/\^{}id$/)}
\StringTok{           \{}
\StringTok{           col\_id=i}
\StringTok{           \}}
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     if(FNR\textgreater{}=2)}
\StringTok{       \{}
\StringTok{       class[$col\_class]=$col\_class}
\StringTok{       class\_id[$col\_class,$col\_id]=$col\_id}
\StringTok{       stat\_id[$col\_class,$col\_id]=$col\_id}
\StringTok{       belong[$col\_class,$col\_id]=$col\_class}
\StringTok{       \}}
\StringTok{     \}}
\StringTok{   if(NR\textgreater{}FNR)}
\StringTok{     \{}
\StringTok{     if(FNR==1)}
\StringTok{       \{}
\StringTok{       for(i in class)}
\StringTok{         \{}
\StringTok{         printf i"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{save\_class}\StringTok{\textquotesingle{}"}
\StringTok{         printf $0"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "facet}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" i ".tsv"}
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     if(FNR\textgreater{}=2)}
\StringTok{       \{}
\StringTok{       for(i in class)}
\StringTok{         \{}
\StringTok{         if( class\_id[i,$1]==$1 \&\& class\_id[i,$2]==$2 )}
\StringTok{           \{}
\StringTok{           printf $0"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  i"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" i ".tsv"}
\StringTok{           delete stat\_id[i,$1]}
\StringTok{           delete stat\_id[i,$2]}
\StringTok{           \}}
\StringTok{         \}}
\StringTok{       \}}
\StringTok{     \}}
\StringTok{   \}}
\StringTok{   END\{}
\StringTok{     for(i in stat\_id)}
\StringTok{       \{}
\StringTok{       \#\# source target similarity delta\_mz fp fp class}
\StringTok{       printf stat\_id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" stat\_id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "1}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "0}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "null}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "null}\SpecialCharTok{\textbackslash{}t}\StringTok{"  belong[i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textbackslash{}}
\StringTok{       \textbackslash{}}
\StringTok{       \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" belong[i] ".tsv"}
\StringTok{       \}}
\StringTok{     \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ data1}\OtherTok{=}\StringTok{"canopus.tsv"}
\NormalTok{ data2}\OtherTok{=}\StringTok{"results/filter\_child\_class.tsv"}
\NormalTok{ data3}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\NormalTok{ savepath}\OtherTok{=}\StringTok{"results/canopus\_pp\_filter.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(FILENAME\textasciitilde{}/canopus.tsv/)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/absolute/)}
\StringTok{                    \{}
\StringTok{                    col\_index=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/\^{}id/)}
\StringTok{                    \{}
\StringTok{                    col\_chemid=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/name/)}
\StringTok{                    \{}
\StringTok{                    col\_name=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/description/)}
\StringTok{                    \{}
\StringTok{                    col\_des=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}2)}
\StringTok{            \{}
\StringTok{            ab\_index[$col\_name]=$col\_index}
\StringTok{            chemid[$col\_name]=$col\_chemid}
\StringTok{            des[$col\_name]=$col\_des}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FILENAME\textasciitilde{}/filter\_child\_class/)}
\StringTok{        \{}
\StringTok{        class[$1]=$1}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            printf "index}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "chem\_id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "description}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/child\_class.tsv"}
\StringTok{            \}}
\StringTok{        printf ab\_index[$1]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  chemid[$1]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $1"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  des[$1]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/child\_class.tsv"}
\StringTok{        \}}
\StringTok{    if(FILENAME\textasciitilde{}/canopus\_pp/)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            printf $1 \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            for(i=2; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if(class[$i]!="")}
\StringTok{                    \{}
\StringTok{                    n+=1}
\StringTok{                    printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{C"ab\_index[$i] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                    col\_set[n]=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            printf $1 \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            for(i=1; i\textless{}=n; i++)}
\StringTok{                \{}
\StringTok{                printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"$col\_set[i] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                \}}
\StringTok{            printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{compound\_idenfication}\ErrorTok{)}
\NormalTok{echo }\StringTok{"Run compound\_idenfication."}
\NormalTok{echo }\StringTok{"compound\_idenfication "}
\NormalTok{exit}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{double\_ion\_network}\ErrorTok{)}
\NormalTok{exit;}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{exit}\ErrorTok{)}
\NormalTok{echo }\StringTok{"The mystery of creation is like the darkness of night{-}{-}it is great.}
\StringTok{Delusions of knowledge are like the fog of the morning."}
\NormalTok{exit;}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{*}\ErrorTok{)}
\NormalTok{echo }\StringTok{"error"}
\NormalTok{exit;}
\NormalTok{;;}
\NormalTok{esac;}
\NormalTok{done;}\CommentTok{\#(for)}
\NormalTok{done;}\CommentTok{\#(select)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-mcnebula1127.sh}{%
\section{File: mcnebula1127.sh}\label{file-mcnebula1127.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{PS3}\OtherTok{=}\StringTok{\textquotesingle{}Please select the workflow to be executed. \textgreater{}\textgreater{}\textgreater{} \textquotesingle{}}
\NormalTok{select command }\ControlFlowTok{in}\NormalTok{ \textbackslash{}}
  \StringTok{"default"}\NormalTok{ \textbackslash{}}
  \StringTok{"structure\_extract"}\NormalTok{ \textbackslash{}}
  \StringTok{"classification\_extract\_sum"}\NormalTok{ \textbackslash{}}
  \StringTok{"classification\_extract\_filter"}\NormalTok{ \textbackslash{}}
  \StringTok{"fragment\_tree\_network"}\NormalTok{ \textbackslash{}}
  \StringTok{"fragment\_tree\_network\_delta"}\NormalTok{ \textbackslash{}}
  \StringTok{"compound\_idenfication"}\NormalTok{ \textbackslash{}}
  \StringTok{"double\_ion\_network"}\NormalTok{ \textbackslash{}}
  \StringTok{"exit"} 
\NormalTok{do}
  \ControlFlowTok{if}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{command }\SpecialCharTok{==} \StringTok{"default"}\NormalTok{ ]]}
\NormalTok{  then}
\NormalTok{    confirm}\OtherTok{=}\DecValTok{0}
\NormalTok{    until [[ }\SpecialCharTok{$}\NormalTok{confirm }\SpecialCharTok{==} \StringTok{"yes"}\NormalTok{ ]] }\SpecialCharTok{||}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{confirm }\SpecialCharTok{==} \StringTok{"no"}\NormalTok{ ]]}
\NormalTok{    do}
\NormalTok{      read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Running all proccesses sequentially? [yes/no] \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ confirm}
\NormalTok{    done;}
    \ControlFlowTok{if}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{confirm }\SpecialCharTok{==} \StringTok{"no"}\NormalTok{ ]]}
\NormalTok{    then exit}
\NormalTok{    fi;}
\NormalTok{    default}\OtherTok{=}\StringTok{"structure\_extract classification\_extract\_sum classification\_extract\_filter fragment\_tree\_network fragment\_tree\_network\_delta"}
\NormalTok{    list}\OtherTok{=}\ErrorTok{$}\NormalTok{(echo }\SpecialCharTok{$}\NormalTok{default);}
  \ControlFlowTok{else}\NormalTok{ list}\OtherTok{=}\ErrorTok{$}\NormalTok{( echo }\SpecialCharTok{$}\NormalTok{command)}
\NormalTok{  fi;}
  \ControlFlowTok{for}\NormalTok{ option }\ControlFlowTok{in} \SpecialCharTok{$}\NormalTok{(echo }\SpecialCharTok{$}\NormalTok{list)}
\NormalTok{  do}
\NormalTok{    case }\SpecialCharTok{$}\NormalTok{option }\ControlFlowTok{in}
      \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
      \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
      \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
      \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{      structure\_extract}\ErrorTok{)}
\NormalTok{      echo }\StringTok{"Run structure\_extract."}
\NormalTok{      projectpath}\OtherTok{=}\DecValTok{0}
\NormalTok{      until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{canopus\_summary.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{      do}
\NormalTok{        read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{      done;}
\NormalTok{      cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{      mkdir results;}
\NormalTok{      mkdir temp;}
\NormalTok{      mkdir temp}\SpecialCharTok{/}\NormalTok{fintemp;}
      \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{Mo\_filename ]}
\NormalTok{      then rm temp}\SpecialCharTok{/}\NormalTok{Mo\_filename}
\NormalTok{      fi;}
\NormalTok{      data}\OtherTok{=}\StringTok{"*\_*/fingerid/*.tsv"}
\NormalTok{      awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{      BEGIN\{}
\StringTok{      all\_id=0}
\StringTok{      max\_id={-}1}
\StringTok{      p\_id="null"}
\StringTok{      printf "Info: loading the data..."}
\StringTok{    \}}
\StringTok{  \{}
\StringTok{    if(FNR==1)}
\StringTok{      \{}
\StringTok{        if(NR\textgreater{}FNR)}
\StringTok{          \{}
\StringTok{            close(pfile)}
\StringTok{          \}}
\StringTok{        f=split(FILENAME,a,"[/]");}
\StringTok{        n=split(a[1],b,"[\_]");}
\StringTok{        id=b[n];}
\StringTok{        if(id!=p\_id)}
\StringTok{          \{}
\StringTok{            all\_id+=1}
\StringTok{            if(id\textgreater{}max\_id)}
\StringTok{              \{}
\StringTok{                max\_id=id}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{        file[id]=a[1]}
\StringTok{        split(a[f], g, "[.]")}
\StringTok{        formu\_type[id]=g[1]}
\StringTok{        if(all\_id==1)}
\StringTok{          \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{              \{}
\StringTok{                if(($i\textasciitilde{}/inchikey2D/))}
\StringTok{                  \{}
\StringTok{                    col\_2D=i}
\StringTok{                  \}}
\StringTok{                if($i=="inchi")}
\StringTok{                  \{}
\StringTok{                    col\_inchi=i}
\StringTok{                  \}}
\StringTok{                if(($i\textasciitilde{}/Formula/))}
\StringTok{                  \{}
\StringTok{                    col\_formu=i}
\StringTok{                  \}}
\StringTok{                if($i=="score")}
\StringTok{                  \{}
\StringTok{                    col\_score=i}
\StringTok{                  \}}
\StringTok{                if($i=="name")}
\StringTok{                  \{}
\StringTok{                    col\_name=i}
\StringTok{                  \}}
\StringTok{                if($i=="smiles")}
\StringTok{                  \{}
\StringTok{                    col\_smiles=i}
\StringTok{                  \}}
\StringTok{                if($i=="xlogp")}
\StringTok{                  \{}
\StringTok{                    col\_x=i}
\StringTok{                  \}}
\StringTok{                if(($i\textasciitilde{}/imilarity/))}
\StringTok{                  \{}
\StringTok{                    col\_simi=i}
\StringTok{                  \}}
\StringTok{                if($i\textasciitilde{}/links/)}
\StringTok{                  \{}
\StringTok{                    col\_links=i}
\StringTok{                  \}}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{        pfile=FILENAME}
\StringTok{        printf g[1]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"formu\_type[id]"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{        printf "Info: the data of " id " (ID) has input. The filename is " FILENAME ".}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{      \}}
\StringTok{    if(FNR\textgreater{}=2)}
\StringTok{      \{}
\StringTok{        row\_score=$col\_score}
\StringTok{        row\_simi=$col\_simi}
\StringTok{        if(max["score",id]=="" || max["score",id]+0\textless{}row\_score+0)}
\StringTok{          \{}
\StringTok{            max["score",id]=row\_score}
\StringTok{            name["score",id]=$col\_name}
\StringTok{            formula["score",id]=$col\_formu}
\StringTok{            formu\_type["score",id]=formu\_type[id]}
\StringTok{            simi["score",id]=$col\_simi}
\StringTok{            smiles["score",id]=$col\_smiles}
\StringTok{            inchi["score",id]=$col\_inchi}
\StringTok{            in2D["score",id]=$col\_2D}
\StringTok{            score["score",id]=$col\_score}
\StringTok{            xlogp["score",id]=$col\_x}
\StringTok{            links["score",id]=$col\_links}
\StringTok{          \}}
\StringTok{        if(max["simi",id]=="" || max["simi",id]+0\textless{}row\_simi+0)}
\StringTok{          \{}
\StringTok{            max["simi",id]=row\_simi}
\StringTok{            name["simi",id]=$col\_name}
\StringTok{            formula["simi",id]=$col\_formu}
\StringTok{            formu\_type["simi",id]=formu\_type[id]}
\StringTok{            simi["simi",id]=$col\_simi}
\StringTok{            smiles["simi",id]=$col\_smiles}
\StringTok{            inchi["simi",id]=$col\_inchi}
\StringTok{            in2D["simi",id]=$col\_2D}
\StringTok{            score["simi",id]=$col\_score}
\StringTok{            xlogp["simi",id]=$col\_x}
\StringTok{            links["simi",id]=$col\_links}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{END\{}
\StringTok{printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "formula}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "smiles}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchi}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchikey2D}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{  "score}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "xlogp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "links}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/fingerid\_sum.tsv"}
\StringTok{  for(l in file)}
\StringTok{    \{}
\StringTok{      if(max["score",l]!="")}
\StringTok{        \{}
\StringTok{          printf l"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{            name["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  formula["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  simi["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{            smiles["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  inchi["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  in2D["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{            score["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  xlogp["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  links["score",l]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/fingerid\_sum.tsv"}
\StringTok{                      printf formula["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  file[l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  formu\_type["score",l]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "temp/Mo\_filename"}
\StringTok{                    \}}
\StringTok{                  if(max["simi",l]!="" \&\& max["simi",l]!=max["score",l])}
\StringTok{                    \{}
\StringTok{                      printf l"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                        name["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  formula["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  simi["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                        smiles["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  inchi["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  in2D["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                        score["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  xlogp["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  links["simi",l]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/fingerid\_sum.tsv"}
\StringTok{                      \}}
\StringTok{                  \}}
\StringTok{              \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\NormalTok{            data\_sum}\OtherTok{=}\StringTok{"results/fingerid\_sum.tsv"}
\NormalTok{            awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{            \{}
\StringTok{              if(NR==1)}
\StringTok{                \{}
\StringTok{                  for(i=1; i\textless{}=NF; i++)}
\StringTok{                    \{}
\StringTok{                      if($i\textasciitilde{}/id/)}
\StringTok{                        \{}
\StringTok{                          col\_id=i}
\StringTok{                        \}}
\StringTok{                      if($i\textasciitilde{}/score/)}
\StringTok{                        \{}
\StringTok{                          col\_score=i}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{              if(NR\textgreater{}=2)}
\StringTok{                \{}
\StringTok{                  id=$col\_id}
\StringTok{                  if(max\_id+0\textless{}id || max\_id=="")}
\StringTok{                    \{}
\StringTok{                      max\_id=id}
\StringTok{                    \}}
\StringTok{                  if(score[id]+0\textless{}$col\_score+0 || score[id]=="")}
\StringTok{                    \{}
\StringTok{                      score[id]=$col\_score}
\StringTok{                      data[id]=$0}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{          END\{}
\StringTok{          printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "formula}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "smiles}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchi}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchikey2D}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{            "score}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "xlogp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "links}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/fingerid\_first\_score.tsv"}
\StringTok{                      for(i=1; i\textless{}=max\_id; i++)}
\StringTok{                        \{}
\StringTok{                          if(data[i]!="")}
\StringTok{                            \{}
\StringTok{                              printf data[i] "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/fingerid\_first\_score.tsv"}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data\_sum}
\NormalTok{                  echo }\StringTok{"structure\_extract results have been successfully assembled into \textless{}results/fingerid\_sum.tsv\textgreater{} and \textless{}results/fingerid\_first\_score.tsv\textgreater{}"}\NormalTok{;}
\NormalTok{                  ;;}
                  \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
                  \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
                  \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
                  \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{                  classification\_extract\_sum}\ErrorTok{)}
\NormalTok{                  echo }\StringTok{"Run classification\_extract\_sum."}\NormalTok{;}
                  \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{Mo\_filename ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f canopus.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f canopus\_neg.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f .format ]}
\NormalTok{                  then}
\NormalTok{                    echo }\StringTok{"Project path acknowledged."}
                  \ControlFlowTok{else}
\NormalTok{                    until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{canopus.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{                    do}
\NormalTok{                      read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{                    done;}
\NormalTok{                    cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{                  fi;}
\NormalTok{                  data1}\OtherTok{=}\StringTok{"temp/Mo\_filename"}
\NormalTok{                  data2}\OtherTok{=}\StringTok{"canopus.tsv"}
\NormalTok{                  data3}\OtherTok{=}\StringTok{"canopus\_neg.tsv"}
\NormalTok{                  datas}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{                  \{}
\StringTok{                    x=$2"/canopus/"$3".fpt"}
\StringTok{                    if(getline \textless{} x == 1)}
\StringTok{                      \{}
\StringTok{                        printf x" "}
\StringTok{                      \}}
\StringTok{                    close(x)}
\StringTok{                  \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1)}
                \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{                awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{                \{}
\StringTok{                  if(NR==FNR)}
\StringTok{                    \{}
\StringTok{                      i=split($2,s,"[\_]")}
\StringTok{                      the\_id[FNR]=s[i]}
\StringTok{                      n=FNR}
\StringTok{                    \}}
\StringTok{                  if(FILENAME \textasciitilde{} /canopus.tsv/)}
\StringTok{                    \{}
\StringTok{                      if(FNR==1)}
\StringTok{                        \{}
\StringTok{                          for(i=1; i\textless{}=NF; i++)}
\StringTok{                            \{}
\StringTok{                              if($i \textasciitilde{} /\^{}name/)}
\StringTok{                                \{}
\StringTok{                                  col\_class=i}
\StringTok{                                \}}
\StringTok{                              if($i \textasciitilde{} /absolute/)}
\StringTok{                                \{}
\StringTok{                                  col\_abindex=i}
\StringTok{                                \}}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                      if(FNR\textgreater{}=2)}
\StringTok{                        \{}
\StringTok{                          abindex[1,FNR]=$col\_abindex}
\StringTok{                          indexset[$col\_abindex]=$col\_class}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                  if(FILENAME \textasciitilde{} /canopus\_neg.tsv/)}
\StringTok{                    \{}
\StringTok{                      p\_filename=FILENAME}
\StringTok{                      if(FNR==1)}
\StringTok{                        \{}
\StringTok{                          for(i=1; i\textless{}=NF; i++)}
\StringTok{                            \{}
\StringTok{                              if($i \textasciitilde{} /name/)}
\StringTok{                                \{}
\StringTok{                                  col\_class=i}
\StringTok{                                \}}
\StringTok{                              if($i \textasciitilde{} /absolute/)}
\StringTok{                                \{}
\StringTok{                                  col\_abindex=i}
\StringTok{                                \}}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                      if(FNR\textgreater{}=2)}
\StringTok{                        \{}
\StringTok{                          abindex[2,FNR]=$col\_abindex}
\StringTok{                          indexset[$col\_abindex]=$col\_class}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                  if(FILENAME \textasciitilde{} /.fpt/)}
\StringTok{                    \{}
\StringTok{                      if(FNR==1)}
\StringTok{                        \{}
\StringTok{                          close(p\_filename)}
\StringTok{                          printf "Info: data\_file name of " p\_filename " has been input.}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{                          p\_filename=FILENAME}
\StringTok{                          split(FILENAME,a,"[/]");}
\StringTok{                          m=split(a[1],b,"[\_]");}
\StringTok{                          id=b[m];}
\StringTok{                          if(FILENAME \textasciitilde{} /\textbackslash{}+.fpt/)}
\StringTok{                            \{}
\StringTok{                              ion=1}
\StringTok{                            \}}
\StringTok{                          if(FILENAME \textasciitilde{} /\textbackslash{}{-}.fpt/)}
\StringTok{                            \{}
\StringTok{                              ion=2}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                      pp[id,abindex[ion,FNR+1]]=sprintf("\%.3f",$1)}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{              END\{}
\StringTok{              printf "id" \textgreater{} "results/canopus\_pp.tsv"}
\StringTok{              for(i in indexset)}
\StringTok{                \{}
\StringTok{                  ord+=1}
\StringTok{                  orderlist[ord]=i}
\StringTok{                  printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"indexset[i] \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{                \}}
\StringTok{              printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{              for(i=1; i\textless{}=n; i++)}
\StringTok{                \{}
\StringTok{                  printf the\_id[i] \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{                  for(j=1; j\textless{}=ord; j++)}
\StringTok{                    \{}
\StringTok{                      if(pp[the\_id[i],orderlist[j]]=="")}
\StringTok{                        \{}
\StringTok{                          pp[the\_id[i],orderlist[j]]=0}
\StringTok{                        \}}
\StringTok{                      printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"pp[the\_id[i],orderlist[j]] \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{                    \}}
\StringTok{                  printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{                \}}
\StringTok{            \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3 }\SpecialCharTok{$}\NormalTok{datas}
\NormalTok{          echo }\StringTok{"classiication\_extract\_sum have been successfully written into \textless{}results/canopus\_pp.tsv\textgreater{}"}
\NormalTok{          ;;}
          \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
          \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
          \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{          classification\_extract\_filter}\ErrorTok{)}
\NormalTok{          echo }\StringTok{"Run classification\_extract\_filter."}\NormalTok{;}
          \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f results}\SpecialCharTok{/}\NormalTok{canopus\_pp.tsv ]}
\NormalTok{          then}
\NormalTok{            echo }\StringTok{"Project path acknowledged."}
          \ControlFlowTok{else}
\NormalTok{            until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{results}\SpecialCharTok{/}\NormalTok{canopus\_pp.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{results}\SpecialCharTok{/}\NormalTok{canopus\_summary.tsv ]}
\NormalTok{            do}
\NormalTok{              read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{            done;}
\NormalTok{            cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{          fi; }
\NormalTok{          check}\OtherTok{=}\DecValTok{0}
\NormalTok{          until [[ }\StringTok{"$check"} \SpecialCharTok{==} \StringTok{"yes"}\NormalTok{ ]] }\SpecialCharTok{||}\NormalTok{ [[ }\StringTok{"$check"} \SpecialCharTok{==} \StringTok{"no"}\NormalTok{ ]]}
\NormalTok{          do}
\NormalTok{            read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Collate the posterior probabilities of the classification of each feature? [yes/no] \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ check;}
\NormalTok{          done;}
          \ControlFlowTok{if}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{check }\SpecialCharTok{==} \StringTok{"yes"}\NormalTok{ ]]}
\NormalTok{          then}
\NormalTok{            definition\_limit}\OtherTok{=}\DecValTok{0}
\NormalTok{            until [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textgreater{}} \StringTok{"0.01"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textless{}} \StringTok{"1"}\NormalTok{ ]]}
\NormalTok{            do}
\NormalTok{              read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the classes posterior probabilities limition. 0.5\textasciitilde{}0.99 may work well. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ definition\_limit;}
\NormalTok{            done;}
\NormalTok{            data1}\OtherTok{=}\StringTok{"canopus\_summary.tsv"}
\NormalTok{            data2}\OtherTok{=}\StringTok{"canopus.tsv"}
\NormalTok{            data3}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\NormalTok{            awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{            \{}
\StringTok{              if(NR==FNR)}
\StringTok{                \{}
\StringTok{                  if(FNR==1)}
\StringTok{                    \{}
\StringTok{                      p\_file=FILENAME}
\StringTok{                      for(i=1; i\textless{}=NF; i++)}
\StringTok{                        \{}
\StringTok{                          if($i\textasciitilde{}/name/)}
\StringTok{                            \{}
\StringTok{                              col\_id=i}
\StringTok{                            \}}
\StringTok{                          if($i\textasciitilde{}/specific/)}
\StringTok{                            \{}
\StringTok{                              col\_specific=i}
\StringTok{                            \}}
\StringTok{                          if($i\textasciitilde{}/level/)}
\StringTok{                            \{}
\StringTok{                              col\_level=i}
\StringTok{                            \}}
\StringTok{                          if($i\textasciitilde{}/subclass/)}
\StringTok{                            \{}
\StringTok{                              col\_subclass=i}
\StringTok{                            \}}
\StringTok{                          if($i\textasciitilde{}/\^{}class/)}
\StringTok{                            \{}
\StringTok{                              col\_class=i}
\StringTok{                            \}}
\StringTok{                          if($i\textasciitilde{}/superclass/)}
\StringTok{                            \{}
\StringTok{                              col\_superclass=i}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                  if(FNR\textgreater{}=2)}
\StringTok{                    \{}
\StringTok{                      n=split($col\_id,a,"[\_]")}
\StringTok{                      id=a[n]}
\StringTok{                      specific[id]=$col\_specific}
\StringTok{                      level[id]=$col\_level}
\StringTok{                      subclass[id]=$col\_subclass}
\StringTok{                      class[id]=$col\_class}
\StringTok{                      superclass[id]=$col\_superclass}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{              if(FILENAME\textasciitilde{}/canopus.tsv/)}
\StringTok{                \{}
\StringTok{                  if(FNR==1)}
\StringTok{                    \{}
\StringTok{                      close(p\_file)}
\StringTok{                      p\_file=FILENAME}
\StringTok{                      for(i=1; i\textless{}=NF; i++)}
\StringTok{                        \{}
\StringTok{                          if($i\textasciitilde{}/name/)}
\StringTok{                            \{}
\StringTok{                              col\_name=i}
\StringTok{                            \}}
\StringTok{                          if($i\textasciitilde{}/description/)}
\StringTok{                            \{}
\StringTok{                              col\_description=i}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                  if(FNR\textgreater{}=2)}
\StringTok{                    \{}
\StringTok{                      description[$col\_name]=$col\_description}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{              if(FILENAME\textasciitilde{}"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data3}\StringTok{\textquotesingle{}")}
\StringTok{                \{}
\StringTok{                  if(FNR==1)}
\StringTok{                    \{}
\StringTok{                      close(p\_file)}
\StringTok{                      for(i=1; i\textless{}=NF; i++)}
\StringTok{                        \{}
\StringTok{                          if($i\textasciitilde{}/\^{}id$/)}
\StringTok{                            \{}
\StringTok{                              col\_id=i}
\StringTok{                            \}}
\StringTok{                          if(i\textgreater{}=2)}
\StringTok{                            \{}
\StringTok{                              col\_class\_name[i]=$i}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                      printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition\_source}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition\_description}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                        "specific}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "specific\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "level\_5}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "level\_5\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                        "subclass}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "subclass\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "class}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "class\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "superclass}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "superclass\_pp}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textbackslash{}}
\StringTok{                        \textgreater{} "results/stat\_classification.tsv"}
\StringTok{                      \}}
\StringTok{                    if(FNR\textgreater{}=2)}
\StringTok{                      \{}
\StringTok{                        for(i=2; i\textless{}=NF; i++)}
\StringTok{                          \{}
\StringTok{                            c\_pp[col\_class\_name[i]]=sprintf("\%.4f",$i)}
\StringTok{                          \}}
\StringTok{                        if(level[$col\_id] != "" \&\& c\_pp[level[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{                          \{}
\StringTok{                            definition\_source="level\_5"}
\StringTok{                            definition=level[$col\_id]}
\StringTok{                          \}}
\StringTok{                      else if(subclass[$col\_id] != "" \&\& c\_pp[subclass[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{                        \{}
\StringTok{                          definition\_source="subclass"}
\StringTok{                          definition=subclass[$col\_id]}
\StringTok{                        \}}
\StringTok{                    else if(class[$col\_id] != "" \&\& c\_pp[class[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{                      \{}
\StringTok{                        definition\_source="class"}
\StringTok{                        definition=class[$col\_id]}
\StringTok{                      \}}
\StringTok{                  else if(superclass[$col\_id] != "" \&\& c\_pp[superclass[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{                    \{}
\StringTok{                      definition\_source="superclass"}
\StringTok{                      definition=superclass[$col\_id]}
\StringTok{                    \}}
\StringTok{                else}
\StringTok{                  \{}
\StringTok{                    definition\_source="null"}
\StringTok{                    definition="null"}
\StringTok{                    c\_pp[definition]="null"}
\StringTok{                    description[definition]="null"}
\StringTok{                  \}}
\StringTok{                printf $col\_id"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  definition\_source"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  definition"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[definition]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  description[definition]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                  specific[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[specific[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  level[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[level[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                  subclass[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[subclass[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  class[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[class[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                  superclass[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[superclass[$col\_id]]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/stat\_classification.tsv"}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\NormalTok{      echo }\StringTok{"classification\_extract\_filter have been successfully written into \textless{}results/stat\_classification.tsv\textgreater{}"}
\NormalTok{                  fi;}
\NormalTok{                  ;;}
                  \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
                  \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
                  \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
                  \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{                  fragment\_tree\_network}\ErrorTok{)}
\NormalTok{                  echo }\StringTok{"Run fragment\_tree\_network."}\NormalTok{;}
                  \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{d temp ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f .format ]}
\NormalTok{                  then}
\NormalTok{                    echo }\StringTok{"Project path acknowledged."}
                  \ControlFlowTok{else}
\NormalTok{                    until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{                    do}
\NormalTok{                      read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project. Make sure you have moved the fragment tree alignment results to the directory where the project is located. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{                    done;}
\NormalTok{                    cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{                  fi;}
\NormalTok{                  echo }\StringTok{"Please enter the minimum alignment similarity(tlimit) that you want to filter."}
\NormalTok{                  tlimit}\OtherTok{=}\DecValTok{0}
\NormalTok{                  until [[ }\StringTok{"$tlimit"} \SpecialCharTok{\textgreater{}} \StringTok{"0.01"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$tlimit"} \SpecialCharTok{\textless{}} \StringTok{"0.99"}\NormalTok{ ]]}
\NormalTok{                  do}
\NormalTok{                    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"0.4{-}0.7 is recommended \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ tlimit;}
\NormalTok{                  done;}
                  \ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{d temp}\SpecialCharTok{/}\NormalTok{ftaligntemp ]}
\NormalTok{                  then }
\NormalTok{                    mkdir temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}
\NormalTok{                  fi;}
\NormalTok{                  data}\OtherTok{=}\StringTok{"ftalign.tsv"}
\NormalTok{                  savepath}\OtherTok{=}\StringTok{"temp/ftaligntemp/tmp"}
\NormalTok{                  awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{                  \{}
\StringTok{                    printf "Info: NR = " NR ". FNR = " FNR ".}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{                    if(NR==FNR)}
\StringTok{                      \{}
\StringTok{                        for(i=1; i\textless{}=NF; i++)}
\StringTok{                          \{}
\StringTok{                            if(NR==1 \&\& i!=1 || NR!=1 \&\& i==1)}
\StringTok{                              \{}
\StringTok{                                n=split($i,x,"[\_]")}
\StringTok{                                raw[NR,i]=x[n]}
\StringTok{                              \}}
\StringTok{                          else}
\StringTok{                            \{}
\StringTok{                              if(NR==i)}
\StringTok{                                \{}
\StringTok{                                  raw\_norm[NR,i]=$i}
\StringTok{                                \}}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                  if(NR\textgreater{}FNR \&\& FNR\textgreater{}=2)}
\StringTok{                    \{}
\StringTok{                      for(i=2; i\textless{}=NF; i++)}
\StringTok{                        \{}
\StringTok{                          norm1=$i/raw\_norm[i,i]}
\StringTok{                          norm2=$i/raw\_norm[FNR,FNR]}
\StringTok{                          norms=sprintf("\%.2f", ((norm1+norm2)/2))}
\StringTok{                          if((norms+0 \textgreater{} \textquotesingle{}}\SpecialCharTok{$}\NormalTok{tlimit}\StringTok{\textquotesingle{}+0))}
\StringTok{                            \{}
\StringTok{                              if(raw[FNR,1]+0\textgreater{}=raw[1,i]+0)}
\StringTok{                                \{}
\StringTok{                                  print raw[FNR,1], raw[1,i], norms \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                                \}}
\StringTok{                              if(raw[FNR,1]+0\textless{}raw[1,i]+0)}
\StringTok{                                \{}
\StringTok{                                  print raw[1,i], raw[FNR,1], norms \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                                \}}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data }\SpecialCharTok{$}\NormalTok{data}
\NormalTok{              sort }\SpecialCharTok{{-}}\NormalTok{u }\SpecialCharTok{$}\NormalTok{savepath }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{tmp2}
\NormalTok{              savepath}\OtherTok{=}\StringTok{"temp/ftaligntemp/filter\_net\_$tlimit"}
\NormalTok{              awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{              \{}
\StringTok{                if(NR==FNR)}
\StringTok{                  \{}
\StringTok{                    if($1!=$2)}
\StringTok{                      \{}
\StringTok{                        replink[$1]=$1}
\StringTok{                        replink[$2]=$2}
\StringTok{                      \}}
\StringTok{                  \}}
\StringTok{                if(NR!=FNR)}
\StringTok{                  \{}
\StringTok{                    if($1!=$2)}
\StringTok{                      \{}
\StringTok{                        printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" }
\StringTok{                      \} }
\StringTok{                    if($1==$2)}
\StringTok{                      \{}
\StringTok{                        if(replink[$1]=="")}
\StringTok{                          \{}
\StringTok{                            printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                          \}}
\StringTok{                      \}}
\StringTok{                  \}}
\StringTok{              \}\textquotesingle{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{tmp2 temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{tmp2}
\NormalTok{            echo }\StringTok{"fragment\_tree\_network have been successfully written into \textless{}temp/ftaligntemp/filter\_net\_$tlimit\textgreater{}"}
\NormalTok{            ;;}
            \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
            \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
            \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
            \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{            fragment\_tree\_network\_delta}\ErrorTok{)}
            \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{d temp ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f .format ]}
\NormalTok{            then}
\NormalTok{              echo }\StringTok{"Project path acknowledged."}
            \ControlFlowTok{else}
\NormalTok{              until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{              do}
\NormalTok{                read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{              done;}
\NormalTok{              cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{                        fi;}
\NormalTok{                        echo }\StringTok{"The following module attempts to compute the differential fingerprints of connected clusters based on the molecular fingerprint results of sirius 4."}
                        \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
                        \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
                        \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{                        plimit}\OtherTok{=}\DecValTok{0}
\NormalTok{                        until [[ }\StringTok{"$plimit"} \SpecialCharTok{\textgreater{}} \StringTok{"0.5"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$plimit"} \SpecialCharTok{\textless{}} \StringTok{"0.99"}\NormalTok{ ]]}
\NormalTok{                        do}
\NormalTok{                          read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"If the minimum alignment similarity is greater than 0.3, this step will automatic calculate the discrepancy fingerprint between alignment features(in beta). Please enter the minimum posterior probability of the molecular fingerprint(plimit\_1) to be filtered. 0.9{-}0.99 is recommended. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ plimit;}
\NormalTok{                        done;}
\NormalTok{                        plimit2}\OtherTok{=}\DecValTok{0}
\NormalTok{                        until [[ }\StringTok{"$plimit2"} \SpecialCharTok{\textgreater{}} \StringTok{"0.1"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$plimit2"} \SpecialCharTok{\textless{}} \StringTok{"$plimit"}\NormalTok{ ]]}
\NormalTok{                        do}
\NormalTok{                          read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"The minimum posterior probability of the molecular fingerprint(plimit\_2) to be controled. 0.1{-}0.5 may work well. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ plimit2;}
\NormalTok{                        done;}
\NormalTok{                        tlimit}\OtherTok{=}\ErrorTok{$}\NormalTok{(ls temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{filter\_net\_}\SpecialCharTok{*} \ErrorTok{|}\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F \_ }\StringTok{\textquotesingle{}\{print $NF\}\textquotesingle{}}\NormalTok{)}
\NormalTok{                        check\_rep}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}END\{print NR\}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$tlimit"}\NormalTok{))}
                        \ControlFlowTok{if}\NormalTok{ [[ }\StringTok{"$check\_rep"} \SpecialCharTok{\textgreater{}} \StringTok{"1"}\NormalTok{ ]]}
\NormalTok{                        then}
\NormalTok{                          tlimit}\OtherTok{=}\DecValTok{0}
\NormalTok{                          until [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{filter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit ]}
\NormalTok{                          do}
\NormalTok{                            read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Plural and different fragment\_tree\_network files were found to exist locally. Please select a tlimit parameter you have utilized to run fragment\_tree\_network\_delta. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ tlimit;}
\NormalTok{                          done;}
\NormalTok{                        fi;}
                        \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{refilter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit ]}
\NormalTok{                        then rm temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{refilter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit}
\NormalTok{                        fi;}
                        \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{fpsample ]}
\NormalTok{                        then rm temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{fpsample}
\NormalTok{                        fi;}
\NormalTok{                        echo }\StringTok{"Running delta\_fingerprint computation..."}
\NormalTok{                        echo }\StringTok{"Aquiring data from sirius index..."}
\NormalTok{                        data1}\OtherTok{=}\StringTok{"*\_*/compound.info"}
\NormalTok{                        data2}\OtherTok{=}\StringTok{"temp/ftaligntemp/filter\_net\_$tlimit"}
\NormalTok{                        echo }\StringTok{"Run fragment\_tree\_network\_delta."}
\NormalTok{                        savepath}\OtherTok{=}\StringTok{"temp/ms\_data\_$tlimit"}
\NormalTok{                        echo }\StringTok{"step 1: ms data"}
                        \ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{savepath ]}
\NormalTok{                        then}
\NormalTok{                          awk }\SpecialCharTok{{-}}\NormalTok{F }\StringTok{"[}\SpecialCharTok{\textbackslash{}t}\StringTok{]||[:]||[\_]"} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{                          BEGIN\{  }
\StringTok{                          printf "..."}
\StringTok{                          printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "m/z}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "rt}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{                        \}}
\StringTok{                      \{}
\StringTok{                        if(FILENAME\textasciitilde{}/compound.info/)}
\StringTok{                          \{}
\StringTok{                            if(FNR==1)}
\StringTok{                              \{}
\StringTok{                                printf "Info: catch \textgreater{}\textgreater{}\textgreater{} "FILENAME"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{                              \}}
\StringTok{                            if($1=="name")}
\StringTok{                              \{}
\StringTok{                                i+=1;}
\StringTok{                                id[i]=$NF;}
\StringTok{                                n=split($NF,a,"[\_]")}
\StringTok{                                printf a[n]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{                              \}}
\StringTok{                            if($1=="ionMass")}
\StringTok{                              \{}
\StringTok{                                mz[id[i]]=$NF}
\StringTok{                                printf sprintf("\%.4f",$NF)"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{                              \}}
\StringTok{                            if($1=="ionType")}
\StringTok{                              \{}
\StringTok{                                type[id[i]]=$NF}
\StringTok{                              \}}
\StringTok{                            if($1=="rt")}
\StringTok{                              \{}
\StringTok{                                rt[id[i]]=$2;}
\StringTok{                                printf sprintf("\%.2f",$2/60)"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{                              \}}
\StringTok{                          \}}
\StringTok{                        if(FILENAME\textasciitilde{}/ftaligntemp/)}
\StringTok{                          \{}
\StringTok{                            \#source  target  ftalign  delta\_mz  delta\_rt  source\_iontype  target\_iontype;}
\StringTok{                            if(FNR==1)}
\StringTok{                              \{}
\StringTok{                                printf "" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                              \}}
\StringTok{                            print $1,$2,$3,sprintf("\%.3f",mz[$2]{-}mz[$1]),sprintf("\%.2f",rt[$2]{-}rt[$1]),type[$1],type[$2] \textbackslash{}}
\StringTok{                              \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                            \}}
\StringTok{                        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
\NormalTok{                            fi;}
                            \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{                            echo }\StringTok{"step 2: data path"}
\NormalTok{                            source\_file}\OtherTok{=}\StringTok{"temp/Mo\_filename"}
\NormalTok{                            data}\OtherTok{=}\StringTok{"temp/ms\_data\_$tlimit"}
\NormalTok{                            savepath}\OtherTok{=}\StringTok{"temp/datapath\_$tlimit"}
                            \ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{savepath ]}
\NormalTok{                            then}
\NormalTok{                              awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{                              \{}
\StringTok{                                if(NR==FNR)}
\StringTok{                                  \{}
\StringTok{                                    n=split($2, a, "[\_]")}
\StringTok{                                    file[a[n]]=$2}
\StringTok{                                    formu\_type[a[n]]=$3}
\StringTok{                                  \}}
\StringTok{                                if(NR!=FNR)}
\StringTok{                                  \{}
\StringTok{                                    \#\textless{}path\textgreater{}sourceFormula  \textless{}path\textgreater{}targetFormula}
\StringTok{                                    path1=file[$1]"/fingerprints/"formu\_type[$1]".fpt"}
\StringTok{                                    path2=file[$2]"/fingerprints/"formu\_type[$2]".fpt"}
\StringTok{                                    data[path1]=path1}
\StringTok{                                    data[path2]=path2}
\StringTok{                                  \}}
\StringTok{                              \}}
\StringTok{                            END\{}
\StringTok{                            for(i in data)}
\StringTok{                              \{}
\StringTok{                                n+=1}
\StringTok{                                print "Check file:",n}
\StringTok{                                if(getline\textless{}i=={-}1)}
\StringTok{                                  \{}
\StringTok{                                    printf "Escape filename: " i "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{                                  \}}
\StringTok{                              else}
\StringTok{                                \{}
\StringTok{                                  printf i" " \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                                \}}
\StringTok{                              close(i)}
\StringTok{                            \}}
\StringTok{                          print "Sum:",n}
\StringTok{                        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{source\_file }\SpecialCharTok{$}\NormalTok{data}
\NormalTok{                                fi;}
\NormalTok{                                datapath}\OtherTok{=}\ErrorTok{$}\NormalTok{(cat temp}\SpecialCharTok{/}\NormalTok{datapath\_}\SpecialCharTok{$}\NormalTok{tlimit)}
\NormalTok{                                echo }\StringTok{"step 3: fingerprint"}
\NormalTok{                                data\_allfp}\OtherTok{=}\StringTok{"temp/data\_allfp\_$tlimit"}
                                \ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{data\_allfp ]}
\NormalTok{                                then}
\NormalTok{                                  awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{                                  BEGIN\{}
\StringTok{                                  n=0}
\StringTok{                                \}}
\StringTok{                              \{}
\StringTok{                                if(FNR==1)}
\StringTok{                                  \{}
\StringTok{                                    if(n\textgreater{}1)}
\StringTok{                                      \{}
\StringTok{                                        close(file)}
\StringTok{                                      \}}
\StringTok{                                    file=FILENAME;}
\StringTok{                                    print "Get fingerprints: ",FILENAME}
\StringTok{                                    n+=1;}
\StringTok{                                    printf FILENAME"}\SpecialCharTok{\textbackslash{}n}\StringTok{"$0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data\_allfp}\StringTok{\textquotesingle{}"}
\StringTok{                                  \}}
\StringTok{                              else}
\StringTok{                                \{}
\StringTok{                                  print $0 \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data\_allfp}\StringTok{\textquotesingle{}"}
\StringTok{                                \}}
\StringTok{                            \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{datapath}
\NormalTok{                                    fi;}
                                    \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{                                    awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{                                    \{}
\StringTok{                                      if(NR==1)}
\StringTok{                                        \{}
\StringTok{                                          for(i=1; i\textless{}=NF; i++)}
\StringTok{                                            \{}
\StringTok{                                              if($i\textasciitilde{}/absolute/)}
\StringTok{                                                \{}
\StringTok{                                                  col\_index=i}
\StringTok{                                                \}}
\StringTok{                                              if($i\textasciitilde{}/description/)}
\StringTok{                                                \{}
\StringTok{                                                  col\_description=i}
\StringTok{                                                \}}
\StringTok{                                            \}}
\StringTok{                                        \}}
\StringTok{                                      if(NR\textgreater{}=2)}
\StringTok{                                        \{}
\StringTok{                                          print $col\_index,$col\_description}
\StringTok{                                        \}}
\StringTok{                                    \}\textquotesingle{}}\NormalTok{ csi\_fingerid.tsv }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{pos\_fingerprint\_index;}
\NormalTok{                                  awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{                                  \{}
\StringTok{                                    if(NR==1)}
\StringTok{                                      \{}
\StringTok{                                        for(i=1; i\textless{}=NF; i++)}
\StringTok{                                          \{}
\StringTok{                                            if($i\textasciitilde{}/absolute/)}
\StringTok{                                              \{}
\StringTok{                                                col\_index=i}
\StringTok{                                              \}}
\StringTok{                                            if($i\textasciitilde{}/description/)}
\StringTok{                                              \{}
\StringTok{                                                col\_description=i}
\StringTok{                                              \}}
\StringTok{                                          \}}
\StringTok{                                      \}}
\StringTok{                                    if(NR\textgreater{}=2)}
\StringTok{                                      \{}
\StringTok{                                        print $col\_index,$col\_description}
\StringTok{                                      \}}
\StringTok{                                  \}\textquotesingle{}}\NormalTok{ csi\_fingerid\_neg.tsv }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{neg\_fingerprint\_index;}
\NormalTok{                                posindex}\OtherTok{=}\StringTok{"temp/ftaligntemp/pos\_fingerprint\_index"}
\NormalTok{                                negindex}\OtherTok{=}\StringTok{"temp/ftaligntemp/neg\_fingerprint\_index"}
\NormalTok{                                data}\OtherTok{=}\StringTok{"temp/ms\_data\_$tlimit"}
\NormalTok{                                echo }\StringTok{"step 4: merge data"}
\NormalTok{                                awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{                                BEGIN\{}
\StringTok{                                file=0}
\StringTok{                                x=0}
\StringTok{                                count=0}
\StringTok{                                f=0}
\StringTok{                                posnum=0}
\StringTok{                                negnum=0}
\StringTok{                              \}}
\StringTok{                            \{}
\StringTok{                              if(FNR==1)}
\StringTok{                                \{}
\StringTok{                                  file+=1}
\StringTok{                                \}}
\StringTok{                              if(NR==FNR)}
\StringTok{                                \{}
\StringTok{                                  if(($1\textasciitilde{}/fingerprint/))}
\StringTok{                                    \{}
\StringTok{                                      if(x+0\textgreater{}f+0)}
\StringTok{                                        \{}
\StringTok{                                          f=x  \# calculate the max index.}
\StringTok{                                        \}}
\StringTok{                                      count+=1;  \# calculate the all fingerprints file number.}
\StringTok{                                      split($1,a,"[/]"); e=split(a[1],b,"[\_]"); id=b[e]; \#catch the id.}
\StringTok{                                      x=0;}
\StringTok{                                    \}}
\StringTok{                                else}
\StringTok{                                  \{}
\StringTok{                                    x+=1;}
\StringTok{                                    fp[id,x]=$1;}
\StringTok{                                  \}}
\StringTok{                              \}}
\StringTok{                            if(file==2)}
\StringTok{                              \{}
\StringTok{                                pos[FNR]=$1}
\StringTok{                                posnum+=1}
\StringTok{                              \}}
\StringTok{                            if(file==3)}
\StringTok{                              \{}
\StringTok{                                neg[FNR]=$1}
\StringTok{                                negnum+=1}
\StringTok{                              \}}
\StringTok{                            if(file==4)}
\StringTok{                              \{}
\StringTok{                                if("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tlimit}\StringTok{\textquotesingle{}"+0 \textgreater{}= 0.3)}
\StringTok{                                  \{}
\StringTok{                                    if(fp[$1,1]!="" \&\& fp[$2,1]!="")}
\StringTok{                                      \{}
\StringTok{                                        n1=split($6, g, "[]]");}
\StringTok{                                        n2=split($7, h, "[]]");}
\StringTok{                                        if(g[n1]=="+" \&\& h[n2]=="+")}
\StringTok{                                          \{}
\StringTok{                                            for(x=1; x\textless{}=posnum; x++)}
\StringTok{                                              \{}
\StringTok{                                                if(fp[$1,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                                                  \{}
\StringTok{                                                    data\_s[FNR,x]=pos[x]}
\StringTok{                                                  \}}
\StringTok{                                              else if(fp[$2,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                                                \{}
\StringTok{                                                  data\_t[FNR,x]=pos[x]}
\StringTok{                                                \}}
\StringTok{                                            \}}
\StringTok{                                        \}}
\StringTok{                                      if(g[n1]=="{-}" \&\& h[n2]=="{-}")}
\StringTok{                                        \{}
\StringTok{                                          for(x=1; x\textless{}=negnum; x++)}
\StringTok{                                            \{}
\StringTok{                                              if(fp[$1,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                                                \{}
\StringTok{                                                  data\_s[FNR,x]=neg[x]}
\StringTok{                                                \}}
\StringTok{                                            else if(fp[$2,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                                              \{}
\StringTok{                                                data\_t[FNR,x]=neg[x]}
\StringTok{                                              \}}
\StringTok{                                          \}}
\StringTok{                                      \}}
\StringTok{                                    if(g[n1]=="{-}" \&\& h[n2]=="+" || h[n2]=="{-}" \&\& g[n1]=="+")}
\StringTok{                                      \{}
\StringTok{                                        for(i=1; i\textless{}=posnum; i++)}
\StringTok{                                          \{}
\StringTok{                                            for(j=1; j\textless{}=negnum; j++)}
\StringTok{                                              \{}
\StringTok{                                                if(pos[i]==neg[j])}
\StringTok{                                                  \{}
\StringTok{                                                    mirror[i]=j  \#if pos=i, the identical index of neg is mirror[i]}
\StringTok{                                                  \}}
\StringTok{                                              \}}
\StringTok{                                          \}}
\StringTok{                                      \}}
\StringTok{                                    if(g[n1]=="{-}" \&\& h[n2]=="+") }
\StringTok{                                      \{}
\StringTok{                                        for(x=1; x\textless{}=f; x++)}
\StringTok{                                          \{}
\StringTok{                                            if(fp[$1,mirror[x]]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                                              \{}
\StringTok{                                                data\_s[FNR,x]=neg[mirror[x]]}
\StringTok{                                              \}}
\StringTok{                                          else if(fp[$2,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,mirror[x]]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                                            \{}
\StringTok{                                              data\_t[FNR,x]=neg[mirror[x]]}
\StringTok{                                            \}}
\StringTok{                                        \}}
\StringTok{                                    \}}
\StringTok{                                  if(h[n2]=="{-}" \&\& g[n1]=="+")}
\StringTok{                                    \{}
\StringTok{                                      for(x=1; x\textless{}=f; x++)}
\StringTok{                                        \{}
\StringTok{                                          if(fp[$1,x]+0\textgreater{}= \textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,mirror[x]]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                                            \{}
\StringTok{                                              data\_s[FNR,x]=neg[mirror[x]]}
\StringTok{                                            \}}
\StringTok{                                        else if(fp[$2,mirror[x]]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                                          \{}
\StringTok{                                            data\_t[FNR,x]=neg[mirror[x]]}
\StringTok{                                          \}}
\StringTok{                                      \}   }
\StringTok{                                  \}}
\StringTok{                              \}}
\StringTok{                          \}}
\StringTok{                        if(FNR==1)}
\StringTok{                          \{}
\StringTok{                            printf "source}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "target}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "ftalign\_similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "delta\_m/z}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "source\_fp\_uniq}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "target\_fp\_uniq}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{                          \}}
\StringTok{                      else}
\StringTok{                        \{}
\StringTok{                          printf $1"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $2"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $3"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $4"}\SpecialCharTok{\textbackslash{}t}\StringTok{";}
\StringTok{                          if(\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tlimit}\StringTok{\textquotesingle{}+0 \textgreater{}= 0.3)}
\StringTok{                            \{}
\StringTok{                              if(fp[$1,1]=="" || fp[$2,1]=="")}
\StringTok{                                \{}
\StringTok{                                  printf "NA@NA}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{                                \}}
\StringTok{                            else}
\StringTok{                              \{}
\StringTok{                                printf "source:"  \#the source fingerprint uniq.}
\StringTok{                                for(x=1; x\textless{}=f; x++)}
\StringTok{                                  \{}
\StringTok{                                    if(data\_s[FNR,x]!="")}
\StringTok{                                      \{}
\StringTok{                                        printf data\_s[FNR,x]","}
\StringTok{                                      \}}
\StringTok{                                  \};}
\StringTok{                                printf "@target:"  \#the target fingerprint uniq.}
\StringTok{                                for(x=1; x\textless{}=f; x++)}
\StringTok{                                  \{}
\StringTok{                                    if(data\_t[FNR,x]!="")}
\StringTok{                                      \{}
\StringTok{                                        printf data\_t[FNR,x]","}
\StringTok{                                      \}}
\StringTok{                                  \}}
\StringTok{                                printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{                              \}}
\StringTok{                          \}}
\StringTok{                      else}
\StringTok{                        \{}
\StringTok{                          printf "NA@NA}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data\_allfp }\SpecialCharTok{$}\NormalTok{posindex }\SpecialCharTok{$}\NormalTok{negindex }\SpecialCharTok{$}\NormalTok{data }\SpecialCharTok{|}\NormalTok{ sed }\SpecialCharTok{{-}}\NormalTok{e }\StringTok{\textquotesingle{}s/,@/}\SpecialCharTok{\textbackslash{}t}\StringTok{/g; s/,$//g; s/@/}\SpecialCharTok{\textbackslash{}t}\StringTok{/g\textquotesingle{}}\NormalTok{ \textbackslash{}}
              \SpecialCharTok{\textgreater{}}\NormalTok{ results}\SpecialCharTok{/}\NormalTok{source\_target\_tree\_}\SpecialCharTok{$}\NormalTok{tlimit.tsv;}
\NormalTok{                          echo }\StringTok{"All instances have written into \textless{}results/source\_target\_tree\_$tlimit.tsv\textgreater{}."}
                          \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{                          echo }\StringTok{"step 5: separate child{-}nebula from parent{-}nebula."}
\NormalTok{                          data}\OtherTok{=}\StringTok{"results/stat\_classification.tsv"}
\NormalTok{                          savepath}\OtherTok{=}\StringTok{"temp/filter\_0\_class.tsv"}
\NormalTok{                          awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{                          \{}
\StringTok{                            if(FNR==1)}
\StringTok{                              \{}
\StringTok{                                for(i=1; i\textless{}=NF; i++)}
\StringTok{                                  \{}
\StringTok{                                    if($i\textasciitilde{}/\^{}definition$/)}
\StringTok{                                      \{}
\StringTok{                                        col\_class=i}
\StringTok{                                      \}}
\StringTok{                                  \}}
\StringTok{                              \}}
\StringTok{                            if(FNR\textgreater{}=2)}
\StringTok{                              \{}
\StringTok{                                class[$col\_class]=$col\_class}
\StringTok{                              \}}
\StringTok{                          \}}
\StringTok{                        END\{}
\StringTok{                        for(i in class)}
\StringTok{                          \{}
\StringTok{                            printf class[i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                          \}}
\StringTok{                      \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
                    \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{                    data1}\OtherTok{=}\StringTok{"temp/filter\_0\_class.tsv"} 
\NormalTok{                    data2}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\NormalTok{                    data3}\OtherTok{=}\StringTok{"results/fingerid\_first\_score.tsv"}
\NormalTok{                    until [[ }\StringTok{"$similarity\_limit"} \SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$similarity\_limit"} \SpecialCharTok{\textless{}} \DecValTok{1}\NormalTok{ ]]}
\NormalTok{                    do}
\NormalTok{                      read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please set the Tanimoto similarity threshold contribute to child{-}nebula. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ similarity\_limit;}
\NormalTok{                    done;}
\NormalTok{                    until [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textgreater{}} \FloatTok{0.01}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textless{}} \DecValTok{1}\NormalTok{ ]]}
\NormalTok{                    do}
\NormalTok{                      read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the classes posterior probabilities limition. 0.5\textasciitilde{}0.99 may work well. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ definition\_limit;}
\NormalTok{                    done;}
\NormalTok{                    class\_pp\_limit}\OtherTok{=}\ErrorTok{$}\NormalTok{definition\_limit}
\NormalTok{                    savepath}\OtherTok{=}\StringTok{"temp/idenfication\_filter\_$class\_pp\_limit.tsv"}
\NormalTok{                    awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{                    \{}
\StringTok{                      if(NR==FNR)}
\StringTok{                        \{}
\StringTok{                          filter\_class[$1]=$1}
\StringTok{                        \}}
\StringTok{                      if(FILENAME\textasciitilde{}/canopus/)}
\StringTok{                        \{}
\StringTok{                          if(FNR==1)}
\StringTok{                            \{}
\StringTok{                              col\_id=1}
\StringTok{                              for(i=2; i\textless{}=NF; i++)}
\StringTok{                                \{}
\StringTok{                                  for(j in filter\_class)}
\StringTok{                                    \{}
\StringTok{                                      if(j==$i)}
\StringTok{                                        \{}
\StringTok{                                          col\_class[j]=i}
\StringTok{                                          print i}
\StringTok{                                        \}}
\StringTok{                                    \}}
\StringTok{                                \}}
\StringTok{                            \}}
\StringTok{                          if(FNR\textgreater{}=2)}
\StringTok{                            \{}
\StringTok{                              for(i in col\_class)}
\StringTok{                                \{}
\StringTok{                                  if(sprintf("\%.3f",$col\_class[i])+0\textgreater{}="\textquotesingle{}}\SpecialCharTok{$}\NormalTok{class\_pp\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{                                    \{}
\StringTok{                                      class\_set[i,$col\_id]=i}
\StringTok{                                      print "ID: ",$1,i,$col\_class[i]}
\StringTok{                                    \}}
\StringTok{                                \}}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                      if(FILENAME\textasciitilde{}/fingerid\_first\_score/)}
\StringTok{                        \{}
\StringTok{                          if(FNR==1)}
\StringTok{                            \{}
\StringTok{                              for(i=1; i\textless{}=NF; i++)}
\StringTok{                                \{}
\StringTok{                                  if($i\textasciitilde{}/\^{}id/)}
\StringTok{                                    \{}
\StringTok{                                      col\_id=i}
\StringTok{                                    \}}
\StringTok{                                  if($i\textasciitilde{}/similarity/)}
\StringTok{                                    \{}
\StringTok{                                      col\_similarity=i}
\StringTok{                                    \}}
\StringTok{                                \}}
\StringTok{                              printf "class\_nebula\_facet}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                            \}}
\StringTok{                          if(FNR\textgreater{}=2)}
\StringTok{                            \{}
\StringTok{                              if($col\_similarity+0 \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{similarity\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{                                \{}
\StringTok{                                  for(i in class\_set)}
\StringTok{                                    \{}
\StringTok{                                      if(i\textasciitilde{}"}\SpecialCharTok{\textbackslash{}034}\StringTok{"$col\_id"$")}
\StringTok{                                        \{}
\StringTok{                                          printf class\_set[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                                        \}}
\StringTok{                                    \}}
\StringTok{                                \}}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
                  \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{                  data}\OtherTok{=}\StringTok{"temp/idenfication\_filter\_$class\_pp\_limit.tsv"}
\NormalTok{                  savepath}\OtherTok{=}\StringTok{"temp/idenfication\_filter2\_$\{class\_pp\_limit\}.tsv"}
\NormalTok{                  until [[ }\StringTok{"$num\_limit\_1"} \SpecialCharTok{{-}}\NormalTok{gt }\DecValTok{0}\NormalTok{ ]]}
\NormalTok{                  do}
\NormalTok{                    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the features number threshold contribute to child{-}nebula (min number). \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ num\_limit\_1;}
\NormalTok{                  done;}
\NormalTok{                  until [[ }\StringTok{"$num\_limit\_2"} \SpecialCharTok{{-}}\NormalTok{gt }\StringTok{"$num\_limit\_1"}\NormalTok{ ]]}
\NormalTok{                  do}
\NormalTok{                    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the features number threshold contribute to child{-}nebula (max number). \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ num\_limit\_2;}
\NormalTok{                  done;}
\NormalTok{                  awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{                  \{}
\StringTok{                    if(FNR==1)}
\StringTok{                      \{}
\StringTok{                        printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                        for(i=1; i\textless{}=NF; i++)}
\StringTok{                          \{}
\StringTok{                            if($i\textasciitilde{}/class\_nebula\_facet/)}
\StringTok{                              \{}
\StringTok{                                col\_class=i}
\StringTok{                              \}}
\StringTok{                          \}}
\StringTok{                      \}}
\StringTok{                    if(FNR\textgreater{}=2)}
\StringTok{                      \{}
\StringTok{                        num[$col\_class]+=1}
\StringTok{                        data[FNR]=$0}
\StringTok{                        class[FNR]=$col\_class}
\StringTok{                      \}}
\StringTok{                  \}}
\StringTok{                END\{}
\StringTok{                for(i in num)}
\StringTok{                  \{}
\StringTok{                    if(num[i]+0 \textgreater{}= \textquotesingle{}}\SpecialCharTok{$}\NormalTok{num\_limit\_1}\StringTok{\textquotesingle{}+0 \&\& num[i]+0 \textless{}= \textquotesingle{}}\SpecialCharTok{$}\NormalTok{num\_limit\_2}\StringTok{\textquotesingle{})}
\StringTok{                      \{}
\StringTok{                        printf "The nodes number of the child{-}nebula is " num[i] ".}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{                        for(j in class)}
\StringTok{                          \{}
\StringTok{                            if(class[j]==i)}
\StringTok{                              \{}
\StringTok{                                printf data[j]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                              \}}
\StringTok{                          \}}
\StringTok{                      \}}
\StringTok{                  \}}
\StringTok{              \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
            \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{            mkdir results}\SpecialCharTok{/}\NormalTok{network\_facet\_}\SpecialCharTok{$}\NormalTok{class\_pp\_limit}
\NormalTok{            data1}\OtherTok{=}\StringTok{"temp/idenfication\_filter2\_$\{class\_pp\_limit\}.tsv"}
\NormalTok{            data2}\OtherTok{=}\StringTok{"results/source\_target\_tree\_$tlimit.tsv"} \CommentTok{\# "results/source\_target\_tree\_0.4.tsv"}
\NormalTok{            save\_class}\OtherTok{=}\StringTok{"results/filter\_child\_class.tsv"}
\NormalTok{            savepath}\OtherTok{=}\StringTok{"results/network\_facet\_$class\_pp\_limit/"}
\NormalTok{            awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{            \{}
\StringTok{              if(NR==FNR)}
\StringTok{                \{}
\StringTok{                  if(FNR==1)}
\StringTok{                    \{}
\StringTok{                      for(i=1; i\textless{}=NF; i++)}
\StringTok{                        \{}
\StringTok{                          if($i\textasciitilde{}/class\_nebula\_facet/)}
\StringTok{                            \{}
\StringTok{                              col\_class=i}
\StringTok{                            \}}
\StringTok{                          if($i\textasciitilde{}/\^{}id$/)}
\StringTok{                            \{}
\StringTok{                              col\_id=i}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                  if(FNR\textgreater{}=2)}
\StringTok{                    \{}
\StringTok{                      class[$col\_class]=$col\_class}
\StringTok{                      class\_id[$col\_class,$col\_id]=$col\_id}
\StringTok{                      stat\_id[$col\_class,$col\_id]=$col\_id}
\StringTok{                      belong[$col\_class,$col\_id]=$col\_class}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{              if(NR\textgreater{}FNR)}
\StringTok{                \{}
\StringTok{                  if(FNR==1)}
\StringTok{                    \{}
\StringTok{                      for(i in class)}
\StringTok{                        \{}
\StringTok{                          printf i"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{save\_class}\StringTok{\textquotesingle{}"}
\StringTok{                          printf $0"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "facet}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" i ".tsv"}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                  if(FNR\textgreater{}=2)}
\StringTok{                    \{}
\StringTok{                      for(i in class)}
\StringTok{                        \{}
\StringTok{                          if( class\_id[i,$1]==$1 \&\& class\_id[i,$2]==$2 )}
\StringTok{                            \{}
\StringTok{                              printf $0"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  i"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" i ".tsv"}
\StringTok{                              delete stat\_id[i,$1]}
\StringTok{                              delete stat\_id[i,$2]}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{          END\{}
\StringTok{          for(i in stat\_id)}
\StringTok{            \{}
\StringTok{              \#\# source target similarity delta\_mz fp fp class}
\StringTok{              printf stat\_id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" stat\_id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "1}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "0}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "null}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "null}\SpecialCharTok{\textbackslash{}t}\StringTok{"  belong[i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textbackslash{}}
\StringTok{                \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" belong[i] ".tsv"}
\StringTok{              \}}
\StringTok{          \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
        \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{        data1}\OtherTok{=}\StringTok{"canopus.tsv"}
\NormalTok{        data2}\OtherTok{=}\StringTok{"results/filter\_child\_class.tsv"}
\NormalTok{        data3}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\NormalTok{        savepath}\OtherTok{=}\StringTok{"results/canopus\_pp\_filter.tsv"}
\NormalTok{        awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{        \{}
\StringTok{          if(FILENAME\textasciitilde{}/canopus.tsv/)}
\StringTok{            \{}
\StringTok{              if(FNR==1)}
\StringTok{                \{}
\StringTok{                  for(i=1; i\textless{}=NF; i++)}
\StringTok{                    \{}
\StringTok{                      if($i\textasciitilde{}/absolute/)}
\StringTok{                        \{}
\StringTok{                          col\_index=i}
\StringTok{                        \}}
\StringTok{                      if($i\textasciitilde{}/\^{}id/)}
\StringTok{                        \{}
\StringTok{                          col\_chemid=i}
\StringTok{                        \}}
\StringTok{                      if($i\textasciitilde{}/name/)}
\StringTok{                        \{}
\StringTok{                          col\_name=i}
\StringTok{                        \}}
\StringTok{                      if($i\textasciitilde{}/description/)}
\StringTok{                        \{}
\StringTok{                          col\_des=i}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{              if(FNR\textgreater{}2)}
\StringTok{                \{}
\StringTok{                  ab\_index[$col\_name]=$col\_index}
\StringTok{                  chemid[$col\_name]=$col\_chemid}
\StringTok{                  des[$col\_name]=$col\_des}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{          if(FILENAME\textasciitilde{}/filter\_child\_class/)}
\StringTok{            \{}
\StringTok{              class[$1]=$1}
\StringTok{              if(FNR==1)}
\StringTok{                \{}
\StringTok{                  printf "index}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "chem\_id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "description}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/child\_class.tsv"}
\StringTok{                \}}
\StringTok{              printf ab\_index[$1]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  chemid[$1]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $1"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  des[$1]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/child\_class.tsv"}
\StringTok{            \}}
\StringTok{          if(FILENAME\textasciitilde{}/canopus\_pp/)}
\StringTok{            \{}
\StringTok{              if(FNR==1)}
\StringTok{                \{}
\StringTok{                  printf $1 \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                  for(i=2; i\textless{}=NF; i++)}
\StringTok{                    \{}
\StringTok{                      if(class[$i]!="")}
\StringTok{                        \{}
\StringTok{                          n+=1}
\StringTok{                          printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{C"ab\_index[$i] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                          col\_set[n]=i}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                  printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                \}}
\StringTok{              if(FNR\textgreater{}=2)}
\StringTok{                \{}
\StringTok{                  printf $1 \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                  for(i=1; i\textless{}=n; i++)}
\StringTok{                    \{}
\StringTok{                      printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"$col\_set[i] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                    \}}
\StringTok{                  printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\NormalTok{      ;;}
      \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
      \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{      compound\_idenfication}\ErrorTok{)}
\NormalTok{      echo }\StringTok{"Run compound\_idenfication."}
\NormalTok{      echo }\StringTok{"compound\_idenfication "}
\NormalTok{      exit}
\NormalTok{      ;;}
      \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
      \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{      double\_ion\_network}\ErrorTok{)}
\NormalTok{      exit;}
\NormalTok{      ;;}
      \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
      \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
      \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
      \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{      exit}\ErrorTok{)}
\NormalTok{      exit;}
\NormalTok{      ;;}
      \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
      \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
      \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
      \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
      \SpecialCharTok{*}\ErrorTok{)}
\NormalTok{      echo }\StringTok{"error"}
\NormalTok{      exit;}
\NormalTok{      ;;}
\NormalTok{  esac;}
\NormalTok{done;}\CommentTok{\#(for)}
\NormalTok{done;}\CommentTok{\#(select)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-mcnebula1230.sh}{%
\section{File: mcnebula1230.sh}\label{file-mcnebula1230.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# bin/bash}

\NormalTok{echo }\StringTok{"We are all in the gutter, }
\StringTok{but some of us are looking at the stars."}\NormalTok{;}
\NormalTok{PS3}\OtherTok{=}\StringTok{\textquotesingle{}Please select the workflow to be executed. \textgreater{}\textgreater{}\textgreater{} \textquotesingle{}}
\NormalTok{select command }\ControlFlowTok{in}\NormalTok{ \textbackslash{}}
  \StringTok{"MCnebula\_workflow"}\NormalTok{ \textbackslash{}}
  \StringTok{"structure\_extract"}\NormalTok{ \textbackslash{}}
  \StringTok{"classification\_extract\_sum"}\NormalTok{ \textbackslash{}}
  \StringTok{"classification\_extract\_filter"}\NormalTok{ \textbackslash{}}
  \StringTok{"fragment\_tree\_network"}\NormalTok{ \textbackslash{}}
  \StringTok{"fragment\_tree\_network\_delta"}\NormalTok{ \textbackslash{}}
  \StringTok{"structure\_candidate\_top"}\NormalTok{ \textbackslash{}}
  \StringTok{"(beta)"}\NormalTok{ \textbackslash{}}
  \StringTok{"exit"} 
\NormalTok{do}
  \ControlFlowTok{if}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{command }\SpecialCharTok{==} \StringTok{"MCnebula\_workflow"}\NormalTok{ ]]}
\NormalTok{  then}
\NormalTok{    confirm}\OtherTok{=}\DecValTok{0}
\NormalTok{    until [[ }\SpecialCharTok{$}\NormalTok{confirm }\SpecialCharTok{==} \StringTok{"yes"}\NormalTok{ ]] }\SpecialCharTok{||}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{confirm }\SpecialCharTok{==} \StringTok{"no"}\NormalTok{ ]]}
\NormalTok{    do}
\NormalTok{      read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Running all proccesses sequentially? [yes/no] \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ confirm}
\NormalTok{    done;}
    \ControlFlowTok{if}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{confirm }\SpecialCharTok{==} \StringTok{"no"}\NormalTok{ ]]}
\NormalTok{    then exit}
\NormalTok{    fi;}
\NormalTok{    default}\OtherTok{=}\StringTok{"structure\_extract classification\_extract\_sum classification\_extract\_filter fragment\_tree\_network fragment\_tree\_network\_delta"}
\NormalTok{    list}\OtherTok{=}\ErrorTok{$}\NormalTok{(echo }\SpecialCharTok{$}\NormalTok{default);}
  \ControlFlowTok{else}\NormalTok{ list}\OtherTok{=}\ErrorTok{$}\NormalTok{( echo }\SpecialCharTok{$}\NormalTok{command)}
\NormalTok{  fi;}
  \ControlFlowTok{for}\NormalTok{ option }\ControlFlowTok{in} \SpecialCharTok{$}\NormalTok{(echo }\SpecialCharTok{$}\NormalTok{list)}
\NormalTok{  do}
\NormalTok{    case }\SpecialCharTok{$}\NormalTok{option }\ControlFlowTok{in}
      \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
      \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
      \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
      \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{      structure\_extract}\ErrorTok{)}
\NormalTok{      echo }\StringTok{"Run structure\_extract."}
\NormalTok{      projectpath}\OtherTok{=}\DecValTok{0}
\NormalTok{      until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{canopus\_summary.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{      do}
\NormalTok{        read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{      done;}
\NormalTok{      cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{      mkdir results;}
\NormalTok{      mkdir temp;}
\NormalTok{      mkdir temp}\SpecialCharTok{/}\NormalTok{fintemp;}
      \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{Mo\_filename ]}
\NormalTok{      then rm temp}\SpecialCharTok{/}\NormalTok{Mo\_filename}
\NormalTok{      fi;}
\NormalTok{      data}\OtherTok{=}\StringTok{"*\_*/fingerid/*.tsv"}
\NormalTok{      awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{      BEGIN\{}
\StringTok{      all\_id=0}
\StringTok{      max\_id={-}1}
\StringTok{      p\_id="null"}
\StringTok{      printf "Info: loading the data..."}
\StringTok{    \}}
\StringTok{  \{}
\StringTok{    if(FNR==1)}
\StringTok{      \{}
\StringTok{        if(NR\textgreater{}FNR)}
\StringTok{          \{}
\StringTok{            close(pfile)}
\StringTok{          \}}
\StringTok{        f=split(FILENAME,a,"[/]");}
\StringTok{        n=split(a[1],b,"[\_]");}
\StringTok{        id=b[n];}
\StringTok{        if(id!=p\_id)}
\StringTok{          \{}
\StringTok{            all\_id+=1}
\StringTok{            if(id\textgreater{}max\_id)}
\StringTok{              \{}
\StringTok{                max\_id=id}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{        file[id]=a[1]}
\StringTok{        split(a[f], g, "[.]")}
\StringTok{        formu\_type[id]=g[1]}
\StringTok{        if(all\_id==1)}
\StringTok{          \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{              \{}
\StringTok{                if(($i\textasciitilde{}/inchikey2D/))}
\StringTok{                  \{}
\StringTok{                    col\_2D=i}
\StringTok{                  \}}
\StringTok{                if($i=="inchi")}
\StringTok{                  \{}
\StringTok{                    col\_inchi=i}
\StringTok{                  \}}
\StringTok{                if(($i\textasciitilde{}/Formula/))}
\StringTok{                  \{}
\StringTok{                    col\_formu=i}
\StringTok{                  \}}
\StringTok{                if($i=="score")}
\StringTok{                  \{}
\StringTok{                    col\_score=i}
\StringTok{                  \}}
\StringTok{                if($i=="name")}
\StringTok{                  \{}
\StringTok{                    col\_name=i}
\StringTok{                  \}}
\StringTok{                if($i=="smiles")}
\StringTok{                  \{}
\StringTok{                    col\_smiles=i}
\StringTok{                  \}}
\StringTok{                if($i=="xlogp")}
\StringTok{                  \{}
\StringTok{                    col\_x=i}
\StringTok{                  \}}
\StringTok{                if(($i\textasciitilde{}/imilarity/))}
\StringTok{                  \{}
\StringTok{                    col\_simi=i}
\StringTok{                  \}}
\StringTok{                if($i\textasciitilde{}/links/)}
\StringTok{                  \{}
\StringTok{                    col\_links=i}
\StringTok{                  \}}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{        pfile=FILENAME}
\StringTok{        printf g[1]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"formu\_type[id]"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{        printf "Info: the data of " id " (ID) has input. The filename is " FILENAME ".}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{      \}}
\StringTok{    if(FNR\textgreater{}=2)}
\StringTok{      \{}
\StringTok{        row\_score=$col\_score}
\StringTok{        row\_simi=$col\_simi}
\StringTok{        if(max["score",id]=="" || max["score",id]+0\textless{}row\_score+0)}
\StringTok{          \{}
\StringTok{            max["score",id]=row\_score}
\StringTok{            name["score",id]=$col\_name}
\StringTok{            formula["score",id]=$col\_formu}
\StringTok{            formu\_type["score",id]=formu\_type[id]}
\StringTok{            simi["score",id]=$col\_simi}
\StringTok{            smiles["score",id]=$col\_smiles}
\StringTok{            inchi["score",id]=$col\_inchi}
\StringTok{            in2D["score",id]=$col\_2D}
\StringTok{            score["score",id]=$col\_score}
\StringTok{            xlogp["score",id]=$col\_x}
\StringTok{            links["score",id]=$col\_links}
\StringTok{          \}}
\StringTok{        if(max["simi",id]=="" || max["simi",id]+0\textless{}row\_simi+0)}
\StringTok{          \{}
\StringTok{            max["simi",id]=row\_simi}
\StringTok{            name["simi",id]=$col\_name}
\StringTok{            formula["simi",id]=$col\_formu}
\StringTok{            formu\_type["simi",id]=formu\_type[id]}
\StringTok{            simi["simi",id]=$col\_simi}
\StringTok{            smiles["simi",id]=$col\_smiles}
\StringTok{            inchi["simi",id]=$col\_inchi}
\StringTok{            in2D["simi",id]=$col\_2D}
\StringTok{            score["simi",id]=$col\_score}
\StringTok{            xlogp["simi",id]=$col\_x}
\StringTok{            links["simi",id]=$col\_links}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{END\{}
\StringTok{printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "formula}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "smiles}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchi}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchikey2D}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "score}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "xlogp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "links}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/fingerid\_sum.tsv"}
\StringTok{for(l in file)}
\StringTok{  \{}
\StringTok{    if(max["score",l]!="")}
\StringTok{      \{}
\StringTok{        printf l"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  name["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  formula["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  simi["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  smiles["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  inchi["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  in2D["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  score["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  xlogp["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  links["score",l]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/fingerid\_sum.tsv"}
\StringTok{        printf formula["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  file[l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  formu\_type["score",l]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "temp/Mo\_filename"}
\StringTok{      \}}
\StringTok{    if(max["simi",l]!="" \&\& max["simi",l]!=max["score",l])}
\StringTok{      \{}
\StringTok{        printf l"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  name["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  formula["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  simi["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  smiles["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  inchi["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  in2D["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  score["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  xlogp["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  links["simi",l]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/fingerid\_sum.tsv"}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\NormalTok{data\_sum}\OtherTok{=}\StringTok{"results/fingerid\_sum.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==1)}
\StringTok{    \{}
\StringTok{      for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{          if($i\textasciitilde{}/id/)}
\StringTok{            \{}
\StringTok{              col\_id=i}
\StringTok{            \}}
\StringTok{          if($i\textasciitilde{}/score/)}
\StringTok{            \{}
\StringTok{              col\_score=i}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(NR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{      id=$col\_id}
\StringTok{      if(max\_id+0\textless{}id || max\_id=="")}
\StringTok{        \{}
\StringTok{          max\_id=id}
\StringTok{        \}}
\StringTok{      if(score[id]+0\textless{}$col\_score+0 || score[id]=="")}
\StringTok{        \{}
\StringTok{          score[id]=$col\_score}
\StringTok{          data[id]=$0}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{\}}
\StringTok{END\{}
\StringTok{printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "formula}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "smiles}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchi}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchikey2D}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "score}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "xlogp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "links}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/fingerid\_first\_score.tsv"}
\StringTok{for(i=1; i\textless{}=max\_id; i++)}
\StringTok{  \{}
\StringTok{    if(data[i]!="")}
\StringTok{      \{}
\StringTok{        printf data[i] "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/fingerid\_first\_score.tsv"}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data\_sum}
\NormalTok{echo }\StringTok{"structure\_extract results have been successfully assembled into \textless{}results/fingerid\_sum.tsv\textgreater{} and \textless{}results/fingerid\_first\_score.tsv\textgreater{}"}\NormalTok{;}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{classification\_extract\_sum}\ErrorTok{)}
\NormalTok{echo }\StringTok{"Run classification\_extract\_sum."}\NormalTok{;}
\ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{Mo\_filename ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f canopus.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f canopus\_neg.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f .format ]}
\NormalTok{then}
\NormalTok{  echo }\StringTok{"Project path acknowledged."}
\ControlFlowTok{else}
\NormalTok{  until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{canopus.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{  do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{  done;}
\NormalTok{  cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{fi;}
\NormalTok{data1}\OtherTok{=}\StringTok{"temp/Mo\_filename"}
\NormalTok{data2}\OtherTok{=}\StringTok{"canopus.tsv"}
\NormalTok{data3}\OtherTok{=}\StringTok{"canopus\_neg.tsv"}
\NormalTok{datas}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  x=$2"/canopus/"$3".fpt"}
\StringTok{  if(getline \textless{} x == 1)}
\StringTok{    \{}
\StringTok{      printf x" "}
\StringTok{    \}}
\StringTok{  close(x)}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{      i=split($2,s,"[\_]")}
\StringTok{      the\_id[FNR]=s[i]}
\StringTok{      n=FNR}
\StringTok{    \}}
\StringTok{  if(FILENAME \textasciitilde{} /canopus.tsv/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if($i \textasciitilde{} /\^{}name/)}
\StringTok{                \{}
\StringTok{                  col\_class=i}
\StringTok{                \}}
\StringTok{              if($i \textasciitilde{} /absolute/)}
\StringTok{                \{}
\StringTok{                  col\_abindex=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          abindex[1,FNR]=$col\_abindex}
\StringTok{          indexset[$col\_abindex]=$col\_class}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FILENAME \textasciitilde{} /canopus\_neg.tsv/)}
\StringTok{    \{}
\StringTok{      p\_filename=FILENAME}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if($i \textasciitilde{} /name/)}
\StringTok{                \{}
\StringTok{                  col\_class=i}
\StringTok{                \}}
\StringTok{              if($i \textasciitilde{} /absolute/)}
\StringTok{                \{}
\StringTok{                  col\_abindex=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          abindex[2,FNR]=$col\_abindex}
\StringTok{          indexset[$col\_abindex]=$col\_class}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FILENAME \textasciitilde{} /.fpt/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          close(p\_filename)}
\StringTok{          printf "Info: data\_file name of " p\_filename " has been input.}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{          p\_filename=FILENAME}
\StringTok{          split(FILENAME,a,"[/]");}
\StringTok{          m=split(a[1],b,"[\_]");}
\StringTok{          id=b[m];}
\StringTok{          if(FILENAME \textasciitilde{} /\textbackslash{}+.fpt/)}
\StringTok{            \{}
\StringTok{              ion=1}
\StringTok{            \}}
\StringTok{          if(FILENAME \textasciitilde{} /\textbackslash{}{-}.fpt/)}
\StringTok{            \{}
\StringTok{              ion=2}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      pp[id,abindex[ion,FNR+1]]=sprintf("\%.3f",$1)}
\StringTok{    \}}
\StringTok{\}}
\StringTok{END\{}
\StringTok{printf "id" \textgreater{} "results/canopus\_pp.tsv"}
\StringTok{for(i in indexset)}
\StringTok{  \{}
\StringTok{    ord+=1}
\StringTok{    orderlist[ord]=i}
\StringTok{    printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"indexset[i] \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{  \}}
\StringTok{printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{for(i=1; i\textless{}=n; i++)}
\StringTok{  \{}
\StringTok{    printf the\_id[i] \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{    for(j=1; j\textless{}=ord; j++)}
\StringTok{      \{}
\StringTok{        if(pp[the\_id[i],orderlist[j]]=="")}
\StringTok{          \{}
\StringTok{            pp[the\_id[i],orderlist[j]]=0}
\StringTok{          \}}
\StringTok{        printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"pp[the\_id[i],orderlist[j]] \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{      \}}
\StringTok{    printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{  \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3 }\SpecialCharTok{$}\NormalTok{datas}
\NormalTok{echo }\StringTok{"classiication\_extract\_sum have been successfully written into \textless{}results/canopus\_pp.tsv\textgreater{}"}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{classification\_extract\_filter}\ErrorTok{)}
\NormalTok{echo }\StringTok{"Run classification\_extract\_filter."}\NormalTok{;}
\ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f results}\SpecialCharTok{/}\NormalTok{canopus\_pp.tsv ]}
\NormalTok{then}
\NormalTok{  echo }\StringTok{"Project path acknowledged."}
\ControlFlowTok{else}
\NormalTok{  until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{results}\SpecialCharTok{/}\NormalTok{canopus\_pp.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{results}\SpecialCharTok{/}\NormalTok{canopus\_summary.tsv ]}
\NormalTok{  do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{  done;}
\NormalTok{  cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{fi; }
\NormalTok{check}\OtherTok{=}\DecValTok{0}
\NormalTok{until [[ }\StringTok{"$check"} \SpecialCharTok{==} \StringTok{"yes"}\NormalTok{ ]] }\SpecialCharTok{||}\NormalTok{ [[ }\StringTok{"$check"} \SpecialCharTok{==} \StringTok{"no"}\NormalTok{ ]]}
\NormalTok{do}
\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Collate the posterior probabilities of the classification of each feature? [yes/no] \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ check;}
\NormalTok{done;}
\ControlFlowTok{if}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{check }\SpecialCharTok{==} \StringTok{"yes"}\NormalTok{ ]]}
\NormalTok{then}
\NormalTok{  definition\_limit}\OtherTok{=}\DecValTok{0}
\NormalTok{  until [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textgreater{}} \StringTok{"0.01"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textless{}} \StringTok{"1"}\NormalTok{ ]]}
\NormalTok{  do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the classes posterior probabilities limition. 0.5\textasciitilde{}0.99 may work well. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ definition\_limit;}
\NormalTok{  done;}
\NormalTok{  data1}\OtherTok{=}\StringTok{"canopus\_summary.tsv"}
\NormalTok{  data2}\OtherTok{=}\StringTok{"canopus.tsv"}
\NormalTok{  data3}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\NormalTok{  awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  \{}
\StringTok{    if(NR==FNR)}
\StringTok{      \{}
\StringTok{        if(FNR==1)}
\StringTok{          \{}
\StringTok{            p\_file=FILENAME}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{              \{}
\StringTok{                if($i\textasciitilde{}/name/)}
\StringTok{                  \{}
\StringTok{                    col\_id=i}
\StringTok{                  \}}
\StringTok{                if($i\textasciitilde{}/specific/)}
\StringTok{                  \{}
\StringTok{                    col\_specific=i}
\StringTok{                  \}}
\StringTok{                if($i\textasciitilde{}/level/)}
\StringTok{                  \{}
\StringTok{                    col\_level=i}
\StringTok{                  \}}
\StringTok{                if($i\textasciitilde{}/subclass/)}
\StringTok{                  \{}
\StringTok{                    col\_subclass=i}
\StringTok{                  \}}
\StringTok{                if($i\textasciitilde{}/\^{}class/)}
\StringTok{                  \{}
\StringTok{                    col\_class=i}
\StringTok{                  \}}
\StringTok{                if($i\textasciitilde{}/superclass/)}
\StringTok{                  \{}
\StringTok{                    col\_superclass=i}
\StringTok{                  \}}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{          \{}
\StringTok{            n=split($col\_id,a,"[\_]")}
\StringTok{            id=a[n]}
\StringTok{            specific[id]=$col\_specific}
\StringTok{            level[id]=$col\_level}
\StringTok{            subclass[id]=$col\_subclass}
\StringTok{            class[id]=$col\_class}
\StringTok{            superclass[id]=$col\_superclass}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{    if(FILENAME\textasciitilde{}/canopus.tsv/)}
\StringTok{      \{}
\StringTok{        if(FNR==1)}
\StringTok{          \{}
\StringTok{            close(p\_file)}
\StringTok{            p\_file=FILENAME}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{              \{}
\StringTok{                if($i\textasciitilde{}/name/)}
\StringTok{                  \{}
\StringTok{                    col\_name=i}
\StringTok{                  \}}
\StringTok{                if($i\textasciitilde{}/description/)}
\StringTok{                  \{}
\StringTok{                    col\_description=i}
\StringTok{                  \}}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{          \{}
\StringTok{            description[$col\_name]=$col\_description}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{    if(FILENAME\textasciitilde{}"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data3}\StringTok{\textquotesingle{}")}
\StringTok{      \{}
\StringTok{        if(FNR==1)}
\StringTok{          \{}
\StringTok{            close(p\_file)}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{              \{}
\StringTok{                if($i\textasciitilde{}/\^{}id$/)}
\StringTok{                  \{}
\StringTok{                    col\_id=i}
\StringTok{                  \}}
\StringTok{                if(i\textgreater{}=2)}
\StringTok{                  \{}
\StringTok{                    col\_class\_name[i]=$i}
\StringTok{                  \}}
\StringTok{              \}}
\StringTok{            printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition\_source}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition\_description}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "specific}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "specific\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "level\_5}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "level\_5\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "subclass}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "subclass\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "class}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "class\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "superclass}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "superclass\_pp}\SpecialCharTok{\textbackslash{}n}\StringTok{"  \textgreater{} "results/stat\_classification.tsv"}
\StringTok{          \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{          \{}
\StringTok{            for(i=2; i\textless{}=NF; i++)}
\StringTok{              \{}
\StringTok{                c\_pp[col\_class\_name[i]]=sprintf("\%.4f",$i)}
\StringTok{              \}}
\StringTok{            if(level[$col\_id] != "" \&\& c\_pp[level[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{              \{}
\StringTok{                definition\_source="level\_5"}
\StringTok{                definition=level[$col\_id]}
\StringTok{              \}}
\StringTok{          else if(subclass[$col\_id] != "" \&\& c\_pp[subclass[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{            \{}
\StringTok{              definition\_source="subclass"}
\StringTok{              definition=subclass[$col\_id]}
\StringTok{            \}}
\StringTok{        else if(class[$col\_id] != "" \&\& c\_pp[class[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{          \{}
\StringTok{            definition\_source="class"}
\StringTok{            definition=class[$col\_id]}
\StringTok{          \}}
\StringTok{      else if(superclass[$col\_id] != "" \&\& c\_pp[superclass[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{        \{}
\StringTok{          definition\_source="superclass"}
\StringTok{          definition=superclass[$col\_id]}
\StringTok{        \}}
\StringTok{    else}
\StringTok{      \{}
\StringTok{        definition\_source="null"}
\StringTok{        definition="null"}
\StringTok{        c\_pp[definition]="null"}
\StringTok{        description[definition]="null"}
\StringTok{      \}}
\StringTok{    printf $col\_id"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  definition\_source"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  definition"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[definition]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  description[definition]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  specific[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[specific[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  level[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[level[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  subclass[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[subclass[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  class[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[class[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  superclass[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[superclass[$col\_id]]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/stat\_classification.tsv"}
\StringTok{  \}}
\StringTok{\}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\NormalTok{echo }\StringTok{"classification\_extract\_filter have been successfully written into \textless{}results/stat\_classification.tsv\textgreater{}"}
\NormalTok{fi;}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{fragment\_tree\_network}\ErrorTok{)}
\NormalTok{echo }\StringTok{"Run fragment\_tree\_network."}\NormalTok{;}
\ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{d temp ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f .format ]}
\NormalTok{then}
\NormalTok{  echo }\StringTok{"Project path acknowledged."}
\ControlFlowTok{else}
\NormalTok{  until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{  do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project. Make sure you have moved the fragment tree alignment results to the directory where the project is located. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{  done;}
\NormalTok{  cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{fi;}
\NormalTok{echo }\StringTok{"Please enter the minimum alignment similarity(tlimit) that you want to filter."}
\NormalTok{tlimit}\OtherTok{=}\DecValTok{0}
\NormalTok{until [[ }\StringTok{"$tlimit"} \SpecialCharTok{\textgreater{}} \StringTok{"0.01"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$tlimit"} \SpecialCharTok{\textless{}} \StringTok{"0.99"}\NormalTok{ ]]}
\NormalTok{do}
\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"0.4{-}0.7 is recommended \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ tlimit;}
\NormalTok{done;}
\ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{d temp}\SpecialCharTok{/}\NormalTok{ftaligntemp ]}
\NormalTok{then }
\NormalTok{  mkdir temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}
\NormalTok{fi;}
\NormalTok{data}\OtherTok{=}\StringTok{"ftalign.tsv"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/ftaligntemp/tmp"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  printf "Info: NR = " NR ". FNR = " FNR ".}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{      for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{          if(NR==1 \&\& i!=1 || NR!=1 \&\& i==1)}
\StringTok{            \{}
\StringTok{              n=split($i,x,"[\_]")}
\StringTok{              raw[NR,i]=x[n]}
\StringTok{            \}}
\StringTok{        else}
\StringTok{          \{}
\StringTok{            if(NR==i)}
\StringTok{              \{}
\StringTok{                raw\_norm[NR,i]=$i}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{if(NR\textgreater{}FNR \&\& FNR\textgreater{}=2)}
\StringTok{  \{}
\StringTok{    for(i=2; i\textless{}=NF; i++)}
\StringTok{      \{}
\StringTok{        norm1=$i/raw\_norm[i,i]}
\StringTok{        norm2=$i/raw\_norm[FNR,FNR]}
\StringTok{        norms=sprintf("\%.2f", ((norm1+norm2)/2))}
\StringTok{        if((norms+0 \textgreater{} \textquotesingle{}}\SpecialCharTok{$}\NormalTok{tlimit}\StringTok{\textquotesingle{}+0))}
\StringTok{          \{}
\StringTok{            if(raw[FNR,1]+0\textgreater{}=raw[1,i]+0)}
\StringTok{              \{}
\StringTok{                print raw[FNR,1], raw[1,i], norms \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{              \}}
\StringTok{            if(raw[FNR,1]+0\textless{}raw[1,i]+0)}
\StringTok{              \{}
\StringTok{                print raw[1,i], raw[FNR,1], norms \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data }\SpecialCharTok{$}\NormalTok{data}
\NormalTok{sort }\SpecialCharTok{{-}}\NormalTok{u }\SpecialCharTok{$}\NormalTok{savepath }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{tmp2}
\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/ftaligntemp/filter\_net\_$tlimit"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{      if($1!=$2)}
\StringTok{        \{}
\StringTok{          replink[$1]=$1}
\StringTok{          replink[$2]=$2}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(NR!=FNR)}
\StringTok{    \{}
\StringTok{      if($1!=$2)}
\StringTok{        \{}
\StringTok{          printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" }
\StringTok{        \} }
\StringTok{      if($1==$2)}
\StringTok{        \{}
\StringTok{          if(replink[$1]=="")}
\StringTok{            \{}
\StringTok{              printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{tmp2 temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{tmp2}
\NormalTok{echo }\StringTok{"fragment\_tree\_network have been successfully written into \textless{}temp/ftaligntemp/filter\_net\_$tlimit\textgreater{}"}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{fragment\_tree\_network\_delta}\ErrorTok{)}
\ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{d temp ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f .format ]}
\NormalTok{then}
\NormalTok{  echo }\StringTok{"Project path acknowledged."}
\ControlFlowTok{else}
\NormalTok{  until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{  do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{  done;}
\NormalTok{  cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{fi;}
\NormalTok{echo }\StringTok{"The following module attempts to compute the differential fingerprints of connected clusters based on the molecular fingerprint results of sirius 4."}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{plimit}\OtherTok{=}\DecValTok{0}
\NormalTok{until [[ }\StringTok{"$plimit"} \SpecialCharTok{\textgreater{}} \StringTok{"0.5"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$plimit"} \SpecialCharTok{\textless{}} \StringTok{"0.99"}\NormalTok{ ]]}
\NormalTok{do}
\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"If the minimum alignment similarity is greater than 0.3, this step will automatic calculate the discrepancy fingerprint between alignment features(in beta). Please enter the minimum posterior probability of the molecular fingerprint(plimit\_1) to be filtered. 0.9{-}0.99 is recommended. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ plimit;}
\NormalTok{done;}
\NormalTok{plimit2}\OtherTok{=}\DecValTok{0}
\NormalTok{until [[ }\StringTok{"$plimit2"} \SpecialCharTok{\textgreater{}} \StringTok{"0.1"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$plimit2"} \SpecialCharTok{\textless{}} \StringTok{"$plimit"}\NormalTok{ ]]}
\NormalTok{do}
\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"The minimum posterior probability of the molecular fingerprint(plimit\_2) to be controled. 0.1{-}0.5 may work well. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ plimit2;}
\NormalTok{done;}
\NormalTok{tlimit}\OtherTok{=}\ErrorTok{$}\NormalTok{(ls temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{filter\_net\_}\SpecialCharTok{*} \ErrorTok{|}\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F \_ }\StringTok{\textquotesingle{}\{print $NF\}\textquotesingle{}}\NormalTok{)}
\NormalTok{check\_rep}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}END\{print NR\}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$tlimit"}\NormalTok{))}
\ControlFlowTok{if}\NormalTok{ [[ }\StringTok{"$check\_rep"} \SpecialCharTok{\textgreater{}} \StringTok{"1"}\NormalTok{ ]]}
\NormalTok{then}
\NormalTok{  tlimit}\OtherTok{=}\DecValTok{0}
\NormalTok{  until [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{filter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit ]}
\NormalTok{  do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Plural and different fragment\_tree\_network files were found to exist locally. Please select a tlimit parameter you have utilized to run fragment\_tree\_network\_delta. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ tlimit;}
\NormalTok{  done;}
\NormalTok{fi;}
\ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{refilter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit ]}
\NormalTok{then rm temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{refilter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit}
\NormalTok{fi;}
\ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{fpsample ]}
\NormalTok{then rm temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{fpsample}
\NormalTok{fi;}
\NormalTok{echo }\StringTok{"Running delta\_fingerprint computation..."}
\NormalTok{echo }\StringTok{"Aquiring data from sirius index..."}
\NormalTok{data1}\OtherTok{=}\StringTok{"*\_*/compound.info"}
\NormalTok{data2}\OtherTok{=}\StringTok{"temp/ftaligntemp/filter\_net\_$tlimit"}
\NormalTok{echo }\StringTok{"Run fragment\_tree\_network\_delta."}
\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/ms\_data\_$tlimit"}
\NormalTok{echo }\StringTok{"step 1: ms data"}
\ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{savepath ]}
\NormalTok{then}
\NormalTok{  awk }\SpecialCharTok{{-}}\NormalTok{F }\StringTok{"[}\SpecialCharTok{\textbackslash{}t}\StringTok{]||[:]||[\_]"} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  BEGIN\{  }
\StringTok{  printf "..."}
\StringTok{  printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "m/z}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "rt}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{\}}
\StringTok{\{}
\StringTok{  if(FILENAME\textasciitilde{}/compound.info/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          printf "Info: catch \textgreater{}\textgreater{}\textgreater{} "FILENAME"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{        \}}
\StringTok{      if($1=="name")}
\StringTok{        \{}
\StringTok{          i+=1;}
\StringTok{          id[i]=$NF;}
\StringTok{          n=split($NF,a,"[\_]")}
\StringTok{          printf a[n]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{        \}}
\StringTok{      if($1=="ionMass")}
\StringTok{        \{}
\StringTok{          mz[id[i]]=$NF}
\StringTok{          printf sprintf("\%.4f",$NF)"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{        \}}
\StringTok{      if($1=="ionType")}
\StringTok{        \{}
\StringTok{          type[id[i]]=$NF}
\StringTok{        \}}
\StringTok{      if($1=="rt")}
\StringTok{        \{}
\StringTok{          rt[id[i]]=$2;}
\StringTok{          printf sprintf("\%.2f",$2/60)"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FILENAME\textasciitilde{}/ftaligntemp/)}
\StringTok{    \{}
\StringTok{      \#source  target  ftalign  delta\_mz  delta\_rt  source\_iontype  target\_iontype;}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          printf "" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        \}}
\StringTok{      print $1,$2,$3,sprintf("\%.3f",mz[$2]{-}mz[$1]),sprintf("\%.2f",rt[$2]{-}rt[$1]),type[$1],type[$2]  \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
\NormalTok{fi;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{echo }\StringTok{"step 2: data path"}
\NormalTok{source\_file}\OtherTok{=}\StringTok{"temp/Mo\_filename"}
\NormalTok{data}\OtherTok{=}\StringTok{"temp/ms\_data\_$tlimit"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/datapath\_$tlimit"}
\ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{savepath ]}
\NormalTok{then}
\NormalTok{  awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  \{}
\StringTok{    if(NR==FNR)}
\StringTok{      \{}
\StringTok{        n=split($2, a, "[\_]")}
\StringTok{        file[a[n]]=$2}
\StringTok{        formu\_type[a[n]]=$3}
\StringTok{      \}}
\StringTok{    if(NR!=FNR)}
\StringTok{      \{}
\StringTok{        \#\textless{}path\textgreater{}sourceFormula  \textless{}path\textgreater{}targetFormula}
\StringTok{        path1=file[$1]"/fingerprints/"formu\_type[$1]".fpt"}
\StringTok{        path2=file[$2]"/fingerprints/"formu\_type[$2]".fpt"}
\StringTok{        data[path1]=path1}
\StringTok{        data[path2]=path2}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{END\{}
\StringTok{for(i in data)}
\StringTok{  \{}
\StringTok{    n+=1}
\StringTok{    print "Check file:",n}
\StringTok{    if(getline\textless{}i=={-}1)}
\StringTok{      \{}
\StringTok{        printf "Escape filename: " i "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{      \}}
\StringTok{  else}
\StringTok{    \{}
\StringTok{      printf i" " \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{    \}}
\StringTok{  close(i)}
\StringTok{\}}
\StringTok{print "Sum:",n}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{source\_file }\SpecialCharTok{$}\NormalTok{data}
\NormalTok{fi;}
\NormalTok{datapath}\OtherTok{=}\ErrorTok{$}\NormalTok{(cat temp}\SpecialCharTok{/}\NormalTok{datapath\_}\SpecialCharTok{$}\NormalTok{tlimit)}
\NormalTok{echo }\StringTok{"step 3: fingerprint"}
\NormalTok{data\_allfp}\OtherTok{=}\StringTok{"temp/data\_allfp\_$tlimit"}
\ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{data\_allfp ]}
\NormalTok{then}
\NormalTok{  awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  BEGIN\{}
\StringTok{  n=0}
\StringTok{\}}
\StringTok{\{}
\StringTok{  if(FNR==1)}
\StringTok{    \{}
\StringTok{      if(n\textgreater{}1)}
\StringTok{        \{}
\StringTok{          close(file)}
\StringTok{        \}}
\StringTok{      file=FILENAME;}
\StringTok{      print "Get fingerprints: ",FILENAME}
\StringTok{      n+=1;}
\StringTok{      printf FILENAME"}\SpecialCharTok{\textbackslash{}n}\StringTok{"$0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data\_allfp}\StringTok{\textquotesingle{}"}
\StringTok{    \}}
\StringTok{else}
\StringTok{  \{}
\StringTok{    print $0 \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data\_allfp}\StringTok{\textquotesingle{}"}
\StringTok{  \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{datapath}
\NormalTok{fi;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==1)}
\StringTok{    \{}
\StringTok{      for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{          if($i\textasciitilde{}/absolute/)}
\StringTok{            \{}
\StringTok{              col\_index=i}
\StringTok{            \}}
\StringTok{          if($i\textasciitilde{}/description/)}
\StringTok{            \{}
\StringTok{              col\_description=i}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(NR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{      print $col\_index,$col\_description}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}}\NormalTok{ csi\_fingerid.tsv }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{pos\_fingerprint\_index;}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==1)}
\StringTok{    \{}
\StringTok{      for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{          if($i\textasciitilde{}/absolute/)}
\StringTok{            \{}
\StringTok{              col\_index=i}
\StringTok{            \}}
\StringTok{          if($i\textasciitilde{}/description/)}
\StringTok{            \{}
\StringTok{              col\_description=i}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(NR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{      print $col\_index,$col\_description}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}}\NormalTok{ csi\_fingerid\_neg.tsv }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{neg\_fingerprint\_index;}
\NormalTok{posindex}\OtherTok{=}\StringTok{"temp/ftaligntemp/pos\_fingerprint\_index"}
\NormalTok{negindex}\OtherTok{=}\StringTok{"temp/ftaligntemp/neg\_fingerprint\_index"}
\NormalTok{data}\OtherTok{=}\StringTok{"temp/ms\_data\_$tlimit"}
\NormalTok{echo }\StringTok{"step 4: merge data"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{BEGIN\{}
\StringTok{file=0}
\StringTok{x=0}
\StringTok{count=0}
\StringTok{f=0}
\StringTok{posnum=0}
\StringTok{negnum=0}
\StringTok{\}}
\StringTok{\{}
\StringTok{  if(FNR==1)}
\StringTok{    \{}
\StringTok{      file+=1}
\StringTok{    \}}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{      if(($1\textasciitilde{}/fingerprint/))}
\StringTok{        \{}
\StringTok{          if(x+0\textgreater{}f+0)}
\StringTok{            \{}
\StringTok{              f=x  \# calculate the max index.}
\StringTok{            \}}
\StringTok{          count+=1;  \# calculate the all fingerprints file number.}
\StringTok{          split($1,a,"[/]"); e=split(a[1],b,"[\_]"); id=b[e]; \#catch the id.}
\StringTok{          x=0;}
\StringTok{        \}}
\StringTok{    else}
\StringTok{      \{}
\StringTok{        x+=1;}
\StringTok{        fp[id,x]=$1;}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{if(file==2)}
\StringTok{  \{}
\StringTok{    pos[FNR]=$1}
\StringTok{    posnum+=1}
\StringTok{  \}}
\StringTok{if(file==3)}
\StringTok{  \{}
\StringTok{    neg[FNR]=$1}
\StringTok{    negnum+=1}
\StringTok{  \}}
\StringTok{if(file==4)}
\StringTok{  \{}
\StringTok{    if("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tlimit}\StringTok{\textquotesingle{}"+0 \textgreater{}= 0.3)}
\StringTok{      \{}
\StringTok{        if(fp[$1,1]!="" \&\& fp[$2,1]!="")}
\StringTok{          \{}
\StringTok{            n1=split($6, g, "[]]");}
\StringTok{            n2=split($7, h, "[]]");}
\StringTok{            if(g[n1]=="+" \&\& h[n2]=="+")}
\StringTok{              \{}
\StringTok{                for(x=1; x\textless{}=posnum; x++)}
\StringTok{                  \{}
\StringTok{                    if(fp[$1,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                      \{}
\StringTok{                        data\_s[FNR,x]=pos[x]}
\StringTok{                      \}}
\StringTok{                  else if(fp[$2,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                    \{}
\StringTok{                      data\_t[FNR,x]=pos[x]}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{          if(g[n1]=="{-}" \&\& h[n2]=="{-}")}
\StringTok{            \{}
\StringTok{              for(x=1; x\textless{}=negnum; x++)}
\StringTok{                \{}
\StringTok{                  if(fp[$1,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                    \{}
\StringTok{                      data\_s[FNR,x]=neg[x]}
\StringTok{                    \}}
\StringTok{                else if(fp[$2,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                  \{}
\StringTok{                    data\_t[FNR,x]=neg[x]}
\StringTok{                  \}}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{        if(g[n1]=="{-}" \&\& h[n2]=="+" || h[n2]=="{-}" \&\& g[n1]=="+")}
\StringTok{          \{}
\StringTok{            for(i=1; i\textless{}=posnum; i++)}
\StringTok{              \{}
\StringTok{                for(j=1; j\textless{}=negnum; j++)}
\StringTok{                  \{}
\StringTok{                    if(pos[i]==neg[j])}
\StringTok{                      \{}
\StringTok{                        mirror[i]=j  \#if pos=i, the identical index of neg is mirror[i]}
\StringTok{                      \}}
\StringTok{                  \}}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{        if(g[n1]=="{-}" \&\& h[n2]=="+") }
\StringTok{          \{}
\StringTok{            for(x=1; x\textless{}=f; x++)}
\StringTok{              \{}
\StringTok{                if(fp[$1,mirror[x]]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                  \{}
\StringTok{                    data\_s[FNR,x]=neg[mirror[x]]}
\StringTok{                  \}}
\StringTok{              else if(fp[$2,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,mirror[x]]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                \{}
\StringTok{                  data\_t[FNR,x]=neg[mirror[x]]}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      if(h[n2]=="{-}" \&\& g[n1]=="+")}
\StringTok{        \{}
\StringTok{          for(x=1; x\textless{}=f; x++)}
\StringTok{            \{}
\StringTok{              if(fp[$1,x]+0\textgreater{}= \textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,mirror[x]]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{                \{}
\StringTok{                  data\_s[FNR,x]=neg[mirror[x]]}
\StringTok{                \}}
\StringTok{            else if(fp[$2,mirror[x]]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{              \{}
\StringTok{                data\_t[FNR,x]=neg[mirror[x]]}
\StringTok{              \}}
\StringTok{          \}   }
\StringTok{      \}}
\StringTok{  \}}
\StringTok{\}}
\StringTok{if(FNR==1)}
\StringTok{  \{}
\StringTok{    printf "source}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "target}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "ftalign\_similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "delta\_m/z}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "source\_fp\_uniq}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "target\_fp\_uniq}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{  \}}
\StringTok{else}
\StringTok{  \{}
\StringTok{    printf $1"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $2"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $3"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $4"}\SpecialCharTok{\textbackslash{}t}\StringTok{";}
\StringTok{    if(\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tlimit}\StringTok{\textquotesingle{}+0 \textgreater{}= 0.3)}
\StringTok{      \{}
\StringTok{        if(fp[$1,1]=="" || fp[$2,1]=="")}
\StringTok{          \{}
\StringTok{            printf "NA@NA}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{          \}}
\StringTok{      else}
\StringTok{        \{}
\StringTok{          printf "source:"  \#the source fingerprint uniq.}
\StringTok{          for(x=1; x\textless{}=f; x++)}
\StringTok{            \{}
\StringTok{              if(data\_s[FNR,x]!="")}
\StringTok{                \{}
\StringTok{                  printf data\_s[FNR,x]","}
\StringTok{                \}}
\StringTok{            \};}
\StringTok{          printf "@target:"  \#the target fingerprint uniq.}
\StringTok{          for(x=1; x\textless{}=f; x++)}
\StringTok{            \{}
\StringTok{              if(data\_t[FNR,x]!="")}
\StringTok{                \{}
\StringTok{                  printf data\_t[FNR,x]","}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{          printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{else}
\StringTok{  \{}
\StringTok{    printf "NA@NA}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{  \}}
\StringTok{\}}
\StringTok{\}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data\_allfp }\SpecialCharTok{$}\NormalTok{posindex }\SpecialCharTok{$}\NormalTok{negindex }\SpecialCharTok{$}\NormalTok{data }\SpecialCharTok{|}\NormalTok{ sed }\SpecialCharTok{{-}}\NormalTok{e }\StringTok{\textquotesingle{}s/,@/}\SpecialCharTok{\textbackslash{}t}\StringTok{/g; s/,$//g; s/@/}\SpecialCharTok{\textbackslash{}t}\StringTok{/g\textquotesingle{}}  \SpecialCharTok{\textgreater{}}\NormalTok{ results}\SpecialCharTok{/}\NormalTok{source\_target\_tree\_}\SpecialCharTok{$}\NormalTok{tlimit.tsv;}
\NormalTok{echo }\StringTok{"All instances have written into \textless{}results/source\_target\_tree\_$tlimit.tsv\textgreater{}."}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{echo }\StringTok{"step 5: separate child{-}nebula from parent{-}nebula."}
\NormalTok{data}\OtherTok{=}\StringTok{"results/stat\_classification.tsv"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/filter\_0\_class.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(FNR==1)}
\StringTok{    \{}
\StringTok{      for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{          if($i\textasciitilde{}/\^{}definition$/)}
\StringTok{            \{}
\StringTok{              col\_class=i}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FNR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{      class[$col\_class]=$col\_class}
\StringTok{    \}}
\StringTok{\}}
\StringTok{END\{}
\StringTok{for(i in class)}
\StringTok{  \{}
\StringTok{    printf class[i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{  \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{data1}\OtherTok{=}\StringTok{"temp/filter\_0\_class.tsv"} 
\NormalTok{data2}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\NormalTok{data3}\OtherTok{=}\StringTok{"results/fingerid\_first\_score.tsv"}
\NormalTok{until [[ }\StringTok{"$similarity\_limit"} \SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$similarity\_limit"} \SpecialCharTok{\textless{}} \DecValTok{1}\NormalTok{ ]]}
\NormalTok{do}
\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please set the Tanimoto similarity threshold contribute to child{-}nebula. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ similarity\_limit;}
\NormalTok{done;}
\NormalTok{until [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textgreater{}} \FloatTok{0.01}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textless{}} \DecValTok{1}\NormalTok{ ]]}
\NormalTok{do}
\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the classes posterior probabilities limition. 0.5\textasciitilde{}0.99 may work well. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ definition\_limit;}
\NormalTok{done;}
\NormalTok{class\_pp\_limit}\OtherTok{=}\ErrorTok{$}\NormalTok{definition\_limit}
\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/idenfication\_filter\_$class\_pp\_limit.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{      filter\_class[$1]=$1}
\StringTok{    \}}
\StringTok{  if(FILENAME\textasciitilde{}/canopus/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          col\_id=1}
\StringTok{          for(i=2; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              for(j in filter\_class)}
\StringTok{                \{}
\StringTok{                  if(j==$i)}
\StringTok{                    \{}
\StringTok{                      col\_class[j]=i}
\StringTok{                      print i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          for(i in col\_class)}
\StringTok{            \{}
\StringTok{              if(sprintf("\%.3f",$col\_class[i])+0\textgreater{}="\textquotesingle{}}\SpecialCharTok{$}\NormalTok{class\_pp\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{                \{}
\StringTok{                  class\_set[i,$col\_id]=i}
\StringTok{                  print "ID: ",$1,i,$col\_class[i]}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FILENAME\textasciitilde{}/fingerid\_first\_score/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if($i\textasciitilde{}/\^{}id/)}
\StringTok{                \{}
\StringTok{                  col\_id=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/similarity/)}
\StringTok{                \{}
\StringTok{                  col\_similarity=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{          printf "class\_nebula\_facet}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          if($col\_similarity+0 \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{similarity\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{            \{}
\StringTok{              for(i in class\_set)}
\StringTok{                \{}
\StringTok{                  if(i\textasciitilde{}"}\SpecialCharTok{\textbackslash{}034}\StringTok{"$col\_id"$")}
\StringTok{                    \{}
\StringTok{                      printf class\_set[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{data}\OtherTok{=}\StringTok{"temp/idenfication\_filter\_$class\_pp\_limit.tsv"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/idenfication\_filter2\_$\{class\_pp\_limit\}.tsv"}
\NormalTok{until [[ }\StringTok{"$num\_limit\_1"} \SpecialCharTok{{-}}\NormalTok{gt }\DecValTok{0}\NormalTok{ ]]}
\NormalTok{do}
\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the features number threshold contribute to child{-}nebula (min number). \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ num\_limit\_1;}
\NormalTok{done;}
\NormalTok{until [[ }\StringTok{"$num\_limit\_2"} \SpecialCharTok{{-}}\NormalTok{gt }\StringTok{"$num\_limit\_1"}\NormalTok{ ]]}
\NormalTok{do}
\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the features number threshold contribute to child{-}nebula (max number). \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ num\_limit\_2;}
\NormalTok{done;}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(FNR==1)}
\StringTok{    \{}
\StringTok{      printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{      for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{          if($i\textasciitilde{}/class\_nebula\_facet/)}
\StringTok{            \{}
\StringTok{              col\_class=i}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FNR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{      num[$col\_class]+=1}
\StringTok{      data[FNR]=$0}
\StringTok{      class[FNR]=$col\_class}
\StringTok{    \}}
\StringTok{\}}
\StringTok{END\{}
\StringTok{for(i in num)}
\StringTok{  \{}
\StringTok{    if(num[i]+0 \textgreater{}= \textquotesingle{}}\SpecialCharTok{$}\NormalTok{num\_limit\_1}\StringTok{\textquotesingle{}+0 \&\& num[i]+0 \textless{}= \textquotesingle{}}\SpecialCharTok{$}\NormalTok{num\_limit\_2}\StringTok{\textquotesingle{})}
\StringTok{      \{}
\StringTok{        printf "The nodes number of the child{-}nebula is " num[i] ".}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{        for(j in class)}
\StringTok{          \{}
\StringTok{            if(class[j]==i)}
\StringTok{              \{}
\StringTok{                printf data[j]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{              \}}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{mkdir results}\SpecialCharTok{/}\NormalTok{network\_facet\_}\SpecialCharTok{$}\NormalTok{class\_pp\_limit}
\NormalTok{data1}\OtherTok{=}\StringTok{"temp/idenfication\_filter2\_$\{class\_pp\_limit\}.tsv"}
\NormalTok{data2}\OtherTok{=}\StringTok{"results/source\_target\_tree\_$tlimit.tsv"} \CommentTok{\# "results/source\_target\_tree\_0.4.tsv"}
\NormalTok{save\_class}\OtherTok{=}\StringTok{"results/filter\_child\_class.tsv"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"results/network\_facet\_$class\_pp\_limit/"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if($i\textasciitilde{}/class\_nebula\_facet/)}
\StringTok{                \{}
\StringTok{                  col\_class=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/\^{}id$/)}
\StringTok{                \{}
\StringTok{                  col\_id=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          class[$col\_class]=$col\_class}
\StringTok{          class\_id[$col\_class,$col\_id]=$col\_id}
\StringTok{          stat\_id[$col\_class,$col\_id]=$col\_id}
\StringTok{          belong[$col\_class,$col\_id]=$col\_class}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(NR\textgreater{}FNR)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          for(i in class)}
\StringTok{            \{}
\StringTok{              printf i"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{save\_class}\StringTok{\textquotesingle{}"}
\StringTok{              printf $0"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "facet}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" i ".tsv"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          for(i in class)}
\StringTok{            \{}
\StringTok{              if( class\_id[i,$1]==$1 \&\& class\_id[i,$2]==$2 )}
\StringTok{                \{}
\StringTok{                  printf $0"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  i"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" i ".tsv"}
\StringTok{                  delete stat\_id[i,$1]}
\StringTok{                  delete stat\_id[i,$2]}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{\}}
\StringTok{END\{}
\StringTok{for(i in stat\_id)}
\StringTok{  \{}
\StringTok{    \#\# source target similarity delta\_mz fp fp class}
\StringTok{    printf stat\_id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" stat\_id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "1}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "0}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "null}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "null}\SpecialCharTok{\textbackslash{}t}\StringTok{"  belong[i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{"  \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" belong[i] ".tsv"}
\StringTok{  \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{data1}\OtherTok{=}\StringTok{"canopus.tsv"}
\NormalTok{data2}\OtherTok{=}\StringTok{"results/filter\_child\_class.tsv"}
\NormalTok{data3}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"results/canopus\_pp\_filter.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(FILENAME\textasciitilde{}/canopus.tsv/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if($i\textasciitilde{}/absolute/)}
\StringTok{                \{}
\StringTok{                  col\_index=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/\^{}id/)}
\StringTok{                \{}
\StringTok{                  col\_chemid=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/name/)}
\StringTok{                \{}
\StringTok{                  col\_name=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/description/)}
\StringTok{                \{}
\StringTok{                  col\_des=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}2)}
\StringTok{        \{}
\StringTok{          ab\_index[$col\_name]=$col\_index}
\StringTok{          chemid[$col\_name]=$col\_chemid}
\StringTok{          des[$col\_name]=$col\_des}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FILENAME\textasciitilde{}/filter\_child\_class/)}
\StringTok{    \{}
\StringTok{      class[$1]=$1}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          printf "index}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "chem\_id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "description}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/child\_class.tsv"}
\StringTok{        \}}
\StringTok{      printf ab\_index[$1]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  chemid[$1]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $1"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  des[$1]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/child\_class.tsv"}
\StringTok{    \}}
\StringTok{  if(FILENAME\textasciitilde{}/canopus\_pp/)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          printf $1 \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{          for(i=2; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if(class[$i]!="")}
\StringTok{                \{}
\StringTok{                  n+=1}
\StringTok{                  printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{C"ab\_index[$i] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                  col\_set[n]=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{          printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          printf $1 \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{          for(i=1; i\textless{}=n; i++)}
\StringTok{            \{}
\StringTok{              printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"$col\_set[i] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{          printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{structure\_candidate\_top}\ErrorTok{)}
\NormalTok{echo }\StringTok{"structure\_candidate\_top (awk version ≥ 3.1)."}
\NormalTok{projectpath}\OtherTok{=}\DecValTok{0}
\NormalTok{until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{do}
\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{done;}
\NormalTok{cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{d results ]}
\NormalTok{then echo }\StringTok{"Expand into target dir \textless{}results\textgreater{}"}
\ControlFlowTok{else}\NormalTok{ mkdir results}
\NormalTok{  mkdir temp}
\NormalTok{  mkdir temp}\SpecialCharTok{/}\NormalTok{fintemp;}
\NormalTok{fi;}
\DocumentationTok{\#\# gather all structure candidate}
\NormalTok{data}\OtherTok{=}\StringTok{"*\_*/fingerid/*.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{BEGIN\{}
\StringTok{all\_id=0}
\StringTok{max\_id={-}1}
\StringTok{p\_id="null"}
\StringTok{printf "Info: loading the data..."}
\StringTok{\}}
\StringTok{\{}
\StringTok{  if(FNR==1)}
\StringTok{    \{}
\StringTok{      if(NR\textgreater{}FNR)}
\StringTok{        \{}
\StringTok{          close(pfile)}
\StringTok{        \}}
\StringTok{      f=split(FILENAME,a,"[/]");}
\StringTok{      n=split(a[1],b,"[\_]");}
\StringTok{      id=b[n];}
\StringTok{      if(id!=p\_id)}
\StringTok{        \{}
\StringTok{          all\_id+=1}
\StringTok{          if(id\textgreater{}max\_id)}
\StringTok{            \{}
\StringTok{              max\_id=id}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      file[id]=a[1]}
\StringTok{      split(a[f], g, "[.]")}
\StringTok{      formu\_type[id]=g[1]}
\StringTok{      if(all\_id==1)}
\StringTok{        \{}
\StringTok{          printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "formula}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "smiles}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchi}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchikey2D}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "score}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "xlogp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "links}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/fingerid\_candidate\_all.tsv"}
\StringTok{          targetfile="results/fingerid\_candidate\_all.tsv"}
\StringTok{          for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if(($i\textasciitilde{}/inchikey2D/))}
\StringTok{                \{}
\StringTok{                  col\_2D=i}
\StringTok{                \}}
\StringTok{              if($i=="inchi")}
\StringTok{                \{}
\StringTok{                  col\_inchi=i}
\StringTok{                \}}
\StringTok{              if(($i\textasciitilde{}/Formula/))}
\StringTok{                \{}
\StringTok{                  col\_formu=i}
\StringTok{                \}}
\StringTok{              if($i=="score")}
\StringTok{                \{}
\StringTok{                  col\_score=i}
\StringTok{                \}}
\StringTok{              if($i=="name")}
\StringTok{                \{}
\StringTok{                  col\_name=i}
\StringTok{                \}}
\StringTok{              if($i=="smiles")}
\StringTok{                \{}
\StringTok{                  col\_smiles=i}
\StringTok{                \}}
\StringTok{              if($i=="xlogp")}
\StringTok{                \{}
\StringTok{                  col\_x=i}
\StringTok{                \}}
\StringTok{              if(($i\textasciitilde{}/imilarity/))}
\StringTok{                \{}
\StringTok{                  col\_simi=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/links/)}
\StringTok{                \{}
\StringTok{                  col\_links=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      pfile=FILENAME}
\StringTok{      printf g[1]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"formu\_type[id]"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{      printf "Info: the data of " id " (ID) has input. The filename is " FILENAME ".}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{    \}}
\StringTok{  if(FNR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{    \#\#  "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "formula}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "smiles}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchi}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchikey2D}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "score}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "xlogp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "links}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} targetfile}
\StringTok{    printf id"}\SpecialCharTok{\textbackslash{}t}\StringTok{" $col\_name"}\SpecialCharTok{\textbackslash{}t}\StringTok{" $col\_formu"}\SpecialCharTok{\textbackslash{}t}\StringTok{" $col\_simi"}\SpecialCharTok{\textbackslash{}t}\StringTok{" $col\_smiles"}\SpecialCharTok{\textbackslash{}t}\StringTok{" $col\_inchi"}\SpecialCharTok{\textbackslash{}t}\StringTok{" $col\_2D"}\SpecialCharTok{\textbackslash{}t}\StringTok{" $col\_score"}\SpecialCharTok{\textbackslash{}t}\StringTok{" $col\_x"}\SpecialCharTok{\textbackslash{}t}\StringTok{" $col\_links"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} targetfile}
\StringTok{    \}}
\StringTok{\} \textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\DocumentationTok{\#\# sort the candidates to get top 20 }
\NormalTok{version}\OtherTok{=}\DecValTok{0}
\NormalTok{version}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}BEGIN\{a[1]=1; asort(a, b); print b[1]\}\textquotesingle{}}\NormalTok{)}
\ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{$}\NormalTok{version }\SpecialCharTok{!=} \DecValTok{1}\NormalTok{ ]}
\NormalTok{then}
\NormalTok{  echo }\StringTok{"Awk version ≤ 3.1. Function \textless{}asort\textgreater{} not available."}
\NormalTok{fi}
\NormalTok{top\_n}\OtherTok{=}\DecValTok{20}
\NormalTok{data}\OtherTok{=}\StringTok{"results/fingerid\_candidate\_all.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(FNR==1)}
\StringTok{    \{}
\StringTok{      printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "formula}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "smiles}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchi}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchikey2D}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "score}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "xlogp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "links}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/fingerid\_candidate\_top.tsv"}
\StringTok{      targetfile="results/fingerid\_candidate\_top.tsv"}
\StringTok{      for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{          if($i\textasciitilde{}/\^{}id$/)}
\StringTok{            \{}
\StringTok{              col\_id=i}
\StringTok{            \}}
\StringTok{          if($i\textasciitilde{}/\^{}score/)}
\StringTok{            \{}
\StringTok{              col\_score=i}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FNR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{      if(id!=$col\_id)}
\StringTok{        \{}
\StringTok{          \#\# output data top10}
\StringTok{          if(id!="")}
\StringTok{            \{}
\StringTok{              j=asort(score, a)}
\StringTok{              for(i=j; i\textgreater{}=(j{-}\textquotesingle{}}\SpecialCharTok{$}\NormalTok{top\_n}\StringTok{\textquotesingle{}); i{-}{-})}
\StringTok{                \{}
\StringTok{                  if(i==0)}
\StringTok{                    \{}
\StringTok{                      break}
\StringTok{                    \}}
\StringTok{                  if(data[a[i]]=="")}
\StringTok{                    \{}
\StringTok{                      print "yes"}
\StringTok{                    \}}
\StringTok{                  printf data[a[i]]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} targetfile}
\StringTok{                \}}
\StringTok{              delete data}
\StringTok{              delete score}
\StringTok{            \}}
\StringTok{          \#\# gather first row of the id}
\StringTok{          n=1}
\StringTok{          score[n]=$col\_score}
\StringTok{          if(data[$col\_score]!="")}
\StringTok{            \{}
\StringTok{              $col\_score+=0.00000001}
\StringTok{            \}}
\StringTok{          data[$col\_score]=$0}
\StringTok{        \}}
\StringTok{    else}
\StringTok{        \{}
\StringTok{          n+=1}
\StringTok{          score[n]=$col\_score}
\StringTok{          if(data[$col\_score]!="")}
\StringTok{            \{}
\StringTok{              $col\_score+=0.00000001}
\StringTok{            \}}
\StringTok{          data[$col\_score]=$0}
\StringTok{        \}}
\StringTok{      id=$col\_id}
\StringTok{    \}}
\StringTok{\}}
\StringTok{END\{}
\StringTok{\{}
\StringTok{  j=asort(score, a)}
\StringTok{  for(i=j; i\textgreater{}=j{-}\textquotesingle{}}\SpecialCharTok{$}\NormalTok{top\_n}\StringTok{\textquotesingle{}; i{-}{-})}
\StringTok{    \{}
\StringTok{      if(i==0)}
\StringTok{        \{}
\StringTok{          break}
\StringTok{        \}}
\StringTok{      printf data[a[i]]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} targetfile}
\StringTok{    \}}
\StringTok{\}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\NormalTok{exit}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\StringTok{"(beta)"}\ErrorTok{)}
\NormalTok{exit;}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{exit}\ErrorTok{)}
\NormalTok{echo }\StringTok{"The mystery of creation is like the darkness of night{-}{-}it is great.}
\StringTok{Delusions of knowledge are like the fog of the morning."}
\NormalTok{exit;}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{*}\ErrorTok{)}
\NormalTok{echo }\StringTok{"error"}
\NormalTok{exit;}
\NormalTok{;;}
\NormalTok{esac;}
\NormalTok{done;}\CommentTok{\#(for)}
\NormalTok{done;}\CommentTok{\#(select)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-mdmn0717.sh}{%
\section{File: mdmn0717.sh}\label{file-mdmn0717.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{echo }\StringTok{"We are all in the gutter, }
\StringTok{but some of us are looking at the stars."}\NormalTok{;}

\NormalTok{PS3}\OtherTok{=}\StringTok{\textquotesingle{}Please select the workflow to be executed. \textgreater{}\textgreater{}\textgreater{} \textquotesingle{}}

\NormalTok{select command }\ControlFlowTok{in}\NormalTok{ \textbackslash{}}
\NormalTok{    \textbackslash{}}
    \StringTok{"default"}\NormalTok{ \textbackslash{}}
\NormalTok{    \textbackslash{}}
    \StringTok{"structure\_extract"}\NormalTok{ \textbackslash{}}
\NormalTok{    \textbackslash{}}
    \StringTok{"classification\_extract\_sum"}\NormalTok{ \textbackslash{}}
\NormalTok{    \textbackslash{}}
    \StringTok{"classification\_extract\_filter"}\NormalTok{ \textbackslash{}}
\NormalTok{    \textbackslash{}}
    \StringTok{"fragment\_tree\_network"}\NormalTok{ \textbackslash{}}
\NormalTok{    \textbackslash{}}
    \StringTok{"fragment\_tree\_network\_delta"}\NormalTok{ \textbackslash{}}
\NormalTok{    \textbackslash{}}
    \StringTok{"compound\_idenfication"}\NormalTok{ \textbackslash{}}
\NormalTok{    \textbackslash{}}
    \StringTok{"double\_ion\_network"}\NormalTok{ \textbackslash{}}
\NormalTok{    \textbackslash{}}
    \StringTok{"exit"} 
\NormalTok{do}
    
    \ControlFlowTok{if}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{command }\SpecialCharTok{==} \StringTok{"default"}\NormalTok{ ]]}
\NormalTok{    then}
    
\NormalTok{    confirm}\OtherTok{=}\DecValTok{0}
    
\NormalTok{        until [[ }\SpecialCharTok{$}\NormalTok{confirm }\SpecialCharTok{==} \StringTok{"yes"}\NormalTok{ ]] }\SpecialCharTok{||}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{confirm }\SpecialCharTok{==} \StringTok{"no"}\NormalTok{ ]]}
\NormalTok{        do}
\NormalTok{        read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Running all proccesses sequentially? [yes/no] \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ confirm}
\NormalTok{        done;}
        \ControlFlowTok{if}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{confirm }\SpecialCharTok{==} \StringTok{"no"}\NormalTok{ ]]}
\NormalTok{        then exit}
\NormalTok{        fi;}
        
\NormalTok{    default}\OtherTok{=}\StringTok{"structure\_extract classification\_extract\_sum classification\_extract\_filter fragment\_tree\_network fragment\_tree\_network\_delta"}
    
\NormalTok{    list}\OtherTok{=}\ErrorTok{$}\NormalTok{(echo }\SpecialCharTok{$}\NormalTok{default);}
    
    \ControlFlowTok{else}\NormalTok{ list}\OtherTok{=}\ErrorTok{$}\NormalTok{( echo }\SpecialCharTok{$}\NormalTok{command)}
\NormalTok{    fi;}
    
    \ControlFlowTok{for}\NormalTok{ option }\ControlFlowTok{in} \SpecialCharTok{$}\NormalTok{(echo }\SpecialCharTok{$}\NormalTok{list)}
\NormalTok{    do}
\NormalTok{        case }\SpecialCharTok{$}\NormalTok{option }\ControlFlowTok{in}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{structure\_extract}\ErrorTok{)}
\NormalTok{echo }\StringTok{"Run structure\_extract."}
\NormalTok{projectpath}\OtherTok{=}\DecValTok{0}
\NormalTok{    until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{canopus\_summary.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{    do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{    done;}
    
\NormalTok{cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{mkdir results;}
\NormalTok{mkdir temp;}
\NormalTok{mkdir temp}\SpecialCharTok{/}\NormalTok{fintemp;}

    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{Mo\_filename ]}
\NormalTok{    then rm temp}\SpecialCharTok{/}\NormalTok{Mo\_filename}
\NormalTok{    fi;}

\NormalTok{data}\OtherTok{=}\StringTok{"*\_*/fingerid/*.tsv"}

\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    BEGIN\{}
\StringTok{        all\_id=0}
\StringTok{        \textbackslash{}}
\StringTok{        max\_id={-}1}
\StringTok{        \textbackslash{}}
\StringTok{        p\_id="null"}
\StringTok{        \textbackslash{}}
\StringTok{        printf "Info: loading the data..."}
\StringTok{        \}}
\StringTok{    \{}
\StringTok{    if(FNR==1)}
\StringTok{        \{}
\StringTok{        if(NR\textgreater{}FNR)}
\StringTok{            \{}
\StringTok{            close(pfile)}
\StringTok{            \}}
\StringTok{        split(FILENAME,a,"[/]");}
\StringTok{    }
\StringTok{        n=split(a[1],b,"[\_]");}
\StringTok{    }
\StringTok{        id=b[n];}
\StringTok{    }
\StringTok{        if(id!=p\_id)}
\StringTok{            \{}
\StringTok{            all\_id+=1}
\StringTok{            \textbackslash{}}
\StringTok{            if(id\textgreater{}max\_id)}
\StringTok{                \{}
\StringTok{                max\_id=id}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        file[id]=a[1]}
\StringTok{        }
\StringTok{        if(all\_id==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if(($i\textasciitilde{}/inchikey2D/))}
\StringTok{                    \{}
\StringTok{                    col\_2D=i}
\StringTok{                    \}}
\StringTok{                if($i=="inchi")}
\StringTok{                    \{}
\StringTok{                    col\_inchi=i}
\StringTok{                    \}}
\StringTok{                if(($i\textasciitilde{}/Formula/))}
\StringTok{                    \{}
\StringTok{                    col\_formu=i}
\StringTok{                    \}}
\StringTok{                if($i=="score")}
\StringTok{                    \{}
\StringTok{                    col\_score=i}
\StringTok{                    \}}
\StringTok{                if($i=="name")}
\StringTok{                    \{}
\StringTok{                    col\_name=i}
\StringTok{                    \}}
\StringTok{                if($i=="smiles")}
\StringTok{                    \{}
\StringTok{                    col\_smiles=i}
\StringTok{                    \}}
\StringTok{                if($i=="xlogp")}
\StringTok{                    \{}
\StringTok{                    col\_x=i}
\StringTok{                    \}}
\StringTok{                if(($i\textasciitilde{}/imilarity/))}
\StringTok{                    \{}
\StringTok{                    col\_simi=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/links/)}
\StringTok{                    \{}
\StringTok{                    col\_links=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        pfile=FILENAME}
\StringTok{        }
\StringTok{        printf "Info: the data of " id " (ID) has input. The filename is " FILENAME ".}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{        \}}
\StringTok{    if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        row\_score=$col\_score}
\StringTok{        }
\StringTok{        row\_simi=$col\_simi}
\StringTok{        }
\StringTok{        if(max["score",id]=="" || max["score",id]\textless{}row\_score)}
\StringTok{            \{}
\StringTok{            max["score",id]=row\_score}
\StringTok{            }
\StringTok{            name["score",id]=$col\_name}
\StringTok{        }
\StringTok{            formula["score",id]=$col\_formu}
\StringTok{            }
\StringTok{            simi["score",id]=$col\_simi}
\StringTok{        }
\StringTok{            smiles["score",id]=$col\_smiles}
\StringTok{        }
\StringTok{            inchi["score",id]=$col\_inchi}
\StringTok{        }
\StringTok{            in2D["score",id]=$col\_2D}
\StringTok{            }
\StringTok{            score["score",id]=$col\_score}
\StringTok{        }
\StringTok{            xlogp["score",id]=$col\_x}
\StringTok{            }
\StringTok{            links["score",id]=$col\_links}
\StringTok{            \}}
\StringTok{        if(max["simi",id]=="" || max["simi",id]\textless{}row\_simi)}
\StringTok{            \{}
\StringTok{            max["simi",id]=row\_simi}
\StringTok{            }
\StringTok{            name["simi",id]=$col\_name}
\StringTok{        }
\StringTok{            formula["simi",id]=$col\_formu}
\StringTok{            }
\StringTok{            simi["simi",id]=$col\_simi}
\StringTok{        }
\StringTok{            smiles["simi",id]=$col\_smiles}
\StringTok{        }
\StringTok{            inchi["simi",id]=$col\_inchi}

\StringTok{            in2D["simi",id]=$col\_2D}
\StringTok{            }
\StringTok{            score["simi",id]=$col\_score}
\StringTok{         }
\StringTok{            xlogp["simi",id]=$col\_x}
\StringTok{            }
\StringTok{            links["simi",id]=$col\_links}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "formula}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "smiles}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchi}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchikey2D}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        "score}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "xlogp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "links}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/fingerid\_sum.tsv"}
\StringTok{        \textbackslash{}}
\StringTok{        for(l=1; l\textless{}=max\_id; l++)}
\StringTok{            \{}
\StringTok{            if(max["score",l]!="")}
\StringTok{                \{}
\StringTok{                printf l"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                name["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  formula["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  simi["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                smiles["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  inchi["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  in2D["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                score["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  xlogp["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  links["score",l]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/fingerid\_sum.tsv"}
\StringTok{                }
\StringTok{                printf formula["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  file[l]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "temp/Mo\_filename"}
\StringTok{                \}}
\StringTok{            if(max["simi",l]!="" \&\& max["simi",l]!=max["score",l])}
\StringTok{                \{}
\StringTok{                printf l"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                name["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  formula["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  simi["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                smiles["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  inchi["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  in2D["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                score["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  xlogp["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  links["simi",l]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/fingerid\_sum.tsv"}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}

\NormalTok{data\_sum}\OtherTok{=}\StringTok{"results/fingerid\_sum.tsv"}

\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==1)}
\StringTok{        \{}
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if($i\textasciitilde{}/id/)}
\StringTok{                \{}
\StringTok{                col\_id=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/score/)}
\StringTok{                \{}
\StringTok{                col\_score=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        id=$col\_id}
\StringTok{        \textbackslash{}}
\StringTok{        if(max\_id\textless{}id || max\_id=="")}
\StringTok{            \{}
\StringTok{            max\_id=id}
\StringTok{            \}}
\StringTok{        if(score[id]\textless{}$col\_score || score[id]=="")}
\StringTok{            \{}
\StringTok{            score[id]=$col\_score}
\StringTok{            \textbackslash{}}
\StringTok{            data[id]=$0}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "formula}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "smiles}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchi}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchikey2D}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        "score}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "xlogp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "links}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/fingerid\_first\_score.tsv"}
\StringTok{        \textbackslash{}}
\StringTok{        for(i=1; i\textless{}=max\_id; i++)}
\StringTok{            \{}
\StringTok{            if(data[i]!="")}
\StringTok{                \{}
\StringTok{                printf data[i] "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/fingerid\_first\_score.tsv"}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data\_sum}

\NormalTok{echo }\StringTok{"structure\_extract results have been successfully assembled into \textless{}results/fingerid\_sum.tsv\textgreater{} and \textless{}results/fingerid\_first\_score.tsv\textgreater{}"}\NormalTok{;}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{classification\_extract\_sum}\ErrorTok{)}

\NormalTok{echo }\StringTok{"Run classification\_extract\_sum."}\NormalTok{;}
    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{Mo\_filename ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f canopus.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f canopus\_neg.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f .format ]}
\NormalTok{    then}
\NormalTok{    echo }\StringTok{"Project path acknowledged."}
    \ControlFlowTok{else}
\NormalTok{        until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{canopus.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{        do}
\NormalTok{        read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{        done;}
\NormalTok{        cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{    fi;}
    
\NormalTok{data1}\OtherTok{=}\StringTok{"temp/Mo\_filename"}

\NormalTok{data2}\OtherTok{=}\StringTok{"canopus.tsv"}

\NormalTok{data3}\OtherTok{=}\StringTok{"canopus\_neg.tsv"}

\NormalTok{datas}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(system("test {-}f " $2 "/canopus/" $1 "*.fpt"))}
\StringTok{        \{}
\StringTok{        printf ""}
\StringTok{        \}}
\StringTok{    else}
\StringTok{        \{}
\StringTok{        printf $2 "/canopus/" $1 "*.fpt "}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1)}
    
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        file[FNR]=$2}
\StringTok{        }
\StringTok{        mo[$2]=$1}
\StringTok{        }
\StringTok{        i=split($2,s,"[\_]")}
\StringTok{        }
\StringTok{        the\_id[FNR]=s[i]}
\StringTok{        }
\StringTok{        n=FNR}
\StringTok{        \}}
\StringTok{    if((FILENAME \textasciitilde{} /\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data2}\StringTok{\textquotesingle{}/))}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            close("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data1}\StringTok{\textquotesingle{}")}
\StringTok{            }
\StringTok{            printf "Info: data\_file name of \textquotesingle{}}\SpecialCharTok{$}\NormalTok{data1}\StringTok{\textquotesingle{} has been input.}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{            }
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if(($i \textasciitilde{} /name/))}
\StringTok{                    \{}
\StringTok{                    col\_class=i}
\StringTok{                    \}}
\StringTok{                if(($i \textasciitilde{} /absolute/))}
\StringTok{                    \{}
\StringTok{                    col\_abindex=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            abindex[1,FNR]=$col\_abindex}
\StringTok{            }
\StringTok{            class[1,$col\_abindex]=$col\_class}
\StringTok{            }
\StringTok{            rows\_data2=FNR}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if((FILENAME \textasciitilde{} /\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data3}\StringTok{\textquotesingle{}/))}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            close("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data2}\StringTok{\textquotesingle{}")}
\StringTok{            }
\StringTok{            printf "Info: data\_file name of \textquotesingle{}}\SpecialCharTok{$}\NormalTok{data2}\StringTok{\textquotesingle{} has been input.}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{            }
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if(($i \textasciitilde{} /name/))}
\StringTok{                    \{}
\StringTok{                    col\_class=i}
\StringTok{                    \}}
\StringTok{                if(($i \textasciitilde{} /absolute/))}
\StringTok{                    \{}
\StringTok{                    col\_abindex=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            abindex[2,FNR]=$col\_abindex}
\StringTok{            }
\StringTok{            class[2,$col\_abindex]=$col\_class}
\StringTok{            }
\StringTok{            rows\_data3=FNR}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if((FILENAME \textasciitilde{} /fpt/))}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            if(p\_filename=="")}
\StringTok{                \{}
\StringTok{                close("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data3}\StringTok{\textquotesingle{}")}
\StringTok{                \}}
\StringTok{            else if(FILENAME!=p\_filename)}
\StringTok{                \{}
\StringTok{                close(p\_filename)}
\StringTok{                }
\StringTok{                printf "Info: data\_file name of " p\_filename " has been input.}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{                \}}
\StringTok{            p\_filename=FILENAME}
\StringTok{            \textbackslash{}}
\StringTok{            for(i=1; i\textless{}=n; i++)}
\StringTok{                \{}
\StringTok{                if((FILENAME \textasciitilde{} file[i]) \&\& (FILENAME \textasciitilde{} mo[file[i]]))}
\StringTok{                    \{}
\StringTok{                    break}
\StringTok{                    \}}
\StringTok{                else}
\StringTok{                    \{}
\StringTok{                    x=i+1}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            if(x==n+1)}
\StringTok{                \{}
\StringTok{                nextfile}
\StringTok{                \}}
\StringTok{            split(FILENAME,a,"[/]");}

\StringTok{            m=split(a[1],b,"[\_]");}

\StringTok{            id=b[m];}

\StringTok{            if((FILENAME \textasciitilde{} /\textbackslash{}+.fpt/))}
\StringTok{                \{}
\StringTok{                ion=1}
\StringTok{                \}}
\StringTok{            else}
\StringTok{                \{}
\StringTok{                ion=2}
\StringTok{                \}}
\StringTok{            pp[id,abindex[ion,2]]=$1}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            pp[id,abindex[ion,FNR+1]]=$1}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        if(abindex[1,rows\_data2] \textgreater{} abindex[2,rows\_data3])}
\StringTok{            \{}
\StringTok{            maxindex=abindex[1,rows\_data2]}
\StringTok{            \}}
\StringTok{        else}
\StringTok{            \{}
\StringTok{            maxindex=abindex[2,rows\_data3]}
\StringTok{            \}}
\StringTok{        printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{} "results/canopus\_pp.tsv"}
\StringTok{        \textbackslash{}}
\StringTok{        for(i=0; i\textless{}=maxindex; i++)}
\StringTok{            \{}
\StringTok{            if(class[1,i]!="" \&\& i!=maxindex)}
\StringTok{                \{}
\StringTok{                printf class[1,i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{                \}}
\StringTok{            else if(class[2,i]!="" \&\& i!=maxindex)}
\StringTok{                \{}
\StringTok{                printf class[2,i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{                \}}
\StringTok{            else if(i==maxindex \&\& class[1,i]!="")}
\StringTok{                \{}
\StringTok{                printf class[1,i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{                \}}
\StringTok{            else if(i==maxindex \&\& class[2,i]!="")}
\StringTok{                \{}
\StringTok{                printf class[2,i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        for(i=1; i\textless{}=n; i++)}
\StringTok{            \{}
\StringTok{            printf the\_id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{            }
\StringTok{            for(j=0; j\textless{}=maxindex; j++)}
\StringTok{                \{}
\StringTok{                if(class[1,j]!="" \&\& j!=maxindex || class[2,j]!="" \&\& j!=maxindex)}
\StringTok{                    \{}
\StringTok{                    if(pp[the\_id[i],j]=="")}
\StringTok{                        \{}
\StringTok{                        printf 0"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{                        \}}
\StringTok{                    else}
\StringTok{                        \{}
\StringTok{                        printf pp[the\_id[i],j]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                else if(class[1,j]!="" \&\& j==maxindex || class[2,j]!="" \&\& j==maxindex)}
\StringTok{                    \{}
\StringTok{                    if(pp[the\_id[i],j]=="")}
\StringTok{                        \{}
\StringTok{                        printf 0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{                        \}}
\StringTok{                    else}
\StringTok{                        \{}
\StringTok{                        printf pp[the\_id[i],j]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3 }\SpecialCharTok{$}\NormalTok{datas}

\NormalTok{echo }\StringTok{"classification\_extract\_sum have been successfully written into \textless{}results/canopus\_pp.tsv\textgreater{}"}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}

\NormalTok{classification\_extract\_filter}\ErrorTok{)}
\NormalTok{echo }\StringTok{"Run classification\_extract\_filter."}\NormalTok{;}
    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f results}\SpecialCharTok{/}\NormalTok{canopus\_pp.tsv ]}
\NormalTok{    then}
\NormalTok{    echo }\StringTok{"Project path acknowledged."}
    \ControlFlowTok{else}
\NormalTok{        until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{results}\SpecialCharTok{/}\NormalTok{canopus\_pp.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{results}\SpecialCharTok{/}\NormalTok{canopus\_summary.tsv ]}
\NormalTok{        do}
\NormalTok{        read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{        done;}
\NormalTok{        cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{    fi; }
    
\NormalTok{check}\OtherTok{=}\DecValTok{0}
\NormalTok{    until [[ }\StringTok{"$check"} \SpecialCharTok{==} \StringTok{"yes"}\NormalTok{ ]] }\SpecialCharTok{||}\NormalTok{ [[ }\StringTok{"$check"} \SpecialCharTok{==} \StringTok{"no"}\NormalTok{ ]]}
\NormalTok{    do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Collate the posterior probabilities of the classification of each feature? [yes/no] \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ check;}
\NormalTok{    done;}
    
    \ControlFlowTok{if}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{check }\SpecialCharTok{==} \StringTok{"yes"}\NormalTok{ ]]}
\NormalTok{    then}
\NormalTok{    definition\_limit}\OtherTok{=}\DecValTok{0}
    
\NormalTok{        until [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textgreater{}} \StringTok{"0.01"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textless{}} \StringTok{"1"}\NormalTok{ ]]}
\NormalTok{        do}
\NormalTok{        read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the posterior probabilities limition. 0.5\textasciitilde{}0.99 may work well. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ definition\_limit;}
\NormalTok{        done;}
    
\NormalTok{    data1}\OtherTok{=}\StringTok{"canopus\_summary.tsv"}
 
\NormalTok{    data2}\OtherTok{=}\StringTok{"canopus.tsv"}
 
\NormalTok{    data3}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
    
\NormalTok{    awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{        \{}
\StringTok{        if(NR==FNR)}
\StringTok{            \{}
\StringTok{            if(FNR==1)}
\StringTok{                \{}
\StringTok{                p\_file=FILENAME}
\StringTok{                \textbackslash{}}
\StringTok{                for(i=1; i\textless{}=NF; i++)}
\StringTok{                    \{}
\StringTok{                    if($i\textasciitilde{}/name/)}
\StringTok{                        \{}
\StringTok{                        col\_id=i}
\StringTok{                        \}}
\StringTok{                    if($i\textasciitilde{}/specific/)}
\StringTok{                        \{}
\StringTok{                        col\_specific=i}
\StringTok{                        \}}
\StringTok{                    if($i\textasciitilde{}/level/)}
\StringTok{                        \{}
\StringTok{                        col\_level=i}
\StringTok{                        \}}
\StringTok{                    if($i\textasciitilde{}/subclass/)}
\StringTok{                        \{}
\StringTok{                        col\_subclass=i}
\StringTok{                        \}}
\StringTok{                    if($i\textasciitilde{}/\^{}class/)}
\StringTok{                        \{}
\StringTok{                        col\_class=i}
\StringTok{                        \}}
\StringTok{                    if($i\textasciitilde{}/superclass/)}
\StringTok{                        \{}
\StringTok{                        col\_superclass=i}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            if(FNR\textgreater{}=2)}
\StringTok{                \{}
\StringTok{                n=split($col\_id,a,"[\_]")}
\StringTok{                \textbackslash{}}
\StringTok{                id=a[n]}
\StringTok{                \textbackslash{}}
\StringTok{                specific[id]=$col\_specific}
\StringTok{                \textbackslash{}}
\StringTok{                level[id]=$col\_level}
\StringTok{                \textbackslash{}}
\StringTok{                subclass[id]=$col\_subclass}
\StringTok{                \textbackslash{}}
\StringTok{                class[id]=$col\_class}
\StringTok{                \textbackslash{}}
\StringTok{                superclass[id]=$col\_superclass}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FILENAME\textasciitilde{}/canopus.tsv/)}
\StringTok{            \{}
\StringTok{            if(FNR==1)}
\StringTok{                \{}
\StringTok{                close(p\_file)}
\StringTok{                \textbackslash{}}
\StringTok{                p\_file=FILENAME}
\StringTok{                \textbackslash{}}
\StringTok{                for(i=1; i\textless{}=NF; i++)}
\StringTok{                    \{}
\StringTok{                    if($i\textasciitilde{}/name/)}
\StringTok{                        \{}
\StringTok{                        col\_name=i}
\StringTok{                        \}}
\StringTok{                    if($i\textasciitilde{}/description/)}
\StringTok{                        \{}
\StringTok{                        col\_description=i}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            if(FNR\textgreater{}=2)}
\StringTok{                \{}
\StringTok{                description[$col\_name]=$col\_description}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FILENAME\textasciitilde{}"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data3}\StringTok{\textquotesingle{}")}
\StringTok{            \{}
\StringTok{            if(FNR==1)}
\StringTok{                \{}
\StringTok{                close(p\_file)}
\StringTok{                \textbackslash{}}
\StringTok{                for(i=1; i\textless{}=NF; i++)}
\StringTok{                    \{}
\StringTok{                    if($i\textasciitilde{}/\^{}id$/)}
\StringTok{                        \{}
\StringTok{                        col\_id=i}
\StringTok{                        \}}
\StringTok{                    if(i\textgreater{}=2)}
\StringTok{                        \{}
\StringTok{                        col\_class\_name[i]=$i}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition\_source}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition\_description}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                "specific}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "specific\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "level\_5}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "level\_5\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                "subclass}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "subclass\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "class}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "class\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "superclass}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "superclass\_pp}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                \textgreater{} "results/stat\_classification.tsv"}
\StringTok{                \}}
\StringTok{            if(FNR\textgreater{}=2)}
\StringTok{                \{}
\StringTok{                for(i=2; i\textless{}=NF; i++)}
\StringTok{                    \{}
\StringTok{                    c\_pp[col\_class\_name[i]]=sprintf("\%.4f",$i)}
\StringTok{                    \}}
\StringTok{                if(level[$col\_id] != "" \&\& c\_pp[level[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{                    \{}
\StringTok{                    definition\_source="level\_5"}
\StringTok{                    \textbackslash{}}
\StringTok{                    definition=level[$col\_id]}
\StringTok{                    \}}
\StringTok{                else if(subclass[$col\_id] != "" \&\& c\_pp[subclass[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{                    \{}
\StringTok{                    definition\_source="subclass"}
\StringTok{                    \textbackslash{}}
\StringTok{                    definition=subclass[$col\_id]}
\StringTok{                    \}}
\StringTok{                else if(class[$col\_id] != "" \&\& c\_pp[class[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{                    \{}
\StringTok{                    definition\_source="class"}
\StringTok{                    \textbackslash{}}
\StringTok{                    definition=class[$col\_id]}
\StringTok{                    \}}
\StringTok{                else if(superclass[$col\_id] != "" \&\& c\_pp[superclass[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{                    \{}
\StringTok{                    definition\_source="superclass"}
\StringTok{                    \textbackslash{}}
\StringTok{                    definition=superclass[$col\_id]}
\StringTok{                    \}}
\StringTok{                else}
\StringTok{                    \{}
\StringTok{                    definition\_source="null"}
\StringTok{                    \textbackslash{}}
\StringTok{                    definition="null"}
\StringTok{                    \textbackslash{}}
\StringTok{                    c\_pp[definition]="null"}
\StringTok{                    \textbackslash{}}
\StringTok{                    description[definition]="null"}
\StringTok{                    \}}
\StringTok{                printf $col\_id"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  definition\_source"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  definition"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[definition]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  description[definition]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                specific[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[specific[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  level[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[level[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                subclass[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[subclass[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  class[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[class[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                superclass[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[superclass[$col\_id]]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/stat\_classification.tsv"}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
    
\NormalTok{    echo }\StringTok{"classification\_extract\_filter have been successfully written into \textless{}results/stat\_classification.tsv\textgreater{}"}
    
\NormalTok{    fi;}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{fragment\_tree\_network}\ErrorTok{)}

\NormalTok{echo }\StringTok{"Run fragment\_tree\_network."}\NormalTok{;}

    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{d temp ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f .format ]}
\NormalTok{    then}
\NormalTok{    echo }\StringTok{"Project path acknowledged."}
    
    \ControlFlowTok{else}
\NormalTok{        until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{        do}
\NormalTok{        read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project. Make sure you have moved the fragment tree alignment results to the directory where the project is located. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{        done;}
\NormalTok{        cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{    fi;}

\NormalTok{echo }\StringTok{"Please enter the minimum alignment similarity that you want to filter."}

\NormalTok{tlimit}\OtherTok{=}\DecValTok{0}
\NormalTok{    until [[ }\StringTok{"$tlimit"} \SpecialCharTok{\textgreater{}} \StringTok{"0.1"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$tlimit"} \SpecialCharTok{\textless{}} \StringTok{"0.9"}\NormalTok{ ]]}
\NormalTok{    do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"0.4{-}0.7 is recommended \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ tlimit;}
\NormalTok{    done;}

\NormalTok{mkdir temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}

\NormalTok{data}\OtherTok{=}\NormalTok{ftalign.tsv}

\NormalTok{ftalign}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v }\AttributeTok{OFS=}\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{        if(NR==1 \&\& i!=1 || NR!=1 \&\& i==1)}
\StringTok{            \{}
\StringTok{            n=split($i,x,"[\_]")}
\StringTok{            \textbackslash{}}
\StringTok{            raw[NR,i]=x[n]}
\StringTok{            \}}
\StringTok{        else}
\StringTok{            \{}
\StringTok{            raw[NR,i]=$i}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        for(a=2; a\textless{}=NR; a++)}
\StringTok{            \{}
\StringTok{            for(b=2; b\textless{}=NF; b++)}
\StringTok{                \{}
\StringTok{                norm1[a,b]=raw[a,b]/raw[a,a];}
\StringTok{                \textbackslash{}}
\StringTok{                norm2[a,b]=raw[a,b]/raw[b,b];}
\StringTok{                \textbackslash{}}
\StringTok{                norms[a,b]=(norm1[a,b]+norm2[a,b])/2;}
\StringTok{                \textbackslash{}}
\StringTok{                if(norms[a,b]\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tlimit}\StringTok{\textquotesingle{} \&\& norms[a,b]\textless{}=0.999)}
\StringTok{                    \{}
\StringTok{                    if(raw[a,1]\textgreater{}=raw[1,b])}
\StringTok{                        \{}
\StringTok{                        print raw[a,1],raw[1,b],norms[a,b]}
\StringTok{                        \}}
\StringTok{                    else}
\StringTok{                        \{}
\StringTok{                        print raw[1,b],raw[a,1],norms[a,b]}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data)}
    
\NormalTok{sort }\SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$ftalign"}\NormalTok{) }\SpecialCharTok{|}\NormalTok{ uniq }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{filter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit}

\NormalTok{echo }\StringTok{"fragment\_tree\_network have been successfully written into \textless{}temp/ftaligntemp/filter\_net\_$tlimit\textgreater{}"}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}

\NormalTok{fragment\_tree\_network\_delta}\ErrorTok{)}

    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{d temp ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f .format ]}
\NormalTok{    then}
\NormalTok{    echo }\StringTok{"Project path acknowledged."}
    \ControlFlowTok{else}
\NormalTok{        until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{        do}
\NormalTok{        read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{        done;}
\NormalTok{    cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{    fi;}
\NormalTok{echo }\StringTok{"The following module attempts to compute the differential fingerprints of connected clusters based on the molecular fingerprint results of sirius 4."}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}

\NormalTok{plimit}\OtherTok{=}\DecValTok{0}
\NormalTok{    until [[ }\StringTok{"$plimit"} \SpecialCharTok{\textgreater{}} \StringTok{"0.5"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$plimit"} \SpecialCharTok{\textless{}} \StringTok{"0.99"}\NormalTok{ ]]}
\NormalTok{    do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the minimum posterior probability of the molecular fingerprint to be filtered. 0.9{-}0.99 is recommended. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ plimit;}
\NormalTok{    done;}

\NormalTok{plimit2}\OtherTok{=}\DecValTok{0}
\NormalTok{    until [[ }\StringTok{"$plimit2"} \SpecialCharTok{\textgreater{}} \StringTok{"0.1"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$plimit2"} \SpecialCharTok{\textless{}} \StringTok{"$plimit"}\NormalTok{ ]]}
\NormalTok{    do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"The minimum posterior probability of the molecular fingerprint to be controled. 0.1{-}0.5 may work well. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ plimit2;}
\NormalTok{    done;}
    
\NormalTok{tlimit}\OtherTok{=}\ErrorTok{$}\NormalTok{(ls temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{filter\_net\_}\SpecialCharTok{*} \ErrorTok{|}\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F \_ }\StringTok{\textquotesingle{}\{print $NF\}\textquotesingle{}}\NormalTok{)}

\NormalTok{check\_rep}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}END\{print NR\}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$tlimit"}\NormalTok{))}

    \ControlFlowTok{if}\NormalTok{ [[ }\StringTok{"$check\_rep"} \SpecialCharTok{\textgreater{}} \StringTok{"1"}\NormalTok{ ]]}
\NormalTok{    then}
\NormalTok{        until [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{filter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit ]}
\NormalTok{        do}
\NormalTok{        read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Plural and different fragment\_tree\_network files were found to exist locally. Please select a tlimit parameter you have utilized to run fragment\_tree\_network\_delta. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ tlimit;}
\NormalTok{        done;}
\NormalTok{    fi;}
    
    
    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{refilter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit ]}
\NormalTok{    then rm temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{refilter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit}
\NormalTok{    fi;}
    
    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{fpsample ]}
\NormalTok{    then rm temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{fpsample}
\NormalTok{    fi;}

\NormalTok{echo }\StringTok{"Running delta\_fingerprint computation..."}

\NormalTok{echo }\StringTok{"Aquiring data from sirius index..."}

\NormalTok{data1}\OtherTok{=}\StringTok{"*\_*/compound.info"}

\NormalTok{data2}\OtherTok{=}\StringTok{"temp/ftaligntemp/filter\_net\_$tlimit"}

\NormalTok{echo }\StringTok{"Run fragment\_tree\_network\_delta."}

\NormalTok{data}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F [}\StringTok{"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}\SpecialCharTok{:}\NormalTok{\_}\StringTok{"\textbackslash{}]"}\NormalTok{] }\SpecialCharTok{{-}}\NormalTok{v }\AttributeTok{OFS=}\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    BEGIN\{}
\StringTok{        printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "m/z}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "rt}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{        \}}
\StringTok{    \{}
\StringTok{    if(FILENAME\textasciitilde{}/compound.info/)}
\StringTok{        \{}
\StringTok{        if($1=="name")}
\StringTok{            \{}
\StringTok{            i+=1;}
\StringTok{            }
\StringTok{            id[i]=$NF;}
\StringTok{            }
\StringTok{            n=split($NF,a,"[\_]")}
\StringTok{            }
\StringTok{            printf a[n]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{            \}}
\StringTok{        if($1=="ionMass")}
\StringTok{            \{}
\StringTok{            mz[id[i]]=$NF}
\StringTok{            }
\StringTok{            printf sprintf("\%.4f",$NF)"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{            \}}
\StringTok{        if($1=="ionType")}
\StringTok{            \{}
\StringTok{            type[id[i]]=$NF}
\StringTok{            \}}
\StringTok{        if($1=="rt")}
\StringTok{            \{}
\StringTok{            rt[id[i]]=$2;}
\StringTok{            }
\StringTok{            printf sprintf("\%.2f",$NF)"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FILENAME\textasciitilde{}/ftaligntemp/)}
\StringTok{        \{}
\StringTok{        \#source  target  ftalign  delta\_mz  delta\_rt  source\_iontype  target\_iontype;}
\StringTok{        }
\StringTok{        print $1,$2,$3,sprintf("\%.3f",mz[$2]{-}mz[$1]),sprintf("\%.2f",rt[$2]{-}rt[$1]),type[$1],type[$2]}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2)}
    
\NormalTok{data\_path}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F [}\StringTok{"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}\NormalTok{\_] }\SpecialCharTok{{-}}\NormalTok{v }\AttributeTok{OFS=}\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        mo[$NF]=$1}
\StringTok{        \}}
\StringTok{    if(NR!=FNR)}
\StringTok{        \{}
\StringTok{        if(mo[$1]!="" \&\& mo[$2]!="")}
\StringTok{            \{}
\StringTok{            \textbackslash{}}
\StringTok{            \#\textless{}path\textgreater{}sourceFormula  \textless{}path\textgreater{}targetFormula}
\StringTok{            \textbackslash{}}
\StringTok{            printf "*\_" $1 "/fingerprints/" mo[$1] "*}\SpecialCharTok{\textbackslash{}n}\StringTok{"   "*\_" $2 "/fingerprints/" mo[$2] "*}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{Mo\_filename }\SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$data"}\NormalTok{) }\SpecialCharTok{|}\NormalTok{ sort }\SpecialCharTok{{-}}\NormalTok{u }\SpecialCharTok{|}\NormalTok{ awk }\StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(system("test {-}f " $1))}
\StringTok{        \{}
\StringTok{        printf ""}
\StringTok{        \}}
\StringTok{    else}
\StringTok{        \{}
\StringTok{        print $1}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{|}\NormalTok{ paste }\SpecialCharTok{{-}}\NormalTok{d }\StringTok{" "} \SpecialCharTok{{-}}\NormalTok{s)}
    
\NormalTok{data\_allfp}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v }\AttributeTok{OFS=}\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    BEGIN\{}
\StringTok{        n=0}
\StringTok{        \}}
\StringTok{    \{}
\StringTok{    if(FNR==1)}
\StringTok{        \{}
\StringTok{        if(n\textgreater{}=1)}
\StringTok{            \{}
\StringTok{            close(file)}
\StringTok{            \}}
\StringTok{        file=FILENAME;}
\StringTok{        \textbackslash{}}
\StringTok{        n+=1;}
\StringTok{        \textbackslash{}}
\StringTok{        printf FILENAME"}\SpecialCharTok{\textbackslash{}n}\StringTok{"$0"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{        \}}
\StringTok{    else}
\StringTok{        \{}
\StringTok{        print $0}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data\_path)}
    
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}\{if(NR\textgreater{}=2)\{print $2,$3\}\}\textquotesingle{}}\NormalTok{ csi\_fingerid.tsv }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{pos\_fingerprint\_index;}

\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}\{if(NR\textgreater{}=2)\{print $2,$3\}\}\textquotesingle{}}\NormalTok{ csi\_fingerid\_neg.tsv }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{neg\_fingerprint\_index;}

\NormalTok{posindex}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}\{print $1\}\textquotesingle{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{pos\_fingerprint\_index)}

\NormalTok{negindex}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}\{print $1\}\textquotesingle{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{neg\_fingerprint\_index)}

\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    BEGIN\{}
\StringTok{        file=0}
\StringTok{        x=0}
\StringTok{        count=0}
\StringTok{        f=0}
\StringTok{        posnum=0}
\StringTok{        negnum=0}
\StringTok{        \}}
\StringTok{    \{}
\StringTok{    if(FNR==1)}
\StringTok{        \{}
\StringTok{        file+=1}
\StringTok{        \}}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        if(($1\textasciitilde{}/fingerprint/))}
\StringTok{            \{}
\StringTok{            if(x\textgreater{}f)}
\StringTok{                \{}
\StringTok{                f=x  \# calculate the max index.}
\StringTok{                \}}
\StringTok{            count+=1;  \# calculate the all fingerprints file number.}
\StringTok{            \textbackslash{}}
\StringTok{            split($1,a,"[/]"); e=split(a[1],b,"[\_]"); id=b[e]; \#catch the id.}
\StringTok{            \textbackslash{}}
\StringTok{            x=0;}
\StringTok{            \}}
\StringTok{        else}
\StringTok{            \{}
\StringTok{            x+=1;}
\StringTok{            \textbackslash{}}
\StringTok{            fp[id,x]=$1;}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(file==2)}
\StringTok{        \{}
\StringTok{        pos[FNR]=$1}
\StringTok{        posnum+=1}
\StringTok{        \}}
\StringTok{    if(file==3)}
\StringTok{        \{}
\StringTok{        neg[FNR]=$1}
\StringTok{        negnum+=1}
\StringTok{        \}}
\StringTok{    if(file==4)}
\StringTok{        \{}
\StringTok{        if(fp[$1,1]!="" \&\& fp[$2,1]!="")}
\StringTok{            \{}
\StringTok{            if($6=="+" \&\& $7=="+")}
\StringTok{                \{}
\StringTok{                for(x=1; x\textless{}=posnum; x++)}
\StringTok{                    \{}
\StringTok{                    if(fp[$1,x]\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{} \&\& fp[$2,x]\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{})}
\StringTok{                        \{}
\StringTok{                        data\_s[FNR,x]=pos[x]}
\StringTok{                        \}}
\StringTok{                    else if(fp[$2,x]\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{} \&\& fp[$1,x]\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{})}
\StringTok{                        \{}
\StringTok{                        data\_t[FNR,x]=pos[x]}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            if($6=="{-}" \&\& $7=="{-}")}
\StringTok{                \{}
\StringTok{                for(x=1; x\textless{}=negnum; x++)}
\StringTok{                    \{}
\StringTok{                    if(fp[$1,x]\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{} \&\& fp[$2,x]\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{})}
\StringTok{                        \{}
\StringTok{                        data\_s[FNR,x]=neg[x]}
\StringTok{                        \}}
\StringTok{                    else if(fp[$2,x]\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{} \&\& fp[$1,x]\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{})}
\StringTok{                        \{}
\StringTok{                        data\_t[FNR,x]=neg[x]}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            if($6=="{-}" \&\& $7=="+" || $7=="{-}" \&\& $6=="+")}
\StringTok{                \{}
\StringTok{                for(i=1; i\textless{}=posnum; i++)}
\StringTok{                    \{}
\StringTok{                    for(j=1; j\textless{}=negnum; j++)}
\StringTok{                        \{}
\StringTok{                        if(pos[i]==neg[j])}
\StringTok{                            \{}
\StringTok{                            mirror[i]=j     \#if pos=i, the identical index of neg is mirror[i]}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            if($6=="{-}" \&\& $7=="+")  }
\StringTok{                \{}
\StringTok{                for(x=1; x\textless{}=f; x++)}
\StringTok{                    \{}
\StringTok{                    if(fp[$1,mirror[x]]\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{} \&\& fp[$2,x]\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{})}
\StringTok{                        \{}
\StringTok{                        data\_s[FNR,x]=neg[mirror[x]]}
\StringTok{                        \}}
\StringTok{                    else if(fp[$2,x]\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{} \&\& fp[$1,mirror[x]]\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{})}
\StringTok{                        \{}
\StringTok{                        data\_t[FNR,x]=neg[mirror[x]]}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            if($7=="{-}" \&\& $6=="+")}
\StringTok{                \{}
\StringTok{                for(x=1; x\textless{}=f; x++)}
\StringTok{                    \{}
\StringTok{                    if(fp[$1,x] \textgreater{}= \textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{} \&\& fp[$2,mirror[x]]\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{})}
\StringTok{                        \{}
\StringTok{                        data\_s[FNR,x]=neg[mirror[x]]}
\StringTok{                        \}}
\StringTok{                    else if(fp[$2,mirror[x]]\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{} \&\& fp[$1,x]\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{})}
\StringTok{                        \{}
\StringTok{                        data\_t[FNR,x]=neg[mirror[x]]}
\StringTok{                        \}}
\StringTok{                    \}       }
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            printf "source}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "target}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "ftalign\_similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "delta\_m/z}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "source\_fp\_uniq}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "target\_fp\_uniq}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{            \}}
\StringTok{        else}
\StringTok{            \{}
\StringTok{            printf $1"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $2"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $3"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $4"}\SpecialCharTok{\textbackslash{}t}\StringTok{";}
\StringTok{            \textbackslash{}}
\StringTok{            if(fp[$1,1]=="" || fp[$2,1]=="")}
\StringTok{                \{}
\StringTok{                printf "NA@NA}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{                \}}
\StringTok{            else}
\StringTok{                \{}
\StringTok{                printf "source:"  \#the source fingerprint uniq.}
\StringTok{                \textbackslash{}}
\StringTok{                for(x=1; x\textless{}=f; x++)}
\StringTok{                    \{}
\StringTok{                    if(data\_s[FNR,x]!="")}
\StringTok{                        \{}
\StringTok{                        printf data\_s[FNR,x]","}
\StringTok{                        \}}
\StringTok{                    \};}
\StringTok{                printf "@target:"  \#the target fingerprint uniq.}
\StringTok{                \textbackslash{}}
\StringTok{                for(x=1; x\textless{}=f; x++)}
\StringTok{                    \{}
\StringTok{                    if(data\_t[FNR,x]!="")}
\StringTok{                        \{}
\StringTok{                        printf data\_t[FNR,x]","}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$data\_allfp"}\NormalTok{) }\SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$posindex"}\NormalTok{) }\SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$negindex"}\NormalTok{) }\SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$data"}\NormalTok{) }\SpecialCharTok{|}\NormalTok{ sed }\SpecialCharTok{{-}}\NormalTok{e }\StringTok{\textquotesingle{}s/,@/}\SpecialCharTok{\textbackslash{}t}\StringTok{/g; s/,$//g; s/@/}\SpecialCharTok{\textbackslash{}t}\StringTok{/g\textquotesingle{}}\NormalTok{ \textbackslash{}}
\NormalTok{    \textbackslash{}}
    \SpecialCharTok{\textgreater{}}\NormalTok{ results}\SpecialCharTok{/}\NormalTok{source\_target\_tree\_}\SpecialCharTok{$}\NormalTok{tlimit.tsv;}
     
\NormalTok{    echo }\StringTok{"All instances have written into \textless{}results/source\_target\_tree\_$tlimit.tsv\textgreater{}."}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{compound\_idenfication}\ErrorTok{)}

\NormalTok{echo }\StringTok{"Run compound\_idenfication."}















\NormalTok{echo }\StringTok{"compound\_idenfication "}

\NormalTok{exit}

\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{double\_ion\_network}\ErrorTok{)}

\NormalTok{echo }\StringTok{"Run double\_ion\_network."}

\NormalTok{echo }\StringTok{"Double\_ion\_network attempts to establish a link between features in different ionic modes based on retention times and molecular fingerprints. Please make sure that you have completed both ion modes using SIRIUS calculations and that you have completed steps such as fragment\_tree\_network above."}

\NormalTok{pos\_projectpath}\OtherTok{=}\DecValTok{0}

\NormalTok{    until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{pos\_projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{pos\_projectpath}\SpecialCharTok{/}\NormalTok{canopus\_summary.tsv ]}
\NormalTok{    do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the pos\_ion project. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ pos\_projectpath;}
\NormalTok{    done;}
    
\NormalTok{echo }\StringTok{"pos\_projectpath has successfully entered."}

\NormalTok{neg\_projectpath}\OtherTok{=}\DecValTok{0}

\NormalTok{    until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{neg\_projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{neg\_projectpath}\SpecialCharTok{/}\NormalTok{canopus\_summary.tsv ] }
\NormalTok{    do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the neg\_ion project. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ neg\_projectpath;}
\NormalTok{    done;}
    
\NormalTok{echo }\StringTok{"neg\_projectpath has successfully entered."}

\NormalTok{save\_path}\OtherTok{=}\DecValTok{0}
\NormalTok{    until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{save\_path ] }
\NormalTok{    do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the storage path. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ save\_path;}
\NormalTok{    done;}
    
\NormalTok{mkdir }\SpecialCharTok{$}\NormalTok{save\_path}\SpecialCharTok{/}\NormalTok{double\_ion\_network}

\NormalTok{cd }\SpecialCharTok{$}\NormalTok{save\_path}\SpecialCharTok{/}\NormalTok{double\_ion\_network;}
\NormalTok{mkdir temp}
\NormalTok{mkdir results}

\NormalTok{plimit}\OtherTok{=}\StringTok{"0"}
\NormalTok{    until [[ }\StringTok{"$plimit"} \SpecialCharTok{\textgreater{}} \StringTok{"0.5"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$plimit"} \SpecialCharTok{\textless{}} \StringTok{"0.99"}\NormalTok{ ]]}
\NormalTok{    do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the minimum posterior probability of the molecular fingerprint to be filtered. 0.9{-}0.99 is recommended. \textgreater{}\textgreater{}\textgreater{} "}
\NormalTok{    done;}
\NormalTok{flimit}\OtherTok{=}\StringTok{"0"}
\NormalTok{    until [[ }\StringTok{"$flimit"} \SpecialCharTok{\textgreater{}} \StringTok{"0"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$flimit"} \SpecialCharTok{\textless{}} \StringTok{"1000"}\NormalTok{ ]]}
\NormalTok{    do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the minimum identical fingerprints to be filtered. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ flimit;}
\NormalTok{    done;}
\NormalTok{dtime}\OtherTok{=}\StringTok{"0"}
\NormalTok{    until [[ }\StringTok{"$dtime"} \SpecialCharTok{\textgreater{}} \StringTok{"0.01"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$dtime"} \SpecialCharTok{\textless{}} \StringTok{"0.30"}\NormalTok{ ]]}
\NormalTok{    do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the rententiontime tolerance. 0.1{-}0.15 is recommended (C18). \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ dtime;}
\NormalTok{    done;}
\NormalTok{dmass}\OtherTok{=}\StringTok{"0"}
\NormalTok{    until [[ }\StringTok{"$dmass"} \SpecialCharTok{\textgreater{}} \StringTok{"0"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$dmass"} \SpecialCharTok{\textless{}} \StringTok{"100"}\NormalTok{ ]]}
\NormalTok{    do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the Max delta\_ionMass. 5{-}50 may work well. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ flimit;}
\NormalTok{    done;}
    
\NormalTok{pos\_source}\OtherTok{=}\ErrorTok{$}\NormalTok{(cat }\SpecialCharTok{$}\NormalTok{pos\_projectpath}\SpecialCharTok{/}\NormalTok{temp}\SpecialCharTok{/}\NormalTok{Mo\_filename)}

\NormalTok{a}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}END\{print NR\}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$pos\_source"}\NormalTok{))}

\NormalTok{neg\_target}\OtherTok{=}\ErrorTok{$}\NormalTok{(cat }\SpecialCharTok{$}\NormalTok{neg\_projectpath}\SpecialCharTok{/}\NormalTok{temp}\SpecialCharTok{/}\NormalTok{Mo\_filename)}

\NormalTok{b}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}END\{print NR\}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$neg\_source"}\NormalTok{))}

\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}\{if(NR\textgreater{}=2)\{print $2,$3\}\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{pos\_projectpath}\SpecialCharTok{/}\NormalTok{csi\_fingerid.tsv }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{pos\_fingerprint\_index;}

\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}\{if(NR\textgreater{}=2)\{print $2,$3\}\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{neg\_projectpath}\SpecialCharTok{/}\NormalTok{csi\_fingerid\_neg.tsv }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{neg\_fingerprint\_index;}

    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{doubleion\_net\_}\SpecialCharTok{$}\NormalTok{plimit\_}\SpecialCharTok{$}\NormalTok{flimit ]}
\NormalTok{    then rm temp}\SpecialCharTok{/}\NormalTok{doubleion\_net\_}\SpecialCharTok{$}\NormalTok{plimit\_}\SpecialCharTok{$}\NormalTok{flimit}
\NormalTok{    fi;}
    \ControlFlowTok{for}\NormalTok{ (( }\AttributeTok{i=}\DecValTok{1}\NormalTok{; i }\SpecialCharTok{\textless{}=}\NormalTok{ a; i}\SpecialCharTok{++}\NormalTok{))}
\NormalTok{    do}
\NormalTok{    sumname}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}\{if(NR==$i)\{print\}\}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$pos\_source"}\NormalTok{))}
\NormalTok{    moname}\OtherTok{=}\ErrorTok{$}\NormalTok{(echo }\StringTok{"$sumname"} \SpecialCharTok{|}\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}\{print $1\}\textquotesingle{}}\NormalTok{);}
\NormalTok{    filename}\OtherTok{=}\ErrorTok{$}\NormalTok{(echo }\StringTok{"$sumname"} \SpecialCharTok{|}\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}\{print $2\}\textquotesingle{}}\NormalTok{);}
\NormalTok{    x}\OtherTok{=}\ErrorTok{$}\NormalTok{(echo }\SpecialCharTok{$}\NormalTok{pos\_projectpath}\SpecialCharTok{/}\ErrorTok{$}\NormalTok{filename}\SpecialCharTok{/}\NormalTok{fingerprints}\SpecialCharTok{/}\ErrorTok{$}\NormalTok{moname}\SpecialCharTok{*}\NormalTok{ )}
        \ControlFlowTok{if}\NormalTok{ [[ x }\SpecialCharTok{!=} \StringTok{"$pos\_projectpath/$filename/fingerprints/$moname*"}\NormalTok{ ]]}
\NormalTok{        then}
\NormalTok{    id}\OtherTok{=}\ErrorTok{$}\NormalTok{(echo }\StringTok{"$filename"} \SpecialCharTok{|}\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F \_ }\StringTok{\textquotesingle{}\{print $NF\}\textquotesingle{}}\NormalTok{);}
\NormalTok{    source\_mass}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}/ionMass/\{if(NR==FNR)\{print $2\}\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{pos\_projectpath}\SpecialCharTok{/}\ErrorTok{$}\NormalTok{filename}\SpecialCharTok{/}\NormalTok{compound.info);}
\NormalTok{    source\_rt}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F [}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}}\SpecialCharTok{:}\NormalTok{] }\StringTok{\textquotesingle{}/\^{}rt/\{if(NR==FNR)\{print $2/60\}\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{pos\_projectpath}\SpecialCharTok{/}\ErrorTok{$}\NormalTok{filename}\SpecialCharTok{/}\NormalTok{compound.info)}
\NormalTok{    sourcefp}\OtherTok{=}\ErrorTok{$}\NormalTok{(paste temp}\SpecialCharTok{/}\NormalTok{pos\_fingerprint\_index }\SpecialCharTok{$}\NormalTok{pos\_projectpath}\SpecialCharTok{/}\ErrorTok{$}\NormalTok{filename}\SpecialCharTok{/}\NormalTok{fingerprints}\SpecialCharTok{/}\ErrorTok{$}\NormalTok{moname}\SpecialCharTok{*} \ErrorTok{|}\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v }\AttributeTok{OFS=}\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}$3\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}\{print $1\}\textquotesingle{}}\NormalTok{)}
    \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
    \CommentTok{\#(parallel jobs)}
\NormalTok{    parallel\_lists}\OtherTok{=}\ErrorTok{$}\NormalTok{(seq }\DecValTok{1} \SpecialCharTok{$}\NormalTok{b }\SpecialCharTok{|}\NormalTok{ paste }\SpecialCharTok{{-}}\NormalTok{d }\StringTok{" "} \SpecialCharTok{{-}} \SpecialCharTok{{-}} \SpecialCharTok{{-}} \SpecialCharTok{{-}} \SpecialCharTok{{-}} \SpecialCharTok{{-}}\NormalTok{)}
\NormalTok{    p}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}END\{print NR\}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$parallel\_lists"}\NormalTok{))}
        \ControlFlowTok{for}\NormalTok{ ((}\AttributeTok{e=}\DecValTok{1}\NormalTok{; e }\SpecialCharTok{\textless{}=}\NormalTok{ p; e}\SpecialCharTok{++}\NormalTok{))}
\NormalTok{        do}
\NormalTok{        f}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}\{if(NR==\textquotesingle{}}\SpecialCharTok{$}\NormalTok{e}\StringTok{\textquotesingle{})\{print\}\}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$parallel\_lists"}\NormalTok{))}
            \ControlFlowTok{for}\NormalTok{ i }\ControlFlowTok{in} \SpecialCharTok{$}\NormalTok{(echo }\StringTok{"$f"}\NormalTok{)}
\NormalTok{            do}
\NormalTok{            \{ t\_sumname}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}\{if(NR==$i)\{print\}\}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$neg\_source"}\NormalTok{))}
\NormalTok{            t\_filename}\OtherTok{=}\ErrorTok{$}\NormalTok{(echo }\StringTok{"$t\_sumname"} \SpecialCharTok{|}\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}\{print $2\}\textquotesingle{}}\NormalTok{);}
\NormalTok{            t\_moname}\OtherTok{=}\ErrorTok{$}\NormalTok{(echo }\StringTok{"$t\_sumname"} \SpecialCharTok{|}\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}\{print $1\}\textquotesingle{}}\NormalTok{);}
\NormalTok{            y}\OtherTok{=}\ErrorTok{$}\NormalTok{(echo }\SpecialCharTok{$}\NormalTok{neg\_projectpath}\SpecialCharTok{/}\ErrorTok{$}\NormalTok{t\_filename}\SpecialCharTok{/}\NormalTok{fingerprints}\SpecialCharTok{/}\ErrorTok{$}\NormalTok{t\_moname}\SpecialCharTok{*}\NormalTok{)}
                \ControlFlowTok{if}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{y }\SpecialCharTok{!=} \StringTok{"$neg\_projectpath/$t\_filename/fingerprints/$t\_moname*"}\NormalTok{ ]]}
\NormalTok{                then}
\NormalTok{                target\_mass}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}/ionMass/\{if(NR==FNR)\{print $2\}\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{neg\_projectpath}\SpecialCharTok{/}\ErrorTok{$}\NormalTok{t\_filename}\SpecialCharTok{/}\NormalTok{compound.info);}
\NormalTok{                target\_rt}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F [}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}}\SpecialCharTok{:}\NormalTok{] }\StringTok{\textquotesingle{}/\^{}rt/\{if(NR==FNR)\{print $2/60\}\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{neg\_projectpath}\SpecialCharTok{/}\ErrorTok{$}\NormalTok{t\_filename}\SpecialCharTok{/}\NormalTok{compound.info);}
\NormalTok{                deltart}\OtherTok{=}\ErrorTok{$}\NormalTok{(echo }\SpecialCharTok{|}\NormalTok{ awk }\StringTok{\textquotesingle{}\{print "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{source\_rt}\StringTok{\textquotesingle{}"{-}"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{target\_rt}\StringTok{\textquotesingle{}"\}\textquotesingle{}}\NormalTok{)}
\NormalTok{                deltamass}\OtherTok{=}\ErrorTok{$}\NormalTok{(echo }\SpecialCharTok{|}\NormalTok{ awk }\StringTok{\textquotesingle{}\{print "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{source\_mass}\StringTok{\textquotesingle{}"{-}"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{target\_mass}\StringTok{\textquotesingle{}"\}\textquotesingle{}}\NormalTok{)}
                    \ControlFlowTok{if}\NormalTok{ [[ }\StringTok{"$deltart"} \SpecialCharTok{\textless{}} \StringTok{"$dtime"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$deltart"} \SpecialCharTok{\textgreater{}} \StringTok{"0"}\NormalTok{ ]] }\SpecialCharTok{||}\NormalTok{ [[ }\StringTok{"$deltart"} \SpecialCharTok{\textgreater{}} \StringTok{"{-}$dtime"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$deltart"} \SpecialCharTok{\textless{}} \StringTok{"0"}\NormalTok{ ]]}
\NormalTok{                    then}
                        \ControlFlowTok{if}\NormalTok{ [[ }\StringTok{"$deltamass"} \SpecialCharTok{\textless{}} \StringTok{"dmass"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$deltamass"} \SpecialCharTok{\textgreater{}} \StringTok{"0"}\NormalTok{ ]] }\SpecialCharTok{||}\NormalTok{ [[ }\StringTok{"$deltamass"} \SpecialCharTok{\textgreater{}} \StringTok{"{-}$dmass"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$deltamass"} \SpecialCharTok{\textless{}} \StringTok{"0"}\NormalTok{ ]]}
\NormalTok{                        then}
\NormalTok{                        targetfp}\OtherTok{=}\ErrorTok{$}\NormalTok{(paste temp}\SpecialCharTok{/}\NormalTok{neg\_fingerprint\_index }\SpecialCharTok{$}\NormalTok{neg\_projectpath}\SpecialCharTok{/}\ErrorTok{$}\NormalTok{t\_filename}\SpecialCharTok{/}\NormalTok{fingerprints}\SpecialCharTok{/}\ErrorTok{$}\NormalTok{t\_moname}\SpecialCharTok{*} \ErrorTok{|}\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v }\AttributeTok{OFS=}\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}$3\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}\{print $1\}\textquotesingle{}}\NormalTok{)}
\NormalTok{                        assemble}\OtherTok{=}\ErrorTok{$}\NormalTok{(sort }\SpecialCharTok{\textless{}}\NormalTok{(sort }\SpecialCharTok{{-}}\NormalTok{m }\SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$sourcefp"}\NormalTok{) }\SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$targetfp"}\NormalTok{)) }\SpecialCharTok{|}\NormalTok{ uniq }\SpecialCharTok{{-}}\NormalTok{d)}
\NormalTok{                        fpnum}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}END\{print NR\}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$assemble"}\NormalTok{))}
                            \ControlFlowTok{if}\NormalTok{ [[ }\StringTok{"$fpnum"} \SpecialCharTok{\textgreater{}} \StringTok{"$flimit"}\NormalTok{ ]]}
\NormalTok{                            then}
\NormalTok{                            t\_id}\OtherTok{=}\ErrorTok{$}\NormalTok{(echo }\StringTok{"$t\_filename"} \SpecialCharTok{|}\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F \_ }\StringTok{\textquotesingle{}\{print $NF\}\textquotesingle{}}\NormalTok{);}
\NormalTok{                            identicalfp}\OtherTok{=}\ErrorTok{$}\NormalTok{(paste }\SpecialCharTok{{-}}\NormalTok{s }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$assemble"}\NormalTok{) }\SpecialCharTok{|}\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v }\AttributeTok{OFS=}\NormalTok{, }\StringTok{\textquotesingle{}\{print $0\}\textquotesingle{}}\NormalTok{) }
\NormalTok{                            awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}\{print $0,"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{t\_id}\StringTok{\textquotesingle{}","null","\textquotesingle{}}\SpecialCharTok{$}\NormalTok{deltamass}\StringTok{\textquotesingle{}","null","null","\textquotesingle{}}\SpecialCharTok{$}\NormalTok{identicalfp}\StringTok{\textquotesingle{}"\}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$id"}\NormalTok{) }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{single\_doubleion\_net\_}\SpecialCharTok{$}\NormalTok{\{id\}\_}\SpecialCharTok{$}\NormalTok{\{t\_id\}\_}\SpecialCharTok{$}\NormalTok{plimit\_}\SpecialCharTok{$}\NormalTok{flimit;}
\NormalTok{                            fi;}
\NormalTok{                        fi;}
\NormalTok{                    fi;}
\NormalTok{                fi;}
\NormalTok{            \}}\SpecialCharTok{\&}
\NormalTok{            done;}
\NormalTok{            wait;}
\NormalTok{        done;}
\NormalTok{        fi;}
\NormalTok{    echo }\StringTok{"Parallel jobs have finished $i($a)."}
\NormalTok{    done;}
\NormalTok{cat temp}\SpecialCharTok{/}\NormalTok{single\_doubleion\_net\_}\SpecialCharTok{*}\NormalTok{\_}\SpecialCharTok{$}\NormalTok{plimit\_}\SpecialCharTok{$}\NormalTok{flimit }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{doubleion\_net\_}\SpecialCharTok{$}\NormalTok{plimit\_}\SpecialCharTok{$}\NormalTok{flimit}
\NormalTok{cat }\SpecialCharTok{\textless{}}\NormalTok{(echo source}\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}}\NormalTok{target}\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}}\NormalTok{tfalign}\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}}\NormalTok{delta\_mass}\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}}\NormalTok{fp\_source\_uniq}\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}}\NormalTok{fp\_target\_uniq}\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}}\NormalTok{identicalfp) temp}\SpecialCharTok{/}\NormalTok{doubleion\_net\_}\SpecialCharTok{$}\NormalTok{plimit\_}\SpecialCharTok{$}\NormalTok{flimit }\SpecialCharTok{\textgreater{}}\NormalTok{ results}\SpecialCharTok{/}\NormalTok{doubleion\_net\_}\SpecialCharTok{$}\NormalTok{plimit\_}\SpecialCharTok{$}\NormalTok{flimit.tsv;}

\NormalTok{echo }\StringTok{"All instances have written into \textless{}results/doubleion\_net\_$plimit\_$flimit.tsv\textgreater{}."}

\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{exit}\ErrorTok{)}
\NormalTok{echo }\StringTok{"The mystery of creation is like the darkness of night{-}{-}it is great.}
\StringTok{Delusions of knowledge are like the fog of the morning."}
\NormalTok{exit;}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{*}\ErrorTok{)}
\NormalTok{echo }\StringTok{"error"}
\NormalTok{exit;}
\NormalTok{;;}
\NormalTok{esac;}
\NormalTok{done;}\CommentTok{\#(for)}
\NormalTok{done;}\CommentTok{\#(select)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-mdmn1010.sh}{%
\section{File: mdmn1010.sh}\label{file-mdmn1010.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{echo }\StringTok{"We are all in the gutter, }
\StringTok{but some of us are looking at the stars."}\NormalTok{;}

\NormalTok{PS3}\OtherTok{=}\StringTok{\textquotesingle{}Please select the workflow to be executed. \textgreater{}\textgreater{}\textgreater{} \textquotesingle{}}

\NormalTok{select command }\ControlFlowTok{in}\NormalTok{ \textbackslash{}}
\NormalTok{    \textbackslash{}}
    \StringTok{"default"}\NormalTok{ \textbackslash{}}
\NormalTok{    \textbackslash{}}
    \StringTok{"structure\_extract"}\NormalTok{ \textbackslash{}}
\NormalTok{    \textbackslash{}}
    \StringTok{"classification\_extract\_sum"}\NormalTok{ \textbackslash{}}
\NormalTok{    \textbackslash{}}
    \StringTok{"classification\_extract\_filter"}\NormalTok{ \textbackslash{}}
\NormalTok{    \textbackslash{}}
    \StringTok{"fragment\_tree\_network"}\NormalTok{ \textbackslash{}}
\NormalTok{    \textbackslash{}}
    \StringTok{"fragment\_tree\_network\_delta"}\NormalTok{ \textbackslash{}}
\NormalTok{    \textbackslash{}}
    \StringTok{"compound\_idenfication"}\NormalTok{ \textbackslash{}}
\NormalTok{    \textbackslash{}}
    \StringTok{"double\_ion\_network"}\NormalTok{ \textbackslash{}}
\NormalTok{    \textbackslash{}}
    \StringTok{"exit"} 
\NormalTok{do}
    
    \ControlFlowTok{if}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{command }\SpecialCharTok{==} \StringTok{"default"}\NormalTok{ ]]}
\NormalTok{    then}
    
\NormalTok{    confirm}\OtherTok{=}\DecValTok{0}
    
\NormalTok{        until [[ }\SpecialCharTok{$}\NormalTok{confirm }\SpecialCharTok{==} \StringTok{"yes"}\NormalTok{ ]] }\SpecialCharTok{||}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{confirm }\SpecialCharTok{==} \StringTok{"no"}\NormalTok{ ]]}
\NormalTok{        do}
\NormalTok{        read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Running all proccesses sequentially? [yes/no] \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ confirm}
\NormalTok{        done;}
        \ControlFlowTok{if}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{confirm }\SpecialCharTok{==} \StringTok{"no"}\NormalTok{ ]]}
\NormalTok{        then exit}
\NormalTok{        fi;}
        
\NormalTok{    default}\OtherTok{=}\StringTok{"structure\_extract classification\_extract\_sum classification\_extract\_filter fragment\_tree\_network fragment\_tree\_network\_delta"}
    
\NormalTok{    list}\OtherTok{=}\ErrorTok{$}\NormalTok{(echo }\SpecialCharTok{$}\NormalTok{default);}
    
    \ControlFlowTok{else}\NormalTok{ list}\OtherTok{=}\ErrorTok{$}\NormalTok{( echo }\SpecialCharTok{$}\NormalTok{command)}
\NormalTok{    fi;}
    
    \ControlFlowTok{for}\NormalTok{ option }\ControlFlowTok{in} \SpecialCharTok{$}\NormalTok{(echo }\SpecialCharTok{$}\NormalTok{list)}
\NormalTok{    do}
\NormalTok{        case }\SpecialCharTok{$}\NormalTok{option }\ControlFlowTok{in}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{structure\_extract}\ErrorTok{)}
\NormalTok{echo }\StringTok{"Run structure\_extract."}
\NormalTok{projectpath}\OtherTok{=}\DecValTok{0}
\NormalTok{    until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{canopus\_summary.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{    do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{    done;}
    
\NormalTok{cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{mkdir results;}
\NormalTok{mkdir temp;}
\NormalTok{mkdir temp}\SpecialCharTok{/}\NormalTok{fintemp;}

    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{Mo\_filename ]}
\NormalTok{    then rm temp}\SpecialCharTok{/}\NormalTok{Mo\_filename}
\NormalTok{    fi;}

\NormalTok{data}\OtherTok{=}\StringTok{"*\_*/fingerid/*.tsv"}

\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    BEGIN\{}
\StringTok{        all\_id=0}
\StringTok{        \textbackslash{}}
\StringTok{        max\_id={-}1}
\StringTok{        \textbackslash{}}
\StringTok{        p\_id="null"}
\StringTok{        \textbackslash{}}
\StringTok{        printf "Info: loading the data..."}
\StringTok{        \}}
\StringTok{    \{}
\StringTok{    if(FNR==1)}
\StringTok{        \{}
\StringTok{        if(NR\textgreater{}FNR)}
\StringTok{            \{}
\StringTok{            close(pfile)}
\StringTok{            \}}
\StringTok{        f=split(FILENAME,a,"[/]");}
\StringTok{    }
\StringTok{        n=split(a[1],b,"[\_]");}
\StringTok{    }
\StringTok{        id=b[n];}
\StringTok{    }
\StringTok{        if(id!=p\_id)}
\StringTok{            \{}
\StringTok{            all\_id+=1}
\StringTok{            \textbackslash{}}
\StringTok{            if(id\textgreater{}max\_id)}
\StringTok{                \{}
\StringTok{                max\_id=id}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        file[id]=a[1]}
\StringTok{        }
\StringTok{        split(a[f], g, "[.]")}
\StringTok{        }
\StringTok{        formu\_type[id]=g[1]}
\StringTok{        }
\StringTok{        if(all\_id==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if(($i\textasciitilde{}/inchikey2D/))}
\StringTok{                    \{}
\StringTok{                    col\_2D=i}
\StringTok{                    \}}
\StringTok{                if($i=="inchi")}
\StringTok{                    \{}
\StringTok{                    col\_inchi=i}
\StringTok{                    \}}
\StringTok{                if(($i\textasciitilde{}/Formula/))}
\StringTok{                    \{}
\StringTok{                    col\_formu=i}
\StringTok{                    \}}
\StringTok{                if($i=="score")}
\StringTok{                    \{}
\StringTok{                    col\_score=i}
\StringTok{                    \}}
\StringTok{                if($i=="name")}
\StringTok{                    \{}
\StringTok{                    col\_name=i}
\StringTok{                    \}}
\StringTok{                if($i=="smiles")}
\StringTok{                    \{}
\StringTok{                    col\_smiles=i}
\StringTok{                    \}}
\StringTok{                if($i=="xlogp")}
\StringTok{                    \{}
\StringTok{                    col\_x=i}
\StringTok{                    \}}
\StringTok{                if(($i\textasciitilde{}/imilarity/))}
\StringTok{                    \{}
\StringTok{                    col\_simi=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/links/)}
\StringTok{                    \{}
\StringTok{                    col\_links=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        pfile=FILENAME}
\StringTok{        }
\StringTok{        printf g[1]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"formu\_type[id]"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{        }
\StringTok{        printf "Info: the data of " id " (ID) has input. The filename is " FILENAME ".}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{        \}}
\StringTok{    if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        row\_score=$col\_score}
\StringTok{        }
\StringTok{        row\_simi=$col\_simi}
\StringTok{        }
\StringTok{        if(max["score",id]=="" || max["score",id]\textless{}row\_score)}
\StringTok{            \{}
\StringTok{            max["score",id]=row\_score}
\StringTok{            }
\StringTok{            name["score",id]=$col\_name}
\StringTok{        }
\StringTok{            formula["score",id]=$col\_formu}
\StringTok{            }
\StringTok{            simi["score",id]=$col\_simi}
\StringTok{        }
\StringTok{            smiles["score",id]=$col\_smiles}
\StringTok{        }
\StringTok{            inchi["score",id]=$col\_inchi}
\StringTok{        }
\StringTok{            in2D["score",id]=$col\_2D}
\StringTok{            }
\StringTok{            score["score",id]=$col\_score}
\StringTok{        }
\StringTok{            xlogp["score",id]=$col\_x}
\StringTok{            }
\StringTok{            links["score",id]=$col\_links}
\StringTok{            \}}
\StringTok{        if(max["simi",id]=="" || max["simi",id]\textless{}row\_simi)}
\StringTok{            \{}
\StringTok{            max["simi",id]=row\_simi}
\StringTok{            }
\StringTok{            name["simi",id]=$col\_name}
\StringTok{        }
\StringTok{            formula["simi",id]=$col\_formu}
\StringTok{            }
\StringTok{            simi["simi",id]=$col\_simi}
\StringTok{        }
\StringTok{            smiles["simi",id]=$col\_smiles}
\StringTok{        }
\StringTok{            inchi["simi",id]=$col\_inchi}

\StringTok{            in2D["simi",id]=$col\_2D}
\StringTok{            }
\StringTok{            score["simi",id]=$col\_score}
\StringTok{         }
\StringTok{            xlogp["simi",id]=$col\_x}
\StringTok{            }
\StringTok{            links["simi",id]=$col\_links}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "formula}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "smiles}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchi}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchikey2D}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        "score}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "xlogp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "links}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/fingerid\_sum.tsv"}
\StringTok{        \textbackslash{}}
\StringTok{        printf "" \textgreater{} "temp/Mo\_filename"}
\StringTok{        }
\StringTok{        for(l in file)}
\StringTok{            \{}
\StringTok{            if(max["score",l]!="")}
\StringTok{                \{}
\StringTok{                printf l"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                name["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  formula["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  simi["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                smiles["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  inchi["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  in2D["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                score["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  xlogp["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  links["score",l]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/fingerid\_sum.tsv"}
\StringTok{                }
\StringTok{                printf formula["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  file[l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  formu\_type[l]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "temp/Mo\_filename"}
\StringTok{                \}}
\StringTok{            if(max["simi",l]!="" \&\& max["simi",l]!=max["score",l])}
\StringTok{                \{}
\StringTok{                printf l"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                name["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  formula["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  simi["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                smiles["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  inchi["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  in2D["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                score["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  xlogp["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  links["simi",l]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/fingerid\_sum.tsv"}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}

\NormalTok{data\_sum}\OtherTok{=}\StringTok{"results/fingerid\_sum.tsv"}

\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==1)}
\StringTok{        \{}
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if($i\textasciitilde{}/id/)}
\StringTok{                \{}
\StringTok{                col\_id=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/score/)}
\StringTok{                \{}
\StringTok{                col\_score=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        id=$col\_id}
\StringTok{        \textbackslash{}}
\StringTok{        if(max\_id\textless{}id || max\_id=="")}
\StringTok{            \{}
\StringTok{            max\_id=id}
\StringTok{            \}}
\StringTok{        if(score[id]\textless{}$col\_score || score[id]=="")}
\StringTok{            \{}
\StringTok{            score[id]=$col\_score}
\StringTok{            \textbackslash{}}
\StringTok{            data[id]=$0}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "formula}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "smiles}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchi}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchikey2D}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        "score}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "xlogp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "links}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/fingerid\_first\_score.tsv"}
\StringTok{        \textbackslash{}}
\StringTok{        for(i=1; i\textless{}=max\_id; i++)}
\StringTok{            \{}
\StringTok{            if(data[i]!="")}
\StringTok{                \{}
\StringTok{                printf data[i] "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/fingerid\_first\_score.tsv"}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data\_sum}

\NormalTok{echo }\StringTok{"structure\_extract results have been successfully assembled into \textless{}results/fingerid\_sum.tsv\textgreater{} and \textless{}results/fingerid\_first\_score.tsv\textgreater{}"}\NormalTok{;}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{classification\_extract\_sum}\ErrorTok{)}

\NormalTok{echo }\StringTok{"Run classification\_extract\_sum."}\NormalTok{;}
    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{Mo\_filename ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f canopus.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f canopus\_neg.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f .format ]}
\NormalTok{    then}
\NormalTok{    echo }\StringTok{"Project path acknowledged."}
    \ControlFlowTok{else}
\NormalTok{        until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{canopus.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{        do}
\NormalTok{        read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{        done;}
\NormalTok{        cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{    fi;}
    
\NormalTok{data1}\OtherTok{=}\StringTok{"temp/Mo\_filename"}

\NormalTok{data2}\OtherTok{=}\StringTok{"canopus.tsv"}

\NormalTok{data3}\OtherTok{=}\StringTok{"canopus\_neg.tsv"}

\NormalTok{datas}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(getline \textless{} $2"/canopus/"$3".fpt"=={-}1)}
\StringTok{        \{}
\StringTok{        printf ""}
\StringTok{        \}}
\StringTok{    else}
\StringTok{        \{}
\StringTok{        printf $2"/canopus/"$3".fpt "}
\StringTok{        \}}
\StringTok{    close($2"/canopus/"$3".fpt")}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1)}
    
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        file[FNR]=$2}
\StringTok{        }
\StringTok{        mo[$2]=$1}
\StringTok{        }
\StringTok{        i=split($2,s,"[\_]")}
\StringTok{        }
\StringTok{        the\_id[FNR]=s[i]}
\StringTok{        }
\StringTok{        n=FNR}
\StringTok{        \}}
\StringTok{    if((FILENAME \textasciitilde{} /\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data2}\StringTok{\textquotesingle{}/))}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            close("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data1}\StringTok{\textquotesingle{}")}
\StringTok{            }
\StringTok{            printf "Info: data\_file name of \textquotesingle{}}\SpecialCharTok{$}\NormalTok{data1}\StringTok{\textquotesingle{} has been input.}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{            }
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if(($i \textasciitilde{} /name/))}
\StringTok{                    \{}
\StringTok{                    col\_class=i}
\StringTok{                    \}}
\StringTok{                if(($i \textasciitilde{} /absolute/))}
\StringTok{                    \{}
\StringTok{                    col\_abindex=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            abindex[1,FNR]=$col\_abindex}
\StringTok{            }
\StringTok{            class[1,$col\_abindex]=$col\_class}
\StringTok{            }
\StringTok{            rows\_data2=FNR}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if((FILENAME \textasciitilde{} /\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data3}\StringTok{\textquotesingle{}/))}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            close("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data2}\StringTok{\textquotesingle{}")}
\StringTok{            }
\StringTok{            printf "Info: data\_file name of \textquotesingle{}}\SpecialCharTok{$}\NormalTok{data2}\StringTok{\textquotesingle{} has been input.}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{            }
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if(($i \textasciitilde{} /name/))}
\StringTok{                    \{}
\StringTok{                    col\_class=i}
\StringTok{                    \}}
\StringTok{                if(($i \textasciitilde{} /absolute/))}
\StringTok{                    \{}
\StringTok{                    col\_abindex=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            abindex[2,FNR]=$col\_abindex}
\StringTok{            }
\StringTok{            class[2,$col\_abindex]=$col\_class}
\StringTok{            }
\StringTok{            rows\_data3=FNR}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if((FILENAME \textasciitilde{} /fpt/))}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            if(p\_filename=="")}
\StringTok{                \{}
\StringTok{                close("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data3}\StringTok{\textquotesingle{}")}
\StringTok{                \}}
\StringTok{            else if(FILENAME!=p\_filename)}
\StringTok{                \{}
\StringTok{                close(p\_filename)}
\StringTok{                }
\StringTok{                printf "Info: data\_file name of " p\_filename " has been input.}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{                \}}
\StringTok{            p\_filename=FILENAME}
\StringTok{            \textbackslash{}}
\StringTok{            for(i=1; i\textless{}=n; i++)}
\StringTok{                \{}
\StringTok{                if((FILENAME \textasciitilde{} file[i]) \&\& (FILENAME \textasciitilde{} mo[file[i]]))}
\StringTok{                    \{}
\StringTok{                    break}
\StringTok{                    \}}
\StringTok{                else}
\StringTok{                    \{}
\StringTok{                    x=i+1}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            if(x==n+1)}
\StringTok{                \{}
\StringTok{                nextfile}
\StringTok{                \}}
\StringTok{            split(FILENAME,a,"[/]");}

\StringTok{            m=split(a[1],b,"[\_]");}

\StringTok{            id=b[m];}

\StringTok{            if((FILENAME \textasciitilde{} /\textbackslash{}+.fpt/))}
\StringTok{                \{}
\StringTok{                ion=1}
\StringTok{                \}}
\StringTok{            else}
\StringTok{                \{}
\StringTok{                ion=2}
\StringTok{                \}}
\StringTok{            pp[id,abindex[ion,2]]=$1}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            pp[id,abindex[ion,FNR+1]]=$1}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        if(abindex[1,rows\_data2] \textgreater{} abindex[2,rows\_data3])}
\StringTok{            \{}
\StringTok{            maxindex=abindex[1,rows\_data2]}
\StringTok{            \}}
\StringTok{        else}
\StringTok{            \{}
\StringTok{            maxindex=abindex[2,rows\_data3]}
\StringTok{            \}}
\StringTok{        printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{} "results/canopus\_pp.tsv"}
\StringTok{        \textbackslash{}}
\StringTok{        for(i=0; i\textless{}=maxindex; i++)}
\StringTok{            \{}
\StringTok{            if(class[1,i]!="" \&\& i!=maxindex)}
\StringTok{                \{}
\StringTok{                printf class[1,i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{                \}}
\StringTok{            else if(class[2,i]!="" \&\& i!=maxindex)}
\StringTok{                \{}
\StringTok{                printf class[2,i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{                \}}
\StringTok{            else if(i==maxindex \&\& class[1,i]!="")}
\StringTok{                \{}
\StringTok{                printf class[1,i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{                \}}
\StringTok{            else if(i==maxindex \&\& class[2,i]!="")}
\StringTok{                \{}
\StringTok{                printf class[2,i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        for(i=1; i\textless{}=n; i++)}
\StringTok{            \{}
\StringTok{            printf the\_id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{            }
\StringTok{            for(j=0; j\textless{}=maxindex; j++)}
\StringTok{                \{}
\StringTok{                if(class[1,j]!="" \&\& j!=maxindex || class[2,j]!="" \&\& j!=maxindex)}
\StringTok{                    \{}
\StringTok{                    if(pp[the\_id[i],j]=="")}
\StringTok{                        \{}
\StringTok{                        printf 0"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{                        \}}
\StringTok{                    else}
\StringTok{                        \{}
\StringTok{                        printf pp[the\_id[i],j]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                else if(class[1,j]!="" \&\& j==maxindex || class[2,j]!="" \&\& j==maxindex)}
\StringTok{                    \{}
\StringTok{                    if(pp[the\_id[i],j]=="")}
\StringTok{                        \{}
\StringTok{                        printf 0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{                        \}}
\StringTok{                    else}
\StringTok{                        \{}
\StringTok{                        printf pp[the\_id[i],j]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3 }\SpecialCharTok{$}\NormalTok{datas}

\NormalTok{echo }\StringTok{"classification\_extract\_sum have been successfully written into \textless{}results/canopus\_pp.tsv\textgreater{}"}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}

\NormalTok{classification\_extract\_filter}\ErrorTok{)}
\NormalTok{echo }\StringTok{"Run classification\_extract\_filter."}\NormalTok{;}
    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f results}\SpecialCharTok{/}\NormalTok{canopus\_pp.tsv ]}
\NormalTok{    then}
\NormalTok{    echo }\StringTok{"Project path acknowledged."}
    \ControlFlowTok{else}
\NormalTok{        until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{results}\SpecialCharTok{/}\NormalTok{canopus\_pp.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{results}\SpecialCharTok{/}\NormalTok{canopus\_summary.tsv ]}
\NormalTok{        do}
\NormalTok{        read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{        done;}
\NormalTok{        cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{    fi; }
    
\NormalTok{check}\OtherTok{=}\DecValTok{0}
\NormalTok{    until [[ }\StringTok{"$check"} \SpecialCharTok{==} \StringTok{"yes"}\NormalTok{ ]] }\SpecialCharTok{||}\NormalTok{ [[ }\StringTok{"$check"} \SpecialCharTok{==} \StringTok{"no"}\NormalTok{ ]]}
\NormalTok{    do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Collate the posterior probabilities of the classification of each feature? [yes/no] \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ check;}
\NormalTok{    done;}
    
    \ControlFlowTok{if}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{check }\SpecialCharTok{==} \StringTok{"yes"}\NormalTok{ ]]}
\NormalTok{    then}
\NormalTok{    definition\_limit}\OtherTok{=}\DecValTok{0}
    
\NormalTok{        until [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textgreater{}} \StringTok{"0.01"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textless{}} \StringTok{"1"}\NormalTok{ ]]}
\NormalTok{        do}
\NormalTok{        read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the posterior probabilities limition. 0.5\textasciitilde{}0.99 may work well. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ definition\_limit;}
\NormalTok{        done;}
    
\NormalTok{    data1}\OtherTok{=}\StringTok{"canopus\_summary.tsv"}
 
\NormalTok{    data2}\OtherTok{=}\StringTok{"canopus.tsv"}
 
\NormalTok{    data3}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
    
\NormalTok{    awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{        \{}
\StringTok{        if(NR==FNR)}
\StringTok{            \{}
\StringTok{            if(FNR==1)}
\StringTok{                \{}
\StringTok{                p\_file=FILENAME}
\StringTok{                \textbackslash{}}
\StringTok{                for(i=1; i\textless{}=NF; i++)}
\StringTok{                    \{}
\StringTok{                    if($i\textasciitilde{}/name/)}
\StringTok{                        \{}
\StringTok{                        col\_id=i}
\StringTok{                        \}}
\StringTok{                    if($i\textasciitilde{}/specific/)}
\StringTok{                        \{}
\StringTok{                        col\_specific=i}
\StringTok{                        \}}
\StringTok{                    if($i\textasciitilde{}/level/)}
\StringTok{                        \{}
\StringTok{                        col\_level=i}
\StringTok{                        \}}
\StringTok{                    if($i\textasciitilde{}/subclass/)}
\StringTok{                        \{}
\StringTok{                        col\_subclass=i}
\StringTok{                        \}}
\StringTok{                    if($i\textasciitilde{}/\^{}class/)}
\StringTok{                        \{}
\StringTok{                        col\_class=i}
\StringTok{                        \}}
\StringTok{                    if($i\textasciitilde{}/superclass/)}
\StringTok{                        \{}
\StringTok{                        col\_superclass=i}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            if(FNR\textgreater{}=2)}
\StringTok{                \{}
\StringTok{                n=split($col\_id,a,"[\_]")}
\StringTok{                \textbackslash{}}
\StringTok{                id=a[n]}
\StringTok{                \textbackslash{}}
\StringTok{                specific[id]=$col\_specific}
\StringTok{                \textbackslash{}}
\StringTok{                level[id]=$col\_level}
\StringTok{                \textbackslash{}}
\StringTok{                subclass[id]=$col\_subclass}
\StringTok{                \textbackslash{}}
\StringTok{                class[id]=$col\_class}
\StringTok{                \textbackslash{}}
\StringTok{                superclass[id]=$col\_superclass}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FILENAME\textasciitilde{}/canopus.tsv/)}
\StringTok{            \{}
\StringTok{            if(FNR==1)}
\StringTok{                \{}
\StringTok{                close(p\_file)}
\StringTok{                \textbackslash{}}
\StringTok{                p\_file=FILENAME}
\StringTok{                \textbackslash{}}
\StringTok{                for(i=1; i\textless{}=NF; i++)}
\StringTok{                    \{}
\StringTok{                    if($i\textasciitilde{}/name/)}
\StringTok{                        \{}
\StringTok{                        col\_name=i}
\StringTok{                        \}}
\StringTok{                    if($i\textasciitilde{}/description/)}
\StringTok{                        \{}
\StringTok{                        col\_description=i}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            if(FNR\textgreater{}=2)}
\StringTok{                \{}
\StringTok{                description[$col\_name]=$col\_description}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FILENAME\textasciitilde{}"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data3}\StringTok{\textquotesingle{}")}
\StringTok{            \{}
\StringTok{            if(FNR==1)}
\StringTok{                \{}
\StringTok{                close(p\_file)}
\StringTok{                \textbackslash{}}
\StringTok{                for(i=1; i\textless{}=NF; i++)}
\StringTok{                    \{}
\StringTok{                    if($i\textasciitilde{}/\^{}id$/)}
\StringTok{                        \{}
\StringTok{                        col\_id=i}
\StringTok{                        \}}
\StringTok{                    if(i\textgreater{}=2)}
\StringTok{                        \{}
\StringTok{                        col\_class\_name[i]=$i}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition\_source}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition\_description}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                "specific}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "specific\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "level\_5}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "level\_5\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                "subclass}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "subclass\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "class}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "class\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "superclass}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "superclass\_pp}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                \textgreater{} "results/stat\_classification.tsv"}
\StringTok{                \}}
\StringTok{            if(FNR\textgreater{}=2)}
\StringTok{                \{}
\StringTok{                for(i=2; i\textless{}=NF; i++)}
\StringTok{                    \{}
\StringTok{                    c\_pp[col\_class\_name[i]]=sprintf("\%.4f",$i)}
\StringTok{                    \}}
\StringTok{                if(level[$col\_id] != "" \&\& c\_pp[level[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{                    \{}
\StringTok{                    definition\_source="level\_5"}
\StringTok{                    \textbackslash{}}
\StringTok{                    definition=level[$col\_id]}
\StringTok{                    \}}
\StringTok{                else if(subclass[$col\_id] != "" \&\& c\_pp[subclass[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{                    \{}
\StringTok{                    definition\_source="subclass"}
\StringTok{                    \textbackslash{}}
\StringTok{                    definition=subclass[$col\_id]}
\StringTok{                    \}}
\StringTok{                else if(class[$col\_id] != "" \&\& c\_pp[class[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{                    \{}
\StringTok{                    definition\_source="class"}
\StringTok{                    \textbackslash{}}
\StringTok{                    definition=class[$col\_id]}
\StringTok{                    \}}
\StringTok{                else if(superclass[$col\_id] != "" \&\& c\_pp[superclass[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{                    \{}
\StringTok{                    definition\_source="superclass"}
\StringTok{                    \textbackslash{}}
\StringTok{                    definition=superclass[$col\_id]}
\StringTok{                    \}}
\StringTok{                else}
\StringTok{                    \{}
\StringTok{                    definition\_source="null"}
\StringTok{                    \textbackslash{}}
\StringTok{                    definition="null"}
\StringTok{                    \textbackslash{}}
\StringTok{                    c\_pp[definition]="null"}
\StringTok{                    \textbackslash{}}
\StringTok{                    description[definition]="null"}
\StringTok{                    \}}
\StringTok{                printf $col\_id"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  definition\_source"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  definition"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[definition]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  description[definition]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                specific[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[specific[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  level[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[level[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                subclass[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[subclass[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  class[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[class[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                superclass[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[superclass[$col\_id]]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/stat\_classification.tsv"}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
    
\NormalTok{    echo }\StringTok{"classification\_extract\_filter have been successfully written into \textless{}results/stat\_classification.tsv\textgreater{}"}
    
\NormalTok{    fi;}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{fragment\_tree\_network}\ErrorTok{)}

\NormalTok{echo }\StringTok{"Run fragment\_tree\_network."}\NormalTok{;}

    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{d temp ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f .format ]}
\NormalTok{    then}
\NormalTok{    echo }\StringTok{"Project path acknowledged."}
    
    \ControlFlowTok{else}
\NormalTok{        until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{        do}
\NormalTok{        read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project. Make sure you have moved the fragment tree alignment results to the directory where the project is located. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{        done;}
\NormalTok{        cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{    fi;}

\NormalTok{echo }\StringTok{"Please enter the minimum alignment similarity that you want to filter."}

\NormalTok{tlimit}\OtherTok{=}\DecValTok{0}
\NormalTok{    until [[ }\StringTok{"$tlimit"} \SpecialCharTok{\textgreater{}} \StringTok{"0.01"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$tlimit"} \SpecialCharTok{\textless{}} \StringTok{"0.99"}\NormalTok{ ]]}
\NormalTok{    do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"0.4{-}0.7 is recommended \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ tlimit;}
\NormalTok{    done;}

    \ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{d temp}\SpecialCharTok{/}\NormalTok{ftaligntemp ]}
\NormalTok{    then }
\NormalTok{    mkdir temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}
\NormalTok{    fi;}
    
\NormalTok{data}\OtherTok{=}\StringTok{"ftalign.tsv"}

\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/ftaligntemp/tmp"}

\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    print NR,FNR}
\StringTok{    }
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if(NR==1 \&\& i!=1 || NR!=1 \&\& i==1)}
\StringTok{                \{}
\StringTok{                n=split($i,x,"[\_]")}
\StringTok{                \textbackslash{}}
\StringTok{                raw[NR,i]=x[n]}
\StringTok{                \}}
\StringTok{            else}
\StringTok{                \{}
\StringTok{                if(NR==i)}
\StringTok{                    \{}
\StringTok{                    raw\_norm[NR,i]=$i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}FNR \&\& FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        for(i=2; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            norm1=$i/raw\_norm[i,i]}
\StringTok{                }
\StringTok{            norm2=$i/raw\_norm[FNR,FNR]}
\StringTok{                }
\StringTok{            norms=sprintf("\%.2f", ((norm1+norm2)/2))}
\StringTok{            }
\StringTok{            if(norms \textgreater{} \textquotesingle{}}\SpecialCharTok{$}\NormalTok{tlimit}\StringTok{\textquotesingle{} \&\& norms \textless{} 1)}
\StringTok{                \{}
\StringTok{                if(raw[FNR,1]\textgreater{}=raw[1,i])}
\StringTok{                    \{}
\StringTok{                    print raw[FNR,1], raw[1,i], norms \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                    \}}
\StringTok{                else}
\StringTok{                    \{}
\StringTok{                    print raw[1,i], raw[FNR,1], norms \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data }\SpecialCharTok{$}\NormalTok{data}

\NormalTok{sort }\SpecialCharTok{{-}}\NormalTok{u }\SpecialCharTok{$}\NormalTok{savepath }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{filter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit}

\NormalTok{echo }\StringTok{"fragment\_tree\_network have been successfully written into \textless{}temp/ftaligntemp/filter\_net\_$tlimit\textgreater{}"}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}

\NormalTok{fragment\_tree\_network\_delta}\ErrorTok{)}

    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{d temp ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f .format ]}
\NormalTok{    then}
\NormalTok{    echo }\StringTok{"Project path acknowledged."}
    \ControlFlowTok{else}
\NormalTok{        until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\NormalTok{        do}
\NormalTok{        read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\NormalTok{        done;}
\NormalTok{    cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\NormalTok{    fi;}
\NormalTok{echo }\StringTok{"The following module attempts to compute the differential fingerprints of connected clusters based on the molecular fingerprint results of sirius 4."}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}

\NormalTok{plimit}\OtherTok{=}\DecValTok{0}
\NormalTok{    until [[ }\StringTok{"$plimit"} \SpecialCharTok{\textgreater{}} \StringTok{"0.5"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$plimit"} \SpecialCharTok{\textless{}} \StringTok{"0.99"}\NormalTok{ ]]}
\NormalTok{    do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the minimum posterior probability of the molecular fingerprint to be filtered. 0.9{-}0.99 is recommended. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ plimit;}
\NormalTok{    done;}

\NormalTok{plimit2}\OtherTok{=}\DecValTok{0}
\NormalTok{    until [[ }\StringTok{"$plimit2"} \SpecialCharTok{\textgreater{}} \StringTok{"0.1"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$plimit2"} \SpecialCharTok{\textless{}} \StringTok{"$plimit"}\NormalTok{ ]]}
\NormalTok{    do}
\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"The minimum posterior probability of the molecular fingerprint to be controled. 0.1{-}0.5 may work well. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ plimit2;}
\NormalTok{    done;}
    
\NormalTok{tlimit}\OtherTok{=}\ErrorTok{$}\NormalTok{(ls temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{filter\_net\_}\SpecialCharTok{*} \ErrorTok{|}\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F \_ }\StringTok{\textquotesingle{}\{print $NF\}\textquotesingle{}}\NormalTok{)}

\NormalTok{check\_rep}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}END\{print NR\}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$tlimit"}\NormalTok{))}

    \ControlFlowTok{if}\NormalTok{ [[ }\StringTok{"$check\_rep"} \SpecialCharTok{\textgreater{}} \StringTok{"1"}\NormalTok{ ]]}
\NormalTok{    then}
\NormalTok{    tlimit}\OtherTok{=}\DecValTok{0}
\NormalTok{        until [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{filter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit ]}
\NormalTok{        do}
\NormalTok{        read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Plural and different fragment\_tree\_network files were found to exist locally. Please select a tlimit parameter you have utilized to run fragment\_tree\_network\_delta. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ tlimit;}
\NormalTok{        done;}
\NormalTok{    fi;}
    
    
    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{refilter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit ]}
\NormalTok{    then rm temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{refilter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit}
\NormalTok{    fi;}
    
    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{fpsample ]}
\NormalTok{    then rm temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{fpsample}
\NormalTok{    fi;}

\NormalTok{echo }\StringTok{"Running delta\_fingerprint computation..."}

\NormalTok{echo }\StringTok{"Aquiring data from sirius index..."}

\NormalTok{data1}\OtherTok{=}\StringTok{"*\_*/compound.info"}

\NormalTok{data2}\OtherTok{=}\StringTok{"temp/ftaligntemp/filter\_net\_$tlimit"}

\NormalTok{echo }\StringTok{"Run fragment\_tree\_network\_delta."}

\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/ms\_data"}

\NormalTok{echo }\StringTok{"step 1: ms data"}

\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\StringTok{"[}\SpecialCharTok{\textbackslash{}t}\StringTok{]||[:]||[\_]"} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}

\StringTok{    BEGIN\{  }
\StringTok{        printf "..."}
\StringTok{        }
\StringTok{        printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "m/z}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "rt}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{        \}}
\StringTok{    \{}
\StringTok{    if(FILENAME\textasciitilde{}/compound.info/)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            printf "Info: catch \textgreater{}\textgreater{}\textgreater{} "FILENAME"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{            \}}
\StringTok{        if($1=="name")}
\StringTok{            \{}
\StringTok{            i+=1;}
\StringTok{            }
\StringTok{            id[i]=$NF;}
\StringTok{            }
\StringTok{            n=split($NF,a,"[\_]")}
\StringTok{            }
\StringTok{            printf a[n]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{            \}}
\StringTok{        if($1=="ionMass")}
\StringTok{            \{}
\StringTok{            mz[id[i]]=$NF}
\StringTok{            }
\StringTok{            printf sprintf("\%.4f",$NF)"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{            \}}
\StringTok{        if($1=="ionType")}
\StringTok{            \{}
\StringTok{            type[id[i]]=$NF}
\StringTok{            \}}
\StringTok{        if($1=="rt")}
\StringTok{            \{}
\StringTok{            rt[id[i]]=$2;}
\StringTok{            }
\StringTok{            printf sprintf("\%.2f",$2/60)"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FILENAME\textasciitilde{}/ftaligntemp/)}
\StringTok{        \{}
\StringTok{        \#source  target  ftalign  delta\_mz  delta\_rt  source\_iontype  target\_iontype;}
\StringTok{        }
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            printf "" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        print $1,$2,$3,sprintf("\%.3f",mz[$2]{-}mz[$1]),sprintf("\%.2f",rt[$2]{-}rt[$1]),type[$1],type[$2] \textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}

\NormalTok{echo }\StringTok{"step 2: data path"}

\NormalTok{source\_file}\OtherTok{=}\StringTok{"temp/Mo\_filename"}

\NormalTok{data}\OtherTok{=}\StringTok{"temp/ms\_data"}

\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        n=split($2, a, "[\_]")}
\StringTok{        }
\StringTok{        file[a[n]]=$2}
\StringTok{        }
\StringTok{        formu\_type[a[n]]=$3}
\StringTok{        \}}
\StringTok{    if(NR!=FNR)}
\StringTok{        \{}
\StringTok{        \#\textless{}path\textgreater{}sourceFormula  \textless{}path\textgreater{}targetFormula}
\StringTok{        }
\StringTok{        path1=file[$1]"/fingerprints/"formu\_type[$1]".fpt"}
\StringTok{        }
\StringTok{        path2=file[$2]"/fingerprints/"formu\_type[$2]".fpt"}
\StringTok{        }
\StringTok{        data[path1]=path1}
\StringTok{        }
\StringTok{        data[path2]=path2}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        for(i in data)}
\StringTok{            \{}
\StringTok{            n+=1}
\StringTok{            }
\StringTok{            print "Check file:",n}
\StringTok{            }
\StringTok{            if(getline\textless{}i=={-}1)}
\StringTok{                \{}
\StringTok{                printf "Escape filename: " i "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{                \}}
\StringTok{            else}
\StringTok{                \{}
\StringTok{                printf i" " \textgreater{} "temp/datapath"}
\StringTok{                \}}
\StringTok{            close(i)}
\StringTok{            \}}
\StringTok{        print "Sum:",n}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{source\_file }\SpecialCharTok{$}\NormalTok{data}
 
\NormalTok{datapath}\OtherTok{=}\ErrorTok{$}\NormalTok{(cat temp}\SpecialCharTok{/}\NormalTok{datapath)}

\NormalTok{echo }\StringTok{"step 3: fingerprint"}
    
\NormalTok{data\_allfp}\OtherTok{=}\StringTok{"temp/data\_allfp"}

\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    BEGIN\{}
\StringTok{        n=0}
\StringTok{        \}}
\StringTok{    \{}
\StringTok{    if(FNR==1)}
\StringTok{        \{}
\StringTok{        if(n\textgreater{}1)}
\StringTok{            \{}
\StringTok{            close(file)}
\StringTok{            \}}
\StringTok{        file=FILENAME;}
\StringTok{        }
\StringTok{        print "Get fingerprints: ",FILENAME}
\StringTok{        }
\StringTok{        n+=1;}
\StringTok{        }
\StringTok{        printf FILENAME"}\SpecialCharTok{\textbackslash{}n}\StringTok{"$0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data\_allfp}\StringTok{\textquotesingle{}"}
\StringTok{        \}}
\StringTok{    else}
\StringTok{        \{}
\StringTok{        print $0 \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data\_allfp}\StringTok{\textquotesingle{}"}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{datapath}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}


\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==1)}
\StringTok{        \{}
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if($i\textasciitilde{}/absolute/)}
\StringTok{                \{}
\StringTok{                col\_index=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/description/)}
\StringTok{                \{}
\StringTok{                col\_description=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        print $col\_index,$col\_description}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}}\NormalTok{ csi\_fingerid.tsv }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{pos\_fingerprint\_index;}

\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==1)}
\StringTok{        \{}
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if($i\textasciitilde{}/absolute/)}
\StringTok{                \{}
\StringTok{                col\_index=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/description/)}
\StringTok{                \{}
\StringTok{                col\_description=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        print $col\_index,$col\_description}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}}\NormalTok{ csi\_fingerid\_neg.tsv }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{neg\_fingerprint\_index;}

\NormalTok{posindex}\OtherTok{=}\StringTok{"temp/ftaligntemp/pos\_fingerprint\_index"}

\NormalTok{negindex}\OtherTok{=}\StringTok{"temp/ftaligntemp/neg\_fingerprint\_index"}

\NormalTok{data}\OtherTok{=}\StringTok{"temp/ms\_data"}

\NormalTok{echo }\StringTok{"step 4: merge data"}

\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    BEGIN\{}
\StringTok{        file=0}
\StringTok{        x=0}
\StringTok{        count=0}
\StringTok{        f=0}
\StringTok{        posnum=0}
\StringTok{        negnum=0}
\StringTok{        \}}
\StringTok{    \{}
\StringTok{    if(FNR==1)}
\StringTok{        \{}
\StringTok{        file+=1}
\StringTok{        \}}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        if(($1\textasciitilde{}/fingerprint/))}
\StringTok{            \{}
\StringTok{            if(x\textgreater{}f)}
\StringTok{                \{}
\StringTok{                f=x  \# calculate the max index.}
\StringTok{                \}}
\StringTok{            count+=1;  \# calculate the all fingerprints file number.}
\StringTok{            \textbackslash{}}
\StringTok{            split($1,a,"[/]"); e=split(a[1],b,"[\_]"); id=b[e]; \#catch the id.}
\StringTok{            \textbackslash{}}
\StringTok{            x=0;}
\StringTok{            \}}
\StringTok{        else}
\StringTok{            \{}
\StringTok{            x+=1;}
\StringTok{            \textbackslash{}}
\StringTok{            fp[id,x]=$1;}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(file==2)}
\StringTok{        \{}
\StringTok{        pos[FNR]=$1}
\StringTok{        }
\StringTok{        posnum+=1}
\StringTok{        \}}
\StringTok{    if(file==3)}
\StringTok{        \{}
\StringTok{        neg[FNR]=$1}
\StringTok{        }
\StringTok{        negnum+=1}
\StringTok{        \}}
\StringTok{    if(file==4)}
\StringTok{        \{}
\StringTok{        if(fp[$1,1]!="" \&\& fp[$2,1]!="")}
\StringTok{            \{}
\StringTok{            n1=split($6, g, "[]]");}
\StringTok{            }
\StringTok{            n2=split($7, h, "[]]");}
\StringTok{            }
\StringTok{            if(g[n1]=="+" \&\& h[n2]=="+")}
\StringTok{                \{}
\StringTok{                for(x=1; x\textless{}=posnum; x++)}
\StringTok{                    \{}
\StringTok{                    if(fp[$1,x]\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{} \&\& fp[$2,x]\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{})}
\StringTok{                        \{}
\StringTok{                        data\_s[FNR,x]=pos[x]}
\StringTok{                        \}}
\StringTok{                    else if(fp[$2,x]\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{} \&\& fp[$1,x]\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{})}
\StringTok{                        \{}
\StringTok{                        data\_t[FNR,x]=pos[x]}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            if(g[n1]=="{-}" \&\& h[n2]=="{-}")}
\StringTok{                \{}
\StringTok{                for(x=1; x\textless{}=negnum; x++)}
\StringTok{                    \{}
\StringTok{                    if(fp[$1,x]\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{} \&\& fp[$2,x]\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{})}
\StringTok{                        \{}
\StringTok{                        data\_s[FNR,x]=neg[x]}
\StringTok{                        \}}
\StringTok{                    else if(fp[$2,x]\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{} \&\& fp[$1,x]\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{})}
\StringTok{                        \{}
\StringTok{                        data\_t[FNR,x]=neg[x]}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            if(g[n1]=="{-}" \&\& h[n2]=="+" || h[n2]=="{-}" \&\& g[n1]=="+")}
\StringTok{                \{}
\StringTok{                for(i=1; i\textless{}=posnum; i++)}
\StringTok{                    \{}
\StringTok{                    for(j=1; j\textless{}=negnum; j++)}
\StringTok{                        \{}
\StringTok{                        if(pos[i]==neg[j])}
\StringTok{                            \{}
\StringTok{                            mirror[i]=j     \#if pos=i, the identical index of neg is mirror[i]}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            if(g[n1]=="{-}" \&\& h[n2]=="+")    }
\StringTok{                \{}
\StringTok{                for(x=1; x\textless{}=f; x++)}
\StringTok{                    \{}
\StringTok{                    if(fp[$1,mirror[x]]\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{} \&\& fp[$2,x]\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{})}
\StringTok{                        \{}
\StringTok{                        data\_s[FNR,x]=neg[mirror[x]]}
\StringTok{                        \}}
\StringTok{                    else if(fp[$2,x]\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{} \&\& fp[$1,mirror[x]]\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{})}
\StringTok{                        \{}
\StringTok{                        data\_t[FNR,x]=neg[mirror[x]]}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            if(h[n2]=="{-}" \&\& g[n1]=="+")}
\StringTok{                \{}
\StringTok{                for(x=1; x\textless{}=f; x++)}
\StringTok{                    \{}
\StringTok{                    if(fp[$1,x] \textgreater{}= \textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{} \&\& fp[$2,mirror[x]]\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{})}
\StringTok{                        \{}
\StringTok{                        data\_s[FNR,x]=neg[mirror[x]]}
\StringTok{                        \}}
\StringTok{                    else if(fp[$2,mirror[x]]\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{} \&\& fp[$1,x]\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{})}
\StringTok{                        \{}
\StringTok{                        data\_t[FNR,x]=neg[mirror[x]]}
\StringTok{                        \}}
\StringTok{                    \}       }
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            printf "source}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "target}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "ftalign\_similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "delta\_m/z}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "source\_fp\_uniq}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "target\_fp\_uniq}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{            \}}
\StringTok{        else}
\StringTok{            \{}
\StringTok{            printf $1"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $2"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $3"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $4"}\SpecialCharTok{\textbackslash{}t}\StringTok{";}
\StringTok{            \textbackslash{}}
\StringTok{            if(fp[$1,1]=="" || fp[$2,1]=="")}
\StringTok{                \{}
\StringTok{                printf "NA@NA}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{                \}}
\StringTok{            else}
\StringTok{                \{}
\StringTok{                printf "source:"  \#the source fingerprint uniq.}
\StringTok{                \textbackslash{}}
\StringTok{                for(x=1; x\textless{}=f; x++)}
\StringTok{                    \{}
\StringTok{                    if(data\_s[FNR,x]!="")}
\StringTok{                        \{}
\StringTok{                        printf data\_s[FNR,x]","}
\StringTok{                        \}}
\StringTok{                    \};}
\StringTok{                printf "@target:"  \#the target fingerprint uniq.}
\StringTok{                \textbackslash{}}
\StringTok{                for(x=1; x\textless{}=f; x++)}
\StringTok{                    \{}
\StringTok{                    if(data\_t[FNR,x]!="")}
\StringTok{                        \{}
\StringTok{                        printf data\_t[FNR,x]","}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data\_allfp }\SpecialCharTok{$}\NormalTok{posindex }\SpecialCharTok{$}\NormalTok{negindex }\SpecialCharTok{$}\NormalTok{data }\SpecialCharTok{|}\NormalTok{ sed }\SpecialCharTok{{-}}\NormalTok{e }\StringTok{\textquotesingle{}s/,@/}\SpecialCharTok{\textbackslash{}t}\StringTok{/g; s/,$//g; s/@/}\SpecialCharTok{\textbackslash{}t}\StringTok{/g\textquotesingle{}}\NormalTok{ \textbackslash{}}
\NormalTok{    \textbackslash{}}
    \SpecialCharTok{\textgreater{}}\NormalTok{ results}\SpecialCharTok{/}\NormalTok{source\_target\_tree\_}\SpecialCharTok{$}\NormalTok{tlimit.tsv;}
     
\NormalTok{    echo }\StringTok{"All instances have written into \textless{}results/source\_target\_tree\_$tlimit.tsv\textgreater{}."}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{compound\_idenfication}\ErrorTok{)}

\NormalTok{echo }\StringTok{"Run compound\_idenfication."}







\NormalTok{echo }\StringTok{"compound\_idenfication "}

\NormalTok{exit}

\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{double\_ion\_network}\ErrorTok{)}

\NormalTok{exit;}

\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{exit}\ErrorTok{)}
\NormalTok{echo }\StringTok{"The mystery of creation is like the darkness of night{-}{-}it is great.}
\StringTok{Delusions of knowledge are like the fog of the morning."}
\NormalTok{exit;}
\NormalTok{;;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{*}\ErrorTok{)}
\NormalTok{echo }\StringTok{"error"}
\NormalTok{exit;}
\NormalTok{;;}
\NormalTok{esac;}
\NormalTok{done;}\CommentTok{\#(for)}
\NormalTok{done;}\CommentTok{\#(select)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-mz_alignment.sh}{%
\section{File: mz\_alignment.sh}\label{file-mz_alignment.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data1}\OtherTok{=}\StringTok{"serum\_neg\_mzmine\_0030.mgf"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if()}
\StringTok{\}\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-name_iupuc.sh}{%
\section{File: name\_iupuc.sh}\label{file-name_iupuc.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# vconda activate STOUT}
\NormalTok{echo }\StringTok{"INFO: make sure you have run: conda activate STOUT"}
\NormalTok{workdir}\OtherTok{=}\ErrorTok{$}\NormalTok{(dirs }\SpecialCharTok{|}\NormalTok{ sed }\StringTok{\textquotesingle{}s/\textasciitilde{}/\textbackslash{}/home\textbackslash{}/\textquotesingle{}}\SpecialCharTok{$}\NormalTok{USER}\StringTok{\textquotesingle{}/g\textquotesingle{}}\NormalTok{)}
\NormalTok{read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input file name to convert \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ i}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(FNR==1)}
\StringTok{    \{}
\StringTok{      for(i=1; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{          if($i\textasciitilde{}/\^{}smiles$/)}
\StringTok{            \{}
\StringTok{              col\_smiles=i}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  if(FNR\textgreater{}=2)}
\StringTok{    \{}
\StringTok{      printf $col\_smiles"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "SMILES\_temp"}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{i}
\NormalTok{sed }\SpecialCharTok{{-}}\NormalTok{i s}\CommentTok{\#\textbackslash{}\textquotesingle{}\#\#g SMILES\_temp}
\NormalTok{file}\OtherTok{=}\NormalTok{SMILES\_temp}
\NormalTok{cd }\SpecialCharTok{/}\NormalTok{home}\SpecialCharTok{/}\ErrorTok{$}\NormalTok{USER}\SpecialCharTok{/}\NormalTok{Downloads}\SpecialCharTok{/}\NormalTok{codes}\SpecialCharTok{/}\NormalTok{github\_tool}\SpecialCharTok{/}\NormalTok{SMILES}\SpecialCharTok{{-}}\NormalTok{to}\SpecialCharTok{{-}}\NormalTok{IUPAC}\SpecialCharTok{{-}}\NormalTok{Translator}
\NormalTok{python STOUT\_V\_2.}\FloatTok{1.}\NormalTok{py }\SpecialCharTok{{-}{-}}\NormalTok{STI }\SpecialCharTok{$}\NormalTok{\{workdir\}}\SpecialCharTok{/}\ErrorTok{$}\NormalTok{file }\SpecialCharTok{$}\NormalTok{\{workdir\}}\SpecialCharTok{/}\NormalTok{iupuc\_}\SpecialCharTok{$}\NormalTok{\{i\} }\CommentTok{\#SMILES to IUPAC}
\DocumentationTok{\#\# python STOUT\_V\_2.1.py {-}{-}STI test out \#SMILES to IUPAC}
\NormalTok{cd }\SpecialCharTok{$}\NormalTok{workdir}
\NormalTok{rm SMILES\_temp}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-obabel.sh}{%
\section{File: obabel.sh}\label{file-obabel.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cd }\SpecialCharTok{\textasciitilde{}}\ErrorTok{/}\NormalTok{operation}\SpecialCharTok{/}\NormalTok{back}\SpecialCharTok{/}\NormalTok{0703\_all}\SpecialCharTok{/}\NormalTok{results}\SpecialCharTok{/}\NormalTok{structure\_2d}\SpecialCharTok{/}
\NormalTok{data}\OtherTok{=}\StringTok{"../../com\_compound.tsv"}
\NormalTok{data\_repel}\OtherTok{=}\StringTok{"pubchem.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/\^{}id$/)}
\StringTok{                    \{}
\StringTok{                    col\_id=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/smiles/)}
\StringTok{                    \{}
\StringTok{                    col\_smilse=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/links/)}
\StringTok{                    \{}
\StringTok{                    col\_links=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            \# print FNR," \textgreater{}\textgreater{}\textgreater{} ",$col\_id}
\StringTok{            if($col\_links\textasciitilde{}/\^{}PubChem/)}
\StringTok{                \{}
\StringTok{                split($col\_links, a, "[:][(]||[,][ ]||[)][;]||[)]")}
\StringTok{                cid[$col\_id]=a[2]}
\StringTok{                \# print a[2]}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}FNR)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            file=FILENAME}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            repel[$1]=$1}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{    }
\StringTok{        close(file)}
\StringTok{        RS="|||"}
\StringTok{        printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "cid}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "cid\_metadata.tsv"}
\StringTok{        for(i in cid)}
\StringTok{            \{}
\StringTok{            n+=1}
\StringTok{            printf i"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  cid[i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "cid\_metadata.tsv"}
\StringTok{            if(n==1)}
\StringTok{                \{}
\StringTok{                cid\_set=cid[i]}
\StringTok{                \}}
\StringTok{            if(n\textgreater{}=2)}
\StringTok{                \{}
\StringTok{                cid\_set=cid\_set","cid[i]}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \# print cid\_set}
\StringTok{        printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "cid}\SpecialCharTok{\textbackslash{}t}\StringTok{" "IUPACName}\SpecialCharTok{\textbackslash{}t}\StringTok{" "canonical\_smiles}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "isomeric\_smiles}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "pubchem.tsv"}
\StringTok{        for(i in cid)}
\StringTok{            \{}
\StringTok{            if(repel[i]=="")}
\StringTok{                \{}
\StringTok{                "curl https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                cid[i] \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                "/property/IUPACName,CanonicalSMILES,IsomericSMILES/CSV" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                |getline data;}
\StringTok{                gsub(/(.*)}\SpecialCharTok{\textbackslash{}n}\StringTok{/,"",data)}
\StringTok{                gsub(/,/,"}\SpecialCharTok{\textbackslash{}t}\StringTok{",data)}
\StringTok{                printf i"}\SpecialCharTok{\textbackslash{}t}\StringTok{" data"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "pubchem.tsv"}
\StringTok{                close("curl https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                cid[i] \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                "/property/CanonicalSMILES,IsomericSMILES/CSV")}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data }\SpecialCharTok{$}\NormalTok{data\_repel}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ data}\OtherTok{=}\StringTok{"pubchem.tsv"}
\NormalTok{ sort }\SpecialCharTok{{-}}\NormalTok{r }\SpecialCharTok{$}\NormalTok{data }\SpecialCharTok{|}\NormalTok{ uniq }\SpecialCharTok{\textgreater{}}\NormalTok{ re\_pubchem.tsv}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ data}\OtherTok{=}\StringTok{"re\_pubchem.tsv"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(FNR==1)}
\StringTok{        \{}
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if($i\textasciitilde{}/\^{}id$/)}
\StringTok{                \{}
\StringTok{                col\_id=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/isomeric/)}
\StringTok{                \{}
\StringTok{                col\_isomeric=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        print $col\_isomeric}
\StringTok{        system("obabel {-}:"  $col\_isomeric  " {-}osvg {-}O "  $col\_id  ".svg")}
\StringTok{        close("obabel {-}:"  $col\_isomeric  " {-}osvg {-}O "  $col\_id  ".svg")}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ sed }\SpecialCharTok{{-}}\NormalTok{i }\StringTok{\textquotesingle{}s/white/transparent/g\textquotesingle{}}\NormalTok{ [}\DecValTok{0{-}9}\NormalTok{]}\SpecialCharTok{*}\NormalTok{.svg}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ ls }\SpecialCharTok{*}\NormalTok{.svg }\SpecialCharTok{|}\NormalTok{ awk }\StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if($0\textasciitilde{}/cairo/)}
\StringTok{        \{}
\StringTok{        next}
\StringTok{        \}}
\StringTok{    else}
\StringTok{        \{}
\StringTok{        system("cairosvg "  $0  " {-}o cairo\_"  $0)}
\StringTok{        close("cairosvg "  $0  " {-}o cairo\_"  $0)}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \CommentTok{\# select \textless{}{-} c(279, 458, 574, 1107, 1445, 2227, 2529, 2664, 2824, 3380, 3918, 3938)}
\NormalTok{ idset}\OtherTok{=}\DecValTok{279}\NormalTok{,}\DecValTok{458}\NormalTok{,}\DecValTok{574}\NormalTok{,}\DecValTok{1107}\NormalTok{,}\DecValTok{1445}\NormalTok{,}\DecValTok{2227}\NormalTok{,}\DecValTok{2529}\NormalTok{,}\DecValTok{2664}\NormalTok{,}\DecValTok{2824}\NormalTok{,}\DecValTok{3380}\NormalTok{,}\DecValTok{3918}\NormalTok{,}\DecValTok{3938}
\NormalTok{ mkdir smiles\_draw}
 \CommentTok{\#path=\textasciitilde{}/operation/back/0703\_all}
\NormalTok{ data}\OtherTok{=}\StringTok{"../../com\_lignans\_and\_iridoids.tsv"}
\NormalTok{ savepath}\OtherTok{=}\StringTok{"smiles\_draw"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    BEGIN\{}
\StringTok{        n=split("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{idset}\StringTok{\textquotesingle{}", a, "[,]")}
\StringTok{        print n, a[1], a[2]}
\StringTok{        \}}
\StringTok{    \{}
\StringTok{    if(FNR==1)}
\StringTok{        \{}
\StringTok{        print FILENAME}
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if($i\textasciitilde{}/\^{}id/)}
\StringTok{                \{}
\StringTok{                col\_id=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/smiles/)}
\StringTok{                \{}
\StringTok{                col\_smiles=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        for(i in a)}
\StringTok{            \{}
\StringTok{            if($col\_id==a[i])}
\StringTok{                \{}
\StringTok{                print $col\_id, $col\_smiles}
\StringTok{                system("obabel {-}:}\SpecialCharTok{\textbackslash{}"}\StringTok{"  $col\_smiles  "}\SpecialCharTok{\textbackslash{}"}\StringTok{ {-}osvg {-}O \textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}/"  $col\_id  ".svg")}
\StringTok{                close("obabel {-}:}\SpecialCharTok{\textbackslash{}"}\StringTok{"  $col\_smiles  "}\SpecialCharTok{\textbackslash{}"}\StringTok{ {-}osvg {-}O \textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}/"  $col\_id  ".svg")}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ idset}\OtherTok{=}\DecValTok{279}\NormalTok{,}\DecValTok{458}\NormalTok{,}\DecValTok{574}\NormalTok{,}\DecValTok{1107}\NormalTok{,}\DecValTok{1445}\NormalTok{,}\DecValTok{2227}\NormalTok{,}\DecValTok{2529}\NormalTok{,}\DecValTok{2664}\NormalTok{,}\DecValTok{2824}\NormalTok{,}\DecValTok{3380}\NormalTok{,}\DecValTok{3918}\NormalTok{,}\DecValTok{3938}
\NormalTok{ data1}\OtherTok{=}\StringTok{"re\_pubchem.tsv"}
\NormalTok{ data2}\OtherTok{=}\StringTok{"../../com\_lignans\_and\_iridoids.tsv"}
\NormalTok{ savepath}\OtherTok{=}\StringTok{"smiles\_draw"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    BEGIN\{}
\StringTok{        n=split("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{idset}\StringTok{\textquotesingle{}", a, "[,]")}
\StringTok{        print n, a[1], a[2]}
\StringTok{        \}}
\StringTok{    \{}
\StringTok{    if(FNR==1)}
\StringTok{        \{}
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if($i\textasciitilde{}/\^{}id$/)}
\StringTok{                \{}
\StringTok{                col\_id=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/isomeric/)}
\StringTok{                \{}
\StringTok{                col\_isomeric=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/\^{}smiles/)}
\StringTok{                \{}
\StringTok{                col\_smiles=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FNR\textgreater{}=2 \&\& FILENAME \textasciitilde{}/pubchem/)}
\StringTok{        \{}
\StringTok{        for(i in a)}
\StringTok{            \{}
\StringTok{            if($col\_id==a[i])}
\StringTok{                \{}
\StringTok{                iso[$col\_id]=$col\_isomeric}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FNR\textgreater{}=2 \&\& FILENAME \textasciitilde{}/com\_/)}
\StringTok{        \{}
\StringTok{        for(i in a)}
\StringTok{            \{}
\StringTok{            if($col\_id==a[i])}
\StringTok{                \{}
\StringTok{                smiles[$col\_id]=$col\_smiles}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "smiles}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "isomeric}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}/structure\_chemdraw.tsv"}
\StringTok{        for(i in a)}
\StringTok{            \{}
\StringTok{            printf a[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  smiles[a[i]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  iso[a[i]]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}/structure\_chemdraw.tsv"}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\# complementation get SDF data}
\NormalTok{ mkdir sdf}
\NormalTok{ data}\OtherTok{=}\StringTok{"../../com\_compound.tsv"}
\NormalTok{ savepath}\OtherTok{=}\StringTok{"sdf/"}
\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/\^{}id$/)}
\StringTok{                    \{}
\StringTok{                    col\_id=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/smiles/)}
\StringTok{                    \{}
\StringTok{                    col\_smilse=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/links/)}
\StringTok{                    \{}
\StringTok{                    col\_links=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            \# print FNR," \textgreater{}\textgreater{}\textgreater{} ",$col\_id}
\StringTok{            if($col\_links\textasciitilde{}/\^{}PubChem/)}
\StringTok{                \{}
\StringTok{                split($col\_links, a, "[:][(]||[,][ ]||[)][;]||[)]")}
\StringTok{                cid[$col\_id]=a[2]}
\StringTok{                \# print a[2]}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{    }
\StringTok{        for(i in cid)}
\StringTok{            \{}
\StringTok{            if(repel[i]=="")}
\StringTok{                \{}
\StringTok{                system("curl https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                cid[i] \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                "/SDF \textgreater{} \textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" i ".SDF")}
\StringTok{                close("curl https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                cid[i] \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                "/SDF \textgreater{} \textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" i ".SDF")}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ sed }\SpecialCharTok{{-}}\NormalTok{i }\StringTok{\textquotesingle{}1c\textbackslash{} \textquotesingle{}}\NormalTok{ sdf}\SpecialCharTok{/}\NormalTok{[}\DecValTok{0{-}9}\NormalTok{]}\SpecialCharTok{*}\NormalTok{.SDF}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ ls sdf}\SpecialCharTok{/}\NormalTok{[}\DecValTok{0{-}9}\NormalTok{]}\SpecialCharTok{*}\NormalTok{.SDF }\SpecialCharTok{|}\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    system("obabel "  $0  " {-}iSDF {-}osvg {-}O "  $col\_id  ".svg")}
\StringTok{    close("obabel "  $0  " {-}iSDF {-}osvg {-}O "  $col\_id  ".svg")}
\StringTok{    \}\textquotesingle{}} 
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ sed }\SpecialCharTok{{-}}\NormalTok{i }\SpecialCharTok{{-}}\NormalTok{e }\StringTok{\textquotesingle{}s/white/transparent/g; s/stroke{-}width="2.0"/stroke{-}width="4.0"/g;\textquotesingle{}}\NormalTok{ sdf}\SpecialCharTok{/}\NormalTok{[}\DecValTok{0{-}9}\NormalTok{]}\SpecialCharTok{*}\NormalTok{SDF.svg}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{ ls sdf}\SpecialCharTok{/}\NormalTok{[}\DecValTok{0{-}9}\NormalTok{]}\SpecialCharTok{*}\NormalTok{.svg }\SpecialCharTok{|}\NormalTok{ awk }\StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if($0\textasciitilde{}/cairo/)}
\StringTok{        \{}
\StringTok{        next}
\StringTok{        \}}
\StringTok{    else}
\StringTok{        \{}
\StringTok{        system("cairosvg "  $0  " {-}o "  $0 ".cairo.svg")}
\StringTok{        close("cairosvg "  $0  " {-}o "  $0 ".cairo.svg")}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\# }
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\# mavin molconvert}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{  ls smiles\_draw}\SpecialCharTok{/}\NormalTok{[}\DecValTok{0{-}9}\NormalTok{]}\SpecialCharTok{*}\NormalTok{\_1.sdf }\SpecialCharTok{|}\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    split($0, a, "[\_][1][.][s][d][f]")}
\StringTok{    system("obabel "  $0  " {-}iSDF {-}osvg {-}O "  a[1]  ".svg")}
\StringTok{    close("obabel "  $0  " {-}iSDF {-}osvg {-}O "  a[1]  ".svg")}
\StringTok{    print a[1]".svg"}
\StringTok{    \}\textquotesingle{}}
 \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
 \DocumentationTok{\#\#\# create name}
\NormalTok{ molconvert }\StringTok{"name:common,all"} \SpecialCharTok{{-}}\NormalTok{s }\StringTok{"COC(=O)C1=COC(C2C1CC=C2CO)OC3C(C(C(C(O3)CO)O)O)O"}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-pubchem_hub_keggn.sh}{%
\section{File: pubchem\_hub\_keggn.sh}\label{file-pubchem_hub_keggn.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mkdir synonyms}
\NormalTok{data}\OtherTok{=}\NormalTok{fingerid\_candidate\_top.tsv}
\CommentTok{\# data=fingerid\_first\_score.tsv}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==FNR)}
\StringTok{    \{}
\StringTok{      if(FNR==1)}
\StringTok{        \{}
\StringTok{          for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{              if($i\textasciitilde{}/\^{}id$/)}
\StringTok{                \{}
\StringTok{                  col\_id=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/smiles/)}
\StringTok{                \{}
\StringTok{                  col\_smilse=i}
\StringTok{                \}}
\StringTok{              if($i\textasciitilde{}/links/)}
\StringTok{                \{}
\StringTok{                  col\_links=i}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{      if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{          if(id==$col\_id)}
\StringTok{            \{}
\StringTok{              rankn+=1}
\StringTok{            \}}
\StringTok{        else}
\StringTok{          \{}
\StringTok{            rankn=1}
\StringTok{          \}}
\StringTok{          id=$col\_id}
\StringTok{          \# print FNR," \textgreater{}\textgreater{}\textgreater{} ",$col\_id}
\StringTok{          if($col\_links\textasciitilde{}/\^{}PubChem/)}
\StringTok{            \{}
\StringTok{              l=split($col\_links, a, "[;]")}
\StringTok{              if(a[1]\textasciitilde{}/PubChem/)}
\StringTok{                \{}
\StringTok{                  n=split( a[1], b, "[(]||[,][ ]||[)]" )}
\StringTok{                  for(i=2; i\textless{}=n{-}1; i++)}
\StringTok{                    \{}
\StringTok{                      cid\_set[b[i]]=$col\_id}
\StringTok{                      rank\_compound[$col\_id, b[i]]=rankn}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{          if($col\_links\textasciitilde{}/KEGG/)}
\StringTok{            \{}
\StringTok{              l=split($col\_links, a, "[;]")}
\StringTok{              for(j=1; j\textless{}=l; j++)}
\StringTok{                \{}
\StringTok{                  if(a[j]\textasciitilde{}/KEGG/)}
\StringTok{                    \{}
\StringTok{                      n=split( a[j], b, "[(]||[,][ ]||[)]" )}
\StringTok{                      for(i=2; i\textless{}=n{-}1; i++)}
\StringTok{                        \{}
\StringTok{                          kegg\_set[b[i]]=$col\_id}
\StringTok{                          rank\_compound[$col\_id, b[i],"kegg"]=rankn}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{\}}
\StringTok{END\{    }
\StringTok{printf "cid}\SpecialCharTok{\textbackslash{}t}\StringTok{" "id}\SpecialCharTok{\textbackslash{}t}\StringTok{" "kegg}\SpecialCharTok{\textbackslash{}t}\StringTok{" "score\_rank}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "synonyms/kegg\_complement.tsv"}
\StringTok{for(i in kegg\_set)}
\StringTok{  \{}
\StringTok{    printf "null}\SpecialCharTok{\textbackslash{}t}\StringTok{"  kegg\_set[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  i"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  rank\_compound[kegg\_set[i], i, "kegg"]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "synonyms/kegg\_complement.tsv"}
\StringTok{  \}}
\StringTok{printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "cid}\SpecialCharTok{\textbackslash{}t}\StringTok{" "score\_rank}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "synonyms/cid\_metadata.tsv"}
\StringTok{for(i in cid\_set)}
\StringTok{  \{}
\StringTok{    if(i!="null")}
\StringTok{      \{}
\StringTok{        n+=1}
\StringTok{        printf cid\_set[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  i"}\SpecialCharTok{\textbackslash{}t}\StringTok{" rank\_compound[cid\_set[i], i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "synonyms/cid\_metadata.tsv"}
\StringTok{        if(n==1)}
\StringTok{          \{}
\StringTok{            cid\_sets=i}
\StringTok{          \}}
\StringTok{        if(n\textgreater{}=2)}
\StringTok{          \{}
\StringTok{            cid\_sets=cid\_sets","i}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{\# print cid\_set}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\DocumentationTok{\#\# oganize cid dataset}
\NormalTok{list}\OtherTok{=}\ErrorTok{$}\NormalTok{(}
\NormalTok{  awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  \{}
\StringTok{    if(NR==2)}
\StringTok{      \{}
\StringTok{        printf $2}
\StringTok{      \}}
\StringTok{    if(NR\textgreater{}2)}
\StringTok{      \{}
\StringTok{        n+=1}
\StringTok{        if(n\textless{}=100)}
\StringTok{          \{}
\StringTok{            printf ","$2}
\StringTok{          \}}
\StringTok{      else}
\StringTok{        \{}
\StringTok{          n=1}
\StringTok{          printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{"$2}
\StringTok{        \}}
\StringTok{      \}}
\StringTok{  \}\textquotesingle{}}\NormalTok{ synonyms}\SpecialCharTok{/}\NormalTok{cid\_metadata.tsv}
\NormalTok{)}
\NormalTok{nrow}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}END\{print NR\}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$list"}\NormalTok{))}
\DocumentationTok{\#\# search pubchem}
\ControlFlowTok{for}\NormalTok{ i }\ControlFlowTok{in} \SpecialCharTok{$}\NormalTok{(seq }\SpecialCharTok{$}\NormalTok{nrow)}
\NormalTok{do}
\NormalTok{  cids}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}\{if(NR==\textquotesingle{}}\SpecialCharTok{$}\NormalTok{i}\StringTok{\textquotesingle{})\{print $0\}\}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$list"}\NormalTok{))}
\NormalTok{  check}\OtherTok{=}\ErrorTok{$}\NormalTok{(echo }\StringTok{"$cids"} \SpecialCharTok{|}\NormalTok{ awk }\StringTok{\textquotesingle{}\{if($0\textasciitilde{}/\^{}[0{-}9]/)\{printf 0\}else\{printf 1\}\}\textquotesingle{}}\NormalTok{)}
  \ControlFlowTok{while}\NormalTok{ [ }\SpecialCharTok{$}\NormalTok{check }\SpecialCharTok{==} \DecValTok{0}\NormalTok{ ]}
\NormalTok{  do}
\NormalTok{    echo }\StringTok{"Try catch pubchem API ($\{i\}/$\{nrow\})..."}
    \DocumentationTok{\#\# check file}
    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f synonyms}\SpecialCharTok{/}\ErrorTok{$}\NormalTok{\{i\}\_synonyms.XML ]}
\NormalTok{    then}
\NormalTok{      check}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}\{if(FNR==1)\{if($0\textasciitilde{}/xml version/)\{printf "1"\}else\{printf "0"\}\}\}}
\StringTok{      END\{if(FNR==0)\{printf "0"\}\}\textquotesingle{}}\NormalTok{ synonyms}\SpecialCharTok{/}\ErrorTok{$}\NormalTok{\{i\}\_synonyms.XML)}
\NormalTok{    fi;}
    \DocumentationTok{\#\# catch data via curl}
    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{$}\NormalTok{check }\SpecialCharTok{==} \DecValTok{0}\NormalTok{ ]}
\NormalTok{    then}
\NormalTok{      curl }\SpecialCharTok{{-}{-}}\NormalTok{connect}\SpecialCharTok{{-}}\NormalTok{timeout }\DecValTok{20} \SpecialCharTok{{-}{-}}\NormalTok{retry }\DecValTok{100} \SpecialCharTok{{-}{-}}\NormalTok{retry}\SpecialCharTok{{-}}\NormalTok{delay }\DecValTok{30}\NormalTok{ https}\SpecialCharTok{:}\ErrorTok{//}\NormalTok{pubchem.ncbi.nlm.nih.gov}\SpecialCharTok{/}\NormalTok{rest}\SpecialCharTok{/}\NormalTok{pug}\SpecialCharTok{/}\NormalTok{compound}\SpecialCharTok{/}\NormalTok{cid}\SpecialCharTok{/}\ErrorTok{$}\NormalTok{\{cids\}}\SpecialCharTok{/}\NormalTok{synonyms}\SpecialCharTok{/}\NormalTok{XML }\SpecialCharTok{\textgreater{}}\NormalTok{ synonyms}\SpecialCharTok{/}\ErrorTok{$}\NormalTok{\{i\}\_synonyms.XML}
\NormalTok{    fi;}
\NormalTok{  done}
\NormalTok{done}
\DocumentationTok{\#\# data reformat}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\StringTok{"[\textgreater{}]||[\textless{}][/]"} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(NR==1)}
\StringTok{    \{}
\StringTok{      target\_file="synonyms/reformat\_kegg.tsv"}
\StringTok{      printf "cid}\SpecialCharTok{\textbackslash{}t}\StringTok{" "kegg}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} target\_file}
\StringTok{    \}}
\StringTok{  if($1\textasciitilde{}/\textless{}CID$/)}
\StringTok{    \{}
\StringTok{      cid=$2}
\StringTok{    \}}
\StringTok{  if($2\textasciitilde{}/\^{}C[0{-}9]*[0{-}9]$/)}
\StringTok{    \{}
\StringTok{      printf cid"}\SpecialCharTok{\textbackslash{}t}\StringTok{" $2"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} target\_file}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}}\NormalTok{ synonyms}\SpecialCharTok{/}\ErrorTok{*}\NormalTok{\_synonyms.XML}

\DocumentationTok{\#\# excute next step}
\DocumentationTok{\#\# history}
\DocumentationTok{\#\# serum\_neg.R}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-pubchem_hub.sh}{%
\section{File: pubchem\_hub.sh}\label{file-pubchem_hub.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data}\OtherTok{=}\StringTok{"fingerid\_first\_score.tsv"}
\DocumentationTok{\#\# data=\textquotesingle{}lignans\_and\_iridoids.tsv\textquotesingle{}}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/\^{}id$/)}
\StringTok{                    \{}
\StringTok{                    col\_id=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/smiles/)}
\StringTok{                    \{}
\StringTok{                    col\_smilse=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/links/)}
\StringTok{                    \{}
\StringTok{                    col\_links=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            \# print FNR," \textgreater{}\textgreater{}\textgreater{} ",$col\_id}
\StringTok{            if($col\_links\textasciitilde{}/\^{}PubChem/)}
\StringTok{                \{}
\StringTok{                split($col\_links, a, "[:][(]||[,][ ]||[)][;]||[)]")}
\StringTok{                cid[$col\_id]=a[2]}
\StringTok{                \# print a[2]}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{    }
\StringTok{        printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "cid}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "cid\_metadata.tsv"}
\StringTok{        for(i in cid)}
\StringTok{            \{}
\StringTok{            n+=1}
\StringTok{            printf i"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  cid[i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "cid\_metadata.tsv"}
\StringTok{            if(n==1)}
\StringTok{                \{}
\StringTok{                cid\_set=cid[i]}
\StringTok{                \}}
\StringTok{            if(n\textgreater{}=2)}
\StringTok{                \{}
\StringTok{                cid\_set=cid\_set","cid[i]}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \# print cid\_set}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}

\NormalTok{list}\OtherTok{=}\ErrorTok{$}\NormalTok{(}
\NormalTok{  awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{  \{}
\StringTok{    if(NR==2)}
\StringTok{      \{}
\StringTok{        printf $2}
\StringTok{      \}}
\StringTok{    if(NR\textgreater{}2)}
\StringTok{      \{}
\StringTok{        n+=1}
\StringTok{        if(n\textless{}=100)}
\StringTok{          \{}
\StringTok{            printf ","$2}
\StringTok{          \}}
\StringTok{      else}
\StringTok{        \{}
\StringTok{          n=1}
\StringTok{          printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{"$2}
\StringTok{        \}}
\StringTok{      \}}
\StringTok{  \}\textquotesingle{}}\NormalTok{ cid\_metadata.tsv}
\NormalTok{)}

\NormalTok{nrow}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}END\{print NR\}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$list"}\NormalTok{))}

\ControlFlowTok{for}\NormalTok{ i }\ControlFlowTok{in} \SpecialCharTok{$}\NormalTok{(seq }\SpecialCharTok{$}\NormalTok{nrow)}
\NormalTok{do}
\NormalTok{  cids}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}\{if(NR==\textquotesingle{}}\SpecialCharTok{$}\NormalTok{i}\StringTok{\textquotesingle{})\{print $0\}\}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$list"}\NormalTok{))}
\NormalTok{  check}\OtherTok{=}\ErrorTok{$}\NormalTok{(echo }\StringTok{"$cids"} \SpecialCharTok{|}\NormalTok{ awk }\StringTok{\textquotesingle{}\{if($0\textasciitilde{}/\^{}[0{-}9]/)\{printf 0\}else\{printf 1\}\}\textquotesingle{}}\NormalTok{)}
  \ControlFlowTok{while}\NormalTok{ [ }\SpecialCharTok{$}\NormalTok{check }\SpecialCharTok{==} \DecValTok{0}\NormalTok{ ]}
\NormalTok{  do}
\NormalTok{    echo }\StringTok{"Try catch pubchem API ($\{i\}/$\{nrow\})..."}
    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{\{i\}\_smiles.csv ]}
\NormalTok{    then}
\NormalTok{      check}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}}
\StringTok{      \{}
\StringTok{        if(FNR==1)}
\StringTok{          \{}
\StringTok{            if($0\textasciitilde{}/CID/)}
\StringTok{              \{}
\StringTok{                printf "1"}
\StringTok{              \}}
\StringTok{          else}
\StringTok{            \{}
\StringTok{              printf "0"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  END\{}
\StringTok{  if(FNR==0)}
\StringTok{    \{}
\StringTok{      printf "0"}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{\{i\}\_smiles.csv)}
\NormalTok{    fi;}
\ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{$}\NormalTok{check }\SpecialCharTok{==} \DecValTok{0}\NormalTok{ ]}
\NormalTok{then}
\NormalTok{  curl }\SpecialCharTok{{-}{-}}\NormalTok{connect}\SpecialCharTok{{-}}\NormalTok{timeout }\DecValTok{20} \SpecialCharTok{{-}{-}}\NormalTok{retry }\DecValTok{100} \SpecialCharTok{{-}{-}}\NormalTok{retry}\SpecialCharTok{{-}}\NormalTok{delay }\DecValTok{30}\NormalTok{ https}\SpecialCharTok{:}\ErrorTok{//}\NormalTok{pubchem.ncbi.nlm.nih.gov}\SpecialCharTok{/}\NormalTok{rest}\SpecialCharTok{/}\NormalTok{pug}\SpecialCharTok{/}\NormalTok{compound}\SpecialCharTok{/}\NormalTok{cid}\SpecialCharTok{/}\ErrorTok{$}\NormalTok{\{cids\}}\SpecialCharTok{/}\NormalTok{property}\SpecialCharTok{/}\NormalTok{IUPACName,CanonicalSMILES,IsomericSMILES}\SpecialCharTok{/}\NormalTok{CSV }\SpecialCharTok{\textgreater{}} \ErrorTok{$}\NormalTok{\{i\}\_smiles.csv}
\NormalTok{fi;}
\NormalTok{done;}
\NormalTok{done;}

\DocumentationTok{\#\# run pubchem\_hub\_merge.R}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-r_network_code.sh}{%
\section{File: R\_network\_code.sh}\label{file-r_network_code.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mkdir r\_network}
\NormalTok{mkdir r\_network}\SpecialCharTok{/}\NormalTok{temp}
\NormalTok{mkdir r\_network}\SpecialCharTok{/}\NormalTok{ms2\_figures}
\NormalTok{mkdir r\_network}\SpecialCharTok{/}\NormalTok{structure\_svg}
\NormalTok{mkdir r\_network}\SpecialCharTok{/}\NormalTok{frags\_figures}
\NormalTok{mkdir r\_network}\SpecialCharTok{/}\NormalTok{annonation}
\NormalTok{mkdir r\_network}\SpecialCharTok{/}\NormalTok{nodes\_figures}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#for Unix}
\CommentTok{\#edges}
\NormalTok{file}\OtherTok{=}\StringTok{"results/source\_target\_tree*"}
\NormalTok{data}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}\{if(($1 \textasciitilde{} /\^{}[0{-}9]/))\{print $0\}\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{file)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F [}\StringTok{"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}\SpecialCharTok{:}\NormalTok{,] }\StringTok{\textquotesingle{}\{}
\StringTok{    if(NR==1)}
\StringTok{        \{}
\StringTok{        printf "from}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "to}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "length}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "width}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "label}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "arrows}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "dashes}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "smooth}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "shadow}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "title}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        norm=sprintf("\%.2f",$3);}
\StringTok{        \textbackslash{}}
\StringTok{        norm2=sprintf("\%.2f",$4);}
\StringTok{        \textbackslash{}}
\StringTok{        len=150/$3;}
\StringTok{        \textbackslash{}}
\StringTok{        width=10*$3;}
\StringTok{        \textbackslash{}}
\StringTok{        printf $1"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $2"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  len"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  width"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  norm2"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "to}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "FALSE}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "FALSE}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "FALSE}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        "\textless{}b\textgreater{}ftalign\_similarity:"norm"\textless{}/b\textgreater{}"  "\textless{}/br\textgreater{}"  "\textless{}b\textgreater{}delta\_m/z:"norm2"\textless{}/b\textgreater{}"  "\textless{}/br\textgreater{}";\textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        for(i=5; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if(i\textgreater{}=6 \&\& $i=="NA")}
\StringTok{                \{}
\StringTok{                NA=1}
\StringTok{                \}}
\StringTok{            if($i=="source")}
\StringTok{                \{}
\StringTok{                a=i+1;}
\StringTok{                \}}
\StringTok{            if($i=="target")}
\StringTok{                \{}
\StringTok{                b=i;}
\StringTok{                \textbackslash{}}
\StringTok{                c=i+1}
\StringTok{                \}}
\StringTok{            \};}
\StringTok{        if(NA==1)}
\StringTok{            \{}
\StringTok{            printf "fp:NA}\SpecialCharTok{\textbackslash{}n}\StringTok{";}
\StringTok{            \}}
\StringTok{        if(NA!=1)}
\StringTok{            \{}
\StringTok{            printf "\textless{}/br\textgreater{}source\_uniq\_fp:\textless{}/br\textgreater{}";}
\StringTok{            \textbackslash{}}
\StringTok{            for(x=a; x\textless{}b; x++)}
\StringTok{                \{}
\StringTok{                printf "\textless{}a href=+frags\_figures|" $x ".svg+target=+\_blank+\textgreater{}" $x "\textless{}/a\textgreater{} ";}
\StringTok{                \}}
\StringTok{            printf "\textless{}/br\textgreater{}target\_uniq\_fp:\textless{}/br\textgreater{}";}
\StringTok{            \textbackslash{}}
\StringTok{            for(y=c; y\textless{}=NF; y++)}
\StringTok{                \{}
\StringTok{                if(y!=NF)}
\StringTok{                    \{}
\StringTok{                    printf "\textless{}a href=+frags\_figures|" $y ".svg+target=+\_blank+\textgreater{}" $y "\textless{}/a\textgreater{} ";}
\StringTok{                    \}}
\StringTok{                else}
\StringTok{                    \{}
\StringTok{                    printf "\textless{}a href=+frags\_figures|" $y ".svg+target=+\_blank+\textgreater{}" $y "\textless{}/a\textgreater{}}\SpecialCharTok{\textbackslash{}n}\StringTok{";}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$data"}\NormalTok{) }\SpecialCharTok{|}\NormalTok{ sed }\SpecialCharTok{{-}}\NormalTok{e }\StringTok{\textquotesingle{}s/|/\textbackslash{}//g;s/+/}\SpecialCharTok{\textbackslash{}"}\StringTok{/g;$d\textquotesingle{}} \SpecialCharTok{\textgreater{}}\NormalTok{ r\_network}\SpecialCharTok{/}\NormalTok{edges.tsv}
\DocumentationTok{\#\#\#\textless{}a href="test.txt"target="\_blank"\textgreater{}点击打开本地文件\textless{}/a\textgreater{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\DocumentationTok{\#\#\#to create nodes(table)}
\CommentTok{\#sort sample}
\NormalTok{mzmine\_path}\OtherTok{=}\StringTok{"../neg.csv"}
\NormalTok{version}\OtherTok{=}\ErrorTok{$}\NormalTok{(echo }\SpecialCharTok{|}\NormalTok{ awk }\StringTok{\textquotesingle{}\{l=asort(a,b);print l\}\textquotesingle{}}\NormalTok{)}
    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{$}\NormalTok{version }\SpecialCharTok{==} \DecValTok{0}\NormalTok{ ]}
\NormalTok{    then}
\NormalTok{    mzmine\_data}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F , }\StringTok{\textquotesingle{}}
\StringTok{        \{}
\StringTok{        if(NR==1)}
\StringTok{            \{}
\StringTok{            for(i=4; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                col\_sample[$i]=i}
\StringTok{                \}}
\StringTok{            l=asorti(col\_sample,b)}
\StringTok{            \textbackslash{}}
\StringTok{            printf $1 "}\SpecialCharTok{\textbackslash{}t}\StringTok{" $2 "}\SpecialCharTok{\textbackslash{}t}\StringTok{" $3 "}\SpecialCharTok{\textbackslash{}t}\StringTok{"}
\StringTok{            \textbackslash{}}
\StringTok{            for(i=1; i\textless{}l; i++)}
\StringTok{                \{}
\StringTok{                printf b[i] "}\SpecialCharTok{\textbackslash{}t}\StringTok{"}
\StringTok{                \}}
\StringTok{            printf b[l] "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{            \}}
\StringTok{        if(NR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            printf $1"}\SpecialCharTok{\textbackslash{}t}\StringTok{" $2"}\SpecialCharTok{\textbackslash{}t}\StringTok{" $3"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}
\StringTok{            \textbackslash{}}
\StringTok{            for(i=1; i\textless{}l; i++)}
\StringTok{                \{}
\StringTok{                printf $col\_sample[b[i]] "}\SpecialCharTok{\textbackslash{}t}\StringTok{"}
\StringTok{                \}}
\StringTok{            printf $col\_sample[b[l]] "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{mzmine\_path)}
\NormalTok{    echo }\StringTok{"$mzmine\_data"} \SpecialCharTok{\textgreater{}}\NormalTok{ r\_network}\SpecialCharTok{/}\NormalTok{mzmine\_table.tsv}
\NormalTok{    fi;}
\NormalTok{mzmine}\OtherTok{=}\StringTok{"r\_network/mzmine\_table.tsv"}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==1)}
\StringTok{        \{}
\StringTok{        printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{label}\SpecialCharTok{\textbackslash{}t}\StringTok{group}\SpecialCharTok{\textbackslash{}t}\StringTok{value}\SpecialCharTok{\textbackslash{}t}\StringTok{shape}\SpecialCharTok{\textbackslash{}t}\StringTok{image}\SpecialCharTok{\textbackslash{}t}\StringTok{shadow}\SpecialCharTok{\textbackslash{}t}\StringTok{title}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        norm=sprintf("\%.4f",$2);}
\StringTok{        \textbackslash{}}
\StringTok{        normrt=sprintf("\%.2f",$3);}
\StringTok{        \textbackslash{}}
\StringTok{        printf $1"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  norm  "}\SpecialCharTok{\textbackslash{}t}\StringTok{NA"  "}\SpecialCharTok{\textbackslash{}t}\StringTok{5"  "}\SpecialCharTok{\textbackslash{}t}\StringTok{image"  "}\SpecialCharTok{\textbackslash{}t}\StringTok{nodes\_figures|"$1".svg}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "FALSE}\SpecialCharTok{\textbackslash{}t}\StringTok{"\textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        "\textless{}b\textgreater{}ID:"$1"\textless{}/b\textgreater{}" "\textless{}/br\textgreater{}" "m/z:"norm "\textless{}/br\textgreater{}" "RT(min):"normrt "\textless{}/br\textgreater{}"\textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        "\textless{}a href=+ms2\_figures|"$1".svg+target=+\_blank+\textgreater{}See\_MS2\_spectra\textless{}/a\textgreater{}" "\textless{}/br\textgreater{}"\textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        "\textless{}a href=+structure\_svg|"$1".svg+target=+\_blank+\textgreater{}See\_Structure\_svg\textless{}/a\textgreater{}" "\textless{}/br\textgreater{}"\textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        "\textless{}a href=+annonation|"$1"+target=+\_blank+\textgreater{}See\_annonation\textless{}/a\textgreater{}"\textbackslash{}}
\StringTok{        \textbackslash{}}
\StringTok{        "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{mzmine }\SpecialCharTok{|}\NormalTok{ sed }\SpecialCharTok{{-}}\NormalTok{e }\StringTok{\textquotesingle{}s/|/\textbackslash{}//g;s/+/}\SpecialCharTok{\textbackslash{}"}\StringTok{/g;$d\textquotesingle{}} \SpecialCharTok{\textgreater{}}\NormalTok{ r\_network}\SpecialCharTok{/}\NormalTok{nodes.tsv}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#tooltips\#\textless{}a href="test.txt"target="\_blank"\textgreater{}点击打开本地文件\textless{}/a\textgreater{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\DocumentationTok{\#\#\#to create ms2 figure(table)}
\NormalTok{data1}\OtherTok{=}\StringTok{"temp/Mo\_filename"}
\NormalTok{data2}\OtherTok{=}\StringTok{"*\_*/spectrum.ms"}
\NormalTok{data3}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(system("test {-}f " $2 "/spectra/" $1 "*.tsv"))}
\StringTok{        \{}
\StringTok{        printf ""}
\StringTok{        \}}
\StringTok{    else}
\StringTok{        \{}
\StringTok{        printf $2 "/spectra/" $1 "*.tsv "}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1)}
\CommentTok{\# to   r\_network/ms2\_figures/\textless{}id\textgreater{}\_\textless{}formula\textgreater{}.tsv}
\NormalTok{mkdir results}\SpecialCharTok{/}\NormalTok{ms2\_figures}
\NormalTok{savepath}\OtherTok{=}\StringTok{"results/ms2\_figures/"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F [}\StringTok{"}\SpecialCharTok{\textbackslash{}t}\StringTok{"" "}\NormalTok{] }\StringTok{\textquotesingle{}}
\StringTok{    BEGIN\{}
\StringTok{        file\_number=0}
\StringTok{        \}}
\StringTok{    \{}
\StringTok{    if(FNR==1)}
\StringTok{        \{}
\StringTok{        if(FILENAME!=p\_filename)}
\StringTok{            \{}
\StringTok{            file\_number+=1}
\StringTok{            \}}
\StringTok{        if(file\_number\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            close(p\_filename)}
\StringTok{            \}}
\StringTok{        p\_filename=FILENAME}
\StringTok{        \textbackslash{}}
\StringTok{        if((FILENAME\textasciitilde{}/spectrum.ms/))}
\StringTok{            \{}
\StringTok{            step=2}
\StringTok{            \}}
\StringTok{        else if((FILENAME\textasciitilde{}/spectra/))}
\StringTok{            \{}
\StringTok{            step=3}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        formu[FNR]=$1}
\StringTok{        \textbackslash{}}
\StringTok{        file[FNR]=$2}
\StringTok{        \textbackslash{}}
\StringTok{        n=split($2,a,"[\_]")}
\StringTok{        \textbackslash{}}
\StringTok{        id[FNR]=a[n]}
\StringTok{        \textbackslash{}}
\StringTok{        rows\_data1=FNR}
\StringTok{        \}}
\StringTok{    else if(step==2)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            the\_id=$2}
\StringTok{            start=0}
\StringTok{            \}}
\StringTok{        if(($1\textasciitilde{}/ms2peaks/))}
\StringTok{            \{}
\StringTok{            start=FNR}
\StringTok{            \}}
\StringTok{        if(start!=0)}
\StringTok{            \{}
\StringTok{            n\_ms2=FNR{-}start}
\StringTok{            \textbackslash{}}
\StringTok{            msms[the\_id,"mz",n\_ms2]=$1}
\StringTok{            \textbackslash{}}
\StringTok{            msms[the\_id,"inten",n\_ms2]=$2}
\StringTok{            \textbackslash{}}
\StringTok{            if(max\_n=="" || max\_n\textless{}n\_ms2)}
\StringTok{                \{}
\StringTok{                max\_n=n\_ms2}
\StringTok{                \}}
\StringTok{            if(max\_inten[the\_id]=="" || max\_inten[the\_id]\textless{}$2)}
\StringTok{                \{}
\StringTok{                max\_inten[the\_id]=$2}
\StringTok{                \}}
\StringTok{            \}   }
\StringTok{        \}}
\StringTok{    else if(step==3)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            if(step3\_pro\textgreater{}=2)}
\StringTok{                \{}
\StringTok{                close("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"  the\_id  ".tsv")}
\StringTok{                \}}
\StringTok{            for(i=1; i\textless{}=rows\_data1; i++)}
\StringTok{                \{}
\StringTok{                if((FILENAME \textasciitilde{} file[i]) \&\& (FILENAME \textasciitilde{} formu[i]))}
\StringTok{                    \{}
\StringTok{                    the\_id=id[i]}
\StringTok{                    \textbackslash{}}
\StringTok{                    formula=formu[i]}
\StringTok{                    \textbackslash{}}
\StringTok{                    break}
\StringTok{                    \}}
\StringTok{                else x=n+1}
\StringTok{                \}}
\StringTok{            if(x==rows\_data1+1)}
\StringTok{                \{}
\StringTok{                nextfile}
\StringTok{                \}}
\StringTok{            step3\_pro+=1}
\StringTok{            \textbackslash{}}
\StringTok{            if(step3\_pro==1)}
\StringTok{                \{}
\StringTok{                FS="[}\SpecialCharTok{\textbackslash{}t}\StringTok{]"}
\StringTok{                if(FNR==1)}
\StringTok{                    \{}
\StringTok{                    for(i=1; i\textless{}=NF; i++)}
\StringTok{                        \{}
\StringTok{                        if(($i\textasciitilde{}/mz/))}
\StringTok{                            \{}
\StringTok{                            col\_mz=i}
\StringTok{                            \}}
\StringTok{                        if(($i\textasciitilde{}/rel/))}
\StringTok{                            \{}
\StringTok{                            col\_rel=i}
\StringTok{                            \}}
\StringTok{                        if($i\textasciitilde{}/formula/)}
\StringTok{                            \{}
\StringTok{                            col\_formula=i}
\StringTok{                            \}}
\StringTok{                        if($i\textasciitilde{}/ionization/)}
\StringTok{                            \{}
\StringTok{                            col\_ion=i}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            printf "mz}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "rel.intensity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "formula}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "ionization}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"  the\_id  ".tsv"}
\StringTok{            \textbackslash{}}
\StringTok{            for(j=1; j\textless{}=max\_n; j++)}
\StringTok{                \{}
\StringTok{                if(msms[the\_id,"mz",j]!="")}
\StringTok{                    \{}
\StringTok{                    printf msms[the\_id,"mz",j]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                    \textbackslash{}}
\StringTok{                    (msms[the\_id,"inten",j]/max\_inten[the\_id])*100 "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"  the\_id  ".tsv"}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            norm=$col\_rel*({-}1)}
\StringTok{            \textbackslash{}}
\StringTok{            printf $col\_mz"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  norm"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $col\_formula"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $col\_ion"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"  the\_id  ".tsv"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\CommentTok{\#create match point}
\NormalTok{mkdir results}\SpecialCharTok{/}\NormalTok{ms2\_figures\_match}
\NormalTok{data}\OtherTok{=}\StringTok{"results/ms2\_figures/*.tsv"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"results/ms2\_figures\_match/"}
\NormalTok{mz\_tolerance}\OtherTok{=}\StringTok{"0.01"}
\NormalTok{in\_tolerance}\OtherTok{=}\StringTok{"20"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(FNR==1)}
\StringTok{        \{}
\StringTok{        file\_num+=1}
\StringTok{        n=split(FILENAME,a,"[/]")}
\StringTok{        split(a[n],b,"[.]")}
\StringTok{        id=b[1]}
\StringTok{        if(file\_num==1)}
\StringTok{            \{}
\StringTok{            p\_id=id}
\StringTok{            p\_file=FILENAME}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/mz/)}
\StringTok{                    \{}
\StringTok{                    col\_mz=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/intensity/)}
\StringTok{                    \{}
\StringTok{                    col\_intensity=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/formula/)}
\StringTok{                    \{}
\StringTok{                    col\_formula=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/ionization/)}
\StringTok{                    \{}
\StringTok{                    col\_ion=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(file\_num\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            close(p\_file)}
\StringTok{            for(i in neg\_mz)}
\StringTok{                \{}
\StringTok{                for(j in pos\_mz)}
\StringTok{                    \{}
\StringTok{                    if(neg\_mz[i]\textgreater{}=pos\_mz[j]{-}"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{mz\_tolerance}\StringTok{\textquotesingle{}" \&\& neg\_mz[i]\textless{}=pos\_mz[j]+"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{mz\_tolerance}\StringTok{\textquotesingle{}")}
\StringTok{                        \{}
\StringTok{                        if(({-}1)*neg\_in[i]\textgreater{}=pos\_in[j]{-}"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{in\_tolerance}\StringTok{\textquotesingle{}" \&\& ({-}1)*neg\_in[i]\textless{}=pos\_in[j]+"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{in\_tolerance}\StringTok{\textquotesingle{}")}
\StringTok{                            \{}
\StringTok{                            match\_p[i]+=1}
\StringTok{                            match\_p[j]+=1}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            delete neg\_mz}
\StringTok{            delete pos\_mz}
\StringTok{            printf "mz}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "rel.intensity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "match}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "formula}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "ionization}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" p\_id ".tsv"}
\StringTok{            for(i=2; i\textless{}=max\_FNR[p\_file]; i++)}
\StringTok{                \{}
\StringTok{                if(match\_p[p\_file,i]=="")}
\StringTok{                    \{}
\StringTok{                    match\_p[p\_file,i]=0}
\StringTok{                    \}}
\StringTok{                printf mz[p\_file,i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" intensity[p\_file,i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" match\_p[p\_file,i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" formula[p\_file,i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" ion[p\_file,i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" p\_id ".tsv"}
\StringTok{                \}}
\StringTok{            if(p\_id==2664)}
\StringTok{                \{}
\StringTok{                printf file\_num"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{                \}}
\StringTok{            close("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" p\_id ".tsv")}
\StringTok{            p\_id=id}
\StringTok{            p\_file=FILENAME}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        max\_FNR[FILENAME]=FNR}
\StringTok{        mz[FILENAME,FNR]=$col\_mz}
\StringTok{        intensity[FILENAME,FNR]=$col\_intensity}
\StringTok{        formula[FILENAME,FNR]=$col\_formula}
\StringTok{        ion[FILENAME,FNR]=$col\_ion}
\StringTok{        if($col\_intensity\textgreater{}0)}
\StringTok{            \{}
\StringTok{            pos\_mz[FILENAME,FNR]=$col\_mz}
\StringTok{            pos\_in[FILENAME,FNR]=$col\_intensity}
\StringTok{            \}}
\StringTok{        else}
\StringTok{            \{}
\StringTok{            neg\_mz[FILENAME,FNR]=$col\_mz}
\StringTok{            neg\_in[FILENAME,FNR]=$col\_intensity}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        for(i in neg\_mz)}
\StringTok{            \{}
\StringTok{            for(j in pos\_mz)}
\StringTok{                \{}
\StringTok{                if(neg\_mz[i]\textgreater{}=pos\_mz[j]{-}"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{mz\_tolerance}\StringTok{\textquotesingle{}" \&\& neg\_mz[i]\textless{}=pos\_mz[j]+"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{mz\_tolerance}\StringTok{\textquotesingle{}")}
\StringTok{                    \{}
\StringTok{                    if(({-}1)*neg\_in[i]\textgreater{}=pos\_in[j]{-}"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{in\_tolerance}\StringTok{\textquotesingle{}" \&\& ({-}1)*neg\_in[i]\textless{}=pos\_in[j]+"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{in\_tolerance}\StringTok{\textquotesingle{}")}
\StringTok{                        \{}
\StringTok{                        match\_p[i]+=1}
\StringTok{                        match\_p[j]+=1}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        delete neg\_mz}
\StringTok{        delete pos\_mz}
\StringTok{        printf "mz}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "rel.intensity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "match}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "formula}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "ionization}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" p\_id ".tsv"}
\StringTok{        for(i=2; i\textless{}=max\_FNR[p\_file]; i++)}
\StringTok{            \{}
\StringTok{            if(match\_p[p\_file,i]=="")}
\StringTok{                \{}
\StringTok{                match\_p[p\_file,i]=0}
\StringTok{                \}}
\StringTok{            printf mz[p\_file,i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" intensity[p\_file,i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" match\_p[p\_file,i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" formula[p\_file,i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" ion[p\_file,i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textbackslash{}}
\StringTok{            \textbackslash{}}
\StringTok{            \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" p\_id ".tsv"}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#Supplementary label and annonate}
\NormalTok{mkdir results}\SpecialCharTok{/}\NormalTok{ms2\_figures\_label}
\NormalTok{data1}\OtherTok{=}\StringTok{"results/re\_neg\_RT.tsv"}
\NormalTok{data2}\OtherTok{=}\StringTok{"results/fingerid\_first\_score.tsv"}
\NormalTok{data3}\OtherTok{=}\StringTok{"results/ms2\_figures\_match/*.tsv"}
\NormalTok{savepath}\OtherTok{=}\StringTok{"results/ms2\_figures\_label/"}
\NormalTok{distance}\OtherTok{=}\StringTok{"10"}
\NormalTok{plus}\OtherTok{=}\StringTok{"5"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    BEGIN\{}
\StringTok{        srand()}
\StringTok{        \}}
\StringTok{    \{}
\StringTok{    if(FILENAME\textasciitilde{}/re\_neg\_RT/)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/ID/)}
\StringTok{                    \{}
\StringTok{                    col\_id=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/retention/)}
\StringTok{                    \{}
\StringTok{                    col\_rt=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/m\textbackslash{}/z/)}
\StringTok{                    \{}
\StringTok{                    col\_mz=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            p\_file=FILENAME}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            precursor[$col\_id]=$col\_mz}
\StringTok{            rt[$col\_id]=$col\_rt}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FILENAME\textasciitilde{}/fingerid/)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if($i\textasciitilde{}/\^{}id/)}
\StringTok{                    \{}
\StringTok{                    col\_id=i}
\StringTok{                    \}}
\StringTok{                if($i\textasciitilde{}/similarity/)}
\StringTok{                    \{}
\StringTok{                    col\_similarity=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            p\_file=FILENAME}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            similarity[$col\_id]=$col\_similarity}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FILENAME\textasciitilde{}/ms2\_figures/)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            close(p\_file)}
\StringTok{            file\_num+=1}
\StringTok{            p\_file=FILENAME}
\StringTok{            n=split(FILENAME,a,"[/]")}
\StringTok{            split(a[n],b,"[.]")}
\StringTok{            id=b[1]}
\StringTok{            printf $0"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "y\_label}\SpecialCharTok{\textbackslash{}t}\StringTok{" "precursor m/z}\SpecialCharTok{\textbackslash{}t}\StringTok{" "RT (min)}\SpecialCharTok{\textbackslash{}t}\StringTok{" "similarity}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textbackslash{}}
\StringTok{            \textbackslash{}}
\StringTok{            \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"a[n]}
\StringTok{            if(file\_num==1)}
\StringTok{                \{}
\StringTok{                for(i=1; i\textless{}=NF; i++)}
\StringTok{                    \{}
\StringTok{                    if($i\textasciitilde{}/mz/)}
\StringTok{                        \{}
\StringTok{                        col\_mz=i}
\StringTok{                        \}}
\StringTok{                    if($i\textasciitilde{}/intensity/)}
\StringTok{                        \{}
\StringTok{                        col\_intensity=i}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            printf $0"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"a[n]}
\StringTok{            mz[FNR]=$col\_mz}
\StringTok{            intensity[FNR]=$col\_intensity}
\StringTok{            if(intensity[FNR]\textgreater{}0)}
\StringTok{                \{}
\StringTok{                y\_label[FNR]=intensity[FNR]+"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{distance}\StringTok{\textquotesingle{}"}
\StringTok{                \}}
\StringTok{            else}
\StringTok{                \{}
\StringTok{                y\_label[FNR]=intensity[FNR]{-}"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{distance}\StringTok{\textquotesingle{}"}
\StringTok{                \}}
\StringTok{            for(i=2; i\textgreater{}=1; i{-}{-})}
\StringTok{                \{}
\StringTok{                if(mz[FNR{-}i]!="")}
\StringTok{                    \{}
\StringTok{                    distance=((mz[FNR]{-}mz[FNR{-}i])\^{}2+(intensity[FNR]{-}intensity[FNR{-}i])\^{}2)\^{}(1/2)}
\StringTok{                    if(distance\textless{}"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{distance}\StringTok{\textquotesingle{}"*(1/(2*i)))}
\StringTok{                        \{}
\StringTok{                        if(y\_label[FNR]\textgreater{}0)}
\StringTok{                            \{}
\StringTok{                            \# y\_label[FNR]+=("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plus}\StringTok{\textquotesingle{}"+int(16*rand()+16*rand()))}
\StringTok{                            y\_label[FNR]=0}
\StringTok{                            \}}
\StringTok{                        else}
\StringTok{                            \{}
\StringTok{                            \# y\_label[FNR]{-}=("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plus}\StringTok{\textquotesingle{}"+int(16*rand()+16*rand()))}
\StringTok{                            y\_label[FNR]=0}
\StringTok{                            \}}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            printf y\_label[FNR] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"a[n]}
\StringTok{            if(FNR==2)}
\StringTok{                \{}
\StringTok{                printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"sprintf("\%.4f",precursor[id])"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  sprintf("\%.2f",rt[id])"}\SpecialCharTok{\textbackslash{}t}\StringTok{" sprintf("\%.2f",similarity[id]) \textbackslash{}}
\StringTok{                \textbackslash{}}
\StringTok{                \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"a[n]}
\StringTok{                \}}
\StringTok{            printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"a[n]}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\CommentTok{\#plot the map ms2\_figures}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\DocumentationTok{\#\#\#table\_for\_R\_paint}
    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f results}\SpecialCharTok{/}\NormalTok{select\_canopus\_filter\_step3.tsv ]}
\NormalTok{    then }
\NormalTok{    cp results}\SpecialCharTok{/}\NormalTok{select\_canopus\_filter\_step3.tsv r\_network}\SpecialCharTok{/}\NormalTok{temp}\SpecialCharTok{/}\NormalTok{select}
\NormalTok{    elif [ }\SpecialCharTok{{-}}\NormalTok{f results}\SpecialCharTok{/}\NormalTok{select\_canopus\_filter\_step2.tsv ]}
\NormalTok{    then }
\NormalTok{    cp results}\SpecialCharTok{/}\NormalTok{select\_canopus\_filter\_step2.tsv r\_network}\SpecialCharTok{/}\NormalTok{temp}\SpecialCharTok{/}\NormalTok{select}
    \ControlFlowTok{else} 
\NormalTok{    cp results}\SpecialCharTok{/}\NormalTok{select\_canopus\_filter\_step1.tsv r\_network}\SpecialCharTok{/}\NormalTok{temp}\SpecialCharTok{/}\NormalTok{select}
\NormalTok{    fi;}
\NormalTok{mkdir r\_network}\SpecialCharTok{/}\NormalTok{nodes\_figures}
\NormalTok{data}\OtherTok{=}\StringTok{"r\_network/temp/select"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==1)}
\StringTok{        \{}
\StringTok{        for(i=2; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            class[i]=$i}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        id[NR]=$1;}
\StringTok{        \textbackslash{}}
\StringTok{        N=NR{-}1;}
\StringTok{        \textbackslash{}}
\StringTok{        printf "class}\SpecialCharTok{\textbackslash{}t}\StringTok{group}\SpecialCharTok{\textbackslash{}t}\StringTok{posterior\_probability}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "r\_network/nodes\_figures/class\_"$1".tsv"}
\StringTok{        \textbackslash{}}
\StringTok{        for(i=2; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if(i!=NF)}
\StringTok{                \{}
\StringTok{                printf class[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{NA}\SpecialCharTok{\textbackslash{}t}\StringTok{"$i"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "r\_network/nodes\_figures/class\_"$1".tsv"}
\StringTok{                \}}
\StringTok{            else}
\StringTok{                \{}
\StringTok{                printf class[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{NA}\SpecialCharTok{\textbackslash{}t}\StringTok{"$i \textgreater{}\textgreater{} "r\_network/nodes\_figures/class\_"$1".tsv"}
\StringTok{                \textbackslash{}}
\StringTok{                if(NR\textgreater{}=3)}
\StringTok{                    \{}
\StringTok{                    close("r\_network/nodes\_figures/class\_"id[N]".tsv")}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#features area to file.}
\NormalTok{mzmine}\OtherTok{=}\StringTok{"r\_network/mzmine\_table.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==1)}
\StringTok{        \{}
\StringTok{        for(i=1;i\textless{}=NF;i++)}
\StringTok{            \{}
\StringTok{            sample[i]=$i}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        id[NR]=$1;}
\StringTok{        \textbackslash{}}
\StringTok{        printf "number}\SpecialCharTok{\textbackslash{}t}\StringTok{sample}\SpecialCharTok{\textbackslash{}t}\StringTok{area}\SpecialCharTok{\textbackslash{}t}\StringTok{log10\_area}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "r\_network/nodes\_figures/area\_"$1".tsv"}
\StringTok{        \textbackslash{}}
\StringTok{        N=NR{-}1}
\StringTok{        \textbackslash{}}
\StringTok{        for(i=4;i\textless{}=NF;i++)}
\StringTok{            \{}
\StringTok{            n=i{-}3;}
\StringTok{            if($i!=0)}
\StringTok{                \{}
\StringTok{                norm=sprintf("\%.2f",log($i)/log(10))}
\StringTok{                \}}
\StringTok{            else}
\StringTok{                \{}
\StringTok{                norm=0}
\StringTok{                \};}
\StringTok{            if(i!=NF)}
\StringTok{                \{}
\StringTok{                printf n"}\SpecialCharTok{\textbackslash{}t}\StringTok{"sample[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"$i"}\SpecialCharTok{\textbackslash{}t}\StringTok{"norm"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "r\_network/nodes\_figures/area\_"$1".tsv"}
\StringTok{                \}}
\StringTok{            else}
\StringTok{                \{}
\StringTok{                printf n"}\SpecialCharTok{\textbackslash{}t}\StringTok{"sample[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"$i"}\SpecialCharTok{\textbackslash{}t}\StringTok{"norm \textgreater{}\textgreater{} "r\_network/nodes\_figures/area\_"$1".tsv"}
\StringTok{                if(NR\textgreater{}=3)}
\StringTok{                    \{}
\StringTok{                    close("r\_network/nodes\_figures/area\_"id[N]".tsv")}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{mzmine}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{pr}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v }\AttributeTok{OFS=}\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        class="r\_network/nodes\_figures/class\_"$1".tsv"}
\StringTok{        \textbackslash{}}
\StringTok{        area="r\_network/nodes\_figures/area\_"$1".tsv"}
\StringTok{        \textbackslash{}}
\StringTok{        if(system("test {-}f " class))}
\StringTok{            \{}
\StringTok{            c=0}
\StringTok{            \}}
\StringTok{        else}
\StringTok{            \{}
\StringTok{            c=1}
\StringTok{            \}}
\StringTok{        if(system("test {-}f " area))}
\StringTok{            \{}
\StringTok{            a=0}
\StringTok{            \}}
\StringTok{        else}
\StringTok{            \{}
\StringTok{            a=1}
\StringTok{            \}}
\StringTok{        printf $1  "\_"  c  "\_"  a  "@"}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{mzmine)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#R nodes image class;area}
\NormalTok{script}\OtherTok{=}\ErrorTok{$}\NormalTok{(echo }\StringTok{\textquotesingle{}}
\StringTok{    setwd("r\_network/nodes\_figures")}
\StringTok{    args\textless{}{-}commandArgs(TRUE)}
\StringTok{    \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\StringTok{    if ( "tidyverse" \%in\% rownames(installed.packages())==FALSE)}
\StringTok{    \{}
\StringTok{    install.packages("tidyverse")}
\StringTok{    \}}
\StringTok{    library(tidyverse)}
\StringTok{    library(grid)}
\StringTok{    n=args[1]}
\StringTok{    seq \textless{}{-} as.character(unlist(strsplit(n, split="@")))}
\StringTok{        \#\#\#\#\#\#\#\#\#\#\#\#\#}
\StringTok{    for(sum in seq)}
\StringTok{        \{}
\StringTok{        sp=as.character(unlist(strsplit(sum, split="\_")))}
\StringTok{        id=sp[1]}
\StringTok{        checkfile=sp[2]}
\StringTok{        checkfile2=sp[3]}
\StringTok{        file=paste0("class\_",id,".tsv")}
\StringTok{        file2=paste0("area\_",id,".tsv")}
\StringTok{        savename=paste0(id,".svg")}
\StringTok{        \#\#\#\#\#\#\#\#\#\#}
\StringTok{        if(checkfile==1)}
\StringTok{            \{}
\StringTok{            data \textless{}{-} read.csv(file=file,header=T,sep="}\SpecialCharTok{\textbackslash{}t}\StringTok{")}
\StringTok{            data \textless{}{-} data \%\textgreater{}\% gather(key = "observation", value="value", {-}c(1,2)) }
\StringTok{            nObsType \textless{}{-} nlevels(as.factor(data$observation))}
\StringTok{            data \textless{}{-} data \%\textgreater{}\% arrange(group, class)}
\StringTok{            data$id \textless{}{-} rep( seq(1, nrow(data)/nObsType), each=nObsType)}
\StringTok{            label\_data \textless{}{-} data \%\textgreater{}\% group\_by(id, class) \%\textgreater{}\% summarize(tot=sum(value))}
\StringTok{            number\_of\_bar \textless{}{-} nrow(label\_data)}
\StringTok{            angle \textless{}{-} 90 {-} 360 * (label\_data$id{-}0.5) /number\_of\_bar}
\StringTok{            label\_data$hjust \textless{}{-} ifelse( angle \textless{} {-}90, 1, 0)}
\StringTok{            label\_data$angle \textless{}{-} ifelse(angle \textless{} {-}90, angle+180, angle)}
\StringTok{            p \textless{}{-} }
\StringTok{             ggplot(data) +}
\StringTok{             geom\_bar(aes(x=as.factor(id), y=value, fill=observation), }
\StringTok{                      stat="identity", alpha=0.5}
\StringTok{                      ) +}
\StringTok{             scale\_fill\_brewer(palette = "Paired") +}
\StringTok{             ylim({-}1,1) +}
\StringTok{             theme\_minimal() +}
\StringTok{             theme(}
\StringTok{                       axis.text = element\_blank(),}
\StringTok{                       axis.title.y = element\_blank(),}
\StringTok{                       panel.grid = element\_blank(),}
\StringTok{                       legend.position = "none",}
\StringTok{                  ) +}
\StringTok{            labs(x = "", y = "")+}
\StringTok{            guides(fill=guide\_legend(title=NULL)) +}
\StringTok{            coord\_polar() +}
\StringTok{            geom\_text(data=label\_data, aes(x=id, y=0, label=class, hjust=hjust),}
\StringTok{                      color="black", alpha=0.6, fontface="bold", size=1, angle= label\_data$angle, }
\StringTok{                      inherit.aes = FALSE )}
\StringTok{            \}}
\StringTok{        if(checkfile2==1)}
\StringTok{            \{}
\StringTok{            data \textless{}{-} read.csv(file=file2,header=T,sep="}\SpecialCharTok{\textbackslash{}t}\StringTok{")}
\StringTok{            num \textless{}{-} nrow(data)}
\StringTok{            max \textless{}{-} 10}
\StringTok{            l \textless{}{-} ggplot(data, aes(x = number+2*num, y = log10\_area, fill = sample)) + }
\StringTok{                 geom\_bar(stat = "identity", position=position\_dodge(0.7), width = 0.5, alpha=0.5) +}
\StringTok{                          scale\_fill\_brewer(palette = "Paired") +}
\StringTok{                 theme\_minimal() +}
\StringTok{                 theme(}
\StringTok{                           axis.text = element\_blank(),}
\StringTok{                           axis.title = element\_blank(),}
\StringTok{                           panel.grid = element\_blank(),}
\StringTok{                           legend.position = "none",}
\StringTok{                      ) +}
\StringTok{                 geom\_text(data=data, aes(x=number+2*num, fontface="bold", y=0, label=sample),}
\StringTok{                           color="black", size=1, alpha=0.5}
\StringTok{                           )+}
\StringTok{                 geom\_text(data=data, aes(x=number+2*num, y=max/2, fontface="bold",}
\StringTok{                           label=log10\_area), color="black", size=1, alpha=0.5}
\StringTok{                           )+}
\StringTok{                 labs(x = "", y = "")+}
\StringTok{                 xlim(0,num*3.43) +}
\StringTok{                 ylim(0,max) +}
\StringTok{                 guides(fill=guide\_legend(title=NULL)) +}
\StringTok{                 coord\_polar(theta = "y")}
\StringTok{            \}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
        \FunctionTok{svg}\NormalTok{(savename)}
        \FunctionTok{grid.newpage}\NormalTok{()}
        \ControlFlowTok{if}\NormalTok{(checkfile}\SpecialCharTok{==}\DecValTok{1}\NormalTok{)}
\NormalTok{            \{}
            \FunctionTok{print}\NormalTok{(p)}
\NormalTok{            \}}
\NormalTok{        vp }\OtherTok{\textless{}{-}} \FunctionTok{viewport}\NormalTok{(}\AttributeTok{x =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{y =} \FloatTok{0.51}\NormalTok{, }\AttributeTok{width =} \FloatTok{0.72}\NormalTok{, }\AttributeTok{height =} \FloatTok{0.72}\NormalTok{)}
        \FunctionTok{pushViewport}\NormalTok{(vp)}
        \ControlFlowTok{if}\NormalTok{(checkfile2}\SpecialCharTok{==}\DecValTok{1}\NormalTok{)}
\NormalTok{            \{}
            \FunctionTok{print}\NormalTok{(l, }\AttributeTok{vp =}\NormalTok{ vp)}
\NormalTok{            \}}
        \FunctionTok{dev.off}\NormalTok{()}
        \ErrorTok{\}}
    \StringTok{\textquotesingle{})}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\# bg = "transparent"}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{Rscript }\SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$script"}\NormalTok{) }\SpecialCharTok{$}\NormalTok{pr}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\DocumentationTok{\#\#\#a rough classification define;}
\NormalTok{data}\OtherTok{=}\StringTok{"results/select\_canopus\_filter\_step3.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}\{}
\StringTok{    if(NR==1)}
\StringTok{        \{}
\StringTok{        m=NR+1;}
\StringTok{        max[m]=0;}
\StringTok{        for(i=2; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            group[i]=$i;}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        id[NR]=$1;}
\StringTok{        for(j=2; j\textless{}=NF; j++)}
\StringTok{            \{}
\StringTok{            if(max[NR]\textless{}$j)}
\StringTok{                \{}
\StringTok{                max[NR]=$j;}
\StringTok{                class\_d[NR]=group[j];}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        m=NR+1;}
\StringTok{        max[m]=0;}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{    for(a=1;a\textless{}=NR;a++)}
\StringTok{        \{}
\StringTok{        if(a==1)}
\StringTok{            \{}
\StringTok{            print "id","class","pp"}
\StringTok{            \};}
\StringTok{        if(a\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            print id[a],class\_d[a],max[a]}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data }\SpecialCharTok{\textgreater{}}\NormalTok{ test.tsv}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{climit}\OtherTok{=}\StringTok{"0.95"}
\NormalTok{numlimit}\OtherTok{=}\StringTok{"0.2"}
\NormalTok{mzmine}\OtherTok{=}\StringTok{"r\_network/mzmine\_table.tsv"}
\NormalTok{data1}\OtherTok{=}\NormalTok{results}\SpecialCharTok{/}\NormalTok{canopus\_pp\_filter.tsv}
\NormalTok{data2}\OtherTok{=}\ErrorTok{$}\NormalTok{(echo }\StringTok{"$mzmine"}\NormalTok{)}
\NormalTok{compar1}\OtherTok{=}\StringTok{"Raw"}
\NormalTok{compar2}\OtherTok{=}\StringTok{"Pro"}
\NormalTok{log}\OtherTok{=}\DecValTok{10}
\NormalTok{log\_to}\OtherTok{=}\DecValTok{2}
\NormalTok{stat}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v }\AttributeTok{OFS=}\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==1)}
\StringTok{        \{}
\StringTok{        for(i=2; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            class[i]=$i}
\StringTok{            num[i]=0}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        for(i=2; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if($i\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{climit}\StringTok{\textquotesingle{})}
\StringTok{                \{}
\StringTok{                num[i]+=1;}
\StringTok{                id[i,NR]=$1;}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{    for(i=2; i\textless{}=NF; i++)}
\StringTok{        \{}
\StringTok{        p=num[i]/(NR{-}1)}
\StringTok{        \textbackslash{}}
\StringTok{        if(p\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{numlimit}\StringTok{\textquotesingle{}) \#}
\StringTok{            \{}
\StringTok{            printf class[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  num[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}
\StringTok{            \textbackslash{}}
\StringTok{            for(j=2; j\textless{}=NR; j++)}
\StringTok{                \{}
\StringTok{                if(id[i,j]!="")}
\StringTok{                    \{}
\StringTok{                    printf id[i,j]"@";}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{|}\NormalTok{ sed }\StringTok{\textquotesingle{}s/@$//g\textquotesingle{}}\NormalTok{)}
\NormalTok{forboxplot}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F [}\StringTok{"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}\SpecialCharTok{@}\NormalTok{] }\SpecialCharTok{{-}}\NormalTok{v }\AttributeTok{OFS=}\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    BEGIN\{}
\StringTok{        maxNF=0}
\StringTok{        rows=0}
\StringTok{        compar1n=0}
\StringTok{        compar2n=0}
\StringTok{        \}}
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        rows+=1}
\StringTok{        if(maxNF\textless{}NF)}
\StringTok{            \{}
\StringTok{            maxNF=NF}
\StringTok{            \}}
\StringTok{        class[FNR]=$1}
\StringTok{        \textbackslash{}}
\StringTok{        num[FNR]=$2}
\StringTok{        \textbackslash{}}
\StringTok{        for(j=3; j\textless{}=NF; j++)}
\StringTok{            \{}
\StringTok{            id[FNR,j]=$j}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    else}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if(($i\textasciitilde{}/\textquotesingle{}}\SpecialCharTok{$}\NormalTok{compar1}\StringTok{\textquotesingle{}/))}
\StringTok{                    \{}
\StringTok{                    colum1[i]=i}
\StringTok{                    compar1n+=1}
\StringTok{                    \}}
\StringTok{                if(($i\textasciitilde{}/\textquotesingle{}}\SpecialCharTok{$}\NormalTok{compar2}\StringTok{\textquotesingle{}/))}
\StringTok{                    \{}
\StringTok{                    colum2[i]=i}
\StringTok{                    compar2n+=1}
\StringTok{                    \}}
\StringTok{                if(($i\textasciitilde{}/retention/))}
\StringTok{                    \{}
\StringTok{                    rtcolum=i}
\StringTok{                    \}}
\StringTok{                if(($i\textasciitilde{}/m\textbackslash{}/z/))}
\StringTok{                    \{}
\StringTok{                    mzcolum=i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            sum[1,$1]=0}
\StringTok{            \textbackslash{}}
\StringTok{            sum[2,$1]=0}
\StringTok{            \textbackslash{}}
\StringTok{            rt[$1]=$rtcolum}
\StringTok{            \textbackslash{}}
\StringTok{            mz[$1]=$mzcolum}
\StringTok{            \textbackslash{}}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                if(i==colum1[i] \&\& colum1[i]!="")}
\StringTok{                    \{}
\StringTok{                    sum[1,$1]+=$i}
\StringTok{                    \}}
\StringTok{                if(i==colum2[i] \&\& colum2[i]!="")}
\StringTok{                    \{}
\StringTok{                    sum[2,$1]+=$i}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        printf "class}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "log\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log}\StringTok{\textquotesingle{}\_delta\_area}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "pro\_to\_raw}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "log\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log\_to}\StringTok{\textquotesingle{}\_pro\_to\_raw}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "variety}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "number}\SpecialCharTok{\textbackslash{}t}\StringTok{";}
\StringTok{        \textbackslash{}}
\StringTok{        printf "rt}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "m/z}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{        \textbackslash{}}
\StringTok{        for(i=1; i\textless{}=rows; i++)}
\StringTok{            \{}
\StringTok{            for(j=3; j\textless{}=maxNF; j++)}
\StringTok{                \{}
\StringTok{                if(id[i,j]!="")}
\StringTok{                    \{}
\StringTok{                    raw=(sum[1,id[i,j]]/compar1n)}
\StringTok{                    \textbackslash{}}
\StringTok{                    pro=(sum[2,id[i,j]]/compar2n)}
\StringTok{                    \textbackslash{}}
\StringTok{                    delta\_area=pro{-}raw}
\StringTok{                    \textbackslash{}}
\StringTok{                    to\_raw=pro/raw}
\StringTok{                    \textbackslash{}}
\StringTok{                    norm\_to\_raw=log(to\_raw)/log(\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log\_to}\StringTok{\textquotesingle{})}
\StringTok{                    \textbackslash{}}
\StringTok{                    if(delta\_area\textgreater{}0)}
\StringTok{                        \{}
\StringTok{                        norm\_delta=log(delta\_area)/log(\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log}\StringTok{\textquotesingle{})}
\StringTok{                        \textbackslash{}}
\StringTok{                        variety="increase"}
\StringTok{                        \}}
\StringTok{                    else if(delta\_area\textless{}0)}
\StringTok{                        \{}
\StringTok{                        norm\_delta={-}1*(log({-}1*delta\_area)/log(\textquotesingle{}}\SpecialCharTok{$}\NormalTok{log}\StringTok{\textquotesingle{}))}
\StringTok{                        \textbackslash{}}
\StringTok{                        variety="decrease"}
\StringTok{                        \}}
\StringTok{                    else}
\StringTok{                        \{}
\StringTok{                        norm\_delta=0}
\StringTok{                        \}}
\StringTok{                    printf class[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  id[i,j]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  norm\_delta"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  to\_raw"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  norm\_to\_raw"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  variety"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  num[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textbackslash{}}
\StringTok{                    \textbackslash{}}
\StringTok{                    rt[id[i,j]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  mz[id[i,j]]"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$stat"}\NormalTok{) }\SpecialCharTok{$}\NormalTok{(echo }\StringTok{"$data2"}\NormalTok{))}
\NormalTok{echo }\StringTok{"$forboxplot"} \SpecialCharTok{\textgreater{}}\NormalTok{ boxplot.tsv}
\CommentTok{\#Rscript    boxplot}
\NormalTok{Rscript}\OtherTok{=}\ErrorTok{$}\NormalTok{(echo }\StringTok{\textquotesingle{}}
\StringTok{library(ggplot2)}
\StringTok{source\textless{}{-}read.table(file="boxplot.tsv",header=T,sep="}\SpecialCharTok{\textbackslash{}t}\StringTok{")}
\StringTok{boxplot\textless{}{-}ggplot(source,aes(x=class,y=log2\_pro\_to\_raw,fill=class))+}
\StringTok{  stat\_boxplot(geom="errorbar",width=0.3)+}
\StringTok{  geom\_boxplot()+}
\StringTok{  geom\_dotplot(binaxis ="y",}
\StringTok{               stackdir="center",}
\StringTok{               position="jitter",}
\StringTok{               stackratio=0.2,}
\StringTok{               dotsize = 0.25)+}
\StringTok{  theme\_minimal() +}
\StringTok{  theme(}
\StringTok{       legend.position="none",}
\StringTok{       axis.text.x = element\_blank(),}
\StringTok{       text = element\_text(size=30),}
\StringTok{       )+}
\StringTok{  geom\_text(data=source, aes(x=class, y={-}4, label=class),}
\StringTok{        color="black", fontface="bold", size=5, angle= 90, }
\StringTok{        inherit.aes = FALSE )+}
\StringTok{  geom\_text(data=source, aes(x=class, y=5, label=number),}
\StringTok{        color="black", fontface="bold", size=5, }
\StringTok{        inherit.aes = FALSE ) + }
\StringTok{  stat\_summary(fun="mean",geom="point",shape=23,size=2.5,fill="grey")}
\StringTok{pdf("boxplot.pdf",width=25,height=15)}
\StringTok{boxplot}
\StringTok{dev.off()}
\StringTok{\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\NormalTok{lignans\_iridoids}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v }\AttributeTok{OFS=}\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==1)}
\StringTok{        \{}
\StringTok{        print "id","rt","m/z","classification","variety","pro/raw"}
\StringTok{        \}}
\StringTok{    if(($1\textasciitilde{}/lignan/) || ($1\textasciitilde{}/ridoid/))}
\StringTok{        \{}
\StringTok{        print $2,$8,$9,$1,$6,$4}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$forboxplot"}\NormalTok{)}
\NormalTok{)}
\NormalTok{data}\OtherTok{=}\NormalTok{results}\SpecialCharTok{/}\NormalTok{fingerid\_first\_score.tsv}
\NormalTok{list}\OtherTok{=}\NormalTok{lignans\_and\_iridoids.tsv}
\NormalTok{com}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    BEGIN\{}
\StringTok{        rows=0}
\StringTok{        \}   }
\StringTok{    \{}
\StringTok{    if(NR==FNR)}
\StringTok{        \{}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            rows+=1}
\StringTok{            \textbackslash{}}
\StringTok{            id[FNR]=$13;}
\StringTok{            \textbackslash{}}
\StringTok{            simi[FNR]=$11}
\StringTok{            \textbackslash{}}
\StringTok{            name[FNR]=$6}
\StringTok{            \textbackslash{}}
\StringTok{            formula[FNR]=$3}
\StringTok{            \textbackslash{}}
\StringTok{            smiles[FNR]=$7}
\StringTok{            \textbackslash{}}
\StringTok{            pubchem[FNR]=$10}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(NR!=FNR)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                printf $i"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}
\StringTok{                \}}
\StringTok{            printf "similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "Name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "Formula}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "Smiles}\SpecialCharTok{\textbackslash{}n}\StringTok{";}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            for(i=1; i\textless{}=NF; i++)}
\StringTok{                \{}
\StringTok{                printf $i"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}
\StringTok{                \}}
\StringTok{            for(j=2;j\textless{}=rows;j++)}
\StringTok{                \{}
\StringTok{                if(id[j]==$1)}
\StringTok{                    \{}
\StringTok{                    printf simi[j]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  name[j]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  formula[j]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  smiles[j]"}\SpecialCharTok{\textbackslash{}n}\StringTok{";}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data }\SpecialCharTok{$}\NormalTok{list)}
\NormalTok{ echo }\StringTok{"$com"} \SpecialCharTok{\textgreater{}}\NormalTok{ com\_lignans\_and\_iridoids.tsv}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-random.sh}{%
\section{File: random.sh}\label{file-random.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{awk }\StringTok{\textquotesingle{}BEGIN\{srand();print int(10*rand())"}\SpecialCharTok{\textbackslash{}t}\StringTok{"int(10*rand())\}\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-search_cid.sh}{%
\section{File: search\_cid.sh}\label{file-search_cid.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{filename}\OtherTok{=}\ErrorTok{$}\NormalTok{(cat list }\SpecialCharTok{|}\NormalTok{ awk }\StringTok{\textquotesingle{}\{name="/media/wizard/back/0703\_all/*\_"$0"/fingerid/*.tsv"; printf name" "\}\textquotesingle{}}\NormalTok{)}

\NormalTok{grep }\StringTok{"445858"} \SpecialCharTok{$}\NormalTok{filename}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-someone_analyses.sh}{%
\section{File: someone\_analyses.sh}\label{file-someone_analyses.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mzmine\_path}\OtherTok{=}\StringTok{"0630neg.csv"}

\NormalTok{savepath}\OtherTok{=}\StringTok{"fecal\_pos\_mzmine.tsv"}

\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F , }\StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==1)}
\StringTok{        \{}
\StringTok{        for(i=4; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            col\_sample[$i]=i}
\StringTok{            \}}
\StringTok{        l=asorti(col\_sample,b)}
\StringTok{        \textbackslash{}}
\StringTok{        printf $1 "}\SpecialCharTok{\textbackslash{}t}\StringTok{" $2 "}\SpecialCharTok{\textbackslash{}t}\StringTok{" $3 "}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        \textbackslash{}}
\StringTok{        for(i=1; i\textless{}l; i++)}
\StringTok{            \{}
\StringTok{            printf b[i] "}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        printf b[l] "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        printf $1"}\SpecialCharTok{\textbackslash{}t}\StringTok{" $2"}\SpecialCharTok{\textbackslash{}t}\StringTok{" $3 "}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        \textbackslash{}}
\StringTok{        for(i=1; i\textless{}l; i++)}
\StringTok{            \{}
\StringTok{            printf $col\_sample[b[i]] "}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        printf $col\_sample[b[l]] "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{mzmine\_path}
    
 \DocumentationTok{\#\#\#\#}
 
\NormalTok{ data}\OtherTok{=}\StringTok{"fecal\_pos\_mzmine.tsv"}

\NormalTok{savepath}\OtherTok{=}\StringTok{"fecal\_pos\_area.tsv"}

\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(FNR==1)}
\StringTok{        \{}
\StringTok{        for(i=1; i\textless{}=NF; i++)}
\StringTok{            \{}
\StringTok{            if($i\textasciitilde{}/ID/)}
\StringTok{                \{}
\StringTok{                col\_id=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/retention/)}
\StringTok{                \{}
\StringTok{                col\_rt=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/m\textbackslash{}/z/)}
\StringTok{                \{}
\StringTok{                col\_mz=i}
\StringTok{                \}}
\StringTok{            if($i\textasciitilde{}/area/)}
\StringTok{                \{}
\StringTok{                split($i,a,"[ ]")}
\StringTok{                }
\StringTok{                num+=1}
\StringTok{                }
\StringTok{                max\_num=num}
\StringTok{                }
\StringTok{                col\_area[num]=i}
\StringTok{                }
\StringTok{                col\_name[num]=a[1]}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        n+=1}
\StringTok{        }
\StringTok{        id\_seq[n]=$col\_id}
\StringTok{        }
\StringTok{        rt[$col\_id]=$col\_rt}
\StringTok{        }
\StringTok{        mz[$col\_mz]=$col\_mz}
\StringTok{        }
\StringTok{        for(i=1; i\textless{}=max\_num; i++)}
\StringTok{            \{}
\StringTok{            area[$col\_id,i]=$col\_area[i]}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        printf "sample" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        }
\StringTok{        for(i=1; i\textless{}=n; i++)}
\StringTok{            \{}
\StringTok{            printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"id\_seq[i] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        }
\StringTok{        for(i=1; i\textless{}=max\_num; i++)}
\StringTok{            \{}
\StringTok{            printf col\_name[i] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            }
\StringTok{            for(j=1; j\textless{}=n; j++)}
\StringTok{                \{}
\StringTok{                printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"area[id\_seq[j],i] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{                \}}
\StringTok{            printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data    }
 
 \DocumentationTok{\#\#\#\#\#\#\#}
    
\NormalTok{data1}\OtherTok{=}\StringTok{"fecal\_pos\_area.tsv"}

\NormalTok{data2}\OtherTok{=}\StringTok{"metadata.tsv"}

\NormalTok{savepath}\OtherTok{=}\StringTok{"re\_metadata.tsv"}

\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(NR==FNR \&\& FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        sort\_sample[FNR]=$1}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}FNR \&\& FNR==1)}
\StringTok{        \{}
\StringTok{        printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        \}}
\StringTok{    if(NR\textgreater{}FNR \&\& FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        split($1,a,"[ ]")}
\StringTok{        }
\StringTok{        name=a[1]}
\StringTok{        }
\StringTok{        data[name]=name"}\SpecialCharTok{\textbackslash{}t}\StringTok{"$2"}\SpecialCharTok{\textbackslash{}t}\StringTok{"$3}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{    END\{}
\StringTok{        for(i=2; i\textless{}=FNR; i++)}
\StringTok{            \{}
\StringTok{            printf data[sort\_sample[i]]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}

\NormalTok{mv }\SpecialCharTok{$}\NormalTok{savepath }\StringTok{"metadata.tsv"} 
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#}

\NormalTok{mkdir re\_pca\_plsda}

        
\NormalTok{        compare1}\OtherTok{=}\StringTok{"pro"}
        
\NormalTok{        compare2}\OtherTok{=}\StringTok{"raw"}
        
\NormalTok{        data1}\OtherTok{=}\StringTok{"fecal\_pos\_area.tsv"}

\NormalTok{        data2}\OtherTok{=}\StringTok{"metadata.tsv"}
        
\NormalTok{        savepath1}\OtherTok{=}\StringTok{"re\_pca\_plsda/$\{compare1\}\_$\{compare2\}\_pca.tsv"}

\NormalTok{        savepath2}\OtherTok{=}\StringTok{"re\_pca\_plsda/metadata\_$\{compare1\}\_$\{compare2\}.tsv"}
        
\NormalTok{        awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{            \{}
\StringTok{            if(FNR==1)}
\StringTok{                \{}
\StringTok{                if(FILENAME=="\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data1}\StringTok{\textquotesingle{}")}
\StringTok{                    \{}
\StringTok{                    print $0 \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath1}\StringTok{\textquotesingle{}"}
\StringTok{                    \}}
\StringTok{                else}
\StringTok{                    \{}
\StringTok{                    print $0 \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath2}\StringTok{\textquotesingle{}"}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            if(FNR\textgreater{}=2)}
\StringTok{                \{}
\StringTok{                if($1\textasciitilde{}/\^{}\textquotesingle{}}\SpecialCharTok{$}\NormalTok{compare1}\StringTok{\textquotesingle{}/)}
\StringTok{                    \{}
\StringTok{                    if(FILENAME=="\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data1}\StringTok{\textquotesingle{}")}
\StringTok{                        \{}
\StringTok{                        print $0 \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath1}\StringTok{\textquotesingle{}"}
\StringTok{                        \}}
\StringTok{                    else}
\StringTok{                        \{}
\StringTok{                        print $0 \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath2}\StringTok{\textquotesingle{}"}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                if($1\textasciitilde{}/\^{}\textquotesingle{}}\SpecialCharTok{$}\NormalTok{compare2}\StringTok{\textquotesingle{}/)}
\StringTok{                    \{}
\StringTok{                    if(FILENAME=="\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data1}\StringTok{\textquotesingle{}")}
\StringTok{                        \{}
\StringTok{                        print $0 \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath1}\StringTok{\textquotesingle{}"}
\StringTok{                        \}}
\StringTok{                    else}
\StringTok{                        \{}
\StringTok{                        print $0 \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath2}\StringTok{\textquotesingle{}"}
\StringTok{                        \}}
\StringTok{                    \}}
\StringTok{                \}}
\StringTok{            \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#            }
                    
\NormalTok{data1}\OtherTok{=}\StringTok{"fecal\_pos\_area.tsv"}

\NormalTok{data2}\OtherTok{=}\StringTok{"metadata.tsv"}

\NormalTok{compare1}\OtherTok{=}\StringTok{"blank"}

\NormalTok{compare2}\OtherTok{=}\StringTok{"std"}

\NormalTok{compare3}\OtherTok{=}\StringTok{"raw"}

\NormalTok{compare4}\OtherTok{=}\StringTok{"pro"}

\CommentTok{\#data1="fecal\_pos\_area.tsv"}

\CommentTok{\#data2="metadata.tsv"}

\NormalTok{savepath1}\OtherTok{=}\StringTok{"re\_pca\_plsda/multi\_pca.tsv"}

\NormalTok{savepath2}\OtherTok{=}\StringTok{"re\_pca\_plsda/metadata\_multi.tsv"}

\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(FNR==1)}
\StringTok{        \{}
\StringTok{        if(FILENAME=="\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data1}\StringTok{\textquotesingle{}")}
\StringTok{            \{}
\StringTok{            print $0 \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath1}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        else}
\StringTok{            \{}
\StringTok{            print $0 \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath2}\StringTok{\textquotesingle{}"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    if(FNR\textgreater{}=2)}
\StringTok{        \{}
\StringTok{        if($1\textasciitilde{}/\^{}\textquotesingle{}}\SpecialCharTok{$}\NormalTok{compare1}\StringTok{\textquotesingle{}/)}
\StringTok{            \{}
\StringTok{            if(FILENAME=="\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data1}\StringTok{\textquotesingle{}")}
\StringTok{                \{}
\StringTok{                print $0 \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath1}\StringTok{\textquotesingle{}"}
\StringTok{                \}}
\StringTok{            else}
\StringTok{                \{}
\StringTok{                print $0 \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath2}\StringTok{\textquotesingle{}"}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if($1\textasciitilde{}/\^{}\textquotesingle{}}\SpecialCharTok{$}\NormalTok{compare2}\StringTok{\textquotesingle{}/)}
\StringTok{            \{}
\StringTok{            if(FILENAME=="\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data1}\StringTok{\textquotesingle{}")}
\StringTok{                \{}
\StringTok{                print $0 \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath1}\StringTok{\textquotesingle{}"}
\StringTok{                \}}
\StringTok{            else}
\StringTok{                \{}
\StringTok{                print $0 \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath2}\StringTok{\textquotesingle{}"}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if($1\textasciitilde{}/\^{}\textquotesingle{}}\SpecialCharTok{$}\NormalTok{compare3}\StringTok{\textquotesingle{}/)}
\StringTok{            \{}
\StringTok{            if(FILENAME=="\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data1}\StringTok{\textquotesingle{}")}
\StringTok{                \{}
\StringTok{                print $0 \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath1}\StringTok{\textquotesingle{}"}
\StringTok{                \}}
\StringTok{            else}
\StringTok{                \{}
\StringTok{                print $0 \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath2}\StringTok{\textquotesingle{}"}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        if($1\textasciitilde{}/\^{}\textquotesingle{}}\SpecialCharTok{$}\NormalTok{compare4}\StringTok{\textquotesingle{}/)}
\StringTok{            \{}
\StringTok{            if(FILENAME=="\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data1}\StringTok{\textquotesingle{}")}
\StringTok{                \{}
\StringTok{                print $0 \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath1}\StringTok{\textquotesingle{}"}
\StringTok{                \}}
\StringTok{            else}
\StringTok{                \{}
\StringTok{                print $0 \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath2}\StringTok{\textquotesingle{}"}
\StringTok{                \}}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
    

\NormalTok{wd}\OtherTok{=}\StringTok{"re\_pca\_plsda"}

\NormalTok{Rscript pca\_ggbiplot.R }\SpecialCharTok{$}\NormalTok{wd}


\NormalTok{wd}\OtherTok{=}\StringTok{"re\_pca\_plsda"}

\NormalTok{Rscript pca\_prcomp.R }\SpecialCharTok{$}\NormalTok{wd}

\NormalTok{mkdir re\_pca\_plsda}\SpecialCharTok{/}\NormalTok{opls\_da}

\NormalTok{data}\OtherTok{=}\StringTok{"re\_pca\_plsda/*.tsv"}

\NormalTok{savepath}\OtherTok{=}\StringTok{"re\_pca\_plsda/opls\_da/"}

\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{    \{}
\StringTok{    if(FNR==1)}
\StringTok{        \{}
\StringTok{        n=split(FILENAME,a,"[/]")}
\StringTok{        }
\StringTok{        file=a[n]}
\StringTok{        \}}
\StringTok{    if(file\textasciitilde{}/multi/)}
\StringTok{        \{}
\StringTok{        nextfile;}
\StringTok{        \}}
\StringTok{    if(file\textasciitilde{}/pca.tsv/ || file\textasciitilde{}/metadata/)}
\StringTok{        \{}
\StringTok{        if(FNR==1)}
\StringTok{            \{}
\StringTok{            printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"file}
\StringTok{            \}}
\StringTok{        if(FNR\textgreater{}=2)}
\StringTok{            \{}
\StringTok{            printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"file}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
    
 \DocumentationTok{\#\#\#\#\#\#\#\#\#}
    
\NormalTok{ wd}\OtherTok{=}\StringTok{"re\_pca\_plsda/opls\_da"}

\NormalTok{ Rscript }\SpecialCharTok{\textasciitilde{}}\ErrorTok{/}\NormalTok{Downloads}\SpecialCharTok{/}\NormalTok{opls\_da.R }\SpecialCharTok{$}\NormalTok{wd  }
\end{Highlighting}
\end{Shaded}

\hypertarget{file-temp.sh}{%
\section{File: temp.sh}\label{file-temp.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# location="\textasciitilde{}/operation/re\_fecal\_neg/kegg"”}
\NormalTok{cd }\SpecialCharTok{\textasciitilde{}}\ErrorTok{/}\NormalTok{operation}\SpecialCharTok{/}\NormalTok{re\_fecal\_neg}\SpecialCharTok{/}\NormalTok{kegg}
\NormalTok{savepath}\OtherTok{=}\StringTok{"cnumber\_cid.tsv"}
\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\StringTok{"[:][ ]"} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if(FNR==1)}
\StringTok{    \{}
\StringTok{      printf "kegg number}\SpecialCharTok{\textbackslash{}t}\StringTok{" "pubchem id" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{    \}}
\StringTok{  if($0\textasciitilde{}/BEGIN\_COMPOUND/)}
\StringTok{    \{}
\StringTok{      getline}
\StringTok{      if($0\textasciitilde{}/C[0{-}9]*/)}
\StringTok{        \{}
\StringTok{          cnum=$0}
\StringTok{          next\_sub=1}
\StringTok{          print "Catch C number: ", $0}
\StringTok{          printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{"cnum \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{        \}}
\StringTok{    else}
\StringTok{      \{}
\StringTok{        next\_sub=0}
\StringTok{        print "Invalid sublist."}
\StringTok{      \}}
\StringTok{    \}}
\StringTok{  if($1\textasciitilde{}/PubChem/ \&\& next\_sub==1)}
\StringTok{    \{}
\StringTok{      printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"$2 \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}}\NormalTok{ dblink.list }
\DocumentationTok{\#\# filter the blank and output the list}
\NormalTok{data}\OtherTok{=}\StringTok{"cnumber\_cid.tsv"}
\NormalTok{nlimit}\OtherTok{=}\DecValTok{100}
\NormalTok{list}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{\{}
\StringTok{  if($1\textasciitilde{}/C[0{-}9]*/)}
\StringTok{    \{}
\StringTok{      if($2=="")}
\StringTok{        \{}
\StringTok{          print "Escape CID of",$1}
\StringTok{        \}}
\StringTok{      if($2!="")}
\StringTok{        \{}
\StringTok{          gsub(/ /,"",$2)}
\StringTok{          if(n\textgreater{}\textquotesingle{}}\SpecialCharTok{$}\NormalTok{nlimit}\StringTok{\textquotesingle{})}
\StringTok{            \{}
\StringTok{              n=0}
\StringTok{              print cid\_set}
\StringTok{            \}}
\StringTok{          n+=1}
\StringTok{          if(n==1)}
\StringTok{            \{}
\StringTok{              cid\_set=$2}
\StringTok{            \}}
\StringTok{        else}
\StringTok{          \{}
\StringTok{            cid\_set=cid\_set","$2}
\StringTok{          \}}
\StringTok{      \}}
\StringTok{  \}}
\StringTok{\}}
\StringTok{END\{}
\StringTok{print cid\_set}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data)}
\DocumentationTok{\#\# nrow}
\NormalTok{nrow}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}END\{print NR\}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$list"}\NormalTok{))}
\DocumentationTok{\#\#}
\ControlFlowTok{for}\NormalTok{ i }\ControlFlowTok{in} \SpecialCharTok{$}\NormalTok{(seq }\SpecialCharTok{$}\NormalTok{nrow)}
\NormalTok{do}
\NormalTok{  cids}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}\{if(NR==\textquotesingle{}}\SpecialCharTok{$}\NormalTok{i}\StringTok{\textquotesingle{})\{print $0\}\}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$list"}\NormalTok{))}
\NormalTok{  check}\OtherTok{=}\ErrorTok{$}\NormalTok{(echo }\StringTok{"$cids"} \SpecialCharTok{|}\NormalTok{ awk }\StringTok{\textquotesingle{}\{if($0\textasciitilde{}/\^{}[0{-}9]/)\{printf 0\}else\{printf 1\}\}\textquotesingle{}}\NormalTok{)}
  \ControlFlowTok{while}\NormalTok{ [ }\SpecialCharTok{$}\NormalTok{check }\SpecialCharTok{==} \DecValTok{0}\NormalTok{ ]}
\NormalTok{  do}
\NormalTok{    echo }\StringTok{"Try catch pubchem API ($\{i\}/$\{nrow\})..."}
    \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{\{i\}\_smiles.csv ]}
\NormalTok{    then}
\NormalTok{      check}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}}
\StringTok{      \{}
\StringTok{        if(FNR==1)}
\StringTok{          \{}
\StringTok{            if($0\textasciitilde{}/CID/)}
\StringTok{              \{}
\StringTok{                printf "1"}
\StringTok{              \}}
\StringTok{          else}
\StringTok{            \{}
\StringTok{              printf "0"}
\StringTok{            \}}
\StringTok{        \}}
\StringTok{    \}}
\StringTok{  END\{}
\StringTok{  if(FNR==0)}
\StringTok{    \{}
\StringTok{      printf "0"}
\StringTok{    \}}
\StringTok{\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{\{i\}\_smiles.csv)}
\NormalTok{    fi;}
\ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{$}\NormalTok{check }\SpecialCharTok{==} \DecValTok{0}\NormalTok{ ]}
\NormalTok{then}
\NormalTok{  curl }\SpecialCharTok{{-}{-}}\NormalTok{connect}\SpecialCharTok{{-}}\NormalTok{timeout }\DecValTok{20} \SpecialCharTok{{-}{-}}\NormalTok{retry }\DecValTok{100} \SpecialCharTok{{-}{-}}\NormalTok{retry}\SpecialCharTok{{-}}\NormalTok{delay }\DecValTok{30}\NormalTok{ https}\SpecialCharTok{:}\ErrorTok{//}\NormalTok{pubchem.ncbi.nlm.nih.gov}\SpecialCharTok{/}\NormalTok{rest}\SpecialCharTok{/}\NormalTok{pug}\SpecialCharTok{/}\NormalTok{compound}\SpecialCharTok{/}\NormalTok{cid}\SpecialCharTok{/}\ErrorTok{$}\NormalTok{\{cids\}}\SpecialCharTok{/}\NormalTok{property}\SpecialCharTok{/}\NormalTok{CanonicalSMILES,IsomericSMILES}\SpecialCharTok{/}\NormalTok{CSV }\SpecialCharTok{\textgreater{}} \ErrorTok{$}\NormalTok{\{i\}\_smiles.csv}
\NormalTok{fi;}
\NormalTok{done;}
\NormalTok{done;}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-test.sh}{%
\section{File: test.sh}\label{file-test.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{commit bffd9d726387529b2e4c629bfcfd71e5821578e8}
\NormalTok{Author}\SpecialCharTok{:}\NormalTok{ yellow}\SpecialCharTok{{-}}\NormalTok{byte }\SpecialCharTok{\textless{}}\DecValTok{84759258}\SpecialCharTok{+}\NormalTok{yellow}\SpecialCharTok{{-}}\NormalTok{byte}\SpecialCharTok{@}\NormalTok{users.noreply.github.com}\SpecialCharTok{\textgreater{}}
\NormalTok{Date}\SpecialCharTok{:}\NormalTok{   Thu Dec }\DecValTok{30} \DecValTok{21}\SpecialCharTok{:}\DecValTok{33}\SpecialCharTok{:}\DecValTok{39} \DecValTok{2021} \SpecialCharTok{+}\DecValTok{0800}

\NormalTok{    Delete MCnebula\_1.}\FloatTok{0.}\NormalTok{sh}

\NormalTok{diff }\SpecialCharTok{{-}{-}}\NormalTok{git a}\SpecialCharTok{/}\NormalTok{MCnebula\_1.}\FloatTok{0.}\NormalTok{sh b}\SpecialCharTok{/}\NormalTok{MCnebula\_1.}\FloatTok{0.}\NormalTok{sh}
\NormalTok{deleted file mode }\DecValTok{100644}
\NormalTok{index 63d2074..}\DecValTok{0000000}
\SpecialCharTok{{-}{-}{-}}\NormalTok{ a}\SpecialCharTok{/}\NormalTok{MCnebula\_1.}\FloatTok{0.}\NormalTok{sh}
\SpecialCharTok{+++} \ErrorTok{/}\NormalTok{dev}\SpecialCharTok{/}\NormalTok{null}
\SpecialCharTok{@}\ErrorTok{@} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{,}\DecValTok{1306} \SpecialCharTok{+}\DecValTok{0}\NormalTok{,}\DecValTok{0} \SpecialCharTok{@}\ErrorTok{@}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\NormalTok{echo }\StringTok{"We are all in the gutter, }
\StringTok{{-}but some of us are looking at the stars."}\NormalTok{;}
\SpecialCharTok{{-}}\NormalTok{PS3}\OtherTok{=}\StringTok{\textquotesingle{}Please select the workflow to be executed. \textgreater{}\textgreater{}\textgreater{} \textquotesingle{}}
\SpecialCharTok{{-}}\NormalTok{select command }\ControlFlowTok{in}\NormalTok{ \textbackslash{}}
\SpecialCharTok{{-}}  \StringTok{"default"}\NormalTok{ \textbackslash{}}
\SpecialCharTok{{-}}  \StringTok{"structure\_extract"}\NormalTok{ \textbackslash{}}
\SpecialCharTok{{-}}  \StringTok{"classification\_extract\_sum"}\NormalTok{ \textbackslash{}}
\SpecialCharTok{{-}}  \StringTok{"classification\_extract\_filter"}\NormalTok{ \textbackslash{}}
\SpecialCharTok{{-}}  \StringTok{"fragment\_tree\_network"}\NormalTok{ \textbackslash{}}
\SpecialCharTok{{-}}  \StringTok{"fragment\_tree\_network\_delta"}\NormalTok{ \textbackslash{}}
\SpecialCharTok{{-}}  \StringTok{"compound\_idenfication"}\NormalTok{ \textbackslash{}}
\SpecialCharTok{{-}}  \StringTok{"double\_ion\_network"}\NormalTok{ \textbackslash{}}
\SpecialCharTok{{-}}  \StringTok{"exit"} 
\SpecialCharTok{{-}}\NormalTok{do}
\SpecialCharTok{{-}}  \ControlFlowTok{if}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{command }\SpecialCharTok{==} \StringTok{"default"}\NormalTok{ ]]}
\SpecialCharTok{{-}}\NormalTok{  then}
\SpecialCharTok{{-}}\NormalTok{    confirm}\OtherTok{=}\DecValTok{0}
\SpecialCharTok{{-}}\NormalTok{    until [[ }\SpecialCharTok{$}\NormalTok{confirm }\SpecialCharTok{==} \StringTok{"yes"}\NormalTok{ ]] }\SpecialCharTok{||}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{confirm }\SpecialCharTok{==} \StringTok{"no"}\NormalTok{ ]]}
\SpecialCharTok{{-}}\NormalTok{    do}
\SpecialCharTok{{-}}\NormalTok{      read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Running all proccesses sequentially? [yes/no] \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ confirm}
\SpecialCharTok{{-}}\NormalTok{    done;}
\SpecialCharTok{{-}}    \ControlFlowTok{if}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{confirm }\SpecialCharTok{==} \StringTok{"no"}\NormalTok{ ]]}
\SpecialCharTok{{-}}\NormalTok{    then exit}
\SpecialCharTok{{-}}\NormalTok{    fi;}
\SpecialCharTok{{-}}\NormalTok{    default}\OtherTok{=}\StringTok{"structure\_extract classification\_extract\_sum classification\_extract\_filter fragment\_tree\_network fragment\_tree\_network\_delta"}
\SpecialCharTok{{-}}\NormalTok{    list}\OtherTok{=}\ErrorTok{$}\NormalTok{(echo }\SpecialCharTok{$}\NormalTok{default);}
\SpecialCharTok{{-}}  \ControlFlowTok{else}\NormalTok{ list}\OtherTok{=}\ErrorTok{$}\NormalTok{( echo }\SpecialCharTok{$}\NormalTok{command)}
\SpecialCharTok{{-}}\NormalTok{  fi;}
\SpecialCharTok{{-}}  \ControlFlowTok{for}\NormalTok{ option }\ControlFlowTok{in} \SpecialCharTok{$}\NormalTok{(echo }\SpecialCharTok{$}\NormalTok{list)}
\SpecialCharTok{{-}}\NormalTok{  do}
\SpecialCharTok{{-}}\NormalTok{    case }\SpecialCharTok{$}\NormalTok{option }\ControlFlowTok{in}
\SpecialCharTok{{-}}      \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}      \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}      \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}      \DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\NormalTok{      structure\_extract}\ErrorTok{)}
\SpecialCharTok{{-}}\NormalTok{      echo }\StringTok{"Run structure\_extract."}
\SpecialCharTok{{-}}\NormalTok{      projectpath}\OtherTok{=}\DecValTok{0}
\SpecialCharTok{{-}}\NormalTok{      until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{canopus\_summary.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\SpecialCharTok{{-}}\NormalTok{      do}
\SpecialCharTok{{-}}\NormalTok{        read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\SpecialCharTok{{-}}\NormalTok{      done;}
\SpecialCharTok{{-}}\NormalTok{      cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\SpecialCharTok{{-}}\NormalTok{      mkdir results;}
\SpecialCharTok{{-}}\NormalTok{      mkdir temp;}
\SpecialCharTok{{-}}\NormalTok{      mkdir temp}\SpecialCharTok{/}\NormalTok{fintemp;}
\SpecialCharTok{{-}}      \ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{Mo\_filename ]}
\SpecialCharTok{{-}}\NormalTok{      then rm temp}\SpecialCharTok{/}\NormalTok{Mo\_filename}
\SpecialCharTok{{-}}\NormalTok{      fi;}
\SpecialCharTok{{-}}\NormalTok{      data}\OtherTok{=}\StringTok{"*\_*/fingerid/*.tsv"}
\SpecialCharTok{{-}}\NormalTok{      awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{{-}      BEGIN\{}
\StringTok{{-}      all\_id=0}
\StringTok{{-}      max\_id={-}1}
\StringTok{{-}      p\_id="null"}
\StringTok{{-}      printf "Info: loading the data..."}
\StringTok{{-}    \}}
\StringTok{{-}  \{}
\StringTok{{-}    if(FNR==1)}
\StringTok{{-}      \{}
\StringTok{{-}        if(NR\textgreater{}FNR)}
\StringTok{{-}          \{}
\StringTok{{-}            close(pfile)}
\StringTok{{-}          \}}
\StringTok{{-}        f=split(FILENAME,a,"[/]");}
\StringTok{{-}        n=split(a[1],b,"[\_]");}
\StringTok{{-}        id=b[n];}
\StringTok{{-}        if(id!=p\_id)}
\StringTok{{-}          \{}
\StringTok{{-}            all\_id+=1}
\StringTok{{-}            if(id\textgreater{}max\_id)}
\StringTok{{-}              \{}
\StringTok{{-}                max\_id=id}
\StringTok{{-}              \}}
\StringTok{{-}          \}}
\StringTok{{-}        file[id]=a[1]}
\StringTok{{-}        split(a[f], g, "[.]")}
\StringTok{{-}        formu\_type[id]=g[1]}
\StringTok{{-}        if(all\_id==1)}
\StringTok{{-}          \{}
\StringTok{{-}            for(i=1; i\textless{}=NF; i++)}
\StringTok{{-}              \{}
\StringTok{{-}                if(($i\textasciitilde{}/inchikey2D/))}
\StringTok{{-}                  \{}
\StringTok{{-}                    col\_2D=i}
\StringTok{{-}                  \}}
\StringTok{{-}                if($i=="inchi")}
\StringTok{{-}                  \{}
\StringTok{{-}                    col\_inchi=i}
\StringTok{{-}                  \}}
\StringTok{{-}                if(($i\textasciitilde{}/Formula/))}
\StringTok{{-}                  \{}
\StringTok{{-}                    col\_formu=i}
\StringTok{{-}                  \}}
\StringTok{{-}                if($i=="score")}
\StringTok{{-}                  \{}
\StringTok{{-}                    col\_score=i}
\StringTok{{-}                  \}}
\StringTok{{-}                if($i=="name")}
\StringTok{{-}                  \{}
\StringTok{{-}                    col\_name=i}
\StringTok{{-}                  \}}
\StringTok{{-}                if($i=="smiles")}
\StringTok{{-}                  \{}
\StringTok{{-}                    col\_smiles=i}
\StringTok{{-}                  \}}
\StringTok{{-}                if($i=="xlogp")}
\StringTok{{-}                  \{}
\StringTok{{-}                    col\_x=i}
\StringTok{{-}                  \}}
\StringTok{{-}                if(($i\textasciitilde{}/imilarity/))}
\StringTok{{-}                  \{}
\StringTok{{-}                    col\_simi=i}
\StringTok{{-}                  \}}
\StringTok{{-}                if($i\textasciitilde{}/links/)}
\StringTok{{-}                  \{}
\StringTok{{-}                    col\_links=i}
\StringTok{{-}                  \}}
\StringTok{{-}              \}}
\StringTok{{-}          \}}
\StringTok{{-}        pfile=FILENAME}
\StringTok{{-}        printf g[1]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"formu\_type[id]"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{{-}        printf "Info: the data of " id " (ID) has input. The filename is " FILENAME ".}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{{-}      \}}
\StringTok{{-}    if(FNR\textgreater{}=2)}
\StringTok{{-}      \{}
\StringTok{{-}        row\_score=$col\_score}
\StringTok{{-}        row\_simi=$col\_simi}
\StringTok{{-}        if(max["score",id]=="" || max["score",id]+0\textless{}row\_score+0)}
\StringTok{{-}          \{}
\StringTok{{-}            max["score",id]=row\_score}
\StringTok{{-}            name["score",id]=$col\_name}
\StringTok{{-}            formula["score",id]=$col\_formu}
\StringTok{{-}            formu\_type["score",id]=formu\_type[id]}
\StringTok{{-}            simi["score",id]=$col\_simi}
\StringTok{{-}            smiles["score",id]=$col\_smiles}
\StringTok{{-}            inchi["score",id]=$col\_inchi}
\StringTok{{-}            in2D["score",id]=$col\_2D}
\StringTok{{-}            score["score",id]=$col\_score}
\StringTok{{-}            xlogp["score",id]=$col\_x}
\StringTok{{-}            links["score",id]=$col\_links}
\StringTok{{-}          \}}
\StringTok{{-}        if(max["simi",id]=="" || max["simi",id]+0\textless{}row\_simi+0)}
\StringTok{{-}          \{}
\StringTok{{-}            max["simi",id]=row\_simi}
\StringTok{{-}            name["simi",id]=$col\_name}
\StringTok{{-}            formula["simi",id]=$col\_formu}
\StringTok{{-}            formu\_type["simi",id]=formu\_type[id]}
\StringTok{{-}            simi["simi",id]=$col\_simi}
\StringTok{{-}            smiles["simi",id]=$col\_smiles}
\StringTok{{-}            inchi["simi",id]=$col\_inchi}
\StringTok{{-}            in2D["simi",id]=$col\_2D}
\StringTok{{-}            score["simi",id]=$col\_score}
\StringTok{{-}            xlogp["simi",id]=$col\_x}
\StringTok{{-}            links["simi",id]=$col\_links}
\StringTok{{-}          \}}
\StringTok{{-}      \}}
\StringTok{{-}  \}}
\StringTok{{-}END\{}
\StringTok{{-}printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "formula}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "smiles}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchi}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchikey2D}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "score}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "xlogp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "links}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/fingerid\_sum.tsv"}
\StringTok{{-}for(l in file)}
\StringTok{{-}  \{}
\StringTok{{-}    if(max["score",l]!="")}
\StringTok{{-}      \{}
\StringTok{{-}        printf l"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  name["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  formula["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  simi["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  smiles["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  inchi["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  in2D["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  score["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  xlogp["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  links["score",l]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/fingerid\_sum.tsv"}
\StringTok{{-}        printf formula["score",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  file[l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  formu\_type["score",l]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "temp/Mo\_filename"}
\StringTok{{-}      \}}
\StringTok{{-}    if(max["simi",l]!="" \&\& max["simi",l]!=max["score",l])}
\StringTok{{-}      \{}
\StringTok{{-}        printf l"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  name["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  formula["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  simi["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  smiles["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  inchi["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  in2D["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  score["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  xlogp["simi",l]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  links["simi",l]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/fingerid\_sum.tsv"}
\StringTok{{-}      \}}
\StringTok{{-}  \}}
\StringTok{{-}\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\SpecialCharTok{{-}}\NormalTok{data\_sum}\OtherTok{=}\StringTok{"results/fingerid\_sum.tsv"}
\SpecialCharTok{{-}}\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{{-}\{}
\StringTok{{-}  if(NR==1)}
\StringTok{{-}    \{}
\StringTok{{-}      for(i=1; i\textless{}=NF; i++)}
\StringTok{{-}        \{}
\StringTok{{-}          if($i\textasciitilde{}/id/)}
\StringTok{{-}            \{}
\StringTok{{-}              col\_id=i}
\StringTok{{-}            \}}
\StringTok{{-}          if($i\textasciitilde{}/score/)}
\StringTok{{-}            \{}
\StringTok{{-}              col\_score=i}
\StringTok{{-}            \}}
\StringTok{{-}        \}}
\StringTok{{-}    \}}
\StringTok{{-}  if(NR\textgreater{}=2)}
\StringTok{{-}    \{}
\StringTok{{-}      id=$col\_id}
\StringTok{{-}      if(max\_id+0\textless{}id || max\_id=="")}
\StringTok{{-}        \{}
\StringTok{{-}          max\_id=id}
\StringTok{{-}        \}}
\StringTok{{-}      if(score[id]+0\textless{}$col\_score+0 || score[id]=="")}
\StringTok{{-}        \{}
\StringTok{{-}          score[id]=$col\_score}
\StringTok{{-}          data[id]=$0}
\StringTok{{-}        \}}
\StringTok{{-}    \}}
\StringTok{{-}\}}
\StringTok{{-}END\{}
\StringTok{{-}printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "formula}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "smiles}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchi}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "inchikey2D}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "score}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "xlogp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "links}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/fingerid\_first\_score.tsv"}
\StringTok{{-}for(i=1; i\textless{}=max\_id; i++)}
\StringTok{{-}  \{}
\StringTok{{-}    if(data[i]!="")}
\StringTok{{-}      \{}
\StringTok{{-}        printf data[i] "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/fingerid\_first\_score.tsv"}
\StringTok{{-}      \}}
\StringTok{{-}  \}}
\StringTok{{-}\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data\_sum}
\SpecialCharTok{{-}}\NormalTok{echo }\StringTok{"structure\_extract results have been successfully assembled into \textless{}results/fingerid\_sum.tsv\textgreater{} and \textless{}results/fingerid\_first\_score.tsv\textgreater{}"}\NormalTok{;}
\SpecialCharTok{{-}}\NormalTok{;;}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\NormalTok{classification\_extract\_sum}\ErrorTok{)}
\SpecialCharTok{{-}}\NormalTok{echo }\StringTok{"Run classification\_extract\_sum."}\NormalTok{;}
\SpecialCharTok{{-}}\ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{Mo\_filename ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f canopus.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f canopus\_neg.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f .format ]}
\SpecialCharTok{{-}}\NormalTok{then}
\SpecialCharTok{{-}}\NormalTok{  echo }\StringTok{"Project path acknowledged."}
\SpecialCharTok{{-}}\ControlFlowTok{else}
\SpecialCharTok{{-}}\NormalTok{  until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{canopus.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\SpecialCharTok{{-}}\NormalTok{  do}
\SpecialCharTok{{-}}\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\SpecialCharTok{{-}}\NormalTok{  done;}
\SpecialCharTok{{-}}\NormalTok{  cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\SpecialCharTok{{-}}\NormalTok{fi;}
\SpecialCharTok{{-}}\NormalTok{data1}\OtherTok{=}\StringTok{"temp/Mo\_filename"}
\SpecialCharTok{{-}}\NormalTok{data2}\OtherTok{=}\StringTok{"canopus.tsv"}
\SpecialCharTok{{-}}\NormalTok{data3}\OtherTok{=}\StringTok{"canopus\_neg.tsv"}
\SpecialCharTok{{-}}\NormalTok{datas}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{{-}\{}
\StringTok{{-}  x=$2"/canopus/"$3".fpt"}
\StringTok{{-}  if(getline \textless{} x == 1)}
\StringTok{{-}    \{}
\StringTok{{-}      printf x" "}
\StringTok{{-}    \}}
\StringTok{{-}  close(x)}
\StringTok{{-}\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1)}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{{-}\{}
\StringTok{{-}  if(NR==FNR)}
\StringTok{{-}    \{}
\StringTok{{-}      i=split($2,s,"[\_]")}
\StringTok{{-}      the\_id[FNR]=s[i]}
\StringTok{{-}      n=FNR}
\StringTok{{-}    \}}
\StringTok{{-}  if(FILENAME \textasciitilde{} /canopus.tsv/)}
\StringTok{{-}    \{}
\StringTok{{-}      if(FNR==1)}
\StringTok{{-}        \{}
\StringTok{{-}          for(i=1; i\textless{}=NF; i++)}
\StringTok{{-}            \{}
\StringTok{{-}              if($i \textasciitilde{} /\^{}name/)}
\StringTok{{-}                \{}
\StringTok{{-}                  col\_class=i}
\StringTok{{-}                \}}
\StringTok{{-}              if($i \textasciitilde{} /absolute/)}
\StringTok{{-}                \{}
\StringTok{{-}                  col\_abindex=i}
\StringTok{{-}                \}}
\StringTok{{-}            \}}
\StringTok{{-}        \}}
\StringTok{{-}      if(FNR\textgreater{}=2)}
\StringTok{{-}        \{}
\StringTok{{-}          abindex[1,FNR]=$col\_abindex}
\StringTok{{-}          indexset[$col\_abindex]=$col\_class}
\StringTok{{-}        \}}
\StringTok{{-}    \}}
\StringTok{{-}  if(FILENAME \textasciitilde{} /canopus\_neg.tsv/)}
\StringTok{{-}    \{}
\StringTok{{-}      p\_filename=FILENAME}
\StringTok{{-}      if(FNR==1)}
\StringTok{{-}        \{}
\StringTok{{-}          for(i=1; i\textless{}=NF; i++)}
\StringTok{{-}            \{}
\StringTok{{-}              if($i \textasciitilde{} /name/)}
\StringTok{{-}                \{}
\StringTok{{-}                  col\_class=i}
\StringTok{{-}                \}}
\StringTok{{-}              if($i \textasciitilde{} /absolute/)}
\StringTok{{-}                \{}
\StringTok{{-}                  col\_abindex=i}
\StringTok{{-}                \}}
\StringTok{{-}            \}}
\StringTok{{-}        \}}
\StringTok{{-}      if(FNR\textgreater{}=2)}
\StringTok{{-}        \{}
\StringTok{{-}          abindex[2,FNR]=$col\_abindex}
\StringTok{{-}          indexset[$col\_abindex]=$col\_class}
\StringTok{{-}        \}}
\StringTok{{-}    \}}
\StringTok{{-}  if(FILENAME \textasciitilde{} /.fpt/)}
\StringTok{{-}    \{}
\StringTok{{-}      if(FNR==1)}
\StringTok{{-}        \{}
\StringTok{{-}          close(p\_filename)}
\StringTok{{-}          printf "Info: data\_file name of " p\_filename " has been input.}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{{-}          p\_filename=FILENAME}
\StringTok{{-}          split(FILENAME,a,"[/]");}
\StringTok{{-}          m=split(a[1],b,"[\_]");}
\StringTok{{-}          id=b[m];}
\StringTok{{-}          if(FILENAME \textasciitilde{} /\textbackslash{}+.fpt/)}
\StringTok{{-}            \{}
\StringTok{{-}              ion=1}
\StringTok{{-}            \}}
\StringTok{{-}          if(FILENAME \textasciitilde{} /\textbackslash{}{-}.fpt/)}
\StringTok{{-}            \{}
\StringTok{{-}              ion=2}
\StringTok{{-}            \}}
\StringTok{{-}        \}}
\StringTok{{-}      pp[id,abindex[ion,FNR+1]]=sprintf("\%.3f",$1)}
\StringTok{{-}    \}}
\StringTok{{-}\}}
\StringTok{{-}END\{}
\StringTok{{-}printf "id" \textgreater{} "results/canopus\_pp.tsv"}
\StringTok{{-}for(i in indexset)}
\StringTok{{-}  \{}
\StringTok{{-}    ord+=1}
\StringTok{{-}    orderlist[ord]=i}
\StringTok{{-}    printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"indexset[i] \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{{-}  \}}
\StringTok{{-}printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{{-}for(i=1; i\textless{}=n; i++)}
\StringTok{{-}  \{}
\StringTok{{-}    printf the\_id[i] \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{{-}    for(j=1; j\textless{}=ord; j++)}
\StringTok{{-}      \{}
\StringTok{{-}        if(pp[the\_id[i],orderlist[j]]=="")}
\StringTok{{-}          \{}
\StringTok{{-}            pp[the\_id[i],orderlist[j]]=0}
\StringTok{{-}          \}}
\StringTok{{-}        printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"pp[the\_id[i],orderlist[j]] \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{{-}      \}}
\StringTok{{-}    printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/canopus\_pp.tsv"}
\StringTok{{-}  \}}
\StringTok{{-}\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3 }\SpecialCharTok{$}\NormalTok{datas}
\SpecialCharTok{{-}}\NormalTok{echo }\StringTok{"classiication\_extract\_sum have been successfully written into \textless{}results/canopus\_pp.tsv\textgreater{}"}
\SpecialCharTok{{-}}\NormalTok{;;}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\NormalTok{classification\_extract\_filter}\ErrorTok{)}
\SpecialCharTok{{-}}\NormalTok{echo }\StringTok{"Run classification\_extract\_filter."}\NormalTok{;}
\SpecialCharTok{{-}}\ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f results}\SpecialCharTok{/}\NormalTok{canopus\_pp.tsv ]}
\SpecialCharTok{{-}}\NormalTok{then}
\SpecialCharTok{{-}}\NormalTok{  echo }\StringTok{"Project path acknowledged."}
\SpecialCharTok{{-}}\ControlFlowTok{else}
\SpecialCharTok{{-}}\NormalTok{  until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{results}\SpecialCharTok{/}\NormalTok{canopus\_pp.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{results}\SpecialCharTok{/}\NormalTok{canopus\_summary.tsv ]}
\SpecialCharTok{{-}}\NormalTok{  do}
\SpecialCharTok{{-}}\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\SpecialCharTok{{-}}\NormalTok{  done;}
\SpecialCharTok{{-}}\NormalTok{  cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\SpecialCharTok{{-}}\NormalTok{fi; }
\SpecialCharTok{{-}}\NormalTok{check}\OtherTok{=}\DecValTok{0}
\SpecialCharTok{{-}}\NormalTok{until [[ }\StringTok{"$check"} \SpecialCharTok{==} \StringTok{"yes"}\NormalTok{ ]] }\SpecialCharTok{||}\NormalTok{ [[ }\StringTok{"$check"} \SpecialCharTok{==} \StringTok{"no"}\NormalTok{ ]]}
\SpecialCharTok{{-}}\NormalTok{do}
\SpecialCharTok{{-}}\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Collate the posterior probabilities of the classification of each feature? [yes/no] \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ check;}
\SpecialCharTok{{-}}\NormalTok{done;}
\SpecialCharTok{{-}}\ControlFlowTok{if}\NormalTok{ [[ }\SpecialCharTok{$}\NormalTok{check }\SpecialCharTok{==} \StringTok{"yes"}\NormalTok{ ]]}
\SpecialCharTok{{-}}\NormalTok{then}
\SpecialCharTok{{-}}\NormalTok{  definition\_limit}\OtherTok{=}\DecValTok{0}
\SpecialCharTok{{-}}\NormalTok{  until [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textgreater{}} \StringTok{"0.01"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textless{}} \StringTok{"1"}\NormalTok{ ]]}
\SpecialCharTok{{-}}\NormalTok{  do}
\SpecialCharTok{{-}}\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the classes posterior probabilities limition. 0.5\textasciitilde{}0.99 may work well. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ definition\_limit;}
\SpecialCharTok{{-}}\NormalTok{  done;}
\SpecialCharTok{{-}}\NormalTok{  data1}\OtherTok{=}\StringTok{"canopus\_summary.tsv"}
\SpecialCharTok{{-}}\NormalTok{  data2}\OtherTok{=}\StringTok{"canopus.tsv"}
\SpecialCharTok{{-}}\NormalTok{  data3}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\SpecialCharTok{{-}}\NormalTok{  awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{{-}  \{}
\StringTok{{-}    if(NR==FNR)}
\StringTok{{-}      \{}
\StringTok{{-}        if(FNR==1)}
\StringTok{{-}          \{}
\StringTok{{-}            p\_file=FILENAME}
\StringTok{{-}            for(i=1; i\textless{}=NF; i++)}
\StringTok{{-}              \{}
\StringTok{{-}                if($i\textasciitilde{}/name/)}
\StringTok{{-}                  \{}
\StringTok{{-}                    col\_id=i}
\StringTok{{-}                  \}}
\StringTok{{-}                if($i\textasciitilde{}/specific/)}
\StringTok{{-}                  \{}
\StringTok{{-}                    col\_specific=i}
\StringTok{{-}                  \}}
\StringTok{{-}                if($i\textasciitilde{}/level/)}
\StringTok{{-}                  \{}
\StringTok{{-}                    col\_level=i}
\StringTok{{-}                  \}}
\StringTok{{-}                if($i\textasciitilde{}/subclass/)}
\StringTok{{-}                  \{}
\StringTok{{-}                    col\_subclass=i}
\StringTok{{-}                  \}}
\StringTok{{-}                if($i\textasciitilde{}/\^{}class/)}
\StringTok{{-}                  \{}
\StringTok{{-}                    col\_class=i}
\StringTok{{-}                  \}}
\StringTok{{-}                if($i\textasciitilde{}/superclass/)}
\StringTok{{-}                  \{}
\StringTok{{-}                    col\_superclass=i}
\StringTok{{-}                  \}}
\StringTok{{-}              \}}
\StringTok{{-}          \}}
\StringTok{{-}        if(FNR\textgreater{}=2)}
\StringTok{{-}          \{}
\StringTok{{-}            n=split($col\_id,a,"[\_]")}
\StringTok{{-}            id=a[n]}
\StringTok{{-}            specific[id]=$col\_specific}
\StringTok{{-}            level[id]=$col\_level}
\StringTok{{-}            subclass[id]=$col\_subclass}
\StringTok{{-}            class[id]=$col\_class}
\StringTok{{-}            superclass[id]=$col\_superclass}
\StringTok{{-}          \}}
\StringTok{{-}      \}}
\StringTok{{-}    if(FILENAME\textasciitilde{}/canopus.tsv/)}
\StringTok{{-}      \{}
\StringTok{{-}        if(FNR==1)}
\StringTok{{-}          \{}
\StringTok{{-}            close(p\_file)}
\StringTok{{-}            p\_file=FILENAME}
\StringTok{{-}            for(i=1; i\textless{}=NF; i++)}
\StringTok{{-}              \{}
\StringTok{{-}                if($i\textasciitilde{}/name/)}
\StringTok{{-}                  \{}
\StringTok{{-}                    col\_name=i}
\StringTok{{-}                  \}}
\StringTok{{-}                if($i\textasciitilde{}/description/)}
\StringTok{{-}                  \{}
\StringTok{{-}                    col\_description=i}
\StringTok{{-}                  \}}
\StringTok{{-}              \}}
\StringTok{{-}          \}}
\StringTok{{-}        if(FNR\textgreater{}=2)}
\StringTok{{-}          \{}
\StringTok{{-}            description[$col\_name]=$col\_description}
\StringTok{{-}          \}}
\StringTok{{-}      \}}
\StringTok{{-}    if(FILENAME\textasciitilde{}"\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data3}\StringTok{\textquotesingle{}")}
\StringTok{{-}      \{}
\StringTok{{-}        if(FNR==1)}
\StringTok{{-}          \{}
\StringTok{{-}            close(p\_file)}
\StringTok{{-}            for(i=1; i\textless{}=NF; i++)}
\StringTok{{-}              \{}
\StringTok{{-}                if($i\textasciitilde{}/\^{}id$/)}
\StringTok{{-}                  \{}
\StringTok{{-}                    col\_id=i}
\StringTok{{-}                  \}}
\StringTok{{-}                if(i\textgreater{}=2)}
\StringTok{{-}                  \{}
\StringTok{{-}                    col\_class\_name[i]=$i}
\StringTok{{-}                  \}}
\StringTok{{-}              \}}
\StringTok{{-}            printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition\_source}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "definition\_description}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "specific}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "specific\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "level\_5}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "level\_5\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "subclass}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "subclass\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "class}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "class\_pp}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "superclass}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "superclass\_pp}\SpecialCharTok{\textbackslash{}n}\StringTok{"  \textgreater{} "results/stat\_classification.tsv"}
\StringTok{{-}          \}}
\StringTok{{-}        if(FNR\textgreater{}=2)}
\StringTok{{-}          \{}
\StringTok{{-}            for(i=2; i\textless{}=NF; i++)}
\StringTok{{-}              \{}
\StringTok{{-}                c\_pp[col\_class\_name[i]]=sprintf("\%.4f",$i)}
\StringTok{{-}              \}}
\StringTok{{-}            if(level[$col\_id] != "" \&\& c\_pp[level[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{{-}              \{}
\StringTok{{-}                definition\_source="level\_5"}
\StringTok{{-}                definition=level[$col\_id]}
\StringTok{{-}              \}}
\StringTok{{-}          else if(subclass[$col\_id] != "" \&\& c\_pp[subclass[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{{-}            \{}
\StringTok{{-}              definition\_source="subclass"}
\StringTok{{-}              definition=subclass[$col\_id]}
\StringTok{{-}            \}}
\StringTok{{-}        else if(class[$col\_id] != "" \&\& c\_pp[class[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{{-}          \{}
\StringTok{{-}            definition\_source="class"}
\StringTok{{-}            definition=class[$col\_id]}
\StringTok{{-}          \}}
\StringTok{{-}      else if(superclass[$col\_id] != "" \&\& c\_pp[superclass[$col\_id]] \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{definition\_limit}\StringTok{\textquotesingle{}")}
\StringTok{{-}        \{}
\StringTok{{-}          definition\_source="superclass"}
\StringTok{{-}          definition=superclass[$col\_id]}
\StringTok{{-}        \}}
\StringTok{{-}    else}
\StringTok{{-}      \{}
\StringTok{{-}        definition\_source="null"}
\StringTok{{-}        definition="null"}
\StringTok{{-}        c\_pp[definition]="null"}
\StringTok{{-}        description[definition]="null"}
\StringTok{{-}      \}}
\StringTok{{-}    printf $col\_id"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  definition\_source"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  definition"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[definition]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  description[definition]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  specific[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[specific[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  level[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[level[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  subclass[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[subclass[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  class[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[class[$col\_id]]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  superclass[$col\_id]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  c\_pp[superclass[$col\_id]]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/stat\_classification.tsv"}
\StringTok{{-}  \}}
\StringTok{{-}\}}
\StringTok{{-}\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\SpecialCharTok{{-}}\NormalTok{echo }\StringTok{"classification\_extract\_filter have been successfully written into \textless{}results/stat\_classification.tsv\textgreater{}"}
\SpecialCharTok{{-}}\NormalTok{fi;}
\SpecialCharTok{{-}}\NormalTok{;;}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\NormalTok{fragment\_tree\_network}\ErrorTok{)}
\SpecialCharTok{{-}}\NormalTok{echo }\StringTok{"Run fragment\_tree\_network."}\NormalTok{;}
\SpecialCharTok{{-}}\ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{d temp ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f .format ]}
\SpecialCharTok{{-}}\NormalTok{then}
\SpecialCharTok{{-}}\NormalTok{  echo }\StringTok{"Project path acknowledged."}
\SpecialCharTok{{-}}\ControlFlowTok{else}
\SpecialCharTok{{-}}\NormalTok{  until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\SpecialCharTok{{-}}\NormalTok{  do}
\SpecialCharTok{{-}}\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project. Make sure you have moved the fragment tree alignment results to the directory where the project is located. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\SpecialCharTok{{-}}\NormalTok{  done;}
\SpecialCharTok{{-}}\NormalTok{  cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\SpecialCharTok{{-}}\NormalTok{fi;}
\SpecialCharTok{{-}}\NormalTok{echo }\StringTok{"Please enter the minimum alignment similarity(tlimit) that you want to filter."}
\SpecialCharTok{{-}}\NormalTok{tlimit}\OtherTok{=}\DecValTok{0}
\SpecialCharTok{{-}}\NormalTok{until [[ }\StringTok{"$tlimit"} \SpecialCharTok{\textgreater{}} \StringTok{"0.01"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$tlimit"} \SpecialCharTok{\textless{}} \StringTok{"0.99"}\NormalTok{ ]]}
\SpecialCharTok{{-}}\NormalTok{do}
\SpecialCharTok{{-}}\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"0.4{-}0.7 is recommended \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ tlimit;}
\SpecialCharTok{{-}}\NormalTok{done;}
\SpecialCharTok{{-}}\ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{d temp}\SpecialCharTok{/}\NormalTok{ftaligntemp ]}
\SpecialCharTok{{-}}\NormalTok{then }
\SpecialCharTok{{-}}\NormalTok{  mkdir temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}
\SpecialCharTok{{-}}\NormalTok{fi;}
\SpecialCharTok{{-}}\NormalTok{data}\OtherTok{=}\StringTok{"ftalign.tsv"}
\SpecialCharTok{{-}}\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/ftaligntemp/tmp"}
\SpecialCharTok{{-}}\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{{-}\{}
\StringTok{{-}  printf "Info: NR = " NR ". FNR = " FNR ".}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{{-}  if(NR==FNR)}
\StringTok{{-}    \{}
\StringTok{{-}      for(i=1; i\textless{}=NF; i++)}
\StringTok{{-}        \{}
\StringTok{{-}          if(NR==1 \&\& i!=1 || NR!=1 \&\& i==1)}
\StringTok{{-}            \{}
\StringTok{{-}              n=split($i,x,"[\_]")}
\StringTok{{-}              raw[NR,i]=x[n]}
\StringTok{{-}            \}}
\StringTok{{-}        else}
\StringTok{{-}          \{}
\StringTok{{-}            if(NR==i)}
\StringTok{{-}              \{}
\StringTok{{-}                raw\_norm[NR,i]=$i}
\StringTok{{-}              \}}
\StringTok{{-}          \}}
\StringTok{{-}      \}}
\StringTok{{-}  \}}
\StringTok{{-}if(NR\textgreater{}FNR \&\& FNR\textgreater{}=2)}
\StringTok{{-}  \{}
\StringTok{{-}    for(i=2; i\textless{}=NF; i++)}
\StringTok{{-}      \{}
\StringTok{{-}        norm1=$i/raw\_norm[i,i]}
\StringTok{{-}        norm2=$i/raw\_norm[FNR,FNR]}
\StringTok{{-}        norms=sprintf("\%.2f", ((norm1+norm2)/2))}
\StringTok{{-}        if((norms+0 \textgreater{} \textquotesingle{}}\SpecialCharTok{$}\NormalTok{tlimit}\StringTok{\textquotesingle{}+0))}
\StringTok{{-}          \{}
\StringTok{{-}            if(raw[FNR,1]+0\textgreater{}=raw[1,i]+0)}
\StringTok{{-}              \{}
\StringTok{{-}                print raw[FNR,1], raw[1,i], norms \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{{-}              \}}
\StringTok{{-}            if(raw[FNR,1]+0\textless{}raw[1,i]+0)}
\StringTok{{-}              \{}
\StringTok{{-}                print raw[1,i], raw[FNR,1], norms \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{{-}              \}}
\StringTok{{-}          \}}
\StringTok{{-}      \}}
\StringTok{{-}  \}}
\StringTok{{-}\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data }\SpecialCharTok{$}\NormalTok{data}
\SpecialCharTok{{-}}\NormalTok{sort }\SpecialCharTok{{-}}\NormalTok{u }\SpecialCharTok{$}\NormalTok{savepath }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{tmp2}
\SpecialCharTok{{-}}\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/ftaligntemp/filter\_net\_$tlimit"}
\SpecialCharTok{{-}}\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{{-}\{}
\StringTok{{-}  if(NR==FNR)}
\StringTok{{-}    \{}
\StringTok{{-}      if($1!=$2)}
\StringTok{{-}        \{}
\StringTok{{-}          replink[$1]=$1}
\StringTok{{-}          replink[$2]=$2}
\StringTok{{-}        \}}
\StringTok{{-}    \}}
\StringTok{{-}  if(NR!=FNR)}
\StringTok{{-}    \{}
\StringTok{{-}      if($1!=$2)}
\StringTok{{-}        \{}
\StringTok{{-}          printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" }
\StringTok{{-}        \} }
\StringTok{{-}      if($1==$2)}
\StringTok{{-}        \{}
\StringTok{{-}          if(replink[$1]=="")}
\StringTok{{-}            \{}
\StringTok{{-}              printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{{-}            \}}
\StringTok{{-}        \}}
\StringTok{{-}    \}}
\StringTok{{-}\}\textquotesingle{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{tmp2 temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{tmp2}
\SpecialCharTok{{-}}\NormalTok{echo }\StringTok{"fragment\_tree\_network have been successfully written into \textless{}temp/ftaligntemp/filter\_net\_$tlimit\textgreater{}"}
\SpecialCharTok{{-}}\NormalTok{;;}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\NormalTok{fragment\_tree\_network\_delta}\ErrorTok{)}
\SpecialCharTok{{-}}\ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{d temp ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f .format ]}
\SpecialCharTok{{-}}\NormalTok{then}
\SpecialCharTok{{-}}\NormalTok{  echo }\StringTok{"Project path acknowledged."}
\SpecialCharTok{{-}}\ControlFlowTok{else}
\SpecialCharTok{{-}}\NormalTok{  until [ }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{$}\NormalTok{projectpath ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{ftalign.tsv ] }\SpecialCharTok{\&\&}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{projectpath}\SpecialCharTok{/}\NormalTok{.format ]}
\SpecialCharTok{{-}}\NormalTok{  do}
\SpecialCharTok{{-}}\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please input the path of the sirius project \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ projectpath;}
\SpecialCharTok{{-}}\NormalTok{  done;}
\SpecialCharTok{{-}}\NormalTok{  cd }\SpecialCharTok{$}\NormalTok{projectpath;}
\SpecialCharTok{{-}}\NormalTok{fi;}
\SpecialCharTok{{-}}\NormalTok{echo }\StringTok{"The following module attempts to compute the differential fingerprints of connected clusters based on the molecular fingerprint results of sirius 4."}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\NormalTok{plimit}\OtherTok{=}\DecValTok{0}
\SpecialCharTok{{-}}\NormalTok{until [[ }\StringTok{"$plimit"} \SpecialCharTok{\textgreater{}} \StringTok{"0.5"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$plimit"} \SpecialCharTok{\textless{}} \StringTok{"0.99"}\NormalTok{ ]]}
\SpecialCharTok{{-}}\NormalTok{do}
\SpecialCharTok{{-}}\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"If the minimum alignment similarity is greater than 0.3, this step will automatic calculate the discrepancy fingerprint between alignment features(in beta). Please enter the minimum posterior probability of the molecular fingerprint(plimit\_1) to be filtered. 0.9{-}0.99 is recommended. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ plimit;}
\SpecialCharTok{{-}}\NormalTok{done;}
\SpecialCharTok{{-}}\NormalTok{plimit2}\OtherTok{=}\DecValTok{0}
\SpecialCharTok{{-}}\NormalTok{until [[ }\StringTok{"$plimit2"} \SpecialCharTok{\textgreater{}} \StringTok{"0.1"}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$plimit2"} \SpecialCharTok{\textless{}} \StringTok{"$plimit"}\NormalTok{ ]]}
\SpecialCharTok{{-}}\NormalTok{do}
\SpecialCharTok{{-}}\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"The minimum posterior probability of the molecular fingerprint(plimit\_2) to be controled. 0.1{-}0.5 may work well. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ plimit2;}
\SpecialCharTok{{-}}\NormalTok{done;}
\SpecialCharTok{{-}}\NormalTok{tlimit}\OtherTok{=}\ErrorTok{$}\NormalTok{(ls temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{filter\_net\_}\SpecialCharTok{*} \ErrorTok{|}\NormalTok{ awk }\SpecialCharTok{{-}}\NormalTok{F \_ }\StringTok{\textquotesingle{}\{print $NF\}\textquotesingle{}}\NormalTok{)}
\SpecialCharTok{{-}}\NormalTok{check\_rep}\OtherTok{=}\ErrorTok{$}\NormalTok{(awk }\StringTok{\textquotesingle{}END\{print NR\}\textquotesingle{}} \SpecialCharTok{\textless{}}\NormalTok{(echo }\StringTok{"$tlimit"}\NormalTok{))}
\SpecialCharTok{{-}}\ControlFlowTok{if}\NormalTok{ [[ }\StringTok{"$check\_rep"} \SpecialCharTok{\textgreater{}} \StringTok{"1"}\NormalTok{ ]]}
\SpecialCharTok{{-}}\NormalTok{then}
\SpecialCharTok{{-}}\NormalTok{  tlimit}\OtherTok{=}\DecValTok{0}
\SpecialCharTok{{-}}\NormalTok{  until [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{filter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit ]}
\SpecialCharTok{{-}}\NormalTok{  do}
\SpecialCharTok{{-}}\NormalTok{    read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Plural and different fragment\_tree\_network files were found to exist locally. Please select a tlimit parameter you have utilized to run fragment\_tree\_network\_delta. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ tlimit;}
\SpecialCharTok{{-}}\NormalTok{  done;}
\SpecialCharTok{{-}}\NormalTok{fi;}
\SpecialCharTok{{-}}\ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{refilter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit ]}
\SpecialCharTok{{-}}\NormalTok{then rm temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{refilter\_net\_}\SpecialCharTok{$}\NormalTok{tlimit}
\SpecialCharTok{{-}}\NormalTok{fi;}
\SpecialCharTok{{-}}\ControlFlowTok{if}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{fpsample ]}
\SpecialCharTok{{-}}\NormalTok{then rm temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{fpsample}
\SpecialCharTok{{-}}\NormalTok{fi;}
\SpecialCharTok{{-}}\NormalTok{echo }\StringTok{"Running delta\_fingerprint computation..."}
\SpecialCharTok{{-}}\NormalTok{echo }\StringTok{"Aquiring data from sirius index..."}
\SpecialCharTok{{-}}\NormalTok{data1}\OtherTok{=}\StringTok{"*\_*/compound.info"}
\SpecialCharTok{{-}}\NormalTok{data2}\OtherTok{=}\StringTok{"temp/ftaligntemp/filter\_net\_$tlimit"}
\SpecialCharTok{{-}}\NormalTok{echo }\StringTok{"Run fragment\_tree\_network\_delta."}
\SpecialCharTok{{-}}\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/ms\_data\_$tlimit"}
\SpecialCharTok{{-}}\NormalTok{echo }\StringTok{"step 1: ms data"}
\SpecialCharTok{{-}}\ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{savepath ]}
\SpecialCharTok{{-}}\NormalTok{then}
\SpecialCharTok{{-}}\NormalTok{  awk }\SpecialCharTok{{-}}\NormalTok{F }\StringTok{"[}\SpecialCharTok{\textbackslash{}t}\StringTok{]||[:]||[\_]"} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{{-}  BEGIN\{  }
\StringTok{{-}  printf "..."}
\StringTok{{-}  printf "id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "m/z}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "rt}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{{-}\}}
\StringTok{{-}\{}
\StringTok{{-}  if(FILENAME\textasciitilde{}/compound.info/)}
\StringTok{{-}    \{}
\StringTok{{-}      if(FNR==1)}
\StringTok{{-}        \{}
\StringTok{{-}          printf "Info: catch \textgreater{}\textgreater{}\textgreater{} "FILENAME"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{{-}        \}}
\StringTok{{-}      if($1=="name")}
\StringTok{{-}        \{}
\StringTok{{-}          i+=1;}
\StringTok{{-}          id[i]=$NF;}
\StringTok{{-}          n=split($NF,a,"[\_]")}
\StringTok{{-}          printf a[n]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{{-}        \}}
\StringTok{{-}      if($1=="ionMass")}
\StringTok{{-}        \{}
\StringTok{{-}          mz[id[i]]=$NF}
\StringTok{{-}          printf sprintf("\%.4f",$NF)"}\SpecialCharTok{\textbackslash{}t}\StringTok{" \textgreater{}\textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{{-}        \}}
\StringTok{{-}      if($1=="ionType")}
\StringTok{{-}        \{}
\StringTok{{-}          type[id[i]]=$NF}
\StringTok{{-}        \}}
\StringTok{{-}      if($1=="rt")}
\StringTok{{-}        \{}
\StringTok{{-}          rt[id[i]]=$2;}
\StringTok{{-}          printf sprintf("\%.2f",$2/60)"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/mz\_and\_rt.tsv"}
\StringTok{{-}        \}}
\StringTok{{-}    \}}
\StringTok{{-}  if(FILENAME\textasciitilde{}/ftaligntemp/)}
\StringTok{{-}    \{}
\StringTok{{-}      \#source  target  ftalign  delta\_mz  delta\_rt  source\_iontype  target\_iontype;}
\StringTok{{-}      if(FNR==1)}
\StringTok{{-}        \{}
\StringTok{{-}          printf "" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{{-}        \}}
\StringTok{{-}      print $1,$2,$3,sprintf("\%.3f",mz[$2]{-}mz[$1]),sprintf("\%.2f",rt[$2]{-}rt[$1]),type[$1],type[$2]  \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{{-}    \}}
\StringTok{{-}\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
\SpecialCharTok{{-}}\NormalTok{fi;}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\NormalTok{echo }\StringTok{"step 2: data path"}
\SpecialCharTok{{-}}\NormalTok{source\_file}\OtherTok{=}\StringTok{"temp/Mo\_filename"}
\SpecialCharTok{{-}}\NormalTok{data}\OtherTok{=}\StringTok{"temp/ms\_data\_$tlimit"}
\SpecialCharTok{{-}}\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/datapath\_$tlimit"}
\SpecialCharTok{{-}}\ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{savepath ]}
\SpecialCharTok{{-}}\NormalTok{then}
\SpecialCharTok{{-}}\NormalTok{  awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{{-}  \{}
\StringTok{{-}    if(NR==FNR)}
\StringTok{{-}      \{}
\StringTok{{-}        n=split($2, a, "[\_]")}
\StringTok{{-}        file[a[n]]=$2}
\StringTok{{-}        formu\_type[a[n]]=$3}
\StringTok{{-}      \}}
\StringTok{{-}    if(NR!=FNR)}
\StringTok{{-}      \{}
\StringTok{{-}        \#\textless{}path\textgreater{}sourceFormula  \textless{}path\textgreater{}targetFormula}
\StringTok{{-}        path1=file[$1]"/fingerprints/"formu\_type[$1]".fpt"}
\StringTok{{-}        path2=file[$2]"/fingerprints/"formu\_type[$2]".fpt"}
\StringTok{{-}        data[path1]=path1}
\StringTok{{-}        data[path2]=path2}
\StringTok{{-}      \}}
\StringTok{{-}  \}}
\StringTok{{-}END\{}
\StringTok{{-}for(i in data)}
\StringTok{{-}  \{}
\StringTok{{-}    n+=1}
\StringTok{{-}    print "Check file:",n}
\StringTok{{-}    if(getline\textless{}i=={-}1)}
\StringTok{{-}      \{}
\StringTok{{-}        printf "Escape filename: " i "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{{-}      \}}
\StringTok{{-}  else}
\StringTok{{-}    \{}
\StringTok{{-}      printf i" " \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{{-}    \}}
\StringTok{{-}  close(i)}
\StringTok{{-}\}}
\StringTok{{-}print "Sum:",n}
\StringTok{{-}\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{source\_file }\SpecialCharTok{$}\NormalTok{data}
\SpecialCharTok{{-}}\NormalTok{fi;}
\SpecialCharTok{{-}}\NormalTok{datapath}\OtherTok{=}\ErrorTok{$}\NormalTok{(cat temp}\SpecialCharTok{/}\NormalTok{datapath\_}\SpecialCharTok{$}\NormalTok{tlimit)}
\SpecialCharTok{{-}}\NormalTok{echo }\StringTok{"step 3: fingerprint"}
\SpecialCharTok{{-}}\NormalTok{data\_allfp}\OtherTok{=}\StringTok{"temp/data\_allfp\_$tlimit"}
\SpecialCharTok{{-}}\ControlFlowTok{if} \SpecialCharTok{!}\NormalTok{ [ }\SpecialCharTok{{-}}\NormalTok{f }\SpecialCharTok{$}\NormalTok{data\_allfp ]}
\SpecialCharTok{{-}}\NormalTok{then}
\SpecialCharTok{{-}}\NormalTok{  awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{{-}  BEGIN\{}
\StringTok{{-}  n=0}
\StringTok{{-}\}}
\StringTok{{-}\{}
\StringTok{{-}  if(FNR==1)}
\StringTok{{-}    \{}
\StringTok{{-}      if(n\textgreater{}1)}
\StringTok{{-}        \{}
\StringTok{{-}          close(file)}
\StringTok{{-}        \}}
\StringTok{{-}      file=FILENAME;}
\StringTok{{-}      print "Get fingerprints: ",FILENAME}
\StringTok{{-}      n+=1;}
\StringTok{{-}      printf FILENAME"}\SpecialCharTok{\textbackslash{}n}\StringTok{"$0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data\_allfp}\StringTok{\textquotesingle{}"}
\StringTok{{-}    \}}
\StringTok{{-}else}
\StringTok{{-}  \{}
\StringTok{{-}    print $0 \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{data\_allfp}\StringTok{\textquotesingle{}"}
\StringTok{{-}  \}}
\StringTok{{-}\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{datapath}
\SpecialCharTok{{-}}\NormalTok{fi;}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{{-}\{}
\StringTok{{-}  if(NR==1)}
\StringTok{{-}    \{}
\StringTok{{-}      for(i=1; i\textless{}=NF; i++)}
\StringTok{{-}        \{}
\StringTok{{-}          if($i\textasciitilde{}/absolute/)}
\StringTok{{-}            \{}
\StringTok{{-}              col\_index=i}
\StringTok{{-}            \}}
\StringTok{{-}          if($i\textasciitilde{}/description/)}
\StringTok{{-}            \{}
\StringTok{{-}              col\_description=i}
\StringTok{{-}            \}}
\StringTok{{-}        \}}
\StringTok{{-}    \}}
\StringTok{{-}  if(NR\textgreater{}=2)}
\StringTok{{-}    \{}
\StringTok{{-}      print $col\_index,$col\_description}
\StringTok{{-}    \}}
\StringTok{{-}\}\textquotesingle{}}\NormalTok{ csi\_fingerid.tsv }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{pos\_fingerprint\_index;}
\SpecialCharTok{{-}}\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \SpecialCharTok{{-}}\NormalTok{v OFS}\OtherTok{=}\ErrorTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{{-}\{}
\StringTok{{-}  if(NR==1)}
\StringTok{{-}    \{}
\StringTok{{-}      for(i=1; i\textless{}=NF; i++)}
\StringTok{{-}        \{}
\StringTok{{-}          if($i\textasciitilde{}/absolute/)}
\StringTok{{-}            \{}
\StringTok{{-}              col\_index=i}
\StringTok{{-}            \}}
\StringTok{{-}          if($i\textasciitilde{}/description/)}
\StringTok{{-}            \{}
\StringTok{{-}              col\_description=i}
\StringTok{{-}            \}}
\StringTok{{-}        \}}
\StringTok{{-}    \}}
\StringTok{{-}  if(NR\textgreater{}=2)}
\StringTok{{-}    \{}
\StringTok{{-}      print $col\_index,$col\_description}
\StringTok{{-}    \}}
\StringTok{{-}\}\textquotesingle{}}\NormalTok{ csi\_fingerid\_neg.tsv }\SpecialCharTok{\textgreater{}}\NormalTok{ temp}\SpecialCharTok{/}\NormalTok{ftaligntemp}\SpecialCharTok{/}\NormalTok{neg\_fingerprint\_index;}
\SpecialCharTok{{-}}\NormalTok{posindex}\OtherTok{=}\StringTok{"temp/ftaligntemp/pos\_fingerprint\_index"}
\SpecialCharTok{{-}}\NormalTok{negindex}\OtherTok{=}\StringTok{"temp/ftaligntemp/neg\_fingerprint\_index"}
\SpecialCharTok{{-}}\NormalTok{data}\OtherTok{=}\StringTok{"temp/ms\_data\_$tlimit"}
\SpecialCharTok{{-}}\NormalTok{echo }\StringTok{"step 4: merge data"}
\SpecialCharTok{{-}}\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{{-}BEGIN\{}
\StringTok{{-}file=0}
\StringTok{{-}x=0}
\StringTok{{-}count=0}
\StringTok{{-}f=0}
\StringTok{{-}posnum=0}
\StringTok{{-}negnum=0}
\StringTok{{-}\}}
\StringTok{{-}\{}
\StringTok{{-}  if(FNR==1)}
\StringTok{{-}    \{}
\StringTok{{-}      file+=1}
\StringTok{{-}    \}}
\StringTok{{-}  if(NR==FNR)}
\StringTok{{-}    \{}
\StringTok{{-}      if(($1\textasciitilde{}/fingerprint/))}
\StringTok{{-}        \{}
\StringTok{{-}          if(x+0\textgreater{}f+0)}
\StringTok{{-}            \{}
\StringTok{{-}              f=x  \# calculate the max index.}
\StringTok{{-}            \}}
\StringTok{{-}          count+=1;  \# calculate the all fingerprints file number.}
\StringTok{{-}          split($1,a,"[/]"); e=split(a[1],b,"[\_]"); id=b[e]; \#catch the id.}
\StringTok{{-}          x=0;}
\StringTok{{-}        \}}
\StringTok{{-}    else}
\StringTok{{-}      \{}
\StringTok{{-}        x+=1;}
\StringTok{{-}        fp[id,x]=$1;}
\StringTok{{-}      \}}
\StringTok{{-}  \}}
\StringTok{{-}if(file==2)}
\StringTok{{-}  \{}
\StringTok{{-}    pos[FNR]=$1}
\StringTok{{-}    posnum+=1}
\StringTok{{-}  \}}
\StringTok{{-}if(file==3)}
\StringTok{{-}  \{}
\StringTok{{-}    neg[FNR]=$1}
\StringTok{{-}    negnum+=1}
\StringTok{{-}  \}}
\StringTok{{-}if(file==4)}
\StringTok{{-}  \{}
\StringTok{{-}    if("\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tlimit}\StringTok{\textquotesingle{}"+0 \textgreater{}= 0.3)}
\StringTok{{-}      \{}
\StringTok{{-}        if(fp[$1,1]!="" \&\& fp[$2,1]!="")}
\StringTok{{-}          \{}
\StringTok{{-}            n1=split($6, g, "[]]");}
\StringTok{{-}            n2=split($7, h, "[]]");}
\StringTok{{-}            if(g[n1]=="+" \&\& h[n2]=="+")}
\StringTok{{-}              \{}
\StringTok{{-}                for(x=1; x\textless{}=posnum; x++)}
\StringTok{{-}                  \{}
\StringTok{{-}                    if(fp[$1,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{{-}                      \{}
\StringTok{{-}                        data\_s[FNR,x]=pos[x]}
\StringTok{{-}                      \}}
\StringTok{{-}                  else if(fp[$2,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{{-}                    \{}
\StringTok{{-}                      data\_t[FNR,x]=pos[x]}
\StringTok{{-}                    \}}
\StringTok{{-}                \}}
\StringTok{{-}            \}}
\StringTok{{-}          if(g[n1]=="{-}" \&\& h[n2]=="{-}")}
\StringTok{{-}            \{}
\StringTok{{-}              for(x=1; x\textless{}=negnum; x++)}
\StringTok{{-}                \{}
\StringTok{{-}                  if(fp[$1,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{{-}                    \{}
\StringTok{{-}                      data\_s[FNR,x]=neg[x]}
\StringTok{{-}                    \}}
\StringTok{{-}                else if(fp[$2,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{{-}                  \{}
\StringTok{{-}                    data\_t[FNR,x]=neg[x]}
\StringTok{{-}                  \}}
\StringTok{{-}              \}}
\StringTok{{-}          \}}
\StringTok{{-}        if(g[n1]=="{-}" \&\& h[n2]=="+" || h[n2]=="{-}" \&\& g[n1]=="+")}
\StringTok{{-}          \{}
\StringTok{{-}            for(i=1; i\textless{}=posnum; i++)}
\StringTok{{-}              \{}
\StringTok{{-}                for(j=1; j\textless{}=negnum; j++)}
\StringTok{{-}                  \{}
\StringTok{{-}                    if(pos[i]==neg[j])}
\StringTok{{-}                      \{}
\StringTok{{-}                        mirror[i]=j  \#if pos=i, the identical index of neg is mirror[i]}
\StringTok{{-}                      \}}
\StringTok{{-}                  \}}
\StringTok{{-}              \}}
\StringTok{{-}          \}}
\StringTok{{-}        if(g[n1]=="{-}" \&\& h[n2]=="+") }
\StringTok{{-}          \{}
\StringTok{{-}            for(x=1; x\textless{}=f; x++)}
\StringTok{{-}              \{}
\StringTok{{-}                if(fp[$1,mirror[x]]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{{-}                  \{}
\StringTok{{-}                    data\_s[FNR,x]=neg[mirror[x]]}
\StringTok{{-}                  \}}
\StringTok{{-}              else if(fp[$2,x]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,mirror[x]]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{{-}                \{}
\StringTok{{-}                  data\_t[FNR,x]=neg[mirror[x]]}
\StringTok{{-}                \}}
\StringTok{{-}            \}}
\StringTok{{-}        \}}
\StringTok{{-}      if(h[n2]=="{-}" \&\& g[n1]=="+")}
\StringTok{{-}        \{}
\StringTok{{-}          for(x=1; x\textless{}=f; x++)}
\StringTok{{-}            \{}
\StringTok{{-}              if(fp[$1,x]+0\textgreater{}= \textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$2,mirror[x]]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{{-}                \{}
\StringTok{{-}                  data\_s[FNR,x]=neg[mirror[x]]}
\StringTok{{-}                \}}
\StringTok{{-}            else if(fp[$2,mirror[x]]+0\textgreater{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit}\StringTok{\textquotesingle{}+0 \&\& fp[$1,x]+0\textless{}=\textquotesingle{}}\SpecialCharTok{$}\NormalTok{plimit2}\StringTok{\textquotesingle{}+0)}
\StringTok{{-}              \{}
\StringTok{{-}                data\_t[FNR,x]=neg[mirror[x]]}
\StringTok{{-}              \}}
\StringTok{{-}          \}   }
\StringTok{{-}      \}}
\StringTok{{-}  \}}
\StringTok{{-}\}}
\StringTok{{-}if(FNR==1)}
\StringTok{{-}  \{}
\StringTok{{-}    printf "source}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "target}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "ftalign\_similarity}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "delta\_m/z}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "source\_fp\_uniq}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "target\_fp\_uniq}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{{-}  \}}
\StringTok{{-}else}
\StringTok{{-}  \{}
\StringTok{{-}    printf $1"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $2"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $3"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $4"}\SpecialCharTok{\textbackslash{}t}\StringTok{";}
\StringTok{{-}    if(\textquotesingle{}}\SpecialCharTok{$}\NormalTok{tlimit}\StringTok{\textquotesingle{}+0 \textgreater{}= 0.3)}
\StringTok{{-}      \{}
\StringTok{{-}        if(fp[$1,1]=="" || fp[$2,1]=="")}
\StringTok{{-}          \{}
\StringTok{{-}            printf "NA@NA}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{{-}          \}}
\StringTok{{-}      else}
\StringTok{{-}        \{}
\StringTok{{-}          printf "source:"  \#the source fingerprint uniq.}
\StringTok{{-}          for(x=1; x\textless{}=f; x++)}
\StringTok{{-}            \{}
\StringTok{{-}              if(data\_s[FNR,x]!="")}
\StringTok{{-}                \{}
\StringTok{{-}                  printf data\_s[FNR,x]","}
\StringTok{{-}                \}}
\StringTok{{-}            \};}
\StringTok{{-}          printf "@target:"  \#the target fingerprint uniq.}
\StringTok{{-}          for(x=1; x\textless{}=f; x++)}
\StringTok{{-}            \{}
\StringTok{{-}              if(data\_t[FNR,x]!="")}
\StringTok{{-}                \{}
\StringTok{{-}                  printf data\_t[FNR,x]","}
\StringTok{{-}                \}}
\StringTok{{-}            \}}
\StringTok{{-}          printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{{-}        \}}
\StringTok{{-}    \}}
\StringTok{{-}else}
\StringTok{{-}  \{}
\StringTok{{-}    printf "NA@NA}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{{-}  \}}
\StringTok{{-}\}}
\StringTok{{-}\}}
\StringTok{{-}\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data\_allfp }\SpecialCharTok{$}\NormalTok{posindex }\SpecialCharTok{$}\NormalTok{negindex }\SpecialCharTok{$}\NormalTok{data }\SpecialCharTok{|}\NormalTok{ sed }\SpecialCharTok{{-}}\NormalTok{e }\StringTok{\textquotesingle{}s/,@/}\SpecialCharTok{\textbackslash{}t}\StringTok{/g; s/,$//g; s/@/}\SpecialCharTok{\textbackslash{}t}\StringTok{/g\textquotesingle{}}  \SpecialCharTok{\textgreater{}}\NormalTok{ results}\SpecialCharTok{/}\NormalTok{source\_target\_tree\_}\SpecialCharTok{$}\NormalTok{tlimit.tsv;}
\SpecialCharTok{{-}}\NormalTok{echo }\StringTok{"All instances have written into \textless{}results/source\_target\_tree\_$tlimit.tsv\textgreater{}."}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\NormalTok{echo }\StringTok{"step 5: separate child{-}nebula from parent{-}nebula."}
\SpecialCharTok{{-}}\NormalTok{data}\OtherTok{=}\StringTok{"results/stat\_classification.tsv"}
\SpecialCharTok{{-}}\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/filter\_0\_class.tsv"}
\SpecialCharTok{{-}}\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{{-}\{}
\StringTok{{-}  if(FNR==1)}
\StringTok{{-}    \{}
\StringTok{{-}      for(i=1; i\textless{}=NF; i++)}
\StringTok{{-}        \{}
\StringTok{{-}          if($i\textasciitilde{}/\^{}definition$/)}
\StringTok{{-}            \{}
\StringTok{{-}              col\_class=i}
\StringTok{{-}            \}}
\StringTok{{-}        \}}
\StringTok{{-}    \}}
\StringTok{{-}  if(FNR\textgreater{}=2)}
\StringTok{{-}    \{}
\StringTok{{-}      class[$col\_class]=$col\_class}
\StringTok{{-}    \}}
\StringTok{{-}\}}
\StringTok{{-}END\{}
\StringTok{{-}for(i in class)}
\StringTok{{-}  \{}
\StringTok{{-}    printf class[i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{{-}  \}}
\StringTok{{-}\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\NormalTok{data1}\OtherTok{=}\StringTok{"temp/filter\_0\_class.tsv"} 
\SpecialCharTok{{-}}\NormalTok{data2}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\SpecialCharTok{{-}}\NormalTok{data3}\OtherTok{=}\StringTok{"results/fingerid\_first\_score.tsv"}
\SpecialCharTok{{-}}\NormalTok{until [[ }\StringTok{"$similarity\_limit"} \SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$similarity\_limit"} \SpecialCharTok{\textless{}} \DecValTok{1}\NormalTok{ ]]}
\SpecialCharTok{{-}}\NormalTok{do}
\SpecialCharTok{{-}}\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please set the Tanimoto similarity threshold contribute to child{-}nebula. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ similarity\_limit;}
\SpecialCharTok{{-}}\NormalTok{done;}
\SpecialCharTok{{-}}\NormalTok{until [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textgreater{}} \FloatTok{0.01}\NormalTok{ ]] }\SpecialCharTok{\&\&}\NormalTok{ [[ }\StringTok{"$definition\_limit"} \SpecialCharTok{\textless{}} \DecValTok{1}\NormalTok{ ]]}
\SpecialCharTok{{-}}\NormalTok{do}
\SpecialCharTok{{-}}\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the classes posterior probabilities limition. 0.5\textasciitilde{}0.99 may work well. \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ definition\_limit;}
\SpecialCharTok{{-}}\NormalTok{done;}
\SpecialCharTok{{-}}\NormalTok{class\_pp\_limit}\OtherTok{=}\ErrorTok{$}\NormalTok{definition\_limit}
\SpecialCharTok{{-}}\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/idenfication\_filter\_$class\_pp\_limit.tsv"}
\SpecialCharTok{{-}}\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{{-}\{}
\StringTok{{-}  if(NR==FNR)}
\StringTok{{-}    \{}
\StringTok{{-}      filter\_class[$1]=$1}
\StringTok{{-}    \}}
\StringTok{{-}  if(FILENAME\textasciitilde{}/canopus/)}
\StringTok{{-}    \{}
\StringTok{{-}      if(FNR==1)}
\StringTok{{-}        \{}
\StringTok{{-}          col\_id=1}
\StringTok{{-}          for(i=2; i\textless{}=NF; i++)}
\StringTok{{-}            \{}
\StringTok{{-}              for(j in filter\_class)}
\StringTok{{-}                \{}
\StringTok{{-}                  if(j==$i)}
\StringTok{{-}                    \{}
\StringTok{{-}                      col\_class[j]=i}
\StringTok{{-}                      print i}
\StringTok{{-}                    \}}
\StringTok{{-}                \}}
\StringTok{{-}            \}}
\StringTok{{-}        \}}
\StringTok{{-}      if(FNR\textgreater{}=2)}
\StringTok{{-}        \{}
\StringTok{{-}          for(i in col\_class)}
\StringTok{{-}            \{}
\StringTok{{-}              if(sprintf("\%.3f",$col\_class[i])+0\textgreater{}="\textquotesingle{}}\SpecialCharTok{$}\NormalTok{class\_pp\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{{-}                \{}
\StringTok{{-}                  class\_set[i,$col\_id]=i}
\StringTok{{-}                  print "ID: ",$1,i,$col\_class[i]}
\StringTok{{-}                \}}
\StringTok{{-}            \}}
\StringTok{{-}        \}}
\StringTok{{-}    \}}
\StringTok{{-}  if(FILENAME\textasciitilde{}/fingerid\_first\_score/)}
\StringTok{{-}    \{}
\StringTok{{-}      if(FNR==1)}
\StringTok{{-}        \{}
\StringTok{{-}          for(i=1; i\textless{}=NF; i++)}
\StringTok{{-}            \{}
\StringTok{{-}              if($i\textasciitilde{}/\^{}id/)}
\StringTok{{-}                \{}
\StringTok{{-}                  col\_id=i}
\StringTok{{-}                \}}
\StringTok{{-}              if($i\textasciitilde{}/similarity/)}
\StringTok{{-}                \{}
\StringTok{{-}                  col\_similarity=i}
\StringTok{{-}                \}}
\StringTok{{-}            \}}
\StringTok{{-}          printf "class\_nebula\_facet}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{{-}        \}}
\StringTok{{-}      if(FNR\textgreater{}=2)}
\StringTok{{-}        \{}
\StringTok{{-}          if($col\_similarity+0 \textgreater{}= "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{similarity\_limit}\StringTok{\textquotesingle{}"+0)}
\StringTok{{-}            \{}
\StringTok{{-}              for(i in class\_set)}
\StringTok{{-}                \{}
\StringTok{{-}                  if(i\textasciitilde{}"}\SpecialCharTok{\textbackslash{}034}\StringTok{"$col\_id"$")}
\StringTok{{-}                    \{}
\StringTok{{-}                      printf class\_set[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{{-}                    \}}
\StringTok{{-}                \}}
\StringTok{{-}            \}}
\StringTok{{-}        \}}
\StringTok{{-}    \}}
\StringTok{{-}\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\NormalTok{data}\OtherTok{=}\StringTok{"temp/idenfication\_filter\_$class\_pp\_limit.tsv"}
\SpecialCharTok{{-}}\NormalTok{savepath}\OtherTok{=}\StringTok{"temp/idenfication\_filter2\_$\{class\_pp\_limit\}.tsv"}
\SpecialCharTok{{-}}\NormalTok{until [[ }\StringTok{"$num\_limit\_1"} \SpecialCharTok{{-}}\NormalTok{gt }\DecValTok{0}\NormalTok{ ]]}
\SpecialCharTok{{-}}\NormalTok{do}
\SpecialCharTok{{-}}\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the features number threshold contribute to child{-}nebula (min number). \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ num\_limit\_1;}
\SpecialCharTok{{-}}\NormalTok{done;}
\SpecialCharTok{{-}}\NormalTok{until [[ }\StringTok{"$num\_limit\_2"} \SpecialCharTok{{-}}\NormalTok{gt }\StringTok{"$num\_limit\_1"}\NormalTok{ ]]}
\SpecialCharTok{{-}}\NormalTok{do}
\SpecialCharTok{{-}}\NormalTok{  read }\SpecialCharTok{{-}}\NormalTok{p }\StringTok{"Please enter the features number threshold contribute to child{-}nebula (max number). \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{ num\_limit\_2;}
\SpecialCharTok{{-}}\NormalTok{done;}
\SpecialCharTok{{-}}\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{{-}\{}
\StringTok{{-}  if(FNR==1)}
\StringTok{{-}    \{}
\StringTok{{-}      printf $0"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{{-}      for(i=1; i\textless{}=NF; i++)}
\StringTok{{-}        \{}
\StringTok{{-}          if($i\textasciitilde{}/class\_nebula\_facet/)}
\StringTok{{-}            \{}
\StringTok{{-}              col\_class=i}
\StringTok{{-}            \}}
\StringTok{{-}        \}}
\StringTok{{-}    \}}
\StringTok{{-}  if(FNR\textgreater{}=2)}
\StringTok{{-}    \{}
\StringTok{{-}      num[$col\_class]+=1}
\StringTok{{-}      data[FNR]=$0}
\StringTok{{-}      class[FNR]=$col\_class}
\StringTok{{-}    \}}
\StringTok{{-}\}}
\StringTok{{-}END\{}
\StringTok{{-}for(i in num)}
\StringTok{{-}  \{}
\StringTok{{-}    if(num[i]+0 \textgreater{}= \textquotesingle{}}\SpecialCharTok{$}\NormalTok{num\_limit\_1}\StringTok{\textquotesingle{}+0 \&\& num[i]+0 \textless{}= \textquotesingle{}}\SpecialCharTok{$}\NormalTok{num\_limit\_2}\StringTok{\textquotesingle{})}
\StringTok{{-}      \{}
\StringTok{{-}        printf "The nodes number of the child{-}nebula is " num[i] ".}\SpecialCharTok{\textbackslash{}n}\StringTok{"}
\StringTok{{-}        for(j in class)}
\StringTok{{-}          \{}
\StringTok{{-}            if(class[j]==i)}
\StringTok{{-}              \{}
\StringTok{{-}                printf data[j]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{{-}              \}}
\StringTok{{-}          \}}
\StringTok{{-}      \}}
\StringTok{{-}  \}}
\StringTok{{-}\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\NormalTok{mkdir results}\SpecialCharTok{/}\NormalTok{network\_facet\_}\SpecialCharTok{$}\NormalTok{class\_pp\_limit}
\SpecialCharTok{{-}}\NormalTok{data1}\OtherTok{=}\StringTok{"temp/idenfication\_filter2\_$\{class\_pp\_limit\}.tsv"}
\SpecialCharTok{{-}}\NormalTok{data2}\OtherTok{=}\StringTok{"results/source\_target\_tree\_$tlimit.tsv"} \CommentTok{\# "results/source\_target\_tree\_0.4.tsv"}
\SpecialCharTok{{-}}\NormalTok{save\_class}\OtherTok{=}\StringTok{"results/filter\_child\_class.tsv"}
\SpecialCharTok{{-}}\NormalTok{savepath}\OtherTok{=}\StringTok{"results/network\_facet\_$class\_pp\_limit/"}
\SpecialCharTok{{-}}\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{{-}\{}
\StringTok{{-}  if(NR==FNR)}
\StringTok{{-}    \{}
\StringTok{{-}      if(FNR==1)}
\StringTok{{-}        \{}
\StringTok{{-}          for(i=1; i\textless{}=NF; i++)}
\StringTok{{-}            \{}
\StringTok{{-}              if($i\textasciitilde{}/class\_nebula\_facet/)}
\StringTok{{-}                \{}
\StringTok{{-}                  col\_class=i}
\StringTok{{-}                \}}
\StringTok{{-}              if($i\textasciitilde{}/\^{}id$/)}
\StringTok{{-}                \{}
\StringTok{{-}                  col\_id=i}
\StringTok{{-}                \}}
\StringTok{{-}            \}}
\StringTok{{-}        \}}
\StringTok{{-}      if(FNR\textgreater{}=2)}
\StringTok{{-}        \{}
\StringTok{{-}          class[$col\_class]=$col\_class}
\StringTok{{-}          class\_id[$col\_class,$col\_id]=$col\_id}
\StringTok{{-}          stat\_id[$col\_class,$col\_id]=$col\_id}
\StringTok{{-}          belong[$col\_class,$col\_id]=$col\_class}
\StringTok{{-}        \}}
\StringTok{{-}    \}}
\StringTok{{-}  if(NR\textgreater{}FNR)}
\StringTok{{-}    \{}
\StringTok{{-}      if(FNR==1)}
\StringTok{{-}        \{}
\StringTok{{-}          for(i in class)}
\StringTok{{-}            \{}
\StringTok{{-}              printf i"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{save\_class}\StringTok{\textquotesingle{}"}
\StringTok{{-}              printf $0"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "facet}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" i ".tsv"}
\StringTok{{-}            \}}
\StringTok{{-}        \}}
\StringTok{{-}      if(FNR\textgreater{}=2)}
\StringTok{{-}        \{}
\StringTok{{-}          for(i in class)}
\StringTok{{-}            \{}
\StringTok{{-}              if( class\_id[i,$1]==$1 \&\& class\_id[i,$2]==$2 )}
\StringTok{{-}                \{}
\StringTok{{-}                  printf $0"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  i"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" i ".tsv"}
\StringTok{{-}                  delete stat\_id[i,$1]}
\StringTok{{-}                  delete stat\_id[i,$2]}
\StringTok{{-}                \}}
\StringTok{{-}            \}}
\StringTok{{-}        \}}
\StringTok{{-}    \}}
\StringTok{{-}\}}
\StringTok{{-}END\{}
\StringTok{{-}for(i in stat\_id)}
\StringTok{{-}  \{}
\StringTok{{-}    \#\# source target similarity delta\_mz fp fp class}
\StringTok{{-}    printf stat\_id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{" stat\_id[i]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "1}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "0}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "null}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "null}\SpecialCharTok{\textbackslash{}t}\StringTok{"  belong[i]"}\SpecialCharTok{\textbackslash{}n}\StringTok{"  \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}" belong[i] ".tsv"}
\StringTok{{-}  \}}
\StringTok{{-}\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\NormalTok{data1}\OtherTok{=}\StringTok{"canopus.tsv"}
\SpecialCharTok{{-}}\NormalTok{data2}\OtherTok{=}\StringTok{"results/filter\_child\_class.tsv"}
\SpecialCharTok{{-}}\NormalTok{data3}\OtherTok{=}\StringTok{"results/canopus\_pp.tsv"}
\SpecialCharTok{{-}}\NormalTok{savepath}\OtherTok{=}\StringTok{"results/canopus\_pp\_filter.tsv"}
\SpecialCharTok{{-}}\NormalTok{awk }\SpecialCharTok{{-}}\NormalTok{F }\SpecialCharTok{$}\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}t}\StringTok{\textquotesingle{}} \StringTok{\textquotesingle{}}
\StringTok{{-}\{}
\StringTok{{-}  if(FILENAME\textasciitilde{}/canopus.tsv/)}
\StringTok{{-}    \{}
\StringTok{{-}      if(FNR==1)}
\StringTok{{-}        \{}
\StringTok{{-}          for(i=1; i\textless{}=NF; i++)}
\StringTok{{-}            \{}
\StringTok{{-}              if($i\textasciitilde{}/absolute/)}
\StringTok{{-}                \{}
\StringTok{{-}                  col\_index=i}
\StringTok{{-}                \}}
\StringTok{{-}              if($i\textasciitilde{}/\^{}id/)}
\StringTok{{-}                \{}
\StringTok{{-}                  col\_chemid=i}
\StringTok{{-}                \}}
\StringTok{{-}              if($i\textasciitilde{}/name/)}
\StringTok{{-}                \{}
\StringTok{{-}                  col\_name=i}
\StringTok{{-}                \}}
\StringTok{{-}              if($i\textasciitilde{}/description/)}
\StringTok{{-}                \{}
\StringTok{{-}                  col\_des=i}
\StringTok{{-}                \}}
\StringTok{{-}            \}}
\StringTok{{-}        \}}
\StringTok{{-}      if(FNR\textgreater{}2)}
\StringTok{{-}        \{}
\StringTok{{-}          ab\_index[$col\_name]=$col\_index}
\StringTok{{-}          chemid[$col\_name]=$col\_chemid}
\StringTok{{-}          des[$col\_name]=$col\_des}
\StringTok{{-}        \}}
\StringTok{{-}    \}}
\StringTok{{-}  if(FILENAME\textasciitilde{}/filter\_child\_class/)}
\StringTok{{-}    \{}
\StringTok{{-}      class[$1]=$1}
\StringTok{{-}      if(FNR==1)}
\StringTok{{-}        \{}
\StringTok{{-}          printf "index}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "chem\_id}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "name}\SpecialCharTok{\textbackslash{}t}\StringTok{"  "description}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{} "results/child\_class.tsv"}
\StringTok{{-}        \}}
\StringTok{{-}      printf ab\_index[$1]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  chemid[$1]"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  $1"}\SpecialCharTok{\textbackslash{}t}\StringTok{"  des[$1]"}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "results/child\_class.tsv"}
\StringTok{{-}    \}}
\StringTok{{-}  if(FILENAME\textasciitilde{}/canopus\_pp/)}
\StringTok{{-}    \{}
\StringTok{{-}      if(FNR==1)}
\StringTok{{-}        \{}
\StringTok{{-}          printf $1 \textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{{-}          for(i=2; i\textless{}=NF; i++)}
\StringTok{{-}            \{}
\StringTok{{-}              if(class[$i]!="")}
\StringTok{{-}                \{}
\StringTok{{-}                  n+=1}
\StringTok{{-}                  printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{C"ab\_index[$i] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{{-}                  col\_set[n]=i}
\StringTok{{-}                \}}
\StringTok{{-}            \}}
\StringTok{{-}          printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{{-}        \}}
\StringTok{{-}      if(FNR\textgreater{}=2)}
\StringTok{{-}        \{}
\StringTok{{-}          printf $1 \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{{-}          for(i=1; i\textless{}=n; i++)}
\StringTok{{-}            \{}
\StringTok{{-}              printf "}\SpecialCharTok{\textbackslash{}t}\StringTok{"$col\_set[i] \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{{-}            \}}
\StringTok{{-}          printf "}\SpecialCharTok{\textbackslash{}n}\StringTok{" \textgreater{}\textgreater{} "\textquotesingle{}}\SpecialCharTok{$}\NormalTok{savepath}\StringTok{\textquotesingle{}"}
\StringTok{{-}        \}}
\StringTok{{-}    \}}
\StringTok{{-}\}\textquotesingle{}} \SpecialCharTok{$}\NormalTok{data1 }\SpecialCharTok{$}\NormalTok{data2 }\SpecialCharTok{$}\NormalTok{data3}
\SpecialCharTok{{-}}\NormalTok{;;}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\NormalTok{compound\_idenfication}\ErrorTok{)}
\SpecialCharTok{{-}}\NormalTok{echo }\StringTok{"Run compound\_idenfication."}
\SpecialCharTok{{-}}\NormalTok{echo }\StringTok{"compound\_idenfication "}
\SpecialCharTok{{-}}\NormalTok{exit}
\SpecialCharTok{{-}}\NormalTok{;;}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\NormalTok{double\_ion\_network}\ErrorTok{)}
\SpecialCharTok{{-}}\NormalTok{exit;}
\SpecialCharTok{{-}}\NormalTok{;;}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\NormalTok{exit}\ErrorTok{)}
\SpecialCharTok{{-}}\NormalTok{echo }\StringTok{"The mystery of creation is like the darkness of night{-}{-}it is great.}
\StringTok{{-}Delusions of knowledge are like the fog of the morning."}
\SpecialCharTok{{-}}\NormalTok{exit;}
\SpecialCharTok{{-}}\NormalTok{;;}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\SpecialCharTok{{-}}\ErrorTok{*)}
\SpecialCharTok{{-}}\NormalTok{echo }\StringTok{"error"}
\SpecialCharTok{{-}}\NormalTok{exit;}
\SpecialCharTok{{-}}\NormalTok{;;}
\SpecialCharTok{{-}}\NormalTok{esac;}
\SpecialCharTok{{-}}\NormalTok{done;}\CommentTok{\#(for)}
\SpecialCharTok{{-}}\NormalTok{done;}\CommentTok{\#(select)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-uformat.sh}{%
\section{File: uformat.sh}\label{file-uformat.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sudo fdisk }\SpecialCharTok{{-}}\NormalTok{l}
\NormalTok{umount }
\NormalTok{sudo mkfs }\SpecialCharTok{{-}}\NormalTok{V }\SpecialCharTok{{-}}\NormalTok{t vfat }\SpecialCharTok{/}\NormalTok{dev}\SpecialCharTok{/}\NormalTok{sdb1}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-wechat.sh}{%
\section{File: wechat.sh}\label{file-wechat.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{docker run }\SpecialCharTok{{-}}\NormalTok{d }\SpecialCharTok{{-}{-}}\NormalTok{name wechat }\SpecialCharTok{{-}{-}}\NormalTok{device }\SpecialCharTok{/}\NormalTok{dev}\SpecialCharTok{/}\NormalTok{snd }\SpecialCharTok{{-}{-}}\NormalTok{ipc}\OtherTok{=}\NormalTok{host \textbackslash{}}
\SpecialCharTok{{-}}\NormalTok{v }\SpecialCharTok{/}\NormalTok{tmp}\SpecialCharTok{/}\NormalTok{.X11}\SpecialCharTok{{-}}\NormalTok{unix}\SpecialCharTok{:}\ErrorTok{/}\NormalTok{tmp}\SpecialCharTok{/}\NormalTok{.X11}\SpecialCharTok{{-}}\NormalTok{unix \textbackslash{}}
\SpecialCharTok{{-}}\NormalTok{v }\SpecialCharTok{$}\NormalTok{HOME}\SpecialCharTok{/}\NormalTok{WeChatFiles}\SpecialCharTok{:}\ErrorTok{/}\NormalTok{WeChatFiles \textbackslash{}}
\SpecialCharTok{{-}}\NormalTok{e DISPLAY}\OtherTok{=}\NormalTok{unix}\SpecialCharTok{$}\NormalTok{DISPLAY \textbackslash{}}
\SpecialCharTok{{-}}\NormalTok{e XMODIFIERS}\OtherTok{=}\ErrorTok{@}\NormalTok{im}\OtherTok{=}\NormalTok{fcitx \textbackslash{}}
\SpecialCharTok{{-}}\NormalTok{e QT\_IM\_MODULE}\OtherTok{=}\NormalTok{fcitx \textbackslash{}}
\SpecialCharTok{{-}}\NormalTok{e GTK\_IM\_MODULE}\OtherTok{=}\NormalTok{fcitx \textbackslash{}}
\SpecialCharTok{{-}}\NormalTok{e AUDIO\_GID}\OtherTok{=}\StringTok{\textasciigrave{}}\AttributeTok{getent group audio | cut {-}d: {-}f3}\StringTok{\textasciigrave{}}\NormalTok{ \textbackslash{}}
\SpecialCharTok{{-}}\NormalTok{e GID}\OtherTok{=}\StringTok{\textasciigrave{}}\AttributeTok{id {-}g}\StringTok{\textasciigrave{}}\NormalTok{ \textbackslash{}}
\SpecialCharTok{{-}}\NormalTok{e UID}\OtherTok{=}\StringTok{\textasciigrave{}}\AttributeTok{id {-}u}\StringTok{\textasciigrave{}}\NormalTok{ \textbackslash{}}
\NormalTok{bestwu}\SpecialCharTok{/}\NormalTok{wechat}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-zotero.sh}{%
\section{File: zotero.sh}\label{file-zotero.sh}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cd }\SpecialCharTok{/}\NormalTok{mnt}\SpecialCharTok{/}\NormalTok{data}\SpecialCharTok{/}\NormalTok{wizard}\SpecialCharTok{/}\NormalTok{Zotero\_linux}\SpecialCharTok{{-}}\NormalTok{x86\_64}
\NormalTok{bash }\SpecialCharTok{{-}}\NormalTok{c }\StringTok{"$(dirname $(realpath $(echo \%k | sed {-}e \textquotesingle{}s/\^{}file:\textbackslash{}/\textbackslash{}///\textquotesingle{})))/zotero {-}url \%U"}
\end{Highlighting}
\end{Shaded}


\end{document}
