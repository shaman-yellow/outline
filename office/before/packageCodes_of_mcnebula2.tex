% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\usepackage{caption} \captionsetup{font={footnotesize},width=6in} \renewcommand{\dblfloatpagefraction}{.9} \makeatletter \renewenvironment{figure} {\def\@captype{figure}} \makeatletter \definecolor{shadecolor}{RGB}{242,242,242} \usepackage{xeCJK} \usepackage{setspace} \setstretch{1.3}
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={R codes of MCnebula2},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{R codes of MCnebula2}
\author{}
\date{\vspace{-2.5em}}

\begin{document}
\maketitle

{
\setcounter{tocdepth}{3}
\tableofcontents
}
\hypertarget{file-base-generic.r}{%
\section{File: base-generic.R}\label{file-base-generic.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# Generic for base method (get or replace data in slots) of class}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @importFrom methods as formalArgs getGeneric getMethodsForDispatch}
\CommentTok{\#\textquotesingle{} @importFrom methods initialize is new selectMethod show showMethods}
\DocumentationTok{\#\# class{-}melody}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"melody"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"melody"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"melody\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"melody\textless{}{-}"}\NormalTok{))}

\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"palette\_set"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"palette\_set"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"palette\_set\textless{}{-}"}\NormalTok{, }
            \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"palette\_set\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"palette\_gradient"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"palette\_gradient"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"palette\_gradient\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"palette\_gradient\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"palette\_stat"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"palette\_stat"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"palette\_stat\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"palette\_stat\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"palette\_col"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"palette\_col"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"palette\_col\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"palette\_col\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"palette\_label"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"palette\_label"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"palette\_label\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"palette\_label\textless{}{-}"}\NormalTok{))}

\DocumentationTok{\#\# class{-}nebula}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"parent\_nebula"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"parent\_nebula"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"parent\_nebula\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"parent\_nebula\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"child\_nebulae"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"child\_nebulae"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"child\_nebulae\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"child\_nebulae\textless{}{-}"}\NormalTok{))}

\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"igraph"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"igraph"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"igraph\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"igraph\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"tbl\_graph"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"tbl\_graph"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"tbl\_graph\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"tbl\_graph\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"layout\_ggraph"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"layout\_ggraph"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"layout\_ggraph\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"layout\_ggraph\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"grid\_layout"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"grid\_layout"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"grid\_layout\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"grid\_layout\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"viewports"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"viewports"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"viewports\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"viewports\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"panel\_viewport"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"panel\_viewport"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"panel\_viewport\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"panel\_viewport\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"legend\_viewport"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"legend\_viewport"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"legend\_viewport\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"legend\_viewport\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"structures\_grob"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"structures\_grob"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"structures\_grob\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"structures\_grob\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"nodes\_ggset"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"nodes\_ggset"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"nodes\_ggset\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"nodes\_ggset\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"nodes\_grob"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"nodes\_grob"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"nodes\_grob\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"nodes\_grob\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"ppcp\_data"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"ppcp\_data"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"ppcp\_data\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"ppcp\_data\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"ration\_data"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"ration\_data"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"ration\_data\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"ration\_data\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"ggset\_annotate"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"ggset\_annotate"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"ggset\_annotate\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"ggset\_annotate\textless{}{-}"}\NormalTok{))}

\DocumentationTok{\#\# class{-}mcnebula}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"creation\_time"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"creation\_time"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"creation\_time\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"creation\_time\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"ion\_mode"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"ion\_mode"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"ion\_mode\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"ion\_mode\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"match.features\_id"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"match.features\_id"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"match.candidates\_id"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"match.candidates\_id"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"specific\_candidate"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"specific\_candidate"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"classification"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"classification"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"hierarchy"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"hierarchy"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"stardust\_classes"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"stardust\_classes"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"features\_annotation"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"features\_annotation"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"features\_quantification"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"features\_quantification"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"features\_quantification\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"features\_quantification\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"sample\_metadata"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"sample\_metadata"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"sample\_metadata\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"sample\_metadata\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"nebula\_index"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"nebula\_index"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"spectral\_similarity"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"spectral\_similarity"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"spectral\_similarity\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"spectral\_similarity\textless{}{-}"}\NormalTok{))}

\DocumentationTok{\#\# class{-}project}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"project\_version"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"project\_version"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"project\_version\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"project\_version\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"project\_path"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"project\_path"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"project\_path\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"project\_path\textless{}{-}"}\NormalTok{))}
\DocumentationTok{\#\# class{-}project\_conformation}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"project\_conformation"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"project\_conformation"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"project\_conformation\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"project\_conformation\textless{}{-}"}\NormalTok{))}

\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"file\_name"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"file\_name"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"file\_name\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"file\_name\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"file\_api"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"file\_api"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"file\_api\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"file\_api\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"attribute\_name"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"attribute\_name"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"attribute\_name\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"attribute\_name\textless{}{-}"}\NormalTok{))}

\DocumentationTok{\#\# class{-}project\_metadata}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"project\_metadata"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"project\_metadata"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"project\_metadata\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"project\_metadata\textless{}{-}"}\NormalTok{))}

\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"metadata"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"metadata"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"metadata\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"metadata\textless{}{-}"}\NormalTok{))}

\DocumentationTok{\#\# class{-}project\_api}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"project\_api"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"project\_api"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"project\_api\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"project\_api\textless{}{-}"}\NormalTok{))}

\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"methods\_read"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"methods\_read"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"methods\_read\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"methods\_read\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"methods\_format"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"methods\_format"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"methods\_format\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"methods\_format\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"methods\_match"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"methods\_match"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"methods\_match\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"methods\_match\textless{}{-}"}\NormalTok{))}

\DocumentationTok{\#\# class{-}project\_dataset}
\DocumentationTok{\#\# class{-}mcn\_dataset}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"project\_dataset"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"project\_dataset"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"project\_dataset\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"project\_dataset\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"mcn\_dataset"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"mcn\_dataset"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"mcn\_dataset\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"mcn\_dataset\textless{}{-}"}\NormalTok{))}

\DocumentationTok{\#\# class{-}msframe}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"msframe"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"msframe"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"msframe\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"msframe\textless{}{-}"}\NormalTok{))}

\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"entity"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{msframe =} \StringTok{"x"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"entity"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"entity\textless{}{-}"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{msframe =} \StringTok{"x"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"entity\textless{}{-}"}\NormalTok{))}

\DocumentationTok{\#\# class{-}command}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"command"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"command"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"command\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"command\textless{}{-}"}\NormalTok{))}

\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"command\_name"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"command\_name"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"command\_name\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"command\_name\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"command\_function"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"command\_function"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"command\_function\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"command\_function\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"command\_args"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"command\_args"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"command\_args\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"command\_args\textless{}{-}"}\NormalTok{))}

\DocumentationTok{\#\# class{-}code\_block}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"code\_block"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"code\_block"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"code\_block\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"code\_block\textless{}{-}"}\NormalTok{))}

\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"codes"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"codes"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"codes\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"codes\textless{}{-}"}\NormalTok{))}

\DocumentationTok{\#\# class{-}ggset}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"ggset"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"ggset"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"ggset\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"ggset\textless{}{-}"}\NormalTok{))}

\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"layers"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"layers"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"layers\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"layers\textless{}{-}"}\NormalTok{))}

\DocumentationTok{\#\# class{-}section}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"section"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"section"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"section\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"section\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"heading"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"heading"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"heading\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"heading\textless{}{-}"}\NormalTok{))}

\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"level"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"level"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"level\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"level\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"paragraph"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"paragraph"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"paragraph\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"paragraph\textless{}{-}"}\NormalTok{))}

\DocumentationTok{\#\# class{-}VIRTUAL}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"subscript"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"subscript"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"subscript\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"subscript\textless{}{-}"}\NormalTok{))}

\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"dataset"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"dataset"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"dataset\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"dataset\textless{}{-}"}\NormalTok{))}

\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"reference"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"reference"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"reference\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"reference\textless{}{-}"}\NormalTok{))}

\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"backtrack"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"backtrack"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"backtrack\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"backtrack\textless{}{-}"}\NormalTok{))}

\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"export\_name"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"export\_name"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"export\_name\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"export\_name\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"export\_path"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"export\_path"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"export\_path\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"export\_path\textless{}{-}"}\NormalTok{))}

\DocumentationTok{\#\# class{-}statistic\_set}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"statistic\_set"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"statistic\_set"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"statistic\_set\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"statistic\_set\textless{}{-}"}\NormalTok{))}

\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"design\_matrix"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"design\_matrix"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"design\_matrix\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"design\_matrix\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"contrast\_matrix"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"contrast\_matrix"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"contrast\_matrix\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"contrast\_matrix\textless{}{-}"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"top\_table"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"top\_table"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"top\_table\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"top\_table\textless{}{-}"}\NormalTok{))}

\DocumentationTok{\#\# class{-}report}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"yaml"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"yaml"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"yaml\textless{}{-}"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"yaml\textless{}{-}"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-class-command.r}{%
\section{File: class-command.R}\label{file-class-command.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# a class to store function and its name and args}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @exportClass command}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases command}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Preparation of an instruction to be executed}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description Packing the funciton and the args inside this class object,}
\CommentTok{\#\textquotesingle{} so that it can be performed easily at any time.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @family call\_commands}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot command\_name character(1). Describe the command name.}
\CommentTok{\#\textquotesingle{} @slot command\_function function.}
\CommentTok{\#\textquotesingle{} @slot command\_args the parameters passed to the function.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname command{-}class}
\CommentTok{\#\textquotesingle{}}
\NormalTok{.command }\OtherTok{\textless{}{-}} 
  \FunctionTok{setClass}\NormalTok{(}\StringTok{"command"}\NormalTok{, }
           \AttributeTok{contains =} \FunctionTok{character}\NormalTok{(),}
           \AttributeTok{representation =} 
             \FunctionTok{representation}\NormalTok{(}\AttributeTok{command\_name =} \StringTok{"character"}\NormalTok{,}
                            \AttributeTok{command\_function =} \StringTok{"function"}\NormalTok{,}
                            \AttributeTok{command\_args =} \StringTok{"list"}
\NormalTok{                            ),}
           \AttributeTok{prototype =} \ConstantTok{NULL}
\NormalTok{           )}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# method}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @exportMethod show}
\CommentTok{\#\textquotesingle{} @aliases show}
\CommentTok{\#\textquotesingle{} @rdname command{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"show"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{object =} \StringTok{"command"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(object)\{}
            \FunctionTok{cat}\NormalTok{(}\FunctionTok{command\_name}\NormalTok{(object), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{            args }\OtherTok{\textless{}{-}} \FunctionTok{vapply}\NormalTok{(}\FunctionTok{command\_args}\NormalTok{(object), }\ControlFlowTok{function}\NormalTok{(v) }\FunctionTok{class}\NormalTok{(v)[}\DecValTok{1}\NormalTok{], }\StringTok{"ch"}\NormalTok{)}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(args) }\SpecialCharTok{\textgreater{}=} \DecValTok{1}\NormalTok{) \{}
              \FunctionTok{cat}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\StringTok{" "}\NormalTok{, }\DecValTok{2}\NormalTok{), }\AttributeTok{collapse =} \StringTok{""}\NormalTok{),}
                         \FunctionTok{names}\NormalTok{(args), }\StringTok{": "}\NormalTok{, args), }\AttributeTok{sep =} \StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{            \} }\ControlFlowTok{else}\NormalTok{ \{}
              \FunctionTok{cat}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\StringTok{" "}\NormalTok{, }\DecValTok{2}\NormalTok{), }\AttributeTok{collapse =} \StringTok{""}\NormalTok{),}
                         \StringTok{"list()"}\NormalTok{), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{            \}}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod command\_name}
\CommentTok{\#\textquotesingle{} @aliases command\_name}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{command\_name\}, \textbackslash{}code\{command\_name\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{command\_name\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname command{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"command\_name"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"command"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{command\_name \})}

\CommentTok{\#\textquotesingle{} @exportMethod command\_name\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases command\_name\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname command{-}class}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   \#\# example 1}
\CommentTok{\#\textquotesingle{}   com \textless{}{-} new\_command(plot, x = 1:10)}
\CommentTok{\#\textquotesingle{}   com}
\CommentTok{\#\textquotesingle{}   call\_command(com)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# example 2}
\CommentTok{\#\textquotesingle{}   com \textless{}{-} new\_command(data.frame, x = 1:10, y = 1:10, z = 1:10)}
\CommentTok{\#\textquotesingle{}   call\_command(com)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# example 3}
\CommentTok{\#\textquotesingle{}   data \textless{}{-} data.frame(x = 1:10, y = 1:10)}
\CommentTok{\#\textquotesingle{}   com1 \textless{}{-} new\_command(ggplot, data)}
\CommentTok{\#\textquotesingle{}   com2 \textless{}{-} new\_command(geom\_point, aes(x = x, y = y))}
\CommentTok{\#\textquotesingle{}   call\_command(com1) + call\_command(com2)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# slots}
\CommentTok{\#\textquotesingle{}   command\_name(com)}
\CommentTok{\#\textquotesingle{}   command\_args(com)}
\CommentTok{\#\textquotesingle{}   command\_function(com)}
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"command\_name"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"command"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{command\_name =}\NormalTok{ value)}
\NormalTok{                 \})}

\CommentTok{\#\textquotesingle{} @exportMethod command\_function}
\CommentTok{\#\textquotesingle{} @aliases command\_function}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{command\_function\}, \textbackslash{}code\{command\_function\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{command\_function\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname command{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"command\_function"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"command"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{command\_function \})}

\CommentTok{\#\textquotesingle{} @exportMethod command\_function\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases command\_function\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname command{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"command\_function"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"command"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{command\_function =}\NormalTok{ value)}
\NormalTok{                 \})}

\CommentTok{\#\textquotesingle{} @exportMethod command\_args}
\CommentTok{\#\textquotesingle{} @aliases command\_args}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{command\_args\}, \textbackslash{}code\{command\_args\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{command\_args\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname command{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"command\_args"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"command"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{command\_args \})}

\CommentTok{\#\textquotesingle{} @exportMethod command\_args\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases command\_args\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname command{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"command\_args"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"command"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{command\_args =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod new\_command}
\CommentTok{\#\textquotesingle{} @aliases new\_command}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{new\_command\}: create an object of [command{-}class].}
\CommentTok{\#\textquotesingle{} @param fun function.}
\CommentTok{\#\textquotesingle{} @param ... parameters (with names or without names) passed to the function.}
\CommentTok{\#\textquotesingle{} @param name character(1). Name to slot \textbackslash{}code\{command\_name\}.}
\CommentTok{\#\textquotesingle{} @rdname command{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"new\_command"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{fun =} \StringTok{"function"}\NormalTok{,}
                        \AttributeTok{name =} \StringTok{"character"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(fun, ..., name)\{}
\NormalTok{            args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(...)}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(args) }\SpecialCharTok{!=} \DecValTok{0}\NormalTok{) \{}
\NormalTok{              args\_name }\OtherTok{\textless{}{-}} \FunctionTok{formalArgs}\NormalTok{(fun)}
              \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(}\FunctionTok{names}\NormalTok{(args))) \{}
                \FunctionTok{names}\NormalTok{(args) }\OtherTok{\textless{}{-}}\NormalTok{ args\_name[}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(args)]}
\NormalTok{              \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{                args\_name }\OtherTok{\textless{}{-}}\NormalTok{ args\_name[}\SpecialCharTok{!}\NormalTok{args\_name }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(args)]}
\NormalTok{                no\_name\_arg }\OtherTok{\textless{}{-}} \FunctionTok{which}\NormalTok{(}\FunctionTok{names}\NormalTok{(args) }\SpecialCharTok{==} \StringTok{""}\NormalTok{)}
                \FunctionTok{names}\NormalTok{(args)[no\_name\_arg] }\OtherTok{\textless{}{-}}\NormalTok{ args\_name[}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(no\_name\_arg)]}
\NormalTok{              \}}
\NormalTok{            \}}
            \FunctionTok{new}\NormalTok{(}\StringTok{"command"}\NormalTok{, }\AttributeTok{command\_name =}\NormalTok{ name, }\AttributeTok{command\_function =}\NormalTok{ fun,}
                \AttributeTok{command\_args =}\NormalTok{ args)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @importFrom rlang as\_label}
\CommentTok{\#\textquotesingle{} @exportMethod new\_command}
\CommentTok{\#\textquotesingle{} @aliases new\_command}
\CommentTok{\#\textquotesingle{} @rdname command{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"new\_command"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"new\_command"}\NormalTok{,}
                                 \AttributeTok{fun =} \StringTok{"function"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(fun, ...)\{}
\NormalTok{            name }\OtherTok{\textless{}{-}}\NormalTok{ rlang}\SpecialCharTok{::}\FunctionTok{as\_label}\NormalTok{(}\FunctionTok{substitute}\NormalTok{(fun))}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(name) }\SpecialCharTok{!=} \DecValTok{1}\NormalTok{) \{}
\NormalTok{              name }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(name[}\DecValTok{2}\NormalTok{], name[}\DecValTok{1}\NormalTok{], name[}\DecValTok{3}\NormalTok{])}
\NormalTok{            \}}
            \FunctionTok{new\_command}\NormalTok{(fun, ..., }\AttributeTok{name =}\NormalTok{ name)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod call\_command}
\CommentTok{\#\textquotesingle{} @aliases call\_command}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{call\_command\}: Execute the function (slot \textbackslash{}code\{command\_function\})}
\CommentTok{\#\textquotesingle{} with the parameters (slot \textbackslash{}code\{command\_args\}).}
\CommentTok{\#\textquotesingle{} @family call\_commands}
\CommentTok{\#\textquotesingle{} @rdname command{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"call\_command"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"command"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \FunctionTok{do.call}\NormalTok{(}\FunctionTok{command\_function}\NormalTok{(x), }\FunctionTok{command\_args}\NormalTok{(x))}
\NormalTok{          \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-class-ggset.r}{%
\section{File: class-ggset.R}\label{file-class-ggset.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# a class to store a series of \textquotesingle{}command\textquotesingle{} for consisting of a plot of \textquotesingle{}ggplot\textquotesingle{}}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @exportClass ggset}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases ggset}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Management for \textquotesingle{}ggplot\textquotesingle{} visualzation}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} Let each packed "ggplot2" function (packed as [command{-}class] object)}
\CommentTok{\#\textquotesingle{} into layers in sequence, allowing post modifications programmatically}
\CommentTok{\#\textquotesingle{} and visualizing as "ggplot2" plot at any time.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @family layerSets}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot layers list with names. Each element of list must be a [command{-}class] object}
\CommentTok{\#\textquotesingle{} packed \textquotesingle{}ggplot2\textquotesingle{} function and its args.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname ggset{-}class}
\CommentTok{\#\textquotesingle{} @order 1}
\CommentTok{\#\textquotesingle{}}
\NormalTok{.ggset }\OtherTok{\textless{}{-}} 
  \FunctionTok{setClass}\NormalTok{(}\StringTok{"ggset"}\NormalTok{, }
           \AttributeTok{contains =} \FunctionTok{c}\NormalTok{(}\StringTok{"layerSet"}\NormalTok{),}
           \AttributeTok{representation =} \FunctionTok{representation}\NormalTok{(),}
           \AttributeTok{prototype =} \ConstantTok{NULL}
\NormalTok{           )}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# validity}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\FunctionTok{setValidity}\NormalTok{(}\StringTok{"ggset"}\NormalTok{, }
            \ControlFlowTok{function}\NormalTok{(object)\{}
\NormalTok{              recepts }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"command"}\NormalTok{)}
\NormalTok{              tip }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"\textquotesingle{}layer\textquotesingle{} in \textquotesingle{}ggset\textquotesingle{} must be: "}\NormalTok{,}
                            \FunctionTok{paste0}\NormalTok{(}\StringTok{"\textquotesingle{}"}\NormalTok{, recepts, }\StringTok{"\textquotesingle{}"}\NormalTok{, }\AttributeTok{collapse =} \StringTok{", "}\NormalTok{))}
              \FunctionTok{validate\_class\_in\_list}\NormalTok{(}\FunctionTok{layers}\NormalTok{(object), recepts, tip)}
\NormalTok{            \})}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# method}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @importFrom crayon silver}
\CommentTok{\#\textquotesingle{} @importFrom crayon yellow}
\CommentTok{\#\textquotesingle{} @exportMethod show\_layers}
\CommentTok{\#\textquotesingle{} @aliases show\_layers}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{show\_layers\}: show functions and parameters in layers}
\CommentTok{\#\textquotesingle{} with a pretty and readable form.}
\CommentTok{\#\textquotesingle{} @rdname ggset{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"show\_layers"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ggset"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
\NormalTok{            layers }\OtherTok{\textless{}{-}} \FunctionTok{layers}\NormalTok{(x)}
            \FunctionTok{cat}\NormalTok{(crayon}\SpecialCharTok{::}\FunctionTok{silver}\NormalTok{(}\StringTok{"layers of"}\NormalTok{, }\FunctionTok{length}\NormalTok{(layers), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{))}
            \FunctionTok{mapply}\NormalTok{(layers, }\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(layers),}
                   \AttributeTok{FUN =} \ControlFlowTok{function}\NormalTok{(com, seq)\{}
                     \FunctionTok{cat}\NormalTok{(crayon}\SpecialCharTok{::}\FunctionTok{silver}\NormalTok{(}\StringTok{"  +++ layer"}\NormalTok{, seq, }\StringTok{"+++}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{))}
                     \FunctionTok{cat}\NormalTok{(}\StringTok{"  "}\NormalTok{, crayon}\SpecialCharTok{::}\FunctionTok{yellow}\NormalTok{(}\FunctionTok{command\_name}\NormalTok{(com)), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{,}
                         \FunctionTok{rep}\NormalTok{(}\StringTok{" "}\NormalTok{, }\DecValTok{4}\NormalTok{), }\StringTok{"Args:}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{, }\AttributeTok{sep =} \StringTok{""}\NormalTok{)}
\NormalTok{                     args }\OtherTok{\textless{}{-}} \FunctionTok{vapply}\NormalTok{(}\FunctionTok{command\_args}\NormalTok{(com), }\ControlFlowTok{function}\NormalTok{(v) }\FunctionTok{class}\NormalTok{(v)[}\DecValTok{1}\NormalTok{], }\StringTok{"ch"}\NormalTok{)}
                     \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(args) }\SpecialCharTok{\textgreater{}=} \DecValTok{1}\NormalTok{) \{}
                       \FunctionTok{cat}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\StringTok{" "}\NormalTok{, }\DecValTok{6}\NormalTok{), }\AttributeTok{collapse =} \StringTok{""}\NormalTok{),}
                                  \FunctionTok{names}\NormalTok{(args), }\StringTok{": "}\NormalTok{, args), }\AttributeTok{sep =} \StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{                     \} }\ControlFlowTok{else}\NormalTok{ \{}
                       \FunctionTok{cat}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\StringTok{" "}\NormalTok{, }\DecValTok{6}\NormalTok{), }\AttributeTok{collapse =} \StringTok{""}\NormalTok{),}
                                  \StringTok{"list()"}\NormalTok{), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{                     \}}
                     \FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{                   \})}
            \FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod new\_ggset}
\CommentTok{\#\textquotesingle{} @aliases new\_ggset}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{new\_ggset\}: Simplified creation of [ggset{-}class] object.}
\CommentTok{\#\textquotesingle{} @param ... An arbitrary number of [command{-}class] object.}
\CommentTok{\#\textquotesingle{} @rdname ggset{-}class}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   data \textless{}{-} data.frame(x = 1:10, y = 1:10)}
\CommentTok{\#\textquotesingle{}   layer1 \textless{}{-} new\_command(ggplot, data)}
\CommentTok{\#\textquotesingle{}   layer2 \textless{}{-} new\_command(geom\_point, aes(x = x, y = y))}
\CommentTok{\#\textquotesingle{}   layer3 \textless{}{-} new\_command(labs, x = "x label", y = "y label")}
\CommentTok{\#\textquotesingle{}   layer4 \textless{}{-} new\_command(theme, text = element\_text(family = "Times"))}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# gather}
\CommentTok{\#\textquotesingle{}   ggset \textless{}{-} new\_ggset(layer1, layer2, layer3, layer4)}
\CommentTok{\#\textquotesingle{}   ggset}
\CommentTok{\#\textquotesingle{}   \#\# visualize}
\CommentTok{\#\textquotesingle{}   p \textless{}{-} call\_command(ggset)}
\CommentTok{\#\textquotesingle{}   p}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# add layers}
\CommentTok{\#\textquotesingle{}   layer5 \textless{}{-} new\_command(}
\CommentTok{\#\textquotesingle{}     geom\_text,}
\CommentTok{\#\textquotesingle{}     aes(x = x, y = y, label = paste0("label\_", x))}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   layer6 \textless{}{-} new\_command(ggtitle, "this is title")}
\CommentTok{\#\textquotesingle{}   ggset \textless{}{-} add\_layers(ggset, layer5, layer6)}
\CommentTok{\#\textquotesingle{}   call\_command(ggset)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# delete layers}
\CommentTok{\#\textquotesingle{}   ggset \textless{}{-} delete\_layers(ggset, 5:6)}
\CommentTok{\#\textquotesingle{}   call\_command(ggset)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# mutate layer}
\CommentTok{\#\textquotesingle{}   ggset \textless{}{-} mutate\_layer(ggset, "theme",}
\CommentTok{\#\textquotesingle{}     legend.position = "none",}
\CommentTok{\#\textquotesingle{}     plot.background = element\_rect(fill = "red")}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   ggset \textless{}{-} mutate\_layer(ggset, "geom\_point",}
\CommentTok{\#\textquotesingle{}     mapping = aes(x = x, y = y, color = x)}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   call\_command(ggset)}
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"new\_ggset"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{... =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(...)\{}
\NormalTok{            args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(...)}
            \FunctionTok{names}\NormalTok{(args) }\OtherTok{\textless{}{-}} \FunctionTok{vapply}\NormalTok{(args, command\_name, }\StringTok{"ch"}\NormalTok{)}
            \FunctionTok{new}\NormalTok{(}\StringTok{"ggset"}\NormalTok{, }\AttributeTok{layers =}\NormalTok{ args)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod mutate\_layer}
\CommentTok{\#\textquotesingle{} @aliases mutate\_layer}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{mutate\_layer\}:}
\CommentTok{\#\textquotesingle{} Pass new parameters or modify pre{-}existing parameters to the packed function.}
\CommentTok{\#\textquotesingle{} @param x [ggset{-}class] object}
\CommentTok{\#\textquotesingle{} @param layer numeric(1) or character(1). If "character", the name must be unique}
\CommentTok{\#\textquotesingle{} in slot \textbackslash{}code\{layers\}.}
\CommentTok{\#\textquotesingle{} @param ... parameters passed to the layer.}
\CommentTok{\#\textquotesingle{} @rdname ggset{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"mutate\_layer"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ggset"}\NormalTok{,}
                        \AttributeTok{layer =} \StringTok{"numeric"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, layer, ...)\{}
\NormalTok{            args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(...)}
\NormalTok{            command }\OtherTok{\textless{}{-}} \FunctionTok{layers}\NormalTok{(x)[[ layer ]]}
\NormalTok{            old }\OtherTok{\textless{}{-}} \FunctionTok{command\_args}\NormalTok{(command)}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(old) }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{) \{}
\NormalTok{              args }\OtherTok{\textless{}{-}} \FunctionTok{vecter\_unique\_by\_names}\NormalTok{(}\FunctionTok{c}\NormalTok{(args, old))}
\NormalTok{            \}}
            \FunctionTok{layers}\NormalTok{(x)[[ layer ]] }\OtherTok{\textless{}{-}} 
              \FunctionTok{do.call}\NormalTok{(new\_command,}
                      \FunctionTok{c}\NormalTok{(}\FunctionTok{command\_function}\NormalTok{(command), args,}
                        \AttributeTok{name =} \FunctionTok{command\_name}\NormalTok{(command)))}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod mutate\_layer}
\CommentTok{\#\textquotesingle{} @aliases mutate\_layer}
\CommentTok{\#\textquotesingle{} @rdname ggset{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"mutate\_layer"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ggset"}\NormalTok{, }\AttributeTok{layer =} \StringTok{"character"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, layer, ...)\{}
\NormalTok{            seq }\OtherTok{\textless{}{-}} \FunctionTok{which}\NormalTok{(}\FunctionTok{names}\NormalTok{(}\FunctionTok{layers}\NormalTok{(x)) }\SpecialCharTok{==}\NormalTok{ layer)}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(seq) }\SpecialCharTok{==} \DecValTok{0}\NormalTok{) \{}
              \FunctionTok{stop}\NormalTok{( }\FunctionTok{paste0}\NormalTok{(}\StringTok{"\textquotesingle{}"}\NormalTok{, layer, }\StringTok{"\textquotesingle{} not found"}\NormalTok{) )}
\NormalTok{            \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(seq) }\SpecialCharTok{\textgreater{}} \DecValTok{1}\NormalTok{) \{}
              \FunctionTok{stop}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"multiple layers of \textquotesingle{}"}\NormalTok{, layer, }\StringTok{"\textquotesingle{} were found"}\NormalTok{))}
\NormalTok{            \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{              x }\OtherTok{\textless{}{-}} \FunctionTok{mutate\_layer}\NormalTok{(x, seq, ...)}
\NormalTok{            \}}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod add\_layers}
\CommentTok{\#\textquotesingle{} @aliases add\_layers}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{add\_layers\}: add extra [command{-}class] objects into slot \textbackslash{}code\{layers\}.}
\CommentTok{\#\textquotesingle{} @param x object contains slot \textbackslash{}code\{layers\}.}
\CommentTok{\#\textquotesingle{} @param ... extra [command{-}class] objects.}
\CommentTok{\#\textquotesingle{} @rdname ggset{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"add\_layers"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ggset"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, ...)\{}
\NormalTok{            args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(...)}
            \FunctionTok{names}\NormalTok{(args) }\OtherTok{\textless{}{-}} \FunctionTok{vapply}\NormalTok{(args, command\_name, }\StringTok{"ch"}\NormalTok{)}
            \FunctionTok{layers}\NormalTok{(x) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FunctionTok{layers}\NormalTok{(x), args)}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod call\_command}
\CommentTok{\#\textquotesingle{} @aliases call\_command}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{call\_command\}: plot as \textquotesingle{}ggplot\textquotesingle{} object.}
\CommentTok{\#\textquotesingle{} @family call\_commands}
\CommentTok{\#\textquotesingle{} @rdname ggset{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"call\_command"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ggset"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
\NormalTok{            layers }\OtherTok{\textless{}{-}} \FunctionTok{layers}\NormalTok{(x)}
            \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(layers)) \{}
\NormalTok{              res }\OtherTok{\textless{}{-}} \FunctionTok{try}\NormalTok{( }\FunctionTok{call\_command}\NormalTok{(layers[[i]]), }\AttributeTok{silent =}\NormalTok{ T )}
              \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{inherits}\NormalTok{(res, }\StringTok{"try{-}error"}\NormalTok{)) \{}
                \FunctionTok{stop}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"the \textquotesingle{}command\textquotesingle{} named \textquotesingle{}"}\NormalTok{, }\FunctionTok{command\_name}\NormalTok{(layers[[i]]),}
                            \StringTok{"\textquotesingle{} (sequence:"}\NormalTok{, i, }\StringTok{") in \textasciigrave{}layers(x)\textasciigrave{} caused error."}\NormalTok{))}
\NormalTok{              \}}
              \ControlFlowTok{if}\NormalTok{ (i }\SpecialCharTok{==} \DecValTok{1}\NormalTok{) \{}
\NormalTok{                p }\OtherTok{\textless{}{-}} \FunctionTok{call\_command}\NormalTok{(layers[[}\DecValTok{1}\NormalTok{]])}
\NormalTok{              \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{                p }\OtherTok{\textless{}{-}}\NormalTok{ p }\SpecialCharTok{+}\NormalTok{ res}
\NormalTok{              \}}
\NormalTok{            \}}
            \FunctionTok{return}\NormalTok{(p)}
\NormalTok{          \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-class-mcn_dataset.r}{%
\section{File: class-mcn\_dataset.R}\label{file-class-mcn_dataset.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# a class to store the filtered dataset from \textquotesingle{}project\_dataset\textquotesingle{}}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @exportClass mcn\_dataset}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases mcn\_dataset}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Store processed data }
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} This is a class object used to store filtered data and formated data.}
\CommentTok{\#\textquotesingle{} These data would be used for further analysis or visualization.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @seealso [dataset{-}class]}
\CommentTok{\#\textquotesingle{} @seealso [subscript{-}class]}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot dataset list with names of [subscript{-}class]. Store preliminary filtered data.}
\CommentTok{\#\textquotesingle{} @slot reference list with names of standard names. Store formated data, which is useful}
\CommentTok{\#\textquotesingle{} reference for further analysis or visualization.}
\CommentTok{\#\textquotesingle{} @slot backtrack list with names. Recovery stations halfway through data processing.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname mcn\_dataset{-}class}
\CommentTok{\#\textquotesingle{}}
\NormalTok{.mcn\_dataset }\OtherTok{\textless{}{-}} 
  \FunctionTok{setClass}\NormalTok{(}\StringTok{"mcn\_dataset"}\NormalTok{, }
           \AttributeTok{contains =} \FunctionTok{c}\NormalTok{(}\StringTok{"dataset"}\NormalTok{, }\StringTok{"reference"}\NormalTok{, }\StringTok{"backtrack"}\NormalTok{),}
           \AttributeTok{prototype =} \ConstantTok{NULL}
\NormalTok{           )}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# method}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @exportMethod mcn\_dataset}
\CommentTok{\#\textquotesingle{} @aliases mcn\_dataset}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{mcn\_dataset\}, \textbackslash{}code\{mcn\_dataset\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{mcn\_dataset\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname mcn\_dataset{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"mcn\_dataset"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{mcn\_dataset \})}

\CommentTok{\#\textquotesingle{} @exportMethod mcn\_dataset\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases mcn\_dataset\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname mcn\_dataset{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"mcn\_dataset"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{mcn\_dataset =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod latest}
\CommentTok{\#\textquotesingle{} @aliases latest}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{latest\}: get the first data in \textbackslash{}code\{dataset\} slot and}
\CommentTok{\#\textquotesingle{} format as "tbl". Equals:}
\CommentTok{\#\textquotesingle{} {-} \textbackslash{}code\{latest(object)\}}
\CommentTok{\#\textquotesingle{} {-} \textbackslash{}code\{tibble::as\_tibble(entity(dataset(x)[[1]]))\}.}
\CommentTok{\#\textquotesingle{} @family datasets}
\CommentTok{\#\textquotesingle{} @family latests}
\CommentTok{\#\textquotesingle{} @rdname mcn\_dataset{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"latest"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcn\_dataset"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
\NormalTok{            tibble}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(}\FunctionTok{entity}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(x)[[}\DecValTok{1}\NormalTok{]]))}
\NormalTok{          \})}


\CommentTok{\#\textquotesingle{} @exportMethod extract\_mcnset}
\CommentTok{\#\textquotesingle{} @aliases extract\_mcnset}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{extract\_mcnset\}: For fast extract data in object which containing}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{mcn\_dataset\} slot. Normally not used.}
\CommentTok{\#\textquotesingle{} @param subscript See [subscript{-}class]}
\CommentTok{\#\textquotesingle{} @rdname mcn\_dataset{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"extract\_mcnset"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{, }\AttributeTok{subscript =} \StringTok{"character"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, subscript)\{}
            \ControlFlowTok{if}\NormalTok{ ( }\FunctionTok{any}\NormalTok{( subscript }\SpecialCharTok{==} \FunctionTok{names}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(x))) ) )}
\NormalTok{              msframe }\OtherTok{\textless{}{-}} \FunctionTok{dataset}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(x))[[ subscript ]]}
            \ControlFlowTok{else}
              \FunctionTok{stop}\NormalTok{(}\StringTok{"\textasciigrave{}subscript\textasciigrave{} not found in \textasciigrave{}dataset(mcn\_dataset(x))\textasciigrave{}"}\NormalTok{)}
\NormalTok{            lst }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(msframe)}
            \FunctionTok{names}\NormalTok{(lst) }\OtherTok{\textless{}{-}}\NormalTok{ subscript}
            \FunctionTok{return}\NormalTok{(lst)}
\NormalTok{          \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-class-mcnebula.r}{%
\section{File: class-mcnebula.R}\label{file-class-mcnebula.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# MCnebula2 overall object}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @aliases MCnebula2}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Overview of MCnebula2}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description }
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} MCnebula2 was used for metabonomics data analysis.}
\CommentTok{\#\textquotesingle{} It is written in the S4 system of object{-}oriented programming,}
\CommentTok{\#\textquotesingle{} and starts with a "class", namely "mcnebula".}
\CommentTok{\#\textquotesingle{} The whole process takes the "mcnebula" as the operating object to obtain visual}
\CommentTok{\#\textquotesingle{} results or operating objects.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} Most methods of MCnebula2 are S4 methods and have the characteristics of}
\CommentTok{\#\textquotesingle{} parameterized polymorphism, that is, different functions will be used for}
\CommentTok{\#\textquotesingle{} processing according to different parameters passed to the same method.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} MCnebula workflow is a complete metabolomics data analysis process,}
\CommentTok{\#\textquotesingle{} including initial data preprocessing (data format conversion, feature detection),}
\CommentTok{\#\textquotesingle{} compound identification based on MS/MS,}
\CommentTok{\#\textquotesingle{} statistical analysis,}
\CommentTok{\#\textquotesingle{} compound structure and chemical class focusing,}
\CommentTok{\#\textquotesingle{} multi{-}level data visualization, output report, etc.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} It should be noted that the MCnebula2 R package currently cannot realize}
\CommentTok{\#\textquotesingle{} the entire analysis process of MCnebula workflow.}
\CommentTok{\#\textquotesingle{} If users want to complete the entire workflow,}
\CommentTok{\#\textquotesingle{} other software beyond the R console}
\CommentTok{\#\textquotesingle{} (for example, the MSconvert tool of proteowizard is used for data format conversion,}
\CommentTok{\#\textquotesingle{} which is a tool widely applicable to metabonomics and proteomics) should be used.}
\CommentTok{\#\textquotesingle{} This is a pity, but we will gradually integrate all parts of the workflow into this R package}
\CommentTok{\#\textquotesingle{} in the future to achieve one{-}stop analysis.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} The analysis process in R is integrated into the following methods:}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} {-} [initialize\_mcnebula()]}
\CommentTok{\#\textquotesingle{} {-} [filter\_structure()]}
\CommentTok{\#\textquotesingle{} {-} [create\_reference()]}
\CommentTok{\#\textquotesingle{} {-} [filter\_formula()]}
\CommentTok{\#\textquotesingle{} {-} [create\_stardust\_classes()]}
\CommentTok{\#\textquotesingle{} {-} [create\_features\_annotation()]}
\CommentTok{\#\textquotesingle{} {-} [cross\_filter\_stardust()]}
\CommentTok{\#\textquotesingle{} {-} [create\_nebula\_index()]}
\CommentTok{\#\textquotesingle{} {-} [compute\_spectral\_similarity()]}
\CommentTok{\#\textquotesingle{} {-} [create\_parent\_nebula()]}
\CommentTok{\#\textquotesingle{} {-} [create\_child\_nebulae()]}
\CommentTok{\#\textquotesingle{} {-} [create\_parent\_layout()]}
\CommentTok{\#\textquotesingle{} {-} [create\_child\_layouts()]}
\CommentTok{\#\textquotesingle{} {-} [activate\_nebulae()]}
\CommentTok{\#\textquotesingle{} {-} [visualize()]}
\CommentTok{\#\textquotesingle{} {-} [binary\_comparison()]}
\CommentTok{\#\textquotesingle{} {-} ...}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @details}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} \textbackslash{}bold\{Overall.\} We know that the analysis of untargeted LC{-}MS/MS dataset generally}
\CommentTok{\#\textquotesingle{} begin with feature detection.}
\CommentTok{\#\textquotesingle{} It detects \textquotesingle{}peaks\textquotesingle{} as features in MS1 (MASS level 1) data.}
\CommentTok{\#\textquotesingle{} Each feature may represents a compound, and assigned with MS2 (MASS level 2) spectra.}
\CommentTok{\#\textquotesingle{} The MS2 spectra was used to find out the compound identity.}
\CommentTok{\#\textquotesingle{} The difficulty lies in annotating these features to discover their compound identity,}
\CommentTok{\#\textquotesingle{} mining out meaningful information, so as to serve further biological research.}
\CommentTok{\#\textquotesingle{} In addition, the un{-}targeted LC{-}MS/MS dataset is general a huge dataset,}
\CommentTok{\#\textquotesingle{} which leads to time{-}consuming analysis of the whole process.}
\CommentTok{\#\textquotesingle{} Herein, a classified visualization method, called MCnebula,}
\CommentTok{\#\textquotesingle{} was used for addressing these difficulty.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} MCnebula utilizes the state{-}of{-}the{-}art computer prediction technology,}
\CommentTok{\#\textquotesingle{} SIRIUS workflow (SIRIUS, ZODIAC, CSI:fingerID, CANOPUS),}
\CommentTok{\#\textquotesingle{} for compound formula prediction, structure retrieve and classification prediction}
\CommentTok{\#\textquotesingle{} (\textbackslash{}url\{https://bio.informatik.uni{-}jena.de/software/sirius/\}).}
\CommentTok{\#\textquotesingle{} MCnebula integrates an abundance{-}based classes (ABC) selection algorithm}
\CommentTok{\#\textquotesingle{} into features annotation:}
\CommentTok{\#\textquotesingle{} depending on the user,}
\CommentTok{\#\textquotesingle{} MCnebula focuses chemical classes with more or less features in the dataset}
\CommentTok{\#\textquotesingle{} (the abundance of classes), visualizes them, and displays the features they involved;}
\CommentTok{\#\textquotesingle{} these classes can be dominant structural classes or sub{-}structural classes.}
\CommentTok{\#\textquotesingle{} With MCnebula, we can switch from untargeted to targeted analysis,}
\CommentTok{\#\textquotesingle{} focusing precisely on the compound or chemical class of interest to the researcher.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} \textbackslash{}bold\{MCnebula2.\} The MCnebula2 package itself does not contain any part of }
\CommentTok{\#\textquotesingle{} molecular formula prediction, structure prediction and chemical prediction of compounds,}
\CommentTok{\#\textquotesingle{} so the accuracy of these parts is not involved.}
\CommentTok{\#\textquotesingle{} MCnebula2 performs downstream analysis by extracting the prediction data from SIRIUS project.}
\CommentTok{\#\textquotesingle{} The core of MCnebula2 is its chemical filtering algorithm, called ABC selection algorithm.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} \textbackslash{}bold\{Chemical structure and formula.\} To explain the ABC selection algorithm in detail,}
\CommentTok{\#\textquotesingle{} we need to start with MS/MS spectral analysis and identification of compounds:}
\CommentTok{\#\textquotesingle{} The analysis of MS/MS spectrum is a process of inference and prediction.}
\CommentTok{\#\textquotesingle{} For example, we speculate the composition of elements based on the molecular weight of MS1;}
\CommentTok{\#\textquotesingle{} combined with the possible fragmentation pattern of MS2 spectrum,}
\CommentTok{\#\textquotesingle{} we speculate the potential molecular formula of a compound;}
\CommentTok{\#\textquotesingle{} finally, we look for the exact compound from the compound structure database.}
\CommentTok{\#\textquotesingle{} Sometimes, this process is full of uncertainty,}
\CommentTok{\#\textquotesingle{} because there are too many factors that affect the reliability of MS/MS data}
\CommentTok{\#\textquotesingle{} and the correctness of inference.}
\CommentTok{\#\textquotesingle{} It can be assumed that there are complex candidates}
\CommentTok{\#\textquotesingle{} for the potential chemical molecular formula,}
\CommentTok{\#\textquotesingle{} chemical structure and chemical class behind MS/MS spectrum.}
\CommentTok{\#\textquotesingle{} Suppose we have these data of candidates now,}
\CommentTok{\#\textquotesingle{} MCnebula2 extracted these candidates and obtained the unique}
\CommentTok{\#\textquotesingle{} molecular formula and chemical structure for each MS/MS spectrum}
\CommentTok{\#\textquotesingle{} based on the highest score of}
\CommentTok{\#\textquotesingle{} chemical structure prediction; in this process, as most algorithms do,}
\CommentTok{\#\textquotesingle{} we make a choice based on the score,}
\CommentTok{\#\textquotesingle{} and only select the result of highest score.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} The chemical formula and structure candidates can obtain by methods:}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} {-} [filter\_formula()]}
\CommentTok{\#\textquotesingle{} {-} [filter\_structure()]}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} In order to obtain the best (maybe), corresponding and unique chemical formula}
\CommentTok{\#\textquotesingle{} and structure from complex candidates, an important intermediate link:}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} {-} [create\_reference()]}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} Above, we talked about chemical molecular formula,}
\CommentTok{\#\textquotesingle{} chemical structural formula and chemical classes.}
\CommentTok{\#\textquotesingle{} We obtained the unique chemical molecular formula and chemical structure formula}
\CommentTok{\#\textquotesingle{} for reference by scoring and ranking.}
\CommentTok{\#\textquotesingle{} But for chemical classes, we can\textquotesingle{}t adopt such a simple way to get things done.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} \textbackslash{}bold\{Chemical classification.\} Chemical classification is a complex system.}
\CommentTok{\#\textquotesingle{} Here, we only discuss the structure based chemotaxonomy system,}
\CommentTok{\#\textquotesingle{} because the MS/MS spectrum is more indicative of the structure of compounds}
\CommentTok{\#\textquotesingle{} than biological activity and other information.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} According to the division of the overall structure and local structure of compounds,}
\CommentTok{\#\textquotesingle{} we can call the structural characteristics as the dominant structure and substructure.}
\CommentTok{\#\textquotesingle{} (\textbackslash{}url\{https://jcheminf.biomedcentral.com/articles/10.1186/s13321{-}016{-}0174{-}y\}).}
\CommentTok{\#\textquotesingle{} Correspondingly, in the chemical classification system,}
\CommentTok{\#\textquotesingle{} we can not only classify according to the dominant structure,}
\CommentTok{\#\textquotesingle{} but also classify according to the substructure.}
\CommentTok{\#\textquotesingle{} The chemical classification based on the dominant structure of compounds is easy to understand,}
\CommentTok{\#\textquotesingle{} because we generally define it in this way.}
\CommentTok{\#\textquotesingle{} For example, we will classify Taxifolin as "flavones", not "phenols",}
\CommentTok{\#\textquotesingle{} although its local structure has a substructure of "phenol".}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} We hope to classify a compound by its dominant structure rather than substructure,}
\CommentTok{\#\textquotesingle{} because such classify is more concise and contains more information.}
\CommentTok{\#\textquotesingle{} However, in the process of MS/MS spectral analysis,}
\CommentTok{\#\textquotesingle{} we sometimes can only make chemical classification based on the substructure of compounds,}
\CommentTok{\#\textquotesingle{} which may be due to: uncertainty in the process of structural analysis;}
\CommentTok{\#\textquotesingle{} it may be an unknown compound; MS/MS spectral fragment information is insufficient.}
\CommentTok{\#\textquotesingle{} In this case, it is necessary for us to classify the compounds with the aid of}
\CommentTok{\#\textquotesingle{} substructure information, otherwise we have no knowledge of the compounds}
\CommentTok{\#\textquotesingle{} for which we cannot obtain dominant structure information.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} Above, we discussed the complex chemical classification}
\CommentTok{\#\textquotesingle{} for the substructure and dominant structure of compounds.}
\CommentTok{\#\textquotesingle{} We must also be clear about the complexity of another aspect of chemotaxonomy,}
\CommentTok{\#\textquotesingle{} i.e., the hierarchy of classification.}
\CommentTok{\#\textquotesingle{} This is easy to understand. For example, "Flavones" belongs to its superior, "Flavonoids";}
\CommentTok{\#\textquotesingle{} its next higher level, "Phynylpropanoids and polyketides";}
\CommentTok{\#\textquotesingle{} the further upward classification is "organic compounds".}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} \textbackslash{}bold\{ABC selection.\}}
\CommentTok{\#\textquotesingle{} The above section discusses the inferential prediction of individual MS/MS spectrum.}
\CommentTok{\#\textquotesingle{} In the un{-}targeted LC{-}MS/MS dataset, each feature has a corresponding MS/MS spectrum,}
\CommentTok{\#\textquotesingle{} and there are thousands of features in total.}
\CommentTok{\#\textquotesingle{} The ABC selection algorithm regards all features as a whole,}
\CommentTok{\#\textquotesingle{} examines the number and abundance of features of each chemical classification}
\CommentTok{\#\textquotesingle{} (classification at different levels, classification of substructure and dominant structure),}
\CommentTok{\#\textquotesingle{} and then selects representative classes}
\CommentTok{\#\textquotesingle{} (mainly screening the classes according to the number or abundance range of features)}
\CommentTok{\#\textquotesingle{} to serve the subsequent analysis.}
\CommentTok{\#\textquotesingle{} The core methods for ABC selection algorithm are:}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} {-} [create\_stardust\_classes()]}
\CommentTok{\#\textquotesingle{} {-} [cross\_filter\_stardust()]}
\CommentTok{\#\textquotesingle{} {-} [create\_nebula\_index()]}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} Whether it is all filtered by the algorithm provided by MCnebula2\textquotesingle{}s function}
\CommentTok{\#\textquotesingle{} or custom filtered for some chemical classes, we now have a data called \textquotesingle{}nebula\_index\textquotesingle{}.}
\CommentTok{\#\textquotesingle{} This data records a number of chemical classes and the \textquotesingle{}features\textquotesingle{} attributed to them.}
\CommentTok{\#\textquotesingle{} The subsequent analysis process or visualization will be based on it.}
\CommentTok{\#\textquotesingle{} Each chemical class is considered as a \textquotesingle{}nebula\textquotesingle{} and its classified \textquotesingle{}features\textquotesingle{}}
\CommentTok{\#\textquotesingle{} are the components of these \textquotesingle{}nebulae\textquotesingle{}. In the visualization, these \textquotesingle{}nebulae\textquotesingle{} will}
\CommentTok{\#\textquotesingle{} be visualized as networks. Formally, we call these \textquotesingle{}nebulae\textquotesingle{} formed on the basis}
\CommentTok{\#\textquotesingle{} of \textquotesingle{}nebula\_index\textquotesingle{} data as Child{-}Nebulae. In comparison, when we put all the}
\CommentTok{\#\textquotesingle{} \textquotesingle{}features\textquotesingle{} together to form a large network, then this \textquotesingle{}nebula\textquotesingle{} is called Parent{-}Nebulae.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name ABSTRACT{-}MCnebula2}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @export mcnebula}
\CommentTok{\#\textquotesingle{} @exportClass mcnebula}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases mcnebula}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Overall object class of MCnebula2}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description For analysis of MCnebula2, all data stored in this class object,}
\CommentTok{\#\textquotesingle{} all main methods performed with this object.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @family nebulae}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot creation\_time character(1).}
\CommentTok{\#\textquotesingle{} @slot ion\_mode character(1).}
\CommentTok{\#\textquotesingle{} @slot melody [melody{-}class] object.}
\CommentTok{\#\textquotesingle{} @slot mcn\_dataset [mcn\_dataset{-}class] object.}
\CommentTok{\#\textquotesingle{} @slot statistic\_set [statistic\_set{-}class] object.}
\CommentTok{\#\textquotesingle{} @slot ... Slots inherit from [project{-}class], [nebula{-}class], [export{-}class].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname mcnebula{-}class}
\CommentTok{\#\textquotesingle{}}
\NormalTok{mcnebula }\OtherTok{\textless{}{-}} 
  \FunctionTok{setClass}\NormalTok{(}\StringTok{"mcnebula"}\NormalTok{, }
           \AttributeTok{contains =} \FunctionTok{c}\NormalTok{(}\StringTok{"project"}\NormalTok{, }\StringTok{"nebula"}\NormalTok{, }\StringTok{"export"}\NormalTok{),}
           \AttributeTok{representation =} 
             \FunctionTok{representation}\NormalTok{(}\AttributeTok{creation\_time =} \StringTok{"character"}\NormalTok{,}
                            \AttributeTok{ion\_mode =} \StringTok{"character"}\NormalTok{,}
                            \AttributeTok{melody =} \StringTok{"melody"}\NormalTok{,}
                            \AttributeTok{mcn\_dataset =} \StringTok{"mcn\_dataset"}\NormalTok{,}
                            \AttributeTok{statistic\_set =} \StringTok{"statistic\_set"}
\NormalTok{                            ),}
           \AttributeTok{prototype =} \FunctionTok{prototype}\NormalTok{(}\AttributeTok{project\_version =} \StringTok{"sirius.v4"}\NormalTok{,}
                                 \AttributeTok{project\_path =} \StringTok{"."}\NormalTok{,}
                                 \AttributeTok{creation\_time =} \FunctionTok{date}\NormalTok{(),}
                                 \AttributeTok{ion\_mode =} \StringTok{"pos"}\NormalTok{)}
\NormalTok{           )}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# method}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @exportMethod show}
\CommentTok{\#\textquotesingle{} @aliases show}
\CommentTok{\#\textquotesingle{} @rdname mcnebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"show"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{object =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(object)\{}
            \FunctionTok{message}\NormalTok{( }\StringTok{"A project of MCnebula2"}\NormalTok{, }\StringTok{": "}\NormalTok{,}
                    \FunctionTok{format}\NormalTok{(}\FunctionTok{object.size}\NormalTok{(object), }\AttributeTok{units =} \StringTok{"MB"}\NormalTok{))}
\NormalTok{          \})}


\CommentTok{\#\textquotesingle{} @exportMethod latest}
\CommentTok{\#\textquotesingle{} @aliases latest}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{latest(x, slot, subscript)\}: get the data in slot}
\CommentTok{\#\textquotesingle{} (\textbackslash{}code\{mcn\_dataset(object)\} or \textbackslash{}code\{prject\_dataset(object)\})}
\CommentTok{\#\textquotesingle{} and format as \textquotesingle{}tbl\textquotesingle{}.}
\CommentTok{\#\textquotesingle{} @param x [mcnebula{-}class] object}
\CommentTok{\#\textquotesingle{} @param slot Character. Slot name.}
\CommentTok{\#\textquotesingle{} @param subscript numeric or character. The sequence or name for dataset in the \textquotesingle{}list\textquotesingle{}.}
\CommentTok{\#\textquotesingle{} @family latests}
\CommentTok{\#\textquotesingle{} @family subscripts}
\CommentTok{\#\textquotesingle{} @seealso [tibble::as\_tibble()]}
\CommentTok{\#\textquotesingle{} @rdname mcnebula{-}class}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} mcnebula()}
\CommentTok{\#\textquotesingle{}   class(test)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   test \textless{}{-} mcn\_5features}
\CommentTok{\#\textquotesingle{}   \#\# slots}
\CommentTok{\#\textquotesingle{}   ion\_mode(test)}
\CommentTok{\#\textquotesingle{}   project\_version(test)}
\CommentTok{\#\textquotesingle{}   melody(test)}
\CommentTok{\#\textquotesingle{}   export\_name(test)}
\CommentTok{\#\textquotesingle{}   \#\# ...}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# \textquotesingle{}fast channel\textquotesingle{}}
\CommentTok{\#\textquotesingle{}   palette\_label(test)}
\CommentTok{\#\textquotesingle{}   palette\_stat(test)}
\CommentTok{\#\textquotesingle{}   sample\_metadata(test)}
\CommentTok{\#\textquotesingle{}   \#\# ...}
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"latest"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{, }\AttributeTok{slot =} \StringTok{"character"}\NormalTok{,}
                        \AttributeTok{subscript =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, slot, subscript)\{}
\NormalTok{            fun }\OtherTok{\textless{}{-}} \FunctionTok{match.fun}\NormalTok{(slot)}
\NormalTok{            res }\OtherTok{\textless{}{-}} \FunctionTok{dataset}\NormalTok{(}\FunctionTok{fun}\NormalTok{(x))}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(res) }\SpecialCharTok{==} \DecValTok{0}\NormalTok{)}
              \FunctionTok{return}\NormalTok{()}
\NormalTok{            res }\OtherTok{\textless{}{-}}\NormalTok{ res[[ subscript ]]}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(res))}
              \FunctionTok{return}\NormalTok{()}
            \ControlFlowTok{else}
              \FunctionTok{return}\NormalTok{(tibble}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(}\FunctionTok{entity}\NormalTok{(res)))}
\NormalTok{          \})}


\CommentTok{\#\textquotesingle{} @exportMethod latest}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{latest()\}: get the default parameters for the method \textbackslash{}code\{latest\}.}
\CommentTok{\#\textquotesingle{} @rdname mcnebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"latest"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"latest"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{()\{}
            \FunctionTok{list}\NormalTok{(}\AttributeTok{slot =} \StringTok{"mcn\_dataset"}\NormalTok{,}
                 \AttributeTok{subscript =} \DecValTok{1}\NormalTok{)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod latest}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{latest(x, ...)\}: use the default parameters whatever \textquotesingle{}missing\textquotesingle{}}
\CommentTok{\#\textquotesingle{} while performing the method \textbackslash{}code\{latest\}.}
\CommentTok{\#\textquotesingle{} @rdname mcnebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"latest"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, slot, subscript)\{}
            \FunctionTok{reCallMethod}\NormalTok{(}\StringTok{"latest"}\NormalTok{, }\FunctionTok{.fresh\_param}\NormalTok{(}\FunctionTok{latest}\NormalTok{()))}
\NormalTok{          \})}


\CommentTok{\#\textquotesingle{} @exportMethod creation\_time}
\CommentTok{\#\textquotesingle{} @aliases creation\_time}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{creation\_time\}, \textbackslash{}code\{creation\_time\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{creation\_time\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname mcnebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"creation\_time"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{creation\_time \})}

\CommentTok{\#\textquotesingle{} @exportMethod creation\_time\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases creation\_time\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname mcnebula{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"creation\_time"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{creation\_time =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod ion\_mode}
\CommentTok{\#\textquotesingle{} @aliases ion\_mode}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{ion\_mode\}, \textbackslash{}code\{ion\_mode\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{ion\_mode\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname mcnebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"ion\_mode"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{ion\_mode \})}

\CommentTok{\#\textquotesingle{} @exportMethod ion\_mode\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases ion\_mode\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname mcnebula{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"ion\_mode"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{ion\_mode =}\NormalTok{ value)}
\NormalTok{                 \})}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# get infrustructure object}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @exportMethod palette\_set}
\CommentTok{\#\textquotesingle{} @aliases palette\_set}
\CommentTok{\#\textquotesingle{} @description  \textbackslash{}code\{palette\_set\}, \textbackslash{}code\{palette\_gradient\}, \textbackslash{}code\{palette\_stat\},}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{palette\_col\}: fast channel to obtain the downstream slot.}
\CommentTok{\#\textquotesingle{} For \textbackslash{}code\{palette\_set\}, e.g., getter for the \textbackslash{}code\{palette\_set\} slot in sub{-}object}
\CommentTok{\#\textquotesingle{} of \textbackslash{}code\{melody\} slot of the object. Equals:}
\CommentTok{\#\textquotesingle{} {-} \textbackslash{}code\{palette\_set(melody(object))\}}
\CommentTok{\#\textquotesingle{} {-} \textbackslash{}code\{palette\_set(object)\}.}
\CommentTok{\#\textquotesingle{} @rdname mcnebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"palette\_set"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \FunctionTok{palette\_set}\NormalTok{(}\FunctionTok{melody}\NormalTok{(x))}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod palette\_gradient}
\CommentTok{\#\textquotesingle{} @aliases palette\_gradient}
\CommentTok{\#\textquotesingle{} @rdname mcnebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"palette\_gradient"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \FunctionTok{palette\_gradient}\NormalTok{(}\FunctionTok{melody}\NormalTok{(x))}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod palette\_stat}
\CommentTok{\#\textquotesingle{} @aliases palette\_stat}
\CommentTok{\#\textquotesingle{} @rdname mcnebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"palette\_stat"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \FunctionTok{palette\_stat}\NormalTok{(}\FunctionTok{melody}\NormalTok{(x))}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod palette\_col}
\CommentTok{\#\textquotesingle{} @aliases palette\_col}
\CommentTok{\#\textquotesingle{} @rdname mcnebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"palette\_col"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \FunctionTok{palette\_col}\NormalTok{(}\FunctionTok{melody}\NormalTok{(x))}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod palette\_label}
\CommentTok{\#\textquotesingle{} @aliases palette\_label}
\CommentTok{\#\textquotesingle{} @rdname mcnebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"palette\_label"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \FunctionTok{palette\_label}\NormalTok{(}\FunctionTok{melody}\NormalTok{(x))}
\NormalTok{          \})}


\CommentTok{\#\textquotesingle{} @exportMethod reference}
\CommentTok{\#\textquotesingle{} @aliases reference}
\CommentTok{\#\textquotesingle{} @description  \textbackslash{}code\{reference\}: fast channel to obtain}
\CommentTok{\#\textquotesingle{} the downstream slot, getter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{reference\} slot in sub{-}object}
\CommentTok{\#\textquotesingle{} of \textbackslash{}code\{mcn\_dataset\} slot of the object. Equals:}
\CommentTok{\#\textquotesingle{} {-} \textbackslash{}code\{reference(mcn\_dataset(object))\} }
\CommentTok{\#\textquotesingle{} {-} \textbackslash{}code\{reference(object)\}}
\CommentTok{\#\textquotesingle{} @rdname mcnebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"reference"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \FunctionTok{reference}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(x))}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod specific\_candidate}
\CommentTok{\#\textquotesingle{} @aliases specific\_candidate}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{specific\_candidate\}, \textbackslash{}code\{hierarchy\}, \textbackslash{}code\{stardust\_classes\},}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{nebula\_index\}, \textbackslash{}code\{spectral\_similarity\}, \textbackslash{}code\{features\_annotation\},}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{features\_quantification\}, \textbackslash{}code\{sample\_metadata\}:}
\CommentTok{\#\textquotesingle{} fast channel to obtain data (mostly \textquotesingle{}tbl\textquotesingle{} or \textquotesingle{}data.frame\textquotesingle{})}
\CommentTok{\#\textquotesingle{} inside the downstream slot (\textquotesingle{}list\textquotesingle{}). e.g., getter}
\CommentTok{\#\textquotesingle{} for the data named \textbackslash{}code\{specific\_candidate\} in}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{reference\} slot (a \textquotesingle{}list\textquotesingle{}) in sub{-}object}
\CommentTok{\#\textquotesingle{} of \textbackslash{}code\{mcn\_dataset\} slot of the object. Equals:}
\CommentTok{\#\textquotesingle{} {-} \textbackslash{}code\{reference(mcn\_dataset(object))$specific\_candidate\}}
\CommentTok{\#\textquotesingle{} {-} \textbackslash{}code\{specific\_candidate(object)\}.}
\CommentTok{\#\textquotesingle{} @rdname mcnebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"specific\_candidate"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \FunctionTok{reference}\NormalTok{(x)[[ }\StringTok{"specific\_candidate"}\NormalTok{ ]]}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod hierarchy}
\CommentTok{\#\textquotesingle{} @aliases hierarchy}
\CommentTok{\#\textquotesingle{} @rdname mcnebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"hierarchy"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \FunctionTok{reference}\NormalTok{(x)[[ }\StringTok{"hierarchy"}\NormalTok{ ]]}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod stardust\_classes}
\CommentTok{\#\textquotesingle{} @aliases stardust\_classes}
\CommentTok{\#\textquotesingle{} @rdname mcnebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"stardust\_classes"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \FunctionTok{reference}\NormalTok{(x)[[ }\StringTok{"stardust\_classes"}\NormalTok{ ]]}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod nebula\_index}
\CommentTok{\#\textquotesingle{} @aliases nebula\_index}
\CommentTok{\#\textquotesingle{} @rdname mcnebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"nebula\_index"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \FunctionTok{reference}\NormalTok{(x)[[ }\StringTok{"nebula\_index"}\NormalTok{ ]]}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod spectral\_similarity}
\CommentTok{\#\textquotesingle{} @aliases spectral\_similarity}
\CommentTok{\#\textquotesingle{} @rdname mcnebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"spectral\_similarity"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \FunctionTok{reference}\NormalTok{(x)[[ }\StringTok{"spectral\_similarity"}\NormalTok{ ]]}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod spectral\_similarity\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases spectral\_similarity\textless{}{-}}
\CommentTok{\#\textquotesingle{} @description  \textbackslash{}code\{spectral\_similarity\textless{}{-}\}, \textbackslash{}code\{features\_quantification\textless{}{-}\},}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{sample\_metadata\textless{}{-}\}: fast channel to replace}
\CommentTok{\#\textquotesingle{} data (mostly \textquotesingle{}tbl\textquotesingle{} or \textquotesingle{}data.frame\textquotesingle{}) inside the downstream slot (\textquotesingle{}list\textquotesingle{}). e.g., setter}
\CommentTok{\#\textquotesingle{} for the data named \textbackslash{}code\{spectral\_similarity\} in}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{reference\} slot (a \textquotesingle{}list\textquotesingle{}) in sub{-}object}
\CommentTok{\#\textquotesingle{} of \textbackslash{}code\{mcn\_dataset\} slot of the object. Similar:}
\CommentTok{\#\textquotesingle{} {-} \textbackslash{}code\{reference(mcn\_dataset(object))$spectral\_similarity\textless{}{-}\}}
\CommentTok{\#\textquotesingle{} {-} \textbackslash{}code\{spectral\_similarity(object)\textless{}{-}\}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} But the latter not only replace and also validate.}
\CommentTok{\#\textquotesingle{} @rdname mcnebula{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"spectral\_similarity"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{.check\_columns}\NormalTok{(value, }\FunctionTok{list}\NormalTok{(}\StringTok{".features\_id1"}\NormalTok{, }\StringTok{".features\_id2"}\NormalTok{,}
                                              \StringTok{"similarity"}\NormalTok{),}
                                  \StringTok{"spectral\_similarity"}\NormalTok{)}
                   \FunctionTok{reference}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(x))}\SpecialCharTok{$}\NormalTok{spectral\_similarity }\OtherTok{\textless{}{-}}\NormalTok{ value}
                   \FunctionTok{return}\NormalTok{(x)}
\NormalTok{                 \})}

\CommentTok{\#\textquotesingle{} @exportMethod features\_annotation}
\CommentTok{\#\textquotesingle{} @aliases features\_annotation}
\CommentTok{\#\textquotesingle{} @rdname mcnebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"features\_annotation"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \FunctionTok{reference}\NormalTok{(x)[[ }\StringTok{"features\_annotation"}\NormalTok{ ]]}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod features\_quantification}
\CommentTok{\#\textquotesingle{} @aliases features\_quantification}
\CommentTok{\#\textquotesingle{} @rdname mcnebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"features\_quantification"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \FunctionTok{reference}\NormalTok{(x)[[ }\StringTok{"features\_quantification"}\NormalTok{ ]]}
\NormalTok{          \})}

\NormalTok{.features\_quantification }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(x)\{}
\NormalTok{    data }\OtherTok{\textless{}{-}} \FunctionTok{features\_quantification}\NormalTok{(x)}
\NormalTok{    .features\_id }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{.features\_id}
\NormalTok{    data}\SpecialCharTok{$}\NormalTok{.features\_id }\OtherTok{\textless{}{-}} \ConstantTok{NULL}
\NormalTok{    data }\OtherTok{\textless{}{-}} \FunctionTok{as.matrix}\NormalTok{(data)}
    \FunctionTok{rownames}\NormalTok{(data) }\OtherTok{\textless{}{-}}\NormalTok{ .features\_id}
\NormalTok{    data}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @importFrom dplyr select}
\CommentTok{\#\textquotesingle{} @exportMethod features\_quantification\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases features\_quantification\textless{}{-}}
\CommentTok{\#\textquotesingle{} @rdname mcnebula{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"features\_quantification"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{.check\_columns}\NormalTok{(value, }\FunctionTok{list}\NormalTok{(}\StringTok{".features\_id"}\NormalTok{),}
                                  \StringTok{"features\_quantification"}\NormalTok{)}
                   \FunctionTok{.check\_type}\NormalTok{(dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(value, }\SpecialCharTok{{-}}\NormalTok{.features\_id),}
                               \StringTok{"numeric"}\NormalTok{, }\StringTok{"features\_quantification"}\NormalTok{)}
                   \FunctionTok{reference}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(x))}\SpecialCharTok{$}\NormalTok{features\_quantification }\OtherTok{\textless{}{-}}\NormalTok{ value}
                   \FunctionTok{return}\NormalTok{(x)}
\NormalTok{                 \})}

\CommentTok{\#\textquotesingle{} @exportMethod sample\_metadata}
\CommentTok{\#\textquotesingle{} @aliases sample\_metadata}
\CommentTok{\#\textquotesingle{} @rdname mcnebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"sample\_metadata"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \FunctionTok{reference}\NormalTok{(x)[[ }\StringTok{"sample\_metadata"}\NormalTok{ ]]}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod sample\_metadata\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases sample\_metadata\textless{}{-}}
\CommentTok{\#\textquotesingle{} @rdname mcnebula{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"sample\_metadata"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{.check\_data}\NormalTok{(x, }\FunctionTok{list}\NormalTok{(}\AttributeTok{features\_quantification =}
                                       \StringTok{"features\_quantification"}\NormalTok{), }\StringTok{"(x) \textless{}{-}"}\NormalTok{)}
                   \FunctionTok{.check\_columns}\NormalTok{(value, }\FunctionTok{list}\NormalTok{(}\StringTok{"sample"}\NormalTok{, }\StringTok{"group"}\NormalTok{), }\StringTok{"sample\_metadata"}\NormalTok{)}
                   \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{any}\NormalTok{(}\SpecialCharTok{!}\NormalTok{value}\SpecialCharTok{$}\NormalTok{sample }\SpecialCharTok{\%in\%} \FunctionTok{colnames}\NormalTok{(}\FunctionTok{features\_quantification}\NormalTok{(x))))}
                     \FunctionTok{stop}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"the name in \textquotesingle{}sample\textquotesingle{} column in \textquotesingle{}sample\_metadata\textquotesingle{} "}\NormalTok{,}
                                 \StringTok{"must all involved in \textquotesingle{}features\_quantification\textquotesingle{}"}\NormalTok{))}
                   \FunctionTok{reference}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(x))}\SpecialCharTok{$}\NormalTok{sample\_metadata }\OtherTok{\textless{}{-}}\NormalTok{ value}
                   \FunctionTok{return}\NormalTok{(x)}
\NormalTok{                 \})}

\CommentTok{\#\textquotesingle{} @exportMethod classification}
\CommentTok{\#\textquotesingle{} @aliases classification}
\CommentTok{\#\textquotesingle{} @description  \textbackslash{}code\{classification\}: fast channel to obtain}
\CommentTok{\#\textquotesingle{} data deeply inside the downstream slot (\textquotesingle{}list\textquotesingle{}), getter}
\CommentTok{\#\textquotesingle{} for the data named \textbackslash{}code\{".canopus"\} in}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{dataset\} slot (a \textquotesingle{}list\textquotesingle{}) in sub{-}object}
\CommentTok{\#\textquotesingle{} of \textbackslash{}code\{project\_dataset\} slot of the object. Equals:}
\CommentTok{\#\textquotesingle{} {-} \textbackslash{}code\{tibble::as\_tibble(entity(dataset(project\_dataset(object))$.canopus))\}}
\CommentTok{\#\textquotesingle{} {-} \textbackslash{}code\{classification(object)\}.}
\CommentTok{\#\textquotesingle{} @rdname mcnebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"classification"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
\NormalTok{            res }\OtherTok{\textless{}{-}} \FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(x))[[ }\StringTok{".canopus"}\NormalTok{ ]]}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(res))}
              \FunctionTok{return}\NormalTok{()}
            \ControlFlowTok{else}
              \FunctionTok{return}\NormalTok{(dplyr}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(}\FunctionTok{entity}\NormalTok{(res)))}
\NormalTok{          \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-class-melody.r}{%
\section{File: class-melody.R}\label{file-class-melody.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# a class to store hex color set.}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @exportClass melody}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases melody}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Mutiple color palette in hexadecimal code}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} This is a class object store Hex color used for visualization.}
\CommentTok{\#\textquotesingle{} In default (use [initialize\_mcnebula()] to initialize the object),}
\CommentTok{\#\textquotesingle{} these these Hex color in each palette were get from package \textbackslash{}code\{ggsci\}.}
\CommentTok{\#\textquotesingle{} Most of these palette in this package would passed to [ggplot2::scale\_fill\_manual] for}
\CommentTok{\#\textquotesingle{} filling color. So, let these Hex color with names may work well to specify target.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @seealso [ggsci::pal\_simpsons()], [ggsci::pal\_igv()], [ggsci::pal\_ucscgb()],}
\CommentTok{\#\textquotesingle{} [ggsci::pal\_d3()]...}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot palette\_set character with names or not. Hex color.}
\CommentTok{\#\textquotesingle{} @slot palette\_gradient character with names or not. Hex color.}
\CommentTok{\#\textquotesingle{} @slot palette\_stat character with names or not. Hex color.}
\CommentTok{\#\textquotesingle{} @slot palette\_col character with names or not. Hex color.}
\CommentTok{\#\textquotesingle{} @slot palette\_label character with names or not. Hex color.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname melody{-}class}
\CommentTok{\#\textquotesingle{}}
\NormalTok{.melody }\OtherTok{\textless{}{-}} 
  \FunctionTok{setClass}\NormalTok{(}\StringTok{"melody"}\NormalTok{, }
           \AttributeTok{contains =} \FunctionTok{character}\NormalTok{(),}
           \AttributeTok{representation =} 
             \FunctionTok{representation}\NormalTok{(}\AttributeTok{palette\_set =} \StringTok{"character"}\NormalTok{,}
                            \AttributeTok{palette\_gradient =} \StringTok{"character"}\NormalTok{,}
                            \AttributeTok{palette\_stat =} \StringTok{"character"}\NormalTok{,}
                            \AttributeTok{palette\_col =} \StringTok{"character"}\NormalTok{,}
                            \AttributeTok{palette\_label =} \StringTok{"character"}
\NormalTok{                            ),}
           \AttributeTok{prototype =} \ConstantTok{NULL}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# method}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @exportMethod show}
\CommentTok{\#\textquotesingle{} @aliases show}
\CommentTok{\#\textquotesingle{} @rdname melody{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"show"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{object=} \StringTok{"melody"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(object)\{}
            \FunctionTok{.show}\NormalTok{(object)}
\NormalTok{          \})}


\CommentTok{\#\textquotesingle{} @exportMethod melody}
\CommentTok{\#\textquotesingle{} @aliases melody}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{melody\}, \textbackslash{}code\{melody\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{melody\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname melody{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"melody"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{melody \})}

\CommentTok{\#\textquotesingle{} @exportMethod melody\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases melody\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname melody{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"melody"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{melody =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod palette\_set}
\CommentTok{\#\textquotesingle{} @aliases palette\_set}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{palette\_set\}, \textbackslash{}code\{palette\_set\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{palette\_set\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname melody{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"palette\_set"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"melody"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{palette\_set \})}

\CommentTok{\#\textquotesingle{} @exportMethod palette\_set\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases palette\_set\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname melody{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"palette\_set"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"melody"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{palette\_set =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod palette\_gradient}
\CommentTok{\#\textquotesingle{} @aliases palette\_gradient}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{palette\_gradient\}, \textbackslash{}code\{palette\_gradient\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{palette\_gradient\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname melody{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"palette\_gradient"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"melody"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{palette\_gradient \})}

\CommentTok{\#\textquotesingle{} @exportMethod palette\_gradient\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases palette\_gradient\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname melody{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"palette\_gradient"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"melody"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{palette\_gradient =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod palette\_stat}
\CommentTok{\#\textquotesingle{} @aliases palette\_stat}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{palette\_stat\}, \textbackslash{}code\{palette\_stat\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{palette\_stat\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname melody{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"palette\_stat"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"melody"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{palette\_stat \})}

\CommentTok{\#\textquotesingle{} @exportMethod palette\_stat\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases palette\_stat\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname melody{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"palette\_stat"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"melody"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{palette\_stat =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod palette\_col}
\CommentTok{\#\textquotesingle{} @aliases palette\_col}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{palette\_col\}, \textbackslash{}code\{palette\_col\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{palette\_col\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname melody{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"palette\_col"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"melody"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{palette\_col \})}

\CommentTok{\#\textquotesingle{} @exportMethod palette\_col\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases palette\_col\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname melody{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"palette\_col"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"melody"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{palette\_col =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod palette\_label}
\CommentTok{\#\textquotesingle{} @aliases palette\_label}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{palette\_label\}, \textbackslash{}code\{palette\_label\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{palette\_label\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname melody{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"palette\_label"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"melody"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{palette\_label \})}

\CommentTok{\#\textquotesingle{} @exportMethod palette\_label\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases palette\_label\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname melody{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"palette\_label"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"melody"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{palette\_label =}\NormalTok{ value)}
\NormalTok{                 \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-class-msframe.r}{%
\section{File: class-msframe.R}\label{file-class-msframe.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# msframe: class based on data.frame}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @exportClass msframe}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases msframe}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title format and filter table data}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} Class for table data manipulation inside this package.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @family subscripts}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot entity data.frame.}
\CommentTok{\#\textquotesingle{} @slot subscript character(1). See [subscript{-}class].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname msframe{-}class}
\CommentTok{\#\textquotesingle{}}
\NormalTok{.msframe }\OtherTok{\textless{}{-}} 
  \FunctionTok{setClass}\NormalTok{(}\StringTok{"msframe"}\NormalTok{, }
           \AttributeTok{contains =} \StringTok{"subscript"}\NormalTok{,}
           \AttributeTok{representation =} 
             \FunctionTok{representation}\NormalTok{(}\AttributeTok{entity =} \StringTok{"data.frame"}\NormalTok{),}
           \AttributeTok{prototype =} \ConstantTok{NULL}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# methods}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @exportMethod show}
\CommentTok{\#\textquotesingle{} @aliases show}
\CommentTok{\#\textquotesingle{} @rdname msframe{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"show"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{object =} \StringTok{"msframe"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(object)\{}
            \FunctionTok{cat}\NormalTok{( }\StringTok{"A class of }\SpecialCharTok{\textbackslash{}"}\StringTok{msframe}\SpecialCharTok{\textbackslash{}"}\StringTok{ of"}\NormalTok{, }\FunctionTok{subscript}\NormalTok{(object), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{          \})}


\CommentTok{\#\textquotesingle{} @exportMethod msframe}
\CommentTok{\#\textquotesingle{} @aliases msframe}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{msframe\}, \textbackslash{}code\{msframe\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{msframe\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname msframe{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"msframe"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{msframe \})}

\CommentTok{\#\textquotesingle{} @exportMethod msframe\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases msframe\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname msframe{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"msframe"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{msframe =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod latest}
\CommentTok{\#\textquotesingle{} @aliases latest}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{latest\}: get data inside \textbackslash{}code\{entity(object)\} and format as}
\CommentTok{\#\textquotesingle{} \textquotesingle{}tbl\textquotesingle{}.}
\CommentTok{\#\textquotesingle{} @family latests}
\CommentTok{\#\textquotesingle{} @seealso [tibble::as\_tibble()]}
\CommentTok{\#\textquotesingle{} @rdname msframe{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"latest"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"msframe"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
\NormalTok{            tibble}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(}\FunctionTok{entity}\NormalTok{(x))}
\NormalTok{          \})}


\CommentTok{\#\textquotesingle{} @exportMethod entity}
\CommentTok{\#\textquotesingle{} @aliases entity}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{entity\}, \textbackslash{}code\{entity\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{entity\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname msframe{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"entity"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"msframe"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{entity \})}

\CommentTok{\#\textquotesingle{} @exportMethod entity\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases entity\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname msframe{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"entity"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"msframe"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{entity =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod format\_msframe}
\CommentTok{\#\textquotesingle{} @aliases format\_msframe}
\CommentTok{\#\textquotesingle{} @rdname msframe{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"format\_msframe"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"format\_msframe"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"msframe"}\NormalTok{,}
                                 \AttributeTok{fun\_format =} \StringTok{"function"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, fun\_format)\{}
            \FunctionTok{entity}\NormalTok{(x) }\OtherTok{\textless{}{-}} \FunctionTok{format\_msframe}\NormalTok{(}\FunctionTok{entity}\NormalTok{(x), }\AttributeTok{fun\_format =}\NormalTok{ fun\_format)}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod format\_msframe}
\CommentTok{\#\textquotesingle{} @aliases format\_msframe}
\CommentTok{\#\textquotesingle{} @rdname msframe{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"format\_msframe"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"format\_msframe"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"data.frame"}\NormalTok{,}
                                 \AttributeTok{fun\_format =} \StringTok{"function"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, fun\_format)\{}
\NormalTok{            results }\OtherTok{\textless{}{-}} \FunctionTok{try}\NormalTok{(}\FunctionTok{fun\_format}\NormalTok{(x), }\AttributeTok{silent =}\NormalTok{ T)}
            \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{inherits}\NormalTok{(results, }\StringTok{"try{-}error"}\NormalTok{)) \{}
\NormalTok{              x[[ }\StringTok{".candidates\_id"}\NormalTok{ ]] }\OtherTok{\textless{}{-}}\NormalTok{ results}
\NormalTok{            \}}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}


\CommentTok{\#\textquotesingle{} @exportMethod format\_msframe}
\CommentTok{\#\textquotesingle{} @aliases format\_msframe}
\CommentTok{\#\textquotesingle{} @rdname msframe{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"format\_msframe"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"format\_msframe"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"msframe"}\NormalTok{,}
                                 \AttributeTok{names =} \StringTok{"character"}\NormalTok{,}
                                 \AttributeTok{types =} \StringTok{"character"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, names, types)\{}
            \ControlFlowTok{if}\NormalTok{( }\SpecialCharTok{!}\FunctionTok{is.character}\NormalTok{(}\FunctionTok{names}\NormalTok{(names)) )}
              \FunctionTok{stop}\NormalTok{( }\StringTok{"the \textasciigrave{}names\textasciigrave{} is unformat"}\NormalTok{ )}
            \ControlFlowTok{if}\NormalTok{( }\SpecialCharTok{!}\FunctionTok{is.character}\NormalTok{(}\FunctionTok{names}\NormalTok{(types)) )}
              \FunctionTok{stop}\NormalTok{( }\StringTok{"the \textasciigrave{}types\textasciigrave{} is unformat"}\NormalTok{ )}
            \FunctionTok{.format\_msframe}\NormalTok{(x, names, types)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod format\_msframe}
\CommentTok{\#\textquotesingle{} @aliases format\_msframe}
\CommentTok{\#\textquotesingle{} @rdname msframe{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"format\_msframe"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"format\_msframe"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"msframe"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
\NormalTok{            names }\OtherTok{\textless{}{-}} \FunctionTok{.get\_attribute\_name\_sirius.v4}\NormalTok{()}
\NormalTok{            types }\OtherTok{\textless{}{-}} \FunctionTok{.get\_attribute\_type\_sirius.v4}\NormalTok{()}
            \FunctionTok{.format\_msframe}\NormalTok{(x, names, types)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod format\_msframe}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases format\_msframe}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{format\_msframe\}:}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x [msframe{-}class] object.}
\CommentTok{\#\textquotesingle{} @param names character with names.}
\CommentTok{\#\textquotesingle{} e.g., c(tani.score = "tanimotoSimilarity", mol.formula = "molecularFormula").}
\CommentTok{\#\textquotesingle{} @param fun\_names function to get names.}
\CommentTok{\#\textquotesingle{} e.g., \textbackslash{}code\{MCnebula2:::.get\_attribute\_name\_sirius.v4()\}}
\CommentTok{\#\textquotesingle{} @param types character with names.}
\CommentTok{\#\textquotesingle{} e.g., c(tani.score = "numeric", mol.formula = "character").}
\CommentTok{\#\textquotesingle{} @param fun\_types function to get types.}
\CommentTok{\#\textquotesingle{} e.g., \textbackslash{}code\{MCnebula2:::.get\_attribute\_type\_sirius.v4()\}}
\CommentTok{\#\textquotesingle{} @param fun\_format function to format slot \textbackslash{}code\{entity\}.}
\CommentTok{\#\textquotesingle{} e.g., \textbackslash{}code\{MCnebula2:::.format\_msframe()\}}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname msframe{-}class}
\CommentTok{\#\textquotesingle{}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"format\_msframe"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"format\_msframe"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"msframe"}\NormalTok{,}
                                 \AttributeTok{fun\_names =} \StringTok{"function"}\NormalTok{,}
                                 \AttributeTok{fun\_types =} \StringTok{"function"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, fun\_names, fun\_types)\{}
            \FunctionTok{.format\_msframe}\NormalTok{(x, }\FunctionTok{fun\_names}\NormalTok{(), }\FunctionTok{fun\_types}\NormalTok{())}
\NormalTok{          \})}

\NormalTok{.format\_msframe }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(x, names, types)\{}
    \ControlFlowTok{if}\NormalTok{( }\FunctionTok{any}\NormalTok{(}\FunctionTok{names}\NormalTok{(names) }\SpecialCharTok{==} \StringTok{"...sig"}\NormalTok{) ) \{}
\NormalTok{      rs }\OtherTok{\textless{}{-}} \FunctionTok{which}\NormalTok{( names }\SpecialCharTok{==} \FunctionTok{subscript}\NormalTok{(x) }\SpecialCharTok{\&} \FunctionTok{names}\NormalTok{(names) }\SpecialCharTok{==} \StringTok{"...sig"}\NormalTok{)}
      \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(rs) }\SpecialCharTok{!=} \DecValTok{0}\NormalTok{) \{}
\NormalTok{        rs }\OtherTok{\textless{}{-}}\NormalTok{ rs }\SpecialCharTok{+} \DecValTok{1}
\NormalTok{        re }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(names)}
        \ControlFlowTok{for}\NormalTok{( i }\ControlFlowTok{in}\NormalTok{ rs}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(names) )\{}
          \ControlFlowTok{if}\NormalTok{( }\FunctionTok{names}\NormalTok{(names)[i] }\SpecialCharTok{==} \StringTok{"...sig"}\NormalTok{ ) \{}
\NormalTok{            re }\OtherTok{\textless{}{-}}\NormalTok{ i }\SpecialCharTok{{-}} \DecValTok{1}
            \ControlFlowTok{break}
\NormalTok{          \}}
\NormalTok{        \}}
\NormalTok{        names }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(names[rs}\SpecialCharTok{:}\NormalTok{re], names)}
\NormalTok{      \}}
\NormalTok{      names }\OtherTok{\textless{}{-}} \FunctionTok{vec\_unique\_by\_value}\NormalTok{(names)}
\NormalTok{      names }\OtherTok{\textless{}{-}}\NormalTok{ names[}\FunctionTok{names}\NormalTok{(names) }\SpecialCharTok{!=} \StringTok{"...sig"}\NormalTok{]}
\NormalTok{    \}}
\NormalTok{    x }\OtherTok{\textless{}{-}} \FunctionTok{.format\_msframe\_names}\NormalTok{(x, names)}
\NormalTok{    names }\OtherTok{\textless{}{-}}\NormalTok{ names[}\FunctionTok{names}\NormalTok{(names) }\SpecialCharTok{\%in\%} \FunctionTok{colnames}\NormalTok{(}\FunctionTok{entity}\NormalTok{(x))]}
    \FunctionTok{.format\_msframe\_types}\NormalTok{(x, names, types)}
\NormalTok{  \}}

\NormalTok{.format\_msframe\_names }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(x, names)\{}
\NormalTok{    pattern }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"\^{}"}\NormalTok{, names, }\StringTok{"$"}\NormalTok{)}
    \FunctionTok{colnames}\NormalTok{(}\FunctionTok{entity}\NormalTok{(x)) }\OtherTok{\textless{}{-}}
      \FunctionTok{mapply\_rename\_col}\NormalTok{(pattern, }\FunctionTok{names}\NormalTok{(names), }\FunctionTok{colnames}\NormalTok{(}\FunctionTok{entity}\NormalTok{(x)))}
    \FunctionTok{return}\NormalTok{(x)}
\NormalTok{  \}}

\NormalTok{.format\_msframe\_types }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(x, names, types)\{}
    \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \FunctionTok{names}\NormalTok{(names)) \{}
      \ControlFlowTok{if}\NormalTok{ (i }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(types))}
\NormalTok{        target\_type }\OtherTok{\textless{}{-}}\NormalTok{ types[[i]]}
      \ControlFlowTok{else}
\NormalTok{        target\_type }\OtherTok{\textless{}{-}} \StringTok{"character"}
\NormalTok{      fun }\OtherTok{\textless{}{-}} \FunctionTok{match.fun}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"is."}\NormalTok{, target\_type))}
      \ControlFlowTok{if}\NormalTok{ ( }\SpecialCharTok{!}\FunctionTok{fun}\NormalTok{(}\FunctionTok{entity}\NormalTok{(x)[[i]]) )\{}
\NormalTok{        fun }\OtherTok{\textless{}{-}} \FunctionTok{match.fun}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"as."}\NormalTok{, target\_type))}
        \FunctionTok{entity}\NormalTok{(x)[[i]] }\OtherTok{\textless{}{-}} \FunctionTok{fun}\NormalTok{(}\FunctionTok{entity}\NormalTok{(x)[[i]])}
\NormalTok{      \}}
\NormalTok{    \}}
    \FunctionTok{return}\NormalTok{(x)}
\NormalTok{  \}}


\CommentTok{\#\textquotesingle{} @exportMethod filter\_msframe}
\CommentTok{\#\textquotesingle{} @aliases filter\_msframe}
\CommentTok{\#\textquotesingle{} @rdname msframe{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"filter\_msframe"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"filter\_msframe"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"msframe"}\NormalTok{, }\AttributeTok{fun\_filter =} \StringTok{"function"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, fun\_filter, ...)\{}
            \FunctionTok{filter\_msframe}\NormalTok{(x, }\AttributeTok{fun\_filter =}\NormalTok{ fun\_filter,}
                           \AttributeTok{f =} \SpecialCharTok{\textasciitilde{}}\NormalTok{ .features\_id, ...)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod filter\_msframe}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases filter\_msframe}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{filter\_msframe\}: filter data in slot \textbackslash{}code\{entity\} (data.frame).}
\CommentTok{\#\textquotesingle{} @note The class is not for normal use of the package.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x [msframe{-}class] object.}
\CommentTok{\#\textquotesingle{} @param fun\_filter function used to filter the slot \textbackslash{}code\{entity\} (data.frame).}
\CommentTok{\#\textquotesingle{} e.g., \textbackslash{}code\{dplyr::filter()\}, \textbackslash{}code\{head()\}.}
\CommentTok{\#\textquotesingle{} @param f formula passed to \textbackslash{}code\{split()\}.}
\CommentTok{\#\textquotesingle{} @param ... extra parameter passed to fun\_filter.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname msframe{-}class}
\CommentTok{\#\textquotesingle{}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"filter\_msframe"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"filter\_msframe"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"msframe"}\NormalTok{, }\AttributeTok{fun\_filter =} \StringTok{"function"}\NormalTok{,}
                                 \AttributeTok{f =} \StringTok{"formula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, fun\_filter, f, ...)\{}
            \FunctionTok{.message\_info}\NormalTok{(}\StringTok{"msframe"}\NormalTok{, }\StringTok{"filter\_msframe"}\NormalTok{,}
                      \FunctionTok{paste0}\NormalTok{(}\StringTok{"group\_by: "}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(f, }\AttributeTok{collapse =} \StringTok{" "}\NormalTok{))}
\NormalTok{            )}
\NormalTok{            entity }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{( }\FunctionTok{split}\NormalTok{(}\FunctionTok{entity}\NormalTok{(x), }\AttributeTok{f =}\NormalTok{ f), }\AttributeTok{FUN =}\NormalTok{ fun\_filter, ...)}
            \FunctionTok{entity}\NormalTok{(x) }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(entity, }\AttributeTok{fill =}\NormalTok{ T)}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-class-nebula.r}{%
\section{File: class-nebula.R}\label{file-class-nebula.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# a class to store network component}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @exportClass parent\_nebula}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases parent\_nebula}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{parent\_nebula\}: Store data for visualization of}
\CommentTok{\#\textquotesingle{} Parent{-}Nebula.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\CommentTok{\#\textquotesingle{}}
\NormalTok{.parent\_nebula }\OtherTok{\textless{}{-}} 
  \FunctionTok{setClass}\NormalTok{(}\StringTok{"parent\_nebula"}\NormalTok{, }
           \AttributeTok{contains =} \FunctionTok{character}\NormalTok{(),}
           \AttributeTok{representation =} 
             \FunctionTok{representation}\NormalTok{(}\AttributeTok{igraph =} \StringTok{"ANY"}\NormalTok{,}
                            \AttributeTok{tbl\_graph =} \StringTok{"ANY"}\NormalTok{,}
                            \AttributeTok{layout\_ggraph =} \StringTok{"ANY"}\NormalTok{,}
                            \AttributeTok{ggset =} \StringTok{"ggset"}
\NormalTok{                            ),}
           \AttributeTok{prototype =} \ConstantTok{NULL}
\NormalTok{  )}

\CommentTok{\#\textquotesingle{} @exportClass child\_nebulae}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases child\_nebulae}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{child\_nebulae\}: store data for visualization of}
\CommentTok{\#\textquotesingle{} Child{-}Nebulae.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot igraph "igraph" object or its list. See [igraph::graph\_from\_data\_frame()].}
\CommentTok{\#\textquotesingle{} The slot contains edges and nodes data of Child{-}Nebulae or Parent{-}Nebula.}
\CommentTok{\#\textquotesingle{} The "igraph" object can be output use [igraph::write\_graph()] as ".graphml" file,}
\CommentTok{\#\textquotesingle{} which belong to a network data format that can be operated by other software such as}
\CommentTok{\#\textquotesingle{} Cytoscape (\textbackslash{}url\{https://cytoscape.org/\}).}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot tbl\_graph "tbl\_graph" object or its list. See [tidygraph::as\_tbl\_graph()].}
\CommentTok{\#\textquotesingle{} Converted from slot \textbackslash{}code\{igraph\}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot layout\_ggraph "layout\_ggraph" object or its list. See [ggraph::create\_layout()].}
\CommentTok{\#\textquotesingle{} Create from slot \textbackslash{}code\{tbl\_graph\}, passed to [ggraph::ggraph()] for visualization.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot grid\_layout "layout" object. See [grid::grid.layout()].}
\CommentTok{\#\textquotesingle{} Grid layout for position of each Child{-}Nebula to visualize.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot viewports list with names. Each element must be "viewport" object.}
\CommentTok{\#\textquotesingle{} See [grid::viewport()]. Position for each Child{-}Nebula to visualize.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot panel\_viewport "viewport" object. See [grid::viewport()]. For visualization,}
\CommentTok{\#\textquotesingle{} the position to place overall Child{-}Nebulae.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot legend\_viewport "viewport" object. See [grid::viewport()]. For visualization,}
\CommentTok{\#\textquotesingle{} the position to place legend.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot ggset [ggset{-}class] object or its list with names. Each [ggset{-}class] object}
\CommentTok{\#\textquotesingle{} can be visualized directly use [call\_command()].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot structures\_grob list with names. Each element is a "grob" object.}
\CommentTok{\#\textquotesingle{} See [grid::grob()]. Use [grid::grid.draw()] to visualize the chemical structure.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot nodes\_ggset list of [ggset{-}class] object. For drawing each node of \textquotesingle{}features\textquotesingle{}}
\CommentTok{\#\textquotesingle{} (\textquotesingle{}features\textquotesingle{} means the detected peaks while processing LC{-}MS data)}
\CommentTok{\#\textquotesingle{} with annotation. Use [call\_command()] to visualize the [ggset{-}class].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot nodes\_grob list of "grob" object. Converted from slot \textbackslash{}code\{nodes\_ggset\} with slot}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{structures\_grob\}. Use [grid::grid.draw()] to visualize the "grob".}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot ppcp\_data list with names. Each element is a data.frame. This is an}
\CommentTok{\#\textquotesingle{} annotation data of \textquotesingle{}features\textquotesingle{} which would be visualize in nodes border}
\CommentTok{\#\textquotesingle{} as a radial bar plot. \textbackslash{}code\{ppcp\_data\}, i.e., posterior probability of}
\CommentTok{\#\textquotesingle{} classification prediction. See [filter\_ppcp()].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot ration\_data list with names. Each element is a data.frame. This is an}
\CommentTok{\#\textquotesingle{} annotation data of \textquotesingle{}features\textquotesingle{} which would be visualize in nodes nucleus as}
\CommentTok{\#\textquotesingle{} ring plot. Generally, \textbackslash{}code\{ration\_data\} is the statistic data for samples.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot ggset\_annotate a list of [ggset{-}class] object. The annotated Child{-}Nebulae}
\CommentTok{\#\textquotesingle{} gathered from slot \textbackslash{}code\{ggset\} and slot \textbackslash{}code\{nodes\_grob\}. }
\CommentTok{\#\textquotesingle{} Use [call\_command()] to visualize the [ggset{-}class]. Be care, the object}
\CommentTok{\#\textquotesingle{} sometimes is too large that need lot of time to loading for visualization.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\CommentTok{\#\textquotesingle{}}
\NormalTok{.child\_nebulae }\OtherTok{\textless{}{-}} 
  \FunctionTok{setClass}\NormalTok{(}\StringTok{"child\_nebulae"}\NormalTok{, }
           \AttributeTok{contains =} \FunctionTok{character}\NormalTok{(),}
           \AttributeTok{representation =} 
             \FunctionTok{representation}\NormalTok{(}\AttributeTok{igraph =} \StringTok{"list"}\NormalTok{,}
                            \AttributeTok{tbl\_graph =} \StringTok{"list"}\NormalTok{,}
                            \AttributeTok{layout\_ggraph =} \StringTok{"list"}\NormalTok{,}
                            \AttributeTok{grid\_layout =} \StringTok{"ANY"}\NormalTok{,}
                            \AttributeTok{viewports =} \StringTok{"list"}\NormalTok{,}
                            \AttributeTok{panel\_viewport =} \StringTok{"ANY"}\NormalTok{,}
                            \AttributeTok{legend\_viewport =} \StringTok{"ANY"}\NormalTok{,}
                            \AttributeTok{ggset =} \StringTok{"list"}\NormalTok{,}
                            \AttributeTok{structures\_grob =} \StringTok{"list"}\NormalTok{,}
                            \AttributeTok{nodes\_ggset =} \StringTok{"list"}\NormalTok{,}
                            \AttributeTok{nodes\_grob =} \StringTok{"list"}\NormalTok{,}
                            \AttributeTok{ppcp\_data =} \StringTok{"list"}\NormalTok{,}
                            \AttributeTok{ration\_data =} \StringTok{"list"}\NormalTok{,}
                            \AttributeTok{ggset\_annotate =} \StringTok{"list"}
\NormalTok{                            ),}
           \AttributeTok{prototype =} \ConstantTok{NULL}
\NormalTok{  )}

\CommentTok{\#\textquotesingle{} @exportClass nebula}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases nebula}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Visualization component of chemical Nebulae/Nebula}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description This class store multiple components for visualization.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @family nebulae}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot parent\_nebula [parent\_nebula{-}class] object.}
\CommentTok{\#\textquotesingle{} @slot child\_nebulae [child\_nebulae{-}class] object.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\CommentTok{\#\textquotesingle{} @order 1}
\CommentTok{\#\textquotesingle{}}
\NormalTok{.nebula }\OtherTok{\textless{}{-}} 
  \FunctionTok{setClass}\NormalTok{(}\StringTok{"nebula"}\NormalTok{, }
           \AttributeTok{contains =} \FunctionTok{character}\NormalTok{(),}
           \AttributeTok{representation =} 
             \FunctionTok{representation}\NormalTok{(}\AttributeTok{parent\_nebula =} \StringTok{"parent\_nebula"}\NormalTok{,}
                            \AttributeTok{child\_nebulae =} \StringTok{"child\_nebulae"}
\NormalTok{                            ),}
           \AttributeTok{prototype =} \ConstantTok{NULL}
\NormalTok{           )}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# method}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @exportMethod parent\_nebula}
\CommentTok{\#\textquotesingle{} @aliases parent\_nebula}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"show"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{object =} \StringTok{"parent\_nebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(object)\{}
            \FunctionTok{.show\_nebulae\_data}\NormalTok{(object)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod child\_nebulae}
\CommentTok{\#\textquotesingle{} @aliases child\_nebulae}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"show"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{object =} \StringTok{"child\_nebulae"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(object)\{}
            \FunctionTok{.show\_nebulae\_data}\NormalTok{(object)}
\NormalTok{          \})}

\NormalTok{.show\_nebulae\_data }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(object)\{}
    \FunctionTok{slots\_mapply}\NormalTok{(object, }\ControlFlowTok{function}\NormalTok{(slot, name)\{}
                   \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is}\NormalTok{(slot, }\StringTok{"viewport"}\NormalTok{)) \{}
\NormalTok{                     num }\OtherTok{\textless{}{-}} \DecValTok{1}
\NormalTok{                   \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.list}\NormalTok{(slot)) \{}
\NormalTok{                     num }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(slot)}
\NormalTok{                   \} }\ControlFlowTok{else}\NormalTok{ \{}
                     \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(slot))}
\NormalTok{                       num }\OtherTok{\textless{}{-}} \DecValTok{0}
                     \ControlFlowTok{else}
\NormalTok{                       num }\OtherTok{\textless{}{-}} \DecValTok{1}
\NormalTok{                   \}}
                   \ControlFlowTok{if}\NormalTok{ (num }\SpecialCharTok{==} \DecValTok{0} \SpecialCharTok{|} \FunctionTok{is}\NormalTok{(slot, }\StringTok{"name"}\NormalTok{)) }
                     \FunctionTok{return}\NormalTok{()}
                   \FunctionTok{cat}\NormalTok{(name, }\StringTok{": "}\NormalTok{, }\FunctionTok{class}\NormalTok{(slot)[}\DecValTok{1}\NormalTok{], }\StringTok{" of "}\NormalTok{, num,}
                       \StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{, }\AttributeTok{sep =} \StringTok{""}\NormalTok{)}
\NormalTok{                      \})}
\NormalTok{  \}}


\CommentTok{\#\textquotesingle{} @exportMethod parent\_nebula}
\CommentTok{\#\textquotesingle{} @aliases parent\_nebula}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{parent\_nebula\}, \textbackslash{}code\{parent\_nebula\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{parent\_nebula\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"parent\_nebula"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{parent\_nebula \})}

\CommentTok{\#\textquotesingle{} @exportMethod parent\_nebula\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases parent\_nebula\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"parent\_nebula"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{parent\_nebula =}\NormalTok{ value)}
\NormalTok{                 \})}

\CommentTok{\#\textquotesingle{} @exportMethod child\_nebulae}
\CommentTok{\#\textquotesingle{} @aliases child\_nebulae}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{child\_nebulae\}, \textbackslash{}code\{child\_nebulae\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{child\_nebulae\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"child\_nebulae"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{child\_nebulae \})}

\CommentTok{\#\textquotesingle{} @exportMethod child\_nebulae\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases child\_nebulae\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"child\_nebulae"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{child\_nebulae =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod igraph}
\CommentTok{\#\textquotesingle{} @aliases igraph}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{igraph\}, \textbackslash{}code\{igraph\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{igraph\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"igraph"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{igraph \})}

\CommentTok{\#\textquotesingle{} @exportMethod igraph\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases igraph\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"igraph"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{igraph =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod tbl\_graph}
\CommentTok{\#\textquotesingle{} @aliases tbl\_graph}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{tbl\_graph\}, \textbackslash{}code\{tbl\_graph\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{tbl\_graph\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"tbl\_graph"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{tbl\_graph \})}

\CommentTok{\#\textquotesingle{} @exportMethod tbl\_graph\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases tbl\_graph\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"tbl\_graph"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{tbl\_graph =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod layout\_ggraph}
\CommentTok{\#\textquotesingle{} @aliases layout\_ggraph}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{layout\_ggraph\}, \textbackslash{}code\{layout\_ggraph\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{layout\_ggraph\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"layout\_ggraph"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{layout\_ggraph \})}

\CommentTok{\#\textquotesingle{} @exportMethod layout\_ggraph\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases layout\_ggraph\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"layout\_ggraph"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{layout\_ggraph =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod grid\_layout}
\CommentTok{\#\textquotesingle{} @aliases grid\_layout}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{grid\_layout\}, \textbackslash{}code\{grid\_layout\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{grid\_layout\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"grid\_layout"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{grid\_layout \})}

\CommentTok{\#\textquotesingle{} @exportMethod grid\_layout\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases grid\_layout\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"grid\_layout"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{grid\_layout =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod viewports}
\CommentTok{\#\textquotesingle{} @aliases viewports}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{viewports\}, \textbackslash{}code\{viewports\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{viewports\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"viewports"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{viewports \})}

\CommentTok{\#\textquotesingle{} @exportMethod viewports\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases viewports\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"viewports"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{viewports =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod ggset}
\CommentTok{\#\textquotesingle{} @aliases ggset}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{ggset\}, \textbackslash{}code\{ggset\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{ggset\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"ggset"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{ggset \})}

\CommentTok{\#\textquotesingle{} @exportMethod ggset\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases ggset\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"ggset"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{ggset =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod panel\_viewport}
\CommentTok{\#\textquotesingle{} @aliases panel\_viewport}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{panel\_viewport\}, \textbackslash{}code\{panel\_viewport\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{panel\_viewport\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"panel\_viewport"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{panel\_viewport \})}

\CommentTok{\#\textquotesingle{} @exportMethod panel\_viewport\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases panel\_viewport\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"panel\_viewport"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{panel\_viewport =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod legend\_viewport}
\CommentTok{\#\textquotesingle{} @aliases legend\_viewport}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{legend\_viewport\}, \textbackslash{}code\{legend\_viewport\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{legend\_viewport\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"legend\_viewport"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{legend\_viewport \})}

\CommentTok{\#\textquotesingle{} @exportMethod legend\_viewport\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases legend\_viewport\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"legend\_viewport"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{legend\_viewport =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod structures\_grob}
\CommentTok{\#\textquotesingle{} @aliases structures\_grob}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{structures\_grob\}, \textbackslash{}code\{structures\_grob\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{structures\_grob\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"structures\_grob"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{structures\_grob \})}

\CommentTok{\#\textquotesingle{} @exportMethod structures\_grob\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases structures\_grob\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"structures\_grob"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{structures\_grob =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod nodes\_ggset}
\CommentTok{\#\textquotesingle{} @aliases nodes\_ggset}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{nodes\_ggset\}, \textbackslash{}code\{nodes\_ggset\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{nodes\_ggset\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"nodes\_ggset"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{nodes\_ggset \})}

\CommentTok{\#\textquotesingle{} @exportMethod nodes\_ggset\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases nodes\_ggset\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"nodes\_ggset"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{nodes\_ggset =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod nodes\_grob}
\CommentTok{\#\textquotesingle{} @aliases nodes\_grob}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{nodes\_grob\}, \textbackslash{}code\{nodes\_grob\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{nodes\_grob\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"nodes\_grob"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{nodes\_grob \})}

\CommentTok{\#\textquotesingle{} @exportMethod nodes\_grob\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases nodes\_grob\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"nodes\_grob"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{nodes\_grob =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod ppcp\_data}
\CommentTok{\#\textquotesingle{} @aliases ppcp\_data}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{ppcp\_data\}, \textbackslash{}code\{ppcp\_data\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{ppcp\_data\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"ppcp\_data"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{ppcp\_data \})}

\CommentTok{\#\textquotesingle{} @exportMethod ppcp\_data\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases ppcp\_data\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"ppcp\_data"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{ppcp\_data =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod ration\_data}
\CommentTok{\#\textquotesingle{} @aliases ration\_data}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{ration\_data\}, \textbackslash{}code\{ration\_data\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{ration\_data\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"ration\_data"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{ration\_data \})}

\CommentTok{\#\textquotesingle{} @exportMethod ration\_data\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases ration\_data\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"ration\_data"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{ration\_data =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod ggset\_annotate}
\CommentTok{\#\textquotesingle{} @aliases ggset\_annotate}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{ggset\_annotate\}, \textbackslash{}code\{ggset\_annotate\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{ggset\_annotate\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"ggset\_annotate"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{ggset\_annotate \})}

\CommentTok{\#\textquotesingle{} @exportMethod ggset\_annotate\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases ggset\_annotate\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname nebula{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"ggset\_annotate"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{ggset\_annotate =}\NormalTok{ value)}
\NormalTok{                 \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-class-project_api.r}{%
\section{File: class-project\_api.R}\label{file-class-project_api.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# a class to store functions of reading or formating the target data}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @exportClass project\_api}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases project\_api}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Function set for extracting data}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description }
\CommentTok{\#\textquotesingle{} This is a class object used to store various functions for extracting and formatting data.}
\CommentTok{\#\textquotesingle{} See [project{-}class] for joint application with other related classes.}
\CommentTok{\#\textquotesingle{} @family projects}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @note The class is not for normal use of the package.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot methods\_read list. Store a list of functions for reading data.}
\CommentTok{\#\textquotesingle{} The list with the names: "read" + "subscript". e.g., "read.f3\_fingerid".}
\CommentTok{\#\textquotesingle{} @slot methods\_format function. The function is used to format the data}
\CommentTok{\#\textquotesingle{} (e.g., rename the column names; convert the columns of character type into numeric).}
\CommentTok{\#\textquotesingle{} @slot methods\_match list. Store a list of functions for matching and extracting string.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname project\_api{-}class}
\CommentTok{\#\textquotesingle{}}
\NormalTok{.project\_api }\OtherTok{\textless{}{-}} 
  \FunctionTok{setClass}\NormalTok{(}\StringTok{"project\_api"}\NormalTok{, }
           \AttributeTok{contains =} \FunctionTok{character}\NormalTok{(),}
           \AttributeTok{representation =} 
             \FunctionTok{representation}\NormalTok{(}\AttributeTok{methods\_read =} \StringTok{"list"}\NormalTok{,}
                            \AttributeTok{methods\_format =} \StringTok{"function"}\NormalTok{,}
                            \AttributeTok{methods\_match =} \StringTok{"list"}
\NormalTok{                            ),}
           \AttributeTok{prototype =} \ConstantTok{NULL}
\NormalTok{           )}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# method}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @exportMethod show}
\CommentTok{\#\textquotesingle{} @aliases show}
\CommentTok{\#\textquotesingle{} @rdname project\_api{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"show"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{object =} \StringTok{"project\_api"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(object)\{}
            \FunctionTok{.show}\NormalTok{(object)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod project\_api}
\CommentTok{\#\textquotesingle{} @aliases project\_api}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{project\_api\}, \textbackslash{}code\{project\_api\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{project\_api\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname project\_api{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"project\_api"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{project\_api \})}

\CommentTok{\#\textquotesingle{} @exportMethod project\_api\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases project\_api\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname project\_api{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"project\_api"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{project\_api =}\NormalTok{ value)}
\NormalTok{                 \})}

\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @exportMethod methods\_read}
\CommentTok{\#\textquotesingle{} @aliases methods\_read}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{methods\_read\}, \textbackslash{}code\{methods\_read\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{methods\_read\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname project\_api{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"methods\_read"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"project\_api"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{methods\_read \})}

\CommentTok{\#\textquotesingle{} @exportMethod methods\_read\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases methods\_read\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname project\_api{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"methods\_read"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"project\_api"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{methods\_read =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod methods\_format}
\CommentTok{\#\textquotesingle{} @aliases methods\_format}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{methods\_format\}, \textbackslash{}code\{methods\_format\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{methods\_format\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname project\_api{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"methods\_format"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"project\_api"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{methods\_format \})}

\CommentTok{\#\textquotesingle{} @exportMethod methods\_format\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases methods\_format\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname project\_api{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"methods\_format"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"project\_api"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{methods\_format =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod methods\_match}
\CommentTok{\#\textquotesingle{} @aliases methods\_match}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{methods\_match\}, \textbackslash{}code\{methods\_match\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{methods\_match\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname project\_api{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"methods\_match"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"project\_api"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{methods\_match \})}

\CommentTok{\#\textquotesingle{} @exportMethod methods\_match\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases methods\_match\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname project\_api{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"methods\_match"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"project\_api"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{methods\_match =}\NormalTok{ value)}
\NormalTok{                 \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-class-project_conformation.r}{%
\section{File: class-project\_conformation.R}\label{file-class-project_conformation.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# a class to store the characters of files or data in raw project.}
\CommentTok{\# These generally describe the file name, file path, and attributes name.}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @exportClass project\_conformation}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases project\_conformation}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Clarify the name, path and attribute name of files}
\CommentTok{\#\textquotesingle{} in the project (directory)}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description }
\CommentTok{\#\textquotesingle{} This is a class object used to record the name, path and attribute name of the file.}
\CommentTok{\#\textquotesingle{} These records can be retrieved by "subscript" (see [subscript{-}class]).}
\CommentTok{\#\textquotesingle{} See [project{-}class] for joint application with other related classes.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @note The class is not for normal use of the package.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @family projects}
\CommentTok{\#\textquotesingle{} @family subscripts}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot file\_name character with names.}
\CommentTok{\#\textquotesingle{} Record the filenames or pattern string or function name (begin with "FUN\_")}
\CommentTok{\#\textquotesingle{} for each "subscript" (imply file names).}
\CommentTok{\#\textquotesingle{} @slot file\_api character with names.}
\CommentTok{\#\textquotesingle{} Record the file path for each "subscript" (imply file names).}
\CommentTok{\#\textquotesingle{} The path is descriped by "subscript" with "/".}
\CommentTok{\#\textquotesingle{} @slot attribute\_name character with names.}
\CommentTok{\#\textquotesingle{} Record the attribute name for each "subscript" (imply column names).}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname project\_conformation{-}class}
\CommentTok{\#\textquotesingle{}}
\NormalTok{.project\_conformation }\OtherTok{\textless{}{-}} 
  \FunctionTok{setClass}\NormalTok{(}\StringTok{"project\_conformation"}\NormalTok{, }
           \AttributeTok{contains =} \FunctionTok{character}\NormalTok{(),}
           \AttributeTok{representation =} 
             \FunctionTok{representation}\NormalTok{(}\AttributeTok{file\_name =} \StringTok{"character"}\NormalTok{,}
                            \AttributeTok{file\_api =} \StringTok{"character"}\NormalTok{,}
                            \AttributeTok{attribute\_name =} \StringTok{"character"}
\NormalTok{                            ),}
           \AttributeTok{prototype =} \ConstantTok{NULL}
\NormalTok{           )}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# validity}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\FunctionTok{setValidity}\NormalTok{(}\StringTok{"project\_conformation"}\NormalTok{, }
            \ControlFlowTok{function}\NormalTok{(object)\{}
\NormalTok{              check }\OtherTok{\textless{}{-}} 
                \FunctionTok{slots\_mapply}\NormalTok{(object,}
                             \ControlFlowTok{function}\NormalTok{(slot, name)\{}
                               \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.character}\NormalTok{(slot) }\SpecialCharTok{\&} \FunctionTok{length}\NormalTok{(slot) }\SpecialCharTok{==} \DecValTok{0}\NormalTok{) \{}
                                 \ConstantTok{TRUE}
\NormalTok{                               \} }\ControlFlowTok{else}\NormalTok{ \{}
                                 \ControlFlowTok{if}\NormalTok{ ( }\FunctionTok{is.character}\NormalTok{( }\FunctionTok{names}\NormalTok{(slot) ))}
                                   \ConstantTok{TRUE}
                                 \ControlFlowTok{else} \ConstantTok{FALSE}
\NormalTok{                               \}}
\NormalTok{                             \})}
              \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{any}\NormalTok{(}\SpecialCharTok{!}\NormalTok{check))}
                \StringTok{"the colnames not matched."}
              \ControlFlowTok{else} \ConstantTok{TRUE}
\NormalTok{            \})}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# method}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @exportMethod show}
\CommentTok{\#\textquotesingle{} @aliases show}
\CommentTok{\#\textquotesingle{} @rdname project\_conformation{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"show"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{object =} \StringTok{"project\_conformation"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(object)\{}
            \FunctionTok{.show}\NormalTok{(object)}
\NormalTok{          \})}


\CommentTok{\#\textquotesingle{} @exportMethod project\_conformation}
\CommentTok{\#\textquotesingle{} @aliases project\_conformation}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{project\_conformation\}, \textbackslash{}code\{project\_conformation\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{project\_conformation\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname project\_conformation{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"project\_conformation"}\NormalTok{, }
          \AttributeTok{signature =} \StringTok{"ANY"}\NormalTok{,}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{project\_conformation \})}

\CommentTok{\#\textquotesingle{} @exportMethod project\_conformation\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases project\_conformation\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname project\_conformation{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"project\_conformation"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{project\_conformation =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod file\_name}
\CommentTok{\#\textquotesingle{} @aliases file\_name}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{file\_name\}, \textbackslash{}code\{file\_name\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{file\_name\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname project\_conformation{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"file\_name"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"project\_conformation"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{file\_name \})}

\CommentTok{\#\textquotesingle{} @exportMethod file\_name\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases file\_name\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname project\_conformation{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"file\_name"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"project\_conformation"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{file\_name =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod file\_api}
\CommentTok{\#\textquotesingle{} @aliases file\_api}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{file\_api\}, \textbackslash{}code\{file\_api\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{file\_api\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname project\_conformation{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"file\_api"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"project\_conformation"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{file\_api \})}

\CommentTok{\#\textquotesingle{} @exportMethod file\_api\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases file\_api\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname project\_conformation{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"file\_api"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"project\_conformation"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{file\_api =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod attribute\_name}
\CommentTok{\#\textquotesingle{} @aliases attribute\_name}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{attribute\_name\}, \textbackslash{}code\{attribute\_name\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{attribute\_name\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname project\_conformation{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"attribute\_name"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"project\_conformation"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{attribute\_name \})}

\CommentTok{\#\textquotesingle{} @exportMethod attribute\_name\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases attribute\_name\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname project\_conformation{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"attribute\_name"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"project\_conformation"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{attribute\_name =}\NormalTok{ value)}
\NormalTok{                 \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-class-project_dataset.r}{%
\section{File: class-project\_dataset.R}\label{file-class-project_dataset.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# a class to store dataset extract from raw data}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @exportClass project\_dataset}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases project\_dataset}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Store extracted data}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description }
\CommentTok{\#\textquotesingle{} This is a class object used to store extracted data (raw data).}
\CommentTok{\#\textquotesingle{} See [project{-}class] for joint application with other related classes.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @family projects}
\CommentTok{\#\textquotesingle{} @family datasets}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot dataset list. See [dataset{-}class].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname project\_dataset{-}class}
\CommentTok{\#\textquotesingle{}}
\NormalTok{.project\_dataset }\OtherTok{\textless{}{-}} 
  \FunctionTok{setClass}\NormalTok{(}\StringTok{"project\_dataset"}\NormalTok{, }
           \AttributeTok{contains =} \StringTok{"dataset"}\NormalTok{,}
           \AttributeTok{prototype =} \ConstantTok{NULL}
\NormalTok{           )}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# method}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @exportMethod project\_dataset}
\CommentTok{\#\textquotesingle{} @aliases project\_dataset}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{project\_dataset\}, \textbackslash{}code\{project\_dataset\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{project\_dataset\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname project\_dataset{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"project\_dataset"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{project\_dataset \})}

\CommentTok{\#\textquotesingle{} @exportMethod project\_dataset\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases project\_dataset\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname project\_dataset{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"project\_dataset"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{project\_dataset =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod latest}
\CommentTok{\#\textquotesingle{} @aliases latest}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{latest\}: get the first data in \textbackslash{}code\{dataset\} slot (\textquotesingle{}list\textquotesingle{}) and}
\CommentTok{\#\textquotesingle{} format as \textquotesingle{}tbl\textquotesingle{}. Equals:}
\CommentTok{\#\textquotesingle{} {-} \textbackslash{}code\{latest(object)\}}
\CommentTok{\#\textquotesingle{} {-} \textbackslash{}code\{tibble::as\_tibble(entity(dataset(object)[[1]]))\}}
\CommentTok{\#\textquotesingle{} @family latests}
\CommentTok{\#\textquotesingle{} @seealso [tibble::as\_tibble()]}
\CommentTok{\#\textquotesingle{} @rdname project\_dataset{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"latest"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"project\_dataset"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
\NormalTok{            tibble}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(}\FunctionTok{entity}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(x)[[}\DecValTok{1}\NormalTok{]]))}
\NormalTok{          \})}


\CommentTok{\#\textquotesingle{} @exportMethod extract\_rawset}
\CommentTok{\#\textquotesingle{} @aliases extract\_rawset}
\CommentTok{\#\textquotesingle{} @rdname project\_dataset{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"extract\_rawset"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{, }\AttributeTok{subscript =} \StringTok{"character"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, subscript)\{}
            \FunctionTok{extract\_rawset}\NormalTok{(x, }\AttributeTok{subscript =}\NormalTok{ subscript,}
                           \AttributeTok{fun\_collate =} \ControlFlowTok{function}\NormalTok{(...)\{}
                             \FunctionTok{stop}\NormalTok{(}\StringTok{"\textasciigrave{}subscript\textasciigrave{} not found in \textasciigrave{}dataset(project\_dataset(x))\textasciigrave{}"}\NormalTok{)}
\NormalTok{                           \})}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod extract\_rawset}
\CommentTok{\#\textquotesingle{} @aliases extract\_rawset}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{extract\_rawset\}: For fast extract data in object which containing}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{project\_dataset\} slot. Normally not used.}
\CommentTok{\#\textquotesingle{} @param x an object contain \textbackslash{}code\{project\_dataset\} slot.}
\CommentTok{\#\textquotesingle{} @param subscript character. Specified the data in \textbackslash{}code\{dataset\} slot}
\CommentTok{\#\textquotesingle{} in \textbackslash{}code\{project\_dataset\} slot.}
\CommentTok{\#\textquotesingle{} See [VIRTUAL\_subscript{-}class].}
\CommentTok{\#\textquotesingle{} @param fun\_collate function. If the specified data not exists in \textbackslash{}code\{dataset\} slot,}
\CommentTok{\#\textquotesingle{} it will be used to collate data. This parameter is not for normal use.}
\CommentTok{\#\textquotesingle{} @param ... parameters passed to \textquotesingle{}fun\_collate\textquotesingle{}.}
\CommentTok{\#\textquotesingle{} @rdname project\_dataset{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"extract\_rawset"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{,}
                        \AttributeTok{subscript =} \StringTok{"character"}\NormalTok{,}
                        \AttributeTok{fun\_collate =} \StringTok{"function"}
\NormalTok{                        ),}
          \ControlFlowTok{function}\NormalTok{(x, subscript, fun\_collate, ...)\{}
            \ControlFlowTok{if}\NormalTok{ ( }\FunctionTok{any}\NormalTok{( subscript }\SpecialCharTok{==} \FunctionTok{names}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(x))) ) )}
\NormalTok{              msframe }\OtherTok{\textless{}{-}} \FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(x))[[ subscript ]]}
            \ControlFlowTok{else}
\NormalTok{              msframe }\OtherTok{\textless{}{-}} \FunctionTok{fun\_collate}\NormalTok{(x, subscript, ...)}
\NormalTok{            lst }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(msframe)}
            \FunctionTok{names}\NormalTok{(lst) }\OtherTok{\textless{}{-}}\NormalTok{ subscript}
            \FunctionTok{return}\NormalTok{(lst)}
\NormalTok{          \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-class-project_metadata.r}{%
\section{File: class-project\_metadata.R}\label{file-class-project_metadata.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# a class to store the metadata of files in project directory, i.e.,}
\CommentTok{\# whether the files exists.}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @exportClass project\_metadata}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases project\_metadata}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Metadata of files}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description This is a class object used to store metadata of files.}
\CommentTok{\#\textquotesingle{} See [project{-}class] for joint application with other related classes.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @note The class is not for normal use of the package.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @family projects}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot metadata a list with names of [subscript{-}class].}
\CommentTok{\#\textquotesingle{} Each element of the list is a data.frame.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname project\_metadata{-}class}
\CommentTok{\#\textquotesingle{}}
\NormalTok{.project\_metadata }\OtherTok{\textless{}{-}} 
  \FunctionTok{setClass}\NormalTok{(}\StringTok{"project\_metadata"}\NormalTok{, }
           \AttributeTok{contains =} \FunctionTok{character}\NormalTok{(),}
           \AttributeTok{representation =} 
             \FunctionTok{representation}\NormalTok{(}\AttributeTok{metadata =} \StringTok{"list"}
\NormalTok{                            ),}
           \AttributeTok{prototype =} \ConstantTok{NULL}
\NormalTok{           )}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# validity}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\FunctionTok{setValidity}\NormalTok{(}\StringTok{"project\_metadata"}\NormalTok{, }
            \ControlFlowTok{function}\NormalTok{(object)\{}
              \ControlFlowTok{if}\NormalTok{ ( }\FunctionTok{is.character}\NormalTok{(}\FunctionTok{names}\NormalTok{(object}\SpecialCharTok{@}\NormalTok{metadata)) )}
                \ConstantTok{TRUE}
              \ControlFlowTok{else}
                \ConstantTok{FALSE}
\NormalTok{            \})}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# method}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @exportMethod show}
\CommentTok{\#\textquotesingle{} @aliases show}
\CommentTok{\#\textquotesingle{} @rdname project\_metadata{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"show"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{object =} \StringTok{"project\_metadata"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(object)\{}
            \FunctionTok{.show}\NormalTok{(object)}
\NormalTok{          \})}


\CommentTok{\#\textquotesingle{} @exportMethod project\_metadata}
\CommentTok{\#\textquotesingle{} @aliases project\_metadata}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{project\_metadata\}, \textbackslash{}code\{project\_metadata\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{project\_metadata\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname project\_metadata{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"project\_metadata"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{project\_metadata \})}

\CommentTok{\#\textquotesingle{} @exportMethod project\_metadata\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases project\_metadata\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname project\_metadata{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"project\_metadata"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{project\_metadata =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod latest}
\CommentTok{\#\textquotesingle{} @aliases latest}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{latest\}: get the first data in \textbackslash{}code\{metadata\} slot and}
\CommentTok{\#\textquotesingle{} format as "tbl".}
\CommentTok{\#\textquotesingle{} @family latests}
\CommentTok{\#\textquotesingle{} @rdname project\_metadata{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"latest"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"project\_metadata"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
\NormalTok{            tibble}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(}\FunctionTok{metadata}\NormalTok{(x)[[}\DecValTok{1}\NormalTok{]])}
\NormalTok{          \})}


\CommentTok{\#\textquotesingle{} @exportMethod metadata}
\CommentTok{\#\textquotesingle{} @aliases metadata}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{metadata\}, \textbackslash{}code\{metadata\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{metadata\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname project\_metadata{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"metadata"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"project\_metadata"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{metadata \})}

\CommentTok{\#\textquotesingle{} @exportMethod metadata\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases metadata\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname project\_metadata{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"metadata"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"project\_metadata"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{metadata =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod add\_dataset}
\CommentTok{\#\textquotesingle{} @aliases add\_dataset}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{add\_dataset\}: add the list into slot \textbackslash{}code\{metadata\}.}
\CommentTok{\#\textquotesingle{} @param list a list (with names) of metadata (data.frame) with names.}
\CommentTok{\#\textquotesingle{} @rdname project\_metadata{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"add\_dataset"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"project\_metadata"}\NormalTok{,}
                        \AttributeTok{list =} \StringTok{"list"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, list)\{}
\NormalTok{            metadata }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(list, }\FunctionTok{metadata}\NormalTok{(x))}
            \FunctionTok{metadata}\NormalTok{(x) }\OtherTok{\textless{}{-}} \FunctionTok{vecter\_unique\_by\_names}\NormalTok{(metadata)}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod extract\_metadata}
\CommentTok{\#\textquotesingle{} @aliases extract\_metadata}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{extract\_metadata\}: use "subscript" to extract metadata from an}
\CommentTok{\#\textquotesingle{} object with slot \textbackslash{}code\{project\_metadata\},}
\CommentTok{\#\textquotesingle{} and then return it as a new \textbackslash{}code\{project\_metadata\}.}
\CommentTok{\#\textquotesingle{} @param subscript see [subscript{-}class].}
\CommentTok{\#\textquotesingle{} @rdname project\_metadata{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"extract\_metadata"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{, }\AttributeTok{subscript =} \StringTok{"character"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, subscript)\{}
\NormalTok{            x }\OtherTok{\textless{}{-}} \FunctionTok{get\_metadata}\NormalTok{(x, }\AttributeTok{subscript =}\NormalTok{ subscript)}
\NormalTok{            path.set }\OtherTok{\textless{}{-}} \FunctionTok{metadata}\NormalTok{(}\FunctionTok{project\_metadata}\NormalTok{(x))[[ subscript ]]}
            \DocumentationTok{\#\# build project\_metadata}
\NormalTok{            path.set }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(path.set)}
            \FunctionTok{names}\NormalTok{(path.set) }\OtherTok{\textless{}{-}}\NormalTok{ subscript}
            \FunctionTok{new}\NormalTok{(}\StringTok{"project\_metadata"}\NormalTok{, }\AttributeTok{metadata =}\NormalTok{ path.set)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod get\_metadata}
\CommentTok{\#\textquotesingle{} @aliases get\_metadata}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{get\_metadata\}: for an object with slot of \textbackslash{}code\{project\_metadata\},}
\CommentTok{\#\textquotesingle{} get the metadata of files of specified "subscript", then return the object.}
\CommentTok{\#\textquotesingle{} @param project\_metadata [project\_metadata{-}class] object.}
\CommentTok{\#\textquotesingle{} Used by \textbackslash{}code\{get\_metadata()\}. If \textquotesingle{}missing\textquotesingle{}, the slot \textbackslash{}code\{project\_metadata\} inside}
\CommentTok{\#\textquotesingle{} the object will be used.}
\CommentTok{\#\textquotesingle{} @param project\_conformation [project\_conformation{-}class] object.}
\CommentTok{\#\textquotesingle{} Used by \textbackslash{}code\{get\_metadata()\}. If \textquotesingle{}missing\textquotesingle{}, the slot \textbackslash{}code\{project\_conformation\} inside}
\CommentTok{\#\textquotesingle{} the object will be used.}
\CommentTok{\#\textquotesingle{} @param path character. The path of the project directory (generally, SIRIUS project).}
\CommentTok{\#\textquotesingle{} If \textquotesingle{}missing\textquotesingle{}, the slot \textbackslash{}code\{project\_path\} inside the object will be used.}
\CommentTok{\#\textquotesingle{} @rdname project\_metadata{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"get\_metadata"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{, }\AttributeTok{subscript =} \StringTok{"character"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, subscript)\{}
\NormalTok{            exits\_meta }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{( }\FunctionTok{metadata}\NormalTok{(}\FunctionTok{project\_metadata}\NormalTok{(x)) )}
            \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\NormalTok{subscript }\SpecialCharTok{\%in\%}\NormalTok{ exits\_meta) \{}
              \FunctionTok{project\_metadata}\NormalTok{(x) }\OtherTok{\textless{}{-}}
                \FunctionTok{get\_metadata}\NormalTok{(}\AttributeTok{subscript =}\NormalTok{ subscript,}
                             \AttributeTok{project\_metadata =} \FunctionTok{project\_metadata}\NormalTok{(x),}
                             \AttributeTok{project\_conformation =} \FunctionTok{project\_conformation}\NormalTok{(x),}
                             \AttributeTok{project\_version =} \FunctionTok{project\_version}\NormalTok{(x),}
                             \AttributeTok{path =} \FunctionTok{project\_path}\NormalTok{(x)}
\NormalTok{                )}
\NormalTok{            \}}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod get\_metadata}
\CommentTok{\#\textquotesingle{} @rdname project\_metadata{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"get\_metadata"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"get\_metadata"}\NormalTok{,}
                                 \AttributeTok{subscript =} \StringTok{"character"}\NormalTok{,}
                                 \AttributeTok{project\_metadata =} \StringTok{"project\_metadata"}\NormalTok{,}
                                 \AttributeTok{project\_conformation =} \StringTok{"project\_conformation"}\NormalTok{,}
                                 \AttributeTok{project\_version =} \StringTok{"character"}\NormalTok{,}
                                 \AttributeTok{path =} \StringTok{"character"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(subscript, project\_metadata,}
\NormalTok{            project\_conformation, project\_version, path)}
\NormalTok{          \{}
\NormalTok{            file\_name }\OtherTok{\textless{}{-}} \FunctionTok{file\_name}\NormalTok{(project\_conformation)}
\NormalTok{            file\_api }\OtherTok{\textless{}{-}} \FunctionTok{file\_api}\NormalTok{(project\_conformation)}
            \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\NormalTok{subscript }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(file\_api) )}
              \FunctionTok{stop}\NormalTok{( }\StringTok{"\textasciigrave{}subscript\textasciigrave{} not descriped in \textasciigrave{}names(file\_api(project\_conformation))\textasciigrave{}"}\NormalTok{ )}
\NormalTok{            api }\OtherTok{\textless{}{-}}\NormalTok{ file\_api[[ subscript ]]}
\NormalTok{            api }\OtherTok{\textless{}{-}} \FunctionTok{strsplit}\NormalTok{(api, }\AttributeTok{split =} \StringTok{"/"}\NormalTok{)[[}\DecValTok{1}\NormalTok{]]}
            \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(api)) \{}
\NormalTok{              sub }\OtherTok{\textless{}{-}}\NormalTok{ api[i]}
              \ControlFlowTok{if}\NormalTok{ ( }\FunctionTok{any}\NormalTok{(sub }\SpecialCharTok{==} \FunctionTok{names}\NormalTok{(}\FunctionTok{metadata}\NormalTok{(project\_metadata))) )}
                \ControlFlowTok{next}
              \ControlFlowTok{if}\NormalTok{ ( }\SpecialCharTok{!}\NormalTok{sub }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(file\_name) )}
                \FunctionTok{stop}\NormalTok{( }\StringTok{"\textasciigrave{}subscript\textasciigrave{} not descriped in \textasciigrave{}names(file\_name(project\_conformation))\textasciigrave{}"}\NormalTok{ )}
              \DocumentationTok{\#\# get the name of file, or the function name to get file name}
\NormalTok{              target }\OtherTok{\textless{}{-}}\NormalTok{ file\_name[[sub]]}
              \DocumentationTok{\#\# get the target of filename}
              \ControlFlowTok{if}\NormalTok{ ( }\FunctionTok{grepl}\NormalTok{(}\StringTok{"\^{}FUN\_"}\NormalTok{, target) )}
\NormalTok{                target }\OtherTok{\textless{}{-}} \FunctionTok{match.fun}\NormalTok{(target)()}
              \ControlFlowTok{if}\NormalTok{ ( i }\SpecialCharTok{==} \DecValTok{1}\NormalTok{ ) \{}
\NormalTok{                fun }\OtherTok{\textless{}{-}} \FunctionTok{match.fun}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"list\_files\_top."}\NormalTok{, project\_version))}
\NormalTok{                df }\OtherTok{\textless{}{-}} \FunctionTok{fun}\NormalTok{(path, target)}
\NormalTok{              \} }\ControlFlowTok{else}\NormalTok{ \{}
                \DocumentationTok{\#\# get the metadata of upper directory}
\NormalTok{                df }\OtherTok{\textless{}{-}} \FunctionTok{metadata}\NormalTok{(project\_metadata)[[ api[i }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{] ]]}
\NormalTok{                upper }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{apply}\NormalTok{(df, }\DecValTok{1}\NormalTok{, paste0, }\AttributeTok{collapse =} \StringTok{"/"}\NormalTok{))}

                \FunctionTok{.message\_info}\NormalTok{(}\StringTok{"project\_metadata"}\NormalTok{, }\StringTok{"get\_metadata"}\NormalTok{,}
                          \FunctionTok{paste0}\NormalTok{(target, }\StringTok{"("}\NormalTok{, sub, }\StringTok{")"}\NormalTok{))}
\NormalTok{                fun }\OtherTok{\textless{}{-}} \FunctionTok{match.fun}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"list\_files."}\NormalTok{, project\_version))}
\NormalTok{                df }\OtherTok{\textless{}{-}} \FunctionTok{fun}\NormalTok{(path, upper, target, api[i }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{])}
\NormalTok{              \}}
\NormalTok{              lst }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{( df )}
              \FunctionTok{names}\NormalTok{(lst) }\OtherTok{\textless{}{-}}\NormalTok{ sub}
\NormalTok{              project\_metadata }\OtherTok{\textless{}{-}} \FunctionTok{add\_dataset}\NormalTok{(project\_metadata, lst)}
\NormalTok{            \}}
            \FunctionTok{return}\NormalTok{(project\_metadata)}
\NormalTok{          \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-class-project.r}{%
\section{File: class-project.R}\label{file-class-project.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# a class to store information about files in target dir, and as well,}
\CommentTok{\# to read these files and save data in slots.}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @exportClass project}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases project}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Collection of Interface for extracting data from raw directory}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description }
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} This is a class object designed to extract files in the project directory.}
\CommentTok{\#\textquotesingle{} Its responsibility is to describe the name,}
\CommentTok{\#\textquotesingle{} path and reading method of the file under the project directory;}
\CommentTok{\#\textquotesingle{} Use these information to extract and store data.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @details}
\CommentTok{\#\textquotesingle{} It is a collection of classes whose names start with "project\_":}
\CommentTok{\#\textquotesingle{} {-} [project\_conformation{-}class]: The name, path and attribute name of the file are described.}
\CommentTok{\#\textquotesingle{} {-} [project\_api{-}class]: Functions for reading and formatting data are provided.}
\CommentTok{\#\textquotesingle{} {-} [project\_metadata{-}class]: Metadata, which records the files stored in the project directory.}
\CommentTok{\#\textquotesingle{} {-} [project\_dataset{-}class]: The extracted data is stored here.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} The above class objects are coordinated into a whole through the "subscript" name}
\CommentTok{\#\textquotesingle{} (see [subscript{-}class]).}
\CommentTok{\#\textquotesingle{} For example, when a command (\textbackslash{}code\{collate\_data(x, ".f3\_fingerid")\}) requests to}
\CommentTok{\#\textquotesingle{} extract the files of subscript of ".f3\_fingerid", the data extraction module:}
\CommentTok{\#\textquotesingle{} {-} from slot of \textbackslash{}code\{project\_conformation\},}
\CommentTok{\#\textquotesingle{} get the file name (pattern string) and path of subscript of ".f3\_fingerid";}
\CommentTok{\#\textquotesingle{} {-} match the files under the path with the pattern string (i.e., get the metadata of the files),}
\CommentTok{\#\textquotesingle{} then stored the metadata into slot of \textbackslash{}code\{project\_metadata\};}
\CommentTok{\#\textquotesingle{} {-} from slot of \textbackslash{}code\{project\_api\}, get the functions of subscript of ".f3\_fingerid";}
\CommentTok{\#\textquotesingle{} {-} use these functions to read and format the data in batches;}
\CommentTok{\#\textquotesingle{} {-} store the extracted data into slot of \textbackslash{}code\{project\_dataset\}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} This class is mainly designed for extracting files under the SIRIUS project directory.}
\CommentTok{\#\textquotesingle{} These files are: mainly "tables" that can be read through functions such as \textbackslash{}code\{read.table\};}
\CommentTok{\#\textquotesingle{} numerous and have multiple directories; need to be processed in batches.}
\CommentTok{\#\textquotesingle{} SIRIUS project may alter the name and path of internal files during version changes,}
\CommentTok{\#\textquotesingle{} which is in fact deadly for MCnebula2.}
\CommentTok{\#\textquotesingle{} To make the data extraction module of MCnebula2 free from version issues,}
\CommentTok{\#\textquotesingle{} this class object is designed to flexibly handle the extraction of internal files.}
\CommentTok{\#\textquotesingle{} Most contents need to be considered by MCnebula2 developers.}
\CommentTok{\#\textquotesingle{} The only thing users need to know:}
\CommentTok{\#\textquotesingle{} slot of [project\_dataset{-}class] object stores the extracted data.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @family projects}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot project\_version character(1). The target project version. e.g., "sirius.v4".}
\CommentTok{\#\textquotesingle{} @slot project\_path character(1). The target project path.}
\CommentTok{\#\textquotesingle{} @slot project\_conformation [project\_conformation{-}class] object.}
\CommentTok{\#\textquotesingle{} @slot project\_metadata [project\_metadata{-}class] object.}
\CommentTok{\#\textquotesingle{} @slot project\_api [project\_api{-}class] object.}
\CommentTok{\#\textquotesingle{} @slot project\_dataset [project\_dataset{-}class] object.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname project{-}class}
\CommentTok{\#\textquotesingle{}}
\NormalTok{.project }\OtherTok{\textless{}{-}} 
  \FunctionTok{setClass}\NormalTok{(}\StringTok{"project"}\NormalTok{, }
           \AttributeTok{contains =} \FunctionTok{character}\NormalTok{(),}
           \AttributeTok{representation =} 
             \FunctionTok{representation}\NormalTok{(}\AttributeTok{project\_version =} \StringTok{"character"}\NormalTok{,}
                            \AttributeTok{project\_path =} \StringTok{"character"}\NormalTok{,}
                            \AttributeTok{project\_conformation =} \StringTok{"project\_conformation"}\NormalTok{,}
                            \AttributeTok{project\_metadata =} \StringTok{"project\_metadata"}\NormalTok{,}
                            \AttributeTok{project\_api =} \StringTok{"project\_api"}\NormalTok{,}
                            \AttributeTok{project\_dataset =} \StringTok{"project\_dataset"}
\NormalTok{                            ),}
           \AttributeTok{prototype =} \FunctionTok{prototype}\NormalTok{(}\AttributeTok{project\_version =} \FunctionTok{character}\NormalTok{(),}
                                 \AttributeTok{project\_path =} \FunctionTok{character}\NormalTok{())}
\NormalTok{           )}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# method}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @exportMethod project\_version}
\CommentTok{\#\textquotesingle{} @aliases project\_version}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{project\_version\}, \textbackslash{}code\{project\_version\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{project\_version\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname project{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"project\_version"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{project\_version \})}

\CommentTok{\#\textquotesingle{} @exportMethod project\_version\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases project\_version\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname project{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"project\_version"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{project\_version =}\NormalTok{ value)}
\NormalTok{                 \})}

\CommentTok{\#\textquotesingle{} @exportMethod project\_path}
\CommentTok{\#\textquotesingle{} @aliases project\_path}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{project\_path\}, \textbackslash{}code\{project\_path\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{project\_path\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname project{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"project\_path"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{project\_path \})}

\CommentTok{\#\textquotesingle{} @exportMethod project\_path\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases project\_path\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname project{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"project\_path"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{project\_path =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod file\_name}
\CommentTok{\#\textquotesingle{} @aliases file\_name}
\CommentTok{\#\textquotesingle{} @description  \textbackslash{}code\{file\_name\}, \textbackslash{}code\{file\_api\}, \textbackslash{}code\{attribute\_name\}:}
\CommentTok{\#\textquotesingle{} fast channel to obtain}
\CommentTok{\#\textquotesingle{} the downstream slot. e.g., getter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{file\_name\} slot in sub{-}object}
\CommentTok{\#\textquotesingle{} of \textbackslash{}code\{project\_conformation\} slot of the object. Equals:}
\CommentTok{\#\textquotesingle{} {-} \textbackslash{}code\{file\_name(project\_conformation(object))\}}
\CommentTok{\#\textquotesingle{} {-} \textbackslash{}code\{file\_name(object)\}.}
\CommentTok{\#\textquotesingle{} @rdname project{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"file\_name"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \FunctionTok{file\_name}\NormalTok{(}\FunctionTok{project\_conformation}\NormalTok{(x))}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod file\_api}
\CommentTok{\#\textquotesingle{} @aliases file\_api}
\CommentTok{\#\textquotesingle{} @rdname project{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"file\_api"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \FunctionTok{file\_api}\NormalTok{(}\FunctionTok{project\_conformation}\NormalTok{(x))}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod attribute\_name}
\CommentTok{\#\textquotesingle{} @aliases attribute\_name}
\CommentTok{\#\textquotesingle{} @rdname project{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"attribute\_name"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \FunctionTok{attribute\_name}\NormalTok{(}\FunctionTok{project\_conformation}\NormalTok{(x))}
\NormalTok{          \})}


\CommentTok{\#\textquotesingle{} @exportMethod project\_metadata}
\CommentTok{\#\textquotesingle{} @aliases project\_metadata}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{metadata\}: fast channel to obtain}
\CommentTok{\#\textquotesingle{} the downstream slot, getter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{metadata\} slot in sub{-}object}
\CommentTok{\#\textquotesingle{} of \textbackslash{}code\{project\_metadata\} slot of the object. Equals:}
\CommentTok{\#\textquotesingle{} {-} \textbackslash{}code\{metadata(project\_metadata(object))\}}
\CommentTok{\#\textquotesingle{} {-} \textbackslash{}code\{metadata(object)\}.}
\CommentTok{\#\textquotesingle{} @rdname project{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"metadata"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \FunctionTok{metadata}\NormalTok{(}\FunctionTok{project\_metadata}\NormalTok{(x))}
\NormalTok{          \})}


\CommentTok{\#\textquotesingle{} @exportMethod methods\_read}
\CommentTok{\#\textquotesingle{} @aliases methods\_read}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{methods\_read\}, \textbackslash{}code\{methods\_format\}, \textbackslash{}code\{methods\_match\}:}
\CommentTok{\#\textquotesingle{} fast channel to obtain}
\CommentTok{\#\textquotesingle{} the downstream slot. e.g., getter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{methods\_read\} slot in sub{-}object}
\CommentTok{\#\textquotesingle{} of \textbackslash{}code\{project\_api\} slot of the object. Equals:}
\CommentTok{\#\textquotesingle{} {-} \textbackslash{}code\{methods\_read(project\_api(object))\}}
\CommentTok{\#\textquotesingle{} {-} \textbackslash{}code\{methods\_read(object)\}.}
\CommentTok{\#\textquotesingle{} @rdname project{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"methods\_read"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \FunctionTok{methods\_read}\NormalTok{(}\FunctionTok{project\_api}\NormalTok{(x))}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod methods\_format}
\CommentTok{\#\textquotesingle{} @aliases methods\_format}
\CommentTok{\#\textquotesingle{} @rdname project{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"methods\_format"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \FunctionTok{methods\_format}\NormalTok{(}\FunctionTok{project\_api}\NormalTok{(x))}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod methods\_match}
\CommentTok{\#\textquotesingle{} @aliases methods\_match}
\CommentTok{\#\textquotesingle{} @rdname project{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"methods\_match"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \FunctionTok{methods\_match}\NormalTok{(}\FunctionTok{project\_api}\NormalTok{(x))}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod match.candidates\_id}
\CommentTok{\#\textquotesingle{} @aliases match.candidates\_id}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{match.candidates\_id\}, \textbackslash{}code\{match.features\_id\}:}
\CommentTok{\#\textquotesingle{} fast channel to obtain}
\CommentTok{\#\textquotesingle{} data (mostly \textquotesingle{}tbl\textquotesingle{} or \textquotesingle{}data.frame\textquotesingle{}) inside the downstream slot (\textquotesingle{}list\textquotesingle{}), getter}
\CommentTok{\#\textquotesingle{} for the data named \textbackslash{}code\{match.candidates\_id\} in}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{methods\_match\} slot (a \textquotesingle{}list\textquotesingle{}) in sub{-}object}
\CommentTok{\#\textquotesingle{} of \textbackslash{}code\{project\_api\} slot of the object. Equals:}
\CommentTok{\#\textquotesingle{} {-} \textbackslash{}code\{methods\_match(project\_api(object))$match.candidates\_id\}}
\CommentTok{\#\textquotesingle{} {-} \textbackslash{}code\{match.candidates\_id(object)\}.}
\CommentTok{\#\textquotesingle{} @rdname project{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"match.candidates\_id"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \FunctionTok{methods\_match}\NormalTok{(}\FunctionTok{project\_api}\NormalTok{(x))[[ }\StringTok{"match.candidates\_id"}\NormalTok{ ]]}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod match.features\_id}
\CommentTok{\#\textquotesingle{} @aliases match.features\_id}
\CommentTok{\#\textquotesingle{} @rdname project{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"match.features\_id"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \FunctionTok{methods\_match}\NormalTok{(}\FunctionTok{project\_api}\NormalTok{(x))[[ }\StringTok{"match.features\_id"}\NormalTok{ ]]}
\NormalTok{          \})}


\CommentTok{\#\textquotesingle{} @exportMethod get\_upper\_dir\_subscript}
\CommentTok{\#\textquotesingle{} @aliases get\_upper\_dir\_subscript}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{get\_upper\_dir\_subscript\}: Get the "subscript" name of the folder.}
\CommentTok{\#\textquotesingle{} @param x Maybe object of class inherit [project{-}class].}
\CommentTok{\#\textquotesingle{} @param subscript the "subscript" name of file. See [subscript{-}class].}
\CommentTok{\#\textquotesingle{} @rdname project{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"get\_upper\_dir\_subscript"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"get\_upper\_dir\_subscript"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"ANY"}\NormalTok{,}
                                 \AttributeTok{subscript =} \StringTok{"character"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, subscript)\{}
\NormalTok{            stringr}\SpecialCharTok{::}\FunctionTok{str\_extract}\NormalTok{(}\FunctionTok{file\_api}\NormalTok{(}\FunctionTok{project\_conformation}\NormalTok{(x))[[ subscript ]],}
                                 \FunctionTok{paste0}\NormalTok{(}\StringTok{"(?\textless{}=\^{}|/)[\^{}/]*(?=/"}\NormalTok{, subscript, }\StringTok{"|$)"}\NormalTok{))}
\NormalTok{          \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-class-report.r}{%
\section{File: class-report.R}\label{file-class-report.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# a class for creating documentation for annotating analysis workflow}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @exportClass report}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases report}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Creating a formatted report}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} The report module can create output report quickly for}
\CommentTok{\#\textquotesingle{} and not just for the mcnebula2 workflow.}
\CommentTok{\#\textquotesingle{} The report system is primarily a class object that manages text and code blocks.}
\CommentTok{\#\textquotesingle{} Heading or paragraphs or code blocks were treated as individual report units}
\CommentTok{\#\textquotesingle{} and deposited sequentially in "layers".}
\CommentTok{\#\textquotesingle{} The report system provides methods to exhibit, modify these layers.}
\CommentTok{\#\textquotesingle{} Reports can be exported as ".Rmd" text files, and subsequently,}
\CommentTok{\#\textquotesingle{} users can call [rmarkdown::render()] for output formatted documents.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x [report{-}class] object.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @family layerSets}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot yaml character. Metadata passed to .Rmd for setting format of documentation.}
\CommentTok{\#\textquotesingle{} See \textbackslash{}url\{https://bookdown.org/yihui/rmarkdown/compile.html\} for details.}
\CommentTok{\#\textquotesingle{} @slot layers list. Element in list must be [section{-}class],}
\CommentTok{\#\textquotesingle{} [heading{-}class] or [code\_block{-}class].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname report{-}class}
\CommentTok{\#\textquotesingle{} @order 1}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   s1 \textless{}{-} new\_heading("Title 1", 1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   s1.5 \textless{}{-} new\_section2(}
\CommentTok{\#\textquotesingle{}     c("..."), NULL}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   s2 \textless{}{-} new\_section2(}
\CommentTok{\#\textquotesingle{}     c("This is sentence 1.",}
\CommentTok{\#\textquotesingle{}       "This is sentence 2.",}
\CommentTok{\#\textquotesingle{}       "This is sentence 3."),}
\CommentTok{\#\textquotesingle{}     rblock(\{}
\CommentTok{\#\textquotesingle{}       df \textless{}{-} data.frame(x = 1:10, y = 1:10)}
\CommentTok{\#\textquotesingle{}       df \textless{}{-} dplyr::mutate(df,}
\CommentTok{\#\textquotesingle{}         group = rep(paste0("p", 1:3), c(3, 3, 4))}
\CommentTok{\#\textquotesingle{}       )}
\CommentTok{\#\textquotesingle{}     \})}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   s3 \textless{}{-} new\_heading("Title 2", 1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   s4 \textless{}{-} new\_section2(}
\CommentTok{\#\textquotesingle{}     c("This is a paragraph..."),}
\CommentTok{\#\textquotesingle{}     rblock(\{}
\CommentTok{\#\textquotesingle{}       p \textless{}{-} ggplot(df) +}
\CommentTok{\#\textquotesingle{}         geom\_point(aes(x = x, y = y, fill = group))}
\CommentTok{\#\textquotesingle{}       ggsave(f \textless{}{-} paste0(tempdir(), "/test.pdf"), p)}
\CommentTok{\#\textquotesingle{}     \})}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   s5 \textless{}{-} include\_figure(f, "name", "Caption: ...")}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   s6 \textless{}{-} rblock(\{}
\CommentTok{\#\textquotesingle{}     print(1:100)}
\CommentTok{\#\textquotesingle{}   \}, args = list(echo = F, eval = F))}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   s7 \textless{}{-} c("... paragraph ...")}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   sections \textless{}{-} gather\_sections()}
\CommentTok{\#\textquotesingle{}   report \textless{}{-} do.call(new\_report, sections)}
\CommentTok{\#\textquotesingle{}   render\_report(report, paste0(tempdir(), "/report.Rmd"), T)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\CommentTok{\#\textquotesingle{}   \#\#\#\#\# Another example}
\CommentTok{\#\textquotesingle{}   \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   h1 \textless{}{-} new\_heading("heading, level 1", 1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   sec1 \textless{}{-} new\_section(}
\CommentTok{\#\textquotesingle{}     "sub{-}heading", 2,}
\CommentTok{\#\textquotesingle{}     "This is a description.",}
\CommentTok{\#\textquotesingle{}     new\_code\_block(codes = "seq \textless{}{-} lapply(1:10, cat)")}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   h2 \textless{}{-} new\_heading("heading 2, level 1", 1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   fig\_block \textless{}{-} new\_code\_block\_figure("plot", "this is a caption",}
\CommentTok{\#\textquotesingle{}     codes = "df \textless{}{-} data.frame(x = 1:10, y = 1:10)}
\CommentTok{\#\textquotesingle{}       p \textless{}{-} ggplot(df) +}
\CommentTok{\#\textquotesingle{}         geom\_point(aes(x = x, y = y))}
\CommentTok{\#\textquotesingle{}       p"}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   sec2 \textless{}{-} new\_section(}
\CommentTok{\#\textquotesingle{}     "sub{-}heading2", 2,}
\CommentTok{\#\textquotesingle{}     paste0(}
\CommentTok{\#\textquotesingle{}       "This is a description. ",}
\CommentTok{\#\textquotesingle{}       "See Figure ", get\_ref(fig\_block), "."}
\CommentTok{\#\textquotesingle{}     ),}
\CommentTok{\#\textquotesingle{}     fig\_block}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   a\_data \textless{}{-} dplyr::storms[1:15, 1:10]}
\CommentTok{\#\textquotesingle{}   table\_block \textless{}{-} include\_table(a\_data, "table1", "This is a caption")}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   sec3 \textless{}{-} new\_section(}
\CommentTok{\#\textquotesingle{}     NULL, ,}
\CommentTok{\#\textquotesingle{}     paste0("See Table ", get\_ref(table\_block, "tab"), "."),}
\CommentTok{\#\textquotesingle{}     NULL}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   tmp\_p \textless{}{-} paste0(tempdir(), "/test.pdf")}
\CommentTok{\#\textquotesingle{}   pdf(tmp\_p)}
\CommentTok{\#\textquotesingle{}   plot(1:10)}
\CommentTok{\#\textquotesingle{}   dev.off()}
\CommentTok{\#\textquotesingle{}   fig\_block\_2 \textless{}{-} include\_figure(tmp\_p, "plot2", "this is a caption")}
\CommentTok{\#\textquotesingle{}   sec4 \textless{}{-} history\_rblock(, "\^{}tmp\_p \textless{}{-} ", "\^{}fig\_block\_2")}
\CommentTok{\#\textquotesingle{}   sec4}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# gather}
\CommentTok{\#\textquotesingle{}   yaml \textless{}{-} "title: \textquotesingle{}title\textquotesingle{}\textbackslash{}noutput:\textbackslash{}n  bookdown::pdf\_document2"}
\CommentTok{\#\textquotesingle{}   report \textless{}{-} new\_report(}
\CommentTok{\#\textquotesingle{}     h1, sec1, h2, sec2,}
\CommentTok{\#\textquotesingle{}     table\_block, sec3,}
\CommentTok{\#\textquotesingle{}     fig\_block\_2, sec4,}
\CommentTok{\#\textquotesingle{}     yaml = yaml}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   report}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# output}
\CommentTok{\#\textquotesingle{}   tmp \textless{}{-} paste0(tempdir(), "/tmp\_output.Rmd")}
\CommentTok{\#\textquotesingle{}   render\_report(report, tmp)}
\CommentTok{\#\textquotesingle{}   rmarkdown::render(tmp)}
\CommentTok{\#\textquotesingle{}   file.exists(sub("Rmd$", "pdf", tmp))}
\CommentTok{\#\textquotesingle{} \}}
\NormalTok{.report }\OtherTok{\textless{}{-}} 
  \FunctionTok{setClass}\NormalTok{(}\StringTok{"report"}\NormalTok{, }
           \AttributeTok{contains =} \FunctionTok{c}\NormalTok{(}\StringTok{"layerSet"}\NormalTok{),}
           \AttributeTok{representation =} 
             \FunctionTok{representation}\NormalTok{(}\AttributeTok{yaml =} \StringTok{"character"}\NormalTok{),}
           \AttributeTok{prototype =} \FunctionTok{prototype}\NormalTok{(}\AttributeTok{yaml =} \FunctionTok{.yaml\_default}\NormalTok{())}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# validity}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\FunctionTok{setValidity}\NormalTok{(}\StringTok{"report"}\NormalTok{, }
            \ControlFlowTok{function}\NormalTok{(object)\{}
\NormalTok{              recepts }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"section"}\NormalTok{, }\StringTok{"heading"}\NormalTok{, }\StringTok{"code\_block"}\NormalTok{, }\StringTok{"character"}\NormalTok{)}
\NormalTok{              tip }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"\textquotesingle{}layer\textquotesingle{} in \textquotesingle{}report\textquotesingle{} must either be: "}\NormalTok{,}
                            \FunctionTok{paste0}\NormalTok{(}\StringTok{"\textquotesingle{}"}\NormalTok{, recepts, }\StringTok{"\textquotesingle{}"}\NormalTok{, }\AttributeTok{collapse =} \StringTok{", "}\NormalTok{))}
              \FunctionTok{validate\_class\_in\_list}\NormalTok{(}\FunctionTok{layers}\NormalTok{(object), recepts, tip)}
\NormalTok{            \})}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# method}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @importFrom crayon silver}
\CommentTok{\#\textquotesingle{} @importFrom crayon blue}
\CommentTok{\#\textquotesingle{} @importFrom crayon cyan}
\CommentTok{\#\textquotesingle{} @exportMethod show\_layers}
\CommentTok{\#\textquotesingle{} @aliases show\_layers}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{show\_layers\}: show \textbackslash{}code\{layers\} slots in a pretty}
\CommentTok{\#\textquotesingle{} and readable style.}
\CommentTok{\#\textquotesingle{} @rdname report{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"show\_layers"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"report"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
\NormalTok{            text }\OtherTok{\textless{}{-}} \FunctionTok{yaml}\NormalTok{(x)}
            \FunctionTok{textSh}\NormalTok{(crayon}\SpecialCharTok{::}\NormalTok{blue}\SpecialCharTok{$}\FunctionTok{bold}\NormalTok{(text[}\DecValTok{1}\NormalTok{]), }\AttributeTok{exdent =} \DecValTok{0}\NormalTok{)}
            \FunctionTok{lapply}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\FunctionTok{head}\NormalTok{(}\FunctionTok{as.list}\NormalTok{(crayon}\SpecialCharTok{::}\FunctionTok{cyan}\NormalTok{(text[}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{])), }\AttributeTok{n =} \DecValTok{4}\NormalTok{),}
\NormalTok{                     crayon}\SpecialCharTok{::}\FunctionTok{silver}\NormalTok{(}\StringTok{"..."}\NormalTok{)),}
                   \ControlFlowTok{function}\NormalTok{(text)\{}
                     \FunctionTok{textSh}\NormalTok{(text, }\AttributeTok{pre\_trunc =}\NormalTok{ T, }\AttributeTok{trunc\_width =} \DecValTok{60}\NormalTok{,}
                            \AttributeTok{ending =} \StringTok{""}\NormalTok{)}
\NormalTok{                   \})}
            \FunctionTok{cat}\NormalTok{(crayon}\SpecialCharTok{::}\FunctionTok{silver}\NormalTok{(}\StringTok{"layers of"}\NormalTok{, }\FunctionTok{length}\NormalTok{(}\FunctionTok{layers}\NormalTok{(x)), }\StringTok{"}\SpecialCharTok{\textbackslash{}n\textbackslash{}n}\StringTok{"}\NormalTok{))}
            \FunctionTok{lapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(}\FunctionTok{layers}\NormalTok{(x)),}
                   \ControlFlowTok{function}\NormalTok{(seq) \{}
                     \FunctionTok{cat}\NormalTok{(crayon}\SpecialCharTok{::}\FunctionTok{silver}\NormalTok{(}\StringTok{"+++ layer"}\NormalTok{, seq, }\StringTok{"+++}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{))}
\NormalTok{                     layer }\OtherTok{\textless{}{-}} \FunctionTok{layers}\NormalTok{(x)[[ seq ]]}
                     \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.character}\NormalTok{(layer) }\SpecialCharTok{\&} \SpecialCharTok{!}\FunctionTok{is}\NormalTok{(layer, }\StringTok{"heading"}\NormalTok{))}
                       \FunctionTok{textSh}\NormalTok{(layer, }\AttributeTok{pre\_collapse =}\NormalTok{ T, }\AttributeTok{pre\_trunc =}\NormalTok{ T,}
                              \AttributeTok{pre\_wrap =}\NormalTok{ T)}
                     \ControlFlowTok{else}
                       \FunctionTok{show}\NormalTok{(layer)}
\NormalTok{                   \})}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod yaml}
\CommentTok{\#\textquotesingle{} @aliases yaml}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{yaml\}, \textbackslash{}code\{yaml\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{yaml\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname report{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"yaml"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{yaml \})}

\CommentTok{\#\textquotesingle{} @exportMethod yaml\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases yaml\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname report{-}class}
\CommentTok{\#\textquotesingle{}}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"yaml"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{yaml =}\NormalTok{ value)}
\NormalTok{                 \})}

\CommentTok{\#\textquotesingle{} @exportMethod new\_report}
\CommentTok{\#\textquotesingle{} @aliases new\_report}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{new\_report\}: Create a [report{-}class] object.}
\CommentTok{\#\textquotesingle{} @param ... An arbitrary number of [heading{-}class],}
\CommentTok{\#\textquotesingle{} [section{-}class] or [code\_block{-}class] in sequence.}
\CommentTok{\#\textquotesingle{} Specially, \textbackslash{}code\{NULL\} can be passed herein, but would be ignored.}
\CommentTok{\#\textquotesingle{} @param yaml character. Passed to .Rmd for setting format of documentation.}
\CommentTok{\#\textquotesingle{} @rdname report{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"new\_report"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{yaml =} \StringTok{"character"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(..., yaml)\{}
\NormalTok{            layers }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(...)}
\NormalTok{            layers }\OtherTok{\textless{}{-}}\NormalTok{ layers[}\SpecialCharTok{!}\FunctionTok{vapply}\NormalTok{(layers, is.null, }\FunctionTok{logical}\NormalTok{(}\DecValTok{1}\NormalTok{))]}
            \FunctionTok{.report}\NormalTok{(}\AttributeTok{yaml =}\NormalTok{ yaml, }\AttributeTok{layers =}\NormalTok{ layers)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod new\_report}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{new\_report()\}: get the default parameters for the method \textbackslash{}code\{new\_report\}.}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{new\_report(x, ...)\}: use the default parameters whatever \textquotesingle{}missing\textquotesingle{}}
\CommentTok{\#\textquotesingle{} while performing the method \textbackslash{}code\{new\_report\}.}
\CommentTok{\#\textquotesingle{} @rdname report{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"new\_report"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"new\_report"}\NormalTok{,}
                                 \AttributeTok{yaml =} \StringTok{"missing"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(...)\{}
\NormalTok{            args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{yaml =} \FunctionTok{.yaml\_default}\NormalTok{())}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{missing}\NormalTok{(...))}
              \FunctionTok{return}\NormalTok{(args)}
            \ControlFlowTok{else}
              \FunctionTok{reCallMethod}\NormalTok{(}\StringTok{"new\_report"}\NormalTok{, args, ...)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod call\_command}
\CommentTok{\#\textquotesingle{} @aliases call\_command}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{call\_command\}: Format \textquotesingle{}report\textquotesingle{} object as character, which can be output}
\CommentTok{\#\textquotesingle{} by \textbackslash{}code\{writeLines()\} function as \textquotesingle{}.Rmd\textquotesingle{} file and than use \textbackslash{}code\{rmarkdown::render\} output}
\CommentTok{\#\textquotesingle{} as pdf, html, or other format files.}
\CommentTok{\#\textquotesingle{} @family call\_commands}
\CommentTok{\#\textquotesingle{} @seealso [writeLines()], [rmarkdown::render()]...}
\CommentTok{\#\textquotesingle{} @rdname report{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"call\_command"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"report"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
\NormalTok{            yaml }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"{-}{-}{-}"}\NormalTok{, }\FunctionTok{yaml}\NormalTok{(x), }\StringTok{"{-}{-}{-}"}\NormalTok{)}
\NormalTok{            layers }\OtherTok{\textless{}{-}} \FunctionTok{unlist}\NormalTok{(}\FunctionTok{lapply}\NormalTok{(}\FunctionTok{layers}\NormalTok{(x), call\_command))}
            \FunctionTok{c}\NormalTok{(yaml, }\StringTok{""}\NormalTok{, layers)}
\NormalTok{          \})}

\FunctionTok{setMethod}\NormalTok{(}\StringTok{"call\_command"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"character"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ }
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{tail}\NormalTok{(x, }\AttributeTok{n =} \DecValTok{1}\NormalTok{) }\SpecialCharTok{!=} \StringTok{""}\NormalTok{)}
              \FunctionTok{c}\NormalTok{(x, }\StringTok{""}\NormalTok{)}
            \ControlFlowTok{else}
\NormalTok{              x}
\NormalTok{          \})}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# function}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\#\textquotesingle{} @export search\_heading}
\CommentTok{\#\textquotesingle{} @aliases search\_heading}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{search\_heading\}: Regex match for [heading{-}class] object}
\CommentTok{\#\textquotesingle{} @param pattern character(1). For Regex match. Allowed Perl expression.}
\CommentTok{\#\textquotesingle{} @param level numeric.}
\CommentTok{\#\textquotesingle{} in slot \textbackslash{}code\{layers\}.}
\CommentTok{\#\textquotesingle{} @rdname report{-}class}
\NormalTok{search\_heading }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(x, pattern, }\AttributeTok{level =} \ConstantTok{NULL}\NormalTok{) \{}
\NormalTok{    log }\OtherTok{\textless{}{-}} \FunctionTok{vapply}\NormalTok{(}\FunctionTok{layers}\NormalTok{(x), }\AttributeTok{FUN.VALUE =} \FunctionTok{logical}\NormalTok{(}\DecValTok{1}\NormalTok{),}
                  \ControlFlowTok{function}\NormalTok{(s) \{}
                    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is}\NormalTok{(s, }\StringTok{"heading"}\NormalTok{)) \{}
                      \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(level)) \{}
                        \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{any}\NormalTok{(}\FunctionTok{level}\NormalTok{(s) }\SpecialCharTok{==}\NormalTok{ level))}
                          \FunctionTok{return}\NormalTok{(F)}
\NormalTok{                      \}}
                      \FunctionTok{grepl}\NormalTok{(pattern, s, }\AttributeTok{perl =}\NormalTok{ T)}
\NormalTok{                    \} }\ControlFlowTok{else}\NormalTok{ F}
\NormalTok{                  \})}
\NormalTok{    (}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(}\FunctionTok{layers}\NormalTok{(x)))[ log ]}
\NormalTok{  \}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-class-section.r}{%
\section{File: class-section.R}\label{file-class-section.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# a class contains slots for building a text section with code block, }
\CommentTok{\# figure, and table}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @exportClass code\_block}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases code\_block}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Sequestrate code and setting run parameters.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description Mainly desiged for R code block.}
\CommentTok{\#\textquotesingle{} The job of this class object is to record the codes and the running parameters}
\CommentTok{\#\textquotesingle{} of its source language or program;}
\CommentTok{\#\textquotesingle{} These information can then be output as formatted code block text (use [call\_command()]).}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot codes character. Codes.}
\CommentTok{\#\textquotesingle{} @slot command\_name character(1). Program or language. e.g., "r".}
\CommentTok{\#\textquotesingle{} @slot command\_function function. Used for gather the codes and args as code block.}
\CommentTok{\#\textquotesingle{} @slot command\_args list. Args passed to program.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @seealso \textbackslash{}code\{\textbackslash{}link\{command{-}class\}\}.}
\CommentTok{\#\textquotesingle{} \textbackslash{}url\{https://bookdown.org/yihui/rmarkdown{-}cookbook/cross{-}ref.html\#cross{-}ref\}.}
\CommentTok{\#\textquotesingle{} \textbackslash{}url\{https://bookdown.org/yihui/rmarkdown/compile.html\}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname code\_block{-}class}
\CommentTok{\#\textquotesingle{} @order 1}
\CommentTok{\#\textquotesingle{}}
\NormalTok{.code\_block }\OtherTok{\textless{}{-}} 
  \FunctionTok{setClass}\NormalTok{(}\StringTok{"code\_block"}\NormalTok{, }
           \AttributeTok{contains =} \FunctionTok{c}\NormalTok{(}\StringTok{"command"}\NormalTok{),}
           \AttributeTok{representation =} 
             \FunctionTok{representation}\NormalTok{(}\AttributeTok{codes =} \StringTok{"character"}\NormalTok{),}
           \AttributeTok{prototype =}
             \FunctionTok{prototype}\NormalTok{(}\AttributeTok{command\_name =} \StringTok{"r"}\NormalTok{,}
                       \AttributeTok{command\_function =}\NormalTok{ .write\_block,}
                       \AttributeTok{command\_args =} \FunctionTok{.args\_r\_block}\NormalTok{(),}
                       \AttributeTok{codes =} \StringTok{"\#\# codes"}
\NormalTok{           )}
\NormalTok{  )}

\CommentTok{\#\textquotesingle{} @exportClass code\_block\_table}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases code\_block\_table}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{code\_block\_table\}: class inherit from \textbackslash{}code\{code\_block\}, with}
\CommentTok{\#\textquotesingle{} default values for slot \textbackslash{}code\{command\_args\} facilitate showing table in document.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname code\_block{-}class}
\CommentTok{\#\textquotesingle{}}
\NormalTok{.code\_block\_table }\OtherTok{\textless{}{-}} 
  \FunctionTok{setClass}\NormalTok{(}\StringTok{"code\_block\_table"}\NormalTok{, }
           \AttributeTok{contains =} \FunctionTok{c}\NormalTok{(}\StringTok{"code\_block"}\NormalTok{),}
           \AttributeTok{representation =} 
             \FunctionTok{representation}\NormalTok{(),}
           \AttributeTok{prototype =} \FunctionTok{prototype}\NormalTok{(}\AttributeTok{command\_args =} \FunctionTok{.args\_r\_block\_table}\NormalTok{())}
\NormalTok{           )}

\CommentTok{\#\textquotesingle{} @exportClass code\_block\_figure}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases code\_block\_figure}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{code\_block\_figure\}: class inherit from \textbackslash{}code\{code\_block\}, with}
\CommentTok{\#\textquotesingle{} default values for slot \textbackslash{}code\{command\_args\} facilitate showing figure in document.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname code\_block{-}class}
\CommentTok{\#\textquotesingle{}}
\NormalTok{.code\_block\_figure }\OtherTok{\textless{}{-}} 
  \FunctionTok{setClass}\NormalTok{(}\StringTok{"code\_block\_figure"}\NormalTok{, }
           \AttributeTok{contains =} \FunctionTok{c}\NormalTok{(}\StringTok{"code\_block"}\NormalTok{),}
           \AttributeTok{representation =} 
             \FunctionTok{representation}\NormalTok{(),}
           \AttributeTok{prototype =} \FunctionTok{prototype}\NormalTok{(}\AttributeTok{command\_args =} \FunctionTok{.args\_r\_block\_figure}\NormalTok{())}
\NormalTok{           )}

\CommentTok{\#\textquotesingle{} @exportClass heading}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases heading}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description This is a class object used to clarify the heading and its hierarchy.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot .Data character(1). Text of heading.}
\CommentTok{\#\textquotesingle{} @slot level numeric. Level of heading.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname section{-}class}
\CommentTok{\#\textquotesingle{}}
\NormalTok{.heading }\OtherTok{\textless{}{-}} 
  \FunctionTok{setClass}\NormalTok{(}\StringTok{"heading"}\NormalTok{, }
           \AttributeTok{contains =} \StringTok{"character"}\NormalTok{,}
           \AttributeTok{representation =} 
             \FunctionTok{representation}\NormalTok{(}\AttributeTok{level =} \StringTok{"numeric"}\NormalTok{),}
           \AttributeTok{prototype =} \FunctionTok{prototype}\NormalTok{(}\AttributeTok{level =} \DecValTok{2}\NormalTok{)}
\NormalTok{           )}

\CommentTok{\#\textquotesingle{} @exportClass section}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases section}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Basic cells in the report}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description A class object consist of [heading{-}class], paragraph (character),}
\CommentTok{\#\textquotesingle{} and [code\_block{-}class]. These [section{-}class] belong to basic cells of report.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot heading [heading{-}class] object.}
\CommentTok{\#\textquotesingle{} @slot paragraph character. Text for description.}
\CommentTok{\#\textquotesingle{} @slot code\_block [code\_block{-}class] object.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname section{-}class}
\CommentTok{\#\textquotesingle{} @order 1}
\CommentTok{\#\textquotesingle{}}
\NormalTok{.section }\OtherTok{\textless{}{-}} 
  \FunctionTok{setClass}\NormalTok{(}\StringTok{"section"}\NormalTok{, }
           \AttributeTok{contains =} \FunctionTok{character}\NormalTok{(),}
           \AttributeTok{representation =} 
             \FunctionTok{representation}\NormalTok{(}\AttributeTok{heading =} \StringTok{"ANY"}\NormalTok{,}
                            \AttributeTok{paragraph =} \StringTok{"character"}\NormalTok{,}
                            \AttributeTok{code\_block =} \StringTok{"ANY"}
\NormalTok{                            ),}
           \AttributeTok{prototype =} \FunctionTok{prototype}\NormalTok{(}\AttributeTok{heading =} \FunctionTok{.heading}\NormalTok{(}\StringTok{"An analysis step"}\NormalTok{),}
                                 \AttributeTok{paragraph =} \StringTok{"Description"}\NormalTok{,}
                                 \AttributeTok{code\_block =} \FunctionTok{.code\_block}\NormalTok{())}
\NormalTok{           )}

\FunctionTok{setClassUnion}\NormalTok{(}\StringTok{"maybe\_code\_block"}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\StringTok{"code\_block"}\NormalTok{, }\StringTok{"NULL"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# method}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @importFrom crayon silver}
\CommentTok{\#\textquotesingle{} @exportMethod show}
\CommentTok{\#\textquotesingle{} @aliases show}
\CommentTok{\#\textquotesingle{} @param object [code\_block{-}class] object.}
\CommentTok{\#\textquotesingle{} @rdname code\_block{-}class}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   \#\# general}
\CommentTok{\#\textquotesingle{}   codes \textless{}{-} "df \textless{}{-} data.frame(x = 1:10)}
\CommentTok{\#\textquotesingle{}     df\textless{}{-}dplyr::mutate(df,y=x*1.5)\%\textgreater{}\%}
\CommentTok{\#\textquotesingle{}     dplyr::filter(x \textgreater{}= 5)}
\CommentTok{\#\textquotesingle{}     p \textless{}{-} ggplot(df)+}
\CommentTok{\#\textquotesingle{}     geom\_point(aes(x=x,y=y))}
\CommentTok{\#\textquotesingle{}     p"}
\CommentTok{\#\textquotesingle{}   block \textless{}{-} new\_code\_block("r", codes, list(eval = T, echo = T, message = T))}
\CommentTok{\#\textquotesingle{}   \#\# see results}
\CommentTok{\#\textquotesingle{}   block}
\CommentTok{\#\textquotesingle{}   call\_command(block)}
\CommentTok{\#\textquotesingle{}   writeLines(call\_command(block))}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# figure}
\CommentTok{\#\textquotesingle{}   fig\_block \textless{}{-} new\_code\_block\_figure(}
\CommentTok{\#\textquotesingle{}     "plot1",}
\CommentTok{\#\textquotesingle{}     "this is a caption",}
\CommentTok{\#\textquotesingle{}     codes = codes}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   \#\# see results}
\CommentTok{\#\textquotesingle{}   fig\_block}
\CommentTok{\#\textquotesingle{}   writeLines(call\_command(fig\_block))}
\CommentTok{\#\textquotesingle{}   command\_args(fig\_block)}
\CommentTok{\#\textquotesingle{}   cat(get\_ref(fig\_block), "\textbackslash{}n")}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# table}
\CommentTok{\#\textquotesingle{}   codes \textless{}{-} "df \textless{}{-} data.frame(x = 1:10) \%\textgreater{}\% }
\CommentTok{\#\textquotesingle{}     dplyr::mutate(y = x, z = x * y)}
\CommentTok{\#\textquotesingle{}     knitr::kable(df, format = \textquotesingle{}markdown\textquotesingle{}, caption = \textquotesingle{}this is a caption\textquotesingle{}) "}
\CommentTok{\#\textquotesingle{}   tab\_block \textless{}{-} new\_code\_block\_table("table1", codes = codes)}
\CommentTok{\#\textquotesingle{}   \#\# see results}
\CommentTok{\#\textquotesingle{}   tab\_block}
\CommentTok{\#\textquotesingle{}   cat(get\_ref(tab\_block), "\textbackslash{}n")}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# default parameters}
\CommentTok{\#\textquotesingle{}   new\_code\_block()}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"show"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{object =} \StringTok{"code\_block"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(object)\{}
\NormalTok{            content }\OtherTok{\textless{}{-}} \FunctionTok{call\_command}\NormalTok{(object)}
\NormalTok{            content }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(content,}
                            \ControlFlowTok{function}\NormalTok{(text)\{}
                              \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{grepl}\NormalTok{(}\StringTok{"\#}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{s*\#"}\NormalTok{, text))}
\NormalTok{                                crayon}\SpecialCharTok{::}\FunctionTok{silver}\NormalTok{(text)}
                              \ControlFlowTok{else}
\NormalTok{                                text}
\NormalTok{                            \})}
\NormalTok{            content[}\DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}} \FunctionTok{.text\_fold}\NormalTok{(content[}\DecValTok{1}\NormalTok{], }\AttributeTok{width =} \DecValTok{60}\NormalTok{)}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(content) }\SpecialCharTok{\textgreater{}} \DecValTok{4}\NormalTok{) \{}
\NormalTok{              content }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(content[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{3}\NormalTok{], crayon}\SpecialCharTok{::}\FunctionTok{silver}\NormalTok{(}\StringTok{" + \textless{}codes{-}fold\textgreater{} + "}\NormalTok{),}
                         \FunctionTok{tail}\NormalTok{(content, }\AttributeTok{n =} \DecValTok{1}\NormalTok{))}
\NormalTok{            \}}
            \FunctionTok{textSh}\NormalTok{(content, }\AttributeTok{pre\_collapse =}\NormalTok{ T)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod show}
\CommentTok{\#\textquotesingle{} @aliases show}
\CommentTok{\#\textquotesingle{} @rdname code\_block{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"show"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{object =} \StringTok{"code\_block\_table"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(object)\{}
            \FunctionTok{textSh}\NormalTok{(crayon}\SpecialCharTok{::}\FunctionTok{silver}\NormalTok{(}\StringTok{"use for cross{-}referencing:"}\NormalTok{,}
                                  \FunctionTok{get\_ref}\NormalTok{(object, }\StringTok{"tab"}\NormalTok{)), }\AttributeTok{ending =} \ConstantTok{NULL}\NormalTok{)}
            \FunctionTok{selectMethod}\NormalTok{(}\StringTok{"show"}\NormalTok{, }\StringTok{"code\_block"}\NormalTok{)}\SpecialCharTok{@}\FunctionTok{.Data}\NormalTok{(object)}
            \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{grepl}\NormalTok{(}\StringTok{"kable}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{([\^{}}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{(]*caption"}\NormalTok{, }\FunctionTok{codes}\NormalTok{(object))) \{}
              \FunctionTok{textSh}\NormalTok{(crayon}\SpecialCharTok{::}\FunctionTok{silver}\NormalTok{(}\StringTok{"make sure the codes contain:"}\NormalTok{,}
                                    \StringTok{"\textasciigrave{}knitr::kable(..., caption = \textquotesingle{}...\textquotesingle{})\textasciigrave{}"}\NormalTok{))}
\NormalTok{            \}}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod show}
\CommentTok{\#\textquotesingle{} @aliases show}
\CommentTok{\#\textquotesingle{} @rdname code\_block{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"show"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{object =} \StringTok{"code\_block\_figure"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(object)\{}
            \FunctionTok{textSh}\NormalTok{(crayon}\SpecialCharTok{::}\FunctionTok{silver}\NormalTok{(}\StringTok{"use for cross{-}referencing:"}\NormalTok{,}
                                  \FunctionTok{get\_ref}\NormalTok{(object, }\StringTok{"fig"}\NormalTok{)), }\AttributeTok{ending =} \ConstantTok{NULL}\NormalTok{)}
            \FunctionTok{selectMethod}\NormalTok{(}\StringTok{"show"}\NormalTok{, }\StringTok{"code\_block"}\NormalTok{)}\SpecialCharTok{@}\FunctionTok{.Data}\NormalTok{(object)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @importFrom crayon green}
\CommentTok{\#\textquotesingle{} @exportMethod show}
\CommentTok{\#\textquotesingle{} @aliases show}
\CommentTok{\#\textquotesingle{} @rdname code\_block{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"show"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{object =} \StringTok{"heading"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(object)\{}
            \FunctionTok{textSh}\NormalTok{(crayon}\SpecialCharTok{::}\NormalTok{green}\SpecialCharTok{$}\FunctionTok{bold}\NormalTok{(}\FunctionTok{call\_command}\NormalTok{(object)), }\AttributeTok{exdent =} \DecValTok{0}\NormalTok{)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod show}
\CommentTok{\#\textquotesingle{} @aliases show}
\CommentTok{\#\textquotesingle{} @rdname code\_block{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"show"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{object =} \StringTok{"section"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(object)\{}
            \FunctionTok{nshow}\NormalTok{(}\FunctionTok{heading}\NormalTok{(object))}
            \FunctionTok{textSh}\NormalTok{(}\FunctionTok{paragraph}\NormalTok{(object),}
                   \AttributeTok{pre\_collapse =}\NormalTok{ T, }\AttributeTok{pre\_trunc =}\NormalTok{ T, }\AttributeTok{pre\_wrap =}\NormalTok{ T)}
            \FunctionTok{nshow}\NormalTok{(}\FunctionTok{code\_block}\NormalTok{(object))}
\NormalTok{          \})}



\CommentTok{\#\textquotesingle{} @exportMethod code\_block}
\CommentTok{\#\textquotesingle{} @aliases code\_block}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{code\_block\}, \textbackslash{}code\{code\_block\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{code\_block\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname code\_block{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"code\_block"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{code\_block \})}

\CommentTok{\#\textquotesingle{} @exportMethod code\_block\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases code\_block\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname code\_block{-}class}
\CommentTok{\#\textquotesingle{}}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"code\_block"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{code\_block =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod codes}
\CommentTok{\#\textquotesingle{} @aliases codes}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{codes\}, \textbackslash{}code\{codes\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{codes\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname code\_block{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"codes"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"code\_block"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{codes \})}

\CommentTok{\#\textquotesingle{} @exportMethod codes\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases codes\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname code\_block{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"codes"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"code\_block"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{codes =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod new\_code\_block}
\CommentTok{\#\textquotesingle{} @aliases new\_code\_block}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{new\_code\_block\}: create a [code\_block{-}class] object.}
\CommentTok{\#\textquotesingle{} @param language character(1). For slot \textbackslash{}code\{command\_name\}.}
\CommentTok{\#\textquotesingle{} @param codes character. For slot \textbackslash{}code\{codes\}.}
\CommentTok{\#\textquotesingle{} @param args list. For slot \textbackslash{}code\{command\_args\}.}
\CommentTok{\#\textquotesingle{} @param prettey logical. If ture, use [styler::style\_text()] to pretty the codes.}
\CommentTok{\#\textquotesingle{} @param fun\_prettey function. Default is \textbackslash{}code\{styler::style\_text\}.}
\CommentTok{\#\textquotesingle{} @rdname code\_block{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"new\_code\_block"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{language =} \StringTok{"character"}\NormalTok{, }\AttributeTok{codes =} \StringTok{"character"}\NormalTok{,}
                        \AttributeTok{args =} \StringTok{"list"}\NormalTok{, }\AttributeTok{prettey =} \StringTok{"logical"}\NormalTok{,}
                        \AttributeTok{fun\_prettey =} \StringTok{"function"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(language, codes, args, prettey, fun\_prettey)\{}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(codes) }\SpecialCharTok{\textgreater{}} \DecValTok{1}\NormalTok{)}
\NormalTok{              codes }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(codes, }\AttributeTok{collapse =} \StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
            \ControlFlowTok{if}\NormalTok{ (prettey) \{}
\NormalTok{              codes }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{fun\_prettey}\NormalTok{(codes), }\AttributeTok{collapse =} \StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{            \}}
            \FunctionTok{.code\_block}\NormalTok{(}\AttributeTok{command\_name =}\NormalTok{ language, }\AttributeTok{codes =}\NormalTok{ codes,}
                        \AttributeTok{command\_args =}\NormalTok{ args)}
\NormalTok{          \})}


\CommentTok{\#\textquotesingle{} @exportMethod new\_code\_block}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{new\_code\_block()\}: get the default parameters}
\CommentTok{\#\textquotesingle{} for the method \textbackslash{}code\{new\_code\_block\}.}
\CommentTok{\#\textquotesingle{} @rdname code\_block{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"new\_code\_block"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"new\_code\_block"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"missing"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{()\{}
            \FunctionTok{list}\NormalTok{(}\AttributeTok{language =} \StringTok{"r"}\NormalTok{,}
                 \AttributeTok{codes =} \StringTok{"\#\# codes"}\NormalTok{,}
                 \AttributeTok{args =} \FunctionTok{.args\_r\_block}\NormalTok{(),}
                 \AttributeTok{prettey =}\NormalTok{ T,}
                 \AttributeTok{fun\_prettey =}\NormalTok{ styler}\SpecialCharTok{::}\NormalTok{style\_text}
\NormalTok{            )}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod new\_code\_block}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{new\_code\_block(x, ...)\}: use the default parameters whatever \textquotesingle{}missing\textquotesingle{}}
\CommentTok{\#\textquotesingle{} while performing the method \textbackslash{}code\{new\_code\_block\}.}
\CommentTok{\#\textquotesingle{} @rdname code\_block{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"new\_code\_block"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{language =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(language, codes, args, prettey, fun\_prettey)\{}
            \FunctionTok{reCallMethod}\NormalTok{(}\StringTok{"new\_code\_block"}\NormalTok{, }\FunctionTok{.fresh\_param}\NormalTok{(}\FunctionTok{new\_code\_block}\NormalTok{()))}
\NormalTok{          \})}


\CommentTok{\#\textquotesingle{} @exportMethod new\_code\_block\_figure}
\CommentTok{\#\textquotesingle{} @aliases new\_code\_block\_figure}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{new\_code\_block\_figure\}: create [code\_block\_figure{-}class] object.}
\CommentTok{\#\textquotesingle{} This methods simplified parameter settings for displaying figures in documents.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param name character(1). For cross{-}reference in document.}
\CommentTok{\#\textquotesingle{} See \textbackslash{}url\{https://bookdown.org/yihui/rmarkdown{-}cookbook/cross{-}ref.html\#cross{-}ref\}.}
\CommentTok{\#\textquotesingle{} @param caption character(1). Caption of figure display in document.}
\CommentTok{\#\textquotesingle{} @param ... Other parameters passed to [new\_code\_block()].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname code\_block{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"new\_code\_block\_figure"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{name =} \StringTok{"character"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(name, caption, ...)\{}
\NormalTok{            args }\OtherTok{\textless{}{-}} \FunctionTok{.fresh\_param}\NormalTok{(}\FunctionTok{new\_code\_block}\NormalTok{(), }\FunctionTok{list}\NormalTok{(...))}
\NormalTok{            args}\SpecialCharTok{$}\NormalTok{args}\SpecialCharTok{$}\NormalTok{fig.cap }\OtherTok{\textless{}{-}}\NormalTok{ caption}
\NormalTok{            args}\SpecialCharTok{$}\NormalTok{language }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"r "}\NormalTok{, name)}
            \FunctionTok{as}\NormalTok{(}\FunctionTok{do.call}\NormalTok{(new\_code\_block, args), }\StringTok{"code\_block\_figure"}\NormalTok{)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod new\_code\_block\_table}
\CommentTok{\#\textquotesingle{} @aliases new\_code\_block\_table}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{new\_code\_block\_table\}: create [code\_block\_table{-}class] object.}
\CommentTok{\#\textquotesingle{} This methods simplified parameter settings for displaying table in documents.}
\CommentTok{\#\textquotesingle{} @rdname code\_block{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"new\_code\_block\_table"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{name =} \StringTok{"character"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(name, ...)\{}
\NormalTok{            args }\OtherTok{\textless{}{-}} \FunctionTok{.fresh\_param}\NormalTok{(}\FunctionTok{new\_code\_block}\NormalTok{(), }\FunctionTok{list}\NormalTok{(...))}
\NormalTok{            args}\SpecialCharTok{$}\NormalTok{language }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"r "}\NormalTok{, name)}
            \FunctionTok{as}\NormalTok{(}\FunctionTok{do.call}\NormalTok{(new\_code\_block, args), }\StringTok{"code\_block\_table"}\NormalTok{)}
\NormalTok{          \})}


\CommentTok{\#\textquotesingle{} @exportMethod call\_command}
\CommentTok{\#\textquotesingle{} @aliases call\_command}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{call\_command\}: Format \textquotesingle{}code\_block\textquotesingle{} object as character.}
\CommentTok{\#\textquotesingle{} @family call\_commands}
\CommentTok{\#\textquotesingle{} @rdname code\_block{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"call\_command"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"code\_block"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \FunctionTok{do.call}\NormalTok{(}\FunctionTok{command\_function}\NormalTok{(x),}
                    \FunctionTok{c}\NormalTok{(}\AttributeTok{command\_name =} \FunctionTok{command\_name}\NormalTok{(x),}
                      \FunctionTok{command\_args}\NormalTok{(x), }\AttributeTok{codes =} \FunctionTok{codes}\NormalTok{(x)))}
\NormalTok{          \})}



\CommentTok{\#\textquotesingle{} @exportMethod heading}
\CommentTok{\#\textquotesingle{} @aliases heading}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{heading\}, \textbackslash{}code\{heading\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{heading\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname section{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"heading"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{heading \})}

\CommentTok{\#\textquotesingle{} @exportMethod heading\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases heading\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname section{-}class}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   \#\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} }
\CommentTok{\#\textquotesingle{}   \#\# heading}
\CommentTok{\#\textquotesingle{}   new\_heading("this is a heading", 2)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} }
\CommentTok{\#\textquotesingle{}   \#\# section}
\CommentTok{\#\textquotesingle{}   \#\# example 1}
\CommentTok{\#\textquotesingle{}   para \textless{}{-} "This is a paragraph stating"}
\CommentTok{\#\textquotesingle{}   section \textless{}{-} new\_section("this is a heading", 2, para)}
\CommentTok{\#\textquotesingle{}   \#\# see results}
\CommentTok{\#\textquotesingle{}   section}
\CommentTok{\#\textquotesingle{}   call\_command(section)}
\CommentTok{\#\textquotesingle{}   writeLines(call\_command(section))}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# example 2}
\CommentTok{\#\textquotesingle{}   para \textless{}{-} "This is a paragraph stating"}
\CommentTok{\#\textquotesingle{}   section \textless{}{-} new\_section(NULL, , para, NULL)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# example 3}
\CommentTok{\#\textquotesingle{}   para \textless{}{-} "This is a paragraph stating"}
\CommentTok{\#\textquotesingle{}   block \textless{}{-} new\_code\_block(codes = "df \textless{}{-} data.frame(x = 1:10)")}
\CommentTok{\#\textquotesingle{}   section \textless{}{-} new\_section("heading", 2, para, block)}
\CommentTok{\#\textquotesingle{}   section}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# example 4}
\CommentTok{\#\textquotesingle{}   codes \textless{}{-} "df \textless{}{-} data.frame(x = 1:10, y = 1:10)}
\CommentTok{\#\textquotesingle{}     p \textless{}{-} ggplot(df) +}
\CommentTok{\#\textquotesingle{}       geom\_point(aes(x = x, y = y))}
\CommentTok{\#\textquotesingle{}     p"}
\CommentTok{\#\textquotesingle{}   fig\_block \textless{}{-} new\_code\_block\_figure("plot", "this is caption", codes = codes)}
\CommentTok{\#\textquotesingle{}   para \textless{}{-} paste0("This is a paragraph describing the picture. ",}
\CommentTok{\#\textquotesingle{}                  "See Figure ", get\_ref(fig\_block), ".")}
\CommentTok{\#\textquotesingle{}   section \textless{}{-} new\_section("heading", 2, para, fig\_block)}
\CommentTok{\#\textquotesingle{}   section}
\CommentTok{\#\textquotesingle{}   \#\# output}
\CommentTok{\#\textquotesingle{}   tmp \textless{}{-} paste0(tempdir(), "/tmp\_output.Rmd")}
\CommentTok{\#\textquotesingle{}   writeLines(call\_command(section), tmp)}
\CommentTok{\#\textquotesingle{}   rmarkdown::render(tmp, output\_format = "bookdown::pdf\_document2")}
\CommentTok{\#\textquotesingle{}   file.exists(sub("Rmd$", "pdf", tmp))}
\CommentTok{\#\textquotesingle{}   \#\# see [report{-}class] object: }
\CommentTok{\#\textquotesingle{}   \#\# A complete output report, including multiple \textquotesingle{}section\textquotesingle{}.}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# defalt parameters}
\CommentTok{\#\textquotesingle{}   new\_section()}
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"heading"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{heading =}\NormalTok{ value)}
\NormalTok{                 \})}

\CommentTok{\#\textquotesingle{} @exportMethod level}
\CommentTok{\#\textquotesingle{} @aliases level}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{level\}, \textbackslash{}code\{level\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{level\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname section{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"level"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"heading"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{level \})}

\CommentTok{\#\textquotesingle{} @exportMethod level\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases level\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname section{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"level"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"heading"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{level =}\NormalTok{ value)}
\NormalTok{                 \})}

\CommentTok{\#\textquotesingle{} @exportMethod new\_heading}
\CommentTok{\#\textquotesingle{} @aliases new\_heading}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{new\_heading\}: create [heading{-}class] object.}
\CommentTok{\#\textquotesingle{} @param heading character(1). For slot \textbackslash{}code\{.Data\}.}
\CommentTok{\#\textquotesingle{} @param level numeric(1). For slot \textbackslash{}code\{level\}.}
\CommentTok{\#\textquotesingle{} @rdname section{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"new\_heading"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{heading =} \StringTok{"character"}\NormalTok{,}
                        \AttributeTok{level =} \StringTok{"numeric"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(heading, level)\{}
            \FunctionTok{.heading}\NormalTok{(heading, }\AttributeTok{level =}\NormalTok{ level)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod call\_command}
\CommentTok{\#\textquotesingle{} @aliases call\_command}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{call\_command\}: Format \textquotesingle{}heading\textquotesingle{} object as character.}
\CommentTok{\#\textquotesingle{} @family call\_commands}
\CommentTok{\#\textquotesingle{} @rdname section{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"call\_command"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"heading"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \FunctionTok{paste0}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\StringTok{"\#"}\NormalTok{, }\FunctionTok{level}\NormalTok{(x)), }\AttributeTok{collapse =} \StringTok{""}\NormalTok{),}
                   \StringTok{" "}\NormalTok{, x)}
\NormalTok{          \})}



\CommentTok{\#\textquotesingle{} @exportMethod paragraph}
\CommentTok{\#\textquotesingle{} @aliases paragraph}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{paragraph\}, \textbackslash{}code\{paragraph\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{paragraph\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname section{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"paragraph"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"section"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{paragraph \})}

\CommentTok{\#\textquotesingle{} @exportMethod paragraph\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases paragraph\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname section{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"paragraph"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"section"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{paragraph =}\NormalTok{ value)}
\NormalTok{                 \})}

\CommentTok{\#\textquotesingle{} @exportMethod new\_section}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{new\_section()\}: get the default parameters for}
\CommentTok{\#\textquotesingle{} the method \textbackslash{}code\{new\_section\}.}
\CommentTok{\#\textquotesingle{} @rdname section{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"new\_section"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"new\_section"}\NormalTok{,}
                                 \AttributeTok{heading =} \StringTok{"missing"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(heading, level, paragraph, code\_block)\{}
            \FunctionTok{list}\NormalTok{(}\AttributeTok{heading =} \StringTok{"heading"}\NormalTok{,}
                 \AttributeTok{level =} \DecValTok{2}\NormalTok{,}
                 \AttributeTok{paragraph =} \StringTok{"Description"}\NormalTok{,}
                 \AttributeTok{code\_block =} \FunctionTok{.code\_block}\NormalTok{()}
\NormalTok{            )}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod new\_section}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{new\_section(x, ...)\}: use the default parameters whatever \textquotesingle{}missing\textquotesingle{}}
\CommentTok{\#\textquotesingle{} while performing the method \textbackslash{}code\{new\_section\}.}
\CommentTok{\#\textquotesingle{} @rdname section{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"new\_section"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{heading =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(heading, level, paragraph, code\_block)\{}
\NormalTok{            args }\OtherTok{\textless{}{-}} \FunctionTok{.fresh\_param}\NormalTok{(}\FunctionTok{new\_section}\NormalTok{())}
            \FunctionTok{reCallMethod}\NormalTok{(}\StringTok{"new\_section"}\NormalTok{, args)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod new\_section}
\CommentTok{\#\textquotesingle{} @aliases new\_section}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{new\_section\}: create [section{-}class] object.}
\CommentTok{\#\textquotesingle{} @param paragraph character. Text for description.}
\CommentTok{\#\textquotesingle{} @param code\_block [code\_block{-}class] object.}
\CommentTok{\#\textquotesingle{} @rdname section{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"new\_section"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{heading =} \StringTok{"character"}\NormalTok{, }\AttributeTok{level =} \StringTok{"numeric"}\NormalTok{,}
                        \AttributeTok{paragraph =} \StringTok{"character"}\NormalTok{, }\AttributeTok{code\_block =} \StringTok{"maybe\_code\_block"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(heading, level, paragraph, code\_block)\{}
            \FunctionTok{.section}\NormalTok{(}\AttributeTok{heading =} \FunctionTok{.heading}\NormalTok{(heading, }\AttributeTok{level =}\NormalTok{ level),}
                     \AttributeTok{paragraph =}\NormalTok{ paragraph, }\AttributeTok{code\_block =}\NormalTok{ code\_block)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod new\_section}
\CommentTok{\#\textquotesingle{} @aliases new\_section}
\CommentTok{\#\textquotesingle{} @rdname section{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"new\_section"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{heading =} \StringTok{"NULL"}\NormalTok{, }\AttributeTok{level =} \StringTok{"numeric"}\NormalTok{,}
                        \AttributeTok{paragraph =} \StringTok{"character"}\NormalTok{, }\AttributeTok{code\_block =} \StringTok{"maybe\_code\_block"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(heading, level, paragraph, code\_block)\{}
            \FunctionTok{.section}\NormalTok{(}\AttributeTok{heading =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{paragraph =}\NormalTok{ paragraph, }\AttributeTok{code\_block =}\NormalTok{ code\_block)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @export new\_section2}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{new\_section2\}: Identical to \textbackslash{}code\{new\_section(NULL, , ...)\}}
\CommentTok{\#\textquotesingle{} @rdname section{-}class}
\NormalTok{new\_section2 }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(paragraph, code\_block) \{}
  \FunctionTok{new\_section}\NormalTok{(}\ConstantTok{NULL}\NormalTok{, }\DecValTok{2}\NormalTok{, paragraph, code\_block)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @exportMethod call\_command}
\CommentTok{\#\textquotesingle{} @aliases call\_command}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{call\_command\}: Format \textquotesingle{}section\textquotesingle{} object as character.}
\CommentTok{\#\textquotesingle{} @rdname section{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"call\_command"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"section"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \FunctionTok{.part}\NormalTok{(}\FunctionTok{call\_command}\NormalTok{(}\FunctionTok{heading}\NormalTok{(x)),}
                  \FunctionTok{paragraph}\NormalTok{(x),}
                  \FunctionTok{call\_command}\NormalTok{(}\FunctionTok{code\_block}\NormalTok{(x))}
\NormalTok{            )}
\NormalTok{          \})}



\CommentTok{\#\textquotesingle{} @exportMethod call\_command}
\CommentTok{\#\textquotesingle{} @aliases call\_command}
\CommentTok{\#\textquotesingle{} @rdname section{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"call\_command"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"NULL"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \FunctionTok{return}\NormalTok{()}
\NormalTok{          \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-class-statistic_set.r}{%
\section{File: class-statistic\_set.R}\label{file-class-statistic_set.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# a class for statistic analysis}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @exportClass statistic\_set}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases statistic\_set}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Data used for statistic analysis}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description A class object for statistic analysis, associate with package of "limma"}
\CommentTok{\#\textquotesingle{} for binary comparison.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot design\_matrix matrix. Create by [stats::model.matrix()].}
\CommentTok{\#\textquotesingle{} @slot contrast\_matrix matrix. Create by [limma::makeContrasts()].}
\CommentTok{\#\textquotesingle{} @slot dataset ANY. Dataset used for [limma::lmFit()], [limma::eBayes()]}
\CommentTok{\#\textquotesingle{} and other functions.}
\CommentTok{\#\textquotesingle{} @slot top\_table list with names. Each element of list should be "data.frame" or "tbl".}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname statistic\_set{-}class}
\CommentTok{\#\textquotesingle{}}
\NormalTok{.statistic\_set }\OtherTok{\textless{}{-}} 
  \FunctionTok{setClass}\NormalTok{(}\StringTok{"statistic\_set"}\NormalTok{, }
           \AttributeTok{contains =} \FunctionTok{character}\NormalTok{(),}
           \AttributeTok{representation =} 
             \FunctionTok{representation}\NormalTok{(}\AttributeTok{design\_matrix =} \StringTok{"matrix"}\NormalTok{,}
                            \AttributeTok{contrast\_matrix =} \StringTok{"matrix"}\NormalTok{,}
                            \AttributeTok{dataset =} \StringTok{"ANY"}\NormalTok{,}
                            \AttributeTok{top\_table =} \StringTok{"list"}
\NormalTok{                            ),}
           \AttributeTok{prototype =} \ConstantTok{NULL}
\NormalTok{           )}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# method}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @exportMethod statistic\_set}
\CommentTok{\#\textquotesingle{} @aliases statistic\_set}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{statistic\_set\}, \textbackslash{}code\{statistic\_set\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{statistic\_set\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname statistic\_set{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"statistic\_set"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{statistic\_set \})}

\CommentTok{\#\textquotesingle{} @exportMethod statistic\_set\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases statistic\_set\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname statistic\_set{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"statistic\_set"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{statistic\_set =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod design\_matrix}
\CommentTok{\#\textquotesingle{} @aliases design\_matrix}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{design\_matrix\}, \textbackslash{}code\{design\_matrix\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{design\_matrix\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname statistic\_set{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"design\_matrix"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{design\_matrix \})}

\CommentTok{\#\textquotesingle{} @exportMethod design\_matrix\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases design\_matrix\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname statistic\_set{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"design\_matrix"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{design\_matrix =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod contrast\_matrix}
\CommentTok{\#\textquotesingle{} @aliases contrast\_matrix}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{contrast\_matrix\}, \textbackslash{}code\{contrast\_matrix\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{contrast\_matrix\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname statistic\_set{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"contrast\_matrix"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{contrast\_matrix \})}

\CommentTok{\#\textquotesingle{} @exportMethod contrast\_matrix\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases contrast\_matrix\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname statistic\_set{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"contrast\_matrix"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{contrast\_matrix =}\NormalTok{ value)}
\NormalTok{                 \})}


\CommentTok{\#\textquotesingle{} @exportMethod top\_table}
\CommentTok{\#\textquotesingle{} @aliases top\_table}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{top\_table\}, \textbackslash{}code\{top\_table\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{top\_table\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname statistic\_set{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"top\_table"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{top\_table \})}

\CommentTok{\#\textquotesingle{} @exportMethod top\_table\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases top\_table\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname statistic\_set{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"top\_table"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{top\_table =}\NormalTok{ value)}
\NormalTok{                 \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-class-virtual_slots.r}{%
\section{File: class-VIRTUAL\_slots.R}\label{file-class-virtual_slots.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# VIRTUAL classes (sharing slots and methods)}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @aliases VIRTUAL\_dataset dataset}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Share slots and methods for classes inherite from VIRTUAL\_dataset}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description This VIRTUAL class provides a slot for storing data and methods}
\CommentTok{\#\textquotesingle{} for accessing data in slot.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @family datasets}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot dataset list with names (subscript, imply file names).}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname VIRTUAL\_dataset{-}class}
\FunctionTok{setClass}\NormalTok{(}\StringTok{"dataset"}\NormalTok{, }
         \AttributeTok{contains =} \FunctionTok{character}\NormalTok{(),}
         \AttributeTok{representation =} 
           \FunctionTok{representation}\NormalTok{(}\StringTok{"VIRTUAL"}\NormalTok{,}
                          \AttributeTok{dataset =} \StringTok{"list"}
\NormalTok{                          ),}
         \AttributeTok{prototype =} \ConstantTok{NULL}
\NormalTok{         )}

\CommentTok{\#\textquotesingle{} @aliases VIRTUAL\_reference reference}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Share slots and methods for classes inherite from VIRTUAL\_reference}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description This VIRTUAL class provides a slot for storing processed data.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @family references}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot reference list with names (formal name).}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname VIRTUAL\_reference{-}class}
\FunctionTok{setClass}\NormalTok{(}\StringTok{"reference"}\NormalTok{, }
         \AttributeTok{contains =} \FunctionTok{character}\NormalTok{(),}
         \AttributeTok{representation =} 
           \FunctionTok{representation}\NormalTok{(}\StringTok{"VIRTUAL"}\NormalTok{,}
                          \AttributeTok{reference =} \StringTok{"list"}
\NormalTok{                          ),}
         \AttributeTok{prototype =} \ConstantTok{NULL}
\NormalTok{         )}

\CommentTok{\#\textquotesingle{} @aliases VIRTUAL\_backtrack backtrack}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Share slots and methods for classes inherite from VIRTUAL\_backtrack}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description This VIRTUAL class provides a slot for storing discarded data.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @family backtracks}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot backtrack list with names.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname VIRTUAL\_backtrack{-}class}
\FunctionTok{setClass}\NormalTok{(}\StringTok{"backtrack"}\NormalTok{, }
         \AttributeTok{contains =} \FunctionTok{character}\NormalTok{(),}
         \AttributeTok{representation =} 
           \FunctionTok{representation}\NormalTok{(}\StringTok{"VIRTUAL"}\NormalTok{,}
                          \AttributeTok{backtrack =} \StringTok{"list"}
\NormalTok{                          ),}
         \AttributeTok{prototype =} \ConstantTok{NULL}
\NormalTok{         )}

\CommentTok{\#\textquotesingle{} @aliases VIRTUAL\_subscript subscript}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Share slots and methods for classes inherite from VIRTUAL\_subscript}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description This VIRTUAL class provides a slot for signing the data.}
\CommentTok{\#\textquotesingle{} The "subscript" like the signature for data, used to distinguish different data}
\CommentTok{\#\textquotesingle{} or file and retrieve it accurately.}
\CommentTok{\#\textquotesingle{} The "subscript" is mostly used for [project{-}class] (as well as its related classes):}
\CommentTok{\#\textquotesingle{} {-} imply file names. e.g., for "sirius.v4", ".f3\_fingerid" indicate all files in}
\CommentTok{\#\textquotesingle{} directory of "fingerid" for each features.}
\CommentTok{\#\textquotesingle{} {-} imply attribute names. e.g., for "sirius.v4", "tani.score" indicate attribute name}
\CommentTok{\#\textquotesingle{} of "tanimotoSimilarity".}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} In essence, "subscript" is the alias of a file or data or attribute.}
\CommentTok{\#\textquotesingle{} In this package, using the "subscript" system means that}
\CommentTok{\#\textquotesingle{} all external data names are given an alias.}
\CommentTok{\#\textquotesingle{} In fact, this makes things more complicated. Why did we do this?}
\CommentTok{\#\textquotesingle{} Because the naming system of external data is not constant,}
\CommentTok{\#\textquotesingle{} these names may change with the version of the data source.}
\CommentTok{\#\textquotesingle{} In order to enable this R package to accurately extract and call these data,}
\CommentTok{\#\textquotesingle{} it is necessary to establish a set of aliases within the package.}
\CommentTok{\#\textquotesingle{} "Subscript" names are used internally by this package.}
\CommentTok{\#\textquotesingle{} They correspond to external data and are equivalent to providing an interface}
\CommentTok{\#\textquotesingle{} to interface with external data.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @family subscripts}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot subscript character(1).}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname VIRTUAL\_subscript{-}class}
\FunctionTok{setClass}\NormalTok{(}\StringTok{"subscript"}\NormalTok{, }
         \AttributeTok{contains =} \FunctionTok{character}\NormalTok{(),}
         \AttributeTok{representation =} 
           \FunctionTok{representation}\NormalTok{(}\StringTok{"VIRTUAL"}\NormalTok{,}
                          \AttributeTok{subscript =} \StringTok{"character"}
\NormalTok{                          ),}
         \AttributeTok{prototype =} \ConstantTok{NULL}
\NormalTok{         )}

\CommentTok{\#\textquotesingle{} @aliases VIRTUAL\_export export}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Share slots and methods for classes inherite from VIRTUAL\_export}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description This VIRTUAL class provides slots for recording export path}
\CommentTok{\#\textquotesingle{} and export name of attributes.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @family exports}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot export\_path character(1). The export directory path.}
\CommentTok{\#\textquotesingle{} @slot export\_name character with names.}
\CommentTok{\#\textquotesingle{} While export, the attribute name will be converted to the value.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname VIRTUAL\_export{-}class}
\FunctionTok{setClass}\NormalTok{(}\StringTok{"export"}\NormalTok{, }
         \AttributeTok{contains =} \FunctionTok{character}\NormalTok{(),}
         \AttributeTok{representation =} 
           \FunctionTok{representation}\NormalTok{(}\StringTok{"VIRTUAL"}\NormalTok{,}
                          \AttributeTok{export\_path =} \StringTok{"character"}\NormalTok{,}
                          \AttributeTok{export\_name =} \StringTok{"character"}
\NormalTok{                          ),}
         \AttributeTok{prototype =} \ConstantTok{NULL}
\NormalTok{         )}

\CommentTok{\#\textquotesingle{} @aliases VIRTUAL\_layerSet layerSet}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Share slots and methods for classes inherite from VIRTUAL\_layerSet}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description This VIRTUAL class provides: slot \textbackslash{}code\{layers\} for storing}
\CommentTok{\#\textquotesingle{} hierarchical data; and methods for modify slot \textbackslash{}code\{layers\}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @family layerSets}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot layers list with names.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname VIRTUAL\_layerSet{-}class}
\FunctionTok{setClass}\NormalTok{(}\StringTok{"layerSet"}\NormalTok{, }
         \AttributeTok{contains =} \FunctionTok{character}\NormalTok{(),}
         \AttributeTok{representation =} 
           \FunctionTok{representation}\NormalTok{(}\StringTok{"VIRTUAL"}\NormalTok{,}
                          \AttributeTok{layers =} \StringTok{"list"}\NormalTok{),}
         \AttributeTok{prototype =} \ConstantTok{NULL}
\NormalTok{         )}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# validate}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\FunctionTok{setValidity}\NormalTok{(}\StringTok{"reference"}\NormalTok{, }
            \ControlFlowTok{function}\NormalTok{(object)\{}
\NormalTok{              check }\OtherTok{\textless{}{-}} \FunctionTok{vapply}\NormalTok{(}\FunctionTok{reference}\NormalTok{(object), is.data.frame,}
\NormalTok{                              T, }\AttributeTok{USE.NAMES =}\NormalTok{ F)}
              \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{any}\NormalTok{(}\SpecialCharTok{!}\NormalTok{check))}
                \StringTok{"the elements in }\SpecialCharTok{\textbackslash{}"}\StringTok{reference}\SpecialCharTok{\textbackslash{}"}\StringTok{ slot must be data.frame."}
              \ControlFlowTok{else}
                \ConstantTok{TRUE}
\NormalTok{            \})}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# method}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @exportMethod dataset}
\CommentTok{\#\textquotesingle{} @aliases dataset}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{dataset\}, \textbackslash{}code\{dataset\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{dataset\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname VIRTUAL\_dataset{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"dataset"}\NormalTok{, }\StringTok{"ANY"}\NormalTok{,}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{dataset \})}

\CommentTok{\#\textquotesingle{} @exportMethod dataset\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases dataset\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname VIRTUAL\_dataset{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"dataset"}\NormalTok{, }\StringTok{"ANY"}\NormalTok{,}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{dataset =}\NormalTok{ value)}
\NormalTok{                 \})}

\FunctionTok{setMethod}\NormalTok{(}\StringTok{"add\_dataset"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{, }\AttributeTok{list =} \StringTok{"list"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, list)\{}
\NormalTok{            dataset }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(list, }\FunctionTok{dataset}\NormalTok{(x))}
            \FunctionTok{dataset}\NormalTok{(x) }\OtherTok{\textless{}{-}} \FunctionTok{vecter\_unique\_by\_names}\NormalTok{(dataset)}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod reference}
\CommentTok{\#\textquotesingle{} @aliases reference}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{reference\}, \textbackslash{}code\{reference\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{reference\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname VIRTUAL\_reference{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"reference"}\NormalTok{, }\StringTok{"ANY"}\NormalTok{,}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{reference \})}

\CommentTok{\#\textquotesingle{} @exportMethod reference\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases reference\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @param x object inherit class \textbackslash{}code\{reference\}.}
\CommentTok{\#\textquotesingle{} @rdname VIRTUAL\_reference{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"reference"}\NormalTok{, }\StringTok{"ANY"}\NormalTok{,}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{reference =}\NormalTok{ value)}
\NormalTok{                 \})}

\CommentTok{\#\textquotesingle{} @exportMethod backtrack}
\CommentTok{\#\textquotesingle{} @aliases backtrack}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{backtrack\}, \textbackslash{}code\{backtrack\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{backtrack\} slot of the object.}
\CommentTok{\#\textquotesingle{} @param x object inherit class \textbackslash{}code\{backtrack\}.}
\CommentTok{\#\textquotesingle{} @rdname VIRTUAL\_backtrack{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"backtrack"}\NormalTok{, }\StringTok{"ANY"}\NormalTok{,}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{backtrack \})}

\CommentTok{\#\textquotesingle{} @exportMethod backtrack\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases backtrack\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname VIRTUAL\_backtrack{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"backtrack"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{backtrack =}\NormalTok{ value)}
\NormalTok{                 \})}

\CommentTok{\#\textquotesingle{} @exportMethod subscript}
\CommentTok{\#\textquotesingle{} @aliases subscript}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{subscript\}, \textbackslash{}code\{subscript\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{subscript\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname VIRTUAL\_subscript{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"subscript"}\NormalTok{, }\StringTok{"ANY"}\NormalTok{,}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{subscript \})}

\CommentTok{\#\textquotesingle{} @exportMethod subscript\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases subscript\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @param x object inherit class \textbackslash{}code\{subscript\}.}
\CommentTok{\#\textquotesingle{} @rdname VIRTUAL\_subscript{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"subscript"}\NormalTok{, }\StringTok{"ANY"}\NormalTok{,}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{subscript =}\NormalTok{ value)}
\NormalTok{                 \})}

\CommentTok{\#\textquotesingle{} @exportMethod export\_name}
\CommentTok{\#\textquotesingle{} @aliases export\_name}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{export\_name\}, \textbackslash{}code\{export\_name\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{export\_name\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname VIRTUAL\_export{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"export\_name"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{export\_name \})}

\CommentTok{\#\textquotesingle{} @exportMethod export\_name\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases export\_name\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @param x object inherit class \textbackslash{}code\{export\}.}
\CommentTok{\#\textquotesingle{} @rdname VIRTUAL\_export{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"export\_name"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{export\_name =}\NormalTok{ value)}
\NormalTok{                 \})}

\CommentTok{\#\textquotesingle{} @exportMethod export\_path}
\CommentTok{\#\textquotesingle{} @aliases export\_path}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{export\_path\}, \textbackslash{}code\{export\_path\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{export\_path\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname VIRTUAL\_export{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"export\_path"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
\NormalTok{            path }\OtherTok{\textless{}{-}}\NormalTok{ x}\SpecialCharTok{@}\NormalTok{export\_path}
            \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{file.exists}\NormalTok{(path))}
              \FunctionTok{dir.create}\NormalTok{(path)}
\NormalTok{            path}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod export\_path\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases export\_path\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname VIRTUAL\_export{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"export\_path"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{export\_path =}\NormalTok{ value)}
\NormalTok{                 \})}

\CommentTok{\#\textquotesingle{} @exportMethod layers}
\CommentTok{\#\textquotesingle{} @aliases layers}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{layers\}, \textbackslash{}code\{layers\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{layers\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname VIRTUAL\_layerSet{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"layers"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"layerSet"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{ x}\SpecialCharTok{@}\NormalTok{layers \})}

\CommentTok{\#\textquotesingle{} @exportMethod layers\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases layers\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @param x object inherit class \textbackslash{}code\{layerSet\}.}
\CommentTok{\#\textquotesingle{} @rdname VIRTUAL\_layerSet{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"layers"}\NormalTok{, }
                 \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"layerSet"}\NormalTok{),}
                 \ControlFlowTok{function}\NormalTok{(x, value)\{}
                   \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{layers =}\NormalTok{ value)}
\NormalTok{                 \})}

\CommentTok{\#\textquotesingle{} @exportMethod show}
\CommentTok{\#\textquotesingle{} @aliases show}
\CommentTok{\#\textquotesingle{} @rdname VIRTUAL\_layerSet{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"show"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{object =} \StringTok{"layerSet"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(object)\{}
            \FunctionTok{show\_layers}\NormalTok{(object)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod add\_layers}
\CommentTok{\#\textquotesingle{} @aliases add\_layers}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{add\_layers\}: add extra "layer" into slot \textbackslash{}code\{layers\}.}
\CommentTok{\#\textquotesingle{} @param x object contains slot \textbackslash{}code\{layers\}.}
\CommentTok{\#\textquotesingle{} @param ... extra "layer".}
\CommentTok{\#\textquotesingle{} @rdname VIRTUAL\_layerSet{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"add\_layers"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"layerSet"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, ...)\{}
\NormalTok{            args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(...)}
            \FunctionTok{layers}\NormalTok{(x) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FunctionTok{layers}\NormalTok{(x), args)}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod delete\_layers}
\CommentTok{\#\textquotesingle{} @aliases delete\_layers}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{delete\_layers\}: delete "layer" in slot \textbackslash{}code\{layers\}.}
\CommentTok{\#\textquotesingle{} @param layers numeric. The specified "layer" in slot \textbackslash{}code\{layers\}.}
\CommentTok{\#\textquotesingle{} @rdname VIRTUAL\_layerSet{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"delete\_layers"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"layerSet"}\NormalTok{, }\AttributeTok{layers =} \StringTok{"numeric"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, layers)\{}
            \FunctionTok{layers}\NormalTok{(x)[layers] }\OtherTok{\textless{}{-}} \ConstantTok{NULL}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod move\_layers}
\CommentTok{\#\textquotesingle{} @aliases move\_layers}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{move\_layers\}: change the order of "layer" in slot \textbackslash{}code\{layers\}.}
\CommentTok{\#\textquotesingle{} @param from sequence (sequence in list) of "layer" move from.}
\CommentTok{\#\textquotesingle{} @param to sequence (sequence in list) of "layer" move to.}
\CommentTok{\#\textquotesingle{} @rdname VIRTUAL\_layerSet{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"move\_layers"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"layerSet"}\NormalTok{, }\AttributeTok{from =} \StringTok{"numeric"}\NormalTok{, }\AttributeTok{to =} \StringTok{"numeric"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, from, to)\{}
            \FunctionTok{layers}\NormalTok{(x)[}\FunctionTok{c}\NormalTok{(from, to)] }\OtherTok{\textless{}{-}} \FunctionTok{layers}\NormalTok{(x)[}\FunctionTok{c}\NormalTok{(to, from)]}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod insert\_layers}
\CommentTok{\#\textquotesingle{} @aliases insert\_layers}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{insert\_layers\}: Insert "layers" into the specified}
\CommentTok{\#\textquotesingle{} position (sequence) of slot \textbackslash{}code\{layers\}.}
\CommentTok{\#\textquotesingle{} @rdname VIRTUAL\_layerSet{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"insert\_layers"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"layerSet"}\NormalTok{, }\AttributeTok{to =} \StringTok{"numeric"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, to, ...)\{}
\NormalTok{            before }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(}\FunctionTok{layers}\NormalTok{(x))}
\NormalTok{            x }\OtherTok{\textless{}{-}} \FunctionTok{add\_layers}\NormalTok{(x, ...)}
\NormalTok{            now }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(}\FunctionTok{layers}\NormalTok{(x))}
\NormalTok{            x }\OtherTok{\textless{}{-}} \FunctionTok{move\_layers}\NormalTok{(x, to}\SpecialCharTok{:}\NormalTok{before, (before }\SpecialCharTok{+} \DecValTok{1}\NormalTok{)}\SpecialCharTok{:}\NormalTok{now)}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-data.r}{%
\section{File: data.R}\label{file-data.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\textquotesingle{} Example object containing only five \textquotesingle{}features\textquotesingle{}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} This is a pre{-}extracted data from the SIRIUS project of example data using MCnebula2,}
\CommentTok{\#\textquotesingle{} containing chemical formulae, chemical structure,}
\CommentTok{\#\textquotesingle{} chemical classification candidates, etc. for five \textquotesingle{}features\textquotesingle{}}
\CommentTok{\#\textquotesingle{} (It is assumed to be a pre{-}processed metabolomic dataset).}
\CommentTok{\#\textquotesingle{} In order to reduce the memory footprint, some of its data columns have been}
\CommentTok{\#\textquotesingle{} removed, for example, the \textquotesingle{}links\textquotesingle{} data column has been converted to character(1)}
\CommentTok{\#\textquotesingle{} for the chemical structure data.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @details}
\CommentTok{\#\textquotesingle{} Data extracted via MCnebula2 package from path:}
\CommentTok{\#\textquotesingle{} {-} \textbackslash{}code\{system.file("extdata", "raw\_instance.tar.gz", package = "MCnebula2")\}.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} The MS/MS spectra were source from MoNA (MassBank of North America).}
\CommentTok{\#\textquotesingle{} The 5 MS/MS spectra were randomly extracted from GNPS spectral library of that.}
\CommentTok{\#\textquotesingle{} The candidates data were predicted via SIRIUS version 4 ...}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @format \#\# \textasciigrave{}mcn\_5features\textasciigrave{}}
\CommentTok{\#\textquotesingle{} [mcnebula{-}class] object.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @source The related website:}
\CommentTok{\#\textquotesingle{} {-} \textless{}https://mona.fiehnlab.ucdavis.edu/downloads\textgreater{}.}
\CommentTok{\#\textquotesingle{} {-} \textless{}https://bio.informatik.uni{-}jena.de/software/sirius/\textgreater{}}
\StringTok{"mcn\_5features"}

\CommentTok{\#\textquotesingle{} Example text for report description.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} Lazy data used to supplement the presentation of the report.}
\CommentTok{\#\textquotesingle{} It doesn\textquotesingle{}t make the description of the report outstanding, but it at least}
\CommentTok{\#\textquotesingle{} makes it decent (maybe).}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @format \#\# \textasciigrave{}reportDoc\textasciigrave{}}
\CommentTok{\#\textquotesingle{} A list object.}
\CommentTok{\#\textquotesingle{}}
\StringTok{"reportDoc"}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-extra-generic.r}{%
\section{File: extra-generic.R}\label{file-extra-generic.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# generic for class methods}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"collate\_data"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{ANY =} \StringTok{"x"}\NormalTok{, }\StringTok{"character"} \OtherTok{=} \StringTok{"subscript"}\NormalTok{,}
                         \StringTok{"function"} \OtherTok{=} \StringTok{"fun\_collate"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, subscript, fun\_collate, ...)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"collate\_data"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"read\_data"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{ANY =} \StringTok{"x"}\NormalTok{,}
                         \AttributeTok{project\_metadata =} \StringTok{"project\_metadata"}\NormalTok{,}
                         \AttributeTok{character =} \StringTok{"subscript"}\NormalTok{,}
                         \AttributeTok{character =} \StringTok{"path"}\NormalTok{,}
                         \AttributeTok{character =} \StringTok{".features\_id"}\NormalTok{,}
                         \AttributeTok{character =} \StringTok{".candidates\_id"}\NormalTok{,}
                         \StringTok{"function"} \OtherTok{=} \StringTok{"fun\_read"}\NormalTok{,}
                         \StringTok{"function"} \OtherTok{=} \StringTok{"fun\_format"}
\NormalTok{                         ),}
           \ControlFlowTok{function}\NormalTok{(x, project\_metadata, subscript,}
\NormalTok{                    path, .features\_id, .candidates\_id,}
\NormalTok{                    fun\_read, fun\_format) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"read\_data"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"draw\_structures"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{ANY =} \StringTok{"x"}\NormalTok{, }\StringTok{"character"} \OtherTok{=} \StringTok{"nebula\_name"}\NormalTok{,}
                         \StringTok{"character"} \OtherTok{=} \StringTok{".features\_id"}\NormalTok{,}
                         \StringTok{"data.frame"} \OtherTok{=} \StringTok{"data"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, nebula\_name, .features\_id, data, ...)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"draw\_structures"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"show\_structure"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\StringTok{"ANY"} \OtherTok{=} \StringTok{"x"}\NormalTok{, }\StringTok{"character"} \OtherTok{=} \StringTok{".features\_id"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, .features\_id)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"show\_structure"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"draw\_nodes"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{ANY =} \StringTok{"x"}\NormalTok{, }\StringTok{"character"} \OtherTok{=} \StringTok{"nebula\_name"}\NormalTok{,}
                         \StringTok{"character"} \OtherTok{=} \StringTok{"nodes\_color"}\NormalTok{,}
                         \StringTok{"logical"} \OtherTok{=} \StringTok{"add\_id\_text"}\NormalTok{,}
                         \StringTok{"logical"} \OtherTok{=} \StringTok{"add\_structure"}\NormalTok{, }\StringTok{"logical"} \OtherTok{=} \StringTok{"add\_ppcp"}\NormalTok{,}
                         \StringTok{"logical"} \OtherTok{=} \StringTok{"add\_ration"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, nebula\_name, nodes\_color, add\_id\_text,}
\NormalTok{                    add\_structure, add\_ppcp, add\_ration)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"draw\_nodes"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"show\_node"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{ANY =} \StringTok{"x"}\NormalTok{, }\StringTok{"character"} \OtherTok{=} \StringTok{".features\_id"}\NormalTok{,}
                         \AttributeTok{ANY =} \StringTok{"panel\_viewport"}\NormalTok{, }\AttributeTok{ANY =} \StringTok{"legend\_viewport"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, .features\_id, panel\_viewport, legend\_viewport)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"show\_node"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"set\_ppcp\_data"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{ANY =} \StringTok{"x"}\NormalTok{, }\StringTok{"character"} \OtherTok{=} \StringTok{"classes"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, classes) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"set\_ppcp\_data"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"set\_ration\_data"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{ANY =} \StringTok{"x"}\NormalTok{, }\StringTok{"logical"} \OtherTok{=} \StringTok{"mean"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, mean) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"set\_ration\_data"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"set\_nodes\_color"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, attribute, extra\_data, use\_tracer)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"set\_nodes\_color"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"set\_tracer"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, .features\_id, colors, rest)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"set\_tracer"}\NormalTok{))}
 
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"binary\_comparison"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{ANY =} \StringTok{"x"}\NormalTok{, }\StringTok{"formula"} \OtherTok{=} \StringTok{"formula"}\NormalTok{,}
                         \StringTok{"function"} \OtherTok{=} \StringTok{"fun\_norm"}\NormalTok{, }\StringTok{"ANY"} \OtherTok{=} \StringTok{"top\_coef"}\NormalTok{,}
                         \StringTok{"ANY"} \OtherTok{=} \StringTok{"contrasts"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, ..., formula, fun\_norm, top\_coef, contrasts)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"binary\_comparison"}\NormalTok{))}
 
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"get\_metadata"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{ANY =} \StringTok{"x"}\NormalTok{,}
                         \StringTok{"character"} \OtherTok{=} \StringTok{"subscript"}\NormalTok{,}
                         \AttributeTok{project\_metadata =} \StringTok{"project\_metadata"}\NormalTok{,}
                         \AttributeTok{project\_conformation =} \StringTok{"project\_conformation"}\NormalTok{,}
                         \StringTok{"character"} \OtherTok{=} \StringTok{"project\_version"}\NormalTok{,}
                         \StringTok{"character"} \OtherTok{=} \StringTok{"path"}
\NormalTok{                         ),}
           \ControlFlowTok{function}\NormalTok{(x, subscript, project\_metadata, project\_conformation,}
\NormalTok{             project\_version, path)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"get\_metadata"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"extract\_metadata"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{ANY =} \StringTok{"x"}\NormalTok{, }\StringTok{"character"} \OtherTok{=} \StringTok{"subscript"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, subscript) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"extract\_metadata"}\NormalTok{))}
 
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"add\_dataset"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\StringTok{"ANY"} \OtherTok{=} \StringTok{"x"}\NormalTok{, }\StringTok{"list"} \OtherTok{=} \StringTok{"list"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, list) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"add\_dataset"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"extract\_rawset"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\StringTok{"ANY"} \OtherTok{=} \StringTok{"x"}\NormalTok{, }\AttributeTok{character =} \StringTok{"subscript"}\NormalTok{,}
                         \StringTok{"function"} \OtherTok{=} \StringTok{"fun\_collate"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, subscript, fun\_collate, ...) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"extract\_rawset"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"extract\_mcnset"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\StringTok{"ANY"} \OtherTok{=} \StringTok{"x"}\NormalTok{, }\AttributeTok{character =} \StringTok{"subscript"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, subscript) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"extract\_mcnset"}\NormalTok{))}
 
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"get\_upper\_dir\_subscript"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{ANY =} \StringTok{"x"}\NormalTok{,}
                         \AttributeTok{character =} \StringTok{"subscript"}\NormalTok{,}
                         \AttributeTok{project\_conformation =} \StringTok{"project\_conformation"}
\NormalTok{                         ),}
           \ControlFlowTok{function}\NormalTok{(x, subscript, project\_conformation)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"get\_upper\_dir\_subscript"}\NormalTok{))}
 
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"latest"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, slot, subscript) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"latest"}\NormalTok{))}
 
\DocumentationTok{\#\# rename the colnames and check the values type (character or interger, etc.)}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"format\_msframe"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\StringTok{"ANY"} \OtherTok{=} \StringTok{"x"}\NormalTok{,}
                         \AttributeTok{character =} \StringTok{"names"}\NormalTok{, }\StringTok{"function"} \OtherTok{=} \StringTok{"fun\_names"}\NormalTok{,}
                         \AttributeTok{character =} \StringTok{"types"}\NormalTok{, }\StringTok{"function"} \OtherTok{=} \StringTok{"fun\_types"}\NormalTok{,}
                         \StringTok{"function"} \OtherTok{=} \StringTok{"fun\_format"}
\NormalTok{                         ),}
           \ControlFlowTok{function}\NormalTok{(x, names, fun\_names, types, fun\_types, fun\_format)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"format\_msframe"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"filter\_msframe"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{msframe =} \StringTok{"x"}\NormalTok{, }\StringTok{"function"} \OtherTok{=} \StringTok{"fun\_filter"}\NormalTok{,}
                         \StringTok{"formula"} \OtherTok{=} \StringTok{"f"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, fun\_filter, f, ...) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"filter\_msframe"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# for report and ggset}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"new\_command"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\StringTok{"function"} \OtherTok{=} \StringTok{"fun"}\NormalTok{,}
                         \StringTok{"character"} \OtherTok{=} \StringTok{"name"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(fun, ..., name)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"new\_command"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"call\_command"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"call\_command"}\NormalTok{))}
 
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"new\_code\_block"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{character =} \StringTok{"language"}\NormalTok{, }\StringTok{"character"} \OtherTok{=} \StringTok{"codes"}\NormalTok{,}
                         \StringTok{"list"} \OtherTok{=} \StringTok{"args"}\NormalTok{, }\StringTok{"logical"} \OtherTok{=} \StringTok{"prettey"}\NormalTok{,}
                         \StringTok{"function"} \OtherTok{=} \StringTok{"fun\_prettey"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(language, codes, args, prettey, fun\_prettey)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"new\_code\_block"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"new\_code\_block\_table"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{character =} \StringTok{"name"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(name, ...)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"new\_code\_block\_table"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"new\_code\_block\_figure"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{character =} \StringTok{"name"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(name, caption, ...)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"new\_code\_block\_figure"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"include\_table"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(data, name, caption)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"include\_table"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"include\_figure"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(file, name, caption)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"include\_figure"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"history\_rblock"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(nrow, pattern\_start, pattern\_end, exclude)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"history\_rblock"}\NormalTok{))}
 
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"new\_heading"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(heading, level)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"new\_heading"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"new\_section"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{character =} \StringTok{"heading"}\NormalTok{, }\StringTok{"numeric"} \OtherTok{=} \StringTok{"level"}\NormalTok{,}
                         \StringTok{"character"} \OtherTok{=} \StringTok{"paragraph"}\NormalTok{, }\StringTok{"ANY"} \OtherTok{=} \StringTok{"code\_block"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(heading, level, paragraph, code\_block)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"new\_section"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"new\_report"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(..., yaml)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"new\_report"}\NormalTok{))}
 
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"new\_ggset"}\NormalTok{,}
           \ControlFlowTok{function}\NormalTok{(...) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"new\_ggset"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"show\_layers"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"show\_layers"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"add\_layers"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{ANY =} \StringTok{"x"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, ...) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"add\_layers"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"delete\_layers"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{ANY =} \StringTok{"x"}\NormalTok{, }\StringTok{"numeric"} \OtherTok{=} \StringTok{"layers"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, layers) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"delete\_layers"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"move\_layers"}\NormalTok{,}
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{ANY =} \StringTok{"x"}\NormalTok{, }\StringTok{"numeric"} \OtherTok{=} \StringTok{"from"}\NormalTok{, }\StringTok{"numeric"} \OtherTok{=} \StringTok{"to"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, from, to)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"move\_layers"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"insert\_layers"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{ANY =} \StringTok{"x"}\NormalTok{, }\StringTok{"numeric"} \OtherTok{=} \StringTok{"to"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, to, ...) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"insert\_layers"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"mutate\_layer"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{ANY =} \StringTok{"x"}\NormalTok{, }\StringTok{"ANY"} \OtherTok{=} \StringTok{"layer"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, layer, ...)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"mutate\_layer"}\NormalTok{))}
 
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"workflow"}\NormalTok{, }
  \ControlFlowTok{function}\NormalTok{(sections, mode, envir, sirius\_version, sirius\_project, ion\_mode, ...)}
    \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"workflow"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-extramethods-binary_comparison.r}{%
\section{File: extraMethods-binary\_comparison.R}\label{file-extramethods-binary_comparison.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# use \textquotesingle{}limma\textquotesingle{} package to conduct binary comparison between sample group}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @aliases binary\_comparison}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Binary comparison for \textquotesingle{}features\textquotesingle{} quantification data}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} Use the functions in the \textquotesingle{}limma\textquotesingle{} package for simple binary statistical analysis.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name binary\_comparison{-}methods}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @seealso [stats::model.matrix()], [limma::makeContrasts()], [limma::lmFit()],}
\CommentTok{\#\textquotesingle{} [limma::eBayes()], [limma::contrasts.fit()], [limma::topTable()]...}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @order 1}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @exportMethod binary\_comparison}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{binary\_comparison()\}:}
\CommentTok{\#\textquotesingle{} get the default parameters for the method}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{binary\_comparison\}.}
\CommentTok{\#\textquotesingle{} @rdname binary\_comparison{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"binary\_comparison"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"binary\_comparison"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"missing"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{()\{}
            \FunctionTok{list}\NormalTok{(}\AttributeTok{formula =} \SpecialCharTok{\textasciitilde{}} \DecValTok{0} \SpecialCharTok{+}\NormalTok{ group,}
                 \AttributeTok{fun\_norm =} \ControlFlowTok{function}\NormalTok{(x) \{}
                   \FunctionTok{scale}\NormalTok{(}\FunctionTok{log2}\NormalTok{(x }\SpecialCharTok{+} \DecValTok{1}\NormalTok{), }\AttributeTok{center =}\NormalTok{ T, }\AttributeTok{scale =}\NormalTok{ F)}
\NormalTok{                 \},}
                 \AttributeTok{top\_coef =} \StringTok{"all"}
\NormalTok{            )}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod binary\_comparison}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{binary\_comparison(x, ...)\}:}
\CommentTok{\#\textquotesingle{} use the default parameters whatever \textquotesingle{}missing\textquotesingle{}}
\CommentTok{\#\textquotesingle{} while performing the method \textbackslash{}code\{binary\_comparison\}.}
\CommentTok{\#\textquotesingle{} @rdname binary\_comparison{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"binary\_comparison"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, ..., formula, fun\_norm, top\_coef, contrasts)\{}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{missing}\NormalTok{(...) }\SpecialCharTok{\&} \FunctionTok{missing}\NormalTok{(contrasts)) \{}
              \FunctionTok{stop}\NormalTok{(}\StringTok{"\textasciigrave{}...\textasciigrave{} (group contrast) should be specified, "}\NormalTok{,}
                   \StringTok{"e.g., model {-} control"}\NormalTok{)}
\NormalTok{            \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{missing}\NormalTok{(contrasts)) \{}
\NormalTok{              contrasts }\OtherTok{\textless{}{-}} \FunctionTok{as.character}\NormalTok{(}\FunctionTok{substitute}\NormalTok{(}\FunctionTok{list}\NormalTok{(...)))[}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{]}
\NormalTok{            \}}
            \FunctionTok{reCallMethod}\NormalTok{(}\StringTok{"binary\_comparison"}\NormalTok{,}
                         \FunctionTok{.fresh\_param}\NormalTok{(}\FunctionTok{binary\_comparison}\NormalTok{()))}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod binary\_comparison}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases binary\_comparison}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x [mcnebula{-}class] object.}
\CommentTok{\#\textquotesingle{} @param ... expressions, or character strings which can be parsed to}
\CommentTok{\#\textquotesingle{} expressions, specifying contrasts. See parameter of \textbackslash{}code\{...\} in}
\CommentTok{\#\textquotesingle{} [limma::makeContrasts()].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param formula formula. Passed to [model.matrix()].}
\CommentTok{\#\textquotesingle{} @param fun\_norm function. For normalization of \textquotesingle{}features\textquotesingle{} quantification}
\CommentTok{\#\textquotesingle{} data.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @param top\_coef list, NULL or character(1). Specified the parameter of}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{coef\} in [limma::topTable()]. If \textbackslash{}code\{"all"\}, all coefficient in}
\CommentTok{\#\textquotesingle{} contrast matrix would be used one by one.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param contrasts character vector specifying contrasts.}
\CommentTok{\#\textquotesingle{} See parameter \textbackslash{}code\{contrasts\} in [limma::makeContrasts()].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname binary\_comparison{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} mcn\_5features}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# the previous steps}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_structure(test)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_reference(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_formula(test1, by\_reference = T)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_features\_annotation(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# set up a simulated quantification data.}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} .simulate\_quant\_set(test1)}
\CommentTok{\#\textquotesingle{}   \#\# the simulated data}
\CommentTok{\#\textquotesingle{}   features\_quantification(test1)}
\CommentTok{\#\textquotesingle{}   sample\_metadata(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} binary\_comparison(}
\CommentTok{\#\textquotesingle{}     test1, control {-} model,}
\CommentTok{\#\textquotesingle{}     model {-} control, 2 * model {-} control}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   \#\# see results}
\CommentTok{\#\textquotesingle{}   top\_table(statistic\_set(test1))}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# the default parameters}
\CommentTok{\#\textquotesingle{}   binary\_comparison()}
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"binary\_comparison"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{, }\AttributeTok{formula =} \StringTok{"formula"}\NormalTok{,}
                        \AttributeTok{fun\_norm =} \StringTok{"function"}\NormalTok{, }\AttributeTok{top\_coef =} \StringTok{"ANY"}\NormalTok{,}
                        \AttributeTok{contrasts =} \StringTok{"character"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, formula, fun\_norm, top\_coef, contrasts)\{}
            \FunctionTok{.message\_info\_formal}\NormalTok{(}\StringTok{"MCnebula2"}\NormalTok{, }\StringTok{"binary\_comparison"}\NormalTok{)}
            \FunctionTok{.suggest\_bio\_package}\NormalTok{(}\StringTok{"limma"}\NormalTok{)}
            \FunctionTok{.check\_data}\NormalTok{(x, }\FunctionTok{list}\NormalTok{(}\AttributeTok{features\_quantification =} \StringTok{"features\_quantification"}\NormalTok{,}
                                \AttributeTok{sample\_metadata =} \StringTok{"sample\_metadata"}\NormalTok{), }\StringTok{"(x) \textless{}{-}"}\NormalTok{)}
            \DocumentationTok{\#\# design matrix}
\NormalTok{            design }\OtherTok{\textless{}{-}} \FunctionTok{model.matrix}\NormalTok{(formula, }\FunctionTok{sample\_metadata}\NormalTok{(x))}
            \FunctionTok{colnames}\NormalTok{(design) }\OtherTok{\textless{}{-}} \FunctionTok{gsub}\NormalTok{(}\StringTok{"group"}\NormalTok{, }\StringTok{""}\NormalTok{, }\FunctionTok{colnames}\NormalTok{(design))}
            \FunctionTok{design\_matrix}\NormalTok{(}\FunctionTok{statistic\_set}\NormalTok{(x)) }\OtherTok{\textless{}{-}}\NormalTok{ design}
            \DocumentationTok{\#\# contrast matrix}
\NormalTok{            contrast }\OtherTok{\textless{}{-}}
\NormalTok{              limma}\SpecialCharTok{::}\FunctionTok{makeContrasts}\NormalTok{(}\AttributeTok{contrasts =}\NormalTok{ contrasts, }\AttributeTok{levels =}\NormalTok{ design)}
            \FunctionTok{contrast\_matrix}\NormalTok{(}\FunctionTok{statistic\_set}\NormalTok{(x)) }\OtherTok{\textless{}{-}}\NormalTok{ contrast}
            \DocumentationTok{\#\# format data}
            \FunctionTok{features\_quantification}\NormalTok{(x) }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(}
              \FunctionTok{features\_quantification}\NormalTok{(x), .data}\SpecialCharTok{$}\NormalTok{.features\_id,}
\NormalTok{              dplyr}\SpecialCharTok{::}\FunctionTok{all\_of}\NormalTok{(}\FunctionTok{sample\_metadata}\NormalTok{(x)}\SpecialCharTok{$}\NormalTok{sample)}
\NormalTok{            )}
\NormalTok{            data }\OtherTok{\textless{}{-}} \FunctionTok{fun\_norm}\NormalTok{(}\FunctionTok{.features\_quantification}\NormalTok{(x))}
\NormalTok{            col }\OtherTok{\textless{}{-}} \FunctionTok{colnames}\NormalTok{(data)}
\NormalTok{            col }\OtherTok{\textless{}{-}}\NormalTok{ col }\SpecialCharTok{\%in\%} \FunctionTok{sample\_metadata}\NormalTok{(x)}\SpecialCharTok{$}\NormalTok{sample}
\NormalTok{            data }\OtherTok{\textless{}{-}}\NormalTok{ data[, col]}
            \DocumentationTok{\#\# fit with linear model}
\NormalTok{            fit }\OtherTok{\textless{}{-}}\NormalTok{ limma}\SpecialCharTok{::}\FunctionTok{lmFit}\NormalTok{(data, design)}
            \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\NormalTok{formula }\SpecialCharTok{==} \ErrorTok{\textasciitilde{}} \DecValTok{0} \SpecialCharTok{+}\NormalTok{ group) \{}
              \FunctionTok{dataset}\NormalTok{(}\FunctionTok{statistic\_set}\NormalTok{(x)) }\OtherTok{\textless{}{-}}\NormalTok{ fit}
              \FunctionTok{message}\NormalTok{(}\StringTok{"identical(\textasciigrave{}formula\textasciigrave{}, \textasciitilde{} 0 + group) == F, "}\NormalTok{,}
                             \StringTok{"stop downstream analysis."}\NormalTok{,}
                             \StringTok{"}\SpecialCharTok{\textbackslash{}n\textbackslash{}t}\StringTok{use \textasciigrave{}dataset(statistic\_set(x))\textasciigrave{} "}\NormalTok{,}
                             \StringTok{"to get \textasciigrave{}limma::limFit(data, design)\textasciigrave{} output object "}\NormalTok{,}
                             \StringTok{"for custom \textquotesingle{}limma\textquotesingle{} analysis."}\NormalTok{)}
              \FunctionTok{return}\NormalTok{(x)}
\NormalTok{            \}}
\NormalTok{            fit }\OtherTok{\textless{}{-}}\NormalTok{ limma}\SpecialCharTok{::}\FunctionTok{contrasts.fit}\NormalTok{(fit, contrast)}
\NormalTok{            fit }\OtherTok{\textless{}{-}}\NormalTok{ limma}\SpecialCharTok{::}\FunctionTok{eBayes}\NormalTok{(fit)}
            \FunctionTok{dataset}\NormalTok{(}\FunctionTok{statistic\_set}\NormalTok{(x)) }\OtherTok{\textless{}{-}}\NormalTok{ fit}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(top\_coef)) \{}
              \FunctionTok{return}\NormalTok{(x)}
\NormalTok{            \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{any}\NormalTok{(top\_coef }\SpecialCharTok{==} \StringTok{"all"}\NormalTok{)) \{}
\NormalTok{              top\_coef }\OtherTok{\textless{}{-}} \FunctionTok{as.list}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{ncol}\NormalTok{(contrast))}
\NormalTok{            \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.list}\NormalTok{(top\_coef)) \{}
\NormalTok{              top\_coef }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(top\_coef)}
\NormalTok{            \}}
\NormalTok{            lst }\OtherTok{\textless{}{-}} 
              \FunctionTok{lapply}\NormalTok{(top\_coef, }
                     \ControlFlowTok{function}\NormalTok{(i)\{}
\NormalTok{                       top }\OtherTok{\textless{}{-}}\NormalTok{ limma}\SpecialCharTok{::}\FunctionTok{topTable}\NormalTok{(fit, }\AttributeTok{coef =}\NormalTok{ i, }\AttributeTok{adjust =} \StringTok{"BH"}\NormalTok{,}
                                              \AttributeTok{number =} \ConstantTok{Inf}\NormalTok{)}
\NormalTok{                       top }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(top, }\AttributeTok{.features\_id =} \FunctionTok{rownames}\NormalTok{(top))}
\NormalTok{                       dplyr}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(dplyr}\SpecialCharTok{::}\FunctionTok{relocate}\NormalTok{(top, .features\_id))}
\NormalTok{                     \})}
            \FunctionTok{names}\NormalTok{(lst) }\OtherTok{\textless{}{-}}
              \FunctionTok{vapply}\NormalTok{(top\_coef, }\AttributeTok{FUN.VALUE =} \StringTok{"ch"}\NormalTok{, }\AttributeTok{USE.NAMES =}\NormalTok{ F,}
                     \ControlFlowTok{function}\NormalTok{(i)\{}
                       \FunctionTok{paste0}\NormalTok{(}\FunctionTok{colnames}\NormalTok{(contrast)[i], }\AttributeTok{collapse =} \StringTok{" \& "}\NormalTok{)}
\NormalTok{                     \})}
            \FunctionTok{top\_table}\NormalTok{(}\FunctionTok{statistic\_set}\NormalTok{(x)) }\OtherTok{\textless{}{-}}\NormalTok{ lst}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-extramethods-collate_data.r}{%
\section{File: extraMethods-collate\_data.R}\label{file-extramethods-collate_data.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# collate any dataset in target project without filtering or arranging,}
\CommentTok{\# relative to class{-}project}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @aliases collate\_data}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Extract and format data from raw project directory}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description }
\CommentTok{\#\textquotesingle{} The primary method used to extract data from the raw project directory.}
\CommentTok{\#\textquotesingle{} By specifying [subscript{-}class], this method reads all corresponding files,}
\CommentTok{\#\textquotesingle{} followed by gathering and formating the data, then stores these data in the slot}
\CommentTok{\#\textquotesingle{} (\textbackslash{}code\{dataset(project\_dataset(object))\}).}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @note Normally, users do not need to use this method for MCnebula2 analysis.}
\CommentTok{\#\textquotesingle{} [filter\_formula()], [filter\_structure()], [filter\_ppcp()]}
\CommentTok{\#\textquotesingle{} provide more understandable usage.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @details }
\CommentTok{\#\textquotesingle{} This methods requires the name and path of the file in the raw project directory,}
\CommentTok{\#\textquotesingle{} as well as the reading function; These are recorded in [project{-}class].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name collate\_data{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @order 1}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @importFrom dplyr mutate}
\CommentTok{\#\textquotesingle{} @importFrom dplyr relocate}
\CommentTok{\#\textquotesingle{} @importFrom dplyr select}
\CommentTok{\#\textquotesingle{} @importFrom dplyr arrange}
\CommentTok{\#\textquotesingle{} @importFrom dplyr distinct}
\CommentTok{\#\textquotesingle{} @importFrom dplyr filter}
\CommentTok{\#\textquotesingle{} @importFrom dplyr rename}
\CommentTok{\#\textquotesingle{} @importFrom tibble as\_tibble}
\CommentTok{\#\textquotesingle{} @importFrom tibble tibble}
\CommentTok{\#\textquotesingle{} @importFrom data.table rbindlist}
\CommentTok{\#\textquotesingle{} @importFrom data.table fread}
\CommentTok{\#\textquotesingle{} @importFrom stringr str\_extract}
\CommentTok{\#\textquotesingle{} @exportMethod collate\_data}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{collate\_data()\}: get the default parameters for the method}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{collate\_data\}.}
\CommentTok{\#\textquotesingle{} @rdname collate\_data{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"collate\_data"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"collate\_data"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{()\{}
            \FunctionTok{list}\NormalTok{(}\AttributeTok{fun\_collate =}\NormalTok{ .collate\_data.msframe)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod collate\_data}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{collate\_data(x, ...)\}: use the default parameters whatever \textquotesingle{}missing\textquotesingle{}}
\CommentTok{\#\textquotesingle{} while performing the method \textbackslash{}code\{collate\_data\}.}
\CommentTok{\#\textquotesingle{} @rdname collate\_data{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"collate\_data"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, subscript, fun\_collate, ...)\{}
            \FunctionTok{reCallMethod}\NormalTok{(}\StringTok{"collate\_data"}\NormalTok{,}
                         \FunctionTok{.fresh\_param}\NormalTok{(}\FunctionTok{collate\_data}\NormalTok{()), ...)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod collate\_data}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases collate\_data}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x [project{-}class] object or other class object inheriting it.}
\CommentTok{\#\textquotesingle{} @param subscript character(1). See [subscript{-}class].}
\CommentTok{\#\textquotesingle{} @param fun\_collate function.}
\CommentTok{\#\textquotesingle{} Used to extract and format the data from raw project directory.}
\CommentTok{\#\textquotesingle{} The default is \textbackslash{}code\{MCnebula2:::.collate\_data.msframe\}.}
\CommentTok{\#\textquotesingle{} @param ... Other parameters passed to the fun\_collate.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname collate\_data{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   \#\# The raw data used for the example}
\CommentTok{\#\textquotesingle{}   tmp \textless{}{-} paste0(tempdir(), "/temp\_data")}
\CommentTok{\#\textquotesingle{}   dir.create(tmp)}
\CommentTok{\#\textquotesingle{}   eg.path \textless{}{-} system.file("extdata", "raw\_instance.tar.gz",}
\CommentTok{\#\textquotesingle{}                          package = "MCnebula2")}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   utils::untar(eg.path, exdir = tmp)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# initialize \textquotesingle{}mcnebula\textquotesingle{} object}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} mcnebula()}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} initialize\_mcnebula(test, "sirius.v4", tmp)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# extract candidates data in SIRIUS project directory}
\CommentTok{\#\textquotesingle{}   \#\# chemical structure}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} collate\_data(test, ".f3\_fingerid")}
\CommentTok{\#\textquotesingle{}   latest(project\_dataset(test))}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# chemical formula}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} collate\_data(test, ".f2\_formula")}
\CommentTok{\#\textquotesingle{}   latest(project\_dataset(test))}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# chemical classes}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} collate\_data(test, ".f3\_canopus")}
\CommentTok{\#\textquotesingle{}   latest(project\_dataset(test))}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# mz and rt}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} collate\_data(test, ".f2\_info")}
\CommentTok{\#\textquotesingle{}   latest(project\_dataset(test))}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# classification description}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} collate\_data(test, ".canopus")}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# the extracted data in \textquotesingle{}mcnebula\textquotesingle{}}
\CommentTok{\#\textquotesingle{}   dataset(project\_dataset(test))}
\CommentTok{\#\textquotesingle{}   entity(dataset(project\_dataset(test))$.f3\_fingerid)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   unlink(tmp, T, T)}
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"collate\_data"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{, }\AttributeTok{subscript =} \StringTok{"character"}\NormalTok{,}
                        \AttributeTok{fun\_collate =} \StringTok{"function"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, subscript, fun\_collate, ...)\{}
\NormalTok{            x }\OtherTok{\textless{}{-}} \FunctionTok{get\_metadata}\NormalTok{(x, subscript)}
\NormalTok{            msframe.lst }\OtherTok{\textless{}{-}} \FunctionTok{extract\_rawset}\NormalTok{(x, subscript, fun\_collate, ...)}
            \FunctionTok{project\_dataset}\NormalTok{(x) }\OtherTok{\textless{}{-}} \FunctionTok{add\_dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(x), msframe.lst)}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}

\NormalTok{.collate\_data.msframe }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(x, subscript, reference)\{}
\NormalTok{    project\_metadata }\OtherTok{\textless{}{-}} \FunctionTok{extract\_metadata}\NormalTok{(x, subscript)}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{missing}\NormalTok{(reference)) \{}
\NormalTok{      df }\OtherTok{\textless{}{-}} \FunctionTok{metadata}\NormalTok{(project\_metadata)[[ subscript ]]}
\NormalTok{      df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(df, }\AttributeTok{.features\_id =} \FunctionTok{match.features\_id}\NormalTok{(x)(upper),}
                          \AttributeTok{.candidates\_id =} \FunctionTok{match.candidates\_id}\NormalTok{(x)(files))}
\NormalTok{      df }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(reference, df, }\AttributeTok{by =} \FunctionTok{c}\NormalTok{(}\StringTok{".features\_id"}\NormalTok{, }\StringTok{".candidates\_id"}\NormalTok{))}
      \FunctionTok{metadata}\NormalTok{(project\_metadata)[[ subscript ]] }\OtherTok{\textless{}{-}}\NormalTok{ df}
\NormalTok{    \}}
    \FunctionTok{read\_data}\NormalTok{(x, }\AttributeTok{project\_metadata =}\NormalTok{ project\_metadata,}
              \AttributeTok{subscript =}\NormalTok{ subscript)}
\NormalTok{  \}}


\CommentTok{\# @exportMethod read\_data}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{read\_data\}: basic methods used to extract and format}
\CommentTok{\#\textquotesingle{} data from raw project directory.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param project\_metadata [project\_metadata{-}class] object. Specifying the files to read.}
\CommentTok{\#\textquotesingle{} @param path character(1). The path of raw project directory.}
\CommentTok{\#\textquotesingle{} @param .features\_id character. ID for signing files in sub{-}directory of each \textquotesingle{}features\textquotesingle{}.}
\CommentTok{\#\textquotesingle{} @param .candidates\_id character. ID for signing each candidates of \textquotesingle{}features\textquotesingle{}.}
\CommentTok{\#\textquotesingle{} @param fun\_read function. Used to read files from raw project directory.}
\CommentTok{\#\textquotesingle{} @param fun\_format function. Used to format the data.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname collate\_data{-}methods}
\CommentTok{\#\textquotesingle{} @noRd}
\CommentTok{\#\textquotesingle{}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"read\_data"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"read\_data"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"ANY"}\NormalTok{,}
                                 \AttributeTok{project\_metadata =} \StringTok{"project\_metadata"}\NormalTok{,}
                                 \AttributeTok{subscript =} \StringTok{"character"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, project\_metadata, subscript)\{}
\NormalTok{            path.df }\OtherTok{\textless{}{-}} \FunctionTok{metadata}\NormalTok{(project\_metadata)[[ subscript ]]}
\NormalTok{            path }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{project\_path}\NormalTok{(x), }\StringTok{"/"}\NormalTok{, path.df}\SpecialCharTok{$}\NormalTok{upper, }\StringTok{"/"}\NormalTok{, path.df}\SpecialCharTok{$}\NormalTok{files)}
\NormalTok{            fun\_read }\OtherTok{\textless{}{-}} \FunctionTok{methods\_read}\NormalTok{(x)[[ }\FunctionTok{paste0}\NormalTok{(}\StringTok{"read"}\NormalTok{, subscript) ]]}
\NormalTok{            fun\_format }\OtherTok{\textless{}{-}} \FunctionTok{methods\_format}\NormalTok{(x)}
\NormalTok{            .features\_id }\OtherTok{\textless{}{-}} \FunctionTok{match.features\_id}\NormalTok{(x)(path.df}\SpecialCharTok{$}\NormalTok{upper)}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(.features\_id) }\SpecialCharTok{==} \DecValTok{0}\NormalTok{)}
\NormalTok{              .features\_id }\OtherTok{\textless{}{-}}\NormalTok{ subscript}
\NormalTok{            .candidates\_id }\OtherTok{\textless{}{-}} \FunctionTok{match.candidates\_id}\NormalTok{(x)(path.df}\SpecialCharTok{$}\NormalTok{files)}
            \FunctionTok{.message\_info}\NormalTok{(}\StringTok{"collate\_data"}\NormalTok{, }\StringTok{"read\_data"}\NormalTok{, subscript)}
\NormalTok{            msframe }\OtherTok{\textless{}{-}} \FunctionTok{read\_data}\NormalTok{(}\AttributeTok{path =}\NormalTok{ path, }\AttributeTok{fun\_read =}\NormalTok{ fun\_read,}
                                 \AttributeTok{subscript =}\NormalTok{ subscript, }\AttributeTok{fun\_format =}\NormalTok{ fun\_format,}
                                 \AttributeTok{.features\_id =}\NormalTok{ .features\_id,}
                                 \AttributeTok{.candidates\_id =}\NormalTok{ .candidates\_id}
\NormalTok{            )}
\NormalTok{          \})}

\CommentTok{\# @exportMethod read\_data}
\CommentTok{\#\textquotesingle{} @rdname collate\_data{-}methods}
\CommentTok{\#\textquotesingle{} @noRd}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"read\_data"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"read\_data"}\NormalTok{,}
                       \AttributeTok{subscript =} \StringTok{"character"}\NormalTok{, }\AttributeTok{path =} \StringTok{"character"}\NormalTok{,}
                       \AttributeTok{.features\_id =} \StringTok{"character"}\NormalTok{, }\AttributeTok{.candidates\_id =} \StringTok{"character"}\NormalTok{,}
                       \AttributeTok{fun\_read =} \StringTok{"function"}\NormalTok{, }\AttributeTok{fun\_format =} \StringTok{"function"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(subscript, path,}
\NormalTok{                   .features\_id, .candidates\_id,}
\NormalTok{                   fun\_read, fun\_format)\{}
\NormalTok{            entity }\OtherTok{\textless{}{-}} \FunctionTok{fun\_read}\NormalTok{(path)}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.data.frame}\NormalTok{(entity)) \{}
              \DocumentationTok{\#\# a \textquotesingle{}data.table\textquotesingle{} may cause error}
\NormalTok{              entity }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\FunctionTok{data.frame}\NormalTok{(entity))}
              \FunctionTok{names}\NormalTok{(entity) }\OtherTok{\textless{}{-}}\NormalTok{ subscript}
\NormalTok{            \}}
\NormalTok{            entity }\OtherTok{\textless{}{-}} \FunctionTok{mapply}\NormalTok{(entity, .features\_id, .candidates\_id,}
                             \AttributeTok{SIMPLIFY =}\NormalTok{ F,}
                             \AttributeTok{FUN =} \ControlFlowTok{function}\NormalTok{(df, .features\_id, .candidates\_id)\{}
\NormalTok{                               dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(df, }\AttributeTok{.features\_id =}\NormalTok{ .features\_id,}
                                             \AttributeTok{.candidates\_id =}\NormalTok{ .candidates\_id)}
\NormalTok{                             \})}
\NormalTok{            entity }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{relocate}\NormalTok{(data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(entity, }\AttributeTok{fill =}\NormalTok{ T),}
\NormalTok{                                      .features\_id, .candidates\_id)}
\NormalTok{            msframe }\OtherTok{\textless{}{-}} \FunctionTok{new}\NormalTok{(}\StringTok{"msframe"}\NormalTok{, }\AttributeTok{subscript =}\NormalTok{ subscript, }\AttributeTok{entity =}\NormalTok{ entity)}
            \FunctionTok{fun\_format}\NormalTok{(msframe)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @export collate\_used}
\CommentTok{\#\textquotesingle{} @aliases collate\_used}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{collate\_used\}: Use [filter\_structure()] and [create\_reference()]}
\CommentTok{\#\textquotesingle{} to build \textquotesingle{}specific\_candidate\textquotesingle{} data, then collate all used data of MCnebula workflow}
\CommentTok{\#\textquotesingle{} from Project directory, for subsequent data processing.}
\CommentTok{\#\textquotesingle{} @rdname collate\_data{-}methods}
\NormalTok{collate\_used }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  x }\OtherTok{\textless{}{-}} \FunctionTok{filter\_structure}\NormalTok{(x)}
\NormalTok{  x }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(x)}
\NormalTok{  sub1 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{".f2\_formula"}\NormalTok{,  }\StringTok{".canopus"}\NormalTok{, }\StringTok{".f2\_info"}\NormalTok{, }\StringTok{".f2\_msms"}\NormalTok{)}
\NormalTok{  sub2 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{".f3\_canopus"}\NormalTok{, }\StringTok{".f3\_spectra"}\NormalTok{)}
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in}\NormalTok{ sub1) \{}
\NormalTok{    x }\OtherTok{\textless{}{-}} \FunctionTok{collate\_data}\NormalTok{(x, i)}
    \FunctionTok{message}\NormalTok{()}
\NormalTok{  \}}
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in}\NormalTok{ sub2) \{}
\NormalTok{    x }\OtherTok{\textless{}{-}} \FunctionTok{collate\_data}\NormalTok{(x, i, }\AttributeTok{reference =} \FunctionTok{specific\_candidate}\NormalTok{(x))}
    \FunctionTok{message}\NormalTok{()}
\NormalTok{  \}}
  \FunctionTok{return}\NormalTok{(x)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-extramethods-draw_nodes.r}{%
\section{File: extraMethods-draw\_nodes.R}\label{file-extramethods-draw_nodes.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# draw all nodes (with annotation) for a specified child{-}nebula}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @aliases draw\_nodes}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Draw and visualize chemcial structures for Child{-}Nebulae}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} Methods used for drawing and visualizing nodes of \textquotesingle{}features\textquotesingle{}}
\CommentTok{\#\textquotesingle{} in Child{-}Nebulae (networks). The methods used to visualize \textquotesingle{}features\textquotesingle{}}
\CommentTok{\#\textquotesingle{} with annotations of:}
\CommentTok{\#\textquotesingle{} {-} chemical structures}
\CommentTok{\#\textquotesingle{} {-} chemical classification}
\CommentTok{\#\textquotesingle{} {-} quantification data (peak area)}
\CommentTok{\#\textquotesingle{} {-} ID of \textquotesingle{}feature\textquotesingle{} (.features\_id)}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @details}
\CommentTok{\#\textquotesingle{} Those annotated visualizations are drawn in steps and then are put together.}
\CommentTok{\#\textquotesingle{} In order to render the text as a graphical path (otherwise, the graphics}
\CommentTok{\#\textquotesingle{} would not be compatible with too small fonts and would result in misplaced text),}
\CommentTok{\#\textquotesingle{} the \textquotesingle{}ggplot\textquotesingle{} object or \textquotesingle{}grob\textquotesingle{} object is first exported as an SVG file,}
\CommentTok{\#\textquotesingle{} which is subsequently read by [grImport2::readPicture()], followed by}
\CommentTok{\#\textquotesingle{} [grImport2::grobify()] as \textquotesingle{}grob\textquotesingle{} object, and then combined into}
\CommentTok{\#\textquotesingle{} the final \textquotesingle{}grob\textquotesingle{}. In general, this process is time consuming,}
\CommentTok{\#\textquotesingle{} especially when there are a lot of \textquotesingle{}features\textquotesingle{} for visualization.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @seealso [grid::grid.draw()], [grid::grob()], [grImport2::readPicture()],}
\CommentTok{\#\textquotesingle{} [grImport2::grobify()]...}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name draw\_nodes{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @order 1}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @exportMethod draw\_nodes}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{draw\_nodes()\}: get the function for generating}
\CommentTok{\#\textquotesingle{} default parameters for the method}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{draw\_nodes\}.}
\CommentTok{\#\textquotesingle{} @rdname draw\_nodes{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"draw\_nodes"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"draw\_nodes"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"missing"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{()\{}
            \ControlFlowTok{function}\NormalTok{(x) \{}
              \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(}\FunctionTok{nebula\_index}\NormalTok{(x)[[ }\StringTok{"tracer\_color"}\NormalTok{ ]])) \{}
\NormalTok{                nodes\_color }\OtherTok{\textless{}{-}} \FunctionTok{nebula\_index}\NormalTok{(x)[[ }\StringTok{"tracer\_color"}\NormalTok{ ]]}
                \FunctionTok{names}\NormalTok{(nodes\_color) }\OtherTok{\textless{}{-}} \FunctionTok{nebula\_index}\NormalTok{(x)[[ }\StringTok{".features\_id"}\NormalTok{ ]]}
\NormalTok{              \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{                nodes\_color }\OtherTok{\textless{}{-}} \StringTok{"\#FFF9F2"}
\NormalTok{              \}}
              \FunctionTok{list}\NormalTok{(}\AttributeTok{nodes\_color =}\NormalTok{ nodes\_color,}
                   \AttributeTok{add\_id\_text =}\NormalTok{ T,}
                   \AttributeTok{add\_structure =}\NormalTok{ T,}
                   \AttributeTok{add\_ppcp =}\NormalTok{ T,}
                   \AttributeTok{add\_ration =}\NormalTok{ T}
\NormalTok{              )}
\NormalTok{            \}}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod draw\_nodes}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{draw\_nodes(x, ...)\}: use the default parameters whatever \textquotesingle{}missing\textquotesingle{}}
\CommentTok{\#\textquotesingle{} while performing the method \textbackslash{}code\{draw\_nodes\}.}
\CommentTok{\#\textquotesingle{} @rdname draw\_nodes{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"draw\_nodes"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{, }\AttributeTok{nebula\_name =} \StringTok{"character"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, nebula\_name, nodes\_color, add\_id\_text, }
\NormalTok{                   add\_structure, add\_ppcp, add\_ration)\{}
            \FunctionTok{reCallMethod}\NormalTok{(}\StringTok{"draw\_nodes"}\NormalTok{,}
                         \FunctionTok{.fresh\_param}\NormalTok{(}\FunctionTok{draw\_nodes}\NormalTok{()(x)))}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @importFrom grDevices colorRampPalette dev.off}
\CommentTok{\#\textquotesingle{} @importFrom svglite svglite}
\CommentTok{\#\textquotesingle{} @importFrom grid pushViewport}
\CommentTok{\#\textquotesingle{} @importFrom grid viewport}
\CommentTok{\#\textquotesingle{} @importFrom grid popViewport}
\CommentTok{\#\textquotesingle{} @importFrom pbapply pblapply}
\CommentTok{\#\textquotesingle{} @importFrom tibble as\_tibble}
\CommentTok{\#\textquotesingle{} @importFrom rsvg rsvg\_svg}
\CommentTok{\#\textquotesingle{} @exportMethod draw\_nodes}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases draw\_nodes}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x [mcnebula{-}class] object.}
\CommentTok{\#\textquotesingle{} @param nebula\_name character(1). Chemical classes in \textquotesingle{}nebula\_index\textquotesingle{} data.}
\CommentTok{\#\textquotesingle{} Specified to draw nodes (of network) of all the \textquotesingle{}features\textquotesingle{} of that.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param nodes\_color character with names or not. The Value is Hex color.}
\CommentTok{\#\textquotesingle{} Specified colors for \textquotesingle{}features\textquotesingle{} to draw nodes. If the number of the colors}
\CommentTok{\#\textquotesingle{} were not enough, the rest \textquotesingle{}features\textquotesingle{} would be fill with default color.}
\CommentTok{\#\textquotesingle{} If [set\_tracer()] has been run, the colors specified in \textquotesingle{}nebula\_index\textquotesingle{}}
\CommentTok{\#\textquotesingle{} would be used preferentially.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param add\_id\_text logical. If \textbackslash{}code\{TRUE\}, add ID (.features\_id) for}
\CommentTok{\#\textquotesingle{} \textquotesingle{}features\textquotesingle{} inside the nodes.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @param add\_structure logical. If \textbackslash{}code\{TRUE\}, draw chemical structures inside}
\CommentTok{\#\textquotesingle{} the nodes. See [draw\_structures()].}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @param add\_ppcp logical. If \textbackslash{}code\{TRUE\}, draw radical bar plot inside the nodes}
\CommentTok{\#\textquotesingle{} for annotation of PPCP data. See [set\_ppcp\_data()] for custom modify the annotated}
\CommentTok{\#\textquotesingle{} PPCP data. Hex colors in \textbackslash{}code\{palette\_col(object)\} would be used for fill the bar}
\CommentTok{\#\textquotesingle{} plot (Used by [ggplot2::scale\_fill\_manual()]).}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param add\_ration logical. If \textbackslash{}code\{TRUE\}, draw ring plot inside the nodes}
\CommentTok{\#\textquotesingle{} for annotation of features quantification data. See [set\_ration\_data()] for custom}
\CommentTok{\#\textquotesingle{} modify the annotated quantification data. Hex colors in \textbackslash{}code\{palette\_stat(object)\}}
\CommentTok{\#\textquotesingle{} would be used for fill be ring plot.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname draw\_nodes{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} mcn\_5features}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# the previous steps}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_structure(test)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_reference(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_formula(test1, by\_reference = T)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_stardust\_classes(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_features\_annotation(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} cross\_filter\_stardust(test1, 2, 1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_nebula\_index(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} compute\_spectral\_similarity(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_child\_nebulae(test1, 0.01)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_child\_layouts(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} activate\_nebulae(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# set features quantification data}
\CommentTok{\#\textquotesingle{}   ids \textless{}{-} features\_annotation(test1)$.features\_id}
\CommentTok{\#\textquotesingle{}   quant. \textless{}{-} data.frame(}
\CommentTok{\#\textquotesingle{}     .features\_id = ids,}
\CommentTok{\#\textquotesingle{}     sample\_1 = rnorm(length(ids), 1000, 200),}
\CommentTok{\#\textquotesingle{}     sample\_2 = rnorm(length(ids), 2000, 500)}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   metadata \textless{}{-} data.frame(}
\CommentTok{\#\textquotesingle{}     sample = paste0("sample\_", 1:2),}
\CommentTok{\#\textquotesingle{}     group = c("control", "model")}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   features\_quantification(test1) \textless{}{-} quant.}
\CommentTok{\#\textquotesingle{}   sample\_metadata(test1) \textless{}{-} metadata}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# optional \textquotesingle{}nebula\_name\textquotesingle{}}
\CommentTok{\#\textquotesingle{}   visualize(test1)}
\CommentTok{\#\textquotesingle{}   \#\# a class for example}
\CommentTok{\#\textquotesingle{}   class \textless{}{-} visualize(test1)$class.name[1]}
\CommentTok{\#\textquotesingle{}   tmp \textless{}{-} export\_path(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} draw\_structures(test1, class)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} draw\_nodes(test1, class)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# see results}
\CommentTok{\#\textquotesingle{}   grobs \textless{}{-} nodes\_grob(child\_nebulae(test1))}
\CommentTok{\#\textquotesingle{}   grobs}
\CommentTok{\#\textquotesingle{}   grid::grid.draw(grobs[[1]])}
\CommentTok{\#\textquotesingle{}   \#\# visualize with ID of \textquotesingle{}feature\textquotesingle{} (.features\_id)}
\CommentTok{\#\textquotesingle{}   \#\# with legend}
\CommentTok{\#\textquotesingle{}   ids \textless{}{-} names(grobs)}
\CommentTok{\#\textquotesingle{}   x11(width = 9, height = 5)}
\CommentTok{\#\textquotesingle{}   show\_node(test1, ids[1])}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# default parameters}
\CommentTok{\#\textquotesingle{}   draw\_nodes()}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   unlink(tmp, T, T)}
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"draw\_nodes"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{, }\AttributeTok{nebula\_name =} \StringTok{"character"}\NormalTok{,}
                        \AttributeTok{nodes\_color =} \StringTok{"character"}\NormalTok{,}
                        \AttributeTok{add\_id\_text =} \StringTok{"logical"}\NormalTok{,}
                        \AttributeTok{add\_structure =} \StringTok{"logical"}\NormalTok{,}
                        \AttributeTok{add\_ppcp =} \StringTok{"logical"}\NormalTok{,}
                        \AttributeTok{add\_ration =} \StringTok{"logical"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, nebula\_name, nodes\_color, add\_id\_text, }
\NormalTok{                   add\_structure, add\_ppcp, add\_ration)\{}
            \ControlFlowTok{if}\NormalTok{ (add\_ppcp) \{}
              \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(}\FunctionTok{ppcp\_data}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))) }\SpecialCharTok{==} \DecValTok{0}\NormalTok{)}
\NormalTok{                x }\OtherTok{\textless{}{-}} \FunctionTok{set\_ppcp\_data}\NormalTok{(x)}
\NormalTok{            \}}
            \ControlFlowTok{if}\NormalTok{ (add\_ration) \{}
              \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(}\FunctionTok{ration\_data}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))) }\SpecialCharTok{==} \DecValTok{0}\NormalTok{)}
\NormalTok{                x }\OtherTok{\textless{}{-}} \FunctionTok{set\_ration\_data}\NormalTok{(x)}
\NormalTok{            \}}
            \ControlFlowTok{if}\NormalTok{ (add\_structure) \{}
              \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(}\FunctionTok{ppcp\_data}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))) }\SpecialCharTok{==} \DecValTok{0}\NormalTok{)}
\NormalTok{                x }\OtherTok{\textless{}{-}} \FunctionTok{draw\_structures}\NormalTok{(x, nebula\_name)}
\NormalTok{            \}}
\NormalTok{            .features\_id }\OtherTok{\textless{}{-}}
              \StringTok{\textasciigrave{}}\AttributeTok{[[}\StringTok{\textasciigrave{}}\NormalTok{(tibble}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(}\FunctionTok{tbl\_graph}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))[[nebula\_name]]),}
                   \StringTok{"name"}\NormalTok{)}
\NormalTok{            .features\_id }\OtherTok{\textless{}{-}}
              \FunctionTok{unlist}\NormalTok{(}\FunctionTok{lapply}\NormalTok{(.features\_id,}
                            \ControlFlowTok{function}\NormalTok{(id)\{}
                              \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(}\FunctionTok{nodes\_ggset}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))[[id]]))}
\NormalTok{                                id}
\NormalTok{                            \}))}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(.features\_id)) \{}
              \FunctionTok{return}\NormalTok{(x)}
\NormalTok{            \}}
\NormalTok{            ggsets }\OtherTok{\textless{}{-}} \FunctionTok{ggset\_activate\_nodes}\NormalTok{(x, .features\_id, nodes\_color,}
\NormalTok{                                     add\_ppcp, add\_ration)}
            \FunctionTok{nodes\_ggset}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x)) }\OtherTok{\textless{}{-}}
              \FunctionTok{c}\NormalTok{(}\FunctionTok{nodes\_ggset}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x)), ggsets)}
\NormalTok{            path }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{export\_path}\NormalTok{(x), }\StringTok{"/tmp/nodes"}\NormalTok{)}
            \FunctionTok{.check\_path}\NormalTok{(path)}
            \FunctionTok{.message\_info}\NormalTok{(}\StringTok{"draw\_nodes"}\NormalTok{, }\StringTok{"ggplot {-}\textgreater{} svg {-}\textgreater{} grob"}\NormalTok{)}
\NormalTok{            grImport2}\SpecialCharTok{:::}\FunctionTok{setPrefix}\NormalTok{(}\StringTok{""}\NormalTok{)}
\NormalTok{            nodes\_grob }\OtherTok{\textless{}{-}} 
\NormalTok{              pbapply}\SpecialCharTok{::}\FunctionTok{pbsapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(ggsets), }\AttributeTok{simplify =}\NormalTok{ F,}
                                \ControlFlowTok{function}\NormalTok{(id)\{}
\NormalTok{                                  file }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(path, }\StringTok{"/"}\NormalTok{, id, }\StringTok{".svg"}\NormalTok{)}
\NormalTok{                                  svglite}\SpecialCharTok{::}\FunctionTok{svglite}\NormalTok{(file, }\AttributeTok{bg =} \StringTok{"transparent"}\NormalTok{)}
\NormalTok{                                  ggset }\OtherTok{\textless{}{-}} \FunctionTok{modify\_rm\_legend}\NormalTok{(ggsets[[ id ]])}
\NormalTok{                                  ggset }\OtherTok{\textless{}{-}} \FunctionTok{modify\_set\_margin}\NormalTok{(ggset)}
                                  \FunctionTok{print}\NormalTok{(}\FunctionTok{call\_command}\NormalTok{(ggset))}
                                  \ControlFlowTok{if}\NormalTok{ (add\_structure) \{}
\NormalTok{                                    vp }\OtherTok{\textless{}{-}}\NormalTok{ grid}\SpecialCharTok{::}\FunctionTok{viewport}\NormalTok{(}\AttributeTok{width =} \FloatTok{0.8}\NormalTok{, }\AttributeTok{height =} \FloatTok{0.8}\NormalTok{)}
\NormalTok{                                    grid}\SpecialCharTok{::}\FunctionTok{pushViewport}\NormalTok{(vp)}
                                    \FunctionTok{show\_structure}\NormalTok{(x, id)}
\NormalTok{                                    grid}\SpecialCharTok{::}\FunctionTok{popViewport}\NormalTok{()}
\NormalTok{                                  \}}
                                  \ControlFlowTok{if}\NormalTok{ (add\_id\_text) \{}
\NormalTok{                                    label }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"ID: "}\NormalTok{, id)}
\NormalTok{                                    grid}\SpecialCharTok{::}\FunctionTok{grid.draw}\NormalTok{(}\FunctionTok{.grob\_node\_text}\NormalTok{(label))}
\NormalTok{                                  \}}
                                  \FunctionTok{dev.off}\NormalTok{()}
\NormalTok{                                  rsvg}\SpecialCharTok{::}\FunctionTok{rsvg\_svg}\NormalTok{(file, file)}
                                  \FunctionTok{.cairosvg\_to\_grob}\NormalTok{(file)}
\NormalTok{                                \})}
            \FunctionTok{nodes\_grob}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x)) }\OtherTok{\textless{}{-}} 
              \FunctionTok{c}\NormalTok{(}\FunctionTok{nodes\_grob}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x)), nodes\_grob)}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod show\_node}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{show\_node()\}: get the default parameters for the method}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{show\_node\}.}
\CommentTok{\#\textquotesingle{} @rdname draw\_nodes{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"show\_node"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"show\_node"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"missing"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{()\{}
            \FunctionTok{list}\NormalTok{(}\AttributeTok{panel\_viewport =}
\NormalTok{                 grid}\SpecialCharTok{::}\FunctionTok{viewport}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\FloatTok{0.4}\NormalTok{, }\DecValTok{1}\NormalTok{, }\AttributeTok{just =} \FunctionTok{c}\NormalTok{(}\StringTok{"left"}\NormalTok{, }\StringTok{"centre"}\NormalTok{)),}
               \AttributeTok{legend\_viewport =}
\NormalTok{                 grid}\SpecialCharTok{::}\FunctionTok{viewport}\NormalTok{(}\FloatTok{0.4}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\FloatTok{0.6}\NormalTok{, }\DecValTok{1}\NormalTok{, }\AttributeTok{just =} \FunctionTok{c}\NormalTok{(}\StringTok{"left"}\NormalTok{, }\StringTok{"centre"}\NormalTok{))}
\NormalTok{            )}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod show\_node}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases show\_node}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description Visualize the node of \textquotesingle{}feature\textquotesingle{} which has been drawn}
\CommentTok{\#\textquotesingle{} by methods [draw\_nodes()] (or drawn by methods [annotate\_nebula()]).}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{show\_node(x, ...)\}: use the default parameters whatever \textquotesingle{}missing\textquotesingle{}}
\CommentTok{\#\textquotesingle{} while performing the method \textbackslash{}code\{show\_node\}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x [mcnebula{-}class] object.}
\CommentTok{\#\textquotesingle{} @param .features\_id character(1). ID of \textquotesingle{}feature\textquotesingle{} to show node.}
\CommentTok{\#\textquotesingle{} @param panel\_viewport \textquotesingle{}viewport\textquotesingle{} object. Create by [grid::viewport()].}
\CommentTok{\#\textquotesingle{} @param legend\_viewport \textquotesingle{}viewport\textquotesingle{} object.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname draw\_nodes{-}methods}
\CommentTok{\#\textquotesingle{}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"show\_node"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{, }\AttributeTok{.features\_id =} \StringTok{"character"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, .features\_id, panel\_viewport, legend\_viewport)\{}
\NormalTok{            args }\OtherTok{\textless{}{-}} \FunctionTok{.fresh\_param}\NormalTok{(}\FunctionTok{show\_node}\NormalTok{())}
\NormalTok{            args}\SpecialCharTok{$}\NormalTok{.features\_id }\OtherTok{\textless{}{-}}\NormalTok{ .features\_id}
            \FunctionTok{do.call}\NormalTok{(.show\_node, args)}
\NormalTok{          \})}

\NormalTok{.show\_node }\OtherTok{\textless{}{-}}
  \ControlFlowTok{function}\NormalTok{(x, .features\_id, panel\_viewport, legend\_viewport)\{}
\NormalTok{    grob }\OtherTok{\textless{}{-}} \FunctionTok{nodes\_grob}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))[[.features\_id]]}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(grob))}
      \FunctionTok{stop}\NormalTok{(}\StringTok{"the node of \textasciigrave{}.features\_id\textasciigrave{} has not been drawn"}\NormalTok{)}
    \FunctionTok{.message\_info\_viewport}\NormalTok{(}\StringTok{"BEGIN"}\NormalTok{)}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(panel\_viewport)) \{}
      \FunctionTok{.check\_class}\NormalTok{(panel\_viewport, }\StringTok{"viewport"}\NormalTok{, }\StringTok{"grid::viewport"}\NormalTok{)}
\NormalTok{      grid}\SpecialCharTok{::}\FunctionTok{pushViewport}\NormalTok{(panel\_viewport)}
\NormalTok{      upper }\OtherTok{\textless{}{-}}\NormalTok{ T}
\NormalTok{    \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{      upper }\OtherTok{\textless{}{-}}\NormalTok{ F}
\NormalTok{    \}}
    \FunctionTok{.message\_info\_viewport}\NormalTok{()}
\NormalTok{    grid}\SpecialCharTok{::}\FunctionTok{grid.draw}\NormalTok{(grob)}
    \ControlFlowTok{if}\NormalTok{ (upper) \{}
\NormalTok{      grid}\SpecialCharTok{::}\FunctionTok{upViewport}\NormalTok{()}
\NormalTok{    \} }\ControlFlowTok{else}\NormalTok{ \{}
      \FunctionTok{return}\NormalTok{(}\FunctionTok{message}\NormalTok{(}\StringTok{""}\NormalTok{))}
\NormalTok{    \}}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(legend\_viewport)) \{}
      \FunctionTok{.check\_class}\NormalTok{(legend\_viewport, }\StringTok{"viewport"}\NormalTok{, }\StringTok{"grid::viewport"}\NormalTok{)}
      \FunctionTok{.message\_info\_viewport}\NormalTok{()}
\NormalTok{      grid}\SpecialCharTok{::}\FunctionTok{pushViewport}\NormalTok{(legend\_viewport)}
\NormalTok{      p }\OtherTok{\textless{}{-}} \FunctionTok{call\_command}\NormalTok{(}\FunctionTok{nodes\_ggset}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))[[.features\_id]])}
\NormalTok{      grid}\SpecialCharTok{::}\FunctionTok{grid.draw}\NormalTok{(}\FunctionTok{.get\_legend}\NormalTok{(p))}
\NormalTok{    \}}
    \FunctionTok{.message\_info\_viewport}\NormalTok{(}\StringTok{"END"}\NormalTok{)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{ggset\_activate\_nodes\}:}
\CommentTok{\#\textquotesingle{} create the [ggset{-}class] object of node of specified \textquotesingle{}feature\textquotesingle{}.}
\CommentTok{\#\textquotesingle{} @rdname draw\_nodes{-}methods}
\CommentTok{\#\textquotesingle{} @export }
\NormalTok{ggset\_activate\_nodes }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(x, .features\_id, }\AttributeTok{nodes\_color =} \StringTok{"\#FFF9F2"}\NormalTok{,}
           \AttributeTok{add\_ppcp =}\NormalTok{ T, }\AttributeTok{add\_ration =}\NormalTok{ T)\{}
    \ControlFlowTok{if}\NormalTok{ (add\_ppcp) \{}
      \FunctionTok{.check\_data}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x), }\FunctionTok{list}\NormalTok{(}\AttributeTok{ppcp\_data =} \StringTok{"set\_ppcp\_data"}\NormalTok{))}
\NormalTok{    \}}
\NormalTok{    nodes\_color }\OtherTok{\textless{}{-}} \FunctionTok{.as\_dic}\NormalTok{(nodes\_color, .features\_id, }\StringTok{"\#FFF9F2"}\NormalTok{)}
\NormalTok{    set }\OtherTok{\textless{}{-}} \FunctionTok{.prepare\_data\_for\_nodes}\NormalTok{(x, .features\_id, add\_ppcp)}
\NormalTok{    ggsets }\OtherTok{\textless{}{-}}
      \FunctionTok{sapply}\NormalTok{(.features\_id, }\AttributeTok{simplify =}\NormalTok{ F,}
             \ControlFlowTok{function}\NormalTok{(id) \{}
\NormalTok{               names }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(set[[id]]}\SpecialCharTok{$}\NormalTok{rel.index)}
\NormalTok{               pal }\OtherTok{\textless{}{-}} \FunctionTok{.as\_dic}\NormalTok{(}\FunctionTok{palette\_col}\NormalTok{(x), names,}
                              \AttributeTok{fill =}\NormalTok{ F, }\AttributeTok{as.list =}\NormalTok{ F, }\AttributeTok{na.rm =}\NormalTok{ T)}
\NormalTok{               labels }\OtherTok{\textless{}{-}} \FunctionTok{.as\_dic}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"Bar: "}\NormalTok{, names, }\StringTok{": "}\NormalTok{, set[[id]]}\SpecialCharTok{$}\NormalTok{class.name),}
\NormalTok{                                 names, }\AttributeTok{fill =}\NormalTok{ F, }\AttributeTok{as.list =}\NormalTok{ F)}
               \FunctionTok{new\_ggset}\NormalTok{(}\FunctionTok{new\_command}\NormalTok{(ggplot, set[[id]]),}
                         \FunctionTok{.command\_node\_nuclear}\NormalTok{(nodes\_color[[id]]),}
                         \FunctionTok{.command\_node\_border}\NormalTok{(),}
                         \FunctionTok{.command\_node\_radial\_bar}\NormalTok{(),}
                         \FunctionTok{.command\_node\_ylim}\NormalTok{(),}
                         \FunctionTok{.command\_node\_polar}\NormalTok{(),}
                         \FunctionTok{.command\_node\_fill}\NormalTok{(pal, labels),}
                         \FunctionTok{new\_command}\NormalTok{(theme\_void),}
                         \FunctionTok{.command\_node\_theme}\NormalTok{()}
\NormalTok{               )}
\NormalTok{             \})}
    \ControlFlowTok{if}\NormalTok{ (add\_ration) \{}
      \FunctionTok{.check\_data}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x), }\FunctionTok{list}\NormalTok{(}\AttributeTok{ration\_data =} \StringTok{"set\_ration\_data"}\NormalTok{))}
\NormalTok{      axis.len }\OtherTok{\textless{}{-}} \FunctionTok{vapply}\NormalTok{(set, }\ControlFlowTok{function}\NormalTok{(df) }\FunctionTok{tail}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{seq, }\AttributeTok{n =} \DecValTok{1}\NormalTok{), }\DecValTok{1}\NormalTok{) }\SpecialCharTok{+} \DecValTok{1}
\NormalTok{      set }\OtherTok{\textless{}{-}} \FunctionTok{.prepare\_data\_for\_ration}\NormalTok{(x, .features\_id, axis.len)}
\NormalTok{      group }\OtherTok{\textless{}{-}} \FunctionTok{unique}\NormalTok{(}\FunctionTok{sample\_metadata}\NormalTok{(x)}\SpecialCharTok{$}\NormalTok{group)}
\NormalTok{      pal.ex }\OtherTok{\textless{}{-}} \FunctionTok{.as\_dic}\NormalTok{(}\FunctionTok{palette\_stat}\NormalTok{(x), group,}
                        \AttributeTok{fill =}\NormalTok{ F, }\AttributeTok{as.list =}\NormalTok{ F, }\AttributeTok{na.rm =}\NormalTok{ T)}
\NormalTok{      labels.ex }\OtherTok{\textless{}{-}} \FunctionTok{.as\_dic}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"Ring: group: "}\NormalTok{, group), group,}
                           \AttributeTok{fill =}\NormalTok{ F, }\AttributeTok{as.list =}\NormalTok{ F)}
\NormalTok{      ggsets }\OtherTok{\textless{}{-}}
        \FunctionTok{sapply}\NormalTok{(.features\_id, }\AttributeTok{simplify =}\NormalTok{ F,}
               \ControlFlowTok{function}\NormalTok{(id) \{}
                 \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(set[[id]]))}
                   \FunctionTok{return}\NormalTok{(ggsets[[id]])}
\NormalTok{                 ggset }\OtherTok{\textless{}{-}} \FunctionTok{add\_layers}\NormalTok{(}
\NormalTok{                   ggsets[[id]],}
                   \FunctionTok{.command\_node\_ration}\NormalTok{(set[[id]]),}
                   \FunctionTok{new\_command}\NormalTok{(labs, }\AttributeTok{fill =} \StringTok{"Groups / Classes"}\NormalTok{),}
                   \DocumentationTok{\#\# this as a separator}
                   \FunctionTok{new\_command}\NormalTok{(geom\_point, }\AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ seq, }\AttributeTok{y =} \DecValTok{0}\NormalTok{, }\AttributeTok{fill =} \StringTok{" "}\NormalTok{),}
                     \AttributeTok{data =} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{seq =}\NormalTok{ 1L), }\AttributeTok{stroke =} \DecValTok{0}\NormalTok{, }\AttributeTok{size =} \DecValTok{0}\NormalTok{, }\AttributeTok{shape =} \DecValTok{21}
\NormalTok{                   )}
\NormalTok{                 )}
\NormalTok{                 scale }\OtherTok{\textless{}{-}} \FunctionTok{command\_args}\NormalTok{(}\FunctionTok{layers}\NormalTok{(ggset)}\SpecialCharTok{$}\NormalTok{scale\_fill\_manual)}
                 \FunctionTok{command\_args}\NormalTok{(}\FunctionTok{layers}\NormalTok{(ggset)}\SpecialCharTok{$}\NormalTok{scale\_fill\_manual)}\SpecialCharTok{$}\NormalTok{values }\OtherTok{\textless{}{-}} 
                   \FunctionTok{c}\NormalTok{(pal.ex, }\FunctionTok{c}\NormalTok{(}\StringTok{" "} \OtherTok{=} \StringTok{"white"}\NormalTok{), scale}\SpecialCharTok{$}\NormalTok{values)}
                 \FunctionTok{command\_args}\NormalTok{(}\FunctionTok{layers}\NormalTok{(ggset)}\SpecialCharTok{$}\NormalTok{scale\_fill\_manual)}\SpecialCharTok{$}\NormalTok{labels }\OtherTok{\textless{}{-}} 
                   \FunctionTok{c}\NormalTok{(labels.ex, }\FunctionTok{c}\NormalTok{(}\StringTok{" "} \OtherTok{=} \StringTok{" "}\NormalTok{), scale}\SpecialCharTok{$}\NormalTok{labels)}
                 \DocumentationTok{\#\# control sequence}
                 \FunctionTok{command\_args}\NormalTok{(}\FunctionTok{layers}\NormalTok{(ggset)}\SpecialCharTok{$}\NormalTok{scale\_fill\_manual)}\SpecialCharTok{$}\NormalTok{breaks }\OtherTok{\textless{}{-}} 
                   \FunctionTok{names}\NormalTok{(}\FunctionTok{c}\NormalTok{(pal.ex, }\FunctionTok{c}\NormalTok{(}\StringTok{" "} \OtherTok{=} \StringTok{"white"}\NormalTok{), scale}\SpecialCharTok{$}\NormalTok{values))}
\NormalTok{                 ggset}
\NormalTok{               \})}
\NormalTok{    \}}
\NormalTok{    ggsets}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @importFrom dplyr mutate}
\NormalTok{.prepare\_data\_for\_nodes }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(x, .features\_id, }\AttributeTok{add\_ppcp =}\NormalTok{ T)\{}
\NormalTok{    df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{rel.index =} \SpecialCharTok{{-}}\NormalTok{1L, }\AttributeTok{pp.value =}\NormalTok{ 0L, }\AttributeTok{seq =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{3}\NormalTok{)}
    \ControlFlowTok{if}\NormalTok{ (add\_ppcp) \{}
\NormalTok{      set }\OtherTok{\textless{}{-}} \FunctionTok{ppcp\_data}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))}
\NormalTok{      set }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(.features\_id, }\AttributeTok{simplify =}\NormalTok{ F,}
                    \ControlFlowTok{function}\NormalTok{(id) \{}
                      \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(set[[id]]))}
\NormalTok{                        df}
                      \ControlFlowTok{else}
\NormalTok{                        set[[id]]}
\NormalTok{                    \})}
\NormalTok{    \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{      set }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(.features\_id, }\ControlFlowTok{function}\NormalTok{(id) df, }\AttributeTok{simplify =}\NormalTok{ F)}
\NormalTok{    \}}
\NormalTok{    set}
\NormalTok{  \}}

\NormalTok{.prepare\_data\_for\_ration }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(x, .features\_id, axis.len)\{}
\NormalTok{    set }\OtherTok{\textless{}{-}} \FunctionTok{ration\_data}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))}
    \FunctionTok{sapply}\NormalTok{(.features\_id, }\AttributeTok{simplify =}\NormalTok{ F,}
           \ControlFlowTok{function}\NormalTok{(id) \{}
             \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(set[[id]]))}
               \FunctionTok{return}\NormalTok{()}
\NormalTok{             df }\OtherTok{\textless{}{-}}\NormalTok{ set[[id]]}
\NormalTok{             max }\OtherTok{\textless{}{-}} \FunctionTok{cumsum}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{value)}
\NormalTok{             min }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, max[}\SpecialCharTok{{-}}\FunctionTok{length}\NormalTok{(max)])}
\NormalTok{             factor }\OtherTok{\textless{}{-}}\NormalTok{ axis.len[[id]] }\SpecialCharTok{/} \FunctionTok{max}\NormalTok{(max)}
\NormalTok{             df}\SpecialCharTok{$}\NormalTok{x }\OtherTok{\textless{}{-}}\NormalTok{ (min }\SpecialCharTok{+}\NormalTok{ df}\SpecialCharTok{$}\NormalTok{value }\SpecialCharTok{/} \DecValTok{2}\NormalTok{) }\SpecialCharTok{*}\NormalTok{ factor}
\NormalTok{             df}\SpecialCharTok{$}\NormalTok{width }\OtherTok{\textless{}{-}}\NormalTok{ df}\SpecialCharTok{$}\NormalTok{value }\SpecialCharTok{*}\NormalTok{ factor}
\NormalTok{             df}
\NormalTok{           \})}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @aliases set\_ppcp\_data}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Custom specify PPCP data for visualization in nodes}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} Run before [annotate\_nebula()] or [draw\_nodes()].}
\CommentTok{\#\textquotesingle{} Custom specify PPCP data for visualization in nodes.}
\CommentTok{\#\textquotesingle{} All chemical classes exists in PPCP data could be specified.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @seealso [annotate\_nebula()], [draw\_nodes()].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name set\_ppcp\_data{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @order 1}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @exportMethod set\_ppcp\_data}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{set\_ppcp\_data()\}: get the function for generating}
\CommentTok{\#\textquotesingle{} default parameters for the method}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{set\_ppcp\_data\}.}
\CommentTok{\#\textquotesingle{} @rdname set\_ppcp\_data{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"set\_ppcp\_data"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"set\_ppcp\_data"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{()\{}
            \ControlFlowTok{function}\NormalTok{(x)\{}
              \FunctionTok{list}\NormalTok{(}\AttributeTok{classes =} \FunctionTok{names}\NormalTok{(}\FunctionTok{tbl\_graph}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))))}
\NormalTok{            \}}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @importFrom dplyr filter}
\CommentTok{\#\textquotesingle{} @importFrom dplyr mutate}
\CommentTok{\#\textquotesingle{} @exportMethod set\_ppcp\_data}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{set\_ppcp\_data(x, ...)\}:}
\CommentTok{\#\textquotesingle{} use the default parameters whatever \textquotesingle{}missing\textquotesingle{}}
\CommentTok{\#\textquotesingle{} while performing the method \textbackslash{}code\{set\_ppcp\_data\}.}
\CommentTok{\#\textquotesingle{} @rdname set\_ppcp\_data{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"set\_ppcp\_data"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, classes)\{}
            \FunctionTok{reCallMethod}\NormalTok{(}\StringTok{"set\_ppcp\_data"}\NormalTok{,}
                         \FunctionTok{.fresh\_param}\NormalTok{(}\FunctionTok{set\_ppcp\_data}\NormalTok{()(x)))}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod set\_ppcp\_data}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x [mcnebula{-}class] object.}
\CommentTok{\#\textquotesingle{} @param classes character. The names of chemical classes.}
\CommentTok{\#\textquotesingle{} Use \textbackslash{}code\{classification(object)\} to get optional candidates.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname set\_ppcp\_data{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} mcn\_5features}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# the previous steps}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_structure(test)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_reference(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_formula(test1, by\_reference = T)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_stardust\_classes(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_features\_annotation(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} cross\_filter\_stardust(test1, 2, 1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_nebula\_index(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} compute\_spectral\_similarity(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_child\_nebulae(test1, 0.01)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_child\_layouts(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} activate\_nebulae(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# optional \textquotesingle{}nebula\_name\textquotesingle{}}
\CommentTok{\#\textquotesingle{}   visualize(test1)}
\CommentTok{\#\textquotesingle{}   \#\# a class for example}
\CommentTok{\#\textquotesingle{}   class \textless{}{-} visualize(test1)$class.name[1]}
\CommentTok{\#\textquotesingle{}   tmp \textless{}{-} export\_path(test1)}
\CommentTok{\#\textquotesingle{}   \#\# customize the chemical classes displayed}
\CommentTok{\#\textquotesingle{}   \#\# in the radial bar plot in node.}
\CommentTok{\#\textquotesingle{}   classes \textless{}{-} classification(test1)}
\CommentTok{\#\textquotesingle{}   \#\# get some random classes}
\CommentTok{\#\textquotesingle{}   set.seed(10)}
\CommentTok{\#\textquotesingle{}   classes \textless{}{-} sample(classes$class.name, 50)}
\CommentTok{\#\textquotesingle{}   classes}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} set\_ppcp\_data(test1, classes)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} draw\_nodes(test1, class,}
\CommentTok{\#\textquotesingle{}     add\_structure = F,}
\CommentTok{\#\textquotesingle{}     add\_ration = F}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# visualize with ID of \textquotesingle{}feature\textquotesingle{} (.features\_id)}
\CommentTok{\#\textquotesingle{}   \#\# with legend}
\CommentTok{\#\textquotesingle{}   ids \textless{}{-} names(nodes\_grob(child\_nebulae(test1)))}
\CommentTok{\#\textquotesingle{}   x11(width = 15, height = 5)}
\CommentTok{\#\textquotesingle{}   show\_node(test1, ids[1])}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# get a function to generate default parameters}
\CommentTok{\#\textquotesingle{}   set\_ppcp\_data()}
\CommentTok{\#\textquotesingle{}   \#\# the default parameters}
\CommentTok{\#\textquotesingle{}   set\_ppcp\_data()(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   unlink(tmp, T, T)}
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"set\_ppcp\_data"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{, }\AttributeTok{classes =} \StringTok{"character"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, classes)\{}
\NormalTok{            ppcp\_data }\OtherTok{\textless{}{-}}
              \FunctionTok{suppressMessages}\NormalTok{(}\FunctionTok{latest}\NormalTok{(}\FunctionTok{filter\_ppcp}\NormalTok{(x, dplyr}\SpecialCharTok{::}\NormalTok{filter,}
\NormalTok{                                                  class.name }\SpecialCharTok{\%in\%}\NormalTok{ classes)))}
\NormalTok{            ppcp\_data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(ppcp\_data, rel.index, class.name,}
\NormalTok{                                       pp.value, .features\_id)}
            \FunctionTok{ppcp\_data}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x)) }\OtherTok{\textless{}{-}}
              \FunctionTok{lapply}\NormalTok{(}\FunctionTok{split}\NormalTok{(ppcp\_data, }\SpecialCharTok{\textasciitilde{}}\NormalTok{ .features\_id),}
                     \ControlFlowTok{function}\NormalTok{(df) \{}
\NormalTok{                       dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(df, }\AttributeTok{seq =} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(df))}
\NormalTok{                     \})}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @aliases set\_ration\_data}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Custom specify the quantification data for visualization in nodes}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} Run before [annotate\_nebula()] or [draw\_nodes()].}
\CommentTok{\#\textquotesingle{} Set whether to use the group average value to annotate the \textquotesingle{}features\textquotesingle{}}
\CommentTok{\#\textquotesingle{} quantification in nodes.}
\CommentTok{\#\textquotesingle{} Before this methods, user should use \textbackslash{}code\{features\_quantification\textless{}{-}\} and}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{sample\_metadata\textless{}{-}\} to set quantification data and metadata in}
\CommentTok{\#\textquotesingle{} [mcnebula{-}class] object.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @seealso [annotate\_nebula()], [draw\_nodes()].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name set\_ration\_data{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @order 1}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @importFrom tidyr gather}
\CommentTok{\#\textquotesingle{} @importFrom tibble as\_tibble}
\CommentTok{\#\textquotesingle{} @importFrom dplyr group\_by}
\CommentTok{\#\textquotesingle{} @importFrom dplyr summarise}
\CommentTok{\#\textquotesingle{} @importFrom dplyr ungroup}
\CommentTok{\#\textquotesingle{} @exportMethod set\_ration\_data}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{set\_ration\_data()\}: get the default parameters for the method}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{set\_ration\_data\}.}
\CommentTok{\#\textquotesingle{} @rdname set\_ration\_data{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"set\_ration\_data"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"set\_ration\_data"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{()\{}
            \FunctionTok{list}\NormalTok{(}\AttributeTok{mean =}\NormalTok{ T)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod set\_ration\_data}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{set\_ration\_data(x, ...)\}: use the default parameters whatever \textquotesingle{}missing\textquotesingle{}}
\CommentTok{\#\textquotesingle{} while performing the method \textbackslash{}code\{set\_ration\_data\}.}
\CommentTok{\#\textquotesingle{} @rdname set\_ration\_data{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"set\_ration\_data"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, mean)\{}
            \FunctionTok{reCallMethod}\NormalTok{(}\StringTok{"set\_ration\_data"}\NormalTok{,}
                         \FunctionTok{.fresh\_param}\NormalTok{(}\FunctionTok{set\_ration\_data}\NormalTok{()))}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod set\_ration\_data}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x [mcnebula{-}class] object.}
\CommentTok{\#\textquotesingle{} @param mean logical. If \textbackslash{}code\{TRUE\}, calculate mean value for}
\CommentTok{\#\textquotesingle{} all group of the samples.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname set\_ration\_data{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} mcn\_5features}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# the previous steps}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_structure(test)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_reference(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_formula(test1, by\_reference = T)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_stardust\_classes(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_features\_annotation(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} cross\_filter\_stardust(test1, 2, 1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_nebula\_index(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} compute\_spectral\_similarity(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_child\_nebulae(test1, 0.01)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_child\_layouts(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} activate\_nebulae(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# set features quantification data}
\CommentTok{\#\textquotesingle{}   ids \textless{}{-} features\_annotation(test1)$.features\_id}
\CommentTok{\#\textquotesingle{}   quant. \textless{}{-} data.frame(}
\CommentTok{\#\textquotesingle{}     .features\_id = ids,}
\CommentTok{\#\textquotesingle{}     sample\_1 = rnorm(length(ids), 1000, 200),}
\CommentTok{\#\textquotesingle{}     sample\_2 = rnorm(length(ids), 2000, 500)}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   quant. \textless{}{-} dplyr::mutate(quant.,}
\CommentTok{\#\textquotesingle{}     sample\_3 = sample\_1 * 1.5,}
\CommentTok{\#\textquotesingle{}     sample\_4 = sample\_2 * 5}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   metadata \textless{}{-} data.frame(}
\CommentTok{\#\textquotesingle{}     sample = paste0("sample\_", 1:4),}
\CommentTok{\#\textquotesingle{}     group = rep(c("control", "model"), c(2, 2))}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   features\_quantification(test1) \textless{}{-} quant.}
\CommentTok{\#\textquotesingle{}   sample\_metadata(test1) \textless{}{-} metadata}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# a more convenient way to obtain simulation data}
\CommentTok{\#\textquotesingle{}   \# test1 \textless{}{-} MCnebula2:::.simulate\_quant\_set(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# optional \textquotesingle{}nebula\_name\textquotesingle{}}
\CommentTok{\#\textquotesingle{}   visualize(test1)}
\CommentTok{\#\textquotesingle{}   \#\# a class for example}
\CommentTok{\#\textquotesingle{}   class \textless{}{-} visualize(test1)$class.name[1]}
\CommentTok{\#\textquotesingle{}   tmp \textless{}{-} export\_path(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} set\_ration\_data(test1, mean = F)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} draw\_nodes(test1, class,}
\CommentTok{\#\textquotesingle{}     add\_structure = F,}
\CommentTok{\#\textquotesingle{}     add\_ppcp = F}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# visualize with ID of \textquotesingle{}feature\textquotesingle{} (.features\_id)}
\CommentTok{\#\textquotesingle{}   \#\# with legend}
\CommentTok{\#\textquotesingle{}   ids \textless{}{-} names(nodes\_grob(child\_nebulae(test1)))}
\CommentTok{\#\textquotesingle{}   x11(width = 15, height = 5)}
\CommentTok{\#\textquotesingle{}   show\_node(test1, ids[1])}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# the default parameters}
\CommentTok{\#\textquotesingle{}   set\_ration\_data()}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   unlink(tmp, T, T)}
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"set\_ration\_data"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{, }\AttributeTok{mean =} \StringTok{"logical"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, mean)\{}
            \FunctionTok{.check\_data}\NormalTok{(x, }\FunctionTok{list}\NormalTok{(}\AttributeTok{features\_quantification =} \StringTok{"features\_quantification"}\NormalTok{,}
                                \AttributeTok{sample\_metadata =} \StringTok{"sample\_metadata"}\NormalTok{), }\StringTok{"(x) \textless{}{-}"}\NormalTok{)}
\NormalTok{            ration\_data }\OtherTok{\textless{}{-}}
\NormalTok{              tidyr}\SpecialCharTok{::}\FunctionTok{gather}\NormalTok{(}\FunctionTok{features\_quantification}\NormalTok{(x),}
                            \AttributeTok{key =} \StringTok{"sample"}\NormalTok{, }\AttributeTok{value =} \StringTok{"value"}\NormalTok{, }\SpecialCharTok{{-}}\NormalTok{.features\_id)}
\NormalTok{            ration\_data }\OtherTok{\textless{}{-}}
\NormalTok{              tibble}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(}\FunctionTok{merge}\NormalTok{(ration\_data, }\FunctionTok{sample\_metadata}\NormalTok{(x),}
                                      \AttributeTok{by =} \StringTok{"sample"}\NormalTok{, }\AttributeTok{all.x =}\NormalTok{ T))}
            \ControlFlowTok{if}\NormalTok{ (mean) \{}
\NormalTok{              ration\_data }\OtherTok{\textless{}{-}}
\NormalTok{                dplyr}\SpecialCharTok{::}\FunctionTok{summarise}\NormalTok{(dplyr}\SpecialCharTok{::}\FunctionTok{group\_by}\NormalTok{(ration\_data, .features\_id, group),}
                                 \AttributeTok{value =} \FunctionTok{mean}\NormalTok{(value, }\AttributeTok{na.rm =}\NormalTok{ T))}
\NormalTok{              ration\_data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{ungroup}\NormalTok{(ration\_data)}
\NormalTok{            \}}
            \FunctionTok{ration\_data}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x)) }\OtherTok{\textless{}{-}} 
              \FunctionTok{split}\NormalTok{(ration\_data, }\SpecialCharTok{\textasciitilde{}}\NormalTok{.features\_id)}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-extramethods-draw_structures.r}{%
\section{File: extraMethods-draw\_structures.R}\label{file-extramethods-draw_structures.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# draw all chemical structures for a specified child{-}nebula}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @aliases draw\_structures}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Draw and visualize chemcial structure}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} Methods used for drawing and visualizing chemical structures of \textquotesingle{}features\textquotesingle{}}
\CommentTok{\#\textquotesingle{} in Child{-}Nebulae.}
\CommentTok{\#\textquotesingle{} [ChemmineOB::convertToImage()] is the core function used for drawing chemical}
\CommentTok{\#\textquotesingle{} structures.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @seealso [ChemmineOB::convertToImage()].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name draw\_structures{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @order 1}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @importFrom dplyr filter}
\CommentTok{\#\textquotesingle{} @importFrom dplyr select}
\CommentTok{\#\textquotesingle{} @importFrom tibble as\_tibble}
\CommentTok{\#\textquotesingle{} @importFrom tibble as\_tibble}
\CommentTok{\#\textquotesingle{} @exportMethod draw\_structures}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases draw\_structures}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x [mcnebula{-}class] object.}
\CommentTok{\#\textquotesingle{} @param nebula\_name character(1). Chemical classes in \textquotesingle{}nebula\_index\textquotesingle{} data.}
\CommentTok{\#\textquotesingle{} Specified to draw chemical structures of all the \textquotesingle{}features\textquotesingle{} of that.}
\CommentTok{\#\textquotesingle{} @param .features\_id character(1). The ID of \textquotesingle{}features\textquotesingle{}.}
\CommentTok{\#\textquotesingle{} @param data data.frame. A \textquotesingle{}data.frame\textquotesingle{} contains columns of \textquotesingle{}.features\_id\textquotesingle{} and}
\CommentTok{\#\textquotesingle{} \textquotesingle{}smiles\textquotesingle{}.}
\CommentTok{\#\textquotesingle{} @param ... ...}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname draw\_structures{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} mcn\_5features}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# the previous steps}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_structure(test)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_reference(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_formula(test1, by\_reference = T)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_stardust\_classes(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_features\_annotation(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} cross\_filter\_stardust(test1, 2, 1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_nebula\_index(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} compute\_spectral\_similarity(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_child\_nebulae(test1, 0.01)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_child\_layouts(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} activate\_nebulae(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# optional \textquotesingle{}nebula\_name\textquotesingle{}}
\CommentTok{\#\textquotesingle{}   visualize(test1)}
\CommentTok{\#\textquotesingle{}   \#\# a class for example}
\CommentTok{\#\textquotesingle{}   class \textless{}{-} visualize(test1)$class.name[1]}
\CommentTok{\#\textquotesingle{}   tmp \textless{}{-} export\_path(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} draw\_structures(test1, class)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# see results}
\CommentTok{\#\textquotesingle{}   grobs \textless{}{-} structures\_grob(child\_nebulae(test1))}
\CommentTok{\#\textquotesingle{}   grobs}
\CommentTok{\#\textquotesingle{}   grid::grid.draw(grobs[[1]])}
\CommentTok{\#\textquotesingle{}   \#\# visualize with ID of \textquotesingle{}feature\textquotesingle{} (.features\_id)}
\CommentTok{\#\textquotesingle{}   ids \textless{}{-} names(grobs)}
\CommentTok{\#\textquotesingle{}   show\_structure(test1, ids[1])}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   unlink(tmp, T, T)}
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"draw\_structures"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"draw\_structures"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{,}
                                 \AttributeTok{nebula\_name =} \StringTok{"character"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, nebula\_name, ...)\{}
            \FunctionTok{.check\_data}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x), }\FunctionTok{list}\NormalTok{(}\AttributeTok{tbl\_graph =} \StringTok{"create\_child\_layouts"}\NormalTok{))}
\NormalTok{            tidy }\OtherTok{\textless{}{-}} \FunctionTok{tbl\_graph}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))[[nebula\_name]]}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(tidy))}
              \FunctionTok{stop}\NormalTok{( }\StringTok{"\textasciigrave{}nebula\_name\textasciigrave{} not found in \textasciigrave{}tbl\_graph(child\_nebulae(x))\textasciigrave{}"}\NormalTok{ )}
\NormalTok{            df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(tibble}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(tidy), }\AttributeTok{.features\_id =}\NormalTok{ name, smiles)}
            \FunctionTok{draw\_structures}\NormalTok{(x, }\AttributeTok{data =}\NormalTok{ df, ...)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod draw\_structures}
\CommentTok{\#\textquotesingle{} @rdname draw\_structures{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"draw\_structures"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"draw\_structures"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{,}
                                 \AttributeTok{.features\_id =} \StringTok{"character"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, .features\_id, ...)\{}
            \FunctionTok{.check\_data}\NormalTok{(x, }\FunctionTok{list}\NormalTok{(}\AttributeTok{features\_annotation =} \StringTok{"create\_features\_annotation"}\NormalTok{))}
\NormalTok{            df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(}\FunctionTok{features\_annotation}\NormalTok{(x), .features\_id, smiles)}
\NormalTok{            df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(df, .features\_id }\SpecialCharTok{\%in\%} \SpecialCharTok{!!}\NormalTok{.features\_id)}
            \FunctionTok{draw\_structures}\NormalTok{(x, }\AttributeTok{data =}\NormalTok{ df, ...)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod draw\_structures}
\CommentTok{\#\textquotesingle{} @rdname draw\_structures{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"draw\_structures"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"draw\_structures"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{,}
                                 \AttributeTok{data =} \StringTok{"data.frame"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, data, ...)\{}
\NormalTok{            sets }\OtherTok{\textless{}{-}} \FunctionTok{structures\_grob}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))}
            \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(sets)) \{}
\NormalTok{              data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(data, }\SpecialCharTok{!}\NormalTok{.features\_id }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(sets))}
\NormalTok{            \}}
            \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{nrow}\NormalTok{(data) }\SpecialCharTok{==} \DecValTok{0}\NormalTok{) \{}
              \FunctionTok{structures\_grob}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x)) }\OtherTok{\textless{}{-}} 
                \FunctionTok{c}\NormalTok{(sets, }\FunctionTok{.draw\_structures}\NormalTok{(data, }\FunctionTok{paste0}\NormalTok{(}\FunctionTok{export\_path}\NormalTok{(x),}
                      \StringTok{"/tmp/structure"}\NormalTok{), T, ...))}
\NormalTok{            \}}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @importFrom grid grid.draw}
\CommentTok{\#\textquotesingle{} @exportMethod show\_structure}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{show\_structure\}: visualize the chemical structure of \textquotesingle{}feature\textquotesingle{}}
\CommentTok{\#\textquotesingle{} which has been drawn.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname draw\_structures{-}methods}
\CommentTok{\#\textquotesingle{}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"show\_structure"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{, }\AttributeTok{.features\_id =} \StringTok{"character"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, .features\_id)\{}
            \FunctionTok{.check\_data}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x), }\FunctionTok{list}\NormalTok{(}\AttributeTok{structures\_grob =} \StringTok{"draw\_structures"}\NormalTok{))}
\NormalTok{            grid}\SpecialCharTok{::}\FunctionTok{grid.draw}\NormalTok{(}\FunctionTok{structures\_grob}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))[[.features\_id]])}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @importFrom dplyr mutate}
\CommentTok{\#\textquotesingle{} @importFrom pbapply pbapply}
\NormalTok{.draw\_structures }\OtherTok{\textless{}{-}}
  \ControlFlowTok{function}\NormalTok{(df, path, }\AttributeTok{rm\_background =}\NormalTok{ F, }\AttributeTok{fun\_draw =}\NormalTok{ .smiles\_to\_cairosvg)\{}
    \FunctionTok{.check\_columns}\NormalTok{(df, }\FunctionTok{c}\NormalTok{(}\StringTok{".features\_id"}\NormalTok{, }\StringTok{"smiles"}\NormalTok{), }\StringTok{"data.frame"}\NormalTok{)}
    \FunctionTok{.check\_path}\NormalTok{(path)}
\NormalTok{    df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(df, }\AttributeTok{path =} \FunctionTok{paste0}\NormalTok{(}\SpecialCharTok{!!}\NormalTok{path, }\StringTok{"/"}\NormalTok{, .features\_id, }\StringTok{".svg"}\NormalTok{))}
\NormalTok{    df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(df, }\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(smiles))}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{nrow}\NormalTok{(df) }\SpecialCharTok{==} \DecValTok{0}\NormalTok{)}
      \FunctionTok{return}\NormalTok{(}\ConstantTok{NULL}\NormalTok{)}
    \FunctionTok{.message\_info}\NormalTok{(}\StringTok{"draw\_structures"}\NormalTok{, }\StringTok{"smiles {-}\textgreater{} svg {-}\textgreater{} grob"}\NormalTok{)}
\NormalTok{    grImport2}\SpecialCharTok{:::}\FunctionTok{setPrefix}\NormalTok{(}\StringTok{""}\NormalTok{)}
\NormalTok{    lst }\OtherTok{\textless{}{-}}\NormalTok{ pbapply}\SpecialCharTok{::}\FunctionTok{pbapply}\NormalTok{(dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(df, smiles, path), }\DecValTok{1}\NormalTok{,}
                            \ControlFlowTok{function}\NormalTok{(vec)\{}
                              \FunctionTok{fun\_draw}\NormalTok{(vec[[}\StringTok{"smiles"}\NormalTok{]], vec[[}\StringTok{"path"}\NormalTok{]])}
                              \FunctionTok{.cairosvg\_to\_grob}\NormalTok{(vec[[}\StringTok{"path"}\NormalTok{]])}
\NormalTok{                            \})}
    \FunctionTok{names}\NormalTok{(lst) }\OtherTok{\textless{}{-}}\NormalTok{ df}\SpecialCharTok{$}\NormalTok{.features\_id}
    \ControlFlowTok{if}\NormalTok{ (rm\_background) }
\NormalTok{      lst }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(lst, .rm\_background)}
    \FunctionTok{return}\NormalTok{(lst)}
\NormalTok{  \}}

\NormalTok{.rm\_background }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(grob)\{}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is}\NormalTok{(grob}\SpecialCharTok{$}\NormalTok{children[[}\DecValTok{1}\NormalTok{]]}\SpecialCharTok{$}\NormalTok{children[[}\DecValTok{1}\NormalTok{]], }\StringTok{"picRect"}\NormalTok{)) \{}
\NormalTok{      grob}\SpecialCharTok{$}\NormalTok{children[[}\DecValTok{1}\NormalTok{]]}\SpecialCharTok{$}\NormalTok{children[[}\DecValTok{1}\NormalTok{]] }\OtherTok{\textless{}{-}} \ConstantTok{NULL}
\NormalTok{    \}}
    \FunctionTok{return}\NormalTok{(grob)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @importFrom ChemmineOB convertToImage}
\CommentTok{\#\textquotesingle{} @importFrom rsvg rsvg\_svg}
\NormalTok{.smiles\_to\_cairosvg }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(smile, path)\{}
\NormalTok{    ChemmineOB}\SpecialCharTok{::}\FunctionTok{convertToImage}\NormalTok{(}\StringTok{"SMI"}\NormalTok{, }\StringTok{"SVG"}\NormalTok{, }\AttributeTok{source =}\NormalTok{ smile, }\AttributeTok{toFile =}\NormalTok{ path)}
\NormalTok{    rsvg}\SpecialCharTok{::}\FunctionTok{rsvg\_svg}\NormalTok{(path, path)}
\NormalTok{  \}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-extramethods-report.r}{%
\section{File: extraMethods-report.R}\label{file-extramethods-report.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# some methods for class \textquotesingle{}report\textquotesingle{}, to fast generate layer of \textquotesingle{}section\textquotesingle{} or}
\CommentTok{\# \textquotesingle{}code\_block\textquotesingle{} etc.}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @aliases include\_figure}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Easily embed figure into document}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} Creates a pre{-}defined [code\_block\_figure{-}class] object containing the codes of}
\CommentTok{\#\textquotesingle{} [knitr::include\_graphics()] for formatting display the figure in document.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @seealso [code\_block\_figure{-}class], [report{-}class], [knitr::include\_graphics()]...}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @name include\_figure{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @order 1}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @exportMethod include\_figure}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases include\_figure}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param file character(1). The path of file. See [knitr::include\_graphics()] for}
\CommentTok{\#\textquotesingle{} the supported image formats.}
\CommentTok{\#\textquotesingle{} @param name character(1). For cross{-}reference in document.}
\CommentTok{\#\textquotesingle{} See \textbackslash{}url\{https://bookdown.org/yihui/rmarkdown{-}cookbook/cross{-}ref.html\#cross{-}ref\}.}
\CommentTok{\#\textquotesingle{} @param caption character(1). Caption of figure display in document.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname include\_figure{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   tmp \textless{}{-} paste0(tempdir(), "/test.pdf")}
\CommentTok{\#\textquotesingle{}   pdf(tmp)}
\CommentTok{\#\textquotesingle{}   plot(1:10)}
\CommentTok{\#\textquotesingle{}   dev.off()}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   fig\_block \textless{}{-} include\_figure(}
\CommentTok{\#\textquotesingle{}     tmp, "plot", "This is caption"}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   fig\_block}
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"include\_figure"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{file =} \StringTok{"character"}\NormalTok{,}
                        \AttributeTok{name =} \StringTok{"character"}\NormalTok{,}
                        \AttributeTok{caption =} \StringTok{"character"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(file, name, caption)\{}
            \FunctionTok{.check\_file}\NormalTok{(file)}
\NormalTok{            codes }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"knitr::include\_graphics(\textquotesingle{}"}\NormalTok{, file, }\StringTok{"\textquotesingle{})"}\NormalTok{)}
\NormalTok{            args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{echo =}\NormalTok{ F, }\AttributeTok{eval =}\NormalTok{ T, }\AttributeTok{message =}\NormalTok{ F)}
            \FunctionTok{new\_code\_block\_figure}\NormalTok{(}\AttributeTok{name =}\NormalTok{ name,}
                                  \AttributeTok{caption =}\NormalTok{ caption,}
                                  \AttributeTok{codes =}\NormalTok{ codes,}
                                  \AttributeTok{args =}\NormalTok{ args)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @aliases include\_table}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Easily embed table into document}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} Creates a pre{-}defined [code\_block\_table{-}class] object containing the codes of}
\CommentTok{\#\textquotesingle{} [knitr::kable()] for formatting display the table in document.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name include\_table{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @order 1}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @exportMethod include\_table}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases include\_table}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param data \textquotesingle{}data.frame\textquotesingle{} object. The data of table to display in document.}
\CommentTok{\#\textquotesingle{} @param name character(1). For cross{-}reference in document.}
\CommentTok{\#\textquotesingle{} See \textbackslash{}url\{https://bookdown.org/yihui/rmarkdown{-}cookbook/cross{-}ref.html\#cross{-}ref\}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param caption character(1). Caption of figure display in document.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname include\_table{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   data \textless{}{-} data.frame(x = 1:10, y = 1:10)}
\CommentTok{\#\textquotesingle{}   tab\_block \textless{}{-} include\_table(}
\CommentTok{\#\textquotesingle{}     data, "table1",}
\CommentTok{\#\textquotesingle{}     "This is caption"}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   tab\_block}
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"include\_table"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{data =} \StringTok{"data.frame"}\NormalTok{,}
                        \AttributeTok{name =} \StringTok{"character"}\NormalTok{,}
                        \AttributeTok{caption =} \StringTok{"character"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(data, name, caption)\{}
\NormalTok{            var }\OtherTok{\textless{}{-}} \FunctionTok{deparse}\NormalTok{(}\FunctionTok{substitute}\NormalTok{(data))}
\NormalTok{            codes }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"knitr::kable("}\NormalTok{, var, }\StringTok{", "}\NormalTok{,}
                            \StringTok{"format = \textquotesingle{}markdown\textquotesingle{}, "}\NormalTok{,}
                            \StringTok{"caption = \textquotesingle{}"}\NormalTok{, caption, }\StringTok{"\textquotesingle{})"}\NormalTok{)}
\NormalTok{            args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{echo =}\NormalTok{ F, }\AttributeTok{eval =}\NormalTok{ T, }\AttributeTok{message =}\NormalTok{ F)}
            \FunctionTok{new\_code\_block\_table}\NormalTok{(}\AttributeTok{name =}\NormalTok{ name,}
                                 \AttributeTok{codes =}\NormalTok{ codes,}
                                 \AttributeTok{args =}\NormalTok{ args)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @aliases history\_rblock}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Create \textquotesingle{}code\_block\textquotesingle{} object from history codes}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} Get codes from R history, then formatted as [code\_block{-}class] object.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @seealso}
\CommentTok{\#\textquotesingle{} [code\_block{-}class], [history()]...}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name history\_rblock{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @order 1}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @exportMethod history\_rblock}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{history\_rblock()\}: get the default parameters for the method}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{history\_rblock\}.}
\CommentTok{\#\textquotesingle{} @rdname history\_rblock{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"history\_rblock"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"history\_rblock"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{()\{}
            \FunctionTok{list}\NormalTok{(}\AttributeTok{exclude =} \DecValTok{1}\NormalTok{)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod history\_rblock}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{history\_rblock(x, ...)\}: use the default parameters whatever \textquotesingle{}missing\textquotesingle{}}
\CommentTok{\#\textquotesingle{} while performing the method \textbackslash{}code\{history\_rblock\}.}
\CommentTok{\#\textquotesingle{} @rdname history\_rblock{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"history\_rblock"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{nrow  =} \StringTok{"numeric"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(nrow, pattern\_start, pattern\_end, exclude)\{}
            \FunctionTok{reCallMethod}\NormalTok{(}\StringTok{"history\_rblock"}\NormalTok{,}
                         \FunctionTok{.fresh\_param}\NormalTok{(}\FunctionTok{history\_rblock}\NormalTok{()))}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod history\_rblock}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases history\_rblock}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param nrow numeric(1). The number of lines of code to fetch.}
\CommentTok{\#\textquotesingle{} @param pattern\_start character(1).}
\CommentTok{\#\textquotesingle{} The pattern string used to match the starting line of codes in R history.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @param pattern\_end character(1).}
\CommentTok{\#\textquotesingle{} The pattern string used to match the ending line of codes in R history.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @param exclude numeric(1). Used to exclude the last lines of code.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname history\_rblock{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} 1}
\CommentTok{\#\textquotesingle{}   test2 \textless{}{-} 2}
\CommentTok{\#\textquotesingle{}   test3 \textless{}{-} 3}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   block \textless{}{-} history\_rblock(, "\^{}test1", "\^{}test3")}
\CommentTok{\#\textquotesingle{}   block}
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"history\_rblock"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"history\_rblock"}\NormalTok{,}
                                 \AttributeTok{nrow =} \StringTok{"numeric"}\NormalTok{,}
                                 \AttributeTok{exclude =} \StringTok{"numeric"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(nrow, exclude)\{}
\NormalTok{            his }\OtherTok{\textless{}{-}} \FunctionTok{tail}\NormalTok{(}\FunctionTok{get\_history}\NormalTok{(exclude), }\AttributeTok{n =}\NormalTok{ nrow)}
\NormalTok{            args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{echo =}\NormalTok{ T, }\AttributeTok{eval =}\NormalTok{ F)}
            \FunctionTok{new\_code\_block}\NormalTok{(}\AttributeTok{codes =}\NormalTok{ his, }\AttributeTok{args =}\NormalTok{ args)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod history\_rblock}
\CommentTok{\#\textquotesingle{} @rdname history\_rblock{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"history\_rblock"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"history\_rblock"}\NormalTok{,}
                                 \AttributeTok{pattern\_start =} \StringTok{"character"}\NormalTok{,}
                                 \AttributeTok{pattern\_end =} \StringTok{"character"}\NormalTok{,}
                                 \AttributeTok{exclude =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(pattern\_start, pattern\_end, exclude)\{}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{missing}\NormalTok{(exclude))}
\NormalTok{              exclude }\OtherTok{\textless{}{-}} \DecValTok{1}
\NormalTok{            his }\OtherTok{\textless{}{-}} \FunctionTok{get\_history}\NormalTok{(exclude)}
\NormalTok{            end }\OtherTok{\textless{}{-}} \FunctionTok{tail}\NormalTok{(}\FunctionTok{grep}\NormalTok{(pattern\_end, his, }\AttributeTok{perl =}\NormalTok{ T), }\AttributeTok{n =} \DecValTok{1}\NormalTok{)}
\NormalTok{            start }\OtherTok{\textless{}{-}} \FunctionTok{tail}\NormalTok{(}\FunctionTok{grep}\NormalTok{(pattern\_start, his[}\DecValTok{1}\SpecialCharTok{:}\NormalTok{end]), }\AttributeTok{n =} \DecValTok{1}\NormalTok{)}
\NormalTok{            args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{echo =}\NormalTok{ T, }\AttributeTok{eval =}\NormalTok{ F)}
            \FunctionTok{new\_code\_block}\NormalTok{(}\AttributeTok{codes =}\NormalTok{ his[start}\SpecialCharTok{:}\NormalTok{end], }\AttributeTok{args =}\NormalTok{ args)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @export rblock}
\CommentTok{\#\textquotesingle{} @aliases rblock}
\CommentTok{\#\textquotesingle{} @title Eval the code as well create \textquotesingle{}code\_block\textquotesingle{} object}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{rblock\}: Run or not run the code with formatting as [code\_block{-}class]}
\CommentTok{\#\textquotesingle{} object.}
\CommentTok{\#\textquotesingle{} @param code The code to run or document. Braces (‘\{\}’) must be used.}
\CommentTok{\#\textquotesingle{} @param eval logical. Whether to eval the code.}
\CommentTok{\#\textquotesingle{} @param envir environment. The ‘environment’ in which the code is to be evaluated.}
\CommentTok{\#\textquotesingle{} @param ... Other parameters passed to [new\_code\_block()].}
\CommentTok{\#\textquotesingle{} @rdname rblock}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   rblock(\{}
\CommentTok{\#\textquotesingle{}     test1 \textless{}{-} 1}
\CommentTok{\#\textquotesingle{}     test2 \textless{}{-} 2}
\CommentTok{\#\textquotesingle{}     test3 \textless{}{-} 3}
\CommentTok{\#\textquotesingle{}   \})}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   rblock(\{}
\CommentTok{\#\textquotesingle{}     test \textless{}{-} mcn\_5features}
\CommentTok{\#\textquotesingle{}     \#\# this annotation line would be ignored}
\CommentTok{\#\textquotesingle{}     test1 \textless{}{-} filter\_structure(test)}
\CommentTok{\#\textquotesingle{}     test1 \textless{}{-} create\_reference(test1)}
\CommentTok{\#\textquotesingle{}     test1 \textless{}{-} filter\_formula(test1, by\_reference=T)}
\CommentTok{\#\textquotesingle{}     test1 \textless{}{-} create\_stardust\_classes(test1)}
\CommentTok{\#\textquotesingle{}   \})}
\CommentTok{\#\textquotesingle{} \}}
\NormalTok{rblock }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(code, }\AttributeTok{eval =}\NormalTok{ T, }\AttributeTok{envir =} \FunctionTok{parent.frame}\NormalTok{(), ...)\{}
\NormalTok{  code }\OtherTok{\textless{}{-}} \FunctionTok{substitute}\NormalTok{(code)}
  \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\NormalTok{rlang}\SpecialCharTok{::}\FunctionTok{is\_call}\NormalTok{(code, }\StringTok{"\{"}\NormalTok{)) \{}
\NormalTok{    info }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"The \textasciigrave{}code\textasciigrave{} argument must be a braced expression,"}\NormalTok{,}
                     \StringTok{"use this such as:"}\NormalTok{,}
\NormalTok{                     styler}\SpecialCharTok{::}\FunctionTok{style\_text}\NormalTok{(}\StringTok{"rblock(\{}\SpecialCharTok{\textbackslash{}n}\StringTok{test \textless{}{-} 1}\SpecialCharTok{\textbackslash{}n}\StringTok{test \textless{}{-} 2}\SpecialCharTok{\textbackslash{}n}\StringTok{\})"}\NormalTok{)),}
                   \AttributeTok{collapse =} \StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
    \FunctionTok{stop}\NormalTok{(info)}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{ (eval) \{}
    \FunctionTok{eval}\NormalTok{(code, }\AttributeTok{envir =}\NormalTok{ envir)}
\NormalTok{  \}}
\NormalTok{  code }\OtherTok{\textless{}{-}} \FunctionTok{unlist}\NormalTok{(}\FunctionTok{lapply}\NormalTok{(}\DecValTok{2}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(code), }\ControlFlowTok{function}\NormalTok{(n) }\FunctionTok{deparse}\NormalTok{(code[[n]])))}
\NormalTok{  args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(...)}
\NormalTok{  block.args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{echo =}\NormalTok{ T, }\AttributeTok{eval =}\NormalTok{ F)}
  \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(args}\SpecialCharTok{$}\NormalTok{args)) \{}
\NormalTok{    block.args }\OtherTok{\textless{}{-}} \FunctionTok{.fresh\_param}\NormalTok{(block.args, args}\SpecialCharTok{$}\NormalTok{args)}
\NormalTok{    args}\SpecialCharTok{$}\NormalTok{args }\OtherTok{\textless{}{-}} \ConstantTok{NULL}
\NormalTok{  \}}
  \FunctionTok{do.call}\NormalTok{(new\_code\_block, }\FunctionTok{c}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{codes =}\NormalTok{ code, }\AttributeTok{args =}\NormalTok{ block.args), args))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-extramethods-workflow.r}{%
\section{File: extraMethods-workflow.R}\label{file-extramethods-workflow.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# Quickly create analysis templates.}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @aliases workflow}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Quickly create analysis templates.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description Quickly create analysis templates and quickly construct a report.}
\CommentTok{\#\textquotesingle{} This template contains a number of pre{-}defined sections, each with a fixed}
\CommentTok{\#\textquotesingle{} description and code. The flexible approach is to use this method to obtain the}
\CommentTok{\#\textquotesingle{} codes that form these sections and then modify these codes, which is more}
\CommentTok{\#\textquotesingle{} likely to result in analysis results and reports that meet the requirements.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name workflow{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @order 1}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\FunctionTok{setOldClass}\NormalTok{(}\StringTok{"environment"}\NormalTok{)}

\CommentTok{\#\textquotesingle{} @exportMethod workflow}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{workflow()\}: get the available section names and}
\CommentTok{\#\textquotesingle{} its heading level.}
\CommentTok{\#\textquotesingle{} @rdname workflow{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"workflow"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"workflow"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{()}
\NormalTok{  \{}
\NormalTok{    codes }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
      \StringTok{"workflow(sections = "}\NormalTok{,}
      \FunctionTok{deparse}\NormalTok{(.workflow\_name),}
      \StringTok{", mode = \textquotesingle{}templ\textquotesingle{})"}
\NormalTok{    )}
    \FunctionTok{writeLines}\NormalTok{(codes)}
\NormalTok{  \}}
\NormalTok{)}

\CommentTok{\#\textquotesingle{} @exportMethod workflow}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{workflow(...)\}: use the default parameters whatever \textquotesingle{}missing\textquotesingle{}}
\CommentTok{\#\textquotesingle{} while performing the method \textbackslash{}code\{workflow\}.}
\CommentTok{\#\textquotesingle{} @rdname workflow{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"workflow"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{mode =} \StringTok{"character"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(sections, mode, envir, sirius\_version, sirius\_project, ion\_mode, ...)}
\NormalTok{  \{}
    \FunctionTok{reCallMethod}\NormalTok{(}\StringTok{"workflow"}\NormalTok{,}
      \FunctionTok{.fresh\_param}\NormalTok{(}
        \FunctionTok{list}\NormalTok{(}
          \AttributeTok{sections =} \FunctionTok{eval}\NormalTok{(.workflow\_name),}
          \AttributeTok{envir =} \FunctionTok{parent.frame}\NormalTok{(),}
          \AttributeTok{sirius\_version =} \StringTok{"sirius.v4"}\NormalTok{,}
          \AttributeTok{sirius\_project =} \StringTok{"."}\NormalTok{,}
          \AttributeTok{ion\_mode =} \StringTok{"pos"}
\NormalTok{        )), ...)}
\NormalTok{  \}}
\NormalTok{)}

\CommentTok{\#\textquotesingle{} @importFrom utils menu}
\CommentTok{\#\textquotesingle{} @exportMethod workflow}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param sections numeric with names. Use \textbackslash{}code\{workflow()\}}
\CommentTok{\#\textquotesingle{} to show the available sections.}
\CommentTok{\#\textquotesingle{} @param mode character(1). "print" or "run". If "print", print the}
\CommentTok{\#\textquotesingle{} template of the select workflow; If "run", the codes would be eval,}
\CommentTok{\#\textquotesingle{} and return with a [report{-}class] object.}
\CommentTok{\#\textquotesingle{} @param envir The environment to eval the codes. Default is \textbackslash{}code\{parent.frame()\}.}
\CommentTok{\#\textquotesingle{} @param sirius\_version character(1). Passed to [initialize\_mcnebula()].}
\CommentTok{\#\textquotesingle{} @param sirius\_project character(1). Passed to [initialize\_mcnebula()].}
\CommentTok{\#\textquotesingle{} @param ion\_mode character(1). Set this using \textbackslash{}code\{ion\_mode\textless{}{-}\}.}
\CommentTok{\#\textquotesingle{} @param ... ...}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @rdname workflow{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"workflow"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"workflow"}\NormalTok{,}
    \AttributeTok{sections =} \StringTok{"numeric"}\NormalTok{, }\AttributeTok{mode =} \StringTok{"character"}\NormalTok{, }\AttributeTok{envir =} \StringTok{"environment"}\NormalTok{,}
    \AttributeTok{sirius\_version =} \StringTok{"character"}\NormalTok{, }\AttributeTok{sirius\_project =} \StringTok{"character"}\NormalTok{,}
    \AttributeTok{ion\_mode =} \StringTok{"character"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(sections, mode, envir, sirius\_version, sirius\_project, ion\_mode, ...)}
\NormalTok{  \{}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(}\FunctionTok{names}\NormalTok{(sections)))}
      \FunctionTok{stop}\NormalTok{(}\StringTok{"\textasciigrave{}sections\textasciigrave{} must be numeric with names."}\NormalTok{)}
    \ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{any}\NormalTok{(}\FunctionTok{names}\NormalTok{(sections) }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(}\FunctionTok{eval}\NormalTok{(.workflow\_name))))}
      \FunctionTok{stop}\NormalTok{(}\StringTok{"\textasciigrave{}sections\textasciigrave{} should be part or all of these in \textasciigrave{}workflow()\textasciigrave{}."}\NormalTok{)}
\NormalTok{    env.args }\OtherTok{\textless{}{-}} \FunctionTok{as.environment}\NormalTok{(}
      \FunctionTok{c}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{sirius\_version =}\NormalTok{ sirius\_version,}
          \AttributeTok{sirius\_project =}\NormalTok{ sirius\_project,}
          \AttributeTok{ion\_mode =}\NormalTok{ ion\_mode), }\FunctionTok{list}\NormalTok{(...))}
\NormalTok{    )}
\NormalTok{    sections }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(sections),}
      \ControlFlowTok{function}\NormalTok{(name) \{}
\NormalTok{        ch }\OtherTok{\textless{}{-}}\NormalTok{ .workflow\_templ[[ name ]]}
        \FunctionTok{vapply}\NormalTok{(ch, cl, }\FunctionTok{character}\NormalTok{(}\DecValTok{1}\NormalTok{), }\AttributeTok{.envir =}\NormalTok{ env.args)}
\NormalTok{      \})}
    \ControlFlowTok{if}\NormalTok{ (mode }\SpecialCharTok{==} \StringTok{"print"}\NormalTok{) \{}
      \FunctionTok{lapply}\NormalTok{(sections,}
        \ControlFlowTok{function}\NormalTok{(section) \{}
          \FunctionTok{writeLines}\NormalTok{(}\FunctionTok{c}\NormalTok{(section, }\StringTok{""}\NormalTok{))}
\NormalTok{        \})}
      \FunctionTok{.workflow\_gather}\NormalTok{()}
      \FunctionTok{return}\NormalTok{(}\FunctionTok{message}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{\#\# Done"}\NormalTok{))}
\NormalTok{    \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (mode }\SpecialCharTok{==} \StringTok{"run"}\NormalTok{) \{}
\NormalTok{      conflict }\OtherTok{\textless{}{-}} \FunctionTok{gather\_sections}\NormalTok{(}\AttributeTok{get =}\NormalTok{ F)}
      \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(conflict) }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{) \{}
        \FunctionTok{cl}\NormalTok{(}\StringTok{"Conflicting variable names detected in environment \textasciigrave{}envir\textasciigrave{}, "}\NormalTok{,}
          \StringTok{"confirm to clear them?"}\NormalTok{)}
\NormalTok{        input }\OtherTok{\textless{}{-}}\NormalTok{ utils}\SpecialCharTok{::}\FunctionTok{menu}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"yes"}\NormalTok{, }\StringTok{"no"}\NormalTok{))}
        \ControlFlowTok{if}\NormalTok{ (input }\SpecialCharTok{==} \DecValTok{1}\NormalTok{)}
          \FunctionTok{rm}\NormalTok{(}\AttributeTok{list =}\NormalTok{ conflict, }\AttributeTok{envir =}\NormalTok{ envir)}
        \ControlFlowTok{else}
          \FunctionTok{stop}\NormalTok{(}\StringTok{"Terminate the operation."}\NormalTok{)}
\NormalTok{      \}}
      \FunctionTok{lapply}\NormalTok{(sections,}
        \ControlFlowTok{function}\NormalTok{(section) \{}
          \FunctionTok{eval}\NormalTok{(}\FunctionTok{parse}\NormalTok{(}\AttributeTok{text =}\NormalTok{ section), }\AttributeTok{envir =}\NormalTok{ envir)}
\NormalTok{        \})}
\NormalTok{      sections }\OtherTok{\textless{}{-}} \FunctionTok{gather\_sections}\NormalTok{(}\AttributeTok{envir =}\NormalTok{ envir)}
\NormalTok{      report }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(new\_report, sections)}
      \FunctionTok{return}\NormalTok{(report)}
\NormalTok{    \} }\ControlFlowTok{else}\NormalTok{ \{}
      \FunctionTok{return}\NormalTok{(}\ConstantTok{NA}\NormalTok{)}
\NormalTok{    \}}
\NormalTok{  \}}
\NormalTok{)}

\NormalTok{.workflow\_gather }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{()\{}
\NormalTok{  codes }\OtherTok{\textless{}{-}} \FunctionTok{substitute}\NormalTok{(\{}
\NormalTok{    sections }\OtherTok{\textless{}{-}} \FunctionTok{gather\_sections}\NormalTok{()}
\NormalTok{    report }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(new\_report, sections)}
    \FunctionTok{render\_report}\NormalTok{(report, file }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"/report.Rmd"}\NormalTok{))}
\NormalTok{    rmarkdown}\SpecialCharTok{::}\FunctionTok{render}\NormalTok{(file)}
\NormalTok{  \})}
\NormalTok{  codes }\OtherTok{\textless{}{-}} \FunctionTok{unlist}\NormalTok{(}\FunctionTok{lapply}\NormalTok{(}\DecValTok{2}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(codes), }\ControlFlowTok{function}\NormalTok{(n) }\FunctionTok{deparse}\NormalTok{(codes[[n]])))}
  \FunctionTok{writeLines}\NormalTok{(codes)}
\NormalTok{\}}

\NormalTok{.workflow\_name }\OtherTok{\textless{}{-}}
  \FunctionTok{substitute}\NormalTok{(}
    \FunctionTok{c}\NormalTok{(}\StringTok{"Abstract"} \OtherTok{=} \DecValTok{1}\NormalTok{, }\StringTok{"Introduction"} \OtherTok{=} \DecValTok{1}\NormalTok{, }\StringTok{"Set{-}up"} \OtherTok{=} \DecValTok{1}\NormalTok{,}
      \StringTok{"Integrate data and Create Nebulae"} \OtherTok{=} \DecValTok{1}\NormalTok{,}
      \StringTok{"Initialize analysis"} \OtherTok{=} \DecValTok{2}\NormalTok{,}
      \StringTok{"Filter candidates"} \OtherTok{=} \DecValTok{2}\NormalTok{,}
      \StringTok{"Filter chemical classes"} \OtherTok{=} \DecValTok{2}\NormalTok{,}
      \StringTok{"Create Nebulae"} \OtherTok{=} \DecValTok{2}\NormalTok{,}
      \StringTok{"Visualize Nebulae"} \OtherTok{=} \DecValTok{2}\NormalTok{,}
      \StringTok{"Session infomation"} \OtherTok{=} \DecValTok{1}
\NormalTok{      ))}

\CommentTok{\#\textquotesingle{} @importFrom glue glue}
\NormalTok{cl }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(..., }\AttributeTok{.open =} \StringTok{"\textless{}\textless{}\textless{}"}\NormalTok{, }\AttributeTok{.close =} \StringTok{"\textgreater{}\textgreater{}\textgreater{}"}\NormalTok{, }\AttributeTok{.envir =} \FunctionTok{parent.frame}\NormalTok{()) \{}
\NormalTok{  glue}\SpecialCharTok{::}\FunctionTok{glue}\NormalTok{(..., }\AttributeTok{.open =}\NormalTok{ .open, }\AttributeTok{.close =}\NormalTok{ .close, }\AttributeTok{.envir =}\NormalTok{ .envir)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-functions-clear.r}{%
\section{File: functions-clear.R}\label{file-functions-clear.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# Cleans up data in the mcnebula object that is no longer in use.}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @aliases clear}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Clean up data in the mcnebula object that is no longer in use}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @param x [mcnebula{-}class] object.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name clear}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @export clear\_dataset}
\CommentTok{\#\textquotesingle{} @aliases clear\_dataset}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{clear\_dataset\}: The data (chemical formula,}
\CommentTok{\#\textquotesingle{} chemical structure, chemical classes)}
\CommentTok{\#\textquotesingle{} in \textbackslash{}code\{project\_dataset(x)\}, and data in \textbackslash{}code\{backtrack(mcn\_dataset(mcn)\}}
\CommentTok{\#\textquotesingle{} would be clean up to reduced memory usage.}
\CommentTok{\#\textquotesingle{} This may be best used after running the [create\_nebula\_index()],}
\CommentTok{\#\textquotesingle{} if your machine doesn\textquotesingle{}t have much Random Access Memory (RAM).}
\CommentTok{\#\textquotesingle{} @note If this function has conducted, the PPCP dataset would not be}
\CommentTok{\#\textquotesingle{} available for downstream methods, such as [set\_ppcp\_data()],}
\CommentTok{\#\textquotesingle{} [annotate\_nebula()]...}
\CommentTok{\#\textquotesingle{} @rdname clear}
\NormalTok{clear\_dataset }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  clear }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{".f2\_formula"}\NormalTok{, }\StringTok{".f3\_fingerid"}\NormalTok{, }\StringTok{".f3\_canopus"}\NormalTok{)}
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in}\NormalTok{ clear) \{}
    \FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(x))[[ i ]] }\OtherTok{\textless{}{-}} \ConstantTok{NULL}
\NormalTok{  \}}
  \FunctionTok{backtrack}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(x)) }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
  \FunctionTok{return}\NormalTok{(x)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export clear\_nodes}
\CommentTok{\#\textquotesingle{} @aliases clear\_nodes}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{clear\_nodes\}: Clear data (\textquotesingle{}grobs\textquotesingle{} and \textquotesingle{}ggset\textquotesingle{}) of \textquotesingle{}nodes\textquotesingle{}}
\CommentTok{\#\textquotesingle{} in slot \textbackslash{}code\{child\_nebulae\}.}
\CommentTok{\#\textquotesingle{} @rdname clear}
\NormalTok{clear\_nodes }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
  \FunctionTok{nodes\_ggset}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x)) }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
  \FunctionTok{nodes\_grob}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x)) }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
  \FunctionTok{return}\NormalTok{(x)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-functions-plot_msms_mirrors.r}{%
\section{File: functions-plot\_msms\_mirrors.R}\label{file-functions-plot_msms_mirrors.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# draw mirror bar plot of MS/MS spectra}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @importFrom dplyr starts\_with}
\CommentTok{\#\textquotesingle{} @importFrom grid grid.draw}
\CommentTok{\#\textquotesingle{} @importFrom grid upViewport}
\CommentTok{\#\textquotesingle{} @importFrom grid downViewport}
\CommentTok{\#\textquotesingle{} @aliases plot\_msms\_mirrors}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Draw MS/MS mirror bar plots}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} Draw MS/MS spectra as mirror bar plots using \textquotesingle{}ggplot2\textquotesingle{} with [facet\_wrap()].}
\CommentTok{\#\textquotesingle{} The sub{-}panel of each \textquotesingle{}features\textquotesingle{} would be found by [grid::grid.grep()]...}
\CommentTok{\#\textquotesingle{} Then chemical structures would be drawn into sub{-}panel.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x [mcnebula{-}class] object.}
\CommentTok{\#\textquotesingle{} @param .features\_id character. The ID of \textquotesingle{}features\textquotesingle{}.}
\CommentTok{\#\textquotesingle{} @param fun\_modify function. Used to post modify the [ggset{-}class] object before}
\CommentTok{\#\textquotesingle{} visualization. See [fun\_modify].}
\CommentTok{\#\textquotesingle{} @param structure\_vp \textquotesingle{}viewport\textquotesingle{} object. Created by [grid::viewport()]. The \textquotesingle{}viewport\textquotesingle{}}
\CommentTok{\#\textquotesingle{} to draw chemical structures in sub{-}panel. Can be \textasciigrave{}NULL\textasciigrave{}, this would return a \textquotesingle{}ggplot\textquotesingle{}}
\CommentTok{\#\textquotesingle{} object without chemical structure visualization.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @seealso [facet\_wrap()], [grid::grid.force], [grid::grid.grep()]...}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @name plot\_msms\_mirrors}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @export plot\_msms\_mirrors}
\CommentTok{\#\textquotesingle{} @aliases plot\_msms\_mirrors}
\CommentTok{\#\textquotesingle{} @rdname plot\_msms\_mirrors}
\NormalTok{plot\_msms\_mirrors }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(x, .features\_id, }\AttributeTok{fun\_modify =}\NormalTok{ modify\_set\_labs\_xy,}
           \AttributeTok{structure\_vp =}\NormalTok{ grid}\SpecialCharTok{::}\FunctionTok{viewport}\NormalTok{(}\FloatTok{0.7}\NormalTok{, }\FloatTok{0.3}\NormalTok{, }\FloatTok{0.3}\NormalTok{, }\FloatTok{0.3}\NormalTok{)}
\NormalTok{           )\{}
    \FunctionTok{.check\_data}\NormalTok{(x, }\FunctionTok{list}\NormalTok{(}\AttributeTok{features\_annotation =} \StringTok{"create\_features\_annotation"}\NormalTok{))}
\NormalTok{    x }\OtherTok{\textless{}{-}} \FunctionTok{collate\_data}\NormalTok{(x, }\StringTok{".f2\_msms"}\NormalTok{)}
\NormalTok{    x }\OtherTok{\textless{}{-}} \FunctionTok{collate\_data}\NormalTok{(x, }\StringTok{".f3\_spectra"}\NormalTok{)}

    \DocumentationTok{\#\# raw peak}
\NormalTok{    raw\_msms }\OtherTok{\textless{}{-}} \FunctionTok{latest}\NormalTok{(x, }\StringTok{"project\_dataset"}\NormalTok{, }\StringTok{".f2\_msms"}\NormalTok{)}
\NormalTok{    raw\_msms }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(raw\_msms, .features\_id }\SpecialCharTok{\%in\%} \SpecialCharTok{!!}\NormalTok{.features\_id)}
\NormalTok{    raw\_msms }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{split}\NormalTok{(raw\_msms, }\SpecialCharTok{\textasciitilde{}}\NormalTok{.features\_id),}
\NormalTok{      dplyr}\SpecialCharTok{::}\NormalTok{mutate, }\AttributeTok{rel.int. =}\NormalTok{ int. }\SpecialCharTok{/} \FunctionTok{max}\NormalTok{(int.) }\SpecialCharTok{*} \DecValTok{100}
\NormalTok{    )}
\NormalTok{    raw\_msms }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(raw\_msms, dplyr}\SpecialCharTok{::}\NormalTok{select,}
\NormalTok{      .features\_id, }\AttributeTok{raw\_mz =}\NormalTok{ mz, }\AttributeTok{raw\_rel.int. =}\NormalTok{ rel.int.)}

    \DocumentationTok{\#\# non{-}noise peak}
\NormalTok{    sig\_msms }\OtherTok{\textless{}{-}} \FunctionTok{latest}\NormalTok{(x, }\StringTok{"project\_dataset"}\NormalTok{, }\StringTok{".f3\_spectra"}\NormalTok{)}
\NormalTok{    sig\_msms }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(sig\_msms, .features\_id }\SpecialCharTok{\%in\%} \SpecialCharTok{!!}\NormalTok{.features\_id)}
\NormalTok{    sig\_msms }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(sig\_msms, .features\_id,}
                              \AttributeTok{sig\_mz =}\NormalTok{ mz, }\AttributeTok{sig\_rel.int. =}\NormalTok{ rel.int.)}
\NormalTok{    sig\_msms }\OtherTok{\textless{}{-}} \FunctionTok{split}\NormalTok{(sig\_msms, }\SpecialCharTok{\textasciitilde{}}\NormalTok{ .features\_id)}

    \DocumentationTok{\#\# merge}
\NormalTok{    set }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(.features\_id, }\AttributeTok{simplify =}\NormalTok{ F,}
                  \ControlFlowTok{function}\NormalTok{(id)\{}
\NormalTok{                    df }\OtherTok{\textless{}{-}} \FunctionTok{tol\_merge}\NormalTok{(raw\_msms[[id]], sig\_msms[[id]],}
                                    \StringTok{"raw\_mz"}\NormalTok{, }\StringTok{"sig\_mz"}\NormalTok{)}
\NormalTok{                    df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(df, }\SpecialCharTok{{-}}\NormalTok{dplyr}\SpecialCharTok{::}\FunctionTok{starts\_with}\NormalTok{(}\StringTok{".features\_id"}\NormalTok{))}
\NormalTok{                    dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(df, }\AttributeTok{sig\_rel.int. =} \SpecialCharTok{{-}}\NormalTok{sig\_rel.int.)}
\NormalTok{                  \})}

\NormalTok{    set }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(set, }\AttributeTok{idcol =}\NormalTok{ T)}
\NormalTok{    set }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{rename}\NormalTok{(set, }\AttributeTok{.features\_id =}\NormalTok{ .id)}
\NormalTok{    matched\_set }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(set, }\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(sig\_mz))}

    \DocumentationTok{\#\# precursor mz and rt}
\NormalTok{    anno }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(}\FunctionTok{features\_annotation}\NormalTok{(x),}
\NormalTok{                          tani.score, .features\_id, }\AttributeTok{pre.mz =}\NormalTok{ mz, rt.secound)}
\NormalTok{    anno }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(anno, .features\_id }\SpecialCharTok{\%in\%} \SpecialCharTok{!!}\NormalTok{.features\_id)}
\NormalTok{    export\_name }\OtherTok{\textless{}{-}} \FunctionTok{export\_name}\NormalTok{(x)}

\NormalTok{    anno }\OtherTok{\textless{}{-}}
\NormalTok{      dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(anno,}
                    \AttributeTok{tani.score =} \FunctionTok{round}\NormalTok{(tani.score, }\DecValTok{2}\NormalTok{),}
                    \AttributeTok{pre.mz =} \FunctionTok{round}\NormalTok{(pre.mz, }\DecValTok{4}\NormalTok{),}
                    \AttributeTok{rt.min =} \FunctionTok{round}\NormalTok{(rt.secound }\SpecialCharTok{/} \DecValTok{60}\NormalTok{, }\DecValTok{2}\NormalTok{),}
                    \AttributeTok{x =} \DecValTok{0}\NormalTok{, }\AttributeTok{y =} \DecValTok{65}\NormalTok{,}
                    \AttributeTok{label =} \FunctionTok{paste0}\NormalTok{(}\SpecialCharTok{!!}\NormalTok{export\_name[[ }\StringTok{"pre.mz"}\NormalTok{ ]],}
                                   \StringTok{": "}\NormalTok{, pre.mz, }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{,}
                                   \SpecialCharTok{!!}\NormalTok{export\_name[[ }\StringTok{"rt.min"}\NormalTok{ ]],}
                                   \StringTok{": "}\NormalTok{, rt.min, }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{,}
                                   \StringTok{"TS: "}\NormalTok{, }\FunctionTok{ifelse}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(tani.score), }\StringTok{"{-}"}\NormalTok{,}
\NormalTok{                                                  tani.score)}
\NormalTok{                                   ))}

\NormalTok{    ggset }\OtherTok{\textless{}{-}}
      \FunctionTok{new\_ggset}\NormalTok{(}\FunctionTok{new\_command}\NormalTok{(ggplot),}
                \FunctionTok{.command\_msms\_rawPeak}\NormalTok{(set),}
                \FunctionTok{.command\_msms\_sigPeak}\NormalTok{(matched\_set),}
                \FunctionTok{.command\_msms\_rawDot}\NormalTok{(matched\_set),}
                \FunctionTok{.command\_msms\_sigDot}\NormalTok{(matched\_set),}
                \FunctionTok{.command\_msms\_text}\NormalTok{(anno),}
                \FunctionTok{.command\_msms\_y}\NormalTok{(),}
                \FunctionTok{new\_command}\NormalTok{(theme\_minimal),}
                \FunctionTok{.command\_msms\_theme}\NormalTok{(),}
                \FunctionTok{.command\_msms\_facet}\NormalTok{()}
\NormalTok{      )}
\NormalTok{    p }\OtherTok{\textless{}{-}} \FunctionTok{call\_command}\NormalTok{(}\FunctionTok{fun\_modify}\NormalTok{(ggset))}

    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(structure\_vp))}
      \FunctionTok{return}\NormalTok{(p)}
    
    \FunctionTok{print}\NormalTok{(p, }\AttributeTok{newpage =}\NormalTok{ T)}
\NormalTok{    df.vp }\OtherTok{\textless{}{-}} \FunctionTok{get\_facet.wrap.vp}\NormalTok{(.features\_id)}

    \FunctionTok{.message\_info\_viewport}\NormalTok{()}
    \FunctionTok{apply}\NormalTok{(df.vp, }\DecValTok{1}\NormalTok{,}
          \ControlFlowTok{function}\NormalTok{(lst)\{}
\NormalTok{            grob }\OtherTok{\textless{}{-}} \FunctionTok{structures\_grob}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))[[ lst[[ }\StringTok{"strip"}\NormalTok{ ]] ]]}
            \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(grob)) \{}
\NormalTok{              grid}\SpecialCharTok{::}\FunctionTok{downViewport}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(lst[[ }\StringTok{"vp"}\NormalTok{ ]]))}
\NormalTok{              grid}\SpecialCharTok{::}\FunctionTok{pushViewport}\NormalTok{(structure\_vp)}
              \FunctionTok{grid.draw}\NormalTok{(grob)}
\NormalTok{              grid}\SpecialCharTok{::}\FunctionTok{upViewport}\NormalTok{(}\DecValTok{0}\NormalTok{)}
\NormalTok{            \}}
\NormalTok{          \})}
    \FunctionTok{.message\_info\_viewport}\NormalTok{()}

\NormalTok{  \}}

\NormalTok{.command\_msms\_rawPeak }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(df, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.8}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.8}\NormalTok{)\{}
\NormalTok{    df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(df, }\AttributeTok{mz =}\NormalTok{ raw\_mz, }\AttributeTok{rel.int. =} \DecValTok{0}\NormalTok{)}
    \FunctionTok{new\_command}\NormalTok{(geom\_segment, }\AttributeTok{data =}\NormalTok{ df,}
                \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ mz, }\AttributeTok{xend =}\NormalTok{ raw\_mz, }\AttributeTok{y =}\NormalTok{ rel.int., }\AttributeTok{yend =}\NormalTok{ raw\_rel.int.),}
                \AttributeTok{color =}\NormalTok{ color, }\AttributeTok{size =}\NormalTok{ size, }\AttributeTok{alpha =}\NormalTok{ alpha}
\NormalTok{    )}
\NormalTok{  \}}

\NormalTok{.command\_msms\_sigPeak }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(df, }\AttributeTok{color =} \StringTok{"\#E6550DFF"}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.8}\NormalTok{, }\AttributeTok{alpha =} \DecValTok{1}\NormalTok{)\{}
    \FunctionTok{new\_command}\NormalTok{(geom\_segment, }\AttributeTok{data =}\NormalTok{ df,}
                \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ sig\_mz, }\AttributeTok{xend =}\NormalTok{ sig\_mz, }\AttributeTok{y =} \DecValTok{0}\NormalTok{, }\AttributeTok{yend =}\NormalTok{ sig\_rel.int.),}
                \AttributeTok{color =}\NormalTok{ color, }\AttributeTok{size =}\NormalTok{ size, }\AttributeTok{alpha =}\NormalTok{ alpha}
\NormalTok{    )}
\NormalTok{  \}}

\NormalTok{.command\_msms\_sigDot }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(df, }\AttributeTok{color =} \StringTok{"\#E6550DFF"}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.8}\NormalTok{, }\AttributeTok{alpha =} \DecValTok{1}\NormalTok{)\{}
    \FunctionTok{new\_command}\NormalTok{(geom\_point, }\AttributeTok{data =}\NormalTok{ df,}
                \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ sig\_mz, }\AttributeTok{y =}\NormalTok{ sig\_rel.int.),}
                \AttributeTok{color =}\NormalTok{ color, }\AttributeTok{size =}\NormalTok{ size, }\AttributeTok{alpha =}\NormalTok{ alpha}
\NormalTok{    )}
\NormalTok{  \}}

\NormalTok{.command\_msms\_rawDot }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(df, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.8}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.8}\NormalTok{)\{}
    \FunctionTok{new\_command}\NormalTok{(geom\_point, }\AttributeTok{data =}\NormalTok{ df,}
                \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ raw\_mz, }\AttributeTok{y =}\NormalTok{ raw\_rel.int.),}
                \AttributeTok{color =}\NormalTok{ color, }\AttributeTok{size =}\NormalTok{ size, }\AttributeTok{alpha =}\NormalTok{ alpha}
\NormalTok{    )}
\NormalTok{  \}}

\NormalTok{.command\_msms\_text }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(df, }\AttributeTok{hjust =} \DecValTok{0}\NormalTok{, }\AttributeTok{fontface =} \StringTok{"bold"}\NormalTok{, }\AttributeTok{family =}\NormalTok{ .font)\{}
    \FunctionTok{new\_command}\NormalTok{(geom\_text, }\AttributeTok{data =}\NormalTok{ df,}
                \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y, }\AttributeTok{label =}\NormalTok{ label),}
                \AttributeTok{hjust =}\NormalTok{ hjust, }\AttributeTok{fontface =}\NormalTok{ fontface, }\AttributeTok{family =}\NormalTok{ family}
\NormalTok{    )}
\NormalTok{  \}}

\NormalTok{.command\_msms\_y }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{()\{}
    \FunctionTok{new\_command}\NormalTok{(scale\_y\_continuous, }\AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{100}\NormalTok{, }\DecValTok{100}\NormalTok{))}
\NormalTok{  \}}

\NormalTok{.command\_msms\_theme }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{()\{}
    \FunctionTok{new\_command}\NormalTok{(theme, }
                \AttributeTok{text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{family =}\NormalTok{ .font),}
                \AttributeTok{strip.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{12}\NormalTok{),}
                \AttributeTok{panel.grid =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{color =} \StringTok{"grey85"}\NormalTok{),}
                \AttributeTok{plot.background =} \FunctionTok{element\_rect}\NormalTok{(}
                  \AttributeTok{fill =} \StringTok{"white"}\NormalTok{, }\AttributeTok{color =} \StringTok{"transparent"}\NormalTok{, }\AttributeTok{size =} \DecValTok{0}
\NormalTok{                )}
\NormalTok{    )}
\NormalTok{  \}}

\NormalTok{.command\_msms\_facet }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{()\{}
    \FunctionTok{new\_command}\NormalTok{(facet\_wrap, }\SpecialCharTok{\textasciitilde{}} \FunctionTok{paste}\NormalTok{(}\StringTok{"ID:"}\NormalTok{, .features\_id), }\AttributeTok{scales =} \StringTok{"free"}\NormalTok{)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @importFrom dplyr bind\_rows}
\NormalTok{tol\_merge }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(main,}
\NormalTok{           sub,}
           \AttributeTok{main\_col =} \StringTok{"mz"}\NormalTok{,}
           \AttributeTok{sub\_col =} \StringTok{"mz"}\NormalTok{,}
           \AttributeTok{tol =} \FloatTok{0.002}\NormalTok{,}
           \AttributeTok{bin\_size =} \DecValTok{1}
\NormalTok{           )\{}
    \ControlFlowTok{if}\NormalTok{ (main\_col }\SpecialCharTok{==}\NormalTok{ sub\_col) \{}
\NormalTok{      new\_name }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(sub\_col, }\StringTok{".sub"}\NormalTok{)}
      \FunctionTok{colnames}\NormalTok{(sub)[}\FunctionTok{colnames}\NormalTok{(sub) }\SpecialCharTok{==}\NormalTok{ sub\_col] }\OtherTok{\textless{}{-}}\NormalTok{ new\_name}
\NormalTok{      sub\_col }\OtherTok{\textless{}{-}}\NormalTok{ new\_name}
\NormalTok{    \}}
\NormalTok{    main}\SpecialCharTok{$}\NormalTok{...seq }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(main)}
\NormalTok{    backup }\OtherTok{\textless{}{-}}\NormalTok{ main}
    \DocumentationTok{\#\# to reduce computation, round numeric for limitation}
    \DocumentationTok{\#\# main}
\NormalTok{    main}\SpecialCharTok{$}\NormalTok{...id }\OtherTok{\textless{}{-}} \FunctionTok{round}\NormalTok{(main[[ main\_col ]], bin\_size)}
    \DocumentationTok{\#\# sub}
\NormalTok{    sub.x }\OtherTok{\textless{}{-}}\NormalTok{ sub.y }\OtherTok{\textless{}{-}}\NormalTok{ sub}
\NormalTok{    sub.x}\SpecialCharTok{$}\NormalTok{...id }\OtherTok{\textless{}{-}} \FunctionTok{round}\NormalTok{(sub.x[[ sub\_col ]], bin\_size)}
\NormalTok{    sub.y}\SpecialCharTok{$}\NormalTok{...id }\OtherTok{\textless{}{-}}\NormalTok{ sub.x}\SpecialCharTok{$}\NormalTok{...id }\SpecialCharTok{+}\NormalTok{ ( }\DecValTok{1} \SpecialCharTok{*} \DecValTok{10}\SpecialCharTok{\^{}{-}}\NormalTok{bin\_size )}
\NormalTok{    sub }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(sub.x, sub.y)}
    \DocumentationTok{\#\# expand merge}
\NormalTok{    df }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(main, sub, }\AttributeTok{by =} \StringTok{"...id"}\NormalTok{, }\AttributeTok{all.x =}\NormalTok{ T, }\AttributeTok{allow.cartesian =}\NormalTok{ T)}
\NormalTok{    df}\SpecialCharTok{$}\NormalTok{...diff }\OtherTok{\textless{}{-}} \FunctionTok{abs}\NormalTok{(df[[ main\_col ]] }\SpecialCharTok{{-}}\NormalTok{ df[[ sub\_col ]])}
\NormalTok{    df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(df, ...diff }\SpecialCharTok{\textless{}=} \SpecialCharTok{!!}\NormalTok{tol)}
    \DocumentationTok{\#\# get the non{-}merged}
\NormalTok{    backup }\OtherTok{\textless{}{-}}\NormalTok{ backup[}\SpecialCharTok{!}\NormalTok{backup}\SpecialCharTok{$}\NormalTok{...seq }\SpecialCharTok{\%in\%}\NormalTok{ df}\SpecialCharTok{$}\NormalTok{...seq, ]}
\NormalTok{    df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{bind\_rows}\NormalTok{(df, backup)}
    \DocumentationTok{\#\# remove the assist col}
\NormalTok{    dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(df, }\SpecialCharTok{{-}}\NormalTok{...id, }\SpecialCharTok{{-}}\NormalTok{...diff, }\SpecialCharTok{{-}}\NormalTok{...seq)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @importFrom grid grid.grep}
\CommentTok{\#\textquotesingle{} @importFrom grid grid.force}
\NormalTok{get\_facet.wrap.vp }\OtherTok{\textless{}{-}}
  \ControlFlowTok{function}\NormalTok{(}
\NormalTok{           strip,}
           \AttributeTok{grid.force =}\NormalTok{ T}
\NormalTok{           )\{}
    \ControlFlowTok{if}\NormalTok{(grid.force)\{}
\NormalTok{      grid}\SpecialCharTok{::}\FunctionTok{grid.force}\NormalTok{()}
\NormalTok{    \}}
    \DocumentationTok{\#\# grep vp of panel}
\NormalTok{    panel }\OtherTok{\textless{}{-}}\NormalTok{ grid}\SpecialCharTok{::}\FunctionTok{grid.grep}\NormalTok{(}\StringTok{"panel"}\NormalTok{, }\AttributeTok{grep =}\NormalTok{ T, }\AttributeTok{global=}\NormalTok{ T, }\AttributeTok{viewports =}\NormalTok{ T, }\AttributeTok{grobs =}\NormalTok{ F)}
    \DocumentationTok{\#\# vp name}
\NormalTok{    panel }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(panel, paste)}
    \DocumentationTok{\#\# the specific seq number of vp}
\NormalTok{    panel.seq }\OtherTok{\textless{}{-}}\NormalTok{ stringr}\SpecialCharTok{::}\FunctionTok{str\_extract}\NormalTok{(panel, }\StringTok{"(?\textless{}=panel{-})[0{-}9]\{1,\}(?={-})"}\NormalTok{)}
\NormalTok{    panel.seq }\OtherTok{\textless{}{-}} \FunctionTok{max}\NormalTok{(}\FunctionTok{as.integer}\NormalTok{(panel.seq))}
    \DocumentationTok{\#\# number stat}
\NormalTok{    len }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(strip)}
\NormalTok{    len.p }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(panel)}
    \DocumentationTok{\#\# the number of blank panel}
\NormalTok{    na }\OtherTok{\textless{}{-}}\NormalTok{ len.p }\SpecialCharTok{{-}}\NormalTok{ (len }\SpecialCharTok{\%\%}\NormalTok{ len.p)}
    \ControlFlowTok{if}\NormalTok{(na }\SpecialCharTok{==}\NormalTok{ len.p)}
\NormalTok{      na }\OtherTok{\textless{}{-}} \DecValTok{0}
    \DocumentationTok{\#\# as matrix}
\NormalTok{    mat }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\FunctionTok{sort}\NormalTok{(strip), }\FunctionTok{rep}\NormalTok{(}\ConstantTok{NA}\NormalTok{, na)), }\AttributeTok{ncol =}\NormalTok{ panel.seq, }\AttributeTok{byrow =}\NormalTok{ T)}
\NormalTok{    vec }\OtherTok{\textless{}{-}} \FunctionTok{as.vector}\NormalTok{(mat)}
    \DocumentationTok{\#\# as data.frame}
\NormalTok{    df }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{data.table}\NormalTok{(}\AttributeTok{vp =}\NormalTok{ panel, }\AttributeTok{strip =}\NormalTok{ vec)}
    \DocumentationTok{\#\# filter out the NA}
\NormalTok{    df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(df, }\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(strip))}
    \FunctionTok{return}\NormalTok{(df)}
\NormalTok{  \}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-functions-report.r}{%
\section{File: functions-report.R}\label{file-functions-report.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# Help for rendering report}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @export get\_ref}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{get\_ref\}: get the string for cross{-}reference.}
\CommentTok{\#\textquotesingle{} @param object [code\_block\_figure{-}class] or [code\_block\_table{-}class] object.}
\CommentTok{\#\textquotesingle{} @param type character. "fig" or "tab".}
\CommentTok{\#\textquotesingle{} @rdname code\_block{-}class}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   \#\# general}
\CommentTok{\#\textquotesingle{}   codes \textless{}{-} "df \textless{}{-} data.frame(x = 1:10)}
\CommentTok{\#\textquotesingle{}     df\textless{}{-}dplyr::mutate(df,y=x*1.5)\%\textgreater{}\%}
\CommentTok{\#\textquotesingle{}     dplyr::filter(x \textgreater{}= 5)}
\CommentTok{\#\textquotesingle{}     p \textless{}{-} ggplot(df)+}
\CommentTok{\#\textquotesingle{}     geom\_point(aes(x=x,y=y))}
\CommentTok{\#\textquotesingle{}     p"}
\CommentTok{\#\textquotesingle{}   block \textless{}{-} new\_code\_block("r", codes, list(eval = T, echo = T, message = T))}
\CommentTok{\#\textquotesingle{}   \#\# see results}
\CommentTok{\#\textquotesingle{}   block}
\CommentTok{\#\textquotesingle{}   call\_command(block)}
\CommentTok{\#\textquotesingle{}   writeLines(call\_command(block))}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# figure}
\CommentTok{\#\textquotesingle{}   fig\_block \textless{}{-} new\_code\_block\_figure(}
\CommentTok{\#\textquotesingle{}     "plot1",}
\CommentTok{\#\textquotesingle{}     "this is a caption",}
\CommentTok{\#\textquotesingle{}     codes = codes}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   \#\# see results}
\CommentTok{\#\textquotesingle{}   fig\_block}
\CommentTok{\#\textquotesingle{}   writeLines(call\_command(fig\_block))}
\CommentTok{\#\textquotesingle{}   command\_args(fig\_block)}
\CommentTok{\#\textquotesingle{}   cat(get\_ref(fig\_block), "\textbackslash{}n")}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# table}
\CommentTok{\#\textquotesingle{}   codes \textless{}{-} "df \textless{}{-} data.frame(x = 1:10) \%\textgreater{}\% }
\CommentTok{\#\textquotesingle{}     dplyr::mutate(y = x, z = x * y)}
\CommentTok{\#\textquotesingle{}     knitr::kable(df, format = \textquotesingle{}markdown\textquotesingle{}, caption = \textquotesingle{}this is a caption\textquotesingle{}) "}
\CommentTok{\#\textquotesingle{}   tab\_block \textless{}{-} new\_code\_block\_table("table1", codes = codes)}
\CommentTok{\#\textquotesingle{}   \#\# see results}
\CommentTok{\#\textquotesingle{}   tab\_block}
\CommentTok{\#\textquotesingle{}   cat(get\_ref(tab\_block), "\textbackslash{}n")}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# default parameters}
\CommentTok{\#\textquotesingle{}   new\_code\_block()}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{} \}}
\NormalTok{get\_ref }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(object, }\AttributeTok{type =} \FunctionTok{c}\NormalTok{(}\StringTok{"fig"}\NormalTok{, }\StringTok{"tab"}\NormalTok{))\{}
\NormalTok{    type }\OtherTok{\textless{}{-}} \FunctionTok{match.arg}\NormalTok{(type)}
\NormalTok{    name }\OtherTok{\textless{}{-}} \FunctionTok{sub}\NormalTok{(}\StringTok{"\^{}r "}\NormalTok{, }\StringTok{""}\NormalTok{, }\FunctionTok{command\_name}\NormalTok{(object))}
    \FunctionTok{paste0}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{@ref("}\NormalTok{, type, }\StringTok{":"}\NormalTok{, name, }\StringTok{")"}\NormalTok{)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export render\_report}
\CommentTok{\#\textquotesingle{} @aliases render\_report}
\CommentTok{\#\textquotesingle{} @title Convert \textquotesingle{}report\textquotesingle{} as .Rmd file}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{render\_report\}: Write down [report{-}class] onject}
\CommentTok{\#\textquotesingle{} as .Rmd file, then [rmarkdown::render()] can be used to output any}
\CommentTok{\#\textquotesingle{} available formation.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @param x [report{-}class] object.}
\CommentTok{\#\textquotesingle{} @param file character(1). File name to save as.}
\CommentTok{\#\textquotesingle{} @param set\_all\_eval logical(1). If \textbackslash{}code\{TRUE\}, all [code\_block{-}class] object}
\CommentTok{\#\textquotesingle{} or [section{-}class] object related with "r" would be set with \textbackslash{}code\{eval = T\}.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @rdname render\_report}
\NormalTok{render\_report }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, file, }\AttributeTok{set\_all\_eval =}\NormalTok{ F) \{}
  \ControlFlowTok{if}\NormalTok{ (set\_all\_eval) \{}
    \FunctionTok{layers}\NormalTok{(x) }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{layers}\NormalTok{(x),}
      \ControlFlowTok{function}\NormalTok{(obj) \{}
        \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is}\NormalTok{(obj, }\StringTok{"code\_block"}\NormalTok{)) \{}
          \FunctionTok{command\_args}\NormalTok{(obj)}\SpecialCharTok{$}\NormalTok{eval }\OtherTok{\textless{}{-}}\NormalTok{ T}
\NormalTok{        \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is}\NormalTok{(obj, }\StringTok{"section"}\NormalTok{)) \{}
          \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(}\FunctionTok{code\_block}\NormalTok{(obj))) \{}
            \FunctionTok{command\_args}\NormalTok{(}\FunctionTok{code\_block}\NormalTok{(obj))}\SpecialCharTok{$}\NormalTok{eval }\OtherTok{\textless{}{-}}\NormalTok{ T}
\NormalTok{          \}}
\NormalTok{        \}}
        \FunctionTok{return}\NormalTok{(obj)}
\NormalTok{      \})}
\NormalTok{  \}}
  \FunctionTok{writeLines}\NormalTok{(}\FunctionTok{call\_command}\NormalTok{(x), file)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export gather\_sections}
\CommentTok{\#\textquotesingle{} @aliases gather\_sections}
\CommentTok{\#\textquotesingle{} @title Quickly gather all the \textquotesingle{}sections\textquotesingle{} in environment}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{gather\_sections\}:}
\CommentTok{\#\textquotesingle{} Gathers all eligible variable names in an environment by means of Regex}
\CommentTok{\#\textquotesingle{} matches.  These variables must: have a uniform character prefix, and the first}
\CommentTok{\#\textquotesingle{} character that follows must be a number. e.g., "s1", "s2", "s12.2",}
\CommentTok{\#\textquotesingle{} "s15.5.figure"...}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @param prefix character(1). The character prefix of the variable name.}
\CommentTok{\#\textquotesingle{} @param envir environment. The environment to get the variables.}
\CommentTok{\#\textquotesingle{} @param sort logical(1). If \textbackslash{}code\{TRUE\}, sort the variable names}
\CommentTok{\#\textquotesingle{} according to the first number string that accompanies the prefix.}
\CommentTok{\#\textquotesingle{} @param get logical(1). If \textbackslash{}code\{TRUE\}, return with a list of the value of}
\CommentTok{\#\textquotesingle{} the variables. If \textbackslash{}code\{FALSE\}, return with the variable names.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @rdname gather\_sections}
\NormalTok{gather\_sections }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(}\AttributeTok{prefix =} \StringTok{"s"}\NormalTok{, }\AttributeTok{envir =} \FunctionTok{parent.frame}\NormalTok{(),}
  \AttributeTok{sort =}\NormalTok{ T, }\AttributeTok{get =}\NormalTok{ T)}
\NormalTok{\{}
\NormalTok{  objs }\OtherTok{\textless{}{-}} \FunctionTok{ls}\NormalTok{(}\AttributeTok{envir =}\NormalTok{ envir)}
\NormalTok{  sections }\OtherTok{\textless{}{-}}\NormalTok{ objs[ }\FunctionTok{grepl}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"\^{}"}\NormalTok{, prefix, }\StringTok{"[0{-}9]"}\NormalTok{), objs) ]}
  \ControlFlowTok{if}\NormalTok{ (sort) \{}
\NormalTok{    num }\OtherTok{\textless{}{-}}\NormalTok{ stringr}\SpecialCharTok{::}\FunctionTok{str\_extract}\NormalTok{(}
\NormalTok{      sections, }\FunctionTok{paste0}\NormalTok{(}\StringTok{"(?\textless{}="}\NormalTok{, prefix, }\StringTok{")[0{-}9]\{1,\}[.]\{0,\}[0{-}9]\{0,\}"}\NormalTok{)}
\NormalTok{    )}
\NormalTok{    sections }\OtherTok{\textless{}{-}}\NormalTok{ sections[}\FunctionTok{order}\NormalTok{(}\FunctionTok{as.numeric}\NormalTok{(num))]}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{ (get) \{}
\NormalTok{    sections }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(sections, get, }\AttributeTok{envir =}\NormalTok{ envir, }\AttributeTok{simplify =}\NormalTok{ F)}
\NormalTok{  \}}
\NormalTok{  sections}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-main-generic.r}{%
\section{File: main-generic.R}\label{file-main-generic.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# Generic for main method supplied by MCnebula2}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"initialize\_mcnebula"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{ANY =} \StringTok{"x"}\NormalTok{,}
                         \StringTok{"character"} \OtherTok{=} \StringTok{"sirius\_version"}\NormalTok{,}
                         \StringTok{"character"} \OtherTok{=} \StringTok{"sirius\_project"}\NormalTok{,}
                         \StringTok{"character"} \OtherTok{=} \StringTok{"output\_directory"}
\NormalTok{                         ),}
           \ControlFlowTok{function}\NormalTok{(x, sirius\_version, sirius\_project, output\_directory)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"initialize\_mcnebula"}\NormalTok{))}
 
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"filter\_formula"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{mcnebula =} \StringTok{"x"}\NormalTok{,}
                         \StringTok{"function"} \OtherTok{=} \StringTok{"fun\_filter"}\NormalTok{,}
                         \StringTok{"logical"} \OtherTok{=} \StringTok{"by\_reference"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, fun\_filter, ..., by\_reference)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"filter\_formula"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"filter\_structure"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{mcnebula =} \StringTok{"x"}\NormalTok{,}
                         \StringTok{"function"} \OtherTok{=} \StringTok{"fun\_filter"}\NormalTok{,}
                         \StringTok{"logical"} \OtherTok{=} \StringTok{"by\_reference"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, fun\_filter, ..., by\_reference)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"filter\_structure"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"create\_reference"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{mcnebula =} \StringTok{"x"}\NormalTok{,}
                         \StringTok{"character"} \OtherTok{=} \StringTok{"from"}\NormalTok{,}
                         \StringTok{"character"} \OtherTok{=} \StringTok{"subscript"}\NormalTok{,}
                         \StringTok{"data.frame"} \OtherTok{=} \StringTok{"data"}\NormalTok{,}
                         \StringTok{"vector"} \OtherTok{=} \StringTok{"columns"}\NormalTok{,}
                         \StringTok{"logical"} \OtherTok{=} \StringTok{"fill"}\NormalTok{,}
                         \StringTok{"list"} \OtherTok{=} \StringTok{"MoreArgs"}
\NormalTok{                         ),}
           \ControlFlowTok{function}\NormalTok{(x, from, subscript, data, columns, fill, MoreArgs)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"create\_reference"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"filter\_ppcp"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{mcnebula =} \StringTok{"x"}\NormalTok{,}
                         \StringTok{"function"} \OtherTok{=} \StringTok{"fun\_filter"}\NormalTok{,}
                         \StringTok{"logical"} \OtherTok{=} \StringTok{"by\_reference"}
\NormalTok{                         ),}
           \ControlFlowTok{function}\NormalTok{(x, fun\_filter, ..., by\_reference)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"filter\_ppcp"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"create\_hierarchy"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{mcnebula =} \StringTok{"x"}\NormalTok{, }\StringTok{"function"} \OtherTok{=} \StringTok{"fun\_organize"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, fun\_organize) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"create\_hierarchy"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"create\_features\_annotation"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{mcnebula =} \StringTok{"x"}\NormalTok{, }\StringTok{"data.frame"} \OtherTok{=} \StringTok{"extra\_data"}\NormalTok{,}
                         \StringTok{"ANY"} \OtherTok{=} \StringTok{"column"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, extra\_data, column)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"create\_features\_annotation"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"create\_stardust\_classes"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{mcnebula =} \StringTok{"x"}\NormalTok{,}
                         \StringTok{"numeric"} \OtherTok{=} \StringTok{"pp.threshold"}\NormalTok{,}
                         \StringTok{"numeric"} \OtherTok{=} \StringTok{"hierarchy\_priority"}\NormalTok{,}
                         \StringTok{"logical"} \OtherTok{=} \StringTok{"position\_isomerism"}\NormalTok{,}
                         \StringTok{"logical"} \OtherTok{=} \StringTok{"inherit\_dataset"}
\NormalTok{                         ),}
           \ControlFlowTok{function}\NormalTok{(x, pp.threshold, hierarchy\_priority,}
\NormalTok{                    position\_isomerism, inherit\_dataset)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"create\_stardust\_classes"}\NormalTok{))}
 
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"cross\_filter\_stardust"}\NormalTok{,}
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{mcnebula =} \StringTok{"x"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, min\_number, max\_ratio,}
\NormalTok{                    types, cutoff, tolerance,}
\NormalTok{                    hierarchy\_range, identical\_factor)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"cross\_filter\_stardust"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"cross\_filter\_quantity"}\NormalTok{,}
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{mcnebula =} \StringTok{"x"}\NormalTok{,}
                         \StringTok{"numeric"} \OtherTok{=} \StringTok{"min\_number"}\NormalTok{, }\StringTok{"numeric"} \OtherTok{=} \StringTok{"max\_ratio"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, min\_number, max\_ratio)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"cross\_filter\_quantity"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"cross\_filter\_score"}\NormalTok{,}
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{mcnebula =} \StringTok{"x"}\NormalTok{, }\StringTok{"character"} \OtherTok{=} \StringTok{"types"}\NormalTok{,}
                         \StringTok{"numeric"} \OtherTok{=} \StringTok{"cutoff"}\NormalTok{, }\StringTok{"numeric"} \OtherTok{=} \StringTok{"tolerance"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, types, cutoff, tolerance)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"cross\_filter\_score"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"cross\_filter\_identical"}\NormalTok{,}
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{mcnebula =} \StringTok{"x"}\NormalTok{, }\StringTok{"numeric"} \OtherTok{=} \StringTok{"hierarchy\_range"}\NormalTok{,}
                         \StringTok{"numeric"} \OtherTok{=} \StringTok{"identical\_factor"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, hierarchy\_range, identical\_factor)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"cross\_filter\_identical"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"backtrack\_stardust"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{mcnebula =} \StringTok{"x"}\NormalTok{, }\StringTok{"character"} \OtherTok{=} \StringTok{"class.name"}\NormalTok{,}
                         \StringTok{"numeric"} \OtherTok{=} \StringTok{"rel.index"}\NormalTok{, }\StringTok{"logical"} \OtherTok{=} \StringTok{"remove"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, class.name, rel.index, remove)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"backtrack\_stardust"}\NormalTok{))}
 
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"create\_nebula\_index"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{mcnebula =} \StringTok{"x"}\NormalTok{, }\StringTok{"logical"} \OtherTok{=} \StringTok{"force"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, force)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"create\_nebula\_index"}\NormalTok{))}
 
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"compute\_spectral\_similarity"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{mcnebula =} \StringTok{"x"}\NormalTok{,}
                         \StringTok{"logical"} \OtherTok{=} \StringTok{"within\_nebula"}\NormalTok{,}
                         \StringTok{"logical"} \OtherTok{=} \StringTok{"recompute"}\NormalTok{,}
                         \StringTok{"ANY"} \OtherTok{=} \StringTok{"sp1"}\NormalTok{,}
                         \StringTok{"ANY"} \OtherTok{=} \StringTok{"sp2"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, within\_nebula, recompute, sp1, sp2)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"compute\_spectral\_similarity"}\NormalTok{))}
 
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"create\_parent\_nebula"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{mcnebula =} \StringTok{"x"}\NormalTok{,}
                         \StringTok{"numeric"} \OtherTok{=} \StringTok{"edge\_cutoff"}\NormalTok{,}
                         \StringTok{"numeric"} \OtherTok{=} \StringTok{"max\_edge\_number"}\NormalTok{,}
                         \StringTok{"logical"} \OtherTok{=} \StringTok{"remove\_isolate"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, edge\_cutoff, max\_edge\_number, remove\_isolate)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"create\_parent\_nebula"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"create\_child\_nebulae"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{mcnebula =} \StringTok{"x"}\NormalTok{,}
                         \StringTok{"numeric"} \OtherTok{=} \StringTok{"edge\_cutoff"}\NormalTok{,}
                         \StringTok{"numeric"} \OtherTok{=} \StringTok{"max\_edge\_number"}\NormalTok{,}
                         \StringTok{"logical"} \OtherTok{=} \StringTok{"use\_tracer"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, edge\_cutoff, max\_edge\_number, use\_tracer)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"create\_child\_nebulae"}\NormalTok{))}
 
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"create\_parent\_layout"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{mcnebula =} \StringTok{"x"}\NormalTok{, }\StringTok{"character"} \OtherTok{=} \StringTok{"ggraph\_layout"}\NormalTok{,}
                         \StringTok{"numeric"} \OtherTok{=} \StringTok{"seed"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, ggraph\_layout, seed)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"create\_parent\_layout"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"create\_child\_layouts"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{mcnebula =} \StringTok{"x"}\NormalTok{, }\StringTok{"character"} \OtherTok{=} \StringTok{"ggraph\_layouts"}\NormalTok{,}
                         \StringTok{"numeric"} \OtherTok{=} \StringTok{"seeds"}\NormalTok{, }\StringTok{"ANY"} \OtherTok{=} \StringTok{"grid\_layout"}\NormalTok{,}
                         \StringTok{"list"} \OtherTok{=} \StringTok{"viewports"}\NormalTok{, }\StringTok{"ANY"} \OtherTok{=} \StringTok{"panel\_viewport"}\NormalTok{,}
                         \StringTok{"ANY"} \OtherTok{=} \StringTok{"legend\_viewport"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, ggraph\_layouts, seeds, grid\_layout,}
\NormalTok{                    viewports, panel\_viewport, legend\_viewport)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"create\_child\_layouts"}\NormalTok{))}
 
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"activate\_nebulae"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{mcnebula =} \StringTok{"x"}\NormalTok{,}
                         \StringTok{"function"} \OtherTok{=} \StringTok{"fun\_default\_parent"}\NormalTok{,}
                         \StringTok{"function"} \OtherTok{=} \StringTok{"fun\_default\_child"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, fun\_default\_parent, fun\_default\_child)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"activate\_nebulae"}\NormalTok{))}
 
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"visualize"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, item, fun\_modify, annotate)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"visualize"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"visualize\_all"}\NormalTok{, }
           \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\StringTok{"ANY"} \OtherTok{=} \StringTok{"x"}\NormalTok{, }\StringTok{"logical"} \OtherTok{=} \StringTok{"newpage"}\NormalTok{,}
                         \StringTok{"ANY"} \OtherTok{=} \StringTok{"fun\_modify"}\NormalTok{,}
                         \StringTok{"ANY"} \OtherTok{=} \StringTok{"legend\_hierarchy"}\NormalTok{),}
           \ControlFlowTok{function}\NormalTok{(x, newpage, fun\_modify, legend\_hierarchy)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"visualize\_all"}\NormalTok{))}
 
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"annotate\_nebula"}\NormalTok{, }
           \ControlFlowTok{function}\NormalTok{(x, nebula\_name)}
             \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"annotate\_nebula"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-methods-activate_nebulae.r}{%
\section{File: methods-activate\_nebulae.R}\label{file-methods-activate_nebulae.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# make up \textquotesingle{}ggset\textquotesingle{} (a meta class for visualizing ggplot object),}
\CommentTok{\# based on layout of parent nebula and child nebulae.}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @aliases activate\_nebulae}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title activate Nebulae for visualization}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} Based on layouts create by [create\_parent\_layout()] or [create\_child\_layouts()],}
\CommentTok{\#\textquotesingle{} use functions to activate Nebulae as [ggset{-}class] object for [visualize()]}
\CommentTok{\#\textquotesingle{} methods to draw them.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name activate\_nebulae{-}methods}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @seealso [ggset{-}class], [create\_parent\_layout()], [create\_child\_layouts()]...}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @order 1}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @exportMethod activate\_nebulae}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{activate\_nebulae()\}: get the default parameters for the method}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{activate\_nebulae\}.}
\CommentTok{\#\textquotesingle{} @rdname activate\_nebulae{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"activate\_nebulae"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"activate\_nebulae"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{()\{}
            \FunctionTok{list}\NormalTok{(}\AttributeTok{fun\_default\_parent =}\NormalTok{ ggset\_activate\_parent\_nebula,}
                 \AttributeTok{fun\_default\_child =}\NormalTok{ ggset\_activate\_child\_nebulae)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod activate\_nebulae}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{activate\_nebulae(x, ...)\}:}
\CommentTok{\#\textquotesingle{} use the default parameters whatever \textquotesingle{}missing\textquotesingle{}}
\CommentTok{\#\textquotesingle{} while performing the method \textbackslash{}code\{activate\_nebulae\}.}
\CommentTok{\#\textquotesingle{} @rdname activate\_nebulae{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"activate\_nebulae"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, fun\_default\_parent, fun\_default\_child)\{}
            \FunctionTok{reCallMethod}\NormalTok{(}\StringTok{"activate\_nebulae"}\NormalTok{,}
                         \FunctionTok{.fresh\_param}\NormalTok{(}\FunctionTok{activate\_nebulae}\NormalTok{()))}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod activate\_nebulae}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases activate\_nebulae}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x [mcnebula{-}class] object.}
\CommentTok{\#\textquotesingle{} @param fun\_default\_parent function. Passed to create [ggset{-}class] object}
\CommentTok{\#\textquotesingle{} for Parent{-}Nebula. Default is \textbackslash{}code\{ggset\_activate\_parent\_nebula\}.}
\CommentTok{\#\textquotesingle{} Normally not used.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @param fun\_default\_child function. Passed to create [ggset{-}class] object}
\CommentTok{\#\textquotesingle{} for Child{-}Nebulae. Default is \textbackslash{}code\{ggset\_activate\_child\_nebulae\}.}
\CommentTok{\#\textquotesingle{} Normally not used.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname activate\_nebulae{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} mcn\_5features}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# the previous steps}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_structure(test)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_reference(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_formula(test1, by\_reference = T)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_stardust\_classes(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_features\_annotation(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} cross\_filter\_stardust(test1, 2, 1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_nebula\_index(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} compute\_spectral\_similarity(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_parent\_nebula(test1, 0.01)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_child\_nebulae(test1, 0.01)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_parent\_layout(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_child\_layouts(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# default parameters}
\CommentTok{\#\textquotesingle{}   activate\_nebulae()}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} activate\_nebulae(test1)}
\CommentTok{\#\textquotesingle{}   \#\# see results}
\CommentTok{\#\textquotesingle{}   ggset(parent\_nebula(test1))}
\CommentTok{\#\textquotesingle{}   head(ggset(child\_nebulae(test1)))}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# visualize}
\CommentTok{\#\textquotesingle{}   call\_command(ggset(parent\_nebula(test1)))}
\CommentTok{\#\textquotesingle{}   \#\# or}
\CommentTok{\#\textquotesingle{}   visualize(test1, "parent")}
\CommentTok{\#\textquotesingle{}   \#\# child nebula}
\CommentTok{\#\textquotesingle{}   call\_command(ggset(child\_nebulae(test1))[[1]])}
\CommentTok{\#\textquotesingle{}   \#\# or}
\CommentTok{\#\textquotesingle{}   visualize(test1, 1)}
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"activate\_nebulae"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{,}
                        \AttributeTok{fun\_default\_parent =} \StringTok{"function"}\NormalTok{,}
                        \AttributeTok{fun\_default\_child =} \StringTok{"function"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, fun\_default\_parent, fun\_default\_child)\{}
            \FunctionTok{.message\_info\_formal}\NormalTok{(}\StringTok{"MCnebula2"}\NormalTok{, }\StringTok{"activate\_nebulae"}\NormalTok{)}
            \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(}\FunctionTok{layout\_ggraph}\NormalTok{(}\FunctionTok{parent\_nebula}\NormalTok{(x)))) \{}
              \FunctionTok{ggset}\NormalTok{(}\FunctionTok{parent\_nebula}\NormalTok{(x)) }\OtherTok{\textless{}{-}} \FunctionTok{fun\_default\_parent}\NormalTok{(x)}
\NormalTok{              parent }\OtherTok{\textless{}{-}}\NormalTok{ T}
\NormalTok{            \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{              parent }\OtherTok{\textless{}{-}}\NormalTok{ F}
\NormalTok{            \}}
            \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(}\FunctionTok{layout\_ggraph}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x)))) \{}
              \FunctionTok{ggset}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x)) }\OtherTok{\textless{}{-}} \FunctionTok{fun\_default\_child}\NormalTok{(x)}
\NormalTok{              child }\OtherTok{\textless{}{-}}\NormalTok{ T}
\NormalTok{            \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{              child }\OtherTok{\textless{}{-}}\NormalTok{ F}
\NormalTok{            \}}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{any}\NormalTok{(}\SpecialCharTok{!}\NormalTok{(parent }\SpecialCharTok{|}\NormalTok{ child)))}
              \FunctionTok{stop}\NormalTok{(}\StringTok{"nothing need to be activate"}\NormalTok{)}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{ggset\_activate\_parent\_nebula\}:}
\CommentTok{\#\textquotesingle{} create [ggset{-}class] object of Parent{-}Nebula.}
\CommentTok{\#\textquotesingle{} @rdname activate\_nebulae{-}methods}
\CommentTok{\#\textquotesingle{} @export }
\CommentTok{\#\textquotesingle{} @importFrom ggraph ggraph}
\NormalTok{ggset\_activate\_parent\_nebula }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(x)\{}
    \FunctionTok{.check\_data}\NormalTok{(}\FunctionTok{parent\_nebula}\NormalTok{(x), }\FunctionTok{list}\NormalTok{(}\AttributeTok{layout\_ggraph =} \StringTok{"create\_parent\_layout"}\NormalTok{))}
    \FunctionTok{new\_ggset}\NormalTok{(}\FunctionTok{new\_command}\NormalTok{(ggraph}\SpecialCharTok{::}\NormalTok{ggraph, }\FunctionTok{layout\_ggraph}\NormalTok{(}\FunctionTok{parent\_nebula}\NormalTok{(x))),}
              \FunctionTok{.command\_parent\_edge}\NormalTok{(),}
              \FunctionTok{.command\_parent\_node}\NormalTok{(),}
              \FunctionTok{.command\_parent\_edge\_width}\NormalTok{(),}
              \FunctionTok{.command\_parent\_fill}\NormalTok{(}\FunctionTok{palette\_gradient}\NormalTok{(x)),}
              \FunctionTok{.command\_scale\_x}\NormalTok{(}\FunctionTok{layout\_ggraph}\NormalTok{(}\FunctionTok{parent\_nebula}\NormalTok{(x))),}
              \FunctionTok{.command\_scale\_y}\NormalTok{(}\FunctionTok{layout\_ggraph}\NormalTok{(}\FunctionTok{parent\_nebula}\NormalTok{(x))),}
              \FunctionTok{new\_command}\NormalTok{(}\FunctionTok{match.fun}\NormalTok{(theme\_grey), }\AttributeTok{name =} \StringTok{"theme\_grey"}\NormalTok{),}
              \FunctionTok{.command\_parent\_theme}\NormalTok{()}
\NormalTok{    )}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{ggset\_activate\_child\_nebulae\}:}
\CommentTok{\#\textquotesingle{} create lists of [ggset{-}class] object of Child{-}Nebulae.}
\CommentTok{\#\textquotesingle{} @rdname activate\_nebulae{-}methods}
\CommentTok{\#\textquotesingle{} @export }
\CommentTok{\#\textquotesingle{} @importFrom ggraph ggraph}
\NormalTok{ggset\_activate\_child\_nebulae }\OtherTok{\textless{}{-}}
  \ControlFlowTok{function}\NormalTok{(x)\{}
    \FunctionTok{.check\_data}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x), }\FunctionTok{list}\NormalTok{(}\AttributeTok{layout\_ggraph =} \StringTok{"create\_child\_layouts"}\NormalTok{))}
\NormalTok{    set }\OtherTok{\textless{}{-}} \FunctionTok{layout\_ggraph}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))}
\NormalTok{    hierarchy }\OtherTok{\textless{}{-}} \FunctionTok{.get\_hierarchy}\NormalTok{(x)}
\NormalTok{    ggsets }\OtherTok{\textless{}{-}}
      \FunctionTok{lapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(set),}
             \ControlFlowTok{function}\NormalTok{(name)\{}
\NormalTok{               fill }\OtherTok{\textless{}{-}} \FunctionTok{palette\_label}\NormalTok{(x)[[ hierarchy[[name]] ]]}
               \FunctionTok{new\_ggset}\NormalTok{(}\FunctionTok{new\_command}\NormalTok{(ggraph}\SpecialCharTok{::}\NormalTok{ggraph, set[[ name ]]),}
                         \FunctionTok{.command\_parent\_edge}\NormalTok{(}\StringTok{"black"}\NormalTok{),}
                         \FunctionTok{.command\_parent\_node}\NormalTok{(),}
                         \FunctionTok{.command\_parent\_edge\_width}\NormalTok{(),}
                         \FunctionTok{.command\_parent\_fill}\NormalTok{(}\FunctionTok{palette\_gradient}\NormalTok{(x)),}
                         \FunctionTok{.command\_child\_title}\NormalTok{(name),}
                         \FunctionTok{.command\_scale\_x}\NormalTok{(set[[ name ]]),}
                         \FunctionTok{.command\_scale\_y}\NormalTok{(set[[ name ]]),}
                         \FunctionTok{new\_command}\NormalTok{(}\FunctionTok{match.fun}\NormalTok{(theme\_grey), }\AttributeTok{name =} \StringTok{"theme\_grey"}\NormalTok{),}
                         \FunctionTok{.command\_child\_theme}\NormalTok{(fill)}
\NormalTok{               )}
\NormalTok{             \})}
    \FunctionTok{names}\NormalTok{(ggsets) }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(set)}
    \FunctionTok{return}\NormalTok{(ggsets)}
\NormalTok{  \}}

\NormalTok{.get\_node\_attribute\_range }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, attr)\{}
  \FunctionTok{.check\_data}\NormalTok{(x, }\FunctionTok{list}\NormalTok{(}\StringTok{"features\_annotation"} \OtherTok{=} \StringTok{"create\_features\_annotation"}\NormalTok{))}
  \FunctionTok{range}\NormalTok{(}\FunctionTok{features\_annotation}\NormalTok{(x)[[ attr ]])}
\NormalTok{\}}

\NormalTok{.get\_hierarchy }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(x)\{}
\NormalTok{    hierarchy }\OtherTok{\textless{}{-}} \FunctionTok{as.list}\NormalTok{(}\FunctionTok{hierarchy}\NormalTok{(x)[[}\StringTok{"hierarchy"}\NormalTok{]])}
    \FunctionTok{names}\NormalTok{(hierarchy) }\OtherTok{\textless{}{-}} \FunctionTok{hierarchy}\NormalTok{(x)[[}\StringTok{"class.name"}\NormalTok{]]}
    \FunctionTok{return}\NormalTok{(hierarchy)}
\NormalTok{  \}}

\NormalTok{.get\_textbox\_fill }\OtherTok{\textless{}{-}}
  \ControlFlowTok{function}\NormalTok{(x, class.name)\{}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{missing}\NormalTok{(class.name)) \{}
\NormalTok{      class.name }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(}\FunctionTok{igraph}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x)))}
\NormalTok{    \}}
\NormalTok{    hierarchy }\OtherTok{\textless{}{-}} \FunctionTok{.get\_hierarchy}\NormalTok{(x)}
    \FunctionTok{vapply}\NormalTok{(class.name, }\AttributeTok{FUN.VALUE =} \StringTok{"ch"}\NormalTok{,}
           \ControlFlowTok{function}\NormalTok{(name)\{}
             \FunctionTok{palette\_label}\NormalTok{(x)[[ hierarchy[[ name ]] ]]}
\NormalTok{           \})}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @aliases set\_nodes\_color}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Custom defined nodes color in Nebulae (network)}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} Custom defined the nodes color for visualizing.}
\CommentTok{\#\textquotesingle{} Run after [activate\_nebulae()].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name set\_nodes\_color{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @order 1}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @importFrom dplyr select}
\CommentTok{\#\textquotesingle{} @exportMethod set\_nodes\_color}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases set\_nodes\_color}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x [mcnebula{-}class] object.}
\CommentTok{\#\textquotesingle{} @param attribute character. The attribute specified to colorful the nodes.}
\CommentTok{\#\textquotesingle{} Can be continues attribute or discrete attribute, exist in}
\CommentTok{\#\textquotesingle{} \textquotesingle{}layout\_ggraph\textquotesingle{} object or data of \textbackslash{}code\{extra\_data\}.}
\CommentTok{\#\textquotesingle{} Related with [ggplot2::scale\_fill\_gradientn()] and [ggplot2::scale\_fill\_manual()].}
\CommentTok{\#\textquotesingle{} If the attribute is continues, colors in \textbackslash{}code\{palette\_gradient(object)\} would}
\CommentTok{\#\textquotesingle{} be used. If the attribute is discrete, use colors in \textbackslash{}code\{palette\_set(object)\}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param extra\_data data.frame. Extra data used for setting nodes color.}
\CommentTok{\#\textquotesingle{} The data.frame must contains column of \textquotesingle{}.features\_id\textquotesingle{}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param use\_tracer logical. If \textbackslash{}code\{TRUE\}, hightlight the \textquotesingle{}top\textquotesingle{} \textquotesingle{}features\textquotesingle{}}
\CommentTok{\#\textquotesingle{} marked in \textquotesingle{}nebula\_index\textquotesingle{} data. See [set\_tracer()].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @seealso [activate\_nebulae()], [set\_tracer()]...}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname set\_nodes\_color{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} mcn\_5features}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# the previous steps}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_structure(test)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_reference(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_formula(test1, by\_reference = T)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_stardust\_classes(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_features\_annotation(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} cross\_filter\_stardust(test1, 2, 1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_nebula\_index(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} compute\_spectral\_similarity(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_parent\_nebula(test1, 0.01)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_child\_nebulae(test1, 0.01)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_parent\_layout(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_child\_layouts(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} activate\_nebulae(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   ids \textless{}{-} features\_annotation(test1)$.features\_id}
\CommentTok{\#\textquotesingle{}   extra\_data \textless{}{-} data.frame(}
\CommentTok{\#\textquotesingle{}     .features\_id = ids,}
\CommentTok{\#\textquotesingle{}     attr\_1 = rnorm(length(ids), 100, 50),}
\CommentTok{\#\textquotesingle{}     attr\_2 = sample(c("special", "normal"), 5, replace = T)}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} set\_nodes\_color(test1, "attr\_1", extra\_data)}
\CommentTok{\#\textquotesingle{}   visualize(test1, 1)}
\CommentTok{\#\textquotesingle{}   visualize\_all(test1)}
\CommentTok{\#\textquotesingle{}   \#\# set labal of the legend}
\CommentTok{\#\textquotesingle{}   export\_name(test1) \textless{}{-} c(}
\CommentTok{\#\textquotesingle{}     export\_name(test1),}
\CommentTok{\#\textquotesingle{}     attr\_1 = "Continuous attribute",}
\CommentTok{\#\textquotesingle{}     attr\_2 = "Discrete attribute"}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   visualize\_all(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} set\_nodes\_color(test1, "attr\_2", extra\_data)}
\CommentTok{\#\textquotesingle{}   visualize(test1, 1)}
\CommentTok{\#\textquotesingle{}   visualize\_all(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# set colors for \textquotesingle{}tracer\textquotesingle{}}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} set\_tracer(test1, ids[1:2])}
\CommentTok{\#\textquotesingle{}   \#\# re{-}build Child{-}Nebulae}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_child\_nebulae(test1, 0.01)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_child\_layouts(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} activate\_nebulae(test1)}
\CommentTok{\#\textquotesingle{}   \#\# set color}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} set\_nodes\_color(test1, use\_tracer = T)}
\CommentTok{\#\textquotesingle{}   visualize\_all(test1)}
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"set\_nodes\_color"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"set\_nodes\_color"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{,}
                                 \AttributeTok{attribute =} \StringTok{"character"}\NormalTok{,}
                                 \AttributeTok{extra\_data =} \StringTok{"data.frame"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, attribute, extra\_data)\{}
            \FunctionTok{.check\_data}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x), }\FunctionTok{list}\NormalTok{(}\AttributeTok{ggset =} \StringTok{"activate\_nebulae"}\NormalTok{))}
            \FunctionTok{.check\_data}\NormalTok{(x, }\FunctionTok{list}\NormalTok{(}\AttributeTok{features\_annotation =} \StringTok{"create\_features\_annotation"}\NormalTok{))}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(attribute) }\SpecialCharTok{!=} \DecValTok{1}\NormalTok{) \{}
              \FunctionTok{stop}\NormalTok{( }\StringTok{"\textasciigrave{}attribute\textasciigrave{} must be a character \textasciigrave{}length(attribute) == 1\textasciigrave{}."}\NormalTok{ )}
\NormalTok{            \}}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{any}\NormalTok{(}\SpecialCharTok{!}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{".features\_id"}\NormalTok{, attribute) }\SpecialCharTok{\%in\%} \FunctionTok{colnames}\NormalTok{(extra\_data)))) \{}
              \FunctionTok{stop}\NormalTok{(}\StringTok{"extra\_data must contains columns of \textquotesingle{}.features\_id\textquotesingle{} and the "}\NormalTok{,}
                   \StringTok{"specified \textasciigrave{}attribute\textasciigrave{}."}\NormalTok{)}
\NormalTok{            \}}
            \DocumentationTok{\#\# add \textasciigrave{}extra\_data\textasciigrave{} into data \textquotesingle{}features\_annotation\textquotesingle{} as attributes}
\NormalTok{            features\_annotation }\OtherTok{\textless{}{-}} \FunctionTok{features\_annotation}\NormalTok{(x)}
            \FunctionTok{attr}\NormalTok{(features\_annotation, }\StringTok{"extra\_data"}\NormalTok{) }\OtherTok{\textless{}{-}}\NormalTok{ extra\_data}
            \FunctionTok{reference}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(x))}\SpecialCharTok{$}\NormalTok{features\_annotation }\OtherTok{\textless{}{-}}\NormalTok{ features\_annotation}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.numeric}\NormalTok{(extra\_data[[ attribute ]])) \{}
\NormalTok{              command\_scale }\OtherTok{\textless{}{-}} \FunctionTok{.command\_parent\_fill}\NormalTok{(}\FunctionTok{palette\_gradient}\NormalTok{(x))}
\NormalTok{            \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{              command\_scale }\OtherTok{\textless{}{-}} \FunctionTok{.command\_parent\_fill2}\NormalTok{(}\FunctionTok{palette\_set}\NormalTok{(x))}
\NormalTok{            \}}
\NormalTok{            attribute }\OtherTok{\textless{}{-}} \FunctionTok{as.name}\NormalTok{(attribute)}
\NormalTok{            aes\_ex }\OtherTok{\textless{}{-}} \FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =} \SpecialCharTok{!!}\NormalTok{attribute)}
            \FunctionTok{ggset}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x)) }\OtherTok{\textless{}{-}}
              \FunctionTok{lapply}\NormalTok{(}\FunctionTok{ggset}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x)),}
                     \ControlFlowTok{function}\NormalTok{(ggset) \{}
\NormalTok{                       data }\OtherTok{\textless{}{-}} \FunctionTok{command\_args}\NormalTok{(}\FunctionTok{layers}\NormalTok{(ggset)[[ }
                                            \StringTok{"ggraph::ggraph"} 
\NormalTok{                                            ]])[[ }\StringTok{"graph"}\NormalTok{ ]]}
\NormalTok{                       mapped\_attr }\OtherTok{\textless{}{-}} \FunctionTok{.get\_mapping2}\NormalTok{(ggset)}
\NormalTok{                       mapped\_attr }\OtherTok{\textless{}{-}}\NormalTok{ mapped\_attr[}\FunctionTok{names}\NormalTok{(mapped\_attr) }\SpecialCharTok{!=} \StringTok{"fill"}\NormalTok{]}
\NormalTok{                       mapped\_attr }\OtherTok{\textless{}{-}}\NormalTok{ mapped\_attr[mapped\_attr }\SpecialCharTok{\%in\%} \FunctionTok{colnames}\NormalTok{(data)]}
\NormalTok{                       data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(data, x, y, name,}
\NormalTok{                                             dplyr}\SpecialCharTok{::}\FunctionTok{all\_of}\NormalTok{(}\FunctionTok{unname}\NormalTok{(mapped\_attr)))}
\NormalTok{                       data }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(data, extra\_data, }\AttributeTok{by.x =} \StringTok{"name"}\NormalTok{, }\AttributeTok{by.y =} \StringTok{".features\_id"}\NormalTok{,}
                                     \AttributeTok{all.x =}\NormalTok{ T)}
\NormalTok{                       mapping }\OtherTok{\textless{}{-}}
                         \FunctionTok{command\_args}\NormalTok{(}\FunctionTok{layers}\NormalTok{(ggset)[[ }\StringTok{"ggraph::geom\_node\_point"}\NormalTok{ ]])}\SpecialCharTok{$}\NormalTok{mapping}
\NormalTok{                       mapping}\SpecialCharTok{$}\NormalTok{fill }\OtherTok{\textless{}{-}} \ConstantTok{NULL}
\NormalTok{                       mapping }\OtherTok{\textless{}{-}}\NormalTok{ ggraph}\SpecialCharTok{:::}\FunctionTok{aes\_intersect}\NormalTok{(mapping, aes\_ex)}
\NormalTok{                       ggset }\OtherTok{\textless{}{-}} \FunctionTok{mutate\_layer}\NormalTok{(ggset, }\StringTok{"ggraph::geom\_node\_point"}\NormalTok{,}
                                             \AttributeTok{data =}\NormalTok{ data,}
                                             \AttributeTok{mapping =}\NormalTok{ mapping)}
\NormalTok{                       seq }\OtherTok{\textless{}{-}} \FunctionTok{grep}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"\^{}scale\_fill|\^{}ggplot2::scale\_fill"}\NormalTok{),}
                                   \FunctionTok{names}\NormalTok{(}\FunctionTok{layers}\NormalTok{(ggset)))}
                       \FunctionTok{layers}\NormalTok{(ggset)[[ seq ]] }\OtherTok{\textless{}{-}} \ConstantTok{NULL}
                       \FunctionTok{add\_layers}\NormalTok{(ggset, command\_scale)}
\NormalTok{                     \})}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod set\_nodes\_color}
\CommentTok{\#\textquotesingle{} @rdname set\_nodes\_color{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"set\_nodes\_color"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"set\_nodes\_color"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{,}
                                 \AttributeTok{attribute =} \StringTok{"character"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, attribute)\{}
\NormalTok{            attr }\OtherTok{\textless{}{-}} \FunctionTok{as.name}\NormalTok{(attribute)}
\NormalTok{            aes\_ex }\OtherTok{\textless{}{-}} \FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =} \SpecialCharTok{!!}\NormalTok{attr)}
            \FunctionTok{ggset}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x)) }\OtherTok{\textless{}{-}}
              \FunctionTok{lapply}\NormalTok{(}\FunctionTok{ggset}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x)),}
                     \ControlFlowTok{function}\NormalTok{(ggset) \{}
\NormalTok{                       mapping }\OtherTok{\textless{}{-}}
                         \FunctionTok{command\_args}\NormalTok{(}\FunctionTok{layers}\NormalTok{(ggset)[[}
                                      \StringTok{"ggraph::geom\_node\_point"}
\NormalTok{                                      ]])}\SpecialCharTok{$}\NormalTok{mapping}
\NormalTok{                       mapping}\SpecialCharTok{$}\NormalTok{fill }\OtherTok{\textless{}{-}} \ConstantTok{NULL}
\NormalTok{                       mapping }\OtherTok{\textless{}{-}}\NormalTok{ ggraph}\SpecialCharTok{:::}\FunctionTok{aes\_intersect}\NormalTok{(mapping, aes\_ex)}
\NormalTok{                       ggset }\OtherTok{\textless{}{-}} \FunctionTok{mutate\_layer}\NormalTok{(ggset, }\StringTok{"ggraph::geom\_node\_point"}\NormalTok{,}
                                             \AttributeTok{data =} \ConstantTok{NULL}\NormalTok{,}
                                             \AttributeTok{mapping =}\NormalTok{ mapping)}
\NormalTok{                       data }\OtherTok{\textless{}{-}} \FunctionTok{command\_args}\NormalTok{(}\FunctionTok{layers}\NormalTok{(ggset)[[ }
                                            \StringTok{"ggraph::ggraph"}
\NormalTok{                                            ]])[[ }\StringTok{"graph"}\NormalTok{ ]]}
                       \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.numeric}\NormalTok{(data[[ attribute ]])) \{}
\NormalTok{                         command\_scale }\OtherTok{\textless{}{-}} \FunctionTok{.command\_parent\_fill}\NormalTok{(}\FunctionTok{palette\_gradient}\NormalTok{(x))}
\NormalTok{                       \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{                         command\_scale }\OtherTok{\textless{}{-}} \FunctionTok{.command\_parent\_fill2}\NormalTok{(}\FunctionTok{palette\_set}\NormalTok{(x))}
\NormalTok{                       \}}
\NormalTok{                       seq }\OtherTok{\textless{}{-}} \FunctionTok{grep}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"\^{}scale\_fill|\^{}ggplot2::scale\_fill"}\NormalTok{),}
                                   \FunctionTok{names}\NormalTok{(}\FunctionTok{layers}\NormalTok{(ggset)))}
                       \FunctionTok{layers}\NormalTok{(ggset)[[ seq ]] }\OtherTok{\textless{}{-}} \ConstantTok{NULL}
                       \FunctionTok{add\_layers}\NormalTok{(ggset, command\_scale)}
\NormalTok{                     \})}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod set\_nodes\_color}
\CommentTok{\#\textquotesingle{} @rdname set\_nodes\_color{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"set\_nodes\_color"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"set\_nodes\_color"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{,}
                                 \AttributeTok{use\_tracer =} \StringTok{"logical"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, use\_tracer)\{}
            \FunctionTok{.check\_data}\NormalTok{(x, }\FunctionTok{list}\NormalTok{(}\AttributeTok{nebula\_index =} \StringTok{"create\_nebula\_index"}\NormalTok{))}
            \ControlFlowTok{if}\NormalTok{ (use\_tracer }\SpecialCharTok{\&} \FunctionTok{is.logical}\NormalTok{(}\FunctionTok{nebula\_index}\NormalTok{(x)[[ }\StringTok{"tracer"}\NormalTok{ ]])) \{}
\NormalTok{              data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{distinct}\NormalTok{(}\FunctionTok{nebula\_index}\NormalTok{(x),}
\NormalTok{                                      .features\_id, tracer\_color, tracer)}
\NormalTok{              data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(data, }\AttributeTok{tracer =} \FunctionTok{ifelse}\NormalTok{(tracer, .features\_id,}
                                                          \StringTok{"Others"}\NormalTok{))}
\NormalTok{              pal }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{distinct}\NormalTok{(data, tracer, tracer\_color)}
              \FunctionTok{palette\_set}\NormalTok{(}\FunctionTok{melody}\NormalTok{(x)) }\OtherTok{\textless{}{-}}
                \FunctionTok{.as\_dic}\NormalTok{(pal}\SpecialCharTok{$}\NormalTok{tracer\_color, pal}\SpecialCharTok{$}\NormalTok{tracer, }\AttributeTok{fill =}\NormalTok{ F, }\AttributeTok{as.list =}\NormalTok{ F)}
\NormalTok{              x }\OtherTok{\textless{}{-}} \FunctionTok{set\_nodes\_color}\NormalTok{(x, }\AttributeTok{attribute =} \StringTok{"tracer"}\NormalTok{, }\AttributeTok{extra\_data =}\NormalTok{ data)}
\NormalTok{            \}}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-methods-annotate_nebula.r}{%
\section{File: methods-annotate\_nebula.R}\label{file-methods-annotate_nebula.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# visualize the nebula and annotate it with multiple attributes}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @aliases annotate\_nebula}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Add multiple annotation data for visualization of Child{-}Nebula.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} Use methods [draw\_nodes()] and [draw\_structures()] to standby visualization}
\CommentTok{\#\textquotesingle{} of Child{-}Nebula with mutiple annotation: chemical classification,}
\CommentTok{\#\textquotesingle{} \textquotesingle{}features\textquotesingle{} quantification, chemical structure...}
\CommentTok{\#\textquotesingle{} Run after [activate\_nebulae()].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @details}
\CommentTok{\#\textquotesingle{} Primarily, remove the [ggraph::geom\_node\_point()] layer in [ggset{-}class] object}
\CommentTok{\#\textquotesingle{} of Child{-}Nebula. The \textquotesingle{}nodes\textquotesingle{} would be replaced with \textquotesingle{}grob\textquotesingle{} object create by}
\CommentTok{\#\textquotesingle{} [draw\_nodes()]. The function of [ggimage::geom\_subview()] is used to add}
\CommentTok{\#\textquotesingle{} \textquotesingle{}grob\textquotesingle{} object into \textquotesingle{}ggplot\textquotesingle{} object.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name annotate\_nebula{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @order 1}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @importFrom dplyr select}
\CommentTok{\#\textquotesingle{} @importFrom gridExtra arrangeGrob}
\CommentTok{\#\textquotesingle{} @exportMethod annotate\_nebula}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases annotate\_nebula}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x [mcnebula{-}class] object.}
\CommentTok{\#\textquotesingle{} @param nebula\_name character(1). Chemical classes in \textquotesingle{}nebula\_index\textquotesingle{} data.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @seealso [activate\_nebulae()], [draw\_nodes()], [draw\_structures()],}
\CommentTok{\#\textquotesingle{} [set\_ppcp\_data()], [set\_ration\_data()]...}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname annotate\_nebula{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} mcn\_5features}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# the previous steps}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_structure(test)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_reference(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_formula(test1, by\_reference = T)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_stardust\_classes(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_features\_annotation(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} cross\_filter\_stardust(test1, 2, 1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_nebula\_index(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} compute\_spectral\_similarity(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_child\_nebulae(test1, 0.01)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_child\_layouts(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} activate\_nebulae(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# set features quantification data}
\CommentTok{\#\textquotesingle{}   ids \textless{}{-} features\_annotation(test1)$.features\_id}
\CommentTok{\#\textquotesingle{}   quant. \textless{}{-} data.frame(}
\CommentTok{\#\textquotesingle{}     .features\_id = ids,}
\CommentTok{\#\textquotesingle{}     sample\_1 = rnorm(length(ids), 1000, 200),}
\CommentTok{\#\textquotesingle{}     sample\_2 = rnorm(length(ids), 2000, 500)}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   metadata \textless{}{-} data.frame(}
\CommentTok{\#\textquotesingle{}     sample = paste0("sample\_", 1:2),}
\CommentTok{\#\textquotesingle{}     group = c("control", "model")}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   features\_quantification(test1) \textless{}{-} quant.}
\CommentTok{\#\textquotesingle{}   sample\_metadata(test1) \textless{}{-} metadata}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# optional \textquotesingle{}nebula\_name\textquotesingle{}}
\CommentTok{\#\textquotesingle{}   visualize(test1)}
\CommentTok{\#\textquotesingle{}   \#\# a class for example}
\CommentTok{\#\textquotesingle{}   class \textless{}{-} visualize(test1)$class.name[1]}
\CommentTok{\#\textquotesingle{}   tmp \textless{}{-} export\_path(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} annotate\_nebula(test1, class)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# The following can be run before "annotate\_nebula()"}
\CommentTok{\#\textquotesingle{}   \#\# to customize the visualization of nodes.}
\CommentTok{\#\textquotesingle{}   \# test1 \textless{}{-} draw\_structures(test1, "Fatty Acyls")}
\CommentTok{\#\textquotesingle{}   \#\# set parameters for visualization of nodes}
\CommentTok{\#\textquotesingle{}   \# test1 \textless{}{-} draw\_nodes(}
\CommentTok{\#\textquotesingle{}   \#   test1, "Fatty Acyls",}
\CommentTok{\#\textquotesingle{}   \#   add\_id\_text = T,}
\CommentTok{\#\textquotesingle{}   \#   add\_structure = T,}
\CommentTok{\#\textquotesingle{}   \#   add\_ration = T,}
\CommentTok{\#\textquotesingle{}   \#   add\_ppcp = T}
\CommentTok{\#\textquotesingle{}   \# )}
\CommentTok{\#\textquotesingle{}   \# test1 \textless{}{-} annotate\_nebula(test1, class)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# see results}
\CommentTok{\#\textquotesingle{}   ggset \textless{}{-} ggset\_annotate(child\_nebulae(test1))}
\CommentTok{\#\textquotesingle{}   ggset[[class]]}
\CommentTok{\#\textquotesingle{}   \#\# visualize \textquotesingle{}ggset\textquotesingle{}}
\CommentTok{\#\textquotesingle{}   call\_command(ggset[[class]])}
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"annotate\_nebula"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{, }\AttributeTok{nebula\_name =} \StringTok{"character"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, nebula\_name)\{}
            \FunctionTok{.message\_info\_formal}\NormalTok{(}\StringTok{"MCnebula2"}\NormalTok{, }\StringTok{"annotate\_nebula"}\NormalTok{)}
\NormalTok{            data }\OtherTok{\textless{}{-}} \FunctionTok{layout\_ggraph}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))[[nebula\_name]]}
\NormalTok{            data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(data, x, y,}
                                  \AttributeTok{.features\_id =}\NormalTok{ name, }\AttributeTok{size =}\NormalTok{ tani.score)}
\NormalTok{            data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(data, }\AttributeTok{size =} \FunctionTok{ifelse}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(size), .}\DecValTok{2}\NormalTok{, size))}
\NormalTok{            .features\_id }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{.features\_id}
\NormalTok{            x }\OtherTok{\textless{}{-}} \FunctionTok{draw\_structures}\NormalTok{(x, nebula\_name)}
\NormalTok{            x }\OtherTok{\textless{}{-}} \FunctionTok{draw\_nodes}\NormalTok{(x, nebula\_name)}
\NormalTok{            nodes\_grob }\OtherTok{\textless{}{-}} \FunctionTok{nodes\_grob}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))}
\NormalTok{            nodes\_grob }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(.features\_id,}
                                 \ControlFlowTok{function}\NormalTok{(id) \{}
\NormalTok{                                   gridExtra}\SpecialCharTok{::}\FunctionTok{arrangeGrob}\NormalTok{(nodes\_grob[[id]])}
\NormalTok{                                 \})}
\NormalTok{            ggset }\OtherTok{\textless{}{-}} \FunctionTok{ggset}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))[[ nebula\_name ]]}
            \FunctionTok{layers}\NormalTok{(ggset)[[ }\StringTok{"ggraph::geom\_node\_point"}\NormalTok{ ]] }\OtherTok{\textless{}{-}} \ConstantTok{NULL}
            \FunctionTok{ggset\_annotate}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))[[ nebula\_name ]] }\OtherTok{\textless{}{-}} 
              \FunctionTok{add\_layers}\NormalTok{(}\FunctionTok{modify\_annotate\_child}\NormalTok{(ggset),}
                         \FunctionTok{.command\_node\_annotate}\NormalTok{(data, nodes\_grob))}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-methods-backtrack_stardust.r}{%
\section{File: methods-backtrack\_stardust.R}\label{file-methods-backtrack_stardust.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# comparation after filtering; add or remove classes for stardust\_classes}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @aliases backtrack\_stardust}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Recover filtered chemical classses for \textquotesingle{}stardust\_classes\textquotesingle{}}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} These methods used for custom modify chemical classes in \textquotesingle{}stardust\_classes\textquotesingle{}}
\CommentTok{\#\textquotesingle{} data. Users can use the method to recover classes which filtered out by}
\CommentTok{\#\textquotesingle{} [cross\_filter\_stardust()] into \textquotesingle{}stardust\_classes\textquotesingle{} data.}
\CommentTok{\#\textquotesingle{} In addition, users can use the method to delete chemical classes in}
\CommentTok{\#\textquotesingle{} \textquotesingle{}stardust\_classes\textquotesingle{} data.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{backtrack\_stardust(object)\}: get the filtered chemical classes after}
\CommentTok{\#\textquotesingle{} using [cross\_filter\_stardust()].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} Run after [cross\_filter\_stardust()].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @seealso [cross\_filter\_stardust()]}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name backtrack\_stardust{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @order 1}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @exportMethod backtrack\_stardust}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases backtrack\_stardust}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x [mcnebula{-}class] object.}
\CommentTok{\#\textquotesingle{} @param class.name character. The chemical classes name.}
\CommentTok{\#\textquotesingle{} @param rel.index numeric. The index number of chemical classes.}
\CommentTok{\#\textquotesingle{} See columns of \textquotesingle{}rel.index\textquotesingle{} in \textquotesingle{}nebula\_index\textquotesingle{} or \textquotesingle{}stardust\_classes\textquotesingle{}.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @param remove logical. If \textbackslash{}code\{TRUE\}, remove the specified chemical}
\CommentTok{\#\textquotesingle{} classes in \textquotesingle{}stardust\_classes\textquotesingle{} data. If \textbackslash{}code\{FALSE\}, recover the}
\CommentTok{\#\textquotesingle{} data of specified chemical classes into \textquotesingle{}stardust\_classes\textquotesingle{}; the classes}
\CommentTok{\#\textquotesingle{} must in slot \textbackslash{}code\{backtrack(mcn\_dataset(object))\}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname backtrack\_stardust{-}methods}
\CommentTok{\#\textquotesingle{}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"backtrack\_stardust"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"backtrack\_stardust"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \FunctionTok{.message\_info}\NormalTok{(}\StringTok{"backtrack\_stardust"}\NormalTok{, }\StringTok{"no args found"}\NormalTok{,}
                      \StringTok{"}\SpecialCharTok{\textbackslash{}n\textbackslash{}t}\StringTok{get filtered classes"}\NormalTok{)}
\NormalTok{            set }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(}\FunctionTok{backtrack}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(x))[[ }\StringTok{"stardust\_classes"}\NormalTok{ ]],}
                                 \SpecialCharTok{!}\NormalTok{rel.index }\SpecialCharTok{\%in\%} \FunctionTok{stardust\_classes}\NormalTok{(x)[[ }\StringTok{"rel.index"}\NormalTok{ ]])}
\NormalTok{            stat }\OtherTok{\textless{}{-}} \FunctionTok{table}\NormalTok{(set}\SpecialCharTok{$}\NormalTok{rel.index)}
\NormalTok{            df }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}\FunctionTok{data.frame}\NormalTok{(}\AttributeTok{rel.index =} \FunctionTok{as.integer}\NormalTok{(}\FunctionTok{names}\NormalTok{(stat)),}
                                   \AttributeTok{features\_number =} \FunctionTok{as.integer}\NormalTok{(stat)),}
\NormalTok{                        dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(}\FunctionTok{classification}\NormalTok{(x),}
\NormalTok{                                      rel.index, class.name, description),}
                        \AttributeTok{by =} \StringTok{"rel.index"}\NormalTok{, }\AttributeTok{all.x =}\NormalTok{ T)}
\NormalTok{            tibble}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(df)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod backtrack\_stardust}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname backtrack\_stardust{-}methods}
\CommentTok{\#\textquotesingle{}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"backtrack\_stardust"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"backtrack\_stardust"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{,}
                                 \AttributeTok{class.name =} \StringTok{"character"}\NormalTok{,}
                                 \AttributeTok{remove =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, class.name, remove)\{}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{missing}\NormalTok{(remove))}
\NormalTok{              remove }\OtherTok{\textless{}{-}}\NormalTok{ F}
\NormalTok{            rel.index }\OtherTok{\textless{}{-}}
\NormalTok{              dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(}\FunctionTok{classification}\NormalTok{(x),}
\NormalTok{                            class.name }\SpecialCharTok{\%in\%} \SpecialCharTok{!!}\NormalTok{class.name)[[ }\StringTok{"rel.index"}\NormalTok{ ]]}
            \FunctionTok{backtrack\_stardust}\NormalTok{(x, }\AttributeTok{rel.index =}\NormalTok{ rel.index, }\AttributeTok{remove =}\NormalTok{ remove)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod backtrack\_stardust}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname backtrack\_stardust{-}methods}
\CommentTok{\#\textquotesingle{}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"backtrack\_stardust"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"backtrack\_stardust"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{,}
                                 \AttributeTok{rel.index =} \StringTok{"numeric"}\NormalTok{,}
                                 \AttributeTok{remove =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, rel.index, remove)\{}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{missing}\NormalTok{(remove))}
\NormalTok{              remove }\OtherTok{\textless{}{-}}\NormalTok{ F}
            \ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.logical}\NormalTok{(remove))}
              \FunctionTok{stop}\NormalTok{( }\StringTok{"\textasciigrave{}remove\textasciigrave{} must be logical or as missing as \textasciigrave{}FALSE\textasciigrave{}"}\NormalTok{ )}
            \FunctionTok{.message\_info}\NormalTok{(}\StringTok{"backtrack\_stardust"}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(}\StringTok{"remove == "}\NormalTok{, remove))}
            \FunctionTok{.check\_data}\NormalTok{(x, }\FunctionTok{list}\NormalTok{(}\AttributeTok{stardust\_classes =} \StringTok{"create\_stardust\_classes"}\NormalTok{))}
            \ControlFlowTok{if}\NormalTok{ (remove) \{}
              \FunctionTok{reference}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(x))[[ }\StringTok{"stardust\_classes"}\NormalTok{ ]] }\OtherTok{\textless{}{-}} 
\NormalTok{                dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(}\FunctionTok{stardust\_classes}\NormalTok{(x), }\SpecialCharTok{!}\NormalTok{rel.index }\SpecialCharTok{\%in\%} \SpecialCharTok{!!}\NormalTok{rel.index)}
\NormalTok{            \} }\ControlFlowTok{else}\NormalTok{ \{}
              \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(}\FunctionTok{backtrack}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(x))[[ }\StringTok{"stardust\_classes"}\NormalTok{ ]]))}
                \FunctionTok{stop}\NormalTok{( }\StringTok{"nothing in \textasciigrave{}backtrack(mcn\_dataset(x))\textasciigrave{}"}\NormalTok{ )}
\NormalTok{              set }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(}\FunctionTok{backtrack}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(x))[[ }\StringTok{"stardust\_classes"}\NormalTok{ ]],}
\NormalTok{                                   rel.index }\SpecialCharTok{\%in\%} \SpecialCharTok{!!}\NormalTok{rel.index)}
              \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{nrow}\NormalTok{(set) }\SpecialCharTok{==} \DecValTok{0}\NormalTok{)}
                \FunctionTok{stop}\NormalTok{( }\StringTok{"no any record for specified classes in \textasciigrave{}backtrack(mcn\_dataset(x))\textasciigrave{}"}\NormalTok{ )}
              \FunctionTok{reference}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(x))[[ }\StringTok{"stardust\_classes"}\NormalTok{ ]] }\OtherTok{\textless{}{-}} 
\NormalTok{                dplyr}\SpecialCharTok{::}\FunctionTok{distinct}\NormalTok{(dplyr}\SpecialCharTok{::}\FunctionTok{bind\_rows}\NormalTok{(}\FunctionTok{stardust\_classes}\NormalTok{(x), set))}
\NormalTok{            \}}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-methods-compute_spectral_similarity.r}{%
\section{File: methods-compute\_spectral\_similarity.R}\label{file-methods-compute_spectral_similarity.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# compute spectral similarity of features within each nebula}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @aliases compute\_spectral\_similarity}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Compute MS2 spectral similarity}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description These are methods stripped from [MSnbase::compareSpectra].}
\CommentTok{\#\textquotesingle{} The unnecessary parts were removed, [compute\_spectral\_similarity()] only}
\CommentTok{\#\textquotesingle{} calculate the \textquotesingle{}dotproduct\textquotesingle{} for two spectra and get the similarity value.}
\CommentTok{\#\textquotesingle{} It allows faster results for batch comparisons.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name compute\_spectral\_similarity{-}methods}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @seealso [MSnbase::compareSpectra()].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @order 1}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @importFrom pbapply pbapply}
\CommentTok{\#\textquotesingle{} @importFrom pbapply pblapply}
\CommentTok{\#\textquotesingle{} @importFrom pbapply pbmapply}
\CommentTok{\#\textquotesingle{} @exportMethod compute\_spectral\_similarity}
\CommentTok{\#\textquotesingle{} @exportMethod compute\_spectral\_similarity}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{compute\_spectral\_similarity()\}: get the default parameters for the method}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{compute\_spectral\_similarity\}.}
\CommentTok{\#\textquotesingle{} @rdname compute\_spectral\_similarity{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"compute\_spectral\_similarity"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"compute\_spectral\_similarity"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"missing"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{()\{}
            \FunctionTok{list}\NormalTok{(}\AttributeTok{within\_nebula =}\NormalTok{ T,}
                 \AttributeTok{recompute =}\NormalTok{ F}
\NormalTok{            )}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod compute\_spectral\_similarity}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{compute\_spectral\_similarity(x, ...)\}:}
\CommentTok{\#\textquotesingle{} use the default parameters whatever \textquotesingle{}missing\textquotesingle{}}
\CommentTok{\#\textquotesingle{} while performing the method \textbackslash{}code\{compute\_spectral\_similarity\}.}
\CommentTok{\#\textquotesingle{} @rdname compute\_spectral\_similarity{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"compute\_spectral\_similarity"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, within\_nebula, recompute, sp1, sp2)\{}
            \FunctionTok{reCallMethod}\NormalTok{(}\StringTok{"compute\_spectral\_similarity"}\NormalTok{,}
                         \FunctionTok{.fresh\_param}\NormalTok{(}\FunctionTok{compute\_spectral\_similarity}\NormalTok{()))}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod compute\_spectral\_similarity}
\CommentTok{\#\textquotesingle{} @rdname compute\_spectral\_similarity{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"compute\_spectral\_similarity"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"compute\_spectral\_similarity"}\NormalTok{,}
                                 \AttributeTok{sp1 =} \StringTok{"lightSpectrum"}\NormalTok{,}
                                 \AttributeTok{sp2 =} \StringTok{"lightSpectrum"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(sp1, sp2)\{}
            \FunctionTok{compareSpectra}\NormalTok{(sp1, sp2)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod compute\_spectral\_similarity}
\CommentTok{\#\textquotesingle{} @rdname compute\_spectral\_similarity{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"compute\_spectral\_similarity"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"compute\_spectral\_similarity"}\NormalTok{,}
                                 \AttributeTok{sp1 =} \StringTok{"data.frame"}\NormalTok{,}
                                 \AttributeTok{sp2 =} \StringTok{"data.frame"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(sp1, sp2)\{}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{ncol}\NormalTok{(sp1) }\SpecialCharTok{==} \DecValTok{2} \SpecialCharTok{\&} \FunctionTok{ncol}\NormalTok{(sp2) }\SpecialCharTok{==} \DecValTok{2}\NormalTok{) \{}
              \FunctionTok{.message\_info}\NormalTok{(}\StringTok{"compute\_spectral\_similarity"}\NormalTok{, }\StringTok{"ncol(sp) == 2"}\NormalTok{,}
                        \StringTok{"}\SpecialCharTok{\textbackslash{}n\textbackslash{}t}\StringTok{guess columns are c(\textquotesingle{}mz\textquotesingle{}, \textquotesingle{}intensity\textquotesingle{})"}\NormalTok{)}
              \FunctionTok{colnames}\NormalTok{(sp1) }\OtherTok{\textless{}{-}} \FunctionTok{colnames}\NormalTok{(sp2) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"mz"}\NormalTok{, }\StringTok{"intensity"}\NormalTok{)}
\NormalTok{            \} }\ControlFlowTok{else}\NormalTok{ \{}
              \FunctionTok{.message\_info}\NormalTok{(}\StringTok{"compute\_spectral\_similarity"}\NormalTok{, }\StringTok{"ncol(sp) \textgreater{} 2"}\NormalTok{,}
                        \StringTok{"}\SpecialCharTok{\textbackslash{}n\textbackslash{}t}\StringTok{ select columns of c(\textquotesingle{}mz\textquotesingle{}, \textquotesingle{}intensity\textquotesingle{})"}
\NormalTok{              )}
\NormalTok{            \}}
\NormalTok{            sp1 }\OtherTok{\textless{}{-}} \FunctionTok{new}\NormalTok{(}\StringTok{"lightSpectrum"}\NormalTok{, }\AttributeTok{mz =}\NormalTok{ sp1[[ }\StringTok{"mz"}\NormalTok{ ]],}
                       \AttributeTok{intensity =}\NormalTok{ sp1[[ }\StringTok{"intensity"}\NormalTok{ ]])}
\NormalTok{            sp2 }\OtherTok{\textless{}{-}} \FunctionTok{new}\NormalTok{(}\StringTok{"lightSpectrum"}\NormalTok{, }\AttributeTok{mz =}\NormalTok{ sp2[[ }\StringTok{"mz"}\NormalTok{ ]],}
                       \AttributeTok{intensity =}\NormalTok{ sp2[[ }\StringTok{"intensity"}\NormalTok{ ]])}
            \FunctionTok{compareSpectra}\NormalTok{(sp1, sp2)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod compute\_spectral\_similarity}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases compute\_spectral\_similarity}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x [mcnebula{-}class] object.}
\CommentTok{\#\textquotesingle{} @param within\_nebula logical. If \textbackslash{}code\{TRUE\}, }
\CommentTok{\#\textquotesingle{} only \textquotesingle{}features\textquotesingle{} that exist in a Child{-}Nebula are compared}
\CommentTok{\#\textquotesingle{} for spectral similarity. Data of \textquotesingle{}nebula\_index\textquotesingle{} (\textbackslash{}code\{nebula\_index(object)\})}
\CommentTok{\#\textquotesingle{} would be used for assigning and combining the \textquotesingle{}features\textquotesingle{} of comparison.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param recompute logical. If \textbackslash{}code\{TRUE\}, discard the existing data in the object,}
\CommentTok{\#\textquotesingle{} and recompute the spectral similarity.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param sp1 data.frame. An additional channel for comparing two spectrum.}
\CommentTok{\#\textquotesingle{} Contains \textquotesingle{}mz\textquotesingle{} and \textquotesingle{}intensity\textquotesingle{} for spectral comparison.}
\CommentTok{\#\textquotesingle{} @param sp2 data.frame. An additional channel for comparing two spectrum.}
\CommentTok{\#\textquotesingle{} Contains \textquotesingle{}mz\textquotesingle{} and \textquotesingle{}intensity\textquotesingle{} for spectral comparison.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname compute\_spectral\_similarity{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} mcn\_5features}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# the previous steps}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_structure(test)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_reference(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_formula(test1, by\_reference = T)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_stardust\_classes(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_features\_annotation(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} cross\_filter\_stardust(test1, 2, 1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_nebula\_index(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} compute\_spectral\_similarity(test1)}
\CommentTok{\#\textquotesingle{}   \#\# see results}
\CommentTok{\#\textquotesingle{}   spectral\_similarity(test1)}
\CommentTok{\#\textquotesingle{}   \#\# or}
\CommentTok{\#\textquotesingle{}   reference(test1)$spectral\_similarity}
\CommentTok{\#\textquotesingle{}   \#\# or}
\CommentTok{\#\textquotesingle{}   reference(mcn\_dataset(test1))$spectral\_similarity}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# compare the two spectra individually}
\CommentTok{\#\textquotesingle{}   spectra \textless{}{-} latest(test1, "project\_dataset", ".f3\_spectra")}
\CommentTok{\#\textquotesingle{}   data1 \textless{}{-} dplyr::select(}
\CommentTok{\#\textquotesingle{}     dplyr::filter(spectra, .features\_id == "gnps1537"),}
\CommentTok{\#\textquotesingle{}     mz, int.}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   data2 \textless{}{-} dplyr::select(}
\CommentTok{\#\textquotesingle{}     dplyr::filter(spectra, .features\_id == "gnps1539"),}
\CommentTok{\#\textquotesingle{}     mz, int.}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   e1 \textless{}{-} compute\_spectral\_similarity(sp1 = data1, sp2 = data2)}
\CommentTok{\#\textquotesingle{}   e1}
\CommentTok{\#\textquotesingle{}   \# [1] 0.7670297}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# MSnbase}
\CommentTok{\#\textquotesingle{}   if (requireNamespace("MSnbase")) \{}
\CommentTok{\#\textquotesingle{}     MSnbase::compareSpectra}
\CommentTok{\#\textquotesingle{}     spec1 \textless{}{-} new("Spectrum2", mz = data1$mz, intensity = data1$int.)}
\CommentTok{\#\textquotesingle{}     spec2 \textless{}{-} new("Spectrum2", mz = data2$mz, intensity = data2$int.)}
\CommentTok{\#\textquotesingle{}     e2 \textless{}{-} MSnbase::compareSpectra(spec1, spec2, fun = "dotproduct")}
\CommentTok{\#\textquotesingle{}     identical(e1, e2)}
\CommentTok{\#\textquotesingle{}   \}}
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"compute\_spectral\_similarity"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"compute\_spectral\_similarity"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{,}
                                 \AttributeTok{within\_nebula =} \StringTok{"logical"}\NormalTok{,}
                                 \AttributeTok{recompute =} \StringTok{"logical"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, within\_nebula, recompute)\{}
            \FunctionTok{.message\_info\_formal}\NormalTok{(}\StringTok{"MCnebula2"}\NormalTok{, }\StringTok{"compute\_spectral\_similarity"}\NormalTok{)}
            \FunctionTok{.check\_data}\NormalTok{(x, }\FunctionTok{list}\NormalTok{(}\AttributeTok{nebula\_index =} \StringTok{"create\_nebula\_index"}\NormalTok{))}
            \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(}\FunctionTok{spectral\_similarity}\NormalTok{(x))) \{}
              \ControlFlowTok{if}\NormalTok{ (recompute) \{}
                \FunctionTok{.message\_info}\NormalTok{(}\StringTok{"compute\_spectral\_similarity"}\NormalTok{, }\StringTok{"recompute == T"}\NormalTok{)}
\NormalTok{              \} }\ControlFlowTok{else}\NormalTok{ \{}
                \FunctionTok{.message\_info}\NormalTok{(}\StringTok{"compute\_spectral\_similarity"}\NormalTok{, }\StringTok{"recompute == F"}\NormalTok{,}
                          \StringTok{"}\SpecialCharTok{\textbackslash{}n\textbackslash{}t}\StringTok{data already existed."}\NormalTok{)}
                \FunctionTok{return}\NormalTok{(x)}
\NormalTok{              \}}
\NormalTok{            \}}
            \DocumentationTok{\#\# collate spectra}
\NormalTok{            x }\OtherTok{\textless{}{-}} \FunctionTok{collate\_data}\NormalTok{(x, }\StringTok{".f3\_spectra"}\NormalTok{, }\AttributeTok{reference =} \FunctionTok{specific\_candidate}\NormalTok{(x))}
\NormalTok{            all\_spectra }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(}\FunctionTok{latest}\NormalTok{(x, }\StringTok{"project\_dataset"}\NormalTok{, }\StringTok{".f3\_spectra"}\NormalTok{),}
\NormalTok{                                         .features\_id, mz, rel.int.)}
\NormalTok{            lst\_lightSpectrum }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{split}\NormalTok{(all\_spectra, }\SpecialCharTok{\textasciitilde{}}\NormalTok{.features\_id),}
                                        \ControlFlowTok{function}\NormalTok{(df)\{}
                                          \FunctionTok{new}\NormalTok{(}\StringTok{"lightSpectrum"}\NormalTok{, }\AttributeTok{mz =}\NormalTok{ df[[ }\StringTok{"mz"}\NormalTok{ ]],}
                                              \AttributeTok{intensity =}\NormalTok{ df[[ }\StringTok{"rel.int."}\NormalTok{ ]]}
\NormalTok{                                          )}
\NormalTok{                                        \})}
            \DocumentationTok{\#\# combn and compute dotproduct of spectra}
            \ControlFlowTok{if}\NormalTok{ (within\_nebula) \{}
\NormalTok{              combn }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{split}\NormalTok{(}\FunctionTok{nebula\_index}\NormalTok{(x), }\SpecialCharTok{\textasciitilde{}}\NormalTok{ rel.index),}
                              \ControlFlowTok{function}\NormalTok{(df)\{}
                                \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{nrow}\NormalTok{(df) }\SpecialCharTok{\textless{}} \DecValTok{2}\NormalTok{)}
                                  \FunctionTok{return}\NormalTok{()}
                                \FunctionTok{data.frame}\NormalTok{(}\FunctionTok{t}\NormalTok{(}\FunctionTok{combn}\NormalTok{(df[[ }\StringTok{".features\_id"}\NormalTok{ ]], }\DecValTok{2}\NormalTok{)))}
\NormalTok{                              \})}
\NormalTok{              combn }\OtherTok{\textless{}{-}} \FunctionTok{t}\NormalTok{(}\FunctionTok{apply}\NormalTok{(data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(combn), }\DecValTok{1}\NormalTok{, sort))}
\NormalTok{            \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{              combn }\OtherTok{\textless{}{-}} \FunctionTok{t}\NormalTok{(}\FunctionTok{combn}\NormalTok{(}\FunctionTok{unique}\NormalTok{(}\FunctionTok{nebula\_index}\NormalTok{(x)[[ }\StringTok{".features\_id"}\NormalTok{ ]]), }\DecValTok{2}\NormalTok{))}
\NormalTok{            \}}
\NormalTok{            combn }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{rename}\NormalTok{(dplyr}\SpecialCharTok{::}\FunctionTok{distinct}\NormalTok{(}\FunctionTok{data.frame}\NormalTok{(combn)),}
                                   \AttributeTok{.features\_id1 =} \DecValTok{1}\NormalTok{, }\AttributeTok{.features\_id2 =} \DecValTok{2}\NormalTok{)}
            \FunctionTok{.message\_info}\NormalTok{(}\StringTok{"compute\_spectral\_similarity"}\NormalTok{, }\StringTok{"compareSpectra"}\NormalTok{)}
\NormalTok{            combn[[ }\StringTok{"similarity"}\NormalTok{ ]] }\OtherTok{\textless{}{-}}
\NormalTok{              pbapply}\SpecialCharTok{::}\FunctionTok{pbapply}\NormalTok{(combn, }\DecValTok{1}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(vec)\{}
                                 \FunctionTok{compareSpectra}\NormalTok{(lst\_lightSpectrum[[ vec[}\DecValTok{1}\NormalTok{] ]],}
\NormalTok{                                                lst\_lightSpectrum[[ vec[}\DecValTok{2}\NormalTok{] ]])}
\NormalTok{                                   \})}
            \DocumentationTok{\#\# compute ionMass difference}
            \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(}\FunctionTok{features\_annotation}\NormalTok{(x))) \{}
\NormalTok{              mz }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(}\FunctionTok{features\_annotation}\NormalTok{(x),}
\NormalTok{                                  .features\_id, mz, rt.secound)}
\NormalTok{              combn }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(combn,}
\NormalTok{                             dplyr}\SpecialCharTok{::}\FunctionTok{rename}\NormalTok{(mz, }\AttributeTok{.features\_id2 =}\NormalTok{ .features\_id,}
                                           \AttributeTok{mz2 =}\NormalTok{ mz, }\AttributeTok{rt.secound2 =}\NormalTok{ rt.secound),}
                             \AttributeTok{by =} \StringTok{".features\_id2"}\NormalTok{, }\AttributeTok{all.x =}\NormalTok{ T)}
\NormalTok{              combn }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(combn,}
\NormalTok{                             dplyr}\SpecialCharTok{::}\FunctionTok{rename}\NormalTok{(mz, }\AttributeTok{.features\_id1 =}\NormalTok{ .features\_id,}
                                           \AttributeTok{mz1 =}\NormalTok{ mz, }\AttributeTok{rt.secound1 =}\NormalTok{ rt.secound),}
                             \AttributeTok{by =} \StringTok{".features\_id1"}\NormalTok{, }\AttributeTok{all.x =}\NormalTok{ T)}
\NormalTok{              combn }\OtherTok{\textless{}{-}}
\NormalTok{                dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(combn,}
                                            \AttributeTok{mass\_difference =}\NormalTok{ mz2 }\SpecialCharTok{{-}}\NormalTok{ mz1,}
                                            \AttributeTok{rt.min\_difference =} 
                                              \FunctionTok{round}\NormalTok{((rt.secound2 }\SpecialCharTok{{-}}\NormalTok{ rt.secound1) }\SpecialCharTok{/} \DecValTok{60}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\NormalTok{                                            ),}
                              \SpecialCharTok{{-}}\NormalTok{mz1, }\SpecialCharTok{{-}}\NormalTok{mz2, }\SpecialCharTok{{-}}\NormalTok{rt.secound1, }\SpecialCharTok{{-}}\NormalTok{rt.secound2)}
\NormalTok{            \}}
            \FunctionTok{reference}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(x))[[ }\StringTok{"spectral\_similarity"}\NormalTok{ ]] }\OtherTok{\textless{}{-}}
\NormalTok{              dplyr}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(combn)}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-methods-create_child_layouts.r}{%
\section{File: methods-create\_child\_layouts.R}\label{file-methods-create_child_layouts.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# \# ==========================================================================}
\CommentTok{\# for creating child layout, these layouts includes:}
\CommentTok{\# layouts for nodes position of ggraph (layout\_ggraph slot);}
\CommentTok{\# layouts of size and position of grid panel (grid\_layout slot);}
\CommentTok{\# layouts of viewports of each child\_nebula (in which grid panel) (viewports slot).}
\CommentTok{\# layout of viewport of panel of overall child\_nebulae (panel\_viewport slot);}
\CommentTok{\# layout of viewport of legend of child\_nebulae (legend\_viewport slot).}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @aliases create\_child\_layouts}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Create layouts for visualization of Child{-}Nebulae}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} Create visual style of Child{-}Nebulae.}
\CommentTok{\#\textquotesingle{} The \textquotesingle{}style\textquotesingle{} means a variety of layouts for drawing the networks}
\CommentTok{\#\textquotesingle{} (i.e. all Child{-}Nebulae). See details.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @details}
\CommentTok{\#\textquotesingle{} This method provides a flexible way to draw Child{-}Nebulae.}
\CommentTok{\#\textquotesingle{} Users can create visual style based on default parameters.}
\CommentTok{\#\textquotesingle{} For experienced users of \textquotesingle{}grid\textquotesingle{} package,}
\CommentTok{\#\textquotesingle{} the related functions such as [grid::grid.layout()], [grid::viewport()]}
\CommentTok{\#\textquotesingle{} can be used to create customized visualizations.}
\CommentTok{\#\textquotesingle{} The layouts for visualization of Child{-}Nebulae include:}
\CommentTok{\#\textquotesingle{} {-} nodes position: \textbackslash{}code\{layout\_ggraph\}}
\CommentTok{\#\textquotesingle{} {-} size and position of grid panel: \textbackslash{}code\{grid\_layout\}}
\CommentTok{\#\textquotesingle{} {-} size and position of each Child{-}Nebula (inside the panel): \textbackslash{}code\{viewports\}}
\CommentTok{\#\textquotesingle{} {-} size and position of overall Child{-}Nebulae: \textbackslash{}code\{panel\_viewport\}}
\CommentTok{\#\textquotesingle{} {-} size and position of overall legend: \textbackslash{}code\{legend\_viewport\}}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name create\_child\_layouts{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @seealso [grid::viewport()], [grid::grid.layout()],}
\CommentTok{\#\textquotesingle{} [ggraph::create\_layout()]...}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @order 1}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @importFrom grid grid.layout}
\CommentTok{\#\textquotesingle{} @importFrom grid viewport}
\CommentTok{\#\textquotesingle{} @importFrom grid pushViewport}
\CommentTok{\#\textquotesingle{} @importFrom dplyr desc}
\CommentTok{\#\textquotesingle{} @importFrom dplyr arrange}
\CommentTok{\#\textquotesingle{} @importFrom dplyr select}
\CommentTok{\#\textquotesingle{} @exportMethod create\_child\_layouts}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{create\_child\_layouts()\}: get the function for generating}
\CommentTok{\#\textquotesingle{} default parameters for the method}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{create\_child\_layouts\}.}
\CommentTok{\#\textquotesingle{} @rdname create\_child\_layouts{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"create\_child\_layouts"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"create\_child\_layouts"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"missing"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{()\{}
            \ControlFlowTok{function}\NormalTok{(x)\{}
              \FunctionTok{.check\_data}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x), }\FunctionTok{list}\NormalTok{(}\AttributeTok{igraph =} \StringTok{"create\_child\_nebulae"}\NormalTok{))}
\NormalTok{              len }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(}\FunctionTok{igraph}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x)))}
\NormalTok{              ggraph\_layouts }\OtherTok{\textless{}{-}}
                \FunctionTok{vapply}\NormalTok{(}\FunctionTok{igraph}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x)), .propose\_graph\_layout, }\StringTok{"ch"}\NormalTok{)}
\NormalTok{              seeds }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, len)}
\NormalTok{              ncol }\OtherTok{\textless{}{-}} \FunctionTok{round}\NormalTok{(}\FunctionTok{sqrt}\NormalTok{(len))}
              \ControlFlowTok{if}\NormalTok{ (ncol }\SpecialCharTok{\^{}} \DecValTok{2} \SpecialCharTok{\textless{}}\NormalTok{ len) \{}
\NormalTok{                nrow }\OtherTok{\textless{}{-}}\NormalTok{ ncol }\SpecialCharTok{+} \DecValTok{1}
\NormalTok{              \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{                nrow }\OtherTok{\textless{}{-}}\NormalTok{ ncol}
\NormalTok{              \}}
\NormalTok{              grid\_layout }\OtherTok{\textless{}{-}}\NormalTok{ grid}\SpecialCharTok{::}\FunctionTok{grid.layout}\NormalTok{(nrow, ncol)}
\NormalTok{              num\_grid }\OtherTok{\textless{}{-}}\NormalTok{ grid\_layout}\SpecialCharTok{$}\NormalTok{nrow }\SpecialCharTok{*}\NormalTok{ grid\_layout}\SpecialCharTok{$}\NormalTok{ncol}
              \ControlFlowTok{if}\NormalTok{ (num\_grid }\SpecialCharTok{\textless{}}\NormalTok{ len) \{}
                \FunctionTok{stop}\NormalTok{( }\StringTok{"\textasciigrave{}grid\_layout\textasciigrave{} must contains enough sub{-}panels for child\_nebulae."}\NormalTok{ )}
\NormalTok{              \}}
\NormalTok{              names }\OtherTok{\textless{}{-}} \FunctionTok{as.character}\NormalTok{(}\FunctionTok{sort}\NormalTok{(}\FunctionTok{factor}\NormalTok{(}\FunctionTok{names}\NormalTok{(}\FunctionTok{igraph}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))),}
                                                \AttributeTok{levels =} \FunctionTok{hierarchy}\NormalTok{(x)}\SpecialCharTok{$}\NormalTok{class.name)))}
\NormalTok{              mtrx }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\FunctionTok{c}\NormalTok{(names, }\FunctionTok{rep}\NormalTok{(}\StringTok{"...FILL"}\NormalTok{, num\_grid }\SpecialCharTok{{-}}\NormalTok{ len)),}
                             \AttributeTok{ncol =}\NormalTok{ grid\_layout}\SpecialCharTok{$}\NormalTok{ncol, }\AttributeTok{byrow =}\NormalTok{ T)}
\NormalTok{              viewports }\OtherTok{\textless{}{-}}
                \FunctionTok{unlist}\NormalTok{(}\AttributeTok{recursive =}\NormalTok{ F,}
                       \FunctionTok{mapply}\NormalTok{(}\FunctionTok{apply}\NormalTok{(mtrx, }\DecValTok{1}\NormalTok{, c, }\AttributeTok{simplify =}\NormalTok{ F), }\DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(mtrx),}
                              \AttributeTok{SIMPLIFY =}\NormalTok{ F,}
                              \AttributeTok{FUN =} \ControlFlowTok{function}\NormalTok{(names, row) \{}
                                \FunctionTok{lapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(names),}
                                       \ControlFlowTok{function}\NormalTok{(n) \{}
\NormalTok{                                         grid}\SpecialCharTok{::}\FunctionTok{viewport}\NormalTok{(}\AttributeTok{layout =}\NormalTok{ grid\_layout,}
                                                        \AttributeTok{layout.pos.row =}\NormalTok{ row,}
                                                        \AttributeTok{layout.pos.col =}\NormalTok{ n)}
\NormalTok{                                       \})}
\NormalTok{                              \}))[}\DecValTok{1}\SpecialCharTok{:}\NormalTok{len]}
              \FunctionTok{names}\NormalTok{(viewports) }\OtherTok{\textless{}{-}}\NormalTok{ names}
\NormalTok{              panel\_viewport }\OtherTok{\textless{}{-}}
\NormalTok{                grid}\SpecialCharTok{::}\FunctionTok{viewport}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\FloatTok{0.8}\NormalTok{, }\DecValTok{1}\NormalTok{, }\AttributeTok{just =} \FunctionTok{c}\NormalTok{(}\StringTok{"left"}\NormalTok{, }\StringTok{"centre"}\NormalTok{))}
\NormalTok{              legend\_viewport }\OtherTok{\textless{}{-}} 
\NormalTok{                grid}\SpecialCharTok{::}\FunctionTok{viewport}\NormalTok{(}\FloatTok{0.8}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\FloatTok{0.2}\NormalTok{, }\DecValTok{1}\NormalTok{, }\AttributeTok{just =} \FunctionTok{c}\NormalTok{(}\StringTok{"left"}\NormalTok{, }\StringTok{"centre"}\NormalTok{))}
              \FunctionTok{list}\NormalTok{(}\AttributeTok{ggraph\_layouts =}\NormalTok{ ggraph\_layouts,}
                   \AttributeTok{seeds =}\NormalTok{ seeds,}
                   \AttributeTok{grid\_layout =}\NormalTok{ grid\_layout,}
                   \AttributeTok{viewports =}\NormalTok{ viewports,}
                   \AttributeTok{panel\_viewport =}\NormalTok{ panel\_viewport,}
                   \AttributeTok{legend\_viewport =}\NormalTok{ legend\_viewport}
\NormalTok{              )}
\NormalTok{            \}}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod create\_child\_layouts}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases create\_child\_layouts}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{create\_child\_layouts(x, ...)\}:}
\CommentTok{\#\textquotesingle{} use the default parameters whatever \textquotesingle{}missing\textquotesingle{}}
\CommentTok{\#\textquotesingle{} while performing the method \textbackslash{}code\{create\_child\_layouts\}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x [mcnebula{-}class] object.}
\CommentTok{\#\textquotesingle{} @param ggraph\_layouts character with names or not.}
\CommentTok{\#\textquotesingle{} If with names, the names should be chemical classes in \textquotesingle{}nebula\_index\textquotesingle{} data.}
\CommentTok{\#\textquotesingle{} The names used to specify layout for all or partial Child{-}Nebulae.}
\CommentTok{\#\textquotesingle{} The value, see [ggraph::create\_layout()].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param seeds numeric with names or not. The names, see parameter}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{ggraph\_layouts\}. The values would passed to [set.seed()]}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param grid\_layout \textquotesingle{}layout\textquotesingle{} object. Create by [grid::grid.layout()].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param viewports list with names or not.}
\CommentTok{\#\textquotesingle{} Each element is a \textquotesingle{}viewport\textquotesingle{} object create by [grid::viewport()]}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param panel\_viewport \textquotesingle{}viewport\textquotesingle{} object.}
\CommentTok{\#\textquotesingle{} Describe the size and position for drawing overall Child{-}Nebulae (panel).}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param legend\_viewport \textquotesingle{}viewport\textquotesingle{} object.}
\CommentTok{\#\textquotesingle{} Describe the size and position for drawing legend of Child{-}Nebulae.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname create\_child\_layouts{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} mcn\_5features}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# the previous steps}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_structure(test)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_reference(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_formula(test1, by\_reference = T)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_stardust\_classes(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_features\_annotation(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} cross\_filter\_stardust(test1, 2, 1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_nebula\_index(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} compute\_spectral\_similarity(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_child\_nebulae(test1, 0.01)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# function to generate default parameters}
\CommentTok{\#\textquotesingle{}   create\_child\_layouts()}
\CommentTok{\#\textquotesingle{}   \#\# default parameters}
\CommentTok{\#\textquotesingle{}   create\_child\_layouts()(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_child\_layouts(test1)}
\CommentTok{\#\textquotesingle{}   \#\# see results (a object for \textquotesingle{}ggraph\textquotesingle{} package to visualization)}
\CommentTok{\#\textquotesingle{}   lapply(}
\CommentTok{\#\textquotesingle{}     layout\_ggraph(child\_nebulae(test1)),}
\CommentTok{\#\textquotesingle{}     tibble::as\_tibble}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"create\_child\_layouts"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, ggraph\_layouts, seeds,}
\NormalTok{                   grid\_layout, viewports,}
\NormalTok{                   panel\_viewport, legend\_viewport)\{}
            \FunctionTok{.message\_info\_formal}\NormalTok{(}\StringTok{"MCnebula2"}\NormalTok{, }\StringTok{"create\_child\_layouts"}\NormalTok{)}
            \FunctionTok{do.call}\NormalTok{(.create\_child\_layouts,}
                    \FunctionTok{.fresh\_param}\NormalTok{(}\FunctionTok{create\_child\_layouts}\NormalTok{()(x)))}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @importFrom tidygraph activate}
\NormalTok{.create\_child\_layouts }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(x, ggraph\_layouts, seeds,}
\NormalTok{           grid\_layout, viewports,}
\NormalTok{           panel\_viewport, legend\_viewport}
\NormalTok{           )\{}
\NormalTok{    set }\OtherTok{\textless{}{-}} \FunctionTok{igraph}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))}
\NormalTok{    ggraph\_layouts }\OtherTok{\textless{}{-}} \FunctionTok{.as\_dic}\NormalTok{(ggraph\_layouts, }\FunctionTok{names}\NormalTok{(set), }\AttributeTok{fill =}\NormalTok{ F)}
\NormalTok{    seeds }\OtherTok{\textless{}{-}} \FunctionTok{.as\_dic}\NormalTok{(seeds, }\FunctionTok{names}\NormalTok{(set))}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(grid\_layout))}
      \FunctionTok{.check\_class}\NormalTok{(grid\_layout)}
    \FunctionTok{.check\_names}\NormalTok{(viewports, set, }\StringTok{"viewports"}\NormalTok{, }\StringTok{"igraph(child\_nebulae(x))"}\NormalTok{)}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(viewports) }\SpecialCharTok{!=} \FunctionTok{length}\NormalTok{(set)) \{}
      \FunctionTok{stop}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"\textasciigrave{}viewports\textasciigrave{} must be a list "}\NormalTok{,}
                  \StringTok{"the same length as \textquotesingle{}igraph(child\_nebulae(x))\textquotesingle{}."}\NormalTok{))}
\NormalTok{    \}}
\NormalTok{    viewports }\OtherTok{\textless{}{-}} \FunctionTok{.as\_dic}\NormalTok{(viewports, }\FunctionTok{names}\NormalTok{(set), }\AttributeTok{fill =}\NormalTok{ F)}
    \FunctionTok{.check\_class}\NormalTok{(panel\_viewport, }\StringTok{"viewport"}\NormalTok{, }\StringTok{"grid::viewport"}\NormalTok{)}
    \FunctionTok{.check\_class}\NormalTok{(legend\_viewport, }\StringTok{"viewport"}\NormalTok{, }\StringTok{"grid::viewport"}\NormalTok{)}
    \FunctionTok{tbl\_graph}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x)) }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(set,}
      \ControlFlowTok{function}\NormalTok{(igraph) \{}
\NormalTok{        tbl }\OtherTok{\textless{}{-}}\NormalTok{ tidygraph}\SpecialCharTok{::}\FunctionTok{as\_tbl\_graph}\NormalTok{(igraph)}
\NormalTok{        edges }\OtherTok{\textless{}{-}}\NormalTok{ tibble}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(tidygraph}\SpecialCharTok{::}\FunctionTok{activate}\NormalTok{(tbl, }\StringTok{"edges"}\NormalTok{))}
        \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{nrow}\NormalTok{(edges) }\SpecialCharTok{==} \DecValTok{0}\NormalTok{) \{}
\NormalTok{          tbl }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(}
\NormalTok{            tidygraph}\SpecialCharTok{::}\FunctionTok{activate}\NormalTok{(tbl, }\StringTok{"edges"}\NormalTok{), }\AttributeTok{similarity =} \FunctionTok{double}\NormalTok{(}\DecValTok{0}\NormalTok{),}
            \AttributeTok{mass\_difference =} \FunctionTok{double}\NormalTok{(}\DecValTok{0}\NormalTok{), }\AttributeTok{rt.min\_difference =} \FunctionTok{double}\NormalTok{(}\DecValTok{0}\NormalTok{)}
\NormalTok{          )}
\NormalTok{        \}}
        \FunctionTok{return}\NormalTok{(tbl)}
\NormalTok{      \}}
\NormalTok{    )}
    \FunctionTok{layout\_ggraph}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x)) }\OtherTok{\textless{}{-}}
      \FunctionTok{lapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(}\FunctionTok{tbl\_graph}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))),}
             \ControlFlowTok{function}\NormalTok{(name)\{}
\NormalTok{               layout }\OtherTok{\textless{}{-}}\NormalTok{ ggraph\_layouts[[name]]}
               \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(layout))}
\NormalTok{                 layout }\OtherTok{\textless{}{-}} \FunctionTok{.propose\_graph\_layout}\NormalTok{(graph)}
               \FunctionTok{set.seed}\NormalTok{(seeds[[name]])}
\NormalTok{               ggraph}\SpecialCharTok{::}\FunctionTok{create\_layout}\NormalTok{(}\FunctionTok{tbl\_graph}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))[[ name ]],}
                                     \AttributeTok{layout =}\NormalTok{ layout)}
\NormalTok{             \})}
    \FunctionTok{names}\NormalTok{(}\FunctionTok{layout\_ggraph}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))) }\OtherTok{\textless{}{-}}
      \FunctionTok{names}\NormalTok{(}\FunctionTok{tbl\_graph}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x)))}
    \FunctionTok{grid\_layout}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x)) }\OtherTok{\textless{}{-}}\NormalTok{ grid\_layout}
    \FunctionTok{viewports}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x)) }\OtherTok{\textless{}{-}}\NormalTok{ viewports}
    \FunctionTok{panel\_viewport}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x)) }\OtherTok{\textless{}{-}}\NormalTok{ panel\_viewport}
    \FunctionTok{legend\_viewport}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x)) }\OtherTok{\textless{}{-}}\NormalTok{ legend\_viewport}
    \FunctionTok{return}\NormalTok{(x)}
\NormalTok{  \}}

\NormalTok{.propose\_graph\_layout }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(graph)\{}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(graph) }\SpecialCharTok{\textgreater{}=} \DecValTok{300} \SpecialCharTok{|} \FunctionTok{length}\NormalTok{(graph) }\SpecialCharTok{\textless{}=} \DecValTok{10}\NormalTok{)}
      \StringTok{"kk"}
    \ControlFlowTok{else}
      \StringTok{"fr"}
\NormalTok{  \}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-methods-create_child_nebulae.r}{%
\section{File: methods-create\_child\_nebulae.R}\label{file-methods-create_child_nebulae.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# use features annotation and spectral similarity data to create network}
\CommentTok{\# for child{-}nebula}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @aliases create\_child\_nebulae}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Gather data to create Child{-}Nebulae}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} Similar to [create\_parent\_nebula()], gather \textquotesingle{}spectral\_similarity\textquotesingle{} data and}
\CommentTok{\#\textquotesingle{} and \textquotesingle{}features\_annotation\textquotesingle{} data; but additionally, use \textquotesingle{}nebula\_index\textquotesingle{} data}
\CommentTok{\#\textquotesingle{} to group \textquotesingle{}features\textquotesingle{} by chemical classes. Each chemical classes in \textquotesingle{}nebula\_index\textquotesingle{}}
\CommentTok{\#\textquotesingle{} data would lead to a \textquotesingle{}igraph\textquotesingle{} object.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @seealso [compute\_spectral\_similarity()], [create\_features\_annotation()],}
\CommentTok{\#\textquotesingle{} [create\_nebula\_index()],}
\CommentTok{\#\textquotesingle{} [igraph::graph\_from\_data\_frame()].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name create\_child\_nebulae{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @order 1}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @exportMethod create\_child\_nebulae}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{create\_child\_nebulae()\}: get the default parameters for the method}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{create\_child\_nebulae\}.}
\CommentTok{\#\textquotesingle{} @rdname create\_child\_nebulae{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"create\_child\_nebulae"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"create\_child\_nebulae"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{()\{}
            \FunctionTok{list}\NormalTok{(}\AttributeTok{edge\_cutoff =} \FloatTok{0.5}\NormalTok{,}
                 \AttributeTok{max\_edge\_number =} \DecValTok{5}\NormalTok{,}
                 \AttributeTok{use\_tracer =}\NormalTok{ T)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod create\_child\_nebulae}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{create\_child\_nebulae(x, ...)\}:}
\CommentTok{\#\textquotesingle{} use the default parameters whatever \textquotesingle{}missing\textquotesingle{}}
\CommentTok{\#\textquotesingle{} while performing the method \textbackslash{}code\{create\_child\_nebulae\}.}
\CommentTok{\#\textquotesingle{} @rdname create\_child\_nebulae{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"create\_child\_nebulae"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, edge\_cutoff, max\_edge\_number, use\_tracer)\{}
            \FunctionTok{reCallMethod}\NormalTok{(}\StringTok{"create\_child\_nebulae"}\NormalTok{,}
                         \FunctionTok{.fresh\_param}\NormalTok{(}\FunctionTok{create\_child\_nebulae}\NormalTok{()))}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod create\_child\_nebulae}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases create\_child\_nebulae}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x [mcnebula{-}class] object.}
\CommentTok{\#\textquotesingle{} @param edge\_cutoff numeric(1). Value in (0,1). Set a threshold to}
\CommentTok{\#\textquotesingle{} create edges upon similarity value of \textquotesingle{}spectral\_similarity\textquotesingle{} data.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param max\_edge\_number numeric(1).}
\CommentTok{\#\textquotesingle{} For nodes (features) in each Child{-}Nebulae (i.e. network), the maximum number of}
\CommentTok{\#\textquotesingle{} edges link with. If the number exceeds the limitation, only edges representing higher}
\CommentTok{\#\textquotesingle{} spectral similarity would be retained.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param use\_tracer logical.}
\CommentTok{\#\textquotesingle{} If \textbackslash{}code\{TRUE\}, \textquotesingle{}tracer\textquotesingle{} in \textquotesingle{}nebula\_index\textquotesingle{} data would be used to filter out}
\CommentTok{\#\textquotesingle{} Child{-}Nebulae: a Child{-}Nebula without any \textquotesingle{}feature\textquotesingle{} being marked as \textquotesingle{}tracer\textquotesingle{},}
\CommentTok{\#\textquotesingle{} this Child{-}Nebula would be filtered out. See [create\_nebula\_index()].}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @rdname create\_child\_nebulae{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} mcn\_5features}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# the previous steps}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_structure(test)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_reference(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_formula(test1, by\_reference = T)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_stardust\_classes(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_features\_annotation(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} cross\_filter\_stardust(test1, 2, 1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_nebula\_index(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} compute\_spectral\_similarity(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# default parameters}
\CommentTok{\#\textquotesingle{}   create\_child\_nebulae()}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_child\_nebulae(test1, 0.01)}
\CommentTok{\#\textquotesingle{}   \#\# see results}
\CommentTok{\#\textquotesingle{}   igraph(child\_nebulae(test1))}
\CommentTok{\#\textquotesingle{}   \#\# write output for \textquotesingle{}Cytoscape\textquotesingle{} or other network software}
\CommentTok{\#\textquotesingle{}   tmp \textless{}{-} paste0(tempdir(), "/child\_nebulae/")}
\CommentTok{\#\textquotesingle{}   dir.create(tmp)}
\CommentTok{\#\textquotesingle{}   res \textless{}{-} igraph(child\_nebulae(test1))}
\CommentTok{\#\textquotesingle{}   lapply(}
\CommentTok{\#\textquotesingle{}     names(res),}
\CommentTok{\#\textquotesingle{}     function(name) \{}
\CommentTok{\#\textquotesingle{}       igraph::write\_graph(}
\CommentTok{\#\textquotesingle{}         res[[name]],}
\CommentTok{\#\textquotesingle{}         file = paste0(tmp, name, ".graphml"),}
\CommentTok{\#\textquotesingle{}         format = "graphml"}
\CommentTok{\#\textquotesingle{}       )}
\CommentTok{\#\textquotesingle{}     \}}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   list.files(tmp)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   unlink(tmp, T, T)}
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"create\_child\_nebulae"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"create\_child\_nebulae"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{,}
                                 \AttributeTok{edge\_cutoff =} \StringTok{"numeric"}\NormalTok{,}
                                 \AttributeTok{max\_edge\_number =} \StringTok{"numeric"}\NormalTok{,}
                                 \AttributeTok{use\_tracer =} \StringTok{"logical"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, edge\_cutoff, max\_edge\_number, use\_tracer)\{}
            \FunctionTok{.message\_info\_formal}\NormalTok{(}\StringTok{"MCnebula2"}\NormalTok{, }\StringTok{"create\_child\_nebulae"}\NormalTok{)}
            \FunctionTok{.check\_data}\NormalTok{(x, }\FunctionTok{list}\NormalTok{(}\AttributeTok{features\_annotation =} \StringTok{"create\_features\_annotation"}\NormalTok{,}
                                \AttributeTok{spectral\_similarity =} \StringTok{"compute\_spectral\_similarity"}\NormalTok{,}
                                \AttributeTok{nebula\_index =} \StringTok{"create\_nebula\_index"}
\NormalTok{                                ))}
            \ControlFlowTok{if}\NormalTok{ (max\_edge\_number }\SpecialCharTok{\textless{}} \DecValTok{1}\NormalTok{) \{}
              \FunctionTok{stop}\NormalTok{( }\StringTok{"\textasciigrave{}max\_edge\_number\textasciigrave{} must be a numeric greater or equal to 1"}\NormalTok{ )}
\NormalTok{            \}}
\NormalTok{            features }\OtherTok{\textless{}{-}} \FunctionTok{features\_annotation}\NormalTok{(x)}
\NormalTok{            edges }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(}\FunctionTok{spectral\_similarity}\NormalTok{(x),}
\NormalTok{                                   similarity }\SpecialCharTok{\textgreater{}=}\NormalTok{ edge\_cutoff)}
            \ControlFlowTok{if}\NormalTok{ (use\_tracer }\SpecialCharTok{\&} \FunctionTok{is.logical}\NormalTok{(}\FunctionTok{nebula\_index}\NormalTok{(x)[[ }\StringTok{"tracer"}\NormalTok{ ]])) \{}
\NormalTok{              classes }\OtherTok{\textless{}{-}} \FunctionTok{unique}\NormalTok{(dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(}\FunctionTok{nebula\_index}\NormalTok{(x), tracer)}\SpecialCharTok{$}\NormalTok{class.name)}
\NormalTok{              nebula\_index }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(}\FunctionTok{nebula\_index}\NormalTok{(x), class.name }\SpecialCharTok{\%in\%}\NormalTok{ classes)}
\NormalTok{            \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{              nebula\_index }\OtherTok{\textless{}{-}} \FunctionTok{nebula\_index}\NormalTok{(x)}
\NormalTok{            \}}
            \FunctionTok{igraph}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x)) }\OtherTok{\textless{}{-}}
              \FunctionTok{lapply}\NormalTok{(}\FunctionTok{split}\NormalTok{(nebula\_index, }\SpecialCharTok{\textasciitilde{}}\NormalTok{ class.name),}
                     \ControlFlowTok{function}\NormalTok{(meta) \{}
\NormalTok{                       features }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(features, .features\_id }\SpecialCharTok{\%in\%}
\NormalTok{                                                 meta}\SpecialCharTok{$}\NormalTok{.features\_id)}
\NormalTok{                       edges }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(edges, .features\_id1 }\SpecialCharTok{\%in\%}\NormalTok{ meta}\SpecialCharTok{$}\NormalTok{.features\_id }\SpecialCharTok{\&}
\NormalTok{                                              .features\_id2 }\SpecialCharTok{\%in\%}\NormalTok{ meta}\SpecialCharTok{$}\NormalTok{.features\_id)}
                       \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{nrow}\NormalTok{(edges) }\SpecialCharTok{\textgreater{}}\NormalTok{ max\_edge\_number) \{}
\NormalTok{                         edges }\OtherTok{\textless{}{-}} \FunctionTok{.decrease\_edges}\NormalTok{(edges, max\_edge\_number)}
\NormalTok{                       \}}
\NormalTok{                       igraph}\SpecialCharTok{::}\FunctionTok{graph\_from\_data\_frame}\NormalTok{(edges, }\AttributeTok{directed =}\NormalTok{ T,}
                                                     \AttributeTok{vertices =}\NormalTok{ features)}
\NormalTok{                     \})}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-methods-create_features_annotation.r}{%
\section{File: methods-create\_features\_annotation.R}\label{file-methods-create_features_annotation.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# create features annotation data.frame, involves formula and structure,}
\CommentTok{\# based on \textasciigrave{}specific\_candidate\textasciigrave{}}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @aliases create\_features\_annotation}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title merge annotation for \textquotesingle{}features\textquotesingle{}}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} According to \textbackslash{}code\{specific\_candidate(object)\} data, merge the latest}
\CommentTok{\#\textquotesingle{} filtered chemical formulae annotation, structural annotation. The ion mass}
\CommentTok{\#\textquotesingle{} and retention time for each \textquotesingle{}feature\textquotesingle{} would also be gathered.}
\CommentTok{\#\textquotesingle{} User can also pass custom annotation for each \textquotesingle{}feature\textquotesingle{}, as long as the}
\CommentTok{\#\textquotesingle{} \textquotesingle{}data.frame\textquotesingle{} with column of \textquotesingle{}.features\_id\textquotesingle{}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @details}
\CommentTok{\#\textquotesingle{} The \textquotesingle{}features\_annotation\textquotesingle{} data created from:}
\CommentTok{\#\textquotesingle{} {-} The \textquotesingle{}specific\_candidate\textquotesingle{} data: \textbackslash{}code\{specific\_candidate(object)\}}
\CommentTok{\#\textquotesingle{} {-} The filtered chemical formula data: \textbackslash{}code\{latest(object, subscript = ".f2\_formula")\}}
\CommentTok{\#\textquotesingle{} {-} The filtered structural data: \textbackslash{}code\{latest(object, subscript = ".f3\_fingerid")\}}
\CommentTok{\#\textquotesingle{} {-} The ion mass and retention time (m/z and RT): latest(object, "project\_dataset", ".f2\_info")}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} The last would be collated via: \textbackslash{}code\{collate\_data(object, subscript = ".f2\_info")\}}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @name create\_features\_annotation{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @order 1}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @exportMethod create\_features\_annotation}
\CommentTok{\#\textquotesingle{} @rdname create\_features\_annotation{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"create\_features\_annotation"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"create\_features\_annotation"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{,}
                                 \AttributeTok{extra\_data =} \StringTok{"data.frame"}\NormalTok{,}
                                 \AttributeTok{column =} \StringTok{"numeric"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, extra\_data, column)\{}
            \FunctionTok{colnames}\NormalTok{(extra\_data)[column] }\OtherTok{\textless{}{-}} \StringTok{".features\_id"}
            \FunctionTok{create\_features\_annotation}\NormalTok{(x, extra\_data)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod create\_features\_annotation}
\CommentTok{\#\textquotesingle{} @rdname create\_features\_annotation{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"create\_features\_annotation"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"create\_features\_annotation"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{,}
                                 \AttributeTok{extra\_data =} \StringTok{"data.frame"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, extra\_data)\{}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(}\FunctionTok{features\_annotation}\NormalTok{(x)))}
\NormalTok{              x }\OtherTok{\textless{}{-}} \FunctionTok{create\_features\_annotation}\NormalTok{(x)}
            \ControlFlowTok{if}\NormalTok{ ( }\SpecialCharTok{!}\StringTok{".features\_id"} \SpecialCharTok{\%in\%} \FunctionTok{colnames}\NormalTok{(extra\_data) )}
              \FunctionTok{stop}\NormalTok{( }\StringTok{"id column not found"}\NormalTok{ )}
            \FunctionTok{reference}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(x))[[ }\StringTok{"features\_annotation"}\NormalTok{ ]] }\OtherTok{\textless{}{-}}
              \FunctionTok{merge}\NormalTok{(}\FunctionTok{features\_annotation}\NormalTok{(x), extra\_data,}
                    \AttributeTok{by =} \StringTok{".features\_id"}\NormalTok{, }\AttributeTok{all.x =}\NormalTok{ T)}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod create\_features\_annotation}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases create\_features\_annotation}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x [mcnebula{-}class] object.}
\CommentTok{\#\textquotesingle{} @param extra\_data data.frame.}
\CommentTok{\#\textquotesingle{} @param column numeric(1). If name of columns not contain ".features\_id",}
\CommentTok{\#\textquotesingle{} used to specify ID column for \textquotesingle{}features\textquotesingle{}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname create\_features\_annotation{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} mcn\_5features}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# the previous steps}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_structure(test)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_reference(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_formula(test1, by\_reference=T)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_stardust\_classes(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_features\_annotation(test1)}
\CommentTok{\#\textquotesingle{}   \#\# see results}
\CommentTok{\#\textquotesingle{}   features\_annotation(test1)}
\CommentTok{\#\textquotesingle{}   \#\# or}
\CommentTok{\#\textquotesingle{}   reference(test1)$features\_annotation}
\CommentTok{\#\textquotesingle{}   \#\# or}
\CommentTok{\#\textquotesingle{}   reference(mcn\_dataset(test1))$features\_annotation}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# merge additional data}
\CommentTok{\#\textquotesingle{}   ids \textless{}{-} features\_annotation(test1)$.features\_id}
\CommentTok{\#\textquotesingle{}   data \textless{}{-} data.frame(.features\_id = ids, quant. = rnorm(length(ids), 1000, 200))}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_features\_annotation(test1, extra\_data = data)}
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"create\_features\_annotation"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"create\_features\_annotation"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \FunctionTok{.message\_info\_formal}\NormalTok{(}\StringTok{"MCnebula2"}\NormalTok{, }\StringTok{"create\_features\_annotation"}\NormalTok{)}
            \FunctionTok{.check\_data}\NormalTok{(x, }\FunctionTok{list}\NormalTok{(}\AttributeTok{specific\_candidate =} \StringTok{"create\_reference"}\NormalTok{))}
\NormalTok{            ref }\OtherTok{\textless{}{-}} \FunctionTok{specific\_candidate}\NormalTok{(x)}
            \DocumentationTok{\#\# formula dataset}
\NormalTok{            subscript }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{".f2\_formula"}\NormalTok{, }\StringTok{".f3\_fingerid"}\NormalTok{)}
\NormalTok{            lst }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(subscript, }\ControlFlowTok{function}\NormalTok{(sub)\{}
\NormalTok{                            set }\OtherTok{\textless{}{-}} \FunctionTok{latest}\NormalTok{(x, }\AttributeTok{subscript =}\NormalTok{ sub)}
\NormalTok{                            idcol }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(set, .features\_id, .candidates\_id)}
\NormalTok{                            check }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{distinct}\NormalTok{(dplyr}\SpecialCharTok{::}\FunctionTok{bind\_rows}\NormalTok{(idcol, ref),}
\NormalTok{                                                     .features\_id, .candidates\_id)}
                            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{any}\NormalTok{( }\FunctionTok{duplicated}\NormalTok{(check[[ }\StringTok{".features\_id"}\NormalTok{ ]]) )) \{}
\NormalTok{                              name }\OtherTok{\textless{}{-}} \FunctionTok{gsub}\NormalTok{(}\StringTok{"\^{}.*\_"}\NormalTok{, }\StringTok{""}\NormalTok{, sub)}
                              \FunctionTok{stop}\NormalTok{( }\StringTok{"the filtered }\SpecialCharTok{\textbackslash{}"}\StringTok{"}\NormalTok{, sub, }\StringTok{"}\SpecialCharTok{\textbackslash{}"}\StringTok{ set in \textasciigrave{}x\textasciigrave{} must match "}\NormalTok{,}
                                   \StringTok{"with the id columns "}\NormalTok{,}
                                   \StringTok{"(.features\_id, .candidates\_id) "}\NormalTok{,}
                                   \StringTok{"in \textasciigrave{}specific\_candidate(x)\textasciigrave{}, "}\NormalTok{,}
                                   \StringTok{"use \textasciigrave{}filter\_"}\NormalTok{, name,}
                                   \StringTok{"(x, by\_reference = T)\textasciigrave{} previously."}\NormalTok{)}
\NormalTok{                            \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{                              set }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(ref, .features\_id),}
\NormalTok{                                           dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(set, }\SpecialCharTok{{-}}\NormalTok{.candidates\_id),}
                                           \AttributeTok{by =} \StringTok{".features\_id"}\NormalTok{, }\AttributeTok{all.x =}\NormalTok{ T)}
                              \FunctionTok{return}\NormalTok{(set)}
\NormalTok{                            \}}
\NormalTok{                                 \})}
\NormalTok{            res }\OtherTok{\textless{}{-}} \FunctionTok{checkColMerge}\NormalTok{(lst[[}\DecValTok{1}\NormalTok{]], lst[[}\DecValTok{2}\NormalTok{]], }\AttributeTok{by =} \StringTok{".features\_id"}\NormalTok{, }\AttributeTok{all =}\NormalTok{ T)}
\NormalTok{            res }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(ref, res, }\AttributeTok{by =} \StringTok{".features\_id"}\NormalTok{, }\AttributeTok{all.x =}\NormalTok{ T)}
            \DocumentationTok{\#\# add ionMass and retention time for features}
\NormalTok{            x }\OtherTok{\textless{}{-}} \FunctionTok{collate\_data}\NormalTok{(x, }\AttributeTok{subscript =} \StringTok{".f2\_info"}\NormalTok{)}
\NormalTok{            mz\_rt }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(}\FunctionTok{latest}\NormalTok{(x, }\StringTok{"project\_dataset"}\NormalTok{, }\StringTok{".f2\_info"}\NormalTok{),}
\NormalTok{                                   .features\_id, mz, rt.secound)}
            \FunctionTok{reference}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(x))[[ }\StringTok{"features\_annotation"}\NormalTok{ ]] }\OtherTok{\textless{}{-}}
\NormalTok{              dplyr}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(}\FunctionTok{merge}\NormalTok{(res, mz\_rt, }\AttributeTok{by =} \StringTok{".features\_id"}\NormalTok{, }\AttributeTok{all.x =}\NormalTok{ T))}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-methods-create_hierarchy.r}{%
\section{File: methods-create\_hierarchy.R}\label{file-methods-create_hierarchy.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# collate and build classification hierarchy annotation data}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @aliases create\_hierarchy}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Create hierarchy data of chemical classification}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} Methods used to create hierarchy data of chemical classification.}
\CommentTok{\#\textquotesingle{} Annotate all chemical classes with hierarchy number.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name create\_hierarchy{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @order 1}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @exportMethod create\_hierarchy}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{create\_hierarchy()\}:}
\CommentTok{\#\textquotesingle{} get the default parameters for the method}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{create\_hierarchy\}.}
\CommentTok{\#\textquotesingle{} @rdname create\_hierarchy{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"create\_hierarchy"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"create\_hierarchy"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{()\{}
            \FunctionTok{list}\NormalTok{(}\AttributeTok{fun\_organize =}\NormalTok{ .build\_hierarchy)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod create\_hierarchy}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{create\_hierarchy(x, ...)\}:}
\CommentTok{\#\textquotesingle{} use the default parameters whatever \textquotesingle{}missing\textquotesingle{}}
\CommentTok{\#\textquotesingle{} while performing the method \textbackslash{}code\{create\_hierarchy\}.}
\CommentTok{\#\textquotesingle{} @rdname create\_hierarchy{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"create\_hierarchy"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, fun\_organize)\{}
            \FunctionTok{reCallMethod}\NormalTok{(}\StringTok{"create\_hierarchy"}\NormalTok{,}
                         \FunctionTok{.fresh\_param}\NormalTok{(}\FunctionTok{create\_hierarchy}\NormalTok{()))}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod create\_hierarchy}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases create\_hierarchy}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x [mcnebula{-}class] object.}
\CommentTok{\#\textquotesingle{} @param fun\_organize function. Normally not used.}
\CommentTok{\#\textquotesingle{} Default is \textbackslash{}code\{MCnebula2:::.build\_hierarchy\}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname create\_hierarchy{-}methods}
\CommentTok{\#\textquotesingle{}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"create\_hierarchy"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{, }\AttributeTok{fun\_organize =} \StringTok{"function"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, fun\_organize)\{}
\NormalTok{            class }\OtherTok{\textless{}{-}} \FunctionTok{classification}\NormalTok{(x)}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(class)) \{}
\NormalTok{              x }\OtherTok{\textless{}{-}} \FunctionTok{collate\_data}\NormalTok{(x, }\StringTok{".canopus"}\NormalTok{)}
\NormalTok{              class }\OtherTok{\textless{}{-}} \FunctionTok{classification}\NormalTok{(x)}
\NormalTok{            \}}
            \FunctionTok{reference}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(x))[[ }\StringTok{"hierarchy"}\NormalTok{ ]] }\OtherTok{\textless{}{-}} 
              \FunctionTok{fun\_organize}\NormalTok{(class)}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}

\NormalTok{.build\_hierarchy }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(data)\{}
\NormalTok{    data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(data, rel.index, chem.ont.id,}
\NormalTok{                           class.name, parent.chem.ont.id)}
\NormalTok{    root }\OtherTok{\textless{}{-}}\NormalTok{ data[data}\SpecialCharTok{$}\NormalTok{parent.chem.ont.id }\SpecialCharTok{==} \StringTok{""}\NormalTok{, ]}
\NormalTok{    list }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
    \FunctionTok{length}\NormalTok{(list) }\OtherTok{\textless{}{-}} \DecValTok{12}
\NormalTok{    n }\OtherTok{\textless{}{-}} \DecValTok{1}
\NormalTok{    list[[n]] }\OtherTok{\textless{}{-}}\NormalTok{ root}
\NormalTok{    df }\OtherTok{\textless{}{-}}\NormalTok{ data[data}\SpecialCharTok{$}\NormalTok{parent.chem.ont.id }\SpecialCharTok{\%in\%}\NormalTok{ root}\SpecialCharTok{$}\NormalTok{chem.ont.id, ]}

    \ControlFlowTok{while}\NormalTok{(}\FunctionTok{nrow}\NormalTok{(df) }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{)\{}
\NormalTok{      n }\OtherTok{\textless{}{-}}\NormalTok{ n }\SpecialCharTok{+} \DecValTok{1}
\NormalTok{      list[[n]] }\OtherTok{\textless{}{-}}\NormalTok{ df}
\NormalTok{      df }\OtherTok{\textless{}{-}}\NormalTok{ data[data}\SpecialCharTok{$}\NormalTok{parent.chem.ont.id }\SpecialCharTok{\%in\%}\NormalTok{ df}\SpecialCharTok{$}\NormalTok{chem.ont.id, ]}
\NormalTok{    \}}
\NormalTok{    data }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(list, }\AttributeTok{idcol =}\NormalTok{ T)}
\NormalTok{    data}\SpecialCharTok{$}\NormalTok{.id }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{.id }\SpecialCharTok{{-}} \DecValTok{1}
\NormalTok{    dplyr}\SpecialCharTok{::}\FunctionTok{rename}\NormalTok{(dplyr}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(data), }\AttributeTok{hierarchy =}\NormalTok{ .id)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export get\_parent\_classes}
\CommentTok{\#\textquotesingle{} @aliases get\_parent\_classes}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{get\_parent\_classes\}: For chemical classes to get}
\CommentTok{\#\textquotesingle{} its parent chemical classes.}
\CommentTok{\#\textquotesingle{} @param classes character. Names of chemical classes.}
\CommentTok{\#\textquotesingle{} @param hierarchy\_cutoff. numeric(1). The highest hierarchy of parent chemical classes}
\CommentTok{\#\textquotesingle{} that needs to be searched.}
\CommentTok{\#\textquotesingle{} @param re\_class\_no\_parent logical(1). If \textbackslash{}code\{TRUE\}, once a chemical class find with}
\CommentTok{\#\textquotesingle{} no parent, the chemical class itself would be returned.}
\CommentTok{\#\textquotesingle{} @rdname create\_hierarchy{-}methods}
\NormalTok{get\_parent\_classes }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(classes, x,}
           \AttributeTok{hierarchy\_cutoff =} \DecValTok{3}\NormalTok{,}
           \AttributeTok{re\_class\_no\_parent =}\NormalTok{ F}
\NormalTok{           )\{}
    \FunctionTok{.check\_data}\NormalTok{(x, }\FunctionTok{list}\NormalTok{(}\AttributeTok{hierarchy =} \StringTok{"create\_hierarchy"}\NormalTok{))}
\NormalTok{    db }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(}\FunctionTok{hierarchy}\NormalTok{(x), hierarchy }\SpecialCharTok{\textgreater{}=}\NormalTok{ hierarchy\_cutoff)}
    \DocumentationTok{\#\# as \textquotesingle{}dictionary\textquotesingle{}}
\NormalTok{    name2id }\OtherTok{\textless{}{-}} \FunctionTok{.as\_dic}\NormalTok{(db}\SpecialCharTok{$}\NormalTok{chem.ont.id, db}\SpecialCharTok{$}\NormalTok{class.name, }\AttributeTok{fill =}\NormalTok{ F)}
\NormalTok{    id2parent }\OtherTok{\textless{}{-}} \FunctionTok{.as\_dic}\NormalTok{(db}\SpecialCharTok{$}\NormalTok{parent.chem.ont.id, db}\SpecialCharTok{$}\NormalTok{chem.ont.id, }\AttributeTok{fill =}\NormalTok{ F)}
\NormalTok{    id2name }\OtherTok{\textless{}{-}} \FunctionTok{.as\_dic}\NormalTok{(db}\SpecialCharTok{$}\NormalTok{class.name, db}\SpecialCharTok{$}\NormalTok{chem.ont.id, }\AttributeTok{fill =}\NormalTok{ F)}
    \FunctionTok{sapply}\NormalTok{(classes, }\AttributeTok{simplify =}\NormalTok{ F,}
           \ControlFlowTok{function}\NormalTok{(class)\{}
\NormalTok{             set }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
\NormalTok{             parent }\OtherTok{\textless{}{-}} \DecValTok{0}
\NormalTok{             id }\OtherTok{\textless{}{-}}\NormalTok{ name2id[[class]]}
\NormalTok{             test }\OtherTok{\textless{}{-}} \FunctionTok{try}\NormalTok{(id2parent[[id]], }\AttributeTok{silent =}\NormalTok{ T)}
             \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{inherits}\NormalTok{(test, }\StringTok{"try{-}error"}\NormalTok{))}
               \ControlFlowTok{if}\NormalTok{(re\_class\_no\_parent)}
                 \FunctionTok{return}\NormalTok{(class)}
               \ControlFlowTok{else}
                 \FunctionTok{return}\NormalTok{()}
             \ControlFlowTok{while}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(parent))\{}
               \ControlFlowTok{if}\NormalTok{(parent }\SpecialCharTok{!=} \DecValTok{0}\NormalTok{)\{}
\NormalTok{                 set }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(set, id2name[[parent]])}
\NormalTok{                 id }\OtherTok{\textless{}{-}}\NormalTok{ parent}
\NormalTok{               \}}
\NormalTok{               parent }\OtherTok{\textless{}{-}}\NormalTok{ id2parent[[id]]}
\NormalTok{             \}}
             \ControlFlowTok{if}\NormalTok{(}\FunctionTok{length}\NormalTok{(set) }\SpecialCharTok{==} \DecValTok{0}\NormalTok{)\{}
               \ControlFlowTok{if}\NormalTok{(re\_class\_no\_parent)}
                 \FunctionTok{return}\NormalTok{(class)}
\NormalTok{             \}}
             \FunctionTok{return}\NormalTok{(set)}
\NormalTok{           \})}
\NormalTok{  \}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-methods-create_nebula_index.r}{%
\section{File: methods-create\_nebula\_index.R}\label{file-methods-create_nebula_index.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# create nebula index from filtered stardust classes}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @aliases create\_nebula\_index}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Set down the chemical classes for visualization}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} Arrange the filtered \textquotesingle{}stardust\_classes\textquotesingle{} data as \textquotesingle{}nebula\_index\textquotesingle{} data.}
\CommentTok{\#\textquotesingle{} The chemical classes in \textquotesingle{}nebula\_index\textquotesingle{} data would be visualized as Child{-}Nebulae.}
\CommentTok{\#\textquotesingle{} Run after [cross\_filter\_stardust()].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name create\_nebula\_index{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @order 1}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @exportMethod create\_nebula\_index}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{create\_nebula\_index()\}: get the default parameters for the method}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{create\_nebula\_index\}.}
\CommentTok{\#\textquotesingle{} @rdname create\_nebula\_index{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"create\_nebula\_index"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"create\_nebula\_index"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{()\{}
            \FunctionTok{list}\NormalTok{(}\AttributeTok{force =}\NormalTok{ F)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod create\_nebula\_index}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{create\_nebula\_index(x, ...)\}: use the default parameters whatever \textquotesingle{}missing\textquotesingle{}}
\CommentTok{\#\textquotesingle{} while performing the method \textbackslash{}code\{create\_nebula\_index\}.}
\CommentTok{\#\textquotesingle{} @rdname create\_nebula\_index{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"create\_nebula\_index"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, force)\{}
            \FunctionTok{reCallMethod}\NormalTok{(}\StringTok{"create\_nebula\_index"}\NormalTok{,}
                         \FunctionTok{.fresh\_param}\NormalTok{(}\FunctionTok{create\_nebula\_index}\NormalTok{()))}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod create\_nebula\_index}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases create\_nebula\_index}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x [mcnebula{-}class] object.}
\CommentTok{\#\textquotesingle{} @param force logical. The number of chemical classes in \textquotesingle{}stardust\_classes\textquotesingle{} data}
\CommentTok{\#\textquotesingle{} would be checked. The maximum is 120. If there were too many classes, return}
\CommentTok{\#\textquotesingle{} with error. Set to \textbackslash{}code\{FALSE\}, escape from maximum check.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname create\_nebula\_index{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} mcn\_5features}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# the previous steps}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_structure(test)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_reference(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_formula(test1, by\_reference = T)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_stardust\_classes(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_features\_annotation(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} cross\_filter\_stardust(test1, 2, 1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_nebula\_index(test1)}
\CommentTok{\#\textquotesingle{}   \#\# see results}
\CommentTok{\#\textquotesingle{}   nebula\_index(test1)}
\CommentTok{\#\textquotesingle{}   \#\# or}
\CommentTok{\#\textquotesingle{}   reference(test1)$nebula\_index}
\CommentTok{\#\textquotesingle{}   \#\# or}
\CommentTok{\#\textquotesingle{}   reference(mcn\_dataset(test1))$nebula\_index}
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"create\_nebula\_index"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{, }\AttributeTok{force =} \StringTok{"logical"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, force)\{}
            \FunctionTok{.message\_info\_formal}\NormalTok{(}\StringTok{"MCnebula2"}\NormalTok{, }\StringTok{"create\_nebula\_index"}\NormalTok{)}
            \FunctionTok{.check\_data}\NormalTok{(x, }\FunctionTok{list}\NormalTok{(}\AttributeTok{stardust\_classes =} \StringTok{"create\_stardust\_classes"}\NormalTok{))}
            \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\NormalTok{force) \{}
\NormalTok{              class\_num }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(}\FunctionTok{unique}\NormalTok{(}\FunctionTok{stardust\_classes}\NormalTok{(x)[[ }\StringTok{"rel.index"}\NormalTok{ ]]))}
              \ControlFlowTok{if}\NormalTok{ (class\_num }\SpecialCharTok{\textgreater{}} \DecValTok{120}\NormalTok{)}
                \FunctionTok{stop}\NormalTok{(}\StringTok{"too many classes; "}\NormalTok{,}
                     \StringTok{"length(unique(stardust\_classes(x)$rel.index)) \textgreater{} 120"}\NormalTok{)}
\NormalTok{            \}}
            \FunctionTok{reference}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(x))[[ }\StringTok{"nebula\_index"}\NormalTok{ ]] }\OtherTok{\textless{}{-}} 
\NormalTok{              dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(}\FunctionTok{stardust\_classes}\NormalTok{(x), rel.index, class.name,}
\NormalTok{                            hierarchy, .features\_id)}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @aliases set\_tracer}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Mark top \textquotesingle{}features\textquotesingle{} in \textquotesingle{}nebula\_index\textquotesingle{} data}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} Custom defined the specific \textquotesingle{}features\textquotesingle{} in \textquotesingle{}nebula\_index\textquotesingle{} data.}
\CommentTok{\#\textquotesingle{} Mark these \textquotesingle{}features\textquotesingle{} for subsequent visualization with eye{-}catching highlighting}
\CommentTok{\#\textquotesingle{} ([set\_nodes\_color()]).}
\CommentTok{\#\textquotesingle{} Run after [create\_nebula\_index()].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name set\_tracer{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @order 1}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @exportMethod set\_tracer}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{set\_tracer()\}: get the function for generating}
\CommentTok{\#\textquotesingle{} default parameters for the method}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{set\_tracer\}.}
\CommentTok{\#\textquotesingle{} @rdname set\_tracer{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"set\_tracer"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"set\_tracer"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{()\{}
            \ControlFlowTok{function}\NormalTok{(x, .features\_id)\{}
              \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(.features\_id) }\SpecialCharTok{\textgreater{}} \FunctionTok{length}\NormalTok{(}\FunctionTok{palette\_set}\NormalTok{(x)))}
                \FunctionTok{stop}\NormalTok{(}\StringTok{"too much specified features; "}\NormalTok{,}
                     \StringTok{"use \textquotesingle{}palette\_set\textless{}{-}\textquotesingle{} to set more colors"}\NormalTok{)}
\NormalTok{              colors }\OtherTok{\textless{}{-}} \FunctionTok{.as\_dic}\NormalTok{(}\FunctionTok{palette\_set}\NormalTok{(x), .features\_id,}
                                \AttributeTok{as.list =}\NormalTok{ F, }\AttributeTok{na.rm =}\NormalTok{ T)}
              \FunctionTok{list}\NormalTok{(}\AttributeTok{.features\_id =}\NormalTok{ .features\_id,}
                   \AttributeTok{colors =} \FunctionTok{unname}\NormalTok{(colors),}
                   \AttributeTok{rest =} \StringTok{"\#D9D9D9"}
\NormalTok{              )}
\NormalTok{            \}}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod set\_tracer}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{set\_tracer(x, ...)\}: use the default parameters whatever \textquotesingle{}missing\textquotesingle{}}
\CommentTok{\#\textquotesingle{} while performing the method \textbackslash{}code\{set\_tracer\}.}
\CommentTok{\#\textquotesingle{} @rdname set\_tracer{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"set\_tracer"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, .features\_id, colors, rest)\{}
\NormalTok{            args }\OtherTok{\textless{}{-}} \FunctionTok{as.list}\NormalTok{(}\FunctionTok{environment}\NormalTok{())}
\NormalTok{            args}\SpecialCharTok{$}\NormalTok{.features\_id }\OtherTok{\textless{}{-}}\NormalTok{ .features\_id}
            \FunctionTok{reCallMethod}\NormalTok{(}\StringTok{"set\_tracer"}\NormalTok{,}
                         \FunctionTok{.fresh\_param}\NormalTok{(}\FunctionTok{set\_tracer}\NormalTok{()(x, .features\_id), args))}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod set\_tracer}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases set\_tracer}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x [mcnebula{-}class] object.}
\CommentTok{\#\textquotesingle{} @param .features\_id character. The ID of \textquotesingle{}features\textquotesingle{} to mark.}
\CommentTok{\#\textquotesingle{} @param colors character. Hex color.}
\CommentTok{\#\textquotesingle{} @param rest character(1). Hex color.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @seealso [create\_nebula\_index()], [set\_nodes\_color()].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname set\_tracer{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} mcn\_5features}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# the previous steps}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_structure(test)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_reference(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_formula(test1, by\_reference = T)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_stardust\_classes(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_features\_annotation(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} cross\_filter\_stardust(test1, 2, 1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_nebula\_index(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   ids \textless{}{-} features\_annotation(test1)$.features\_id}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} set\_tracer(test1, ids[1:2])}
\CommentTok{\#\textquotesingle{}   \#\# see results}
\CommentTok{\#\textquotesingle{}   nebula\_index(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# see examples in \textquotesingle{}set\_nodes\_color()\textquotesingle{}}
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"set\_tracer"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{, }\AttributeTok{.features\_id =} \StringTok{"character"}\NormalTok{,}
                        \AttributeTok{colors =} \StringTok{"character"}\NormalTok{, }\AttributeTok{rest =} \StringTok{"character"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, .features\_id, colors, rest)\{}
            \FunctionTok{.check\_data}\NormalTok{(x, }\FunctionTok{list}\NormalTok{(}\AttributeTok{nebula\_index =} \StringTok{"create\_nebula\_index"}\NormalTok{))}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(.features\_id) }\SpecialCharTok{!=} \FunctionTok{length}\NormalTok{(colors))}
              \FunctionTok{stop}\NormalTok{(}\StringTok{"length(.features\_id) != length(colors))"}\NormalTok{)}
\NormalTok{            tracer\_color }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{.features\_id =}\NormalTok{ .features\_id,}
                                       \AttributeTok{tracer\_color =}\NormalTok{ colors)}
\NormalTok{            nebula\_index }\OtherTok{\textless{}{-}} \FunctionTok{nebula\_index}\NormalTok{(x)}
\NormalTok{            nebula\_index}\SpecialCharTok{$}\NormalTok{tracer }\OtherTok{\textless{}{-}} \ConstantTok{NULL}
\NormalTok{            nebula\_index}\SpecialCharTok{$}\NormalTok{tracer\_color }\OtherTok{\textless{}{-}} \ConstantTok{NULL}
\NormalTok{            nebula\_index }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(nebula\_index, tracer\_color,}
                                  \AttributeTok{by =} \StringTok{".features\_id"}\NormalTok{, }\AttributeTok{all.x =}\NormalTok{ T)}
\NormalTok{            nebula\_index }\OtherTok{\textless{}{-}}
\NormalTok{              dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(nebula\_index,}
                            \AttributeTok{tracer =} \FunctionTok{ifelse}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(tracer\_color), F, T),}
                            \AttributeTok{tracer\_color =} \FunctionTok{ifelse}\NormalTok{(tracer, tracer\_color, rest))}
            \FunctionTok{reference}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(x))[[ }\StringTok{"nebula\_index"}\NormalTok{ ]] }\OtherTok{\textless{}{-}}
\NormalTok{              dplyr}\SpecialCharTok{::}\FunctionTok{arrange}\NormalTok{(dplyr}\SpecialCharTok{::}\FunctionTok{relocate}\NormalTok{(tibble}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(nebula\_index),}
\NormalTok{                                             .features\_id,}
                                             \AttributeTok{.after =}\NormalTok{ hierarchy), rel.index)}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-methods-create_parent_layout.r}{%
\section{File: methods-create\_parent\_layout.R}\label{file-methods-create_parent_layout.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# for creating parent layout, these layouts includes:}
\CommentTok{\# layouts for nodes position of ggraph.}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @aliases create\_parent\_layout}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Create layout for visualization of Parent{-}Nebula}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} These methods use functions of [tidygraph::as\_tbl\_graph()] and}
\CommentTok{\#\textquotesingle{} [ggraph::create\_layout()] to create \textquotesingle{}layout\_ggraph\textquotesingle{} (data.frame)}
\CommentTok{\#\textquotesingle{} object to standby visualization of Parent{-}Nebula.}
\CommentTok{\#\textquotesingle{} Run after [create\_parent\_nebula()].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name create\_parent\_layout{-}methods}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @seealso [tidygraph::as\_tbl\_graph()], [ggraph::create\_layout()].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @order 1}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @exportMethod create\_parent\_layout}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{create\_parent\_layout()\}:}
\CommentTok{\#\textquotesingle{} get the default parameters for the method}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{create\_parent\_layout\}.}
\CommentTok{\#\textquotesingle{} @rdname create\_parent\_layout{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"create\_parent\_layout"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"create\_parent\_layout"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{()\{}
            \FunctionTok{list}\NormalTok{(}\AttributeTok{ggraph\_layout =} \StringTok{"kk"}\NormalTok{, }\AttributeTok{seed =} \DecValTok{1}\NormalTok{)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod create\_parent\_layout}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{create\_parent\_layout(x, ...)\}:}
\CommentTok{\#\textquotesingle{} use the default parameters whatever \textquotesingle{}missing\textquotesingle{}}
\CommentTok{\#\textquotesingle{} while performing the method \textbackslash{}code\{create\_parent\_layout\}.}
\CommentTok{\#\textquotesingle{} @rdname create\_parent\_layout{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"create\_parent\_layout"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, ggraph\_layout, seed)\{}
            \FunctionTok{reCallMethod}\NormalTok{(}\StringTok{"create\_parent\_layout"}\NormalTok{,}
                         \FunctionTok{.fresh\_param}\NormalTok{(}\FunctionTok{create\_parent\_layout}\NormalTok{()))}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod create\_parent\_layout}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases create\_parent\_layout}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x [mcnebula{-}class] object.}
\CommentTok{\#\textquotesingle{} @param ggraph\_layout character(1). Layout name. See [ggraph::create\_layout()].}
\CommentTok{\#\textquotesingle{} @param seed numeric(1). Passed to [set.seed()].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname create\_parent\_layout{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} mcn\_5features}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# the previous steps}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_structure(test)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_reference(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_formula(test1, by\_reference = T)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_stardust\_classes(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_features\_annotation(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} cross\_filter\_stardust(test1, 2, 1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_nebula\_index(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} compute\_spectral\_similarity(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_parent\_nebula(test1, 0.01)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# default parameters}
\CommentTok{\#\textquotesingle{}   create\_parent\_layout()}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_parent\_layout(test1)}
\CommentTok{\#\textquotesingle{}   \#\# see results (a object for \textquotesingle{}ggraph\textquotesingle{} package to visualization)}
\CommentTok{\#\textquotesingle{}   tibble::as\_tibble(layout\_ggraph(parent\_nebula(test1)))}
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"create\_parent\_layout"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{, }\AttributeTok{ggraph\_layout =} \StringTok{"character"}\NormalTok{,}
                        \AttributeTok{seed =} \StringTok{"numeric"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, ggraph\_layout, seed)\{}
            \FunctionTok{.message\_info\_formal}\NormalTok{(}\StringTok{"MCnebula2"}\NormalTok{, }\StringTok{"create\_parent\_layout"}\NormalTok{)}
            \FunctionTok{.check\_data}\NormalTok{(}\FunctionTok{parent\_nebula}\NormalTok{(x), }\FunctionTok{list}\NormalTok{(}\AttributeTok{igraph =} \StringTok{"create\_parent\_nebula"}\NormalTok{))}
            \FunctionTok{tbl\_graph}\NormalTok{(}\FunctionTok{parent\_nebula}\NormalTok{(x)) }\OtherTok{\textless{}{-}}
\NormalTok{              tidygraph}\SpecialCharTok{::}\FunctionTok{as\_tbl\_graph}\NormalTok{(}\FunctionTok{igraph}\NormalTok{(}\FunctionTok{parent\_nebula}\NormalTok{(x)))}
            \FunctionTok{set.seed}\NormalTok{(seed)}
            \FunctionTok{layout\_ggraph}\NormalTok{(}\FunctionTok{parent\_nebula}\NormalTok{(x)) }\OtherTok{\textless{}{-}}
\NormalTok{              ggraph}\SpecialCharTok{::}\FunctionTok{create\_layout}\NormalTok{(}\FunctionTok{tbl\_graph}\NormalTok{(}\FunctionTok{parent\_nebula}\NormalTok{(x)),}
                                    \AttributeTok{layout =}\NormalTok{ ggraph\_layout)}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-methods-create_parent_nebula.r}{%
\section{File: methods-create\_parent\_nebula.R}\label{file-methods-create_parent_nebula.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# use features annotation and spectral similarity data to create network}
\CommentTok{\# for parent{-}nebula}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @aliases create\_parent\_nebula}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Gather data to create Parent{-}Nebula}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} Gather \textquotesingle{}spectral\_similarity\textquotesingle{} data and \textquotesingle{}features\_annotation\textquotesingle{} data}
\CommentTok{\#\textquotesingle{} to create \textquotesingle{}igraph\textquotesingle{} object use function of [igraph::graph\_from\_data\_frame()].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name create\_parent\_nebula{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @seealso [compute\_spectral\_similarity()], [create\_features\_annotation()],}
\CommentTok{\#\textquotesingle{} [igraph::graph\_from\_data\_frame()].}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @order 1}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @importFrom igraph graph\_from\_data\_frame}
\CommentTok{\#\textquotesingle{} @exportMethod create\_parent\_nebula}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{create\_parent\_nebula()\}: get the default parameters for the method}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{create\_parent\_nebula\}.}
\CommentTok{\#\textquotesingle{} @rdname create\_parent\_nebula{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"create\_parent\_nebula"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"create\_parent\_nebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{()\{}
            \FunctionTok{list}\NormalTok{(}\AttributeTok{edge\_cutoff =} \FloatTok{0.5}\NormalTok{,}
                 \AttributeTok{max\_edge\_number =} \DecValTok{5}\NormalTok{,}
                 \AttributeTok{remove\_isolate =}\NormalTok{ T)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod create\_parent\_nebula}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{create\_parent\_nebula(x, ...)\}:}
\CommentTok{\#\textquotesingle{} use the default parameters whatever \textquotesingle{}missing\textquotesingle{}}
\CommentTok{\#\textquotesingle{} while performing the method \textbackslash{}code\{create\_parent\_nebula\}.}
\CommentTok{\#\textquotesingle{} @rdname create\_parent\_nebula{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"create\_parent\_nebula"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, edge\_cutoff, max\_edge\_number, remove\_isolate)\{}
            \FunctionTok{reCallMethod}\NormalTok{(}\StringTok{"create\_parent\_nebula"}\NormalTok{,}
                         \FunctionTok{.fresh\_param}\NormalTok{(}\FunctionTok{create\_parent\_nebula}\NormalTok{()))}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod create\_parent\_nebula}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases create\_parent\_nebula}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x [mcnebula{-}class] object.}
\CommentTok{\#\textquotesingle{} @param edge\_cutoff numeric(1). Value in (0,1). Set a threshold to}
\CommentTok{\#\textquotesingle{} create edges upon similarity value of \textquotesingle{}spectral\_similarity\textquotesingle{} data.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @param max\_edge\_number numeric(1).}
\CommentTok{\#\textquotesingle{} For nodes (features) in each Parent{-}Nebulae (i.e. network), the maximum number of}
\CommentTok{\#\textquotesingle{} edges link with. If the number exceeds the limitation, only edges representing higher}
\CommentTok{\#\textquotesingle{} spectral similarity would be retained.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @param remove\_isolate logical. If \textbackslash{}code\{TRUE\}, remove the isolate \textquotesingle{}features\textquotesingle{}}
\CommentTok{\#\textquotesingle{} (in network, i.e. the nodes without edge)}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname create\_parent\_nebula{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} mcn\_5features}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# the previous steps}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_structure(test)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_reference(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_formula(test1, by\_reference = T)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_stardust\_classes(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_features\_annotation(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} cross\_filter\_stardust(test1, 2, 1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_nebula\_index(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} compute\_spectral\_similarity(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# default parameters}
\CommentTok{\#\textquotesingle{}   create\_parent\_nebula()}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_parent\_nebula(test1, 0.01)}
\CommentTok{\#\textquotesingle{}   \#\# see results}
\CommentTok{\#\textquotesingle{}   igraph(parent\_nebula(test1))}
\CommentTok{\#\textquotesingle{}   \#\# write output for \textquotesingle{}Cytoscape\textquotesingle{} or other network software}
\CommentTok{\#\textquotesingle{}   tmp \textless{}{-} tempdir()}
\CommentTok{\#\textquotesingle{}   igraph::write\_graph(}
\CommentTok{\#\textquotesingle{}     igraph(parent\_nebula(test1)),}
\CommentTok{\#\textquotesingle{}     file = paste0(tmp, "/parent\_nebula.graphml",}
\CommentTok{\#\textquotesingle{}       format = "graphml"}
\CommentTok{\#\textquotesingle{}     )}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   unlink(tmp, T, T)}
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"create\_parent\_nebula"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"create\_parent\_nebula"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{,}
                                 \AttributeTok{edge\_cutoff =} \StringTok{"numeric"}\NormalTok{,}
                                 \AttributeTok{max\_edge\_number =} \StringTok{"numeric"}\NormalTok{,}
                                 \AttributeTok{remove\_isolate =} \StringTok{"logical"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, edge\_cutoff, max\_edge\_number, remove\_isolate)\{}
            \FunctionTok{.message\_info\_formal}\NormalTok{(}\StringTok{"MCnebula2"}\NormalTok{, }\StringTok{"create\_parent\_nebula"}\NormalTok{)}
            \FunctionTok{.check\_data}\NormalTok{(x, }\FunctionTok{list}\NormalTok{(}\AttributeTok{features\_annotation =} \StringTok{"create\_features\_annotation"}\NormalTok{,}
                                \AttributeTok{spectral\_similarity =} \StringTok{"compute\_spectral\_similarity"}
\NormalTok{                                ))}
\NormalTok{            edges }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(}\FunctionTok{spectral\_similarity}\NormalTok{(x),}
\NormalTok{                                   similarity }\SpecialCharTok{\textgreater{}=}\NormalTok{ edge\_cutoff)}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{nrow}\NormalTok{(edges) }\SpecialCharTok{\textgreater{}}\NormalTok{ max\_edge\_number) \{}
\NormalTok{              edges }\OtherTok{\textless{}{-}} \FunctionTok{.decrease\_edges}\NormalTok{(edges, max\_edge\_number)}
\NormalTok{            \}}
            \ControlFlowTok{if}\NormalTok{ (remove\_isolate) \{}
\NormalTok{              features }\OtherTok{\textless{}{-}}
\NormalTok{                dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(}\FunctionTok{features\_annotation}\NormalTok{(x), .features\_id }\SpecialCharTok{\%in\%}
                              \FunctionTok{unique}\NormalTok{(}\FunctionTok{c}\NormalTok{(edges[[ }\StringTok{".features\_id1"}\NormalTok{ ]],}
\NormalTok{                                       edges[[ }\StringTok{".features\_id2"}\NormalTok{ ]]))}
\NormalTok{                )}
\NormalTok{            \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{              features }\OtherTok{\textless{}{-}} \FunctionTok{features\_annotation}\NormalTok{(x)}
\NormalTok{            \}}
            \FunctionTok{igraph}\NormalTok{(}\FunctionTok{parent\_nebula}\NormalTok{(x)) }\OtherTok{\textless{}{-}}
\NormalTok{              igraph}\SpecialCharTok{::}\FunctionTok{graph\_from\_data\_frame}\NormalTok{(edges, }\AttributeTok{directed =}\NormalTok{ T,}
                                            \AttributeTok{vertices =}\NormalTok{ features)}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-methods-create_reference.r}{%
\section{File: methods-create\_reference.R}\label{file-methods-create_reference.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# create reference data based on mcn\_dataset}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @aliases create\_reference}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Establish \textquotesingle{}specific candidate\textquotesingle{} for each \textquotesingle{}feature\textquotesingle{}}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} According to the filtered data, whether obtained by [filter\_formula()],}
\CommentTok{\#\textquotesingle{} [filter\_structure()] or [filter\_ppcp()],}
\CommentTok{\#\textquotesingle{} establishing specific candidate of each \textquotesingle{}feature\textquotesingle{} for subsequent data filtering.}
\CommentTok{\#\textquotesingle{} This step is an important intermediate link for the three part of data filtering,}
\CommentTok{\#\textquotesingle{} makes the final filtered results of chemical formula, structure and classification}
\CommentTok{\#\textquotesingle{} consistent.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @details}
\CommentTok{\#\textquotesingle{} \textbackslash{}bold\{Establish reference upon top candidate\}}
\CommentTok{\#\textquotesingle{} Suppose we predicted a potential compound represented by LC{-}MS/MS spectrum,}
\CommentTok{\#\textquotesingle{} and obtained the candidates of chemical molecular formula,}
\CommentTok{\#\textquotesingle{} structure and chemical class.}
\CommentTok{\#\textquotesingle{} These candidates include both positive and negative results:}
\CommentTok{\#\textquotesingle{} for chemical molecular formula and chemical structure,}
\CommentTok{\#\textquotesingle{} the positive prediction was unique; for chemical class,}
\CommentTok{\#\textquotesingle{} multiple positive predictions that belong to various classification were involved.}
\CommentTok{\#\textquotesingle{} We did not know the exact negative and positive.}
\CommentTok{\#\textquotesingle{} Normally, we ranked and filtered these according to the scores.}
\CommentTok{\#\textquotesingle{} There were numerious scores, for isotopes, for mass error, for structural similarity,}
\CommentTok{\#\textquotesingle{} for chemical classes...}
\CommentTok{\#\textquotesingle{} Which score selected to rank candidates depends on the purpose}
\CommentTok{\#\textquotesingle{} of research. Such as:}
\CommentTok{\#\textquotesingle{} {-} To find out the chemical structure mostly be positive, ranking the candidates}
\CommentTok{\#\textquotesingle{} by structural score.}
\CommentTok{\#\textquotesingle{} {-} To determine whether the potential compound may be of a certain chemical classes,}
\CommentTok{\#\textquotesingle{} ranking the candidates by the classified score.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} Ether by [filter\_formula()], [filter\_structure()] or [filter\_ppcp()], the}
\CommentTok{\#\textquotesingle{} candidate with top score can be obtained.}
\CommentTok{\#\textquotesingle{} However, for the three module (formula, structure, classes), sometimes}
\CommentTok{\#\textquotesingle{} thier top score candidates were not in line with each other.}
\CommentTok{\#\textquotesingle{} That is, thier top score towards different chemical molecular formulas.}
\CommentTok{\#\textquotesingle{} To find out the corresponding data in other modules,}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{create\_reference\} should be performed to establish the}
\CommentTok{\#\textquotesingle{} \textquotesingle{}specific\_candidate\textquotesingle{} for subsequent filtering.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name create\_reference{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @order 1}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @exportMethod create\_reference}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases create\_reference}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x [mcnebula{-}class] object.}
\CommentTok{\#\textquotesingle{} @param from character(1). "structure", "formula" or "ppcp".}
\CommentTok{\#\textquotesingle{} @param subscript character(1). ".f3\_fingerid", ".f2\_formula" or ".f3\_canopus".}
\CommentTok{\#\textquotesingle{} See [subscript{-}class].}
\CommentTok{\#\textquotesingle{} @param data data.frame. An external channel for user to specify candidate customarily.}
\CommentTok{\#\textquotesingle{} Normally not used.}
\CommentTok{\#\textquotesingle{} @param columns character(2) or numeric(2). Specify the key columns in the parameter}
\CommentTok{\#\textquotesingle{} of data. Normally not used.}
\CommentTok{\#\textquotesingle{} @param fill logical. If \textbackslash{}code\{TRUE\}, run post modification.}
\CommentTok{\#\textquotesingle{} Run \textbackslash{}code\{filter\_formula(object)\}, and use its results to fill the data}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{specific\_candidate\} for \textquotesingle{}features\textquotesingle{} without specified top candidate.}
\CommentTok{\#\textquotesingle{} Only useful when the data \textbackslash{}code\{specific\_candidate\} were}
\CommentTok{\#\textquotesingle{} based on scores of chemical structure or classes, as for some \textquotesingle{}features\textquotesingle{}}
\CommentTok{\#\textquotesingle{} there may be no chemical structural}
\CommentTok{\#\textquotesingle{} or classified candidates but candidates for chemical formula.}
\CommentTok{\#\textquotesingle{} @param MoreArgs list. Used only \textbackslash{}code\{fill = T\}. Parameters passed to [filter\_formula()].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname create\_reference{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} mcn\_5features}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# set specific candidate}
\CommentTok{\#\textquotesingle{}   \#\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} }
\CommentTok{\#\textquotesingle{}   \#\# from chemical structure}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_structure(test)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_reference(test1)}
\CommentTok{\#\textquotesingle{}   \#\# see results}
\CommentTok{\#\textquotesingle{}   specific\_candidate(test1)}
\CommentTok{\#\textquotesingle{}   \#\# or}
\CommentTok{\#\textquotesingle{}   reference(test1)$specific\_candidate}
\CommentTok{\#\textquotesingle{}   \#\# or}
\CommentTok{\#\textquotesingle{}   reference(mcn\_dataset(test1))$specific\_candidate}
\CommentTok{\#\textquotesingle{}   \#\# \textquotesingle{}create\_reference(test1)\textquotesingle{} equals to}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_reference(test1, from = "structure", fill = T)}
\CommentTok{\#\textquotesingle{}   e1 \textless{}{-} specific\_candidate(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# the above equals to following:}
\CommentTok{\#\textquotesingle{}   data \textless{}{-} latest(filter\_structure(test1))}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_reference(test1, data = data, fill = T)}
\CommentTok{\#\textquotesingle{}   e2 \textless{}{-} specific\_candidate(test1)}
\CommentTok{\#\textquotesingle{}   identical(e1, e2)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# the \textquotesingle{}specific\_candidate\textquotesingle{} data used for filtering}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_formula(test1, by\_reference = T)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} }
\CommentTok{\#\textquotesingle{}   \#\# from chemical formula}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_formula(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_reference(test1, from = "formula")}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} }
\CommentTok{\#\textquotesingle{}   \#\# from chemical classes}
\CommentTok{\#\textquotesingle{}   \#\# A complex example:}
\CommentTok{\#\textquotesingle{}   \#\# suppose there were some classes we were interested in}
\CommentTok{\#\textquotesingle{}   all\_classes \textless{}{-} latest(test1, "project\_dataset", ".canopus")$class.name}
\CommentTok{\#\textquotesingle{}   set.seed(1)}
\CommentTok{\#\textquotesingle{}   classes \textless{}{-} sample(all\_classes, 50)}
\CommentTok{\#\textquotesingle{}   classes}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_ppcp(test1,}
\CommentTok{\#\textquotesingle{}     dplyr::filter,}
\CommentTok{\#\textquotesingle{}     class.name \%in\% classes,}
\CommentTok{\#\textquotesingle{}     pp.value \textgreater{} 0.5,}
\CommentTok{\#\textquotesingle{}     by\_reference = F}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   data \textless{}{-} latest(test1)}
\CommentTok{\#\textquotesingle{}   data}
\CommentTok{\#\textquotesingle{}   \#\# \textquotesingle{}feature\textquotesingle{} have a plural number of candidates.}
\CommentTok{\#\textquotesingle{}   ids \textless{}{-} data$.features\_id}
\CommentTok{\#\textquotesingle{}   id \textless{}{-} unique(ids[duplicated(ids)])}
\CommentTok{\#\textquotesingle{}   \#\# get the candidate of top chemical structural score.}
\CommentTok{\#\textquotesingle{}   \textasciigrave{}\%\textgreater{}\%\textasciigrave{} \textless{}{-} magrittr::\textasciigrave{}\%\textgreater{}\%\textasciigrave{}}
\CommentTok{\#\textquotesingle{}   candidates \textless{}{-} filter\_structure(test1, dplyr::filter, .features\_id \%in\% id) \%\textgreater{}\% }
\CommentTok{\#\textquotesingle{}     latest() \%\textgreater{}\% }
\CommentTok{\#\textquotesingle{}     dplyr::filter(.candidates\_id \%in\% data$.candidates\_id) \%\textgreater{}\% }
\CommentTok{\#\textquotesingle{}     dplyr::arrange(.features\_id, dplyr::desc(csi.score)) \%\textgreater{}\% }
\CommentTok{\#\textquotesingle{}     dplyr::distinct(.features\_id, .keep\_all = T)}
\CommentTok{\#\textquotesingle{}   \#\# for refecrence}
\CommentTok{\#\textquotesingle{}   data \textless{}{-} data \%\textgreater{}\%}
\CommentTok{\#\textquotesingle{}     dplyr::filter(}
\CommentTok{\#\textquotesingle{}       .features\_id != candidates$.features\_id |}
\CommentTok{\#\textquotesingle{}         (.features\_id == candidates$.features\_id \&}
\CommentTok{\#\textquotesingle{}           .candidates\_id == candidates$.candidates\_id)}
\CommentTok{\#\textquotesingle{}     )}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_reference(test1, data = data, fill = T)}
\CommentTok{\#\textquotesingle{}   specific\_candidate(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"create\_reference"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{, }\AttributeTok{fill =} \StringTok{"logical"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, from, subscript, data, columns, fill, MoreArgs)\{}
\NormalTok{            args }\OtherTok{\textless{}{-}} \FunctionTok{as.list}\NormalTok{(}\FunctionTok{environment}\NormalTok{())}
\NormalTok{            args }\OtherTok{\textless{}{-}}\NormalTok{ args[}\SpecialCharTok{!}\FunctionTok{names}\NormalTok{(args) }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"fill"}\NormalTok{, }\StringTok{"MoreArgs"}\NormalTok{)]}
\NormalTok{            args }\OtherTok{\textless{}{-}}\NormalTok{ args[ }\SpecialCharTok{!}\FunctionTok{vapply}\NormalTok{(args, is.name, T) ]}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(args) }\SpecialCharTok{==} \DecValTok{1}\NormalTok{)}
\NormalTok{              x }\OtherTok{\textless{}{-}} \FunctionTok{create\_reference}\NormalTok{(x, }\StringTok{"structure"}\NormalTok{)}
            \ControlFlowTok{else}
\NormalTok{              x }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(create\_reference, args)}
            \ControlFlowTok{if}\NormalTok{ (fill) \{}
              \FunctionTok{.message\_info}\NormalTok{(}\StringTok{"create\_reference"}\NormalTok{, }\StringTok{"fill == T"}\NormalTok{,}
                        \StringTok{"}\SpecialCharTok{\textbackslash{}n\textbackslash{}t}\StringTok{filling missing features with filtered formula"}\NormalTok{)}
              \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{missing}\NormalTok{(MoreArgs))}
\NormalTok{                x }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(filter\_formula, }\FunctionTok{c}\NormalTok{(x, MoreArgs))}
              \ControlFlowTok{else}
\NormalTok{                x }\OtherTok{\textless{}{-}} \FunctionTok{filter\_formula}\NormalTok{(x)}
              \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{any}\NormalTok{(}\FunctionTok{duplicated}\NormalTok{(}\FunctionTok{latest}\NormalTok{(x)}\SpecialCharTok{$}\NormalTok{.features\_id)))}
                \FunctionTok{stop}\NormalTok{(}\StringTok{"the filtered formula must unique in \textasciigrave{}.features\_id\textasciigrave{}"}\NormalTok{)}
\NormalTok{              .ref }\OtherTok{\textless{}{-}} \FunctionTok{specific\_candidate}\NormalTok{(}\FunctionTok{create\_reference}\NormalTok{(x, }\AttributeTok{data =} \FunctionTok{latest}\NormalTok{(x)))}
              \FunctionTok{reference}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(x))[[ }\StringTok{"specific\_candidate"}\NormalTok{ ]] }\OtherTok{\textless{}{-}} 
\NormalTok{                dplyr}\SpecialCharTok{::}\FunctionTok{distinct}\NormalTok{(dplyr}\SpecialCharTok{::}\FunctionTok{bind\_rows}\NormalTok{(}\FunctionTok{specific\_candidate}\NormalTok{(x), .ref),}
\NormalTok{                                .features\_id, }\AttributeTok{.keep\_all =}\NormalTok{ T)}
\NormalTok{            \}}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod create\_reference}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{create\_reference()\}: get the default parameters for the method}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{create\_reference\}.}
\CommentTok{\#\textquotesingle{} @rdname create\_reference{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"create\_reference"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"create\_reference"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{()\{}
            \FunctionTok{list}\NormalTok{(}\AttributeTok{from =} \StringTok{"structure"}\NormalTok{,}
                 \AttributeTok{fill =}\NormalTok{ T)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod create\_reference}
\CommentTok{\#\textquotesingle{} @rdname create\_reference{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"create\_reference"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"create\_reference"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \FunctionTok{create\_reference}\NormalTok{(x, }\StringTok{"structure"}\NormalTok{, }\AttributeTok{fill =}\NormalTok{ T)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod create\_reference}
\CommentTok{\#\textquotesingle{} @rdname create\_reference{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"create\_reference"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"create\_reference"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{, }\AttributeTok{from =} \StringTok{"character"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, from)\{}
\NormalTok{            subscript }\OtherTok{\textless{}{-}} \ControlFlowTok{switch}\NormalTok{(from,}
                                \AttributeTok{structure =} \StringTok{".f3\_fingerid"}\NormalTok{,}
                                \AttributeTok{formula =} \StringTok{".f2\_formula"}\NormalTok{,}
                                \AttributeTok{ppcp =} \StringTok{".f3\_canopus"}
\NormalTok{            )}
            \FunctionTok{create\_reference}\NormalTok{(x, }\AttributeTok{subscript =}\NormalTok{ subscript)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod create\_reference}
\CommentTok{\#\textquotesingle{} @rdname create\_reference{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"create\_reference"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"create\_reference"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{,}
                                 \AttributeTok{subscript =} \StringTok{"character"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, subscript)\{}
            \FunctionTok{.message\_info\_formal}\NormalTok{(}\StringTok{"MCnebula2"}\NormalTok{, }\StringTok{"create\_reference"}\NormalTok{)}
\NormalTok{            data }\OtherTok{\textless{}{-}} \FunctionTok{try}\NormalTok{(}\FunctionTok{entity}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(x))[[ subscript ]]), }\AttributeTok{silent =}\NormalTok{ T)}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{inherits}\NormalTok{(data, }\StringTok{"try{-}error"}\NormalTok{)) \{}
              \FunctionTok{stop}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"the specified dataset not exists. use, e.g., "}\NormalTok{,}
                          \StringTok{"\textasciigrave{}filter\_structure(x)\textasciigrave{} previously."}\NormalTok{))}
\NormalTok{            \}}
            \ControlFlowTok{if}\NormalTok{ (subscript }\SpecialCharTok{==} \StringTok{".f3\_canopus"}\NormalTok{) \{}
\NormalTok{              data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{distinct}\NormalTok{(data, .features\_id, .candidates\_id)}
\NormalTok{            \}}
            \FunctionTok{create\_reference}\NormalTok{(x, }\AttributeTok{data =}\NormalTok{ data)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod create\_reference}
\CommentTok{\#\textquotesingle{} @rdname create\_reference{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"create\_reference"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"create\_reference"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{,}
                                 \AttributeTok{data =} \StringTok{"data.frame"}\NormalTok{,}
                                 \AttributeTok{columns =} \StringTok{"character"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, data, columns)\{}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(columns) }\SpecialCharTok{!=} \DecValTok{2}\NormalTok{)}
              \FunctionTok{stop}\NormalTok{( }\StringTok{"length(\textasciigrave{}columns\textasciigrave{}) != 2"}\NormalTok{ )}
            \FunctionTok{colnames}\NormalTok{(data)[}\FunctionTok{which}\NormalTok{(}\FunctionTok{colnames}\NormalTok{(data) }\SpecialCharTok{==}\NormalTok{ columns)] }\OtherTok{\textless{}{-}} 
              \FunctionTok{c}\NormalTok{(}\StringTok{".features\_id"}\NormalTok{, }\StringTok{".candidates\_id"}\NormalTok{)}
            \FunctionTok{create\_reference}\NormalTok{(x, }\AttributeTok{data =}\NormalTok{ data)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod create\_reference}
\CommentTok{\#\textquotesingle{} @rdname create\_reference{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"create\_reference"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"create\_reference"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{,}
                                 \AttributeTok{data =} \StringTok{"data.frame"}\NormalTok{,}
                                 \AttributeTok{columns =} \StringTok{"integer"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, data, columns)\{}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(columns) }\SpecialCharTok{!=} \DecValTok{2}\NormalTok{)}
              \FunctionTok{stop}\NormalTok{( }\StringTok{"length(\textasciigrave{}columns\textasciigrave{}) != 2"}\NormalTok{ )}
            \FunctionTok{colnames}\NormalTok{(data)[columns] }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{".features\_id"}\NormalTok{, }\StringTok{".candidates\_id"}\NormalTok{)}
            \FunctionTok{create\_reference}\NormalTok{(x, }\AttributeTok{data =}\NormalTok{ data)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod create\_reference}
\CommentTok{\#\textquotesingle{} @rdname create\_reference{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"create\_reference"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"create\_reference"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{,}
                                 \AttributeTok{data =} \StringTok{"data.frame"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, data)\{}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{any}\NormalTok{( }\FunctionTok{duplicated}\NormalTok{(data[[ }\StringTok{".features\_id"}\NormalTok{ ]]) ))}
              \FunctionTok{stop}\NormalTok{(}\StringTok{"\textasciigrave{}.features\_id\textasciigrave{} in \textasciigrave{}data\textasciigrave{} were not unique"}\NormalTok{)}
\NormalTok{            fun }\OtherTok{\textless{}{-}} \FunctionTok{methods\_match}\NormalTok{(}\FunctionTok{project\_api}\NormalTok{(x))[[ }\StringTok{"generate\_candidates\_id"}\NormalTok{ ]]}
\NormalTok{            data }\OtherTok{\textless{}{-}} \FunctionTok{format\_msframe}\NormalTok{(data, }\AttributeTok{fun\_format =}\NormalTok{ fun)}
            \FunctionTok{reference}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(x))[[ }\StringTok{"specific\_candidate"}\NormalTok{ ]] }\OtherTok{\textless{}{-}} 
\NormalTok{              dplyr}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(data, .features\_id, .candidates\_id))}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-methods-create_stardust_classes.r}{%
\section{File: methods-create\_stardust\_classes.R}\label{file-methods-create_stardust_classes.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# filter classification for each features, as stardust classes}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @aliases create\_stardust\_classes}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title \textquotesingle{}Inner\textquotesingle{} filter for PPCP data}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} Perform \textquotesingle{}inner\textquotesingle{} filter for PPCP}
\CommentTok{\#\textquotesingle{} (posterior probability of classification prediction) data of each \textquotesingle{}feature\textquotesingle{},}
\CommentTok{\#\textquotesingle{} then gathered as \textquotesingle{}stardust\_classes\textquotesingle{} data.}
\CommentTok{\#\textquotesingle{} Run after [create\_reference()].}
\CommentTok{\#\textquotesingle{} Standby for next step [cross\_filter\_stardust()].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @details}
\CommentTok{\#\textquotesingle{} The PPCP data for each \textquotesingle{}feature\textquotesingle{} contains the prediction of thousands of classes}
\CommentTok{\#\textquotesingle{} for the potential compound (even if the chemical structure was unknown).}
\CommentTok{\#\textquotesingle{} See \textbackslash{}url\{http://www.nature.com/articles/s41587{-}020{-}0740{-}8\}}
\CommentTok{\#\textquotesingle{} for details about the prediction.}
\CommentTok{\#\textquotesingle{} The data contains attributes of:}
\CommentTok{\#\textquotesingle{} {-} \textbackslash{}code\{class.name\}: name of classes.}
\CommentTok{\#\textquotesingle{} {-} \textbackslash{}code\{pp.value\}: value of posterior probability.}
\CommentTok{\#\textquotesingle{} {-} \textbackslash{}code\{hierarchy\}: hierarchy of classes in the taxonomy.}
\CommentTok{\#\textquotesingle{} See \textbackslash{}url\{https://jcheminf.biomedcentral.com/articles/10.1186/s13321{-}016{-}0174{-}y\}}
\CommentTok{\#\textquotesingle{} for details about hierarchy and taxonomy of chemical classification.}
\CommentTok{\#\textquotesingle{} {-} ...}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} The method [create\_stardust\_classes()] use these inner attributes to}
\CommentTok{\#\textquotesingle{} filter classes candidates for each \textquotesingle{}feature\textquotesingle{}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name create\_stardust\_classes{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @order 1}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @exportMethod create\_stardust\_classes}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{create\_stardust\_classes()\}: get the default parameters for the method}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{create\_stardust\_classes\}.}
\CommentTok{\#\textquotesingle{} @rdname create\_stardust\_classes{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"create\_stardust\_classes"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"create\_stardust\_classes"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"missing"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{()\{}
            \FunctionTok{list}\NormalTok{(}\AttributeTok{pp.threshold =} \FloatTok{0.5}\NormalTok{,}
                 \AttributeTok{hierarchy\_priority =} \DecValTok{5}\SpecialCharTok{:}\DecValTok{2}\NormalTok{,}
                 \AttributeTok{position\_isomerism =}\NormalTok{ T,}
                 \AttributeTok{inherit\_dataset =}\NormalTok{ F)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod create\_stardust\_classes}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{create\_stardust\_classes(x, ...)\}:}
\CommentTok{\#\textquotesingle{} use the default parameters whatever \textquotesingle{}missing\textquotesingle{}}
\CommentTok{\#\textquotesingle{} while performing the method \textbackslash{}code\{create\_stardust\_classes\}.}
\CommentTok{\#\textquotesingle{} @rdname create\_stardust\_classes{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"create\_stardust\_classes"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, pp.threshold, hierarchy\_priority,}
\NormalTok{                   position\_isomerism, inherit\_dataset)\{}
            \FunctionTok{reCallMethod}\NormalTok{(}\StringTok{"create\_stardust\_classes"}\NormalTok{,}
                         \FunctionTok{.fresh\_param}\NormalTok{(}\FunctionTok{create\_stardust\_classes}\NormalTok{()))}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod create\_stardust\_classes}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases create\_stardust\_classes}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x [mcnebula{-}class] object.}
\CommentTok{\#\textquotesingle{} @param pp.threshold numeric(1) Threshold for PPCP. \textbackslash{}code\{pp.threshold = 0.5\} may}
\CommentTok{\#\textquotesingle{} work well.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param hierarchy\_priority numeric. The specified hierarchy of classes to retain.}
\CommentTok{\#\textquotesingle{} The other hierarchy would be filtered out. The hierarchy:}
\CommentTok{\#\textquotesingle{} {-} n: ...}
\CommentTok{\#\textquotesingle{} {-} 5: Classes of Level 5.}
\CommentTok{\#\textquotesingle{} {-} 4: Classes of Subclass.}
\CommentTok{\#\textquotesingle{} {-} 3: Classes of Class.}
\CommentTok{\#\textquotesingle{} {-} 2: Classes of Super Class.}
\CommentTok{\#\textquotesingle{} {-} ...}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param position\_isomerism logical. If \textbackslash{}code\{TRUE\}, use pattern match}
\CommentTok{\#\textquotesingle{} to filter out all classes names contains Arabic numerals.}
\CommentTok{\#\textquotesingle{} Generally, these classes describe about the position of chemical functional group,}
\CommentTok{\#\textquotesingle{} which were too subtle for machine to predict from LC{-}MS/MS spectrum.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param inherit\_dataset logical. If \textbackslash{}code\{TRUE\}, use latest PPCP data}
\CommentTok{\#\textquotesingle{} formed by [filter\_ppcp()]. i.e., data of:}
\CommentTok{\#\textquotesingle{} {-} latest(x, subscript = ".f3\_canopus")}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} Else, run [filter\_ppcp()].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname create\_stardust\_classes{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} mcn\_5features}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# the previous steps}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_structure(test)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_reference(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_stardust\_classes(test1)}
\CommentTok{\#\textquotesingle{}   \#\# see results}
\CommentTok{\#\textquotesingle{}   stardust\_classes(test1)}
\CommentTok{\#\textquotesingle{}   \#\# or}
\CommentTok{\#\textquotesingle{}   reference(test1)$stardust\_classes}
\CommentTok{\#\textquotesingle{}   \#\# or}
\CommentTok{\#\textquotesingle{}   reference(mcn\_dataset(test1))$stardust\_classes}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# the default parameters}
\CommentTok{\#\textquotesingle{}   create\_stardust\_classes()}
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"create\_stardust\_classes"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{,}
                        \AttributeTok{pp.threshold =} \StringTok{"numeric"}\NormalTok{,}
                        \AttributeTok{hierarchy\_priority =} \StringTok{"numeric"}\NormalTok{,}
                        \AttributeTok{position\_isomerism =} \StringTok{"logical"}\NormalTok{,}
                        \AttributeTok{inherit\_dataset =} \StringTok{"logical"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, pp.threshold, hierarchy\_priority,}
\NormalTok{                   position\_isomerism, inherit\_dataset)\{}
            \FunctionTok{.message\_info\_formal}\NormalTok{(}\StringTok{"MCnebula2"}\NormalTok{, }\StringTok{"create\_stardust\_classes"}\NormalTok{)}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(}\FunctionTok{hierarchy}\NormalTok{(x)))}
\NormalTok{              x }\OtherTok{\textless{}{-}} \FunctionTok{create\_hierarchy}\NormalTok{(x)}
\NormalTok{            hierarchy }\OtherTok{\textless{}{-}} \FunctionTok{hierarchy}\NormalTok{(x)}
            \ControlFlowTok{if}\NormalTok{ (inherit\_dataset) \{}
\NormalTok{              dataset }\OtherTok{\textless{}{-}} \FunctionTok{latest}\NormalTok{(x, }\AttributeTok{subscript =} \StringTok{".f3\_canopus"}\NormalTok{)}
\NormalTok{              check }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{distinct}\NormalTok{(dataset, .features\_id, .candidates\_id)}
              \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{any}\NormalTok{( }\FunctionTok{duplicated}\NormalTok{(check[[ }\StringTok{".features\_id"}\NormalTok{ ]]) ))}
                \FunctionTok{stop}\NormalTok{(}\StringTok{"\textasciigrave{}.candidates\_id\textasciigrave{} for features in ppcp dataset were not unique"}\NormalTok{)}
\NormalTok{            \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{              x }\OtherTok{\textless{}{-}} \FunctionTok{filter\_ppcp}\NormalTok{(x, }\AttributeTok{pp.threshold =}\NormalTok{ pp.threshold)}
\NormalTok{              dataset }\OtherTok{\textless{}{-}} \FunctionTok{latest}\NormalTok{(x)}
\NormalTok{            \}}
\NormalTok{            dataset }\OtherTok{\textless{}{-}}
              \FunctionTok{merge}\NormalTok{(dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(dataset, .features\_id, .candidates\_id,}
\NormalTok{                                  pp.value, rel.index),}
\NormalTok{                    hierarchy, }\AttributeTok{by =} \StringTok{"rel.index"}\NormalTok{, }\AttributeTok{all.x =}\NormalTok{ T)}
\NormalTok{            dataset }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(dataset, hierarchy }\SpecialCharTok{\%in\%}\NormalTok{ hierarchy\_priority)}
            \ControlFlowTok{if}\NormalTok{ (position\_isomerism) \{}
\NormalTok{              dataset }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(dataset, }\SpecialCharTok{!}\FunctionTok{grepl}\NormalTok{(}\StringTok{"[0{-}9]"}\NormalTok{, class.name))}
\NormalTok{            \}}
            \FunctionTok{reference}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(x))[[ }\StringTok{"stardust\_classes"}\NormalTok{ ]] }\OtherTok{\textless{}{-}} 
\NormalTok{              dplyr}\SpecialCharTok{::}\FunctionTok{relocate}\NormalTok{(dplyr}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(dataset), .features\_id, .candidates\_id)}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-methods-cross_filter_stardust.r}{%
\section{File: methods-cross\_filter\_stardust.R}\label{file-methods-cross_filter_stardust.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# across attributes of each other features to filter classes}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @aliases cross\_filter\_stardust}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title \textquotesingle{}Cross\textquotesingle{} filter for \textquotesingle{}stardust\_classes\textquotesingle{} data}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} \textquotesingle{}Cross\textquotesingle{} filter for \textquotesingle{}stardust\_classes\textquotesingle{} data.}
\CommentTok{\#\textquotesingle{} Use \textquotesingle{}features\_annotation\textquotesingle{} data and \textquotesingle{}stardust\_classes\textquotesingle{} data for}
\CommentTok{\#\textquotesingle{} chemical classes filtering. Run after [create\_stardust\_classes()].}
\CommentTok{\#\textquotesingle{} Methods \textbackslash{}code\{cross\_filter\_stardust\} are integration of the following three method:}
\CommentTok{\#\textquotesingle{} {-} \textbackslash{}code\{cross\_filter\_quantity\}}
\CommentTok{\#\textquotesingle{} {-} \textbackslash{}code\{cross\_filter\_score\}}
\CommentTok{\#\textquotesingle{} {-} \textbackslash{}code\{cross\_filter\_identical\}}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @details}
\CommentTok{\#\textquotesingle{} Compared to the chemical class filtering within PPCP data by [create\_stardust\_classes()],}
\CommentTok{\#\textquotesingle{} the filtering within \textquotesingle{}stardust\_classes\textquotesingle{} data by [cross\_filter\_stardust()] is}
\CommentTok{\#\textquotesingle{} fundamentally different.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} {-} For [create\_stardust\_classes()],}
\CommentTok{\#\textquotesingle{} the PPCP data belongs to each \textquotesingle{}feature\textquotesingle{}. When performing the filtering,}
\CommentTok{\#\textquotesingle{} only simple threshold conditions or absolute conditions}
\CommentTok{\#\textquotesingle{} are set to filter the chemical classes;}
\CommentTok{\#\textquotesingle{} there is no crossover between the different attributes and}
\CommentTok{\#\textquotesingle{} no crossover between the \textquotesingle{}features\textquotesingle{}.}
\CommentTok{\#\textquotesingle{} Therefore, we consider this as \textquotesingle{}inner\textquotesingle{} filtering.}
\CommentTok{\#\textquotesingle{} {-} For [cross\_filter\_stardust()],}
\CommentTok{\#\textquotesingle{} the data of the chemical classes and their classified \textquotesingle{}features\textquotesingle{}, i.e.}
\CommentTok{\#\textquotesingle{} \textquotesingle{}stardust\_classes\textquotesingle{} data, were combined and then grouped upon the chemical classes.}
\CommentTok{\#\textquotesingle{} After grouping, each chemical class has a certain quantity of "features".}
\CommentTok{\#\textquotesingle{} When filtering, statistics may be performed on \textquotesingle{}features\textquotesingle{} data within a group;}
\CommentTok{\#\textquotesingle{} statistics may be performed on these data in conjunction with \textquotesingle{}features\_annotation\textquotesingle{} data;}
\CommentTok{\#\textquotesingle{} and statistics may be performed to compare groups with each other.}
\CommentTok{\#\textquotesingle{} As its crossover, we consider this as \textquotesingle{}cross\textquotesingle{} filtering.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @param x [mcnebula{-}class] object.}
\CommentTok{\#\textquotesingle{} @param min\_number numeric(1). Value in (1, ).}
\CommentTok{\#\textquotesingle{} For classified \textquotesingle{}features\textquotesingle{} of chemical classes, minimum quantity.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @param max\_ratio numeric(1). Value in (0, 1].}
\CommentTok{\#\textquotesingle{} For classified \textquotesingle{}features\textquotesingle{} of chemical classes,}
\CommentTok{\#\textquotesingle{} maximum proportion: the \textquotesingle{}features\textquotesingle{} quantity versus}
\CommentTok{\#\textquotesingle{} all \textquotesingle{}features\textquotesingle{} (unique) quantity of all classes.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @param types character.}
\CommentTok{\#\textquotesingle{} The target attributes for Goodness assessment. See details.}
\CommentTok{\#\textquotesingle{} There can be plural ones.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @param cutoff numeric. }
\CommentTok{\#\textquotesingle{} For Goodness assessment of target attributes.}
\CommentTok{\#\textquotesingle{} The size of the value depends on the target attribute.}
\CommentTok{\#\textquotesingle{} Note, the \textbackslash{}code\{cutoff\} must be \textquotesingle{}vector\textquotesingle{} the same length as \textbackslash{}code\{types\}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param tolerance numeric. Value in (0, 1).}
\CommentTok{\#\textquotesingle{} For Goodness assessment of target attributes. The thresholds of Goodness.}
\CommentTok{\#\textquotesingle{} Note, the \textbackslash{}code\{tolerance\} must be \textquotesingle{}vector\textquotesingle{} the same length as \textbackslash{}code\{types\}.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @param hierarchy\_range numeric(2).}
\CommentTok{\#\textquotesingle{} The hierarchy range of chemical classification passed for similarity assessment}
\CommentTok{\#\textquotesingle{} of chemical classes. The hierarchy:}
\CommentTok{\#\textquotesingle{} {-} 10: ...}
\CommentTok{\#\textquotesingle{} {-} n: ...}
\CommentTok{\#\textquotesingle{} {-} 5: Classes of Level 5.}
\CommentTok{\#\textquotesingle{} {-} 4: Classes of Subclass.}
\CommentTok{\#\textquotesingle{} {-} 3: Classes of Class.}
\CommentTok{\#\textquotesingle{} {-} 2: Classes of Super Class.}
\CommentTok{\#\textquotesingle{} {-} 1: ...}
\CommentTok{\#\textquotesingle{} {-} 0: ...}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @param identical\_factor numeric(1). Value in (0, 1).}
\CommentTok{\#\textquotesingle{} Threshold value for classes similarity assessment. }
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name cross\_filter\_stardust{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @order 1}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} mcn\_5features}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# the previous steps}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_structure(test)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_reference(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_formula(test1, by\_reference = T)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_stardust\_classes(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_features\_annotation(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# the default parameters}
\CommentTok{\#\textquotesingle{}   cross\_filter\_stardust()}
\CommentTok{\#\textquotesingle{}   \# This is a simulated dataset with only 5 \textquotesingle{}features\textquotesingle{},}
\CommentTok{\#\textquotesingle{}   \# so the default parameters are meaningless for it.}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \# Note that real datasets often contain thousands of "features"}
\CommentTok{\#\textquotesingle{}   \# and the following \textquotesingle{}min\_number\textquotesingle{} and \textquotesingle{}max\_ratio\textquotesingle{} parameter values are not suitable.}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} cross\_filter\_stardust(}
\CommentTok{\#\textquotesingle{}     test1,}
\CommentTok{\#\textquotesingle{}     min\_number = 2,}
\CommentTok{\#\textquotesingle{}     max\_ratio = 1}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   \#\# see results}
\CommentTok{\#\textquotesingle{}   stardust\_classes(test1)}
\CommentTok{\#\textquotesingle{}   \#\# or}
\CommentTok{\#\textquotesingle{}   reference(test1)$stardust\_classes}
\CommentTok{\#\textquotesingle{}   \#\# or}
\CommentTok{\#\textquotesingle{}   reference(mcn\_dataset(test1))$stardust\_classes}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   e1 \textless{}{-} stardust\_classes(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# see the filtered classes}
\CommentTok{\#\textquotesingle{}   backtrack\_stardust(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# reset the \textquotesingle{}stardust\_classes\textquotesingle{}}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_stardust\_classes(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# customized filtering}
\CommentTok{\#\textquotesingle{}   \# Note that real datasets often contain thousands of "features"}
\CommentTok{\#\textquotesingle{}   \# and the following \textquotesingle{}min\_number\textquotesingle{} and \textquotesingle{}max\_ratio\textquotesingle{} parameter values are not suitable.}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} cross\_filter\_quantity(test1, min\_number = 2, max\_ratio = 1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} cross\_filter\_score(test1,}
\CommentTok{\#\textquotesingle{}     types = "tani.score",}
\CommentTok{\#\textquotesingle{}     cutoff = 0.3,}
\CommentTok{\#\textquotesingle{}     tolerance = 0.6}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} cross\_filter\_identical(}
\CommentTok{\#\textquotesingle{}     test1,}
\CommentTok{\#\textquotesingle{}     hierarchy\_range = c(3, 11),}
\CommentTok{\#\textquotesingle{}     identical\_factor = 0.7}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   e2 \textless{}{-} stardust\_classes(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   identical(e1, e2)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# reset}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_stardust\_classes(test1)}
\CommentTok{\#\textquotesingle{}   \#\# targeted plural attributes}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} cross\_filter\_stardust(}
\CommentTok{\#\textquotesingle{}     test1,}
\CommentTok{\#\textquotesingle{}     min\_number = 2,}
\CommentTok{\#\textquotesingle{}     max\_ratio = 1,}
\CommentTok{\#\textquotesingle{}     types = c("tani.score", "csi.score"),}
\CommentTok{\#\textquotesingle{}     cutoff = c(0.3, {-}150),}
\CommentTok{\#\textquotesingle{}     tolerance = c(0.6, 0.3)}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{} \}}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @exportMethod cross\_filter\_stardust}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{cross\_filter\_stardust()\}:}
\CommentTok{\#\textquotesingle{} get the default parameters for the method}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{cross\_filter\_stardust\}.}
\CommentTok{\#\textquotesingle{} @rdname cross\_filter\_stardust{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"cross\_filter\_stardust"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"cross\_filter\_stardust"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"missing"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{()\{}
            \FunctionTok{list}\NormalTok{(}\AttributeTok{min\_number =} \DecValTok{30}\NormalTok{,}
                 \AttributeTok{max\_ratio =} \FloatTok{0.1}\NormalTok{,}
                 \AttributeTok{types =} \StringTok{"tani.score"}\NormalTok{,}
                 \AttributeTok{cutoff =} \FloatTok{0.3}\NormalTok{,}
                 \AttributeTok{tolerance =} \FloatTok{0.6}\NormalTok{,}
                 \AttributeTok{hierarchy\_range =} \FunctionTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{11}\NormalTok{),}
                 \AttributeTok{identical\_factor =} \FloatTok{0.7}
\NormalTok{            )}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod cross\_filter\_stardust}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{cross\_filter\_stardust(x, ...)\}:}
\CommentTok{\#\textquotesingle{} use the default parameters whatever \textquotesingle{}missing\textquotesingle{}}
\CommentTok{\#\textquotesingle{} while performing the method \textbackslash{}code\{cross\_filter\_stardust\}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname cross\_filter\_stardust{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"cross\_filter\_stardust"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, min\_number, max\_ratio,}
\NormalTok{                   types, cutoff, tolerance,}
\NormalTok{                   hierarchy\_range, identical\_factor)\{}
            \FunctionTok{.message\_info\_formal}\NormalTok{(}\StringTok{"MCnebula2"}\NormalTok{, }\StringTok{"cross\_filter\_stardust"}\NormalTok{)}
            \FunctionTok{.check\_data}\NormalTok{(x, }\FunctionTok{list}\NormalTok{(}\AttributeTok{stardust\_classes =} \StringTok{"create\_stardust\_classes"}\NormalTok{))}
\NormalTok{            new\_args }\OtherTok{\textless{}{-}} \FunctionTok{.fresh\_param}\NormalTok{(}\FunctionTok{cross\_filter\_stardust}\NormalTok{())}
\NormalTok{            methods }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"cross\_filter\_quantity"}\NormalTok{, }\StringTok{"cross\_filter\_score"}\NormalTok{,}
                         \StringTok{"cross\_filter\_identical"}\NormalTok{)}
            \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in}\NormalTok{ methods) \{}
\NormalTok{              args }\OtherTok{\textless{}{-}}\NormalTok{ new\_args[}\FunctionTok{names}\NormalTok{(new\_args) }\SpecialCharTok{\%in\%} \FunctionTok{formalArgs}\NormalTok{(i)]}
\NormalTok{              new\_args[[ }\StringTok{"x"}\NormalTok{ ]] }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(}\FunctionTok{match.fun}\NormalTok{(i), args)}
\NormalTok{            \}}
            \FunctionTok{backtrack}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(new\_args[[ }\StringTok{"x"}\NormalTok{ ]]))[[ }\StringTok{"stardust\_classes"}\NormalTok{ ]] }\OtherTok{\textless{}{-}} 
              \FunctionTok{stardust\_classes}\NormalTok{(x)}
            \FunctionTok{return}\NormalTok{(new\_args[[ }\StringTok{"x"}\NormalTok{ ]])}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod cross\_filter\_quantity}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases cross\_filter\_quantity}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{cross\_filter\_quantity\}:}
\CommentTok{\#\textquotesingle{} Filter chemical classes in \textquotesingle{}stardust\_classes\textquotesingle{} data according to:}
\CommentTok{\#\textquotesingle{} {-} Absolute quantity: the classified \textquotesingle{}features\textquotesingle{} of the class.}
\CommentTok{\#\textquotesingle{} {-} Relative proportion: the classified \textquotesingle{}features\textquotesingle{} of the class}
\CommentTok{\#\textquotesingle{} comparing with all features of all classes.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @details}
\CommentTok{\#\textquotesingle{} \textbackslash{}bold\{Cross\_filter\_quantity\}}
\CommentTok{\#\textquotesingle{} Set \textquotesingle{}features\textquotesingle{} quantity limitation for each group.}
\CommentTok{\#\textquotesingle{} The groups with too many \textquotesingle{}features\textquotesingle{} or too few \textquotesingle{}features\textquotesingle{} would be filtered out.}
\CommentTok{\#\textquotesingle{} This means the chemical class would be filtered out.}
\CommentTok{\#\textquotesingle{} These thresholds are about:}
\CommentTok{\#\textquotesingle{} {-} Minimum quantity: the \textquotesingle{}features\textquotesingle{}.}
\CommentTok{\#\textquotesingle{} {-} Maximum proportion: the \textquotesingle{}features\textquotesingle{} quantity versus}
\CommentTok{\#\textquotesingle{} all \textquotesingle{}features\textquotesingle{} (unique) quantity of all groups.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} The purpose of this step is to filter out chemical classes that have}
\CommentTok{\#\textquotesingle{} too large or too subtle a conceptual scope. For example, \textquotesingle{}Organic compounds\textquotesingle{},}
\CommentTok{\#\textquotesingle{} which covers almost all compounds that can be detected in metabolomics data,}
\CommentTok{\#\textquotesingle{} is too large in scope to be of any help to our biological research.}
\CommentTok{\#\textquotesingle{} The setting of parameters is not absolute, and there is no optimal solution.}
\CommentTok{\#\textquotesingle{} Users can draw up thresholds according to the necessity of the study.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname cross\_filter\_stardust{-}methods}
\CommentTok{\#\textquotesingle{}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"cross\_filter\_quantity"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"cross\_filter\_quantity"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{, }\AttributeTok{min\_number =} \StringTok{"numeric"}\NormalTok{,}
                                 \AttributeTok{max\_ratio =} \StringTok{"numeric"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, min\_number, max\_ratio)\{}
            \FunctionTok{.message\_info}\NormalTok{(}\StringTok{"cross\_filter\_stardust"}\NormalTok{, }\StringTok{"quantity"}\NormalTok{)}
            \ControlFlowTok{if}\NormalTok{ (min\_number }\SpecialCharTok{\textless{}} \DecValTok{1}\NormalTok{) \{}
              \FunctionTok{stop}\NormalTok{( }\StringTok{"\textasciigrave{}min\_number\textasciigrave{} must be a numeric greater or equal to 1"}\NormalTok{ )}
\NormalTok{            \}}
            \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\NormalTok{(max\_ratio }\SpecialCharTok{\textless{}=} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ max\_ratio }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{)) \{}
              \FunctionTok{stop}\NormalTok{( }\StringTok{"\textasciigrave{}max\_ratio\textasciigrave{} must be a numeric within (0, 1]"}\NormalTok{ )}
\NormalTok{            \}}
\NormalTok{            sum }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{( }\FunctionTok{unique}\NormalTok{(}\FunctionTok{stardust\_classes}\NormalTok{(x)[[ }\StringTok{".features\_id"}\NormalTok{ ]]) )}
\NormalTok{            set }\OtherTok{\textless{}{-}} \FunctionTok{split}\NormalTok{(}\FunctionTok{stardust\_classes}\NormalTok{(x), }\SpecialCharTok{\textasciitilde{}}\NormalTok{ rel.index)}
\NormalTok{            set }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(set, }\ControlFlowTok{function}\NormalTok{(df)}
                          \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{nrow}\NormalTok{(df) }\SpecialCharTok{\textgreater{}=}\NormalTok{ min\_number }\SpecialCharTok{\&}
                              \FunctionTok{nrow}\NormalTok{(df) }\SpecialCharTok{/}\NormalTok{ sum }\SpecialCharTok{\textless{}=}\NormalTok{ max\_ratio) df)}
            \FunctionTok{reference}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(x))[[ }\StringTok{"stardust\_classes"}\NormalTok{ ]] }\OtherTok{\textless{}{-}} 
\NormalTok{              dplyr}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(set))}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod cross\_filter\_score}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases cross\_filter\_score}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{cross\_filter\_score\}}
\CommentTok{\#\textquotesingle{} Filter chemical classes in \textquotesingle{}stardust\_classes\textquotesingle{} data according to the attributes}
\CommentTok{\#\textquotesingle{} in \textquotesingle{}features\_annotation\textquotesingle{} data.}
\CommentTok{\#\textquotesingle{} Set cut{-}off value of attributes for all \textquotesingle{}features\textquotesingle{}, then inspect overall}
\CommentTok{\#\textquotesingle{} satisfaction of the classified \textquotesingle{}features\textquotesingle{} of the class.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @details}
\CommentTok{\#\textquotesingle{} \textbackslash{}bold\{Cross\_filter\_score\}}
\CommentTok{\#\textquotesingle{} This step associate \textquotesingle{}stardust\_classes\textquotesingle{} data with \textquotesingle{}features\_annotation\textquotesingle{} data.}
\CommentTok{\#\textquotesingle{} For each group, the Goodness assessment is performed}
\CommentTok{\#\textquotesingle{} for each target attribute (continuous attribute, generally be a scoring}
\CommentTok{\#\textquotesingle{} attribute of compound identification, such as \textquotesingle{}tani.score\textquotesingle{}). If the group met all the}
\CommentTok{\#\textquotesingle{} expected Goodness, the chemical class would be retained; otherwise,}
\CommentTok{\#\textquotesingle{} the chemical class would be filtered out.}
\CommentTok{\#\textquotesingle{} The Goodness (G) related with the \textquotesingle{}features\textquotesingle{} within the group:}
\CommentTok{\#\textquotesingle{} {-} n: the quantity of \textquotesingle{}features\textquotesingle{} of which target attributes satisfied with the cut{-}off.}
\CommentTok{\#\textquotesingle{} {-} N: the quantity of all \textquotesingle{}features\textquotesingle{}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} The Goodness: G = n / N.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} The assessment of Goodness is related to the parameters of \textbackslash{}code\{cutoff\}}
\CommentTok{\#\textquotesingle{} and \textbackslash{}code\{tolerance\}:}
\CommentTok{\#\textquotesingle{} {-} Expected Goodness, i.e. value of \textbackslash{}code\{tolerance\}.}
\CommentTok{\#\textquotesingle{} {-} Actual Goodness, related to parameter \textbackslash{}code\{cutoff\}. G = n / N.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} Goodness assessment can be given to plural target attributes.}
\CommentTok{\#\textquotesingle{} Note that the chemical class would retained only if}
\CommentTok{\#\textquotesingle{} it passed the Goodness assessment of all target attributes.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} The main purpose of this step is to filter out those chemical classes with}
\CommentTok{\#\textquotesingle{} too many \textquotesingle{}features\textquotesingle{} of low structural identification.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname cross\_filter\_stardust{-}methods}
\CommentTok{\#\textquotesingle{}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"cross\_filter\_score"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"cross\_filter\_score"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{, }\AttributeTok{types =} \StringTok{"character"}\NormalTok{,}
                                 \AttributeTok{cutoff =} \StringTok{"numeric"}\NormalTok{, }\AttributeTok{tolerance =} \StringTok{"numeric"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, types, cutoff, tolerance)\{}
            \FunctionTok{.message\_info}\NormalTok{(}\StringTok{"cross\_filter\_stardust"}\NormalTok{, }\StringTok{"score"}\NormalTok{)}
            \FunctionTok{.check\_data}\NormalTok{(x, }\FunctionTok{list}\NormalTok{(}\AttributeTok{features\_annotation =} \StringTok{"create\_features\_annotation"}\NormalTok{))}
\NormalTok{            set }\OtherTok{\textless{}{-}} \FunctionTok{split}\NormalTok{(}\FunctionTok{stardust\_classes}\NormalTok{(x), }\AttributeTok{f =} \SpecialCharTok{\textasciitilde{}}\NormalTok{ rel.index)}
\NormalTok{            features }\OtherTok{\textless{}{-}} \FunctionTok{features\_annotation}\NormalTok{(x)}
\NormalTok{            res }\OtherTok{\textless{}{-}} \FunctionTok{mapply}\NormalTok{(types, cutoff, tolerance,}
                          \AttributeTok{SIMPLIFY =}\NormalTok{ F, }\AttributeTok{USE.NAMES =}\NormalTok{ F,}
                          \AttributeTok{FUN =} \ControlFlowTok{function}\NormalTok{(type, cutoff, tolerance)\{}
                            \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.numeric}\NormalTok{(features[[ type ]]))}
                              \FunctionTok{stop}\NormalTok{(}\StringTok{"the columns of \textasciigrave{}types\textasciigrave{} were not numeric"}\NormalTok{)}
\NormalTok{                            express }\OtherTok{\textless{}{-}} \FunctionTok{parse}\NormalTok{(}\AttributeTok{text =}\NormalTok{ type)}
\NormalTok{                            ref }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(features, }\FunctionTok{eval}\NormalTok{(express) }\SpecialCharTok{\textgreater{}=}\NormalTok{ cutoff)}
\NormalTok{                            ref }\OtherTok{\textless{}{-}}\NormalTok{ ref[[ }\StringTok{".features\_id"}\NormalTok{ ]]}
                            \FunctionTok{vapply}\NormalTok{(set, }\AttributeTok{FUN.VALUE =}\NormalTok{ T, }\AttributeTok{USE.NAMES =}\NormalTok{ F,}
                                   \ControlFlowTok{function}\NormalTok{(data)\{}
\NormalTok{                                     ref }\OtherTok{\textless{}{-}}\NormalTok{ ref[ref }\SpecialCharTok{\%in\%}\NormalTok{ data[[ }\StringTok{".features\_id"}\NormalTok{ ]]]}
                                     \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(ref) }\SpecialCharTok{/} \FunctionTok{nrow}\NormalTok{(data) }\SpecialCharTok{\textgreater{}=}\NormalTok{ tolerance)}
                                       \FunctionTok{return}\NormalTok{(T)}
                                     \ControlFlowTok{else}
                                       \FunctionTok{return}\NormalTok{(F)}
\NormalTok{                                   \})}
\NormalTok{                          \})}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(res) }\SpecialCharTok{==} \DecValTok{1}\NormalTok{) \{}
\NormalTok{              set }\OtherTok{\textless{}{-}}\NormalTok{ set[}\FunctionTok{unlist}\NormalTok{(res)]}
\NormalTok{            \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{              logic  }\OtherTok{\textless{}{-}}\NormalTok{ res[[}\DecValTok{1}\NormalTok{]]}
              \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in}\NormalTok{ res[}\DecValTok{2}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(res)]) \{}
\NormalTok{                logic }\OtherTok{\textless{}{-}}\NormalTok{ logic }\SpecialCharTok{\&}\NormalTok{ i}
\NormalTok{              \}}
\NormalTok{              set }\OtherTok{\textless{}{-}}\NormalTok{ set[logic]}
\NormalTok{            \}}
            \FunctionTok{reference}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(x))[[ }\StringTok{"stardust\_classes"}\NormalTok{ ]] }\OtherTok{\textless{}{-}} 
\NormalTok{              dplyr}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(set))}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod cross\_filter\_identical}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases cross\_filter\_identical}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{cross\_filter\_identical\}}
\CommentTok{\#\textquotesingle{} Filter chemical classes in \textquotesingle{}stardust\_classes\textquotesingle{} data by comparing the classified \textquotesingle{}features\textquotesingle{}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @details}
\CommentTok{\#\textquotesingle{} \textbackslash{}bold\{Cross\_filter\_identical\}}
\CommentTok{\#\textquotesingle{} A similarity assessment of chemical classes.}
\CommentTok{\#\textquotesingle{} Set a hierarchical range for chemical classification and let groups (}
\CommentTok{\#\textquotesingle{} each group, i.e. a chemical class with its classified \textquotesingle{}features\textquotesingle{})}
\CommentTok{\#\textquotesingle{} within this range be compared for similarity to each other. For two groups,}
\CommentTok{\#\textquotesingle{} if the classified \textquotesingle{}features\textquotesingle{} almost identical to each other, the chemical}
\CommentTok{\#\textquotesingle{} class represented by one of the groups would be discarded.}
\CommentTok{\#\textquotesingle{} The assessment of identical degree of two groups (A and B):}
\CommentTok{\#\textquotesingle{} {-} x: ratio of the classified \textquotesingle{}features\textquotesingle{} of A belonging to B}
\CommentTok{\#\textquotesingle{} {-} y: ratio of the classified \textquotesingle{}features\textquotesingle{} of B belonging to A}
\CommentTok{\#\textquotesingle{} {-} i: value of parameter \textbackslash{}code\{identical\_factor\}}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} If x \textgreater{} i and y \textgreater{} i, the two groups would be considered as identical.}
\CommentTok{\#\textquotesingle{} Then the group with fewer \textquotesingle{}features\textquotesingle{} would be discarded.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} The purpose of this step is to filter out classes that may incorporate}
\CommentTok{\#\textquotesingle{} each other and are similar in scope. The in silico prediection approach may not be able}
\CommentTok{\#\textquotesingle{} to distinguish which class the potential compound belongs to from the LC{-}MS/MS spectra.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @rdname cross\_filter\_stardust{-}methods}
\CommentTok{\#\textquotesingle{}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"cross\_filter\_identical"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"cross\_filter\_identical"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{, }\AttributeTok{hierarchy\_range =} \StringTok{"numeric"}\NormalTok{,}
                                 \AttributeTok{identical\_factor =} \StringTok{"numeric"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, hierarchy\_range, identical\_factor)\{}
            \FunctionTok{.message\_info}\NormalTok{(}\StringTok{"cross\_filter\_stardust"}\NormalTok{, }\StringTok{"identical"}\NormalTok{)}
\NormalTok{            set }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(}\FunctionTok{stardust\_classes}\NormalTok{(x),}
\NormalTok{                                 hierarchy }\SpecialCharTok{\%in\%}\NormalTok{ hierarchy\_range)}
\NormalTok{            set }\OtherTok{\textless{}{-}} \FunctionTok{split}\NormalTok{(set, }\AttributeTok{f =} \SpecialCharTok{\textasciitilde{}}\NormalTok{ rel.index)}
\NormalTok{            ids }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(set, }\StringTok{\textasciigrave{}}\AttributeTok{[[}\StringTok{\textasciigrave{}}\NormalTok{, }\StringTok{".features\_id"}\NormalTok{)}
\NormalTok{            groups }\OtherTok{\textless{}{-}} \FunctionTok{combn}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(ids), }\DecValTok{2}\NormalTok{, }\AttributeTok{simplify =}\NormalTok{ F)}
\NormalTok{            discard }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(groups,}
                          \ControlFlowTok{function}\NormalTok{(group)\{}
                            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{any}\NormalTok{( ids[group[}\DecValTok{1}\NormalTok{]] }\SpecialCharTok{\%in\%}\NormalTok{ ids[group[}\DecValTok{2}\NormalTok{]] )) \{}
\NormalTok{                              p }\OtherTok{\textless{}{-}} \FunctionTok{mapply}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{),}
                                          \AttributeTok{SIMPLIFY =}\NormalTok{ F,}
                                          \AttributeTok{FUN =} \ControlFlowTok{function}\NormalTok{(x, y)\{}
                                            \FunctionTok{table}\NormalTok{(ids[group[x]] }\SpecialCharTok{\%in\%}\NormalTok{ ids[group[y]])[[ }\StringTok{"TRUE"}\NormalTok{ ]]}
\NormalTok{                                          \})}
                              \ControlFlowTok{if}\NormalTok{ (p[[}\DecValTok{1}\NormalTok{]] }\SpecialCharTok{\textgreater{}}\NormalTok{ identical\_factor }\SpecialCharTok{\&}\NormalTok{ p[[}\DecValTok{2}\NormalTok{]] }\SpecialCharTok{\textgreater{}}\NormalTok{ identical\_factor) \{}
                                \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(ids[group[}\DecValTok{1}\NormalTok{]]) }\SpecialCharTok{\textless{}} \FunctionTok{length}\NormalTok{(ids[group[}\DecValTok{2}\NormalTok{]]))}
                                  \FunctionTok{return}\NormalTok{(group[}\DecValTok{1}\NormalTok{])}
                                \ControlFlowTok{else}
                                  \FunctionTok{return}\NormalTok{(group[}\DecValTok{2}\NormalTok{])}
\NormalTok{                              \}}
\NormalTok{                            \}}
\NormalTok{                          \})}
\NormalTok{            discard\_index }\OtherTok{\textless{}{-}}
              \FunctionTok{unique}\NormalTok{( data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{( set[}\FunctionTok{unlist}\NormalTok{(discard)] )[[ }\StringTok{"rel.index"}\NormalTok{ ]]}
\NormalTok{              )}
            \FunctionTok{reference}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(x))[[ }\StringTok{"stardust\_classes"}\NormalTok{ ]] }\OtherTok{\textless{}{-}} 
\NormalTok{              dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(}\FunctionTok{stardust\_classes}\NormalTok{(x), }\SpecialCharTok{!}\NormalTok{rel.index }\SpecialCharTok{\%in\%}\NormalTok{ discard\_index)}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-methods-filter_formula.r}{%
\section{File: methods-filter\_formula.R}\label{file-methods-filter_formula.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# collate formula dataset in sirius project and do filtering}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @aliases filter\_formula}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Collate and filter candidates of chemical formula for each \textquotesingle{}feature\textquotesingle{}}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description This methods provide an approach to}
\CommentTok{\#\textquotesingle{} collate and filter chemical formula candidates data in baches for each}
\CommentTok{\#\textquotesingle{} \textquotesingle{}feature\textquotesingle{}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @details In SIRIUS project directory, if the computation job has done,}
\CommentTok{\#\textquotesingle{} each \textquotesingle{}feature\textquotesingle{} has multiple prediction candidates whether for chemical formula,}
\CommentTok{\#\textquotesingle{} structure, or classification. This method provides an approach to collate}
\CommentTok{\#\textquotesingle{} and filter these data in baches. See \textbackslash{}link\{MCnebula2\} for details of chemical}
\CommentTok{\#\textquotesingle{} formula, structure and classification.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name filter\_formula{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @order 1}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @exportMethod filter\_formula}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{filter\_formula()\}: get the default parameters for the method}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{filter\_formula\}.}
\CommentTok{\#\textquotesingle{} @rdname filter\_formula{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"filter\_formula"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"filter\_formula"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"missing"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{()\{}
            \FunctionTok{list}\NormalTok{(}\AttributeTok{fun\_filter =}\NormalTok{ .rank\_by\_default,}
                 \AttributeTok{by\_reference =}\NormalTok{ F}
\NormalTok{            )}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod filter\_formula}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{filter\_formula(x, ...)\}: use the default parameters whatever \textquotesingle{}missing\textquotesingle{}}
\CommentTok{\#\textquotesingle{} while performing the method \textbackslash{}code\{filter\_formula\}.}
\CommentTok{\#\textquotesingle{} @rdname filter\_formula{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"filter\_formula"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, fun\_filter, ..., by\_reference)\{}
            \FunctionTok{reCallMethod}\NormalTok{(}\StringTok{"filter\_formula"}\NormalTok{,}
                         \FunctionTok{.fresh\_param}\NormalTok{(}\FunctionTok{filter\_formula}\NormalTok{()), ...)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod filter\_formula}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases filter\_formula}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x [mcnebula{-}class] object.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @param fun\_filter function. Used to filter data.frame. The function would}
\CommentTok{\#\textquotesingle{} run for candidates data (data.frame) for each \textquotesingle{}features\textquotesingle{}. Such as:}
\CommentTok{\#\textquotesingle{} {-} \textbackslash{}code\{lapply(split(all\_data, \textasciitilde{}.features\_id), fun\_filter, ...)\}.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} This parameter provides an elegant and flexible way to filter data.}
\CommentTok{\#\textquotesingle{} Users can pass function [dplyr::filter()] to specify}
\CommentTok{\#\textquotesingle{} any attributes condition to filter the data.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @param ... Other parameters passed to the function \textbackslash{}code\{fun\_filter\}.}
\CommentTok{\#\textquotesingle{} @param by\_reference logical. Use \textbackslash{}code\{specific\_candidate(object)\} data to filter}
\CommentTok{\#\textquotesingle{} candidates data. See [create\_reference()].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname filter\_formula{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} mcn\_5features}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# filter chemical formula candidates}
\CommentTok{\#\textquotesingle{}   \#\# use default parameters}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_formula(test)}
\CommentTok{\#\textquotesingle{}   latest(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# the default parameters:}
\CommentTok{\#\textquotesingle{}   filter\_formula()}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# customized filtering}
\CommentTok{\#\textquotesingle{}   \#\# according to score}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_formula(test1, dplyr::filter, zodiac.score \textgreater{} 0.5)}
\CommentTok{\#\textquotesingle{}   latest(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# get top rank}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_formula(test1, dplyr::filter, rank.formula \textless{}= 3)}
\CommentTok{\#\textquotesingle{}   latest(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# complex filtering}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_formula(}
\CommentTok{\#\textquotesingle{}     test1, dplyr::filter,}
\CommentTok{\#\textquotesingle{}     \#\# molecular formula}
\CommentTok{\#\textquotesingle{}     !grepl("N", mol.formula),}
\CommentTok{\#\textquotesingle{}     \#\# mass error}
\CommentTok{\#\textquotesingle{}     abs(error.mass) \textless{} 0.001}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   latest(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# select columns}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_formula(test1, dplyr::select, 1:5)}
\CommentTok{\#\textquotesingle{}   latest(test1)}
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"filter\_formula"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"filter\_formula"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{,}
                                 \AttributeTok{fun\_filter =} \StringTok{"function"}\NormalTok{,}
                                 \AttributeTok{by\_reference =} \StringTok{"logical"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, fun\_filter, ..., by\_reference)\{}
            \FunctionTok{.message\_info\_formal}\NormalTok{(}\StringTok{"MCnebula2"}\NormalTok{, }\StringTok{"filter\_formula"}\NormalTok{)}
\NormalTok{            subscript }\OtherTok{\textless{}{-}} \StringTok{".f2\_formula"}
\NormalTok{            x }\OtherTok{\textless{}{-}} \FunctionTok{collate\_data}\NormalTok{(x, subscript, .collate\_formula.msframe)}
            \DocumentationTok{\#\# filter}
\NormalTok{            msframe.lst }\OtherTok{\textless{}{-}} \FunctionTok{extract\_rawset}\NormalTok{(x, subscript)}
            \ControlFlowTok{if}\NormalTok{ (by\_reference) \{}
              \FunctionTok{.message\_info}\NormalTok{(}\StringTok{"filter\_formula"}\NormalTok{, }\StringTok{"by\_reference == T"}\NormalTok{,}
                        \StringTok{"}\SpecialCharTok{\textbackslash{}n\textbackslash{}t}\StringTok{case formula, ignore \textasciigrave{}fun\_filter\textasciigrave{}"}\NormalTok{)}
              \FunctionTok{.check\_data}\NormalTok{(x, }\FunctionTok{list}\NormalTok{(}\AttributeTok{specific\_candidate =} \StringTok{"create\_reference"}\NormalTok{))}
\NormalTok{              fun }\OtherTok{\textless{}{-}} \FunctionTok{methods\_match}\NormalTok{(}\FunctionTok{project\_api}\NormalTok{(x))[[ }\StringTok{"generate\_candidates\_id"}\NormalTok{ ]]}
              \FunctionTok{entity}\NormalTok{(msframe.lst[[}\DecValTok{1}\NormalTok{]]) }\OtherTok{\textless{}{-}} 
                \FunctionTok{merge}\NormalTok{(}\FunctionTok{specific\_candidate}\NormalTok{(x),}
                      \FunctionTok{format\_msframe}\NormalTok{(}\FunctionTok{entity}\NormalTok{(msframe.lst[[}\DecValTok{1}\NormalTok{]]), }\AttributeTok{fun\_format =}\NormalTok{ fun),}
                      \AttributeTok{by =} \FunctionTok{c}\NormalTok{(}\StringTok{".features\_id"}\NormalTok{, }\StringTok{".candidates\_id"}\NormalTok{))}
\NormalTok{            \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{              msframe.lst[[}\DecValTok{1}\NormalTok{]] }\OtherTok{\textless{}{-}}
                \FunctionTok{filter\_msframe}\NormalTok{(msframe.lst[[}\DecValTok{1}\NormalTok{]], }\AttributeTok{fun\_filter =}\NormalTok{ fun\_filter,}
                               \AttributeTok{f =} \SpecialCharTok{\textasciitilde{}}\NormalTok{.features\_id, ...)}
\NormalTok{            \}}
            \FunctionTok{mcn\_dataset}\NormalTok{(x) }\OtherTok{\textless{}{-}} \FunctionTok{add\_dataset}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(x), msframe.lst)}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}

\NormalTok{.collate\_formula.msframe }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(x, subscript)\{}
\NormalTok{    msframe }\OtherTok{\textless{}{-}} \FunctionTok{.collate\_data.msframe}\NormalTok{(x, subscript)}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\StringTok{"zodiac.score"} \SpecialCharTok{\%in\%} \FunctionTok{colnames}\NormalTok{(}\FunctionTok{entity}\NormalTok{(msframe))) \{}
      \FunctionTok{warning}\NormalTok{(}\StringTok{"\textasciigrave{}zodiac.score\textasciigrave{} not found in \textasciigrave{}msframe\textasciigrave{}, fill it with \textasciigrave{}zodiac.score\textasciigrave{} = 0"}\NormalTok{)}
      \FunctionTok{entity}\NormalTok{(msframe)}\SpecialCharTok{$}\NormalTok{zodiac.score }\OtherTok{\textless{}{-}} \DecValTok{0}
\NormalTok{    \}}
\NormalTok{    msframe}
\NormalTok{  \}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-methods-filter_ppcp.r}{%
\section{File: methods-filter\_ppcp.R}\label{file-methods-filter_ppcp.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# collate ppcp dataset in sirius project and do filtering}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @aliases filter\_ppcp}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Collate and filter candidates of chemical classification for each \textquotesingle{}feature\textquotesingle{}}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description This methods provide an approach to}
\CommentTok{\#\textquotesingle{} collate and filter chemical classification candidates data in baches for each}
\CommentTok{\#\textquotesingle{} \textquotesingle{}feature\textquotesingle{}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @details }
\CommentTok{\#\textquotesingle{} Filter for PPCP (posterior probability of classification prediction) data.}
\CommentTok{\#\textquotesingle{} See details about classification prediction for compounds:}
\CommentTok{\#\textquotesingle{} \textbackslash{}url\{http://www.nature.com/articles/s41587{-}020{-}0740{-}8\}.}
\CommentTok{\#\textquotesingle{} See other details in [filter\_formula()].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name filter\_ppcp{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @order 1}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @exportMethod filter\_ppcp}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{filter\_ppcp()\}: get the default parameters for the method}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{filter\_ppcp\}.}
\CommentTok{\#\textquotesingle{} @rdname filter\_ppcp{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"filter\_ppcp"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"filter\_ppcp"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"missing"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{()\{}
            \FunctionTok{list}\NormalTok{(}\AttributeTok{fun\_filter =}\NormalTok{ .filter\_ppcp\_by\_threshold,}
                 \AttributeTok{by\_reference =}\NormalTok{ T}
\NormalTok{            )}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod filter\_ppcp}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{filter\_ppcp(x, ...)\}: use the default parameters whatever \textquotesingle{}missing\textquotesingle{}}
\CommentTok{\#\textquotesingle{} while performing the method \textbackslash{}code\{filter\_ppcp\}.}
\CommentTok{\#\textquotesingle{} @rdname filter\_ppcp{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"filter\_ppcp"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, fun\_filter, ..., by\_reference)\{}
            \FunctionTok{reCallMethod}\NormalTok{(}\StringTok{"filter\_ppcp"}\NormalTok{,}
                         \FunctionTok{.fresh\_param}\NormalTok{(}\FunctionTok{filter\_ppcp}\NormalTok{()), ...)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod filter\_ppcp}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases filter\_ppcp}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @inheritParams filter\_formula{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname filter\_ppcp{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} mcn\_5features}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# filter chemical class candidates}
\CommentTok{\#\textquotesingle{}   \#\# the default parameters:}
\CommentTok{\#\textquotesingle{}   filter\_ppcp()}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# if \textquotesingle{}by\_reference\textquotesingle{} set with TRUE, \textquotesingle{}create\_reference\textquotesingle{} should be}
\CommentTok{\#\textquotesingle{}   \#\# run previously.}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_ppcp(test, by\_reference = F)}
\CommentTok{\#\textquotesingle{}   latest(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# customized filtering}
\CommentTok{\#\textquotesingle{}   \#\# according to score}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_ppcp(test1, dplyr::filter, pp.value \textgreater{} 0.5,}
\CommentTok{\#\textquotesingle{}                        by\_reference = F)}
\CommentTok{\#\textquotesingle{}   latest(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# complex filtering}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_ppcp(}
\CommentTok{\#\textquotesingle{}     test1, dplyr::filter,}
\CommentTok{\#\textquotesingle{}     \#\# PPCP value}
\CommentTok{\#\textquotesingle{}     pp.value \textgreater{} 0.5,}
\CommentTok{\#\textquotesingle{}     \#\# speicifid class}
\CommentTok{\#\textquotesingle{}     class.name \%in\% c("Azoles"),}
\CommentTok{\#\textquotesingle{}     by\_reference = F}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   latest(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# select columns}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_ppcp(test1, dplyr::select, 1:5,}
\CommentTok{\#\textquotesingle{}                        by\_reference = F)}
\CommentTok{\#\textquotesingle{}   latest(test1)}
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"filter\_ppcp"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"filter\_ppcp"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{, }\AttributeTok{fun\_filter =} \StringTok{"function"}\NormalTok{,}
                                 \AttributeTok{by\_reference =} \StringTok{"logical"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, fun\_filter, ..., by\_reference)\{}
            \FunctionTok{.message\_info\_formal}\NormalTok{(}\StringTok{"MCnebula2"}\NormalTok{, }\StringTok{"filter\_ppcp"}\NormalTok{)}
            \ControlFlowTok{if}\NormalTok{ (by\_reference) \{}
              \FunctionTok{.message\_info}\NormalTok{(}\StringTok{"filter\_ppcp"}\NormalTok{, }\StringTok{"by\_reference == T"}\NormalTok{)}
              \FunctionTok{.check\_data}\NormalTok{(x, }\FunctionTok{list}\NormalTok{(}\AttributeTok{specific\_candidate =} \StringTok{"create\_reference"}\NormalTok{))}
\NormalTok{            \}}
\NormalTok{            subscript }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{".canopus"}\NormalTok{, }\StringTok{".f3\_canopus"}\NormalTok{)}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{ion\_mode}\NormalTok{(x) }\SpecialCharTok{==} \StringTok{"neg"}\NormalTok{)}
\NormalTok{              subscript[}\DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{".canopus\_neg"}\NormalTok{)}
            \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in}\NormalTok{ subscript) \{}
\NormalTok{              x }\OtherTok{\textless{}{-}} \FunctionTok{get\_metadata}\NormalTok{(x, i)}
              \ControlFlowTok{if}\NormalTok{ (by\_reference }\SpecialCharTok{\&}\NormalTok{ i }\SpecialCharTok{==}\NormalTok{ subscript[}\DecValTok{2}\NormalTok{])}
\NormalTok{                x }\OtherTok{\textless{}{-}} \FunctionTok{collate\_data}\NormalTok{(x, i, }\AttributeTok{reference =} \FunctionTok{specific\_candidate}\NormalTok{(x))}
              \ControlFlowTok{else}
\NormalTok{                x }\OtherTok{\textless{}{-}} \FunctionTok{collate\_data}\NormalTok{(x, i)}
\NormalTok{            \}}
\NormalTok{            annotation }\OtherTok{\textless{}{-}} \FunctionTok{entity}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(x))[[ subscript[}\DecValTok{1}\NormalTok{] ]])}
\NormalTok{            msframe.lst }\OtherTok{\textless{}{-}} \FunctionTok{extract\_rawset}\NormalTok{(x, }\AttributeTok{subscript =}\NormalTok{ subscript[}\DecValTok{2}\NormalTok{])}
            \DocumentationTok{\#\# validate}
            \ControlFlowTok{if}\NormalTok{ ( }\SpecialCharTok{!}\NormalTok{subscript[}\DecValTok{2}\NormalTok{] }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(}\FunctionTok{dataset}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(x))) ) \{}
              \FunctionTok{.message\_info}\NormalTok{(}\StringTok{"filter\_ppcp"}\NormalTok{, }\StringTok{"validate annotation data"}\NormalTok{,}
                        \FunctionTok{paste0}\NormalTok{(subscript, }\AttributeTok{collapse =} \StringTok{" \textgreater{}\textgreater{}\textgreater{} "}\NormalTok{))}
              \FunctionTok{validate\_ppcp\_annotation}\NormalTok{(annotation, msframe.lst)}
              \DocumentationTok{\#\# add annotation into dataset}
\NormalTok{              msframe.lst }\OtherTok{\textless{}{-}} \FunctionTok{merge\_ppcp\_annotation}\NormalTok{(annotation, msframe.lst)}
              \FunctionTok{project\_dataset}\NormalTok{(x) }\OtherTok{\textless{}{-}} \FunctionTok{add\_dataset}\NormalTok{(}\FunctionTok{project\_dataset}\NormalTok{(x), msframe.lst)}
\NormalTok{            \}}
            \DocumentationTok{\#\# filter}
\NormalTok{            msframe.lst[[}\DecValTok{1}\NormalTok{]] }\OtherTok{\textless{}{-}}
              \FunctionTok{filter\_msframe}\NormalTok{(msframe.lst[[}\DecValTok{1}\NormalTok{]], }\AttributeTok{fun\_filter =}\NormalTok{ fun\_filter,}
                             \AttributeTok{f =} \SpecialCharTok{\textasciitilde{}} \FunctionTok{paste0}\NormalTok{(.features\_id, }\StringTok{"\_"}\NormalTok{, .candidates\_id), ...)}
            \FunctionTok{mcn\_dataset}\NormalTok{(x) }\OtherTok{\textless{}{-}} \FunctionTok{add\_dataset}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(x), msframe.lst)}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}

\NormalTok{validate\_ppcp\_annotation }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(annotation, lst)\{}
\NormalTok{    rows }\OtherTok{\textless{}{-}} \FunctionTok{nrow}\NormalTok{(annotation)}
\NormalTok{    lst }\OtherTok{\textless{}{-}} \FunctionTok{split}\NormalTok{(}\FunctionTok{entity}\NormalTok{(lst[[}\DecValTok{1}\NormalTok{]]), }\AttributeTok{f =} \SpecialCharTok{\textasciitilde{}} \FunctionTok{paste0}\NormalTok{(.features\_id, }\StringTok{"\_"}\NormalTok{, .candidates\_id))}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{identical}\NormalTok{( annotation}\SpecialCharTok{$}\NormalTok{rel.index, lst[[}\DecValTok{1}\NormalTok{]]}\SpecialCharTok{$}\NormalTok{rel.index))}
      \FunctionTok{stop}\NormalTok{(}\StringTok{"the annotation not match the classification dataset: 1"}\NormalTok{)}
    \FunctionTok{lapply}\NormalTok{(lst, }\ControlFlowTok{function}\NormalTok{(df)\{}
             \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{nrow}\NormalTok{(df) }\SpecialCharTok{!=}\NormalTok{ rows)}
               \FunctionTok{stop}\NormalTok{(}\StringTok{"the annotation not match the classification dataset"}\NormalTok{)}
\NormalTok{          \})}
\NormalTok{  \}}

\NormalTok{merge\_ppcp\_annotation }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(annotation, msframe.lst)\{}
\NormalTok{    annotation }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(annotation, }\SpecialCharTok{{-}}\NormalTok{.features\_id, }\SpecialCharTok{{-}}\NormalTok{.candidates\_id)}
\NormalTok{    col }\OtherTok{\textless{}{-}} \FunctionTok{colnames}\NormalTok{(annotation)}
\NormalTok{    col }\OtherTok{\textless{}{-}}\NormalTok{ col[}\SpecialCharTok{!}\NormalTok{col }\SpecialCharTok{\%in\%} \FunctionTok{colnames}\NormalTok{(}\FunctionTok{entity}\NormalTok{(msframe.lst[[}\DecValTok{1}\NormalTok{]]))]}
\NormalTok{    annotation }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(annotation, rel.index, dplyr}\SpecialCharTok{::}\FunctionTok{all\_of}\NormalTok{(col))}
    \FunctionTok{entity}\NormalTok{(msframe.lst[[}\DecValTok{1}\NormalTok{]]) }\OtherTok{\textless{}{-}} 
      \FunctionTok{merge}\NormalTok{(}\FunctionTok{entity}\NormalTok{(msframe.lst[[}\DecValTok{1}\NormalTok{]]), annotation,}
            \AttributeTok{by =} \StringTok{"rel.index"}\NormalTok{, }\AttributeTok{all.x =}\NormalTok{ T, }\AttributeTok{sort =}\NormalTok{ F)}
    \FunctionTok{return}\NormalTok{(msframe.lst)}
\NormalTok{  \}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-methods-filter_structure.r}{%
\section{File: methods-filter\_structure.R}\label{file-methods-filter_structure.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# collate structure dataset in sirius project and do filtering}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @aliases filter\_structure}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Collate and filter candidates of chemical structure for each \textquotesingle{}feature\textquotesingle{}}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description This methods provide an approach to}
\CommentTok{\#\textquotesingle{} collate and filter chemical structure candidates data in baches for each}
\CommentTok{\#\textquotesingle{} \textquotesingle{}feature\textquotesingle{}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @details See details in [filter\_formula()].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name filter\_structure{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @order 1}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @exportMethod filter\_structure}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{filter\_structure()\}: get the default parameters for the method}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{filter\_structure\}.}
\CommentTok{\#\textquotesingle{} @rdname filter\_structure{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"filter\_structure"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"filter\_structure"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"missing"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{()\{}
            \FunctionTok{list}\NormalTok{(}\AttributeTok{fun\_filter =}\NormalTok{ .rank\_by\_csi.score,}
                 \AttributeTok{by\_reference =}\NormalTok{ F}
\NormalTok{            )}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod filter\_structure}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{filter\_structure(x, ...)\}: use the default parameters whatever \textquotesingle{}missing\textquotesingle{}}
\CommentTok{\#\textquotesingle{} while performing the method \textbackslash{}code\{filter\_structure\}.}
\CommentTok{\#\textquotesingle{} @rdname filter\_structure{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"filter\_structure"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, fun\_filter, ..., by\_reference)\{}
            \FunctionTok{reCallMethod}\NormalTok{(}\StringTok{"filter\_structure"}\NormalTok{,}
                         \FunctionTok{.fresh\_param}\NormalTok{(}\FunctionTok{filter\_structure}\NormalTok{()), ...)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod filter\_structure}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases filter\_structure}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @inheritParams filter\_formula{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname filter\_structure{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} mcn\_5features}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# filter chemical structure candidates}
\CommentTok{\#\textquotesingle{}   \#\# use default parameters}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_structure(test)}
\CommentTok{\#\textquotesingle{}   latest(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# the default parameters:}
\CommentTok{\#\textquotesingle{}   filter\_structure()}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# customized filtering}
\CommentTok{\#\textquotesingle{}   \#\# according to score}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_structure(test1, dplyr::filter, tani.score \textgreater{} 0.4)}
\CommentTok{\#\textquotesingle{}   latest(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# get top rank}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_structure(test1, dplyr::filter, rank.structure \textless{}= 3)}
\CommentTok{\#\textquotesingle{}   latest(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# complex filtering}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_structure(}
\CommentTok{\#\textquotesingle{}     test1, dplyr::filter,}
\CommentTok{\#\textquotesingle{}     \#\# molecular formula}
\CommentTok{\#\textquotesingle{}     !grepl("N", mol.formula),}
\CommentTok{\#\textquotesingle{}     \#\# Tanimoto similarity}
\CommentTok{\#\textquotesingle{}     tani.score \textgreater{} 0.4}
\CommentTok{\#\textquotesingle{}   )}
\CommentTok{\#\textquotesingle{}   latest(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# select columns}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_structure(test1, dplyr::select, 1:5)}
\CommentTok{\#\textquotesingle{}   latest(test1)}
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"filter\_structure"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"filter\_structure"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{,}
                                 \AttributeTok{fun\_filter =} \StringTok{"function"}\NormalTok{,}
                                 \AttributeTok{by\_reference =} \StringTok{"logical"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, fun\_filter, ..., by\_reference)\{}
            \FunctionTok{.message\_info\_formal}\NormalTok{(}\StringTok{"MCnebula2"}\NormalTok{, }\StringTok{"filter\_structure"}\NormalTok{)}
\NormalTok{            subscript }\OtherTok{\textless{}{-}} \StringTok{".f3\_fingerid"}
\NormalTok{            x }\OtherTok{\textless{}{-}} \FunctionTok{collate\_data}\NormalTok{(x, subscript)}
            \DocumentationTok{\#\# filter}
\NormalTok{            msframe.lst }\OtherTok{\textless{}{-}} \FunctionTok{extract\_rawset}\NormalTok{(x, subscript)}
            \ControlFlowTok{if}\NormalTok{ (by\_reference) \{}
              \FunctionTok{.message\_info}\NormalTok{(}\StringTok{"filter\_structure"}\NormalTok{, }\StringTok{"by\_reference == T"}\NormalTok{)}
              \FunctionTok{.check\_data}\NormalTok{(x, }\FunctionTok{list}\NormalTok{(}\AttributeTok{specific\_candidate =} \StringTok{"create\_reference"}\NormalTok{))}
              \FunctionTok{entity}\NormalTok{(msframe.lst[[}\DecValTok{1}\NormalTok{]]) }\OtherTok{\textless{}{-}} 
                \FunctionTok{merge}\NormalTok{(}\FunctionTok{specific\_candidate}\NormalTok{(x), }\FunctionTok{entity}\NormalTok{(msframe.lst[[}\DecValTok{1}\NormalTok{]]),}
                      \AttributeTok{by =} \FunctionTok{c}\NormalTok{(}\StringTok{".features\_id"}\NormalTok{, }\StringTok{".candidates\_id"}\NormalTok{))}
\NormalTok{            \}}
\NormalTok{            msframe.lst[[}\DecValTok{1}\NormalTok{]] }\OtherTok{\textless{}{-}}
              \FunctionTok{filter\_msframe}\NormalTok{(msframe.lst[[}\DecValTok{1}\NormalTok{]], }\AttributeTok{fun\_filter =}\NormalTok{ fun\_filter,}
                             \AttributeTok{f =} \SpecialCharTok{\textasciitilde{}}\NormalTok{.features\_id, ...)}
            \FunctionTok{mcn\_dataset}\NormalTok{(x) }\OtherTok{\textless{}{-}} \FunctionTok{add\_dataset}\NormalTok{(}\FunctionTok{mcn\_dataset}\NormalTok{(x), msframe.lst)}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-methods-initialize_mcnebula.r}{%
\section{File: methods-initialize\_mcnebula.R}\label{file-methods-initialize_mcnebula.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# set default value for project of MCnebula}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @aliases initialize\_mcnebula}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Initialize mcnebula object}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} Set SIRIUS project path and its version to initialize [mcnebula{-}class] object.}
\CommentTok{\#\textquotesingle{} In addition, the methods can be used for some related object to given}
\CommentTok{\#\textquotesingle{} default value.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name initialize\_mcnebula{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @order 1}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @importFrom methods getFunction}
\CommentTok{\#\textquotesingle{} @exportMethod initialize\_mcnebula}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases initialize\_mcnebula}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x [mcnebula{-}class] object, [melody{-}class] object,}
\CommentTok{\#\textquotesingle{} [project\_conformation{-}class] or [project\_api{-}class] object.}
\CommentTok{\#\textquotesingle{} @param sirius\_version character. e.g., "sirius.v4", "sirius.v5"}
\CommentTok{\#\textquotesingle{} @param sirius\_project character. The path of SIRIUS project space.}
\CommentTok{\#\textquotesingle{} @param output\_directory character. The path for output.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname initialize\_mcnebula{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   \#\# The raw data used for the example}
\CommentTok{\#\textquotesingle{}   tmp \textless{}{-} paste0(tempdir(), "/temp\_data")}
\CommentTok{\#\textquotesingle{}   dir.create(tmp)}
\CommentTok{\#\textquotesingle{}   eg.path \textless{}{-} system.file("extdata", "raw\_instance.tar.gz",}
\CommentTok{\#\textquotesingle{}                          package = "MCnebula2")}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   utils::untar(eg.path, exdir = tmp)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# initialize \textquotesingle{}mcnebula\textquotesingle{} object}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} mcnebula()}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} initialize\_mcnebula(test, "sirius.v4", tmp)}
\CommentTok{\#\textquotesingle{}   \#\# check the setting}
\CommentTok{\#\textquotesingle{}   export\_path(test)}
\CommentTok{\#\textquotesingle{}   palette\_set(test)}
\CommentTok{\#\textquotesingle{}   ion\_mode(test)}
\CommentTok{\#\textquotesingle{}   project\_version(test)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# initialize \textquotesingle{}melody\textquotesingle{} object}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} new("melody")}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} initialize\_mcnebula(test)}
\CommentTok{\#\textquotesingle{}   \#\# check...}
\CommentTok{\#\textquotesingle{}   palette\_stat(test)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# initialize \textquotesingle{}project\_conformation\textquotesingle{} object}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} new("project\_conformation")}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} initialize\_mcnebula(test, "sirius.v4")}
\CommentTok{\#\textquotesingle{}   \#\# check}
\CommentTok{\#\textquotesingle{}   file\_name(test)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# initialize \textquotesingle{}project\_api\textquotesingle{} object}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} new("project\_api")}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} initialize\_mcnebula(test, "sirius.v4")}
\CommentTok{\#\textquotesingle{}   \#\# check}
\CommentTok{\#\textquotesingle{}   methods\_format(test)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   unlink(tmp, T, T)}
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"initialize\_mcnebula"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{,}
                        \AttributeTok{sirius\_version =} \StringTok{"ANY"}\NormalTok{,}
                        \AttributeTok{sirius\_project =} \StringTok{"ANY"}\NormalTok{,}
                        \AttributeTok{output\_directory =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, sirius\_version, sirius\_project, output\_directory)\{}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{missing}\NormalTok{(sirius\_version))}
\NormalTok{              sirius\_version }\OtherTok{\textless{}{-}} \FunctionTok{project\_version}\NormalTok{(x)}
            \ControlFlowTok{else}
              \FunctionTok{project\_version}\NormalTok{(x) }\OtherTok{\textless{}{-}}\NormalTok{ sirius\_version}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{missing}\NormalTok{(sirius\_project))}
\NormalTok{              sirius\_project }\OtherTok{\textless{}{-}} \FunctionTok{project\_path}\NormalTok{(x)}
            \ControlFlowTok{else}
              \FunctionTok{project\_path}\NormalTok{(x) }\OtherTok{\textless{}{-}}\NormalTok{ sirius\_project}
            \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{missing}\NormalTok{(output\_directory)) \{}
              \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(x}\SpecialCharTok{@}\NormalTok{export\_path) }\SpecialCharTok{==} \DecValTok{0}\NormalTok{) \{}
                \FunctionTok{export\_path}\NormalTok{(x) }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(sirius\_project, }\StringTok{"/mcnebula\_results"}\NormalTok{)}
\NormalTok{              \}}
\NormalTok{            \} }\ControlFlowTok{else}\NormalTok{ \{}
              \FunctionTok{export\_path}\NormalTok{(x) }\OtherTok{\textless{}{-}}\NormalTok{ output\_directory}
\NormalTok{            \}}
            \FunctionTok{getFunction}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{".validate\_"}\NormalTok{, sirius\_version),}
                        \AttributeTok{where =} \FunctionTok{parent.env}\NormalTok{(}\FunctionTok{environment}\NormalTok{()))(sirius\_project)}
\NormalTok{            item }\OtherTok{\textless{}{-}} \FunctionTok{methods}\NormalTok{(initialize\_mcnebula)}
\NormalTok{            item }\OtherTok{\textless{}{-}}\NormalTok{ stringr}\SpecialCharTok{::}\FunctionTok{str\_extract}\NormalTok{(item, }\StringTok{"(?\textless{}=,).*(?={-}method)"}\NormalTok{)}
\NormalTok{            item }\OtherTok{\textless{}{-}} \FunctionTok{gsub}\NormalTok{(}\StringTok{",.*$"}\NormalTok{, }\StringTok{""}\NormalTok{, item)}
\NormalTok{            item }\OtherTok{\textless{}{-}}\NormalTok{ item[item }\SpecialCharTok{!=} \StringTok{"mcnebula"}\NormalTok{]}
            \ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in}\NormalTok{ item)\{}
\NormalTok{              express }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(i, }\StringTok{"(x)"}\NormalTok{,}
                                \StringTok{"\textless{}{-} initialize\_mcnebula("}\NormalTok{,}
                                \DocumentationTok{\#\# initialize slot}
\NormalTok{                                i, }\StringTok{"(x)"}\NormalTok{, }\StringTok{", "}\NormalTok{,}
                                \DocumentationTok{\#\# other args}
                                \StringTok{"sirius\_version = sirius\_version,"}\NormalTok{,}
                                \StringTok{"sirius\_project = sirius\_project"}\NormalTok{,}
                                \StringTok{")"}\NormalTok{)}
              \FunctionTok{eval}\NormalTok{( }\FunctionTok{parse}\NormalTok{(}\AttributeTok{text =}\NormalTok{ express) )}
\NormalTok{            \}}
            \FunctionTok{export\_name}\NormalTok{(x) }\OtherTok{\textless{}{-}} \FunctionTok{.get\_export\_name}\NormalTok{()}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod initialize\_mcnebula}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases initialize\_mcnebula}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @seealso [ggsci::pal\_simpsons()], [ggsci::pal\_igv()], [ggsci::pal\_ucscgb()],}
\CommentTok{\#\textquotesingle{} [ggsci::pal\_d3()]...}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname initialize\_mcnebula{-}methods}
\CommentTok{\#\textquotesingle{}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"initialize\_mcnebula"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"melody"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x)\{}
            \DocumentationTok{\#\# set color palette}
            \FunctionTok{palette\_set}\NormalTok{(x) }\OtherTok{\textless{}{-}} \FunctionTok{.get\_color\_set}\NormalTok{()}
            \FunctionTok{palette\_gradient}\NormalTok{(x) }\OtherTok{\textless{}{-}} \FunctionTok{.get\_color\_gradient}\NormalTok{()}
            \FunctionTok{palette\_stat}\NormalTok{(x) }\OtherTok{\textless{}{-}} \FunctionTok{.get\_color\_stat}\NormalTok{()}
            \FunctionTok{palette\_col}\NormalTok{(x) }\OtherTok{\textless{}{-}} \FunctionTok{.get\_color\_col}\NormalTok{()}
            \FunctionTok{palette\_label}\NormalTok{(x) }\OtherTok{\textless{}{-}} \FunctionTok{.get\_label\_color}\NormalTok{()}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod initialize\_mcnebula}
\CommentTok{\#\textquotesingle{} @rdname initialize\_mcnebula{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"initialize\_mcnebula"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"project\_conformation"}\NormalTok{,}
                        \AttributeTok{sirius\_version =} \StringTok{"character"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, sirius\_version)\{}
\NormalTok{            slots }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(}\FunctionTok{attributes}\NormalTok{(x))}
\NormalTok{            slots }\OtherTok{\textless{}{-}}\NormalTok{ slots[}\SpecialCharTok{{-}}\FunctionTok{length}\NormalTok{(slots)]}
            \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in}\NormalTok{ slots) \{}
\NormalTok{              express }\OtherTok{\textless{}{-}} 
                \FunctionTok{paste0}\NormalTok{( i, }\StringTok{"(x)"}\NormalTok{, }\StringTok{"\textless{}{-}"}\NormalTok{, }\StringTok{".get\_"}\NormalTok{, i, }\StringTok{"\_"}\NormalTok{, sirius\_version, }\StringTok{"()"}\NormalTok{)}
              \FunctionTok{eval}\NormalTok{( }\FunctionTok{parse}\NormalTok{(}\AttributeTok{text =}\NormalTok{ express) )}
\NormalTok{            \}}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod initialize\_mcnebula}
\CommentTok{\#\textquotesingle{} @rdname initialize\_mcnebula{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"initialize\_mcnebula"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"project\_api"}\NormalTok{,}
                        \AttributeTok{sirius\_version =} \StringTok{"character"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, sirius\_version)\{}
\NormalTok{            express }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"function(x) format\_msframe("}\NormalTok{,}
                              \StringTok{"x,"}\NormalTok{,}
                              \StringTok{"fun\_names = .get\_attribute\_name\_"}\NormalTok{, sirius\_version, }\StringTok{","}\NormalTok{,}
                              \StringTok{"fun\_types = .get\_attribute\_type\_"}\NormalTok{, sirius\_version, }\StringTok{""}\NormalTok{,}
                              \StringTok{")"}\NormalTok{)}
            \FunctionTok{methods\_format}\NormalTok{(x) }\OtherTok{\textless{}{-}} \FunctionTok{eval}\NormalTok{( }\FunctionTok{parse}\NormalTok{(}\AttributeTok{text =}\NormalTok{ express) )}
\NormalTok{            express }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{".get\_methods\_read\_"}\NormalTok{, sirius\_version, }\StringTok{"()"}\NormalTok{)}
            \FunctionTok{methods\_read}\NormalTok{(x) }\OtherTok{\textless{}{-}} \FunctionTok{eval}\NormalTok{( }\FunctionTok{parse}\NormalTok{(}\AttributeTok{text =}\NormalTok{ express) )}
\NormalTok{            express }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{".get\_methods\_match\_"}\NormalTok{, sirius\_version, }\StringTok{"()"}\NormalTok{)}
            \FunctionTok{methods\_match}\NormalTok{(x) }\OtherTok{\textless{}{-}} \FunctionTok{eval}\NormalTok{( }\FunctionTok{parse}\NormalTok{(}\AttributeTok{text =}\NormalTok{ express) )}
            \FunctionTok{return}\NormalTok{(x)}
\NormalTok{          \})}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-methods-visualize.r}{%
\section{File: methods-visualize.R}\label{file-methods-visualize.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# extract and visualize \textquotesingle{}ggset\textquotesingle{} in \textquotesingle{}mcnebula\textquotesingle{} object}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @aliases visualize}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Visualize Nebulae in R graphic device}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} Methods used for visualization.}
\CommentTok{\#\textquotesingle{} Show chemical Nebulae (either Parent{-}Nebula or Child{-}Nebulae) in R graphic device.}
\CommentTok{\#\textquotesingle{} Run after [activate\_nebulae()]}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name visualize{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @order 1}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @importFrom tibble tibble}
\FunctionTok{setClassUnion}\NormalTok{(}\StringTok{"numeric\_or\_character"}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\StringTok{"numeric"}\NormalTok{, }\StringTok{"character"}\NormalTok{))}

\CommentTok{\#\textquotesingle{} @exportMethod visualize}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{visualize(x)\}: get a \textquotesingle{}tbl\textquotesingle{} about Child{-}Nebulae candidates}
\CommentTok{\#\textquotesingle{} for \textbackslash{}code\{visualize\} methods to visualize.}
\CommentTok{\#\textquotesingle{} @rdname visualize{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"visualize"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"visualize"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{,}
                                 \AttributeTok{fun\_modify =} \StringTok{"ANY"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, fun\_modify)\{}
            \FunctionTok{.message\_info\_formal}\NormalTok{(}\StringTok{"MCnebula2"}\NormalTok{, }\StringTok{"visualize"}\NormalTok{)}
            \FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}t}\StringTok{Specify item as following to visualize:}\SpecialCharTok{\textbackslash{}n\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{            class.name }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(}\FunctionTok{ggset}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x)))}
\NormalTok{            hierarchy }\OtherTok{\textless{}{-}} \FunctionTok{vapply}\NormalTok{(class.name, }\ControlFlowTok{function}\NormalTok{(c, h) h[[c]], }\DecValTok{1}\NormalTok{,}
                                \AttributeTok{h =} \FunctionTok{.get\_hierarchy}\NormalTok{(x))}
\NormalTok{            tibble}\SpecialCharTok{::}\FunctionTok{tibble}\NormalTok{(}\AttributeTok{seq =} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(class.name),}
                           \AttributeTok{hierarchy =}\NormalTok{ hierarchy,}
                           \AttributeTok{class.name =}\NormalTok{ class.name}
\NormalTok{            )}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod visualize}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{visualize()\}: get the default parameters for the method}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{visualize\}.}
\CommentTok{\#\textquotesingle{} @rdname visualize{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"visualize"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"visualize"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{()\{}
            \FunctionTok{list}\NormalTok{(}\AttributeTok{fun\_modify =}\NormalTok{ modify\_set\_labs)}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod visualize}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{visualize(x, ...)\}: use the default parameters whatever \textquotesingle{}missing\textquotesingle{}}
\CommentTok{\#\textquotesingle{} while performing the method \textbackslash{}code\{visualize\}.}
\CommentTok{\#\textquotesingle{} @rdname visualize{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"visualize"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, item, fun\_modify, annotate)\{}
            \FunctionTok{reCallMethod}\NormalTok{(}\StringTok{"visualize"}\NormalTok{, }\FunctionTok{.fresh\_param}\NormalTok{(}\FunctionTok{visualize}\NormalTok{()))}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod visualize}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases visualize}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param item character(1) or numeric(1). If \textbackslash{}code\{character\}, the value should be}
\CommentTok{\#\textquotesingle{} a name of chemical class in \textquotesingle{}nebula\_index\textquotesingle{} data. Its Nebulae has been activated}
\CommentTok{\#\textquotesingle{} via [activate\_nebulae()]. If \textbackslash{}code\{numeric\}, the value should be the sequence of }
\CommentTok{\#\textquotesingle{} Nebulae... Use \textbackslash{}code\{visualize(object)\} to get the optional value.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @param annotate logical. If \textbackslash{}code\{TRUE\}, visualize the Nebula with the annotation.}
\CommentTok{\#\textquotesingle{} Only available [annotate\_nebula()] has been run for the Nebula.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname visualize{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{}   test \textless{}{-} mcn\_5features}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# the previous steps}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_structure(test)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_reference(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} filter\_formula(test1, by\_reference = T)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_stardust\_classes(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_features\_annotation(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} cross\_filter\_stardust(test1, 2, 1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_nebula\_index(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} compute\_spectral\_similarity(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_parent\_nebula(test1, 0.01)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_child\_nebulae(test1, 0.01)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_parent\_layout(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} create\_child\_layouts(test1)}
\CommentTok{\#\textquotesingle{}   test1 \textless{}{-} activate\_nebulae(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# optional Child{-}Nebulae}
\CommentTok{\#\textquotesingle{}   visualize(test1)}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   visualize(test1, "parent")}
\CommentTok{\#\textquotesingle{}   visualize(test1, 1)}
\CommentTok{\#\textquotesingle{}   visualize\_all(test1)}
\CommentTok{\#\textquotesingle{}   \#\# ...}
\CommentTok{\#\textquotesingle{}   }
\CommentTok{\#\textquotesingle{}   \#\# use \textquotesingle{}fun\_modify\textquotesingle{}}
\CommentTok{\#\textquotesingle{}   visualize(test1, 1, modify\_default\_child)}
\CommentTok{\#\textquotesingle{}   visualize(test1, 1, modify\_unify\_scale\_limits)}
\CommentTok{\#\textquotesingle{}   visualize(test1, 1, modify\_set\_labs)}
\CommentTok{\#\textquotesingle{}   \#\# ...}
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"visualize"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"visualize"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{,}
                                 \AttributeTok{item =} \StringTok{"character"}\NormalTok{,}
                                 \AttributeTok{fun\_modify =} \StringTok{"function"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, item, fun\_modify)\{}
            \FunctionTok{.message\_info\_formal}\NormalTok{(}\StringTok{"MCnebula2"}\NormalTok{, }\StringTok{"visualize"}\NormalTok{)}
            \ControlFlowTok{if}\NormalTok{ (item }\SpecialCharTok{==} \StringTok{"parent"}\NormalTok{) \{}
              \FunctionTok{call\_command}\NormalTok{(}\FunctionTok{fun\_modify}\NormalTok{(}\FunctionTok{ggset}\NormalTok{(}\FunctionTok{parent\_nebula}\NormalTok{(x))))}
\NormalTok{            \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{              obj }\OtherTok{\textless{}{-}} \FunctionTok{ggset}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))[[ item ]]}
              \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(obj)) \{}
                \FunctionTok{call\_command}\NormalTok{(}\FunctionTok{fun\_modify}\NormalTok{(obj))}
\NormalTok{              \} }\ControlFlowTok{else}\NormalTok{ \{}
                \FunctionTok{stop}\NormalTok{( }\StringTok{"the \textasciigrave{}item\textasciigrave{} not found in \textasciigrave{}ggset(child\_nebula(x))\textasciigrave{}"}\NormalTok{ )}
\NormalTok{              \}}
\NormalTok{            \}}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod visualize}
\CommentTok{\#\textquotesingle{} @rdname visualize{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"visualize"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"visualize"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{,}
                                 \AttributeTok{item =} \StringTok{"numeric"}\NormalTok{,}
                                 \AttributeTok{fun\_modify =} \StringTok{"function"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, item, fun\_modify)\{}
            \FunctionTok{.message\_info\_formal}\NormalTok{(}\StringTok{"MCnebula2"}\NormalTok{, }\StringTok{"visualize"}\NormalTok{)}
            \FunctionTok{call\_command}\NormalTok{(}\FunctionTok{fun\_modify}\NormalTok{(}\FunctionTok{ggset}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))[[ item ]]))}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod visualize}
\CommentTok{\#\textquotesingle{} @rdname visualize{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"visualize"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"visualize"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{,}
                                 \AttributeTok{item =} \StringTok{"numeric\_or\_character"}\NormalTok{,}
                                 \AttributeTok{fun\_modify =} \StringTok{"function"}\NormalTok{,}
                                 \AttributeTok{annotate =} \StringTok{"logical"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, item, fun\_modify, annotate)\{}
            \ControlFlowTok{if}\NormalTok{ (annotate) \{}
\NormalTok{              obj }\OtherTok{\textless{}{-}} \FunctionTok{ggset\_annotate}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))[[ item ]]}
              \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(obj)) \{}
                \FunctionTok{stop}\NormalTok{( }\StringTok{"the \textasciigrave{}item\textasciigrave{} not found in \textasciigrave{}ggset\_annotate(child\_nebula(x))\textasciigrave{}"}\NormalTok{ )}
\NormalTok{              \} }\ControlFlowTok{else}\NormalTok{ \{}
                \FunctionTok{call\_command}\NormalTok{(}\FunctionTok{fun\_modify}\NormalTok{(obj))}
\NormalTok{              \}}
\NormalTok{            \} }\ControlFlowTok{else}\NormalTok{ \{}
              \FunctionTok{visualize}\NormalTok{(x, item)}
\NormalTok{            \}}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @export get\_ggset}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{get\_ggset\}: similar to \textbackslash{}code\{visualize(...)\}, but get}
\CommentTok{\#\textquotesingle{} [ggset{-}class] object.}
\CommentTok{\#\textquotesingle{} @rdname visualize{-}methods}
\NormalTok{get\_ggset }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, item, fun\_modify, }\AttributeTok{annotate =}\NormalTok{ F) \{}
  \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\NormalTok{annotate) \{}
    \FunctionTok{fun\_modify}\NormalTok{(}\FunctionTok{ggset}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))[[ item ]])}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
    \FunctionTok{fun\_modify}\NormalTok{(}\FunctionTok{ggset\_annotate}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))[[ item ]])}
\NormalTok{  \}}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @exportMethod visualize\_all}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{visualize\_all()\}: get the default parameters for the method}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{visualize\_all\}.}
\CommentTok{\#\textquotesingle{} @rdname visualize{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"visualize\_all"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"visualize\_all"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"missing"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{()\{}
            \FunctionTok{list}\NormalTok{(}\AttributeTok{newpage =}\NormalTok{ T,}
                 \AttributeTok{fun\_modify =}\NormalTok{ modify\_default\_child,}
                 \AttributeTok{legend\_hierarchy =}\NormalTok{ T}
\NormalTok{            )}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @exportMethod visualize\_all}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{visualize\_all(x, ...)\}: use the default parameters whatever \textquotesingle{}missing\textquotesingle{}}
\CommentTok{\#\textquotesingle{} while performing the method \textbackslash{}code\{visualize\_all\}.}
\CommentTok{\#\textquotesingle{} @rdname visualize{-}methods}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"visualize\_all"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, newpage, fun\_modify, legend\_hierarchy)\{}
            \FunctionTok{reCallMethod}\NormalTok{(}\StringTok{"visualize\_all"}\NormalTok{,}
                         \FunctionTok{.fresh\_param}\NormalTok{(}\FunctionTok{visualize\_all}\NormalTok{()))}
\NormalTok{          \})}

\CommentTok{\#\textquotesingle{} @importFrom grid grid.newpage}
\CommentTok{\#\textquotesingle{} @importFrom grid viewport}
\CommentTok{\#\textquotesingle{} @importFrom grid pushViewport}
\CommentTok{\#\textquotesingle{} @importFrom grid upViewport}
\CommentTok{\#\textquotesingle{} @importFrom grid grid.draw}
\CommentTok{\#\textquotesingle{} @exportMethod visualize\_all}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{visualize\_all\}: visualize overall Child{-}Nebulae into R graphic device.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x [mcnebula{-}class] object.}
\CommentTok{\#\textquotesingle{} @param newpage logical. If \textbackslash{}code\{TRUE\}, use [grid::grid.newpage()] before visualization.}
\CommentTok{\#\textquotesingle{} @param fun\_modify function. Used to post modify the [ggset{-}class] object before}
\CommentTok{\#\textquotesingle{} visualization. See [fun\_modify].}
\CommentTok{\#\textquotesingle{} @param legend\_hierarchy logical. If \textbackslash{}code\{TRUE\}, visualize the legend of chemical hierarchy.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname visualize{-}methods}
\CommentTok{\#\textquotesingle{}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"visualize\_all"}\NormalTok{, }
          \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"visualize\_all"}\NormalTok{,}
                                 \AttributeTok{x =} \StringTok{"mcnebula"}\NormalTok{,}
                                 \AttributeTok{newpage =} \StringTok{"logical"}\NormalTok{,}
                                 \AttributeTok{fun\_modify =} \StringTok{"function"}\NormalTok{,}
                                 \AttributeTok{legend\_hierarchy =} \StringTok{"logical"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, newpage, fun\_modify, legend\_hierarchy)\{}
            \FunctionTok{.message\_info\_formal}\NormalTok{(}\StringTok{"MCnebula2"}\NormalTok{, }\StringTok{"visualize\_all"}\NormalTok{)}
\NormalTok{            set }\OtherTok{\textless{}{-}} \FunctionTok{child\_nebulae}\NormalTok{(x)}
            \ControlFlowTok{if}\NormalTok{ (newpage)}
\NormalTok{              grid}\SpecialCharTok{::}\FunctionTok{grid.newpage}\NormalTok{()}
            \FunctionTok{.message\_info\_viewport}\NormalTok{(}\StringTok{"BEGIN"}\NormalTok{)}
\NormalTok{            grid}\SpecialCharTok{::}\FunctionTok{pushViewport}\NormalTok{(}\FunctionTok{panel\_viewport}\NormalTok{(set))}
\NormalTok{            layer }\OtherTok{\textless{}{-}} \DecValTok{1}
            \FunctionTok{.message\_info\_viewport}\NormalTok{()}
            \ControlFlowTok{if}\NormalTok{ (legend\_hierarchy) \{}
              \FunctionTok{.visualize\_legend\_hierarchy}\NormalTok{(set)}
\NormalTok{              layer }\OtherTok{\textless{}{-}}\NormalTok{ layer }\SpecialCharTok{+} \DecValTok{1}
\NormalTok{            \}}
\NormalTok{            layer }\OtherTok{\textless{}{-}}\NormalTok{ layer }\SpecialCharTok{+}
              \FunctionTok{.visualize\_child\_nebulae}\NormalTok{(set, fun\_modify)}
\NormalTok{            grid}\SpecialCharTok{::}\FunctionTok{upViewport}\NormalTok{(layer)}
            \FunctionTok{.message\_info\_viewport}\NormalTok{()}
            \FunctionTok{.visualize\_legend\_nebulae}\NormalTok{(set, fun\_modify)}
            \FunctionTok{.message\_info\_viewport}\NormalTok{(}\StringTok{"END"}\NormalTok{)}
\NormalTok{          \})}

\NormalTok{.visualize\_child\_nebulae }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(set, }\AttributeTok{fun\_modify =}\NormalTok{ modify\_default\_child, x)\{}
\NormalTok{    x }\OtherTok{\textless{}{-}} \FunctionTok{.get\_missing\_x}\NormalTok{(x, }\StringTok{"mcnebula"}\NormalTok{)}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(}\FunctionTok{grid\_layout}\NormalTok{(set))) \{}
\NormalTok{      grid}\SpecialCharTok{::}\FunctionTok{pushViewport}\NormalTok{(grid}\SpecialCharTok{::}\FunctionTok{viewport}\NormalTok{(}\AttributeTok{layout =} \FunctionTok{grid\_layout}\NormalTok{(set)))}
\NormalTok{      layer }\OtherTok{\textless{}{-}} \DecValTok{1}
\NormalTok{    \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{      layer }\OtherTok{\textless{}{-}} \DecValTok{0}
\NormalTok{    \}}
    \FunctionTok{lapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(}\FunctionTok{ggset}\NormalTok{(set)),}
           \ControlFlowTok{function}\NormalTok{(name)\{}
             \FunctionTok{print}\NormalTok{(}\FunctionTok{call\_command}\NormalTok{(}\FunctionTok{fun\_modify}\NormalTok{(}\FunctionTok{ggset}\NormalTok{(set)[[ name ]])),}
                   \AttributeTok{vp =} \FunctionTok{viewports}\NormalTok{(set)[[ name ]],}
                   \AttributeTok{newpage =}\NormalTok{ F)}
\NormalTok{           \})}
    \FunctionTok{return}\NormalTok{(layer)}
\NormalTok{  \}}

\NormalTok{.visualize\_legend\_nebulae }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(set, }\AttributeTok{fun\_modify =}\NormalTok{ modify\_default\_child, x)\{}
\NormalTok{    x }\OtherTok{\textless{}{-}} \FunctionTok{.get\_missing\_x}\NormalTok{(x, }\StringTok{"mcnebula"}\NormalTok{)}
\NormalTok{    grid}\SpecialCharTok{::}\FunctionTok{pushViewport}\NormalTok{(}\FunctionTok{legend\_viewport}\NormalTok{(set))}
    \FunctionTok{.message\_info}\NormalTok{(}\StringTok{"visualize"}\NormalTok{, }\StringTok{"legend:"}\NormalTok{,}
                \FunctionTok{paste0}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n\textbackslash{}t}\StringTok{extract legend from "}\NormalTok{,}
                       \StringTok{"\textasciigrave{}ggset(child\_nebulae(x))[[1]]\textasciigrave{} "}\NormalTok{,}
                       \StringTok{"(nebula names:"}\NormalTok{, }\FunctionTok{names}\NormalTok{(}\FunctionTok{ggset}\NormalTok{(set)[[}\DecValTok{1}\NormalTok{]]), }\StringTok{")."}\NormalTok{,}
                       \StringTok{"}\SpecialCharTok{\textbackslash{}n\textbackslash{}t}\StringTok{In default, legend scales have been unified "}\NormalTok{,}
                       \StringTok{"for all child{-}nebulae."}
\NormalTok{                       ))}
\NormalTok{    ggset }\OtherTok{\textless{}{-}} \FunctionTok{fun\_modify}\NormalTok{(}\FunctionTok{ggset}\NormalTok{(set)[[}\DecValTok{1}\NormalTok{]])}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(}\FunctionTok{attr}\NormalTok{(ggset, }\StringTok{"modify"}\NormalTok{))) \{}
\NormalTok{      ggset }\OtherTok{\textless{}{-}} \FunctionTok{match.fun}\NormalTok{(}\FunctionTok{attr}\NormalTok{(ggset, }\StringTok{"modify"}\NormalTok{))(ggset)}
\NormalTok{    \}}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{any}\NormalTok{(n }\OtherTok{\textless{}{-}} \FunctionTok{grepl}\NormalTok{(}\StringTok{"scale\_fill\_manual"}\NormalTok{, }\FunctionTok{names}\NormalTok{(}\FunctionTok{layers}\NormalTok{(ggset))))) \{}
\NormalTok{      pal }\OtherTok{\textless{}{-}} \FunctionTok{command\_args}\NormalTok{(}\FunctionTok{layers}\NormalTok{(ggset)[n][[}\DecValTok{1}\NormalTok{]])}\SpecialCharTok{$}\NormalTok{values}
      \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(pal)) \{}
\NormalTok{        data }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{tracer =} \FunctionTok{names}\NormalTok{(pal))}
\NormalTok{        layer }\OtherTok{\textless{}{-}} \FunctionTok{new\_command}\NormalTok{(ggplot2}\SpecialCharTok{::}\NormalTok{geom\_point,}
          \AttributeTok{data =}\NormalTok{ data, }\AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ 0L, }\AttributeTok{y =}\NormalTok{ 0L, }\AttributeTok{fill =}\NormalTok{ tracer),}
          \AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{stroke =} \DecValTok{0}
\NormalTok{        )}
\NormalTok{        ggset }\OtherTok{\textless{}{-}} \FunctionTok{add\_layers}\NormalTok{(ggset, layer)}
\NormalTok{      \}}
\NormalTok{    \}}
\NormalTok{    grob }\OtherTok{\textless{}{-}} \FunctionTok{.get\_legend}\NormalTok{(}\FunctionTok{call\_command}\NormalTok{(ggset))}
\NormalTok{    grid}\SpecialCharTok{::}\FunctionTok{grid.draw}\NormalTok{(grob)}
\NormalTok{  \}}

\NormalTok{.visualize\_legend\_hierarchy }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(set, x)\{}
\NormalTok{    x }\OtherTok{\textless{}{-}} \FunctionTok{.get\_missing\_x}\NormalTok{(x, }\StringTok{"mcnebula"}\NormalTok{)}
\NormalTok{    grob }\OtherTok{\textless{}{-}} \FunctionTok{.legend\_hierarchy}\NormalTok{(set)}
    \FunctionTok{pushViewport}\NormalTok{(}\FunctionTok{viewport}\NormalTok{(}\FloatTok{0.5}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FloatTok{0.1}\NormalTok{,}
                          \AttributeTok{just =} \FunctionTok{c}\NormalTok{(}\StringTok{"centre"}\NormalTok{, }\StringTok{"bottom"}\NormalTok{),}
                          \AttributeTok{name =} \StringTok{"legend\_hierarchy"}\NormalTok{))}
    \FunctionTok{.message\_info\_viewport}\NormalTok{()}
\NormalTok{    grid}\SpecialCharTok{::}\FunctionTok{grid.draw}\NormalTok{(grob)}
    \FunctionTok{upViewport}\NormalTok{(}\DecValTok{1}\NormalTok{)}
    \FunctionTok{pushViewport}\NormalTok{(}\FunctionTok{viewport}\NormalTok{(}\FloatTok{0.5}\NormalTok{, }\FloatTok{0.1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FloatTok{0.9}\NormalTok{,}
                          \AttributeTok{just =} \FunctionTok{c}\NormalTok{(}\StringTok{"centre"}\NormalTok{, }\StringTok{"bottom"}\NormalTok{),}
                          \AttributeTok{name =} \StringTok{"sub\_panel"}\NormalTok{))}
    \FunctionTok{.message\_info\_viewport}\NormalTok{()}
\NormalTok{  \}}

\NormalTok{.legend\_hierarchy }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(set, x)\{}
\NormalTok{    x }\OtherTok{\textless{}{-}} \FunctionTok{.get\_missing\_x}\NormalTok{(x, }\StringTok{"mcnebula"}\NormalTok{)}
\NormalTok{    theme }\OtherTok{\textless{}{-}} \FunctionTok{layers}\NormalTok{(}\FunctionTok{ggset}\NormalTok{(set)[[}\DecValTok{1}\NormalTok{]])}\SpecialCharTok{$}\NormalTok{theme}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(theme)) \{}
\NormalTok{      theme }\OtherTok{\textless{}{-}} \FunctionTok{new\_command}\NormalTok{(}\FunctionTok{match.fun}\NormalTok{(}\StringTok{"theme"}\NormalTok{), }\AttributeTok{name =} \StringTok{"theme"}\NormalTok{)}
\NormalTok{    \}}
\NormalTok{    class.names }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(}\FunctionTok{ggset}\NormalTok{(set))}
    \FunctionTok{.check\_data}\NormalTok{(x, }\FunctionTok{list}\NormalTok{(}\StringTok{"hierarchy"} \OtherTok{=} \StringTok{"create\_hierarchy"}\NormalTok{))}
\NormalTok{    hierarchy }\OtherTok{\textless{}{-}} \FunctionTok{.get\_hierarchy}\NormalTok{(x)}
\NormalTok{    hierarchy }\OtherTok{\textless{}{-}} \FunctionTok{vapply}\NormalTok{(class.names, }\ControlFlowTok{function}\NormalTok{(name) hierarchy[[name]], }\DecValTok{1}\NormalTok{)}
\NormalTok{    color }\OtherTok{\textless{}{-}} \FunctionTok{vapply}\NormalTok{(hierarchy, }\ControlFlowTok{function}\NormalTok{(n) }\FunctionTok{palette\_label}\NormalTok{(x)[[n]], }\StringTok{"ch"}\NormalTok{)}
    \FunctionTok{names}\NormalTok{(color) }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"Level "}\NormalTok{, hierarchy)}
    \FunctionTok{.grob\_legend\_hierarchy\_plot}\NormalTok{(color, }\FunctionTok{call\_command}\NormalTok{(theme))}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export visualize\_ids}
\CommentTok{\#\textquotesingle{} @aliases visualize\_ids}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{visualize\_ids\}: Plot a label map about the location of the \textquotesingle{}features\textquotesingle{}.}
\CommentTok{\#\textquotesingle{} @rdname visualize{-}methods}
\NormalTok{visualize\_ids }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, item) \{}
\NormalTok{  data }\OtherTok{\textless{}{-}} \FunctionTok{ggset}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))[[ item ]]}
\NormalTok{  data }\OtherTok{\textless{}{-}} \FunctionTok{command\_args}\NormalTok{(}\FunctionTok{layers}\NormalTok{(data)[[}\DecValTok{1}\NormalTok{]])}\SpecialCharTok{$}\NormalTok{graph}
\NormalTok{  data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(data, }\AttributeTok{.features\_id =}\NormalTok{ name, x, y)}
  \FunctionTok{ggplot}\NormalTok{(data) }\SpecialCharTok{+}
    \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y, }\AttributeTok{label =}\NormalTok{ .features\_id), }\AttributeTok{family =}\NormalTok{ .font) }\SpecialCharTok{+}
    \FunctionTok{theme}\NormalTok{(}\AttributeTok{text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{family =}\NormalTok{ .font))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-project.sirius.v4.r}{%
\section{File: project.sirius.v4.R}\label{file-project.sirius.v4.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# directory and file names and path in SIRIUS 4 project, and some function}
\CommentTok{\# for how to read or format these data.}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\NormalTok{.validate\_sirius.v4 }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(path)\{}
\NormalTok{    sig }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(path, }\StringTok{"/.format"}\NormalTok{)}
\NormalTok{    content }\OtherTok{\textless{}{-}} \StringTok{"\%source\_\%name"}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{file.exists}\NormalTok{(sig)) \{}
      \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{identical}\NormalTok{(}\FunctionTok{readLines}\NormalTok{(sig, }\AttributeTok{warn =}\NormalTok{ F, }\AttributeTok{n =} \DecValTok{1}\NormalTok{), content)) \{}
        \FunctionTok{stop}\NormalTok{(}\StringTok{"the content of file }\SpecialCharTok{\textbackslash{}"}\StringTok{"}\NormalTok{, sig,}
          \StringTok{"}\SpecialCharTok{\textbackslash{}"}\StringTok{ is not identical to }\SpecialCharTok{\textbackslash{}"}\StringTok{"}\NormalTok{, content, }\StringTok{"}\SpecialCharTok{\textbackslash{}"}\StringTok{"}\NormalTok{)}
\NormalTok{      \}}
\NormalTok{    \}}\ControlFlowTok{else}\NormalTok{\{}
      \FunctionTok{stop}\NormalTok{(}\StringTok{"file }\SpecialCharTok{\textbackslash{}"}\StringTok{"}\NormalTok{, sig, }\StringTok{"}\SpecialCharTok{\textbackslash{}"}\StringTok{ not exists"}\NormalTok{)}
\NormalTok{    \}}
\NormalTok{  \}}

\NormalTok{.get\_file\_name\_sirius.v4 }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{()\{}
\NormalTok{    set }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\AttributeTok{.id =} \StringTok{"FUN\_get\_id\_sirius.v4"}\NormalTok{,}
      \AttributeTok{.canopus =} \StringTok{"\^{}canopus.tsv"}\NormalTok{,}
      \AttributeTok{.canopus\_summary =} \StringTok{"canopus\_summary.tsv"}\NormalTok{,}
      \AttributeTok{.compound\_identifications =} \StringTok{"compound\_identifications.tsv"}\NormalTok{,}
      \AttributeTok{.formula\_identifications =} \StringTok{"formula\_identifications.tsv"}\NormalTok{,}
      \AttributeTok{.canopus\_neg =} \StringTok{"canopus\_neg.tsv"}\NormalTok{,}
      \AttributeTok{.csi\_fingerid =} \StringTok{"csi\_fingerid.tsv"}\NormalTok{,}
      \AttributeTok{.csi\_fingerid\_neg =} \StringTok{"csi\_fingerid\_neg.tsv"}\NormalTok{,}
      \AttributeTok{.dir\_canopus =} \StringTok{"\^{}canopus$"}\NormalTok{,}
      \AttributeTok{.dir\_fingerid =} \StringTok{"\^{}fingerid$"}\NormalTok{,}
      \AttributeTok{.dir\_scores =} \StringTok{"\^{}scores$"}\NormalTok{,}
      \AttributeTok{.dir\_spectra =} \StringTok{"\^{}spectra$"}\NormalTok{,}
      \AttributeTok{.f2\_ms =} \StringTok{"spectrum.ms"}\NormalTok{,}
      \AttributeTok{.f2\_msms =} \StringTok{"spectrum.ms"}\NormalTok{,}
      \AttributeTok{.f2\_info =} \StringTok{"compound.info"}\NormalTok{,}
      \AttributeTok{.f2\_formula =} \StringTok{"formula\_candidates.tsv"}\NormalTok{,}
      \AttributeTok{.f3\_canopus =} \StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.fpt$"}\NormalTok{,}
      \AttributeTok{.f3\_fingerid =} \StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.tsv$"}\NormalTok{,}
      \AttributeTok{.f3\_scores =} \StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.info$"}\NormalTok{,}
      \AttributeTok{.f3\_spectra =} \StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.tsv$"}
\NormalTok{    )}
\NormalTok{  \}}

\NormalTok{FUN\_get\_id\_sirius.v4 }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(x)\{}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{missing}\NormalTok{(x))}
      \FunctionTok{return}\NormalTok{(}\StringTok{"\^{}[0{-}9](.*)\_(.*)\_(.*)$"}\NormalTok{)}
\NormalTok{    stringr}\SpecialCharTok{::}\FunctionTok{str\_extract}\NormalTok{(x, }\StringTok{"(?\textless{}=\_)[\^{}\_|\^{}/]\{1,\}(?=/|$)"}\NormalTok{)}
\NormalTok{  \}}

\NormalTok{.get\_file\_api\_sirius.v4 }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{()\{}
\NormalTok{    set }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\AttributeTok{.id =} \StringTok{".id"}\NormalTok{,}
      \AttributeTok{.canopus =} \StringTok{".canopus"}\NormalTok{,}
      \AttributeTok{.canopus\_summary =} \StringTok{".canopus\_summary"}\NormalTok{,}
      \AttributeTok{.compound\_identifications =} \StringTok{".compound\_identifications"}\NormalTok{,}
      \AttributeTok{.formula\_identifications =} \StringTok{".formula\_identifications"}\NormalTok{,}
      \AttributeTok{.canopus\_neg =} \StringTok{".canopus\_neg"}\NormalTok{,}
      \AttributeTok{.csi\_fingerid =} \StringTok{".csi\_fingerid"}\NormalTok{,}
      \AttributeTok{.csi\_fingerid\_neg =} \StringTok{".csi\_fingerid\_neg"}\NormalTok{,}
      \AttributeTok{.dir\_canopus =} \StringTok{".id/.dir\_canopus"}\NormalTok{,}
      \AttributeTok{.dir\_fingerid =} \StringTok{".id/.dir\_fingerid"}\NormalTok{,}
      \AttributeTok{.dir\_scores =} \StringTok{".id/.dir\_scores"}\NormalTok{,}
      \AttributeTok{.dir\_spectra =} \StringTok{".id/.dir\_spectra"}\NormalTok{,}
      \AttributeTok{.f2\_ms =} \StringTok{".id/.f2\_ms"}\NormalTok{,}
      \AttributeTok{.f2\_msms =} \StringTok{".id/.f2\_msms"}\NormalTok{,}
      \AttributeTok{.f2\_info =} \StringTok{".id/.f2\_info"}\NormalTok{,}
      \AttributeTok{.f2\_formula =} \StringTok{".id/.f2\_formula"}\NormalTok{,}
      \AttributeTok{.f3\_canopus =} \StringTok{".id/.dir\_canopus/.f3\_canopus"}\NormalTok{,}
      \AttributeTok{.f3\_fingerid =} \StringTok{".id/.dir\_fingerid/.f3\_fingerid"}\NormalTok{,}
      \AttributeTok{.f3\_scores =} \StringTok{".id/.dir\_scores/.f3\_scores"}\NormalTok{,}
      \AttributeTok{.f3\_spectra =} \StringTok{".id/.dir\_spectra/.f3\_spectra"}
\NormalTok{    )}
\NormalTok{  \}}

\NormalTok{.get\_attribute\_name\_sirius.v4 }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{()\{}
\NormalTok{    set }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
      \DocumentationTok{\#\# .f3\_fingerid}
      \AttributeTok{...sig =} \StringTok{".f3\_fingerid"}\NormalTok{,}
      \AttributeTok{inchikey2d =} \StringTok{"inchikey2D"}\NormalTok{,}
      \AttributeTok{inchi =} \StringTok{"inchi"}\NormalTok{,}
      \AttributeTok{mol.formula =} \StringTok{"molecularFormula"}\NormalTok{,}
      \AttributeTok{rank.structure =} \StringTok{"rank"}\NormalTok{,}
      \AttributeTok{csi.score =} \StringTok{"score"}\NormalTok{,}
      \AttributeTok{synonym =} \StringTok{"name"}\NormalTok{,}
      \AttributeTok{smiles =} \StringTok{"smiles"}\NormalTok{,}
      \AttributeTok{xlogp =} \StringTok{"xlogp"}\NormalTok{,}
      \AttributeTok{pubmed.ids =} \StringTok{"PubMedIds"}\NormalTok{,}
      \AttributeTok{links =} \StringTok{"links"}\NormalTok{,}
      \AttributeTok{tani.score =} \StringTok{"tanimotoSimilarity"}\NormalTok{,}
      \AttributeTok{dbflags =} \StringTok{"dbflags"}\NormalTok{,}
      \DocumentationTok{\#\# .f3\_spectra}
      \AttributeTok{...sig =} \StringTok{".f3\_spectra"}\NormalTok{,}
      \AttributeTok{mz =} \StringTok{"mz"}\NormalTok{,}
      \AttributeTok{int. =} \StringTok{"intensity"}\NormalTok{,}
      \AttributeTok{rel.int. =} \StringTok{"rel.intensity"}\NormalTok{,}
      \AttributeTok{exactmass =} \StringTok{"exactmass"}\NormalTok{,}
      \AttributeTok{formula =} \StringTok{"formula"}\NormalTok{,}
      \AttributeTok{ion. =} \StringTok{"ionization"}\NormalTok{,}
      \DocumentationTok{\#\# .f2\_formula}
      \AttributeTok{...sig =} \StringTok{".f2\_formula"}\NormalTok{,}
      \AttributeTok{adduct =} \StringTok{"adduct"}\NormalTok{,}
      \AttributeTok{pre.formula =} \StringTok{"precursorFormula"}\NormalTok{,}
      \AttributeTok{zodiac.score =} \StringTok{"ZodiacScore"}\NormalTok{,}
      \AttributeTok{sirius.score =} \StringTok{"SiriusScore"}\NormalTok{,}
      \AttributeTok{tree.score =} \StringTok{"TreeScore"}\NormalTok{,}
      \AttributeTok{iso.score =} \StringTok{"IsotopeScore"}\NormalTok{,}
      \AttributeTok{hit.num. =} \StringTok{"numExplainedPeaks"}\NormalTok{,}
      \AttributeTok{hit.int. =} \StringTok{"explainedIntensity"}\NormalTok{,}
      \AttributeTok{error.frag. =} \StringTok{"medianMassErrorFragmentPeaks}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{(ppm}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{)"}\NormalTok{,}
      \AttributeTok{error.abs.frag. =} \StringTok{"medianAbsoluteMassErrorFragmentPeaks}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{(ppm}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{)"}\NormalTok{,}
      \AttributeTok{error.mass =} \StringTok{"massErrorPrecursor}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{(ppm}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{)"}\NormalTok{,}
      \AttributeTok{rank.formula =} \StringTok{"rank"}\NormalTok{,}
      \DocumentationTok{\#\# .f2\_info}
      \AttributeTok{...sig =} \StringTok{".f2\_info"}\NormalTok{,}
      \AttributeTok{rt.secound =} \StringTok{"rt"}\NormalTok{,}
      \AttributeTok{mz =} \StringTok{"ionMass"}\NormalTok{,}
      \DocumentationTok{\#\# .canopus}
      \AttributeTok{...sig =} \StringTok{".canopus"}\NormalTok{,}
      \AttributeTok{rel.index =} \StringTok{"relativeIndex"}\NormalTok{,}
      \AttributeTok{abs.index =} \StringTok{"absoluteIndex"}\NormalTok{,}
      \AttributeTok{chem.ont.id =} \StringTok{"id"}\NormalTok{,}
      \AttributeTok{class.name =} \StringTok{"name"}\NormalTok{,}
      \AttributeTok{parent.chem.ont.id =} \StringTok{"parentId"}\NormalTok{,}
      \AttributeTok{description =} \StringTok{"description"}\NormalTok{,}
      \DocumentationTok{\#\# .canopus\_neg}
      \AttributeTok{...sig =} \StringTok{".canopus\_neg"}\NormalTok{,}
      \AttributeTok{chem.ont.id =} \StringTok{"id"}\NormalTok{,}
      \AttributeTok{class.name =} \StringTok{"name"}\NormalTok{,}
      \DocumentationTok{\#\# .canopus\_summary}
      \AttributeTok{...sig =} \StringTok{".canopus\_summary"}\NormalTok{,}
      \AttributeTok{.id =} \StringTok{"name"}\NormalTok{,}
      \AttributeTok{most.sp.class =} \StringTok{"most specific class"}\NormalTok{,}
      \AttributeTok{level5 =} \StringTok{"level 5"}\NormalTok{,}
      \AttributeTok{subclass =} \StringTok{"subclass"}\NormalTok{,}
      \AttributeTok{class =} \StringTok{"class"}\NormalTok{,}
      \AttributeTok{superclass =} \StringTok{"superclass"}\NormalTok{,}
      \AttributeTok{all.class =} \StringTok{"all classifications"}\NormalTok{,}
      \DocumentationTok{\#\# .compound\_identifications}
      \AttributeTok{...sig =} \StringTok{".compound\_identifications"}\NormalTok{,}
      \AttributeTok{cosmic.score =} \StringTok{"ConfidenceScore"}\NormalTok{,}
      \AttributeTok{.id =} \StringTok{"id"}\NormalTok{,}
      \DocumentationTok{\#\# .f3\_canopus}
      \AttributeTok{...sig =} \StringTok{".f3\_canopus"}\NormalTok{,}
      \AttributeTok{pp.value =} \StringTok{"V1"}\NormalTok{,}
      \AttributeTok{...sig =} \StringTok{"END"}
\NormalTok{    )}
\NormalTok{  \}}

\NormalTok{.get\_attribute\_type\_sirius.v4 }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{()\{}
\NormalTok{    set }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
      \AttributeTok{rank.formula =} \StringTok{"integer"}\NormalTok{,}
      \AttributeTok{rank.structure =} \StringTok{"integer"}\NormalTok{,}
      \AttributeTok{csi.score =} \StringTok{"numeric"}\NormalTok{,}
      \AttributeTok{xlogp =} \StringTok{"numeric"}\NormalTok{,}
      \AttributeTok{tani.score =} \StringTok{"numeric"}\NormalTok{,}
      \AttributeTok{mz =} \StringTok{"numeric"}\NormalTok{,}
      \AttributeTok{rt.secound =} \StringTok{"numeric"}\NormalTok{,}
      \AttributeTok{rt.min =} \StringTok{"numeric"}\NormalTok{,}
      \AttributeTok{int. =} \StringTok{"numeric"}\NormalTok{,}
      \AttributeTok{rel.int. =} \StringTok{"numeric"}\NormalTok{,}
      \AttributeTok{exactmass =} \StringTok{"numeric"}\NormalTok{,}
      \AttributeTok{zodiac.score =} \StringTok{"numeric"}\NormalTok{,}
      \AttributeTok{sirius.score =} \StringTok{"numeric"}\NormalTok{,}
      \AttributeTok{tree.score =} \StringTok{"numeric"}\NormalTok{,}
      \AttributeTok{iso.score =} \StringTok{"numeric"}\NormalTok{,}
      \AttributeTok{hit.num. =} \StringTok{"integer"}\NormalTok{,}
      \AttributeTok{hit.int. =} \StringTok{"numeric"}\NormalTok{,}
      \AttributeTok{error.frag. =} \StringTok{"numeric"}\NormalTok{,}
      \AttributeTok{error.abs.frag. =} \StringTok{"numeric"}\NormalTok{,}
      \AttributeTok{error.mass =} \StringTok{"numeric"}\NormalTok{,}
      \AttributeTok{rel.index =} \StringTok{"integer"}\NormalTok{,}
      \AttributeTok{abs.index =} \StringTok{"integer"}\NormalTok{,}
      \AttributeTok{cosmic.score =} \StringTok{"numeric"}\NormalTok{,}
      \AttributeTok{pp.value =} \StringTok{"numeric"}
\NormalTok{    )}
\NormalTok{  \}}

\NormalTok{.get\_methods\_read\_sirius.v4 }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{()\{}
\NormalTok{    set }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
      \AttributeTok{read.canopus =}\NormalTok{ read\_tsv,}
      \AttributeTok{read.canopus\_summary =}\NormalTok{ read\_tsv,}
      \AttributeTok{read.compound\_identifications =}\NormalTok{ read\_tsv,}
      \AttributeTok{read.formula\_identifications =}\NormalTok{ read\_tsv,}
      \AttributeTok{read.f2\_ms =}\NormalTok{ pbsapply\_read\_tsv,}
      \AttributeTok{read.f2\_msms =}\NormalTok{ pbsapply\_read\_msms,}
      \AttributeTok{read.f2\_formula =}\NormalTok{ pbsapply\_read\_tsv,}
      \AttributeTok{read.f2\_info =}\NormalTok{ pbsapply\_read\_info,}
      \AttributeTok{read.f3\_fingerid =}\NormalTok{ pbsapply\_read\_tsv,}
      \AttributeTok{read.f3\_scores =}\NormalTok{ pbsapply\_read\_tsv,}
      \AttributeTok{read.f3\_spectra =}\NormalTok{ pbsapply\_read\_tsv,}
      \AttributeTok{read.f3\_canopus =}\NormalTok{ .pbsapply\_read\_fpt}
\NormalTok{    )}
\NormalTok{  \}}

\NormalTok{list\_files\_top.sirius.v4 }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(path, pattern)\{}
  \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{files =} \FunctionTok{list.files}\NormalTok{(}\AttributeTok{path =}\NormalTok{ path, }\AttributeTok{pattern =}\NormalTok{ pattern))}
\NormalTok{\}}

\NormalTok{list\_files.sirius.v4 }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(path, upper, pattern, ...)\{}
\NormalTok{  lst\_file }\OtherTok{\textless{}{-}}\NormalTok{ pbapply}\SpecialCharTok{::}\FunctionTok{pbmapply}\NormalTok{(path, upper, pattern, }\AttributeTok{SIMPLIFY =}\NormalTok{ F,}
    \AttributeTok{FUN =} \ControlFlowTok{function}\NormalTok{(path, upper, pattern)\{}
\NormalTok{      files }\OtherTok{\textless{}{-}} \FunctionTok{list.files}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(path, }\StringTok{"/"}\NormalTok{, upper), pattern)}
      \ControlFlowTok{if}\NormalTok{ ( }\FunctionTok{length}\NormalTok{(files) }\SpecialCharTok{==} \DecValTok{0}\NormalTok{)}
        \FunctionTok{return}\NormalTok{( }\FunctionTok{data.frame}\NormalTok{() )}
      \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{upper =}\NormalTok{ upper, }\AttributeTok{files =}\NormalTok{ files)}
\NormalTok{    \})}
\NormalTok{  data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(lst\_file)}
\NormalTok{\}}

\NormalTok{pbsapply\_read\_msms }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(path)\{}
\NormalTok{  pbapply}\SpecialCharTok{::}\FunctionTok{pbsapply}\NormalTok{(path, }\AttributeTok{simplify =}\NormalTok{ F,}
    \ControlFlowTok{function}\NormalTok{(path)\{}
\NormalTok{      lines }\OtherTok{\textless{}{-}} \FunctionTok{readLines}\NormalTok{(path)}
\NormalTok{      start }\OtherTok{\textless{}{-}} \FunctionTok{grep}\NormalTok{(}\StringTok{"\^{}\textgreater{}ms2peaks"}\NormalTok{, lines) }\SpecialCharTok{+} \DecValTok{1}
      \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(start) }\SpecialCharTok{!=} \DecValTok{0}\NormalTok{) \{}
\NormalTok{        lines }\OtherTok{\textless{}{-}}\NormalTok{ lines[start}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(lines)]}
\NormalTok{        data }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{fread}\NormalTok{(}\AttributeTok{text =}\NormalTok{ lines)}
        \FunctionTok{colnames}\NormalTok{(data) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"mz"}\NormalTok{, }\StringTok{"int."}\NormalTok{)}
\NormalTok{      \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{        data }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{mz =} \FunctionTok{double}\NormalTok{(}\DecValTok{0}\NormalTok{), }\AttributeTok{int. =} \FunctionTok{double}\NormalTok{(}\DecValTok{0}\NormalTok{))}
\NormalTok{      \}}
\NormalTok{      data}
\NormalTok{    \}}
\NormalTok{  )}
\NormalTok{\}}

\NormalTok{pbsapply\_read\_info }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(path)\{}
\NormalTok{  pbapply}\SpecialCharTok{::}\FunctionTok{pbsapply}\NormalTok{(path, }\AttributeTok{simplify =}\NormalTok{ F,}
    \ControlFlowTok{function}\NormalTok{(path)\{}
\NormalTok{      lines }\OtherTok{\textless{}{-}} \FunctionTok{readLines}\NormalTok{(path)}
\NormalTok{      lines }\OtherTok{\textless{}{-}}\NormalTok{ lines[}\FunctionTok{grepl}\NormalTok{(}\StringTok{"\^{}ionMass|\^{}rt"}\NormalTok{, lines)]}
      \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{ionMass =}
\NormalTok{        stringr}\SpecialCharTok{::}\FunctionTok{str\_extract}\NormalTok{(lines[}\DecValTok{1}\NormalTok{], }\StringTok{"[0{-}9|.]\{1,\}"}\NormalTok{),}
      \AttributeTok{rt =}\NormalTok{ stringr}\SpecialCharTok{::}\FunctionTok{str\_extract}\NormalTok{(lines[}\DecValTok{2}\NormalTok{], }\StringTok{"[0{-}9|.]\{1,\}"}\NormalTok{)}
\NormalTok{      )}
\NormalTok{    \})}
\NormalTok{\}}

\NormalTok{.pbsapply\_read\_fpt }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(path)\{}
\NormalTok{  pbapply}\SpecialCharTok{::}\FunctionTok{pbsapply}\NormalTok{(path, }\AttributeTok{simplify =}\NormalTok{ F,}
    \ControlFlowTok{function}\NormalTok{(path)\{}
\NormalTok{      df }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{fread}\NormalTok{(path, }\AttributeTok{header =}\NormalTok{ F)}
\NormalTok{      df}\SpecialCharTok{$}\NormalTok{rel.index }\OtherTok{\textless{}{-}} \DecValTok{0}\SpecialCharTok{:}\NormalTok{(}\FunctionTok{nrow}\NormalTok{(df) }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{)}
\NormalTok{      df}
\NormalTok{    \})}
\NormalTok{\}}

\NormalTok{.get\_methods\_match\_sirius.v4 }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{()\{}
\NormalTok{    set }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
      \AttributeTok{match.features\_id =}\NormalTok{ FUN\_get\_id\_sirius.v4,}
      \AttributeTok{match.candidates\_id =} \ControlFlowTok{function}\NormalTok{(x) stringr}\SpecialCharTok{::}\FunctionTok{str\_extract}\NormalTok{(x, }\StringTok{"[\^{}/]*(?=}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.[a{-}z]*$)"}\NormalTok{),}
      \AttributeTok{generate\_candidates\_id =} \ControlFlowTok{function}\NormalTok{(df) \{}
        \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{pre.formula) }\SpecialCharTok{|} \FunctionTok{is.null}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{adduct))}
          \FunctionTok{stop}\NormalTok{( }\StringTok{"columns not found in \textasciigrave{}df\textasciigrave{}"}\NormalTok{ )}
        \FunctionTok{paste0}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{pre.formula, }\StringTok{"\_"}\NormalTok{, }\FunctionTok{gsub}\NormalTok{(}\StringTok{" "}\NormalTok{, }\StringTok{""}\NormalTok{, df}\SpecialCharTok{$}\NormalTok{adduct))}
\NormalTok{      \}}
\NormalTok{    )}
\NormalTok{  \}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-project.sirius.v5.r}{%
\section{File: project.sirius.v5.R}\label{file-project.sirius.v5.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# directory and file names and path in SIRIUS 4 project, and some function}
\CommentTok{\# for how to read or format these data.}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\NormalTok{.validate\_sirius.v5 }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(path)\{}
\NormalTok{    sig }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(path, }\StringTok{"/.format"}\NormalTok{)}
\NormalTok{    content }\OtherTok{\textless{}{-}} \StringTok{"\%source\_\%name"}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{file.exists}\NormalTok{(sig)) \{}
      \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{identical}\NormalTok{(}\FunctionTok{readLines}\NormalTok{(sig, }\AttributeTok{warn =}\NormalTok{ F, }\AttributeTok{n =} \DecValTok{1}\NormalTok{), content)) \{}
        \FunctionTok{stop}\NormalTok{(}\StringTok{"the content of file }\SpecialCharTok{\textbackslash{}"}\StringTok{"}\NormalTok{, sig,}
          \StringTok{"}\SpecialCharTok{\textbackslash{}"}\StringTok{ is not identical to }\SpecialCharTok{\textbackslash{}"}\StringTok{"}\NormalTok{, content, }\StringTok{"}\SpecialCharTok{\textbackslash{}"}\StringTok{"}\NormalTok{)}
\NormalTok{      \}}
\NormalTok{    \}}\ControlFlowTok{else}\NormalTok{\{}
      \FunctionTok{stop}\NormalTok{(}\StringTok{"file }\SpecialCharTok{\textbackslash{}"}\StringTok{"}\NormalTok{, sig, }\StringTok{"}\SpecialCharTok{\textbackslash{}"}\StringTok{ not exists"}\NormalTok{)}
\NormalTok{    \}}
\NormalTok{    sig }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(path, }\StringTok{"/.compression"}\NormalTok{)}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{file.exists}\NormalTok{(sig)) \{}
\NormalTok{      lines }\OtherTok{\textless{}{-}} \FunctionTok{readLines}\NormalTok{(sig, }\AttributeTok{warn =}\NormalTok{ F)}
      \ControlFlowTok{if}\NormalTok{ (lines[}\DecValTok{1}\NormalTok{] }\SpecialCharTok{!=} \StringTok{"compressionLevels}\SpecialCharTok{\textbackslash{}t}\StringTok{1"} \SpecialCharTok{|}
\NormalTok{        lines[}\DecValTok{2}\NormalTok{] }\SpecialCharTok{!=} \StringTok{"compressionMethod}\SpecialCharTok{\textbackslash{}t}\StringTok{DEFLATED"}\NormalTok{)}
        \FunctionTok{stop}\NormalTok{(}\StringTok{"file }\SpecialCharTok{\textbackslash{}"}\StringTok{"}\NormalTok{, sig, }\StringTok{"}\SpecialCharTok{\textbackslash{}"}\StringTok{: Inappropriate compression method."}\NormalTok{)}
\NormalTok{    \}}
\NormalTok{  \}}


\NormalTok{.get\_file\_name\_sirius.v5 }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{()\{}
\NormalTok{    set }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\AttributeTok{.id =} \StringTok{"FUN\_get\_id\_sirius.v5"}\NormalTok{,}
      \AttributeTok{.canopus =} \StringTok{"\^{}canopus.tsv"}\NormalTok{,}
      \AttributeTok{.canopus\_summary =} \StringTok{"canopus\_compound\_summary.tsv"}\NormalTok{,}
      \AttributeTok{.compound\_identifications =} \StringTok{"compound\_identifications.tsv"}\NormalTok{,}
      \AttributeTok{.formula\_identifications =} \StringTok{"formula\_identifications.tsv"}\NormalTok{,}
      \AttributeTok{.canopus\_neg =} \StringTok{"canopus\_neg.tsv"}\NormalTok{,}
      \AttributeTok{.csi\_fingerid =} \StringTok{"csi\_fingerid.tsv"}\NormalTok{,}
      \AttributeTok{.csi\_fingerid\_neg =} \StringTok{"csi\_fingerid\_neg.tsv"}\NormalTok{,}
      \AttributeTok{.zip\_canopus =} \StringTok{"\^{}canopus$"}\NormalTok{,}
      \AttributeTok{.zip\_fingerid =} \StringTok{"\^{}fingerid$"}\NormalTok{,}
      \AttributeTok{.zip\_scores =} \StringTok{"\^{}scores$"}\NormalTok{,}
      \AttributeTok{.zip\_spectra =} \StringTok{"\^{}spectra$"}\NormalTok{,}
      \AttributeTok{.f2\_ms =} \StringTok{"spectrum.ms"}\NormalTok{,}
      \AttributeTok{.f2\_msms =} \StringTok{"spectrum.ms"}\NormalTok{,}
      \AttributeTok{.f2\_info =} \StringTok{"compound.info"}\NormalTok{,}
      \AttributeTok{.f2\_formula =} \StringTok{"formula\_candidates.tsv"}\NormalTok{,}
      \AttributeTok{.f3\_canopus =} \StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.fpt$"}\NormalTok{,}
      \AttributeTok{.f3\_fingerid =} \StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.tsv$"}\NormalTok{,}
      \AttributeTok{.f3\_scores =} \StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.info$"}\NormalTok{,}
      \AttributeTok{.f3\_spectra =} \StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.tsv$"}
\NormalTok{    )}
\NormalTok{  \}}

\NormalTok{FUN\_get\_id\_sirius.v5 }\OtherTok{\textless{}{-}}\NormalTok{FUN\_get\_id\_sirius.v4}

\NormalTok{.get\_file\_api\_sirius.v5 }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{()\{}
\NormalTok{  set }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\AttributeTok{.id =} \StringTok{".id"}\NormalTok{,}
    \AttributeTok{.canopus =} \StringTok{".canopus"}\NormalTok{,}
    \AttributeTok{.canopus\_summary =} \StringTok{".canopus\_summary"}\NormalTok{,}
    \AttributeTok{.compound\_identifications =} \StringTok{".compound\_identifications"}\NormalTok{,}
    \AttributeTok{.formula\_identifications =} \StringTok{".formula\_identifications"}\NormalTok{,}
    \AttributeTok{.canopus\_neg =} \StringTok{".canopus\_neg"}\NormalTok{,}
    \AttributeTok{.csi\_fingerid =} \StringTok{".csi\_fingerid"}\NormalTok{,}
    \AttributeTok{.csi\_fingerid\_neg =} \StringTok{".csi\_fingerid\_neg"}\NormalTok{,}
    \AttributeTok{.zip\_canopus =} \StringTok{".id/.zip\_canopus"}\NormalTok{,}
    \AttributeTok{.zip\_fingerid =} \StringTok{".id/.zip\_fingerid"}\NormalTok{,}
    \AttributeTok{.zip\_scores =} \StringTok{".id/.zip\_scores"}\NormalTok{,}
    \AttributeTok{.zip\_spectra =} \StringTok{".id/.zip\_spectra"}\NormalTok{,}
    \AttributeTok{.f2\_ms =} \StringTok{".id/.f2\_ms"}\NormalTok{,}
    \AttributeTok{.f2\_msms =} \StringTok{".id/.f2\_msms"}\NormalTok{,}
    \AttributeTok{.f2\_info =} \StringTok{".id/.f2\_info"}\NormalTok{,}
    \AttributeTok{.f2\_formula =} \StringTok{".id/.f2\_formula"}\NormalTok{,}
    \AttributeTok{.f3\_canopus =} \StringTok{".id/.zip\_canopus/.f3\_canopus"}\NormalTok{,}
    \AttributeTok{.f3\_fingerid =} \StringTok{".id/.zip\_fingerid/.f3\_fingerid"}\NormalTok{,}
    \AttributeTok{.f3\_scores =} \StringTok{".id/.zip\_scores/.f3\_scores"}\NormalTok{,}
    \AttributeTok{.f3\_spectra =} \StringTok{".id/.zip\_spectra/.f3\_spectra"}
\NormalTok{  )}
\NormalTok{\}}

\NormalTok{.get\_attribute\_name\_sirius.v5 }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{()\{}
\NormalTok{    set }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
      \DocumentationTok{\#\# .f3\_fingerid}
      \AttributeTok{...sig =} \StringTok{".f3\_fingerid"}\NormalTok{,}
      \AttributeTok{inchikey2d =} \StringTok{"inchikey2D"}\NormalTok{,}
      \AttributeTok{inchi =} \StringTok{"inchi"}\NormalTok{,}
      \AttributeTok{mol.formula =} \StringTok{"molecularFormula"}\NormalTok{,}
      \AttributeTok{rank.structure =} \StringTok{"rank"}\NormalTok{,}
      \AttributeTok{csi.score =} \StringTok{"score"}\NormalTok{,}
      \AttributeTok{synonym =} \StringTok{"name"}\NormalTok{,}
      \AttributeTok{smiles =} \StringTok{"smiles"}\NormalTok{,}
      \AttributeTok{xlogp =} \StringTok{"xlogp"}\NormalTok{,}
      \AttributeTok{pubmed.ids =} \StringTok{"PubMedIds"}\NormalTok{,}
      \AttributeTok{links =} \StringTok{"links"}\NormalTok{,}
      \AttributeTok{tani.score =} \StringTok{"tanimotoSimilarity"}\NormalTok{,}
      \AttributeTok{dbflags =} \StringTok{"dbflags"}\NormalTok{,}
      \DocumentationTok{\#\# .f3\_spectra}
      \AttributeTok{...sig =} \StringTok{".f3\_spectra"}\NormalTok{,}
      \AttributeTok{mz =} \StringTok{"mz"}\NormalTok{,}
      \AttributeTok{int. =} \StringTok{"intensity"}\NormalTok{,}
      \AttributeTok{rel.int. =} \StringTok{"rel.intensity"}\NormalTok{,}
      \AttributeTok{exactmass =} \StringTok{"exactmass"}\NormalTok{,}
      \AttributeTok{formula =} \StringTok{"formula"}\NormalTok{,}
      \AttributeTok{ion. =} \StringTok{"ionization"}\NormalTok{,}
      \DocumentationTok{\#\# .f2\_formula}
      \AttributeTok{...sig =} \StringTok{".f2\_formula"}\NormalTok{,}
      \AttributeTok{adduct =} \StringTok{"adduct"}\NormalTok{,}
      \AttributeTok{pre.formula =} \StringTok{"precursorFormula"}\NormalTok{,}
      \AttributeTok{zodiac.score =} \StringTok{"ZodiacScore"}\NormalTok{,}
      \AttributeTok{sirius.score =} \StringTok{"SiriusScore"}\NormalTok{,}
      \AttributeTok{tree.score =} \StringTok{"TreeScore"}\NormalTok{,}
      \AttributeTok{iso.score =} \StringTok{"IsotopeScore"}\NormalTok{,}
      \AttributeTok{hit.num. =} \StringTok{"numExplainedPeaks"}\NormalTok{,}
      \AttributeTok{hit.int. =} \StringTok{"explainedIntensity"}\NormalTok{,}
      \AttributeTok{error.frag. =} \StringTok{"medianMassErrorFragmentPeaks}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{(ppm}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{)"}\NormalTok{,}
      \AttributeTok{error.abs.frag. =} \StringTok{"medianAbsoluteMassErrorFragmentPeaks}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{(ppm}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{)"}\NormalTok{,}
      \AttributeTok{error.mass =} \StringTok{"massErrorPrecursor}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{(ppm}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{)"}\NormalTok{,}
      \AttributeTok{rank.formula =} \StringTok{"rank"}\NormalTok{,}
      \DocumentationTok{\#\# .f2\_info}
      \AttributeTok{...sig =} \StringTok{".f2\_info"}\NormalTok{,}
      \AttributeTok{rt.secound =} \StringTok{"rt"}\NormalTok{,}
      \AttributeTok{mz =} \StringTok{"ionMass"}\NormalTok{,}
      \DocumentationTok{\#\# .canopus}
      \AttributeTok{...sig =} \StringTok{".canopus"}\NormalTok{,}
      \AttributeTok{rel.index =} \StringTok{"relativeIndex"}\NormalTok{,}
      \AttributeTok{abs.index =} \StringTok{"absoluteIndex"}\NormalTok{,}
      \AttributeTok{chem.ont.id =} \StringTok{"id"}\NormalTok{,}
      \AttributeTok{class.name =} \StringTok{"name"}\NormalTok{,}
      \AttributeTok{parent.chem.ont.id =} \StringTok{"parentId"}\NormalTok{,}
      \AttributeTok{description =} \StringTok{"description"}\NormalTok{,}
      \DocumentationTok{\#\# .canopus\_neg}
      \AttributeTok{...sig =} \StringTok{".canopus\_neg"}\NormalTok{,}
      \AttributeTok{chem.ont.id =} \StringTok{"id"}\NormalTok{,}
      \AttributeTok{class.name =} \StringTok{"name"}\NormalTok{,}
      \DocumentationTok{\#\# .canopus\_summary}
      \AttributeTok{...sig =} \StringTok{".canopus\_summary"}\NormalTok{,}
      \AttributeTok{.id =} \StringTok{"id"}\NormalTok{,}
      \AttributeTok{npc\_pathway =} \StringTok{"NPC\#pathway"}\NormalTok{,}
      \AttributeTok{npc\_pathway\_pp =} \StringTok{"NPC\#pathway Probability"}\NormalTok{,}
      \AttributeTok{npc\_superclass =} \StringTok{"NPC\#superclass"}\NormalTok{,}
      \AttributeTok{npc\_superclass\_pp =} \StringTok{"NPC\#superclass Probability"}\NormalTok{,}
      \AttributeTok{npc\_class =} \StringTok{"NPC\#class"}\NormalTok{,}
      \AttributeTok{npc\_class\_pp =} \StringTok{"NPC\#class Probability"}\NormalTok{,}
      \AttributeTok{classyfire\_most\_specific\_class =} \StringTok{"ClassyFire\#most specific class"}\NormalTok{,}
      \AttributeTok{classyfire\_most\_specific\_class\_pp =} \StringTok{"ClassyFire\#most specific class Probability"}\NormalTok{,}
      \AttributeTok{classyfire\_level\_5 =} \StringTok{"ClassyFire\#level 5"}\NormalTok{,}
      \AttributeTok{classyfire\_level\_5\_pp =} \StringTok{"ClassyFire\#level 5 Probability"}\NormalTok{,}
      \AttributeTok{classyfire\_subclass =} \StringTok{"ClassyFire\#subclass"}\NormalTok{,}
      \AttributeTok{classyfire\_subclass\_pp =} \StringTok{"ClassyFire\#subclass Probability"}\NormalTok{,}
      \AttributeTok{classyfire\_class =} \StringTok{"ClassyFire\#class"}\NormalTok{,}
      \AttributeTok{classyfire\_class\_pp =} \StringTok{"ClassyFire\#class Probability"}\NormalTok{,}
      \AttributeTok{classyfire\_superclass =} \StringTok{"ClassyFire\#superclass"}\NormalTok{,}
      \AttributeTok{classyfire\_superclass\_pp =} \StringTok{"ClassyFire\#superclass probability"}\NormalTok{,}
      \AttributeTok{classyfire\_all\_classifications =} \StringTok{"ClassyFire\#all classifications"}\NormalTok{,}
      \DocumentationTok{\#\# .compound\_identifications}
      \AttributeTok{...sig =} \StringTok{".compound\_identifications"}\NormalTok{,}
      \AttributeTok{cosmic.score =} \StringTok{"ConfidenceScore"}\NormalTok{,}
      \AttributeTok{.id =} \StringTok{"id"}\NormalTok{,}
      \DocumentationTok{\#\# .f3\_canopus}
      \AttributeTok{...sig =} \StringTok{".f3\_canopus"}\NormalTok{,}
      \AttributeTok{pp.value =} \StringTok{"V1"}\NormalTok{,}
      \AttributeTok{...sig =} \StringTok{"END"}
\NormalTok{    )}
\NormalTok{  \}}

\NormalTok{.get\_attribute\_type\_sirius.v5 }\OtherTok{\textless{}{-}}\NormalTok{ .get\_attribute\_type\_sirius.v4}

\NormalTok{list\_files\_top.sirius.v5 }\OtherTok{\textless{}{-}}\NormalTok{ list\_files\_top.sirius.v4}

\CommentTok{\#\textquotesingle{} @importFrom utils unzip}
\NormalTok{list\_files.sirius.v5 }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(path, upper, pattern, info)\{}
\NormalTok{  lst\_file }\OtherTok{\textless{}{-}}\NormalTok{ pbapply}\SpecialCharTok{::}\FunctionTok{pbmapply}\NormalTok{(path, upper, pattern, }\AttributeTok{SIMPLIFY =}\NormalTok{ F,}
    \AttributeTok{FUN =} \ControlFlowTok{function}\NormalTok{(path, upper, pattern)\{}
      \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{grepl}\NormalTok{(}\StringTok{"\^{}}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.zip\_"}\NormalTok{, info)) \{}
\NormalTok{        res }\OtherTok{\textless{}{-}} \FunctionTok{try}\NormalTok{(utils}\SpecialCharTok{::}\FunctionTok{unzip}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(path, }\StringTok{"/"}\NormalTok{, upper), }\AttributeTok{list =}\NormalTok{ T), }\AttributeTok{silent =}\NormalTok{ T)}
        \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{inherits}\NormalTok{(res, }\StringTok{"try{-}error"}\NormalTok{)) \{}
\NormalTok{          files }\OtherTok{\textless{}{-}}\NormalTok{ res}\SpecialCharTok{$}\NormalTok{Name}
\NormalTok{          files }\OtherTok{\textless{}{-}}\NormalTok{ files[ }\FunctionTok{grepl}\NormalTok{(pattern, files) ]}
\NormalTok{        \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{          files }\OtherTok{\textless{}{-}} \FunctionTok{integer}\NormalTok{(}\DecValTok{0}\NormalTok{)}
\NormalTok{        \}}
\NormalTok{      \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{        files }\OtherTok{\textless{}{-}} \FunctionTok{list.files}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(path, }\StringTok{"/"}\NormalTok{, upper), pattern)}
\NormalTok{      \}}
      \ControlFlowTok{if}\NormalTok{ ( }\FunctionTok{length}\NormalTok{(files) }\SpecialCharTok{==} \DecValTok{0}\NormalTok{)}
        \FunctionTok{return}\NormalTok{( }\FunctionTok{data.frame}\NormalTok{() )}
      \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{upper =}\NormalTok{ upper, }\AttributeTok{files =}\NormalTok{ files)}
\NormalTok{    \})}
\NormalTok{  data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(lst\_file)}
\NormalTok{\}}

\NormalTok{.get\_methods\_read\_sirius.v5 }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{()\{}
\NormalTok{    set }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
      \AttributeTok{read.canopus =}\NormalTok{ read\_tsv,}
      \AttributeTok{read.canopus\_summary =}\NormalTok{ read\_tsv,}
      \AttributeTok{read.compound\_identifications =}\NormalTok{ read\_tsv,}
      \AttributeTok{read.formula\_identifications =}\NormalTok{ read\_tsv,}
      \AttributeTok{read.f2\_ms =}\NormalTok{ pbsapply\_read\_tsv,}
      \AttributeTok{read.f2\_msms =}\NormalTok{ pbsapply\_read\_msms,}
      \AttributeTok{read.f2\_formula =}\NormalTok{ pbsapply\_read\_tsv,}
      \AttributeTok{read.f2\_info =}\NormalTok{ pbsapply\_read\_info,}
      \AttributeTok{read.f3\_fingerid =}\NormalTok{ pblapply\_read\_tsv\_fromZip,}
      \AttributeTok{read.f3\_scores =}\NormalTok{ pblapply\_read\_tsv\_fromZip,}
      \AttributeTok{read.f3\_spectra =}\NormalTok{ pblapply\_read\_tsv\_fromZip,}
      \AttributeTok{read.f3\_canopus =}\NormalTok{ .pblapply\_read\_fpt\_fromZip}
\NormalTok{    )}
\NormalTok{  \}}

\NormalTok{.pblapply\_read\_fpt\_fromZip }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(path) \{}
  \FunctionTok{pblapply\_read\_tsv\_fromZip}\NormalTok{(path,}
    \ControlFlowTok{function}\NormalTok{(path) \{}
\NormalTok{      df }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{fread}\NormalTok{(path, }\AttributeTok{header =}\NormalTok{ F)}
\NormalTok{      df}\SpecialCharTok{$}\NormalTok{rel.index }\OtherTok{\textless{}{-}} \DecValTok{0}\SpecialCharTok{:}\NormalTok{(}\FunctionTok{nrow}\NormalTok{(df) }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{)}
\NormalTok{      df}
\NormalTok{    \})}
\NormalTok{\}}

\NormalTok{pblapply\_read\_tsv\_fromZip }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(path, }\AttributeTok{fun =}\NormalTok{ read\_tsv) \{}
\NormalTok{  zips }\OtherTok{\textless{}{-}} \FunctionTok{gsub}\NormalTok{(}\StringTok{"/[\^{}/]*$"}\NormalTok{, }\StringTok{""}\NormalTok{, path)}
\NormalTok{  files }\OtherTok{\textless{}{-}}\NormalTok{ stringr}\SpecialCharTok{::}\FunctionTok{str\_extract}\NormalTok{(path, }\StringTok{"[\^{}/]*$"}\NormalTok{)}
\NormalTok{  lst\_files }\OtherTok{\textless{}{-}} \FunctionTok{split}\NormalTok{(files, zips)}
\NormalTok{  zips }\OtherTok{\textless{}{-}} \FunctionTok{unique}\NormalTok{(zips)}
\NormalTok{  lst\_files }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(zips, }\ControlFlowTok{function}\NormalTok{(name) lst\_files[[ name ]])}
\NormalTok{  zip\_upper }\OtherTok{\textless{}{-}} \FunctionTok{gsub}\NormalTok{(}\StringTok{"/[\^{}/]*$"}\NormalTok{, }\StringTok{""}\NormalTok{, zips)}
\NormalTok{  zip\_name }\OtherTok{\textless{}{-}}\NormalTok{ stringr}\SpecialCharTok{::}\FunctionTok{str\_extract}\NormalTok{(zips, }\StringTok{"[\^{}/]*$"}\NormalTok{)}
\NormalTok{  exdir }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(zip\_upper, }\StringTok{"/.temp\_"}\NormalTok{, zip\_name)}
\NormalTok{  lst }\OtherTok{\textless{}{-}}\NormalTok{ pbapply}\SpecialCharTok{::}\FunctionTok{pblapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(lst\_files),}
    \ControlFlowTok{function}\NormalTok{(n) \{}
\NormalTok{      utils}\SpecialCharTok{::}\FunctionTok{unzip}\NormalTok{(zips[n], }\AttributeTok{exdir =}\NormalTok{ exdir[n])}
\NormalTok{      files }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(exdir[n], }\StringTok{"/"}\NormalTok{, lst\_files[[ n ]])}
\NormalTok{      lst }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(files, fun)}
      \FunctionTok{unlink}\NormalTok{(exdir[n], T)}
      \FunctionTok{return}\NormalTok{(lst)}
\NormalTok{    \})}
\NormalTok{  lst }\OtherTok{\textless{}{-}} \FunctionTok{unlist}\NormalTok{(lst, F)}
  \FunctionTok{names}\NormalTok{(lst) }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(zips, }\StringTok{"/"}\NormalTok{, }\FunctionTok{unlist}\NormalTok{(lst\_files))}
  \FunctionTok{return}\NormalTok{(lst)}
\NormalTok{\}}

\NormalTok{.get\_methods\_match\_sirius.v5 }\OtherTok{\textless{}{-}}\NormalTok{ .get\_methods\_match\_sirius.v4}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-tools-colors.r}{%
\section{File: tools-colors.R}\label{file-tools-colors.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# Get hexadecimal color with ggsci package}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @importFrom ggsci pal\_simpsons}
\CommentTok{\#\textquotesingle{} @importFrom ggsci pal\_igv}
\CommentTok{\#\textquotesingle{} @importFrom ggsci pal\_ucscgb}
\CommentTok{\#\textquotesingle{} @importFrom ggsci pal\_d3}
\NormalTok{.get\_color\_set }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{()\{}
    \FunctionTok{unique}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\FunctionTok{rev}\NormalTok{(ggsci}\SpecialCharTok{::}\FunctionTok{pal\_d3}\NormalTok{(}\StringTok{"category20"}\NormalTok{)(}\DecValTok{20}\NormalTok{))[}\SpecialCharTok{{-}}\DecValTok{3}\NormalTok{],}
\NormalTok{             ggsci}\SpecialCharTok{::}\FunctionTok{pal\_simpsons}\NormalTok{()(}\DecValTok{16}\NormalTok{)[}\SpecialCharTok{{-}}\DecValTok{3}\NormalTok{],}
\NormalTok{             ggsci}\SpecialCharTok{::}\FunctionTok{pal\_ucscgb}\NormalTok{()(}\DecValTok{6}\NormalTok{)}
\NormalTok{             ))}
\NormalTok{  \}}

\NormalTok{.get\_color\_col }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{()\{}
    \FunctionTok{unique}\NormalTok{(}\FunctionTok{c}\NormalTok{(ggsci}\SpecialCharTok{::}\FunctionTok{pal\_simpsons}\NormalTok{()(}\DecValTok{16}\NormalTok{),}
\NormalTok{             ggsci}\SpecialCharTok{::}\FunctionTok{pal\_igv}\NormalTok{(}\StringTok{"default"}\NormalTok{)(}\DecValTok{51}\NormalTok{),}
\NormalTok{             ggsci}\SpecialCharTok{::}\FunctionTok{pal\_ucscgb}\NormalTok{()(}\DecValTok{26}\NormalTok{),}
\NormalTok{             ggsci}\SpecialCharTok{::}\FunctionTok{pal\_d3}\NormalTok{(}\StringTok{"category20"}\NormalTok{)(}\DecValTok{20}\NormalTok{)}
\NormalTok{             ))}
\NormalTok{  \}}

\NormalTok{.get\_color\_gradient }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{()\{}
    \FunctionTok{c}\NormalTok{(}\StringTok{"\#D5E4A2FF"}\NormalTok{, }\StringTok{"\#FFCD00FF"}\NormalTok{, }\StringTok{"\#EEA236FF"}\NormalTok{, }\StringTok{"\#FB6467FF"}\NormalTok{, }\StringTok{"\#9467BDFF"}\NormalTok{)}
\NormalTok{  \}}

\NormalTok{.get\_label\_color }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{()\{}
    \FunctionTok{colorRampPalette}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"\#C6DBEFFF"}\NormalTok{, }\StringTok{"\#3182BDFF"}\NormalTok{, }\StringTok{"red"}\NormalTok{))(}\DecValTok{10}\NormalTok{)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @importFrom ggsci pal\_locuszoom}
\NormalTok{.get\_color\_stat }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{()\{}
\NormalTok{    col }\OtherTok{\textless{}{-}}\NormalTok{ ggsci}\SpecialCharTok{::}\FunctionTok{pal\_locuszoom}\NormalTok{()(}\DecValTok{7}\NormalTok{)}
    \FunctionTok{vapply}\NormalTok{(col, .depigment\_col, }\StringTok{"ch"}\NormalTok{, }\AttributeTok{USE.NAMES =}\NormalTok{ F)}
\NormalTok{  \}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-tools-default_visualize.r}{%
\section{File: tools-default\_visualize.R}\label{file-tools-default_visualize.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# functions to get \textquotesingle{}command\textquotesingle{} of ggplot, grob for visualizing nebulae}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @importFrom ggraph geom\_edge\_fan}
\CommentTok{\#\textquotesingle{} @importFrom ggraph geom\_node\_point}
\CommentTok{\#\textquotesingle{} @importFrom ggraph scale\_edge\_width}
\CommentTok{\#\textquotesingle{} @importFrom stringr str\_wrap}
\CommentTok{\#\textquotesingle{} @importFrom stringr str\_wrap}
\NormalTok{.command\_parent\_edge }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(}\AttributeTok{edge\_color =} \StringTok{"lightblue"}\NormalTok{)\{}
  \FunctionTok{new\_command}\NormalTok{(ggraph}\SpecialCharTok{::}\NormalTok{geom\_edge\_fan,}
              \FunctionTok{aes}\NormalTok{(}\AttributeTok{edge\_width =}\NormalTok{ similarity),}
              \AttributeTok{color =}\NormalTok{ edge\_color}
\NormalTok{  )}
\NormalTok{\}}

\NormalTok{.command\_parent\_node }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{()\{}
  \FunctionTok{new\_command}\NormalTok{(ggraph}\SpecialCharTok{::}\NormalTok{geom\_node\_point,}
              \FunctionTok{aes}\NormalTok{(}\AttributeTok{size =} \FunctionTok{ifelse}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(tani.score), }\FloatTok{0.2}\NormalTok{, tani.score),}
                  \AttributeTok{fill =}\NormalTok{ mz),}
              \AttributeTok{shape =} \DecValTok{21}\NormalTok{)}
\NormalTok{\}}

\NormalTok{.command\_parent\_fill }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(pal)\{}
  \FunctionTok{new\_command}\NormalTok{(scale\_fill\_gradientn, }\AttributeTok{colours =}\NormalTok{ pal, }\AttributeTok{na.value =} \StringTok{"white"}\NormalTok{)}
\NormalTok{\}}

\NormalTok{.command\_parent\_fill2 }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(pal)\{}
  \FunctionTok{new\_command}\NormalTok{(scale\_fill\_manual, }\AttributeTok{values =}\NormalTok{ pal)}
\NormalTok{\}}

\NormalTok{.command\_parent\_labs }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{()\{}
  \FunctionTok{new\_command}\NormalTok{(labs, }\AttributeTok{fill =} \StringTok{"m/z"}\NormalTok{, }\AttributeTok{size =} \StringTok{"Tanimoto similarity"}\NormalTok{,}
              \AttributeTok{edge\_width =} \StringTok{"Spectral similarity"}\NormalTok{)}
\NormalTok{\}}

\NormalTok{.command\_parent\_edge\_width }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{()\{}
  \FunctionTok{new\_command}\NormalTok{(scale\_edge\_width, }\AttributeTok{range =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FloatTok{0.7}\NormalTok{))}
\NormalTok{\}}

\NormalTok{.command\_scale\_x }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(data, }\AttributeTok{factor =} \FloatTok{1.05}\NormalTok{)\{}
  \FunctionTok{new\_command}\NormalTok{(scale\_x\_continuous, }\AttributeTok{limits =} \FunctionTok{zoRange}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{x, factor))}
\NormalTok{\}}

\NormalTok{.command\_scale\_y }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(data, }\AttributeTok{factor =} \FloatTok{1.05}\NormalTok{)\{}
  \FunctionTok{new\_command}\NormalTok{(scale\_y\_continuous, }\AttributeTok{limits =} \FunctionTok{zoRange}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{y, factor))}
\NormalTok{\}}

\NormalTok{.command\_parent\_theme }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{()\{}
  \FunctionTok{new\_command}\NormalTok{(}\FunctionTok{match.fun}\NormalTok{(theme),}
              \AttributeTok{text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{family =}\NormalTok{ .font, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{),}
              \AttributeTok{axis.ticks =} \FunctionTok{element\_blank}\NormalTok{(),}
              \AttributeTok{axis.text =} \FunctionTok{element\_blank}\NormalTok{(),}
              \AttributeTok{axis.title =} \FunctionTok{element\_blank}\NormalTok{(),}
              \AttributeTok{panel.grid =} \FunctionTok{element\_blank}\NormalTok{(),}
              \AttributeTok{panel.background =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{"white"}\NormalTok{),}
              \AttributeTok{legend.background =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{"transparent"}\NormalTok{),}
              \AttributeTok{name =} \StringTok{"theme"}
\NormalTok{  )}
\NormalTok{\}}

\NormalTok{.command\_child\_title }\OtherTok{\textless{}{-}}
  \ControlFlowTok{function}\NormalTok{(title)\{}
    \FunctionTok{new\_command}\NormalTok{(ggtitle, stringr}\SpecialCharTok{::}\FunctionTok{str\_wrap}\NormalTok{(title, }\AttributeTok{width =} \DecValTok{30}\NormalTok{))}
\NormalTok{  \}}

\NormalTok{.command\_child\_theme }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(fill)\{}
\NormalTok{    command }\OtherTok{\textless{}{-}} \FunctionTok{.command\_parent\_theme}\NormalTok{()}
    \FunctionTok{command\_args}\NormalTok{(command)[[ }\StringTok{"plot.title"}\NormalTok{ ]] }\OtherTok{\textless{}{-}}
      \FunctionTok{call\_command}\NormalTok{(}\FunctionTok{.command\_title\_textbox}\NormalTok{(fill))}
\NormalTok{    command}
\NormalTok{  \}}

\NormalTok{.command\_title\_textbox }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(fill)\{}
    \FunctionTok{new\_command}\NormalTok{(.element\_textbox, }\AttributeTok{fill =}\NormalTok{ fill)}
\NormalTok{  \}}

\NormalTok{.command\_node\_nuclear }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(color)\{}
    \FunctionTok{new\_command}\NormalTok{(geom\_ribbon, }\AttributeTok{fill =}\NormalTok{ color,}
                \FunctionTok{aes}\NormalTok{(}\AttributeTok{ymin =} \SpecialCharTok{{-}}\NormalTok{5L, }\AttributeTok{ymax =}\NormalTok{ 0L,}
                    \AttributeTok{x =} \FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FunctionTok{max}\NormalTok{(seq) }\SpecialCharTok{+} \DecValTok{1}\NormalTok{, }\AttributeTok{length.out =} \FunctionTok{length}\NormalTok{(seq)))}
\NormalTok{    )}
\NormalTok{  \}}

\NormalTok{.command\_node\_border }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{()\{}
    \FunctionTok{new\_command}\NormalTok{(geom\_ribbon, }\AttributeTok{fill =} \StringTok{"black"}\NormalTok{,}
                \FunctionTok{aes}\NormalTok{(}\AttributeTok{ymin =} \DecValTok{0}\NormalTok{, }\AttributeTok{ymax =} \FloatTok{1.1}\NormalTok{,}
                    \AttributeTok{x =} \FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FunctionTok{max}\NormalTok{(seq) }\SpecialCharTok{+} \DecValTok{1}\NormalTok{, }\AttributeTok{length.out =} \FunctionTok{length}\NormalTok{(seq)))}
\NormalTok{    )}
\NormalTok{  \}}

\NormalTok{.command\_node\_radial\_bar }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{()\{}
    \FunctionTok{new\_command}\NormalTok{(geom\_col, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ seq, }\AttributeTok{y =}\NormalTok{ pp.value,}
                              \AttributeTok{fill =} \FunctionTok{reorder}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(rel.index), rel.index)),}
                \AttributeTok{color =} \StringTok{"white"}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.25}\NormalTok{)}
\NormalTok{  \}}

\NormalTok{.command\_node\_fill }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(pal, labels)\{}
    \FunctionTok{new\_command}\NormalTok{(scale\_fill\_manual, }\AttributeTok{values =}\NormalTok{ pal, }\AttributeTok{labels =}\NormalTok{ labels)}
\NormalTok{  \}}

\NormalTok{.command\_node\_ylim }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{()\{}
    \FunctionTok{new\_command}\NormalTok{(ylim, }\AttributeTok{... =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{5}\NormalTok{, }\FloatTok{1.3}\NormalTok{))}
\NormalTok{  \}}

\NormalTok{.command\_node\_polar }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{()\{}
    \FunctionTok{new\_command}\NormalTok{(coord\_polar)}
\NormalTok{  \}}

\NormalTok{.command\_node\_theme }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{()\{}
    \FunctionTok{new\_command}\NormalTok{(}\FunctionTok{match.fun}\NormalTok{(theme),}
                \AttributeTok{text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{family =}\NormalTok{ .font, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{),}
                \AttributeTok{name =} \StringTok{"theme"}\NormalTok{)}
\NormalTok{  \}}

\NormalTok{.command\_node\_ration }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(df)\{}
    \FunctionTok{new\_command}\NormalTok{(geom\_tile, }\AttributeTok{data =}\NormalTok{ df, }\AttributeTok{size =} \FloatTok{0.2}\NormalTok{, }\AttributeTok{color =} \StringTok{"white"}\NormalTok{,}
                \FunctionTok{aes}\NormalTok{(}\AttributeTok{y =} \SpecialCharTok{{-}}\FloatTok{2.5}\NormalTok{, }\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{width =}\NormalTok{ width,}
                    \AttributeTok{height =} \FloatTok{2.5}\NormalTok{, }\AttributeTok{fill =}\NormalTok{ group))}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @importFrom ggimage geom\_subview}
\NormalTok{.command\_node\_annotate }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(data, subview)\{}
    \FunctionTok{new\_command}\NormalTok{(ggimage}\SpecialCharTok{::}\NormalTok{geom\_subview, }\AttributeTok{data =}\NormalTok{ data, }
                \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y, }\AttributeTok{width =}\NormalTok{ size, }\AttributeTok{height =}\NormalTok{ size),}
                \AttributeTok{subview =}\NormalTok{ subview)}
\NormalTok{  \}}


\NormalTok{.grob\_legend\_hierarchy\_plot }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(color, theme)\{}
\NormalTok{    df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{h =} \FunctionTok{names}\NormalTok{(color), }\AttributeTok{color =}\NormalTok{ color, }\AttributeTok{y =} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(color))}
\NormalTok{    p }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(df) }\SpecialCharTok{+}
      \FunctionTok{geom\_tile}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \DecValTok{1}\NormalTok{, }\AttributeTok{y =}\NormalTok{ h, }\AttributeTok{fill =}\NormalTok{ h)) }\SpecialCharTok{+}
      \FunctionTok{labs}\NormalTok{(}\AttributeTok{fill =} \StringTok{"Class hierarchy"}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =}\NormalTok{ color) }\SpecialCharTok{+}
      \FunctionTok{guides}\NormalTok{(}\AttributeTok{fill =} \FunctionTok{guide\_legend}\NormalTok{(}\AttributeTok{nrow =} \DecValTok{1}\NormalTok{, }\AttributeTok{direction =} \StringTok{"horizontal"}\NormalTok{)) }\SpecialCharTok{+}
\NormalTok{      theme}
    \FunctionTok{.get\_legend}\NormalTok{(p)}
\NormalTok{  \}}

\NormalTok{.grob\_node\_text }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(label, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{)\{}
\NormalTok{    grid}\SpecialCharTok{::}\FunctionTok{textGrob}\NormalTok{(label, }\AttributeTok{y =} \FloatTok{0.12}\NormalTok{,}
                   \AttributeTok{gp =}\NormalTok{ grid}\SpecialCharTok{::}\FunctionTok{gpar}\NormalTok{(}\AttributeTok{fontfamily =}\NormalTok{ .font,}
                                   \AttributeTok{fontsize =} \DecValTok{20}\NormalTok{, }\AttributeTok{col =}\NormalTok{ color))}
\NormalTok{  \}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-tools-export.r}{%
\section{File: tools-export.R}\label{file-tools-export.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# functions to get export setting}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\NormalTok{.get\_export\_name }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{()\{}
\NormalTok{    set }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
             \AttributeTok{mz =} \StringTok{"m/z"}\NormalTok{,}
             \AttributeTok{pre.mz =} \StringTok{"Precursor m/z"}\NormalTok{,}
             \AttributeTok{rt.min =} \StringTok{"RT (min)"}\NormalTok{,}
             \AttributeTok{similarity =} \StringTok{"Spectral similarity"}\NormalTok{,}
             \AttributeTok{tani.score =} \StringTok{"Tanimoto similarity"}\NormalTok{,}
             \AttributeTok{rel.index =} \StringTok{"Relative index"}\NormalTok{,}
             \AttributeTok{rel.int. =} \StringTok{"Relative intensity"}\NormalTok{,}
             \AttributeTok{tracer =} \StringTok{"Tracer"}\NormalTok{,}
             \AttributeTok{group =} \StringTok{"Group"}\NormalTok{,}
             \AttributeTok{.features\_id =} \StringTok{"ID"}\NormalTok{,}
             \AttributeTok{mol.formula =} \StringTok{"Formula"}\NormalTok{,}
             \AttributeTok{inchikey2d =} \StringTok{"InChIKey planar"}\NormalTok{,}
             \AttributeTok{error.mass =} \StringTok{"Mass error (ppm)"}\NormalTok{,}
             \AttributeTok{synonym =} \StringTok{"Synonym"}\NormalTok{,}
             \AttributeTok{adduct =} \StringTok{"Adduct"}
\NormalTok{    )}
\NormalTok{  \}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-tools-methods.r}{%
\section{File: tools-methods.R}\label{file-tools-methods.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# algorithmic functions used in methods{-}*.R files}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\NormalTok{.rank\_by\_csi.score }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(df)\{}
    \FunctionTok{head}\NormalTok{( dplyr}\SpecialCharTok{::}\FunctionTok{arrange}\NormalTok{(df, }\FunctionTok{desc}\NormalTok{(csi.score)), }\AttributeTok{n =} \DecValTok{1}\NormalTok{)}
\NormalTok{  \}}

\NormalTok{.rank\_by\_default }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(df)\{}
    \FunctionTok{head}\NormalTok{(df, }\AttributeTok{n =} \DecValTok{1}\NormalTok{)}
\NormalTok{  \}}

\NormalTok{.filter\_ppcp\_by\_threshold }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(df, }\AttributeTok{pp.threshold =} \FloatTok{0.5}\NormalTok{)\{}
\NormalTok{    dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(df, pp.value }\SpecialCharTok{\textgreater{}}\NormalTok{ pp.threshold)}
\NormalTok{  \}}

\NormalTok{.decrease\_edges }\OtherTok{\textless{}{-}}
  \ControlFlowTok{function}\NormalTok{(edges, }\AttributeTok{max\_edge\_number =} \DecValTok{5}\NormalTok{)\{}
    \DocumentationTok{\#\# order}
\NormalTok{    edges }\OtherTok{\textless{}{-}}\NormalTok{ edges[}\FunctionTok{order}\NormalTok{(edges}\SpecialCharTok{$}\NormalTok{similarity, }\AttributeTok{decreasing =}\NormalTok{ T), ]}
\NormalTok{    edges[[ }\StringTok{"...SEQ"}\NormalTok{ ]] }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(edges)}
\NormalTok{    freq }\OtherTok{\textless{}{-}} \FunctionTok{table}\NormalTok{(}\FunctionTok{c}\NormalTok{(edges[[ }\StringTok{".features\_id1"}\NormalTok{ ]], edges[[ }\StringTok{".features\_id2"}\NormalTok{ ]]))}
    \DocumentationTok{\#\# at least loop number}
    \ControlFlowTok{while}\NormalTok{ (}\FunctionTok{max}\NormalTok{(freq) }\SpecialCharTok{\textgreater{}}\NormalTok{ max\_edge\_number) \{}
\NormalTok{      target\_id }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(freq[freq }\SpecialCharTok{==} \FunctionTok{max}\NormalTok{(freq)])[}\DecValTok{1}\NormalTok{]}
      \DocumentationTok{\#\# get ...SEQ of the edges which need to be excluded}
\NormalTok{      include }\OtherTok{\textless{}{-}}\NormalTok{ edges[[ }\StringTok{".features\_id1"}\NormalTok{ ]] }\SpecialCharTok{==}\NormalTok{ target\_id }\SpecialCharTok{|}
\NormalTok{        edges[[ }\StringTok{".features\_id2"}\NormalTok{ ]] }\SpecialCharTok{==}\NormalTok{ target\_id}
\NormalTok{      edges\_include\_target }\OtherTok{\textless{}{-}}\NormalTok{ edges[include, ]}
\NormalTok{      seq\_exclude\_edges }\OtherTok{\textless{}{-}}\NormalTok{ edges\_include\_target[}\SpecialCharTok{{-}}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\NormalTok{max\_edge\_number), ]}\SpecialCharTok{$}\NormalTok{...SEQ}
      \DocumentationTok{\#\# exclude edges}
\NormalTok{      edges }\OtherTok{\textless{}{-}}\NormalTok{ edges[}\SpecialCharTok{!}\NormalTok{edges}\SpecialCharTok{$}\NormalTok{...SEQ }\SpecialCharTok{\%in\%}\NormalTok{ seq\_exclude\_edges, ]}
\NormalTok{      freq }\OtherTok{\textless{}{-}} \FunctionTok{table}\NormalTok{(}\FunctionTok{c}\NormalTok{(edges[[ }\StringTok{".features\_id1"}\NormalTok{ ]], edges[[ }\StringTok{".features\_id2"}\NormalTok{ ]]))}
\NormalTok{    \}}
\NormalTok{    edges[[ }\StringTok{"...SEQ"}\NormalTok{ ]] }\OtherTok{\textless{}{-}} \ConstantTok{NULL}
\NormalTok{    edges}
\NormalTok{  \}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-tools-modify_ggset.r}{%
\section{File: tools-modify\_ggset.R}\label{file-tools-modify_ggset.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# functions to modify \textquotesingle{}ggset\textquotesingle{} object}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @aliases fun\_modify}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Modify \textquotesingle{}ggset\textquotesingle{} object}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{} These are multiple functions used for post modification of [ggset{-}class]}
\CommentTok{\#\textquotesingle{} object. These functions provide a convenient, fast, and repeatable way}
\CommentTok{\#\textquotesingle{} to make improvements to [ggset{-}class] object.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param ggset [ggset{-}class] object.}
\CommentTok{\#\textquotesingle{} @param x [mcnebula{-}class] object.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @seealso [ggset{-}class]}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name fun\_modify}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @export modify\_default\_child}
\CommentTok{\#\textquotesingle{} @aliases modify\_default\_child}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{modify\_default\_child\}:}
\CommentTok{\#\textquotesingle{} Used for \textbackslash{}code\{visualize\_all()\}.}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{modify\_rm\_legend\} + \textbackslash{}code\{modify\_set\_labs\} + \textbackslash{}code\{modify\_unify\_scale\_limits\}.}
\CommentTok{\#\textquotesingle{} In addition, if the \textquotesingle{}use\_tracer\textquotesingle{} is TRUE (see [set\_nodes\_color()]),}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{modify\_tracer\_node\} and \textbackslash{}code\{modify\_color\_edge\} would be performed.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @rdname fun\_modify}
\NormalTok{modify\_default\_child }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(ggset, x)\{}
\NormalTok{    x }\OtherTok{\textless{}{-}} \FunctionTok{.get\_missing\_x}\NormalTok{(x, }\StringTok{"mcnebula"}\NormalTok{)}
\NormalTok{    maps }\OtherTok{\textless{}{-}} \FunctionTok{.get\_mapping2}\NormalTok{(ggset)}
    \ControlFlowTok{if}\NormalTok{ (maps[[ }\StringTok{"fill"}\NormalTok{ ]] }\SpecialCharTok{==} \StringTok{"tracer"}\NormalTok{)}
\NormalTok{      ggset }\OtherTok{\textless{}{-}} \FunctionTok{modify\_color\_edge}\NormalTok{(}\FunctionTok{modify\_tracer\_node}\NormalTok{(ggset), }\StringTok{"lightblue"}\NormalTok{)}
    \FunctionTok{modify\_rm\_legend}\NormalTok{(}\FunctionTok{modify\_set\_labs}\NormalTok{(}\FunctionTok{modify\_unify\_scale\_limits}\NormalTok{(ggset)))}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export modify\_stat\_child}
\CommentTok{\#\textquotesingle{} @aliases modify\_stat\_child}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{modify\_stat\_child\}:}
\CommentTok{\#\textquotesingle{} Repalce [scale\_fill\_gradientn()] with [scale\_fill\_gradient2()] in \textquotesingle{}layers\textquotesingle{};}
\CommentTok{\#\textquotesingle{} unify the "aes" scale except for "fill";}
\CommentTok{\#\textquotesingle{} perfrom [modify\_set\_labs()];}
\CommentTok{\#\textquotesingle{} only keep the legend for \textquotesingle{}fill\textquotesingle{}, and adjust its width;}
\CommentTok{\#\textquotesingle{} move the position of the legend to the bottom;}
\CommentTok{\#\textquotesingle{} remove the title of the legend.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @rdname fun\_modify}
\NormalTok{modify\_stat\_child }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(ggset, x) \{}
\NormalTok{    x }\OtherTok{\textless{}{-}} \FunctionTok{.get\_missing\_x}\NormalTok{(x, }\StringTok{"mcnebula"}\NormalTok{)}
    \DocumentationTok{\#\# replace}
\NormalTok{    seq }\OtherTok{\textless{}{-}} \FunctionTok{grep}\NormalTok{(}\StringTok{"scale\_fill\_gradientn"}\NormalTok{, }\FunctionTok{names}\NormalTok{(}\FunctionTok{layers}\NormalTok{(ggset)))}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.integer}\NormalTok{(seq) }\SpecialCharTok{\&} \FunctionTok{length}\NormalTok{(seq) }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{)}
\NormalTok{      ggset }\OtherTok{\textless{}{-}} \FunctionTok{delete\_layers}\NormalTok{(ggset, seq)}
\NormalTok{    args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{low =} \StringTok{"blue"}\NormalTok{, }\AttributeTok{mid =} \StringTok{"grey90"}\NormalTok{, }\AttributeTok{high =} \StringTok{"red"}\NormalTok{, }\AttributeTok{na.value =} \StringTok{"white"}\NormalTok{)}
\NormalTok{    pal }\OtherTok{\textless{}{-}} \FunctionTok{palette\_gradient}\NormalTok{(x)}
\NormalTok{    pal }\OtherTok{\textless{}{-}}\NormalTok{ pal[}\FunctionTok{names}\NormalTok{(pal) }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(args)]}
\NormalTok{    args }\OtherTok{\textless{}{-}} \FunctionTok{.fresh\_param}\NormalTok{(args, }\FunctionTok{as.list}\NormalTok{(pal))}
\NormalTok{    breaks }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{round}\NormalTok{(}\FunctionTok{seq}\NormalTok{(}\FunctionTok{floor}\NormalTok{(}\FunctionTok{min}\NormalTok{(x)), }\FunctionTok{ceiling}\NormalTok{(}\FunctionTok{max}\NormalTok{(x)), }\AttributeTok{length.out =} \DecValTok{7}\NormalTok{), }\DecValTok{1}\NormalTok{)}
\NormalTok{    command }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(new\_command, }\FunctionTok{c}\NormalTok{(}\AttributeTok{fun =}\NormalTok{ scale\_fill\_gradient2,}
                                      \AttributeTok{breaks =}\NormalTok{ breaks, args,}
                                      \AttributeTok{name =} \StringTok{"scale\_fill\_gradient2"}\NormalTok{))}
\NormalTok{    ggset }\OtherTok{\textless{}{-}} \FunctionTok{add\_layers}\NormalTok{(ggset, command)}
    \DocumentationTok{\#\# unify and set labs}
\NormalTok{    aes\_name }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(}\FunctionTok{.get\_mapping2}\NormalTok{(ggset))}
\NormalTok{    ggset }\OtherTok{\textless{}{-}} \FunctionTok{modify\_unify\_scale\_limits}\NormalTok{(ggset, }\AttributeTok{aes\_name =}\NormalTok{ aes\_name[aes\_name }\SpecialCharTok{!=} \StringTok{"fill"}\NormalTok{])}
\NormalTok{    ggset }\OtherTok{\textless{}{-}} \FunctionTok{modify\_set\_labs}\NormalTok{(ggset)}
    \DocumentationTok{\#\# ...}
\NormalTok{    args }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(aes\_name, }\AttributeTok{simplify =}\NormalTok{ F,}
                   \ControlFlowTok{function}\NormalTok{(name) \{}
                     \ControlFlowTok{if}\NormalTok{ (name }\SpecialCharTok{==} \StringTok{"fill"}\NormalTok{)}
                       \FunctionTok{guide\_colorbar}\NormalTok{(}\AttributeTok{title =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{barheight =}\NormalTok{ grid}\SpecialCharTok{::}\FunctionTok{unit}\NormalTok{(.}\DecValTok{5}\NormalTok{, }\StringTok{"line"}\NormalTok{))}
                     \ControlFlowTok{else} \StringTok{"none"}
\NormalTok{                   \})}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{any}\NormalTok{(}\FunctionTok{grepl}\NormalTok{(}\StringTok{"\^{}guides|ggplot2::guides"}\NormalTok{, }\FunctionTok{names}\NormalTok{(}\FunctionTok{layers}\NormalTok{(ggset)))))}
\NormalTok{      ggset }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(mutate\_layer, }\FunctionTok{c}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{x =}\NormalTok{ ggset, }\AttributeTok{layer =} \StringTok{"guides"}\NormalTok{), args))}
    \ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{      command }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(new\_command,}
                         \FunctionTok{c}\NormalTok{(}\AttributeTok{fun =} \FunctionTok{match.fun}\NormalTok{(}\StringTok{"guides"}\NormalTok{), args, }\AttributeTok{name =} \StringTok{"guides"}\NormalTok{))}
\NormalTok{      ggset }\OtherTok{\textless{}{-}} \FunctionTok{add\_layers}\NormalTok{(ggset, command)}
\NormalTok{    \}}
\NormalTok{    ggset }\OtherTok{\textless{}{-}} \FunctionTok{mutate\_layer}\NormalTok{(ggset, }\StringTok{"theme"}\NormalTok{, }\AttributeTok{legend.position =} \StringTok{"bottom"}\NormalTok{)}
    \FunctionTok{attr}\NormalTok{(ggset, }\StringTok{"modify"}\NormalTok{) }\OtherTok{\textless{}{-}} \StringTok{"rev.modify\_stat\_child"}
\NormalTok{    ggset}
\NormalTok{  \}}

\NormalTok{rev.modify\_stat\_child }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(ggset)\{}
\NormalTok{    args }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(}\FunctionTok{.get\_mapping2}\NormalTok{(ggset)), }\AttributeTok{simplify =}\NormalTok{ F,}
                   \ControlFlowTok{function}\NormalTok{(name) \{}
                     \ControlFlowTok{if}\NormalTok{ (name }\SpecialCharTok{==} \StringTok{"fill"}\NormalTok{) }\StringTok{"none"} \ControlFlowTok{else} \ConstantTok{NULL}
\NormalTok{                   \})}
\NormalTok{    ggset }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(mutate\_layer, }\FunctionTok{c}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{x =}\NormalTok{ ggset, }\AttributeTok{layer =} \StringTok{"guides"}\NormalTok{), args))}
\NormalTok{    ggset }\OtherTok{\textless{}{-}} \FunctionTok{mutate\_layer}\NormalTok{(ggset, }\StringTok{"theme"}\NormalTok{, }\AttributeTok{legend.position =} \StringTok{"right"}\NormalTok{)}
\NormalTok{    ggset}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export modify\_set\_labs\_and\_unify\_scale\_limits}
\CommentTok{\#\textquotesingle{} @aliases modify\_set\_labs\_and\_unify\_scale\_limits}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{modify\_set\_labs\_and\_unify\_scale\_limits\}:}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{modify\_set\_labs\} + \textbackslash{}code\{modify\_unify\_scale\_limits\}}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @rdname fun\_modify}
\NormalTok{modify\_set\_labs\_and\_unify\_scale\_limits }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(ggset, x)\{}
\NormalTok{    x }\OtherTok{\textless{}{-}} \FunctionTok{.get\_missing\_x}\NormalTok{(x, }\StringTok{"mcnebula"}\NormalTok{)}
    \FunctionTok{modify\_set\_labs}\NormalTok{(}\FunctionTok{modify\_unify\_scale\_limits}\NormalTok{(ggset))}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export modify\_annotate\_child}
\CommentTok{\#\textquotesingle{} @aliases modify\_annotate\_child}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{modify\_annotate\_child\}:}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{modify\_set\_labs\} + ...}
\CommentTok{\#\textquotesingle{} (for parameters of \textbackslash{}code\{panel.grid\} and \textbackslash{}code\{panel.background\}}
\CommentTok{\#\textquotesingle{} in [ggplot2::theme()]).}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @rdname fun\_modify}
\NormalTok{modify\_annotate\_child }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(ggset, x)\{}
\NormalTok{    x }\OtherTok{\textless{}{-}} \FunctionTok{.get\_missing\_x}\NormalTok{(x, }\StringTok{"mcnebula"}\NormalTok{)}
    \FunctionTok{mutate\_layer}\NormalTok{(}\FunctionTok{modify\_set\_labs}\NormalTok{(ggset), }\StringTok{"theme"}\NormalTok{,}
                 \AttributeTok{panel.grid =} \FunctionTok{element\_line}\NormalTok{(}\StringTok{"white"}\NormalTok{, }\AttributeTok{inherit.blank =}\NormalTok{ T),}
                 \AttributeTok{panel.background =} \FunctionTok{element\_rect}\NormalTok{(}\StringTok{"grey92"}\NormalTok{, }\AttributeTok{color =} \ConstantTok{NA}\NormalTok{,}
                                                 \AttributeTok{inherit.blank =}\NormalTok{ T))}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export modify\_rm\_legend}
\CommentTok{\#\textquotesingle{} @aliases modify\_rm\_legend}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{modify\_rm\_legend\}: remove the legend.}
\CommentTok{\#\textquotesingle{} For parameter of \textbackslash{}code\{legend.position\} in [ggplot2::theme()].}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @rdname fun\_modify}
\NormalTok{modify\_rm\_legend }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(ggset)\{}
    \FunctionTok{mutate\_layer}\NormalTok{(ggset, }\StringTok{"theme"}\NormalTok{, }\AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export modify\_tracer\_node}
\CommentTok{\#\textquotesingle{} @aliases modify\_tracer\_node}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{modify\_tracer\_node\}: Set the stroke for nodes in}
\CommentTok{\#\textquotesingle{} Nebulae (network) as 0, and the color as \textquotesingle{}transparent\textquotesingle{};}
\CommentTok{\#\textquotesingle{} Override the node color (border color) in legend.}
\CommentTok{\#\textquotesingle{} @rdname fun\_modify}
\NormalTok{modify\_tracer\_node }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(ggset)\{}
\NormalTok{    seq }\OtherTok{\textless{}{-}} \FunctionTok{grep}\NormalTok{(}\StringTok{"geom\_node\_point"}\NormalTok{, }\FunctionTok{names}\NormalTok{(}\FunctionTok{layers}\NormalTok{(ggset)))}
\NormalTok{    ggset }\OtherTok{\textless{}{-}} \FunctionTok{mutate\_layer}\NormalTok{(ggset, seq, }\AttributeTok{stroke =} \DecValTok{0}\NormalTok{, }\AttributeTok{color =} \StringTok{"transparent"}\NormalTok{)}
    \DocumentationTok{\#\# override the nodes boder color in legend }
\NormalTok{    seq }\OtherTok{\textless{}{-}} \FunctionTok{grep}\NormalTok{(}\StringTok{"\^{}guides|ggplot2::guides"}\NormalTok{, }\FunctionTok{names}\NormalTok{(}\FunctionTok{layers}\NormalTok{(ggset)))}
\NormalTok{    size\_legend }\OtherTok{\textless{}{-}} \FunctionTok{guide\_legend}\NormalTok{(}\AttributeTok{override.aes =} \FunctionTok{list}\NormalTok{(}\AttributeTok{stroke =}\NormalTok{ .}\DecValTok{3}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{))}
\NormalTok{    fill\_legend }\OtherTok{\textless{}{-}} \FunctionTok{guide\_legend}\NormalTok{(}\AttributeTok{override.aes =} \FunctionTok{list}\NormalTok{(}\AttributeTok{size =} \DecValTok{4}\NormalTok{))}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(seq) }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{)}
\NormalTok{      ggset }\OtherTok{\textless{}{-}} \FunctionTok{mutate\_layer}\NormalTok{(ggset, seq, }\AttributeTok{size =}\NormalTok{ size\_legend, }\AttributeTok{fill =}\NormalTok{ fill\_legend)}
    \ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{      command }\OtherTok{\textless{}{-}} \FunctionTok{new\_command}\NormalTok{(}\FunctionTok{match.fun}\NormalTok{(}\StringTok{"guides"}\NormalTok{), }\AttributeTok{size =}\NormalTok{ size\_legend,}
                             \AttributeTok{fill =}\NormalTok{ fill\_legend, }\AttributeTok{name =} \StringTok{"guides"}\NormalTok{)}
\NormalTok{      ggset }\OtherTok{\textless{}{-}} \FunctionTok{add\_layers}\NormalTok{(ggset, command)}
\NormalTok{    \}}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export modify\_color\_edge}
\CommentTok{\#\textquotesingle{} @aliases modify\_color\_edge}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{modify\_color\_edge\}: Set color for edge.}
\CommentTok{\#\textquotesingle{} @param color character(1).}
\CommentTok{\#\textquotesingle{} @rdname fun\_modify}
\NormalTok{modify\_color\_edge }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(ggset, color)\{}
\NormalTok{    seq }\OtherTok{\textless{}{-}} \FunctionTok{grep}\NormalTok{(}\StringTok{"geom\_edge\_"}\NormalTok{, }\FunctionTok{names}\NormalTok{(}\FunctionTok{layers}\NormalTok{(ggset)))}
    \FunctionTok{mutate\_layer}\NormalTok{(ggset, seq, }\AttributeTok{color =}\NormalTok{ color)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @importFrom grid unit}
\CommentTok{\#\textquotesingle{} @export modify\_set\_margin}
\CommentTok{\#\textquotesingle{} @aliases modify\_set\_margin}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{modify\_set\_margin\}: reduce margin.}
\CommentTok{\#\textquotesingle{} For parameter of \textbackslash{}code\{plot.margin\} in [ggplot2::theme()].}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @rdname fun\_modify}
\NormalTok{modify\_set\_margin }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(ggset, }\AttributeTok{margin =}\NormalTok{ grid}\SpecialCharTok{::}\FunctionTok{unit}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{8}\NormalTok{, }\DecValTok{4}\NormalTok{), }\StringTok{"lines"}\NormalTok{))\{}
    \FunctionTok{mutate\_layer}\NormalTok{(ggset, }\StringTok{"theme"}\NormalTok{, }\AttributeTok{plot.margin =}\NormalTok{ margin)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export modify\_unify\_scale\_limits}
\CommentTok{\#\textquotesingle{} @aliases modify\_unify\_scale\_limits}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{modify\_unify\_scale\_limits\}:}
\CommentTok{\#\textquotesingle{} Uniform mapping \textquotesingle{}scale\textquotesingle{} for all Child{-}Nebulae.}
\CommentTok{\#\textquotesingle{} Related to \textbackslash{}code\{ggplot2::scale\_*\} function.}
\CommentTok{\#\textquotesingle{} Use \textbackslash{}code\{MCnebula2:::.LEGEND\_mapping()\} to get the possibly mapping.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param aes\_name character. Specify which \textquotesingle{}aes\textquotesingle{} to unify scale,}
\CommentTok{\#\textquotesingle{} e.g., c("fill", "size", "edge\_width").}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @rdname fun\_modify}
\NormalTok{modify\_unify\_scale\_limits }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(ggset, x, }\AttributeTok{aes\_name =} \ConstantTok{NA}\NormalTok{)\{}
\NormalTok{    x }\OtherTok{\textless{}{-}} \FunctionTok{.get\_missing\_x}\NormalTok{(x, }\StringTok{"mcnebula"}\NormalTok{)}
    \FunctionTok{.check\_data}\NormalTok{(x, }\FunctionTok{list}\NormalTok{(}\AttributeTok{features\_annotation =} \StringTok{"create\_features\_annotation"}\NormalTok{,}
                        \AttributeTok{spectral\_similarity =} \StringTok{"compute\_spectral\_similarity"}\NormalTok{))}
\NormalTok{    layers\_name }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(}\FunctionTok{layers}\NormalTok{(ggset))}
\NormalTok{    args }\OtherTok{\textless{}{-}} \FunctionTok{as.list}\NormalTok{(}\FunctionTok{.get\_mapping2}\NormalTok{(ggset))}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.logical}\NormalTok{(aes\_name))}
\NormalTok{      aes\_name }\OtherTok{\textless{}{-}} \FunctionTok{.LEGEND\_mapping}\NormalTok{()}
    \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in}\NormalTok{ aes\_name) \{}
      \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(args[[ i ]])) \{}
        \ControlFlowTok{next}
\NormalTok{      \}}
      \ControlFlowTok{if}\NormalTok{ (i }\SpecialCharTok{==} \StringTok{"edge\_width"}\NormalTok{) \{}
\NormalTok{        attr }\OtherTok{\textless{}{-}} \FunctionTok{spectral\_similarity}\NormalTok{(x)[[ args[[i]] ]]}
\NormalTok{        fun }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"scale\_"}\NormalTok{, i)}
\NormalTok{      \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{        attr }\OtherTok{\textless{}{-}} \FunctionTok{features\_annotation}\NormalTok{(x)[[ args[[i]] ]]}
        \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(attr)) \{}
\NormalTok{          attr }\OtherTok{\textless{}{-}} \FunctionTok{attr}\NormalTok{(}\FunctionTok{features\_annotation}\NormalTok{(x), }\StringTok{"extra\_data"}\NormalTok{)[[ args[[i]] ]]}
          \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(attr))}
            \FunctionTok{stop}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"Not found attribute \textquotesingle{}"}\NormalTok{, args[[i]],}
                        \StringTok{"\textquotesingle{} in \textasciigrave{}features\_annotation(x)\textasciigrave{}."}\NormalTok{))}
\NormalTok{        \}}
\NormalTok{        fun }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"scale\_"}\NormalTok{, i, }\StringTok{"\_continuous"}\NormalTok{)}
\NormalTok{      \}}
      \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.numeric}\NormalTok{(attr)) \{}
        \ControlFlowTok{next}
\NormalTok{      \}}
\NormalTok{      range }\OtherTok{\textless{}{-}} \FunctionTok{range}\NormalTok{(attr, }\AttributeTok{na.rm =}\NormalTok{ T)}
\NormalTok{      seq }\OtherTok{\textless{}{-}} \FunctionTok{grep}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"\^{}scale\_"}\NormalTok{, i, }\StringTok{"|\^{}ggplot2::scale\_"}\NormalTok{, i), layers\_name)}
      \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(seq) }\SpecialCharTok{==} \DecValTok{1}\NormalTok{) \{}
\NormalTok{        ggset }\OtherTok{\textless{}{-}} \FunctionTok{mutate\_layer}\NormalTok{(ggset, seq, }\AttributeTok{limits =}\NormalTok{ range)}
\NormalTok{      \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(seq) }\SpecialCharTok{\textgreater{}} \DecValTok{1}\NormalTok{) \{}
        \FunctionTok{stop}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"multiple layers of \textquotesingle{}scale\_"}\NormalTok{, i,}
             \StringTok{".*"}\NormalTok{, }\StringTok{"\textquotesingle{} were found"}\NormalTok{))}
\NormalTok{      \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{        ggset }\OtherTok{\textless{}{-}}
          \FunctionTok{add\_layers}\NormalTok{(ggset,}
                     \FunctionTok{new\_command}\NormalTok{(}\FunctionTok{match.fun}\NormalTok{(fun),}
                                 \AttributeTok{limits =}\NormalTok{ range,}
                                 \AttributeTok{name =}\NormalTok{ fun}
\NormalTok{                                 ))}
\NormalTok{      \}}
\NormalTok{    \}}
\NormalTok{    ggset}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export modify\_set\_labs\_xy}
\CommentTok{\#\textquotesingle{} @aliases modify\_set\_labs\_xy}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{modify\_set\_labs\_xy\}:}
\CommentTok{\#\textquotesingle{} According to names in slot \textbackslash{}code\{export\_name\} of [mcnebula{-}class] object}
\CommentTok{\#\textquotesingle{} to rename the labs of x and y axis.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @rdname fun\_modify}
\NormalTok{modify\_set\_labs\_xy }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(ggset, x)\{}
\NormalTok{    x }\OtherTok{\textless{}{-}} \FunctionTok{.get\_missing\_x}\NormalTok{(x, }\StringTok{"mcnebula"}\NormalTok{)}
    \FunctionTok{.modify\_set\_labs}\NormalTok{(ggset, x, }\FunctionTok{c}\NormalTok{(}\StringTok{"x"}\NormalTok{, }\StringTok{"y"}\NormalTok{))}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export modify\_set\_labs}
\CommentTok{\#\textquotesingle{} @aliases modify\_set\_labs}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{modify\_set\_labs\}:}
\CommentTok{\#\textquotesingle{} According to names in slot \textbackslash{}code\{export\_name\} of [mcnebula{-}class] object}
\CommentTok{\#\textquotesingle{} to rename the labs of legends.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @rdname fun\_modify}
\NormalTok{modify\_set\_labs }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(ggset, x)\{}
\NormalTok{    x }\OtherTok{\textless{}{-}} \FunctionTok{.get\_missing\_x}\NormalTok{(x, }\StringTok{"mcnebula"}\NormalTok{)}
    \FunctionTok{.modify\_set\_labs}\NormalTok{(ggset, x)}
\NormalTok{  \}}

\NormalTok{.modify\_set\_labs }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(ggset, x, ...) \{}
\NormalTok{    export\_name }\OtherTok{\textless{}{-}} \FunctionTok{as.list}\NormalTok{(}\FunctionTok{export\_name}\NormalTok{(x))}
\NormalTok{    mapping }\OtherTok{\textless{}{-}} \FunctionTok{vecter\_unique\_by\_names}\NormalTok{(}\FunctionTok{.get\_mapping2}\NormalTok{(ggset, ...))}
\NormalTok{    args }\OtherTok{\textless{}{-}} \FunctionTok{vapply}\NormalTok{(mapping, }\AttributeTok{FUN.VALUE =} \StringTok{"ch"}\NormalTok{,}
                   \ControlFlowTok{function}\NormalTok{(attr) \{}
                     \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(export\_name[[ attr ]]))}
\NormalTok{                       attr}
                     \ControlFlowTok{else}
\NormalTok{                       export\_name[[ attr ]]}
\NormalTok{                   \})}
\NormalTok{    seq }\OtherTok{\textless{}{-}} \FunctionTok{grep}\NormalTok{(}\StringTok{"\^{}labs$|\^{}ggplot2::labs$"}\NormalTok{, }\FunctionTok{names}\NormalTok{(}\FunctionTok{layers}\NormalTok{(ggset)))}
    \ControlFlowTok{if}\NormalTok{ ( }\FunctionTok{length}\NormalTok{(seq) }\SpecialCharTok{==} \DecValTok{1}\NormalTok{) \{}
\NormalTok{      ggset }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(mutate\_layer, }\FunctionTok{c}\NormalTok{(ggset, seq, args))}
\NormalTok{    \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ ( }\FunctionTok{length}\NormalTok{(seq) }\SpecialCharTok{\textgreater{}} \DecValTok{1}\NormalTok{ ) \{}
      \FunctionTok{stop}\NormalTok{( }\StringTok{"multiple layers of \textquotesingle{}labs\textquotesingle{} were found"}\NormalTok{ )}
\NormalTok{    \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{      ggset }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(add\_layers,}
                       \FunctionTok{c}\NormalTok{(ggset, }\FunctionTok{do.call}\NormalTok{(new\_command,}
                                        \FunctionTok{c}\NormalTok{(}\FunctionTok{match.fun}\NormalTok{(labs),}
\NormalTok{                                          args, }\AttributeTok{name =} \StringTok{"labs"}\NormalTok{))))}
\NormalTok{    \}}
\NormalTok{    ggset}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @importFrom stringr str\_extract}
\NormalTok{.get\_mapping2 }\OtherTok{\textless{}{-}}
  \ControlFlowTok{function}\NormalTok{(ggset, }\AttributeTok{maps =} \FunctionTok{.LEGEND\_mapping}\NormalTok{())\{}
\NormalTok{    args }\OtherTok{\textless{}{-}} \FunctionTok{.get\_mapping}\NormalTok{(ggset)}
\NormalTok{    pattern }\OtherTok{\textless{}{-}} \StringTok{"[a{-}z|A{-}Z|.|\_|0{-}9]\{1,\}"}
\NormalTok{    args[] }\OtherTok{\textless{}{-}}
\NormalTok{      stringr}\SpecialCharTok{::}\FunctionTok{str\_extract}\NormalTok{(args,}
                           \FunctionTok{paste0}\NormalTok{(}\StringTok{"(?\textless{}=}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{()"}\NormalTok{, pattern, }\StringTok{"(?=}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{),)"}\NormalTok{,}
                                  \StringTok{"|\^{}"}\NormalTok{, pattern, }\StringTok{"$"}\NormalTok{))}
\NormalTok{    args[}\FunctionTok{names}\NormalTok{(args) }\SpecialCharTok{\%in\%}\NormalTok{ maps]}
\NormalTok{  \}}

\NormalTok{.LEGEND\_mapping }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{()\{}
    \FunctionTok{c}\NormalTok{(}\StringTok{"fill"}\NormalTok{, }\StringTok{"color"}\NormalTok{, }\StringTok{"colour"}\NormalTok{, }\StringTok{"alpha"}\NormalTok{, }\StringTok{"size"}\NormalTok{, }\StringTok{"edge\_width"}\NormalTok{)}
\NormalTok{  \}}

\NormalTok{.get\_mapping }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(ggset)\{}
    \FunctionTok{unlist}\NormalTok{(}\FunctionTok{lapply}\NormalTok{(}\FunctionTok{unname}\NormalTok{(}\FunctionTok{layers}\NormalTok{(ggset)),}
                  \ControlFlowTok{function}\NormalTok{(com)\{}
\NormalTok{                    mapping }\OtherTok{\textless{}{-}} \FunctionTok{command\_args}\NormalTok{(com)}\SpecialCharTok{$}\NormalTok{mapping}
                    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(mapping)) \{}
                      \FunctionTok{vapply}\NormalTok{(mapping, }\AttributeTok{FUN.VALUE =} \StringTok{"ch"}\NormalTok{,}
                             \ControlFlowTok{function}\NormalTok{(m) }\FunctionTok{tail}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(m), }\DecValTok{1}\NormalTok{))}
\NormalTok{                    \}}
\NormalTok{                  \}))}
\NormalTok{  \}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-tools-msnbase-modified_comparespectra.r}{%
\section{File: tools-MSnbase-MODIFIED\_compareSpectra.R}\label{file-tools-msnbase-modified_comparespectra.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# generic and methods of \textasciigrave{}compareSpectra\textasciigrave{} stripped from package of }
\CommentTok{\# MSnbase and ProtGenerics}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\DocumentationTok{\#\# from ProtGenerics}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"compareSpectra"}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(x, y, ...)}
    \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"compareSpectra"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"mz"}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(object, ...) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"mz"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"intensity"}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(object, ...) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"intensity"}\NormalTok{))}

\DocumentationTok{\#\# from MSnbase and modified}
\FunctionTok{setClass}\NormalTok{(}\StringTok{"lightSpectrum"}\NormalTok{,}
         \AttributeTok{representation =}
           \FunctionTok{representation}\NormalTok{(}\AttributeTok{mz =} \StringTok{"numeric"}\NormalTok{,}
                          \AttributeTok{intensity =} \StringTok{"numeric"}\NormalTok{),}
         \AttributeTok{prototype =}
           \FunctionTok{prototype}\NormalTok{(}\AttributeTok{mz =} \FunctionTok{numeric}\NormalTok{(),}
                     \AttributeTok{intensity =} \FunctionTok{numeric}\NormalTok{())}
\NormalTok{)}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"mz"}\NormalTok{, }\StringTok{"lightSpectrum"}\NormalTok{,}
          \ControlFlowTok{function}\NormalTok{(object) object}\SpecialCharTok{@}\NormalTok{mz)}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"intensity"}\NormalTok{, }\StringTok{"lightSpectrum"}\NormalTok{,}
          \ControlFlowTok{function}\NormalTok{(object) object}\SpecialCharTok{@}\NormalTok{intensity)}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"compareSpectra"}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\StringTok{"lightSpectrum"}\NormalTok{, }\StringTok{"lightSpectrum"}\NormalTok{),}
          \ControlFlowTok{function}\NormalTok{(x, y) \{}
\NormalTok{            binnedSpectra }\OtherTok{\textless{}{-}} \FunctionTok{bin\_Spectra}\NormalTok{(x, y)}
            \FunctionTok{do.call}\NormalTok{(dotproduct, binnedSpectra)}
\NormalTok{          \})}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# function}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\NormalTok{bin\_Spectra }\OtherTok{\textless{}{-}}
  \ControlFlowTok{function}\NormalTok{(object1, object2, }\AttributeTok{binSize =}\NormalTok{ 1L,}
           \AttributeTok{breaks =} \FunctionTok{seq}\NormalTok{(}\FunctionTok{floor}\NormalTok{(}\FunctionTok{min}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\FunctionTok{mz}\NormalTok{(object1), }\FunctionTok{mz}\NormalTok{(object2)))),}
                        \FunctionTok{ceiling}\NormalTok{(}\FunctionTok{max}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\FunctionTok{mz}\NormalTok{(object1), }\FunctionTok{mz}\NormalTok{(object2)))),}
                        \AttributeTok{by =}\NormalTok{ binSize)) \{}
\NormalTok{    breaks }\OtherTok{\textless{}{-}} \FunctionTok{.fix\_breaks}\NormalTok{(breaks, }\FunctionTok{range}\NormalTok{(}\FunctionTok{mz}\NormalTok{(object1), }\FunctionTok{mz}\NormalTok{(object2)))}
    \FunctionTok{list}\NormalTok{(}\FunctionTok{bin\_Spectrum}\NormalTok{(object1, }\AttributeTok{breaks =}\NormalTok{ breaks),}
         \FunctionTok{bin\_Spectrum}\NormalTok{(object2, }\AttributeTok{breaks =}\NormalTok{ breaks))}
\NormalTok{\}}

\NormalTok{bin\_Spectrum }\OtherTok{\textless{}{-}}
  \ControlFlowTok{function}\NormalTok{(object, }\AttributeTok{binSize =}\NormalTok{ 1L, breaks, }\AttributeTok{fun =}\NormalTok{ sum) \{}
\NormalTok{    ints }\OtherTok{\textless{}{-}} \FunctionTok{.bin\_values}\NormalTok{(object}\SpecialCharTok{@}\NormalTok{intensity, object}\SpecialCharTok{@}\NormalTok{mz, }\AttributeTok{binSize =}\NormalTok{ binSize,}
                        \AttributeTok{breaks =}\NormalTok{ breaks, }\AttributeTok{fun =}\NormalTok{ fun)}
    \FunctionTok{return}\NormalTok{(ints)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} The function aggregates \textasciigrave{}x\textasciigrave{} for \textasciigrave{}toBin\textasciigrave{} falling into bins defined}
\CommentTok{\#\textquotesingle{} by \textasciigrave{}breaks\textasciigrave{} using the \textasciigrave{}fun\textasciigrave{} function.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @details}
\CommentTok{\#\textquotesingle{} This is a combination of the code from the former bin\_Spectrum.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x \textasciigrave{}numeric\textasciigrave{} with the values that should be binned.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param toBin \textasciigrave{}numeric\textasciigrave{}, same length than \textasciigrave{}x\textasciigrave{}, with values to be used for the}
\CommentTok{\#\textquotesingle{}     binning.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param binSize \textasciigrave{}numeric(1)\textasciigrave{} with the size of the bins.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param breaks \textasciigrave{}numeric\textasciigrave{} defining the breaks/bins.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param fun \textasciigrave{}function\textasciigrave{} to be used to aggregate values of \textasciigrave{}x\textasciigrave{} falling into the}
\CommentTok{\#\textquotesingle{}     bins defined by \textasciigrave{}breaks\textasciigrave{}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @return \textasciigrave{}list\textasciigrave{} with elements \textasciigrave{}x\textasciigrave{} and \textasciigrave{}mids\textasciigrave{} being the aggregated values}
\CommentTok{\#\textquotesingle{}     of \textasciigrave{}x\textasciigrave{} for values in \textasciigrave{}toBin\textasciigrave{} falling within each bin and the bin mid}
\CommentTok{\#\textquotesingle{}     points. {-}{-}been modified, only return \textasciigrave{}x\textasciigrave{}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @noRd}

\NormalTok{.bin\_values }\OtherTok{\textless{}{-}}
  \ControlFlowTok{function}\NormalTok{(x, toBin, }\AttributeTok{binSize =}\NormalTok{ 1L, breaks, fun) \{}
\NormalTok{    breaks }\OtherTok{\textless{}{-}} \FunctionTok{.fix\_breaks}\NormalTok{(breaks, }\FunctionTok{range}\NormalTok{(toBin))}
\NormalTok{    nbrks }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(breaks)}
\NormalTok{    idx }\OtherTok{\textless{}{-}} \FunctionTok{findInterval}\NormalTok{(toBin, breaks)}
    \DocumentationTok{\#\# Ensure that indices are within breaks.}
\NormalTok{    idx[}\FunctionTok{which}\NormalTok{(idx }\SpecialCharTok{\textless{}}\NormalTok{ 1L)] }\OtherTok{\textless{}{-}}\NormalTok{ 1L}
\NormalTok{    idx[}\FunctionTok{which}\NormalTok{(idx }\SpecialCharTok{\textgreater{}=}\NormalTok{ nbrks)] }\OtherTok{\textless{}{-}}\NormalTok{ nbrks }\SpecialCharTok{{-}}\NormalTok{ 1L}

\NormalTok{    ints }\OtherTok{\textless{}{-}} \FunctionTok{double}\NormalTok{(nbrks }\SpecialCharTok{{-}}\NormalTok{ 1L)}
\NormalTok{    ints[}\FunctionTok{unique}\NormalTok{(idx)] }\OtherTok{\textless{}{-}} \FunctionTok{unlist}\NormalTok{(}\FunctionTok{lapply}\NormalTok{(base}\SpecialCharTok{::}\FunctionTok{split}\NormalTok{(x, idx), fun),}
                                \AttributeTok{use.names =} \ConstantTok{FALSE}\NormalTok{)}
    \FunctionTok{return}\NormalTok{(ints)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} Simple function to ensure that breaks (for binning) are span al leat the}
\CommentTok{\#\textquotesingle{} expected range.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param brks \textasciigrave{}numeric\textasciigrave{} with *breaks* such as calculated by \textasciigrave{}seq\textasciigrave{}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param rng \textasciigrave{}numeric(2)\textasciigrave{} with the range of original numeric values on which}
\CommentTok{\#\textquotesingle{}     the breaks were calculated.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @noRd}

\NormalTok{.fix\_breaks }\OtherTok{\textless{}{-}}
  \ControlFlowTok{function}\NormalTok{(brks, rng) \{}
    \DocumentationTok{\#\# Assuming breaks being sorted.}
    \ControlFlowTok{if}\NormalTok{ (brks[}\FunctionTok{length}\NormalTok{(brks)] }\SpecialCharTok{\textless{}=}\NormalTok{ rng[}\DecValTok{2}\NormalTok{]) \{}
\NormalTok{      brks }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(brks, }\FunctionTok{max}\NormalTok{((rng[}\DecValTok{2}\NormalTok{] }\SpecialCharTok{+} \FloatTok{1e{-}6}\NormalTok{),}
\NormalTok{                          brks[}\FunctionTok{length}\NormalTok{(brks)] }\SpecialCharTok{+} \FunctionTok{mean}\NormalTok{(}\FunctionTok{diff}\NormalTok{(brks))))}
\NormalTok{    \}}
\NormalTok{    brks}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} calculate the dot product between two vectors}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} Stein, S. E., and Scott, D. R. (1994).}
\CommentTok{\#\textquotesingle{} Optimization and testing of mass spectral library search algorithms for}
\CommentTok{\#\textquotesingle{} compound identification.}
\CommentTok{\#\textquotesingle{} Journal of the American Society for Mass Spectrometry, 5(9), 859{-}866.}
\CommentTok{\#\textquotesingle{} doi: https://doi.org/10.1016/1044{-}0305(94)87009{-}8}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} Lam, H., Deutsch, E. W., Eddes, J. S., Eng, J. K., King, N., Stein, S. E.}
\CommentTok{\#\textquotesingle{} and Aebersold, R. (2007)}
\CommentTok{\#\textquotesingle{} Development and validation of a spectral library searching method for peptide}
\CommentTok{\#\textquotesingle{} identification from MS/MS.}
\CommentTok{\#\textquotesingle{} Proteomics, 7: 655{-}667.}
\CommentTok{\#\textquotesingle{} doi: https://doi.org/10.1002/pmic.200600625}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x double}
\CommentTok{\#\textquotesingle{} @param y double}
\CommentTok{\#\textquotesingle{} @return double, length == 1}
\CommentTok{\#\textquotesingle{} @noRd}

\NormalTok{dotproduct }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, y) \{}
  \FunctionTok{as.vector}\NormalTok{(x }\SpecialCharTok{\%*\%}\NormalTok{ y) }\SpecialCharTok{/}\NormalTok{ (}\FunctionTok{sqrt}\NormalTok{(}\FunctionTok{sum}\NormalTok{(x}\SpecialCharTok{*}\NormalTok{x)) }\SpecialCharTok{*} \FunctionTok{sqrt}\NormalTok{(}\FunctionTok{sum}\NormalTok{(y}\SpecialCharTok{*}\NormalTok{y)))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-tools-report.r}{%
\section{File: tools-report.R}\label{file-tools-report.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# functions used in \textquotesingle{}report\textquotesingle{} or \textquotesingle{}section\textquotesingle{} class }
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\NormalTok{.write\_block }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(command\_name, ..., codes)\{}
\NormalTok{    args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(...)}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(args) }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{) \{}
      \FunctionTok{lapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(args),}
             \ControlFlowTok{function}\NormalTok{(name) \{}
               \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{nchar}\NormalTok{(name) }\SpecialCharTok{==} \DecValTok{0}\NormalTok{)}
                 \FunctionTok{stop}\NormalTok{(}\StringTok{"the args for r block must contain parameter names, "}\NormalTok{,}
                      \StringTok{"e.g., \textquotesingle{}eval = FALSE\textquotesingle{}, \textquotesingle{}echo = TRUE\textquotesingle{}"}\NormalTok{)}
\NormalTok{             \})}
\NormalTok{      args }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(args,}
                     \ControlFlowTok{function}\NormalTok{(arg) \{}
                       \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.character}\NormalTok{(arg))}
                         \FunctionTok{paste0}\NormalTok{(}\StringTok{"\textquotesingle{}"}\NormalTok{, arg, }\StringTok{"\textquotesingle{}"}\NormalTok{)}
                       \ControlFlowTok{else}
\NormalTok{                         arg}
\NormalTok{                     \})}
\NormalTok{      args }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\FunctionTok{names}\NormalTok{(args), }\StringTok{" = "}\NormalTok{, args),}
                     \AttributeTok{collapse =} \StringTok{", "}\NormalTok{)}
\NormalTok{      leader }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"\textasciigrave{}\textasciigrave{}\textasciigrave{}\{"}\NormalTok{, command\_name, }\StringTok{", "}\NormalTok{, args, }\StringTok{"\}"}\NormalTok{)}
\NormalTok{    \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{      leader }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"\textasciigrave{}\textasciigrave{}\textasciigrave{}\{"}\NormalTok{, command\_name, }\StringTok{"\}"}\NormalTok{)}
\NormalTok{    \}}
\NormalTok{    end }\OtherTok{\textless{}{-}} \StringTok{"\textasciigrave{}\textasciigrave{}\textasciigrave{}"}
    \FunctionTok{c}\NormalTok{(leader, codes, end, }\StringTok{""}\NormalTok{)}
\NormalTok{  \}}

\NormalTok{.args\_r\_block }\OtherTok{\textless{}{-}}
  \ControlFlowTok{function}\NormalTok{()\{}
    \FunctionTok{list}\NormalTok{(}\AttributeTok{echo =}\NormalTok{ T,}
         \AttributeTok{eval =}\NormalTok{ T,}
         \AttributeTok{message =}\NormalTok{ F}
\NormalTok{    )}
\NormalTok{  \}}

\NormalTok{.args\_r\_block\_table }\OtherTok{\textless{}{-}}
  \ControlFlowTok{function}\NormalTok{()\{}
    \FunctionTok{list}\NormalTok{(}\AttributeTok{echo =}\NormalTok{ T,}
         \AttributeTok{eval =}\NormalTok{ T,}
         \AttributeTok{message =}\NormalTok{ F}
\NormalTok{    )}
\NormalTok{  \}}

\NormalTok{.args\_r\_block\_figure }\OtherTok{\textless{}{-}}
  \ControlFlowTok{function}\NormalTok{()\{}
    \FunctionTok{list}\NormalTok{(}\AttributeTok{echo =}\NormalTok{ T,}
         \AttributeTok{eval =}\NormalTok{ T,}
         \AttributeTok{message =}\NormalTok{ F,}
         \AttributeTok{fig.cap =} \StringTok{"The figure"}
\NormalTok{    )}
\NormalTok{  \}}

\NormalTok{nshow }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(object)\{}
  \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(object)) \{}
    \FunctionTok{show}\NormalTok{(object)}
\NormalTok{  \}}
\NormalTok{\}}

\NormalTok{textSh }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(..., }\AttributeTok{sep =} \StringTok{""}\NormalTok{, }\AttributeTok{exdent =} \DecValTok{4}\NormalTok{, }\AttributeTok{ending =} \StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{,}
           \AttributeTok{pre\_collapse =}\NormalTok{ F, }\AttributeTok{collapse =} \StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{,}
           \AttributeTok{pre\_trunc =}\NormalTok{ F, }\AttributeTok{trunc\_width =} \DecValTok{200}\NormalTok{,}
           \AttributeTok{pre\_wrap =}\NormalTok{ F, }\AttributeTok{wrap\_width =} \DecValTok{60}\NormalTok{)\{}
\NormalTok{    text }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(...)}
    \ControlFlowTok{if}\NormalTok{ (pre\_collapse) \{}
\NormalTok{      text }\OtherTok{\textless{}{-}} \FunctionTok{vapply}\NormalTok{(text, paste, }\StringTok{"ch"}\NormalTok{, }\AttributeTok{collapse =}\NormalTok{ collapse)}
\NormalTok{    \}}
\NormalTok{    text }\OtherTok{\textless{}{-}} \FunctionTok{paste}\NormalTok{(text, }\AttributeTok{sep =}\NormalTok{ sep)}
    \ControlFlowTok{if}\NormalTok{ (pre\_trunc) \{}
\NormalTok{      text }\OtherTok{\textless{}{-}} \FunctionTok{.text\_fold}\NormalTok{(text, trunc\_width)}
\NormalTok{    \}}
    \ControlFlowTok{if}\NormalTok{ (pre\_wrap) \{}
\NormalTok{      text }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{strwrap}\NormalTok{(text, }\AttributeTok{width =}\NormalTok{ wrap\_width), }\AttributeTok{collapse =} \StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{    \}}
\NormalTok{    exdent }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\StringTok{" "}\NormalTok{, exdent), }\AttributeTok{collapse =} \StringTok{""}\NormalTok{)}
    \FunctionTok{writeLines}\NormalTok{(}\FunctionTok{gsub}\NormalTok{(}\StringTok{"(?\textless{}=}\SpecialCharTok{\textbackslash{}n}\StringTok{)|(?\textless{}=\^{})"}\NormalTok{, exdent, text, }\AttributeTok{perl =}\NormalTok{ T))}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(ending))}
      \FunctionTok{cat}\NormalTok{(ending)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @importFrom stringr str\_trunc}
\NormalTok{.text\_fold }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(text, }\AttributeTok{width =} \DecValTok{200}\NormalTok{, }\AttributeTok{ellipsis =}\NormalTok{ crayon}\SpecialCharTok{::}\FunctionTok{silver}\NormalTok{(}\StringTok{"...(fold)"}\NormalTok{))\{}
\NormalTok{    stringr}\SpecialCharTok{::}\FunctionTok{str\_trunc}\NormalTok{(text, }\AttributeTok{width =}\NormalTok{ width, }\AttributeTok{ellipsis =}\NormalTok{ ellipsis)}
\NormalTok{  \}}

\NormalTok{.part }\OtherTok{\textless{}{-}}
  \ControlFlowTok{function}\NormalTok{(...)\{}
\NormalTok{    args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(...)}
    \FunctionTok{unlist}\NormalTok{(}\FunctionTok{lapply}\NormalTok{(args,}
                  \ControlFlowTok{function}\NormalTok{(obj) \{}
                    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(obj))}
                      \FunctionTok{c}\NormalTok{(obj, }\StringTok{""}\NormalTok{)}
\NormalTok{                  \}))}
\NormalTok{  \}}

\NormalTok{get\_history }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(}\AttributeTok{exclude =} \DecValTok{0}\NormalTok{)\{}
\NormalTok{    file1 }\OtherTok{\textless{}{-}} \FunctionTok{tempfile}\NormalTok{(}\StringTok{"Rrawhist"}\NormalTok{)}
    \FunctionTok{savehistory}\NormalTok{(file1)}
\NormalTok{    rawhist }\OtherTok{\textless{}{-}} \FunctionTok{readLines}\NormalTok{(file1)}
    \FunctionTok{unlink}\NormalTok{(file1)}
    \ControlFlowTok{if}\NormalTok{ (exclude }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{) \{}
\NormalTok{      exclude }\OtherTok{\textless{}{-}}\NormalTok{ (}\FunctionTok{length}\NormalTok{(rawhist) }\SpecialCharTok{{-}}\NormalTok{ exclude }\SpecialCharTok{+} \DecValTok{1}\NormalTok{)}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(rawhist)}
\NormalTok{      rawhist }\OtherTok{\textless{}{-}}\NormalTok{ rawhist[}\SpecialCharTok{{-}}\NormalTok{exclude]}
\NormalTok{    \}}
\NormalTok{    rawhist}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @importFrom bookdown pdf\_document2}
\CommentTok{\#\textquotesingle{} @importFrom BiocStyle pdf\_document}
\CommentTok{\#\textquotesingle{} @importFrom BiocStyle html\_document}
\NormalTok{default\_pdf }\OtherTok{\textless{}{-}}\NormalTok{ bookdown}\SpecialCharTok{::}\NormalTok{pdf\_document2}
\NormalTok{bioc\_pdf }\OtherTok{\textless{}{-}}\NormalTok{ BiocStyle}\SpecialCharTok{::}\NormalTok{pdf\_document}
\NormalTok{bioc\_html }\OtherTok{\textless{}{-}}\NormalTok{ BiocStyle}\SpecialCharTok{::}\NormalTok{html\_document}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-tools-xcms-feature_detection.r}{%
\section{File: tools-xcms-feature\_detection.R}\label{file-tools-xcms-feature_detection.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# use XCMS to perform Feature Dectection}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\# the following classes would import while used...}
\CommentTok{\# @importClassesFrom MSnbase OnDiskMSnExp}
\CommentTok{\# @importClassesFrom MSnbase MSpectra}
\CommentTok{\# @importClassesFrom S4Vectors DFrame}
\CommentTok{\# @importClassesFrom xcms XCMSnExp}

\CommentTok{\# setClass("OnDiskMSnExp")}
\CommentTok{\# setClass("MSpectra")}
\CommentTok{\# setClass("DFrame")}
\CommentTok{\# setClass("XCMSnExp")}

\CommentTok{\#\textquotesingle{} @exportClass detectFlow}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases detectFlow}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Steps in sequence to perform Feature Detection}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description A class inherits from [layerSet{-}class] to store steps for}
\CommentTok{\#\textquotesingle{} Feature Detection.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @seealso [layerSet{-}class], [mcmass{-}class]}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot layers list. a list of objects [command{-}class].}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname detectFlow{-}class}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{} new(\textquotesingle{}detectFlow\textquotesingle{}, ...)}
\CommentTok{\#\textquotesingle{} \}}
\NormalTok{.detectFlow }\OtherTok{\textless{}{-}} 
  \FunctionTok{setClass}\NormalTok{(}\StringTok{"detectFlow"}\NormalTok{, }
    \AttributeTok{contains =} \StringTok{"layerSet"}\NormalTok{,}
    \AttributeTok{representation =} \FunctionTok{representation}\NormalTok{(),}
    \AttributeTok{prototype =} \ConstantTok{NULL}
\NormalTok{  )}

\CommentTok{\#\textquotesingle{} @exportMethod show\_layers}
\CommentTok{\#\textquotesingle{} @description See \textbackslash{}code\{show\_layers\} in [ggset{-}class].}
\CommentTok{\#\textquotesingle{} @rdname detectFlow{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"show\_layers"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"detectFlow"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(x)\{}
    \FunctionTok{selectMethod}\NormalTok{(}\StringTok{"show\_layers"}\NormalTok{, }\StringTok{"ggset"}\NormalTok{)(x)}
\NormalTok{  \})}

\CommentTok{\#\textquotesingle{} @exportClass toBeEval}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases toBeEval}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description character(1) to be eval while perform [run\_lcms()].}
\CommentTok{\#\textquotesingle{} @rdname detectFlow{-}class}
\NormalTok{toBeEval }\OtherTok{\textless{}{-}} \FunctionTok{setClass}\NormalTok{(}\StringTok{"toBeEval"}\NormalTok{, }\AttributeTok{contains =} \FunctionTok{c}\NormalTok{(}\StringTok{"character"}\NormalTok{), }\AttributeTok{prototype =} \StringTok{"pro\_data(x)"}\NormalTok{)}

\CommentTok{\#\textquotesingle{} @exportClass mcmass}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases mcmass}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title storage of XCMS processed data of \textquotesingle{}feature detection\textquotesingle{}}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description This class provides a process template for pre{-}processing}
\CommentTok{\#\textquotesingle{} non{-}targeted mass spectrometry data with package \textbackslash{}code\{xcms\}.}
\CommentTok{\#\textquotesingle{} In default, the steps of Feature Detection were refer to:}
\CommentTok{\#\textquotesingle{} \textbackslash{}link\{https://github.com/DorresteinLaboratory/XCMS3\_FeatureBasedMN\}}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @slot raw\_data [OnDiskMSnExp{-}class] object.}
\CommentTok{\#\textquotesingle{} @slot pro\_data [XCMSnExp{-}class] object.}
\CommentTok{\#\textquotesingle{} @slot sample\_metadata data.frame. User supplied data about the mass data}
\CommentTok{\#\textquotesingle{} files to process.}
\CommentTok{\#\textquotesingle{} @slot features\_defination [DFrame{-}class] object. Non user supplied data.}
\CommentTok{\#\textquotesingle{} See \textbackslash{}code\{xcms::featureDefinitions\}.}
\CommentTok{\#\textquotesingle{} @slot features\_quantification data.frame. Non user supplied data.}
\CommentTok{\#\textquotesingle{} Peak area were used to quantify the feature level.}
\CommentTok{\#\textquotesingle{} @slot ms2\_spectra [MSpectra{-}class] object. Non user supplied data.}
\CommentTok{\#\textquotesingle{} See \textbackslash{}code\{xcms::filteredMs2Spectra\}.}
\CommentTok{\#\textquotesingle{} @slot parameter\_set list. Passed to repalace the parameters in slot}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{detectFlow\} of [mcmass{-}class] for performing [run\_lcms()].}
\CommentTok{\#\textquotesingle{} @slot detectFlow [detectFlow{-}class] object.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname mcmass{-}class}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{} new(\textquotesingle{}mcmass\textquotesingle{}, ...)}
\CommentTok{\#\textquotesingle{} \}}
\NormalTok{.mcmass }\OtherTok{\textless{}{-}} 
  \FunctionTok{suppressWarnings}\NormalTok{(}\FunctionTok{setClass}\NormalTok{(}\StringTok{"mcmass"}\NormalTok{, }
    \AttributeTok{contains =} \FunctionTok{character}\NormalTok{(),}
    \AttributeTok{representation =} \FunctionTok{representation}\NormalTok{(}
      \AttributeTok{raw\_data =} \StringTok{"OnDiskMSnExp"}\NormalTok{,}
      \AttributeTok{pro\_data =} \StringTok{"XCMSnExp"}\NormalTok{,}
      \AttributeTok{sample\_metadata =} \StringTok{"data.frame"}\NormalTok{,}
      \AttributeTok{features\_defination =} \StringTok{"DFrame"}\NormalTok{,}
      \AttributeTok{features\_quantification =} \StringTok{"data.frame"}\NormalTok{,}
      \AttributeTok{ms2\_spectra =} \StringTok{"MSpectra"}\NormalTok{,}
      \AttributeTok{parameter\_set =} \StringTok{"list"}\NormalTok{,}
      \AttributeTok{detectFlow =} \StringTok{"detectFlow"}
\NormalTok{      ),}
    \AttributeTok{prototype =} \FunctionTok{prototype}\NormalTok{(}\AttributeTok{detectFlow =} \FunctionTok{.detectFlow}\NormalTok{())}
\NormalTok{  ))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# methods (getter or setter)}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"raw\_data"}\NormalTok{, }
  \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"raw\_data"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"raw\_data\textless{}{-}"}\NormalTok{, }
  \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"raw\_data\textless{}{-}"}\NormalTok{))}

\CommentTok{\#\textquotesingle{} @exportMethod raw\_data}
\CommentTok{\#\textquotesingle{} @aliases raw\_data}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{raw\_data\}, \textbackslash{}code\{raw\_data\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{raw\_data\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname mcmass{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"raw\_data"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcmass"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(x)\{}
\NormalTok{    x}\SpecialCharTok{@}\NormalTok{raw\_data}
\NormalTok{  \})}

\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"pro\_data"}\NormalTok{, }
  \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"pro\_data"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"pro\_data\textless{}{-}"}\NormalTok{, }
  \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"pro\_data\textless{}{-}"}\NormalTok{))}

\CommentTok{\#\textquotesingle{} @exportMethod pro\_data}
\CommentTok{\#\textquotesingle{} @aliases pro\_data}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{pro\_data\}, \textbackslash{}code\{pro\_data\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{pro\_data\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname mcmass{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"pro\_data"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcmass"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(x)\{}
\NormalTok{    x}\SpecialCharTok{@}\NormalTok{pro\_data}
\NormalTok{  \})}

\CommentTok{\#\textquotesingle{} @exportMethod pro\_data\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases pro\_data\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname mcmass{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"pro\_data"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcmass"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(x, value)\{}
    \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{pro\_data =}\NormalTok{ value)}
\NormalTok{  \})}

\CommentTok{\#\textquotesingle{} @exportMethod raw\_data\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases raw\_data\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname mcmass{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"raw\_data"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcmass"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(x, value)\{}
    \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{raw\_data =}\NormalTok{ value)}
\NormalTok{  \})}

\CommentTok{\#\textquotesingle{} @exportMethod sample\_metadata}
\CommentTok{\#\textquotesingle{} @aliases sample\_metadata}
\CommentTok{\#\textquotesingle{} @rdname mcmass{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"sample\_metadata"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcmass"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(x)\{}
\NormalTok{    x}\SpecialCharTok{@}\NormalTok{sample\_metadata}
\NormalTok{  \})}

\CommentTok{\#\textquotesingle{} @exportMethod sample\_metadata\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases sample\_metadata\textless{}{-}}
\CommentTok{\#\textquotesingle{} @rdname mcmass{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"sample\_metadata"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcmass"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(x, value)\{}
    \FunctionTok{.check\_columns}\NormalTok{(value, }\FunctionTok{list}\NormalTok{(}\StringTok{"file"}\NormalTok{, }\StringTok{"sample"}\NormalTok{, }\StringTok{"group"}\NormalTok{),}
      \StringTok{"sample\_metadata"}\NormalTok{)}
\NormalTok{    x}\SpecialCharTok{@}\NormalTok{sample\_metadata }\OtherTok{\textless{}{-}}\NormalTok{ value}
    \FunctionTok{return}\NormalTok{(x)}
\NormalTok{  \})}

\CommentTok{\#\textquotesingle{} @exportMethod features\_quantification}
\CommentTok{\#\textquotesingle{} @aliases features\_quantification}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{features\_quantification\}, \textbackslash{}code\{features\_quantification\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{features\_quantification\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname mcmass{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"features\_quantification"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcmass"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(x)\{}
\NormalTok{    x}\SpecialCharTok{@}\NormalTok{features\_quantification}
\NormalTok{  \})}

\CommentTok{\#\textquotesingle{} @exportMethod features\_quantification\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases features\_quantification\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname mcmass{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"features\_quantification"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcmass"}\NormalTok{, }\AttributeTok{value =} \StringTok{"data.frame"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(x, value)\{}
    \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{features\_quantification =}\NormalTok{ value)}
\NormalTok{  \})}

\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"features\_defination"}\NormalTok{, }
  \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"features\_defination"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"features\_defination\textless{}{-}"}\NormalTok{, }
  \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"features\_defination\textless{}{-}"}\NormalTok{))}

\CommentTok{\#\textquotesingle{} @exportMethod features\_defination}
\CommentTok{\#\textquotesingle{} @aliases features\_defination}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{features\_defination\}, \textbackslash{}code\{features\_defination\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{features\_defination\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname mcmass{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"features\_defination"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcmass"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(x)\{}
\NormalTok{    x}\SpecialCharTok{@}\NormalTok{features\_defination}
\NormalTok{  \})}

\CommentTok{\#\textquotesingle{} @exportMethod features\_defination\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases features\_defination\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname mcmass{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"features\_defination"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcmass"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(x, value)\{}
    \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{features\_defination =}\NormalTok{ value)}
\NormalTok{  \})}

\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"ms2\_spectra"}\NormalTok{, }
  \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"ms2\_spectra"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"ms2\_spectra\textless{}{-}"}\NormalTok{, }
  \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"ms2\_spectra\textless{}{-}"}\NormalTok{))}

\CommentTok{\#\textquotesingle{} @exportMethod ms2\_spectra}
\CommentTok{\#\textquotesingle{} @aliases ms2\_spectra}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{ms2\_spectra\}, \textbackslash{}code\{ms2\_spectra\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{ms2\_spectra\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname mcmass{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"ms2\_spectra"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcmass"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(x)\{}
\NormalTok{    x}\SpecialCharTok{@}\NormalTok{ms2\_spectra}
\NormalTok{  \})}

\CommentTok{\#\textquotesingle{} @exportMethod ms2\_spectra\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases ms2\_spectra\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname mcmass{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"ms2\_spectra"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcmass"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(x, value)\{}
    \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{ms2\_spectra =}\NormalTok{ value)}
\NormalTok{  \})}

\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"parameter\_set"}\NormalTok{, }
  \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"parameter\_set"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"parameter\_set\textless{}{-}"}\NormalTok{, }
  \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"parameter\_set\textless{}{-}"}\NormalTok{))}

\CommentTok{\#\textquotesingle{} @exportMethod parameter\_set}
\CommentTok{\#\textquotesingle{} @aliases parameter\_set}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{parameter\_set\}, \textbackslash{}code\{parameter\_set\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{parameter\_set\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname mcmass{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"parameter\_set"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcmass"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(x)\{}
\NormalTok{    x}\SpecialCharTok{@}\NormalTok{parameter\_set}
\NormalTok{  \})}

\CommentTok{\#\textquotesingle{} @exportMethod parameter\_set\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases parameter\_set\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname mcmass{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"parameter\_set"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcmass"}\NormalTok{, }\AttributeTok{value =} \StringTok{"list"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(x, value)\{}
    \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{parameter\_set =}\NormalTok{ value)}
\NormalTok{  \})}

\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"detectFlow"}\NormalTok{, }
  \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"detectFlow"}\NormalTok{))}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"detectFlow\textless{}{-}"}\NormalTok{, }
  \ControlFlowTok{function}\NormalTok{(x, value) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"detectFlow\textless{}{-}"}\NormalTok{))}

\CommentTok{\#\textquotesingle{} @exportMethod detectFlow}
\CommentTok{\#\textquotesingle{} @aliases detectFlow}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{detectFlow\}, \textbackslash{}code\{detectFlow\textless{}{-}\}: getter and setter}
\CommentTok{\#\textquotesingle{} for the \textbackslash{}code\{detectFlow\} slot of the object.}
\CommentTok{\#\textquotesingle{} @rdname mcmass{-}class}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"detectFlow"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcmass"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(x)\{}
\NormalTok{    x}\SpecialCharTok{@}\NormalTok{detectFlow}
\NormalTok{  \})}

\CommentTok{\#\textquotesingle{} @exportMethod detectFlow\textless{}{-}}
\CommentTok{\#\textquotesingle{} @aliases detectFlow\textless{}{-}}
\CommentTok{\#\textquotesingle{} @param value The value for the slot.}
\CommentTok{\#\textquotesingle{} @rdname mcmass{-}class}
\FunctionTok{setReplaceMethod}\NormalTok{(}\StringTok{"detectFlow"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcmass"}\NormalTok{, }\AttributeTok{value =} \StringTok{"detectFlow"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(x, value)\{}
    \FunctionTok{initialize}\NormalTok{(x, }\AttributeTok{detectFlow =}\NormalTok{ value)}
\NormalTok{  \})}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# main methods}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"run\_lcms"}\NormalTok{, }
  \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"run\_lcms"}\NormalTok{))}

\CommentTok{\#\textquotesingle{} @exportMethod run\_lcms}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @title Perform Feature Detection with steps in \textquotesingle{}detectFlow\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description This would use package mainly \textquotesingle{}xcms\textquotesingle{} to perform}
\CommentTok{\#\textquotesingle{} Feature Detection.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases run\_lcms}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x [mcmass{-}class] object.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname run\_lcms{-}methods}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{} run\_lcms(...)}
\CommentTok{\#\textquotesingle{} \}}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"run\_lcms"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"mcmass"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(x)\{}
    \FunctionTok{.message\_info\_formal}\NormalTok{(}\StringTok{"run\_lcms"}\NormalTok{, }\StringTok{""}\NormalTok{)}
\NormalTok{    steps }\OtherTok{\textless{}{-}} \FunctionTok{layers}\NormalTok{(}\FunctionTok{detectFlow}\NormalTok{(x))}
    \FunctionTok{.message\_info}\NormalTok{(}\StringTok{"run\_lcms"}\NormalTok{, }\FunctionTok{command\_name}\NormalTok{(steps[[ }\DecValTok{1}\NormalTok{ ]]))}
    \FunctionTok{raw\_data}\NormalTok{(x) }\OtherTok{\textless{}{-}} \FunctionTok{call\_command}\NormalTok{(steps[[ }\DecValTok{1}\NormalTok{ ]])}
\NormalTok{    env }\OtherTok{\textless{}{-}} \FunctionTok{environment}\NormalTok{()}
    \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{2}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(steps)) \{}
      \FunctionTok{command\_args}\NormalTok{(steps[[ i ]]) }\OtherTok{\textless{}{-}} \FunctionTok{freshToBe}\NormalTok{(}\FunctionTok{command\_args}\NormalTok{(steps[[ i ]]), env)}
\NormalTok{      name }\OtherTok{\textless{}{-}} \FunctionTok{command\_name}\NormalTok{(steps[[ i ]])}
\NormalTok{      param }\OtherTok{\textless{}{-}} \FunctionTok{parameter\_set}\NormalTok{(x)[[ name ]]}
      \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(param)) \{}
\NormalTok{        param }\OtherTok{\textless{}{-}} \FunctionTok{parameter\_set}\NormalTok{(x)[[ }\FunctionTok{sub}\NormalTok{(}\StringTok{"\^{}[.a{-}zA{-}Z0{-}9\_]*::"}\NormalTok{, }\StringTok{""}\NormalTok{, name) ]]}
\NormalTok{      \}}
      \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(param)) \{}
        \ControlFlowTok{for}\NormalTok{ (j }\ControlFlowTok{in} \FunctionTok{names}\NormalTok{(param)) \{}
          \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{any}\NormalTok{(j }\SpecialCharTok{==} \FunctionTok{names}\NormalTok{(}\FunctionTok{command\_args}\NormalTok{(steps[[ i ]])))) \{}
            \FunctionTok{command\_args}\NormalTok{(steps[[ i ]])[[ j ]] }\OtherTok{\textless{}{-}}\NormalTok{ param[[ j ]]}
\NormalTok{          \}}
\NormalTok{        \}}
\NormalTok{      \}}
      \FunctionTok{.message\_info}\NormalTok{(}\StringTok{"run\_lcms"}\NormalTok{, name)}
      \FunctionTok{pro\_data}\NormalTok{(x) }\OtherTok{\textless{}{-}} \FunctionTok{call\_command}\NormalTok{(steps[[i]])}
\NormalTok{    \}}
    \FunctionTok{layers}\NormalTok{(}\FunctionTok{detectFlow}\NormalTok{(x)) }\OtherTok{\textless{}{-}}\NormalTok{ steps}
    \FunctionTok{return}\NormalTok{(x)}
\NormalTok{  \})}

\NormalTok{freshToBe }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(lst, envir) \{}
  \FunctionTok{lapply}\NormalTok{(lst,}
    \ControlFlowTok{function}\NormalTok{(obj) \{}
      \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is}\NormalTok{(obj, }\StringTok{"toBeEval"}\NormalTok{)) \{}
        \FunctionTok{eval}\NormalTok{(}\FunctionTok{parse}\NormalTok{(}\AttributeTok{text =}\NormalTok{ obj), }\AttributeTok{envir =}\NormalTok{ envir)}
\NormalTok{      \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{        obj}
\NormalTok{      \}}
\NormalTok{    \})}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export run\_export}
\CommentTok{\#\textquotesingle{} @aliases run\_export}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{run\_export\}: get \textbackslash{}code\{features\_quantification\}}
\CommentTok{\#\textquotesingle{} and \textbackslash{}code\{ms2\_spectra\} in [mcmass{-}class] object.}
\CommentTok{\#\textquotesingle{} @param keep\_onlyWithMs2 logical(1). If \textbackslash{}code\{TRUE\}, the data}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{features\_quantification\} only keep features which possess MS2.}
\CommentTok{\#\textquotesingle{} @param saveMgf NULL or character(1). Use \textbackslash{}code\{MSnbase::writeMgfData\} to}
\CommentTok{\#\textquotesingle{} output the slot \textbackslash{}code\{ms2\_spectra\} of [mcmass{-}class] as .mgf file.}
\CommentTok{\#\textquotesingle{} @param mzd passed to \textbackslash{}code\{MSnbase::combineSpectra\}}
\CommentTok{\#\textquotesingle{} @param minProp passed to \textbackslash{}code\{MSnbase::combineSpectra\}}
\CommentTok{\#\textquotesingle{} @param ppm passed to \textbackslash{}code\{MSnbase::combineSpectra\}}
\CommentTok{\#\textquotesingle{} @param ... passed to \textbackslash{}code\{MSnbase::combineSpectra\}}
\CommentTok{\#\textquotesingle{} @rdname run\_lcms{-}methods}
\NormalTok{run\_export }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, }\AttributeTok{keep\_onlyWithMs2 =}\NormalTok{ T,}
  \AttributeTok{saveMgf =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{mzd =} \DecValTok{0}\NormalTok{, }\AttributeTok{minProp =}\NormalTok{ .}\DecValTok{3}\NormalTok{, }\AttributeTok{ppm =} \DecValTok{20}\NormalTok{, ...)}
\NormalTok{\{}
  \DocumentationTok{\#\# mass level 2}
\NormalTok{  ms2 }\OtherTok{\textless{}{-}}\NormalTok{ xcms}\SpecialCharTok{::}\FunctionTok{featureSpectra}\NormalTok{(}\FunctionTok{pro\_data}\NormalTok{(x), }\AttributeTok{return.type =} \StringTok{"MSpectra"}\NormalTok{)}
\NormalTok{  ms2 }\OtherTok{\textless{}{-}}\NormalTok{ MSnbase}\SpecialCharTok{::}\FunctionTok{clean}\NormalTok{(ms2, }\AttributeTok{all =} \ConstantTok{TRUE}\NormalTok{)}
  \FunctionTok{.message\_info}\NormalTok{(}\StringTok{"run\_export"}\NormalTok{, }\StringTok{"MSnbase::combineSpectra"}\NormalTok{)}
  \FunctionTok{ms2\_spectra}\NormalTok{(x) }\OtherTok{\textless{}{-}}\NormalTok{ MSnbase}\SpecialCharTok{::}\FunctionTok{combineSpectra}\NormalTok{(}
\NormalTok{    ms2, }\AttributeTok{fcol =} \StringTok{"feature\_id"}\NormalTok{, }\AttributeTok{method =}\NormalTok{ MSnbase}\SpecialCharTok{::}\NormalTok{consensusSpectrum,}
    \AttributeTok{mzd =} \DecValTok{0}\NormalTok{, }\AttributeTok{minProp =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{ppm =} \DecValTok{20}\NormalTok{, ...}
\NormalTok{  )}
  \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(saveMgf)) \{}
\NormalTok{    MSnbase}\SpecialCharTok{::}\FunctionTok{writeMgfData}\NormalTok{(}\FunctionTok{ms2\_spectra}\NormalTok{(x), saveMgf)}
\NormalTok{  \}}
  \DocumentationTok{\#\# mass level 1}
  \FunctionTok{features\_defination}\NormalTok{(x) }\OtherTok{\textless{}{-}}\NormalTok{ xcms}\SpecialCharTok{::}\FunctionTok{featureDefinitions}\NormalTok{(}\FunctionTok{pro\_data}\NormalTok{(x))}
\NormalTok{  quant }\OtherTok{\textless{}{-}}\NormalTok{ xcms}\SpecialCharTok{::}\FunctionTok{featureValues}\NormalTok{(}\FunctionTok{pro\_data}\NormalTok{(x), }\AttributeTok{value =} \StringTok{"into"}\NormalTok{)}
\NormalTok{  quant }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(quant)}
  \FunctionTok{colnames}\NormalTok{(quant) }\OtherTok{\textless{}{-}} \FunctionTok{sample\_metadata}\NormalTok{(x)}\SpecialCharTok{$}\NormalTok{sample}
\NormalTok{  quant}\SpecialCharTok{$}\NormalTok{.features\_id }\OtherTok{\textless{}{-}} \FunctionTok{rownames}\NormalTok{(quant)}
\NormalTok{  quant }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{relocate}\NormalTok{(tibble}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(quant), .data}\SpecialCharTok{$}\NormalTok{.features\_id)}
  \ControlFlowTok{if}\NormalTok{ (keep\_onlyWithMs2) \{}
\NormalTok{    quant }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(}
\NormalTok{      quant, .features\_id }\SpecialCharTok{\%in\%} \FunctionTok{ms2\_spectra}\NormalTok{(x)}\SpecialCharTok{@}\NormalTok{elementMetadata}\SpecialCharTok{$}\NormalTok{feature\_id}
\NormalTok{    )}
\NormalTok{  \}}
  \FunctionTok{features\_quantification}\NormalTok{(x) }\OtherTok{\textless{}{-}}\NormalTok{ quant}
  \FunctionTok{return}\NormalTok{(x)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# default detectFlow}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\#\textquotesingle{} @export default\_detectFlow}
\CommentTok{\#\textquotesingle{} @aliases default\_detectFlow}
\CommentTok{\#\textquotesingle{} @param x [mcmass{-}class] object.}
\CommentTok{\#\textquotesingle{} @param snthresh passed to \textbackslash{}code\{xcms::CentWaveParam\} for}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{xcms::findChromPeaks\}}
\CommentTok{\#\textquotesingle{} @param noise passed to \textbackslash{}code\{xcms::CentWaveParam\} for}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{xcms::findChromPeaks\}}
\CommentTok{\#\textquotesingle{} @param peakwidth passed to \textbackslash{}code\{xcms::CentWaveParam\} for}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{xcms::findChromPeaks\}}
\CommentTok{\#\textquotesingle{} @param ppm passed to \textbackslash{}code\{xcms::CentWaveParam\} for}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{xcms::findChromPeaks\}}
\CommentTok{\#\textquotesingle{} @param minFraction passed to \textbackslash{}code\{xcms::PeakDensityParam\} for}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{xcms::fillChromPeaks\}}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{default\_detectFlow\}: Create [detectFlow{-}class] object for}
\CommentTok{\#\textquotesingle{} Feature Detection.}
\CommentTok{\#\textquotesingle{} @rdname detectFlow{-}class}
\NormalTok{default\_detectFlow }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x,}
  \AttributeTok{snthresh =} \DecValTok{5}\NormalTok{, }\AttributeTok{noise =} \DecValTok{50000}\NormalTok{, }\AttributeTok{peakwidth =} \FunctionTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{30}\NormalTok{), }\AttributeTok{ppm =} \DecValTok{20}\NormalTok{,}
  \AttributeTok{minFraction =}\NormalTok{ .}\DecValTok{1}\NormalTok{)}
\NormalTok{\{}
  \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is}\NormalTok{(x, }\StringTok{"mcmass"}\NormalTok{)) \{}
    \FunctionTok{stop}\NormalTok{(}\StringTok{"\textasciigrave{}x\textasciigrave{} must be a \textquotesingle{}mcmass\textquotesingle{} object."}\NormalTok{)}
\NormalTok{  \}}
\NormalTok{  args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}
    \FunctionTok{new\_command}\NormalTok{(MSnbase}\SpecialCharTok{::}\NormalTok{readMSData,}
      \AttributeTok{files =} \FunctionTok{sample\_metadata}\NormalTok{(x)}\SpecialCharTok{$}\NormalTok{file,}
      \AttributeTok{centroided. =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{mode =} \StringTok{"onDisk"}\NormalTok{,}
      \AttributeTok{pdata =} \FunctionTok{new}\NormalTok{(}\StringTok{"NAnnotatedDataFrame"}\NormalTok{, }\FunctionTok{sample\_metadata}\NormalTok{(x))}
\NormalTok{      ),}
    \FunctionTok{new\_command}\NormalTok{(xcms}\SpecialCharTok{::}\NormalTok{findChromPeaks, }\AttributeTok{object =} \FunctionTok{toBeEval}\NormalTok{(}\StringTok{"raw\_data(x)"}\NormalTok{),}
      \AttributeTok{param =}\NormalTok{ xcms}\SpecialCharTok{::}\FunctionTok{CentWaveParam}\NormalTok{(}\AttributeTok{snthresh =}\NormalTok{ snthresh,}
        \AttributeTok{noise =}\NormalTok{ noise, }\AttributeTok{peakwidth =}\NormalTok{ peakwidth, }\AttributeTok{ppm =}\NormalTok{ ppm)}
\NormalTok{      ), }
    \FunctionTok{new\_command}\NormalTok{(xcms}\SpecialCharTok{::}\NormalTok{adjustRtime, }\AttributeTok{object =} \FunctionTok{toBeEval}\NormalTok{(),}
      \AttributeTok{param =}\NormalTok{ xcms}\SpecialCharTok{::}\FunctionTok{ObiwarpParam}\NormalTok{()}
\NormalTok{      ),}
    \FunctionTok{new\_command}\NormalTok{(xcms}\SpecialCharTok{::}\NormalTok{groupChromPeaks, }\AttributeTok{object =} \FunctionTok{toBeEval}\NormalTok{(),}
      \AttributeTok{param =}\NormalTok{ xcms}\SpecialCharTok{::}\FunctionTok{PeakDensityParam}\NormalTok{(}
        \AttributeTok{sampleGroups =} \FunctionTok{sample\_metadata}\NormalTok{(x)}\SpecialCharTok{$}\NormalTok{group,}
        \AttributeTok{minFraction =}\NormalTok{ minFraction)}
\NormalTok{      ),}
    \FunctionTok{new\_command}\NormalTok{(xcms}\SpecialCharTok{::}\NormalTok{fillChromPeaks, }\AttributeTok{object =} \FunctionTok{toBeEval}\NormalTok{(), }
      \AttributeTok{param =}\NormalTok{ xcms}\SpecialCharTok{::}\FunctionTok{ChromPeakAreaParam}\NormalTok{()}
\NormalTok{    )}
\NormalTok{  )}
  \FunctionTok{names}\NormalTok{(args) }\OtherTok{\textless{}{-}} \FunctionTok{vapply}\NormalTok{(args, command\_name, }\StringTok{"ch"}\NormalTok{)}
  \FunctionTok{new}\NormalTok{(}\StringTok{"detectFlow"}\NormalTok{, }\AttributeTok{layers =}\NormalTok{ args)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @importFrom methods new}
\CommentTok{\#\textquotesingle{} @importFrom methods getClass}
\CommentTok{\#\textquotesingle{} @export new\_mcmass}
\CommentTok{\#\textquotesingle{} @aliases new\_mcmass}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{new\_mcmass\}: Create a [mcmass{-}class] object.}
\CommentTok{\#\textquotesingle{} @param sample\_metadata data.frame. Contains columns of \textquotesingle{}file\textquotesingle{}, \textquotesingle{}sample\textquotesingle{},}
\CommentTok{\#\textquotesingle{} \textquotesingle{}group\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param snthresh passed to \textbackslash{}code\{xcms::CentWaveParam\} for}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{xcms::findChromPeaks\}}
\CommentTok{\#\textquotesingle{} @param noise passed to \textbackslash{}code\{xcms::CentWaveParam\} for}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{xcms::findChromPeaks\}}
\CommentTok{\#\textquotesingle{} @param peakwidth passed to \textbackslash{}code\{xcms::CentWaveParam\} for}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{xcms::findChromPeaks\}}
\CommentTok{\#\textquotesingle{} @param ppm passed to \textbackslash{}code\{xcms::CentWaveParam\} for}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{xcms::findChromPeaks\}}
\CommentTok{\#\textquotesingle{} @param minFraction passed to \textbackslash{}code\{xcms::PeakDensityParam\} for}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{xcms::fillChromPeaks\}}
\CommentTok{\#\textquotesingle{} @rdname mcmass{-}class}
\NormalTok{new\_mcmass }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(sample\_metadata,}
  \AttributeTok{snthresh =} \DecValTok{5}\NormalTok{, }\AttributeTok{noise =} \DecValTok{50000}\NormalTok{, }\AttributeTok{peakwidth =} \FunctionTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{30}\NormalTok{),}
  \AttributeTok{ppm =} \DecValTok{20}\NormalTok{, }\AttributeTok{minFraction =}\NormalTok{ .}\DecValTok{1}\NormalTok{)}
\NormalTok{\{}
  \FunctionTok{.suggest\_bio\_package}\NormalTok{(}\StringTok{"xcms"}\NormalTok{)}
\NormalTok{  mcm }\OtherTok{\textless{}{-}} \FunctionTok{.mcmass}\NormalTok{(}
    \AttributeTok{raw\_data =} \FunctionTok{new}\NormalTok{(}\FunctionTok{getClass}\NormalTok{(}\StringTok{"OnDiskMSnExp"}\NormalTok{, }\AttributeTok{where =} \StringTok{"MSnbase"}\NormalTok{)),}
    \AttributeTok{pro\_data =} \FunctionTok{new}\NormalTok{(}\FunctionTok{getClass}\NormalTok{(}\StringTok{"XCMSnExp"}\NormalTok{, }\AttributeTok{where =} \StringTok{"xcms"}\NormalTok{)),}
    \AttributeTok{features\_defination =} \FunctionTok{new}\NormalTok{(}\FunctionTok{getClass}\NormalTok{(}\StringTok{"DFrame"}\NormalTok{, }\AttributeTok{where =} \StringTok{"S4Vectors"}\NormalTok{)),}
    \AttributeTok{ms2\_spectra =} \FunctionTok{new}\NormalTok{(}\FunctionTok{getClass}\NormalTok{(}\StringTok{"MSpectra"}\NormalTok{, }\AttributeTok{where =} \StringTok{"MSnbase"}\NormalTok{)),}
    \AttributeTok{sample\_metadata =}\NormalTok{ sample\_metadata,}
    \AttributeTok{detectFlow =} \FunctionTok{.detectFlow}\NormalTok{()}
\NormalTok{  )}
  \FunctionTok{detectFlow}\NormalTok{(mcm) }\OtherTok{\textless{}{-}} \FunctionTok{default\_detectFlow}\NormalTok{(}
\NormalTok{    mcm, }\AttributeTok{snthresh =}\NormalTok{ snthresh, }\AttributeTok{noise =}\NormalTok{ noise, }\AttributeTok{peakwidth =}\NormalTok{ peakwidth,}
    \AttributeTok{ppm =}\NormalTok{ ppm, }\AttributeTok{minFraction =}\NormalTok{ minFraction}
\NormalTok{  )}
  \FunctionTok{return}\NormalTok{(mcm)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export set\_biocParallel}
\CommentTok{\#\textquotesingle{} @aliases set\_biocParallel}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{set\_biocParallel\}: Set global parrallel processing for}
\CommentTok{\#\textquotesingle{} package \textbackslash{}code\{xcms\} or relative packages. See \textbackslash{}code\{BiocParallel::register\}.}
\CommentTok{\#\textquotesingle{} @param workers integer(1). See \textbackslash{}code\{BiocParallel::MulticoreParam\} or}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{BiocParallel::SnowParam\} for help}
\CommentTok{\#\textquotesingle{} @param ... Other Parameters passed to \textbackslash{}code\{BiocParallel::MulticoreParam\} or}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{BiocParallel::SnowParam\}.}
\CommentTok{\#\textquotesingle{} @rdname run\_lcms{-}methods}
\NormalTok{set\_biocParallel }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(workers, ...) \{}
  \ControlFlowTok{if}\NormalTok{ (.Platform}\SpecialCharTok{$}\NormalTok{OS.type }\SpecialCharTok{==} \StringTok{"unix"}\NormalTok{) \{}
\NormalTok{    BiocParallel}\SpecialCharTok{::}\FunctionTok{register}\NormalTok{(}
\NormalTok{      BiocParallel}\SpecialCharTok{::}\FunctionTok{bpstart}\NormalTok{(}
\NormalTok{        BiocParallel}\SpecialCharTok{::}\FunctionTok{MulticoreParam}\NormalTok{(workers, ...)))}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    BiocParallel}\SpecialCharTok{::}\FunctionTok{register}\NormalTok{(}
\NormalTok{      BiocParallel}\SpecialCharTok{::}\FunctionTok{bpstart}\NormalTok{(}
\NormalTok{        BiocParallel}\SpecialCharTok{::}\FunctionTok{SnowParam}\NormalTok{(workers, ...)))}
\NormalTok{  \}}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# the following functions were source from }
\CommentTok{\# https://raw.githubusercontent.com/jorainer/xcms{-}gnps{-}tools/master/customFunctions.R}
\CommentTok{\# but revised}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\#\textquotesingle{} @title Format MS2 spectra for export in GNPS{-}MGF format}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} Re{-}format MS2 spectrum information for export of the data in Mgf format}
\CommentTok{\#\textquotesingle{} supported by GNPS. In detail, the function replaces the acquisition number}
\CommentTok{\#\textquotesingle{} of each spectrum with the feature ID (expected to be present in the}
\CommentTok{\#\textquotesingle{} \textasciigrave{}"feature\_id"\textasciigrave{} column of \textasciigrave{}mcols(x)\textasciigrave{}) converted to an integer by removing}
\CommentTok{\#\textquotesingle{} the ID\textquotesingle{}s leading \textasciigrave{}"FT"\textasciigrave{}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x \textasciigrave{}Spectra\textasciigrave{}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @return \textasciigrave{}Spectra\textasciigrave{} with the acquisition number replaced.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @author Johannes Rainer}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @noRd}
\NormalTok{formatSpectraForGNPS }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  fids }\OtherTok{\textless{}{-}}\NormalTok{ S4Vectors}\SpecialCharTok{::}\FunctionTok{mcols}\NormalTok{(x)}\SpecialCharTok{$}\NormalTok{feature\_id}
  \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{length}\NormalTok{(fids))}
    \FunctionTok{stop}\NormalTok{(}\StringTok{"No column named \textquotesingle{}feature\_id\textquotesingle{} present in \textquotesingle{}mcols(x)\textquotesingle{}"}\NormalTok{)}
\NormalTok{  fids }\OtherTok{\textless{}{-}} \FunctionTok{as.integer}\NormalTok{(}\FunctionTok{sub}\NormalTok{(}\StringTok{"\^{}FT"}\NormalTok{, }\StringTok{""}\NormalTok{, fids))}
\NormalTok{  S4Vectors}\SpecialCharTok{::}\FunctionTok{mendoapply}\NormalTok{(x, fids, }\AttributeTok{FUN =} \ControlFlowTok{function}\NormalTok{(z, id) \{}
\NormalTok{    z}\SpecialCharTok{@}\NormalTok{acquisitionNum }\OtherTok{\textless{}{-}}\NormalTok{ id}
\NormalTok{    z}
\NormalTok{  \})}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @title Plot multiple spectra into the same plot}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} Plot multiple spectra into the same plot.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x \textasciigrave{}Spectra\textasciigrave{} that should be plotted.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param col color to be used for the individual peaks.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param type \textasciigrave{}character(1)\textasciigrave{} defining the plot type. Defaults to \textasciigrave{}"h"\textasciigrave{} to plot}
\CommentTok{\#\textquotesingle{}     vertical lines. For more details see documentation of \textasciigrave{}plot\textasciigrave{}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param main \textasciigrave{}character(1)\textasciigrave{} defining the title.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @param ... additional arguments to be passed to \textasciigrave{}points\textasciigrave{}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @author Johannes Rainer}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @noRd}
\NormalTok{plotSpectra }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, }\AttributeTok{col =} \StringTok{"\#00000040"}\NormalTok{, }\AttributeTok{type =} \StringTok{"h"}\NormalTok{, main, ...) \{}
\NormalTok{  xcms}\SpecialCharTok{::}\FunctionTok{plot}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{, }\AttributeTok{pch =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{xlab =} \StringTok{"m/z"}\NormalTok{, }\AttributeTok{ylab =} \StringTok{"intensity"}\NormalTok{,}
    \AttributeTok{xlim =} \FunctionTok{range}\NormalTok{(ProtGenerics}\SpecialCharTok{::}\FunctionTok{mz}\NormalTok{(x)),}
    \AttributeTok{ylim =} \FunctionTok{range}\NormalTok{(ProtGenerics}\SpecialCharTok{::}\FunctionTok{intensity}\NormalTok{(x)), }\AttributeTok{main =}\NormalTok{ main)}
\NormalTok{  tmp }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(x,}
    \ControlFlowTok{function}\NormalTok{(z) \{}
\NormalTok{      graphics}\SpecialCharTok{::}\FunctionTok{points}\NormalTok{(ProtGenerics}\SpecialCharTok{::}\FunctionTok{mz}\NormalTok{(z), ProtGenerics}\SpecialCharTok{::}\FunctionTok{intensity}\NormalTok{(z),}
        \AttributeTok{type =}\NormalTok{ type, }\AttributeTok{col =}\NormalTok{ col,}
\NormalTok{        ...)}
\NormalTok{    \})}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @title Select spectrum with maximal intensity from a list of spectra}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} \textasciigrave{}maxTic\textasciigrave{} can be used with the \textasciigrave{}combineSpectra\textasciigrave{} method to select the spectrum}
\CommentTok{\#\textquotesingle{} with the largest overall signal from a list of spectra.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param z \textasciigrave{}Spectra\textasciigrave{} object.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @return \textasciigrave{}Spectrum\textasciigrave{}}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @author Johannes Rainer}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @noRd}
\NormalTok{maxTic }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(z) \{}
\NormalTok{  z[[BiocGenerics}\SpecialCharTok{::}\FunctionTok{which.max}\NormalTok{(}\FunctionTok{lapply}\NormalTok{(ProtGenerics}\SpecialCharTok{::}\FunctionTok{intensity}\NormalTok{(z), sum))]]}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @title Convert CAMERA output to an edge list for GNPS}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} \textasciigrave{}getEdgelist\textasciigrave{} takes the output from the \textasciigrave{}getPeaklist\textasciigrave{} function from \textasciigrave{}CAMERA\textasciigrave{}}
\CommentTok{\#\textquotesingle{} and converts it to a \textasciigrave{}data.frame\textasciigrave{} with edge definitions for *GNPS*. Each}
\CommentTok{\#\textquotesingle{} row in that \textasciigrave{}data.frame\textasciigrave{} contains in columns \textasciigrave{}"ID1"\textasciigrave{} and \textasciigrave{}"ID2"\textasciigrave{} the}
\CommentTok{\#\textquotesingle{} identifiers (i.e. \textasciigrave{}rownames\textasciigrave{} of the input \textasciigrave{}data.frame\textasciigrave{}) of the features.}
\CommentTok{\#\textquotesingle{} Column \textasciigrave{}"EdgeType"\textasciigrave{} is always \textasciigrave{}"MS1 annotation"\textasciigrave{} and column \textasciigrave{}"Score"\textasciigrave{} \textasciigrave{}NA\textasciigrave{}}
\CommentTok{\#\textquotesingle{} (since no score can be exported from \textasciigrave{}CAMERA\textasciigrave{}). Columns \textasciigrave{}"Annotation"\textasciigrave{}}
\CommentTok{\#\textquotesingle{} contains the adduct names and their difference in m/z if **both** edges}
\CommentTok{\#\textquotesingle{} (features) were predicted to be an adduct of the **same** compound. If}
\CommentTok{\#\textquotesingle{} isotope annotations are available, these are also added to the column.}
\CommentTok{\#\textquotesingle{} Column \textasciigrave{}"CorrelationGroup"\textasciigrave{} provides the information which}
\CommentTok{\#\textquotesingle{} features were grouped by \textasciigrave{}CAMERA\textasciigrave{} into the same group.}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @param peaklist \textasciigrave{}data.frame\textasciigrave{} as returned by the [getPeaklist()] function}
\CommentTok{\#\textquotesingle{}   from \textasciigrave{}CAMERA\textasciigrave{} package or an \textasciigrave{}xsAnnotate\textasciigrave{} object.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @return \textasciigrave{}data.frame\textasciigrave{} with edge definitions (see description for more}
\CommentTok{\#\textquotesingle{}     details).}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @author Mar Garcia{-}Aloy}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} res \textless{}{-} getEdgelist(getPeaklist(xsaFA))}
\CommentTok{\#\textquotesingle{} @noRd}
\NormalTok{getEdgelist }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(peaklist) \{}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is}\NormalTok{(peaklist, }\StringTok{"xsAnnotate"}\NormalTok{)) \{}
\NormalTok{    peaklist }\OtherTok{\textless{}{-}}\NormalTok{ CAMERA}\SpecialCharTok{::}\FunctionTok{getPeaklist}\NormalTok{(peaklist)}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{nrow}\NormalTok{(peaklist))}
      \FunctionTok{stop}\NormalTok{(}\StringTok{"Got an empty peak list."}\NormalTok{)}
\NormalTok{  \}}
\NormalTok{  pl }\OtherTok{\textless{}{-}} \FunctionTok{split}\NormalTok{(peaklist, }\FunctionTok{factor}\NormalTok{(peaklist}\SpecialCharTok{$}\NormalTok{pcgroup,}
      \AttributeTok{levels =} \FunctionTok{unique}\NormalTok{(peaklist}\SpecialCharTok{$}\NormalTok{pcgroup)))}
\NormalTok{  res }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(rbind, }\FunctionTok{lapply}\NormalTok{(pl, .process\_pcgroup))}
  \FunctionTok{rownames}\NormalTok{(res) }\OtherTok{\textless{}{-}} \ConstantTok{NULL}
\NormalTok{  res}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @title Extract feature annotations from CAMERA results}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} Similar to the \textasciigrave{}getEdgelist\textasciigrave{} function, this function extracts information}
\CommentTok{\#\textquotesingle{} from a \textasciigrave{}CAMERA\textasciigrave{} result for use in GNPS.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param x \textasciigrave{}xsAnnotate\textasciigrave{} object after calling \textasciigrave{}findAdducts\textasciigrave{}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @return}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} \textasciigrave{}data.frame\textasciigrave{} with columns:}
\CommentTok{\#\textquotesingle{} {-} \textasciigrave{}"annotation network number"\textasciigrave{}: ion identity network (IIN) number. All}
\CommentTok{\#\textquotesingle{}   features predicted by \textasciigrave{}CAMERA\textasciigrave{} to be an adduct of a (co{-}eluting) compound}
\CommentTok{\#\textquotesingle{}   with the same mass are part of this IIN. If a feature was predicted to be}
\CommentTok{\#\textquotesingle{}   an adduct of two different compounds (with different masses) the ID of the}
\CommentTok{\#\textquotesingle{}   larger network is reported. All features for which no adduct annotation is}
\CommentTok{\#\textquotesingle{}   available will have an \textasciigrave{}NA\textasciigrave{} in this column.}
\CommentTok{\#\textquotesingle{} {-} \textasciigrave{}"best ion"\textasciigrave{}: the adduct definition of the feature.}
\CommentTok{\#\textquotesingle{} {-} \textasciigrave{}"correlation group ID"\textasciigrave{}: this corresponds to the \textasciigrave{}"pcgroup"\textasciigrave{} column in}
\CommentTok{\#\textquotesingle{}   \textasciigrave{}getPeaklist(x)\textasciigrave{}.}
\CommentTok{\#\textquotesingle{} {-} \textasciigrave{}"auto MS2 verify"\textasciigrave{}: always \textasciigrave{}NA\textasciigrave{}.}
\CommentTok{\#\textquotesingle{} {-} \textasciigrave{}"identified by n="\textasciigrave{}: the size of the IIN.}
\CommentTok{\#\textquotesingle{} {-} \textasciigrave{}"partners"\textasciigrave{}: all other features (rows in the feature table) of this IIN.}
\CommentTok{\#\textquotesingle{} {-} \textasciigrave{}"neutral M mass"\textasciigrave{}: the mass of the compound.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @author Johannes Rainer}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @noRd}
\NormalTok{getFeatureAnnotations }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
  \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{length}\NormalTok{(x}\SpecialCharTok{@}\NormalTok{annoID))}
    \FunctionTok{stop}\NormalTok{(}\StringTok{"No adduct information present. Please call \textquotesingle{}findAdducts\textquotesingle{} on "}\NormalTok{,}
      \StringTok{"the object."}\NormalTok{)}
\NormalTok{  corr\_group }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\FunctionTok{seq\_along}\NormalTok{(x}\SpecialCharTok{@}\NormalTok{pspectra), }\FunctionTok{lengths}\NormalTok{(x}\SpecialCharTok{@}\NormalTok{pspectra))}
\NormalTok{  corr\_group }\OtherTok{\textless{}{-}}\NormalTok{ corr\_group[}\FunctionTok{order}\NormalTok{(}\FunctionTok{unlist}\NormalTok{(x}\SpecialCharTok{@}\NormalTok{pspectra, }\AttributeTok{use.names =} \ConstantTok{FALSE}\NormalTok{))]}

  \DocumentationTok{\#\# Get the all ids (feature rows) for which an adduct was defined}
\NormalTok{  ids }\OtherTok{\textless{}{-}} \FunctionTok{unique}\NormalTok{(x}\SpecialCharTok{@}\NormalTok{annoID[, }\StringTok{"id"}\NormalTok{])}

  \DocumentationTok{\#\# Note: @pspectra contains the "correlation groups", @annoID the}
  \DocumentationTok{\#\# adduct groups, but it can happen that two ids are in the same adduct}
  \DocumentationTok{\#\# group without being in the same correlation group!}

  \DocumentationTok{\#\# loop through the adduct definitions and build the output data.frame}
\NormalTok{  adduct\_def }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(ids, }\ControlFlowTok{function}\NormalTok{(id) \{}
    \DocumentationTok{\#\# IDs of the same correlation group}
\NormalTok{    ids\_pcgroup }\OtherTok{\textless{}{-}}\NormalTok{ x}\SpecialCharTok{@}\NormalTok{pspectra[[corr\_group[id]]]}
    \DocumentationTok{\#\# ID of the adduct annotation groups this id is part of }
\NormalTok{    anno\_grp }\OtherTok{\textless{}{-}}\NormalTok{ x}\SpecialCharTok{@}\NormalTok{annoID[x}\SpecialCharTok{@}\NormalTok{annoID[, }\StringTok{"id"}\NormalTok{] }\SpecialCharTok{==}\NormalTok{ id, }\StringTok{"grpID"}\NormalTok{]}
    \DocumentationTok{\#\# Subset the adduct annotation to rows matching the annotation group}
    \DocumentationTok{\#\# of the present ID and to ids present in the same correlation group.}
\NormalTok{    adduct\_ann }\OtherTok{\textless{}{-}}\NormalTok{ x}\SpecialCharTok{@}\NormalTok{annoID[x}\SpecialCharTok{@}\NormalTok{annoID[, }\StringTok{"id"}\NormalTok{] }\SpecialCharTok{\%in\%}\NormalTok{ ids\_pcgroup }\SpecialCharTok{\&}
\NormalTok{      x}\SpecialCharTok{@}\NormalTok{annoID[, }\StringTok{"grpID"}\NormalTok{] }\SpecialCharTok{\%in\%}\NormalTok{ anno\_grp, , drop }\OtherTok{=} \ConstantTok{FALSE}\NormalTok{]}
    \DocumentationTok{\#\# if we have more than one annotation group, select the bigger one}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(anno\_grp) }\SpecialCharTok{\textgreater{}} \DecValTok{1}\NormalTok{) \{}
\NormalTok{      cnts }\OtherTok{\textless{}{-}}\NormalTok{ BiocGenerics}\SpecialCharTok{::}\FunctionTok{table}\NormalTok{(adduct\_ann[, }\StringTok{"grpID"}\NormalTok{])}
\NormalTok{      adduct\_ann }\OtherTok{\textless{}{-}}\NormalTok{ adduct\_ann[}
\NormalTok{        adduct\_ann[, }\StringTok{"grpID"}\NormalTok{] }\SpecialCharTok{==}
          \FunctionTok{names}\NormalTok{(cnts)[}\FunctionTok{order}\NormalTok{(cnts, }\AttributeTok{decreasing =} \ConstantTok{TRUE}\NormalTok{)][}\DecValTok{1}\NormalTok{], ,}
\NormalTok{        drop }\OtherTok{=} \ConstantTok{FALSE}\NormalTok{]}
\NormalTok{    \}}
\NormalTok{    grp\_id }\OtherTok{\textless{}{-}}\NormalTok{ adduct\_ann[}\DecValTok{1}\NormalTok{, }\StringTok{"grpID"}\NormalTok{]}
    \DocumentationTok{\#\# different adduct rules can match the same m/z {-} we\textquotesingle{}re just taking}
    \DocumentationTok{\#\# the first one (with lower ruleID)}
\NormalTok{    rule\_id }\OtherTok{\textless{}{-}}\NormalTok{ adduct\_ann[adduct\_ann[, }\StringTok{"id"}\NormalTok{] }\SpecialCharTok{==}\NormalTok{ id, }\StringTok{"ruleID"}\NormalTok{][}\DecValTok{1}\NormalTok{]}
\NormalTok{    ids\_grp }\OtherTok{\textless{}{-}}\NormalTok{ adduct\_ann[, }\StringTok{"id"}\NormalTok{]}
\NormalTok{    df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
      \StringTok{\textasciigrave{}}\AttributeTok{row ID}\StringTok{\textasciigrave{}} \OtherTok{=}\NormalTok{ id,}
      \StringTok{\textasciigrave{}}\AttributeTok{annotation network number}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{unname}\NormalTok{(grp\_id),}
      \StringTok{\textasciigrave{}}\AttributeTok{best ion}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{as.character}\NormalTok{(x}\SpecialCharTok{@}\NormalTok{ruleset[rule\_id, }\StringTok{"name"}\NormalTok{]),}
      \StringTok{\textasciigrave{}}\AttributeTok{identified by n=}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{nrow}\NormalTok{(adduct\_ann),}
      \StringTok{\textasciigrave{}}\AttributeTok{partners}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{paste0}\NormalTok{(ids\_grp[ids\_grp }\SpecialCharTok{!=}\NormalTok{ id], }\AttributeTok{collapse =} \StringTok{";"}\NormalTok{),}
      \StringTok{\textasciigrave{}}\AttributeTok{neutral M mass}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{unname}\NormalTok{(}
\NormalTok{        x}\SpecialCharTok{@}\NormalTok{annoGrp[x}\SpecialCharTok{@}\NormalTok{annoGrp[, }\StringTok{"id"}\NormalTok{] }\SpecialCharTok{==}\NormalTok{ grp\_id, }\StringTok{"mass"}\NormalTok{]),}
      \AttributeTok{stringsAsFactors =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{      \})}
\NormalTok{  adduct\_def }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(rbind, adduct\_def)}
\NormalTok{  res }\OtherTok{\textless{}{-}}\NormalTok{ adduct\_def[}\FunctionTok{rep}\NormalTok{(}\StringTok{"other"}\NormalTok{, }\FunctionTok{length}\NormalTok{(corr\_group)), ]}
\NormalTok{  res[, }\StringTok{"row ID"}\NormalTok{] }\OtherTok{\textless{}{-}} \FunctionTok{seq\_along}\NormalTok{(corr\_group)}
  \FunctionTok{rownames}\NormalTok{(res) }\OtherTok{\textless{}{-}} \FunctionTok{as.character}\NormalTok{(res[, }\StringTok{"row ID"}\NormalTok{])}
\NormalTok{  res[ids, ] }\OtherTok{\textless{}{-}}\NormalTok{ adduct\_def}
\NormalTok{  res}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{correlation group ID}\StringTok{\textasciigrave{}} \OtherTok{\textless{}{-}}\NormalTok{ corr\_group}
\NormalTok{  res}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{auto MS2 verify}\StringTok{\textasciigrave{}} \OtherTok{\textless{}{-}} \ConstantTok{NA}
\NormalTok{  res}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} Helper function to extract the adduct annotation from a pair of adducts}
\CommentTok{\#\textquotesingle{} from the same *pcgroup*.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @author Mar Garcia{-}Aloy}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @noRd}
\NormalTok{.define\_annot }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(y) \{}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{any}\NormalTok{(y}\SpecialCharTok{$}\NormalTok{adduct }\SpecialCharTok{==} \StringTok{""}\NormalTok{)) }\FunctionTok{return}\NormalTok{(}\ConstantTok{NA}\NormalTok{)}
\NormalTok{  mass\_1 }\OtherTok{\textless{}{-}} \FunctionTok{.extract\_mass\_adduct}\NormalTok{(y}\SpecialCharTok{$}\NormalTok{adduct[}\DecValTok{1}\NormalTok{])}
\NormalTok{  mass\_2 }\OtherTok{\textless{}{-}} \FunctionTok{.extract\_mass\_adduct}\NormalTok{(y}\SpecialCharTok{$}\NormalTok{adduct[}\DecValTok{2}\NormalTok{])}
\NormalTok{  mass }\OtherTok{\textless{}{-}}\NormalTok{ BiocGenerics}\SpecialCharTok{::}\FunctionTok{intersect}\NormalTok{(mass\_1, mass\_2)}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(mass)) \{}
\NormalTok{    def1 }\OtherTok{\textless{}{-}} \FunctionTok{unlist}\NormalTok{(}\FunctionTok{strsplit}\NormalTok{(y}\SpecialCharTok{$}\NormalTok{adduct[}\DecValTok{1}\NormalTok{], }\StringTok{" "}\NormalTok{))}
\NormalTok{    def2 }\OtherTok{\textless{}{-}} \FunctionTok{unlist}\NormalTok{(}\FunctionTok{strsplit}\NormalTok{(y}\SpecialCharTok{$}\NormalTok{adduct[}\DecValTok{2}\NormalTok{], }\StringTok{" "}\NormalTok{))}
    \FunctionTok{paste0}\NormalTok{(def1[}\FunctionTok{grep}\NormalTok{(mass[}\DecValTok{1}\NormalTok{], def1) }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{], }\StringTok{" "}\NormalTok{,}
\NormalTok{      def2[}\FunctionTok{grep}\NormalTok{(mass[}\DecValTok{1}\NormalTok{], def2) }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{], }\StringTok{" dm/z="}\NormalTok{,}
      \FunctionTok{round}\NormalTok{(}\FunctionTok{abs}\NormalTok{(y}\SpecialCharTok{$}\NormalTok{mz[}\DecValTok{1}\NormalTok{] }\SpecialCharTok{{-}}\NormalTok{ y}\SpecialCharTok{$}\NormalTok{mz[}\DecValTok{2}\NormalTok{]), }\DecValTok{4}\NormalTok{))}
\NormalTok{  \} }\ControlFlowTok{else} \ConstantTok{NA}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} Helper function to extract the isotope annotation from a pair of adducts}
\CommentTok{\#\textquotesingle{} from the same *pcgroup*.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @author Mar Garcia{-}Aloy}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @noRd}
\NormalTok{.define\_isotop }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(w) \{}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{any}\NormalTok{(w}\SpecialCharTok{$}\NormalTok{isotopes }\SpecialCharTok{==} \StringTok{""}\NormalTok{)) }\FunctionTok{return}\NormalTok{(}\ConstantTok{NA}\NormalTok{)}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{unlist}\NormalTok{(}\FunctionTok{strsplit}\NormalTok{(w}\SpecialCharTok{$}\NormalTok{isotopes[}\DecValTok{1}\NormalTok{], }\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{]}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{[\textquotesingle{}}\NormalTok{) )[}\DecValTok{1}\NormalTok{] }\SpecialCharTok{==} 
    \FunctionTok{unlist}\NormalTok{(}\FunctionTok{strsplit}\NormalTok{(w}\SpecialCharTok{$}\NormalTok{isotopes[}\DecValTok{2}\NormalTok{], }\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{]}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{[\textquotesingle{}}\NormalTok{) )[}\DecValTok{1}\NormalTok{]) \{}
\NormalTok{    a }\OtherTok{=} \FunctionTok{paste0}\NormalTok{(}\StringTok{"["}\NormalTok{, }\FunctionTok{do.call}\NormalTok{(rbind, }\FunctionTok{strsplit}\NormalTok{(w}\SpecialCharTok{$}\NormalTok{isotopes, }\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{]}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{["}\NormalTok{))[, }\DecValTok{2}\NormalTok{], }
      \AttributeTok{collapse =} \StringTok{" "}\NormalTok{)}
\NormalTok{    b }\OtherTok{=} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{unlist}\NormalTok{(}\FunctionTok{strsplit}\NormalTok{(w}\SpecialCharTok{$}\NormalTok{isotopes[}\DecValTok{2}\NormalTok{], }\StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{]\textquotesingle{}}\NormalTok{) )[}\DecValTok{1}\NormalTok{], }\StringTok{"]"}\NormalTok{)}
    \FunctionTok{paste0}\NormalTok{(b, a, }\StringTok{" dm/z="}\NormalTok{, }\FunctionTok{round}\NormalTok{(}\FunctionTok{abs}\NormalTok{(w}\SpecialCharTok{$}\NormalTok{mz[}\DecValTok{1}\NormalTok{] }\SpecialCharTok{{-}}\NormalTok{ w}\SpecialCharTok{$}\NormalTok{mz[}\DecValTok{2}\NormalTok{]), }\DecValTok{4}\NormalTok{))}
\NormalTok{  \} }\ControlFlowTok{else} \ConstantTok{NA}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} Simple helper to extract the mass(es) from strings such as}
\CommentTok{\#\textquotesingle{} [M+NH4]+ 70.9681 [M+H]+ 87.9886}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @author Johannes Rainer}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @noRd}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} .extract\_mass\_adduct("[M+NH4]+ 70.9681 [M+H]+ 87.9886")}
\CommentTok{\#\textquotesingle{} .extract\_mass\_adduct("some 4")}
\NormalTok{.extract\_mass\_adduct }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
  \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{length}\NormalTok{(x) }\SpecialCharTok{||}\NormalTok{ x }\SpecialCharTok{==} \StringTok{""}\NormalTok{) }\FunctionTok{return}\NormalTok{(}\ConstantTok{NA}\NormalTok{)}
\NormalTok{  spl }\OtherTok{\textless{}{-}} \FunctionTok{unlist}\NormalTok{(}\FunctionTok{strsplit}\NormalTok{(x, }\StringTok{" "}\NormalTok{, }\AttributeTok{fixed =} \ConstantTok{TRUE}\NormalTok{))}
\NormalTok{  spl[}\FunctionTok{seq}\NormalTok{(}\DecValTok{2}\NormalTok{, }\AttributeTok{by =} \DecValTok{2}\NormalTok{, }\AttributeTok{length.out =} \FunctionTok{length}\NormalTok{(spl)}\SpecialCharTok{/}\DecValTok{2}\NormalTok{)]}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} Helper function to process features from the same *pcgroup*}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @author Mar Garcia{-}Aloy}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @noRd}
\NormalTok{.process\_pcgroup }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{nrow}\NormalTok{(x) }\SpecialCharTok{\textgreater{}} \DecValTok{1}\NormalTok{) \{}
\NormalTok{    res }\OtherTok{\textless{}{-}} \FunctionTok{combn}\NormalTok{(}\FunctionTok{seq\_len}\NormalTok{(}\FunctionTok{nrow}\NormalTok{(x)), }\DecValTok{2}\NormalTok{, }\AttributeTok{FUN =} \ControlFlowTok{function}\NormalTok{(z) \{}
\NormalTok{      anno }\OtherTok{\textless{}{-}} \FunctionTok{.define\_annot}\NormalTok{(x[z, ])}
\NormalTok{      iso }\OtherTok{\textless{}{-}} \FunctionTok{.define\_isotop}\NormalTok{(x[z, ])}
      \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.na}\NormalTok{(anno[}\DecValTok{1}\NormalTok{])) anno }\OtherTok{\textless{}{-}} \FunctionTok{character}\NormalTok{()}
      \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.na}\NormalTok{(iso[}\DecValTok{1}\NormalTok{])) iso }\OtherTok{\textless{}{-}} \FunctionTok{character}\NormalTok{()}
      \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{ID1 =} \FunctionTok{rownames}\NormalTok{(x)[z[}\DecValTok{1}\NormalTok{]],}
        \AttributeTok{ID2 =}  \FunctionTok{rownames}\NormalTok{(x)[z[}\DecValTok{2}\NormalTok{]],}
        \AttributeTok{EdgeType =} \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(anno) }\SpecialCharTok{||} \FunctionTok{length}\NormalTok{(iso)) }\StringTok{"MS1 annotation"} \ControlFlowTok{else} \StringTok{"MS1 correlation"}\NormalTok{,}
        \AttributeTok{Score =} \FloatTok{0.0}\NormalTok{,}
        \AttributeTok{Annotation =} \FunctionTok{paste0}\NormalTok{(anno, iso, }\AttributeTok{collapse =} \StringTok{" "}\NormalTok{),}
        \AttributeTok{CorrelationGroup =}\NormalTok{ x}\SpecialCharTok{$}\NormalTok{pcgroup[}\DecValTok{1}\NormalTok{],}
        \AttributeTok{stringsAsFactors =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{      \}, }\AttributeTok{simplify =} \ConstantTok{FALSE}\NormalTok{)}
    \FunctionTok{do.call}\NormalTok{(rbind, res)}
\NormalTok{  \} }\ControlFlowTok{else} \ConstantTok{NULL}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-tools-yaml.r}{%
\section{File: tools-yaml.R}\label{file-tools-yaml.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# get or modify \textquotesingle{}yaml\textquotesingle{} for \textquotesingle{}report\textquotesingle{}}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\NormalTok{.yaml\_default }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(}\AttributeTok{style =} \FunctionTok{c}\NormalTok{(}\StringTok{"default"}\NormalTok{, }\StringTok{"BiocStyle"}\NormalTok{, }\StringTok{"BiocStyle\_pdf"}\NormalTok{))\{}
\NormalTok{    style }\OtherTok{\textless{}{-}} \FunctionTok{match.arg}\NormalTok{(style)}
    \FunctionTok{readLines}\NormalTok{(}\FunctionTok{system.file}\NormalTok{(}\StringTok{"extdata"}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(style, }\StringTok{".yml"}\NormalTok{),}
                                 \AttributeTok{package =} \StringTok{"MCnebula2"}\NormalTok{))}
\NormalTok{  \}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-utils.r}{%
\section{File: utils.R}\label{file-utils.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# additional function}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @importFrom stats dist hclust model.matrix reorder rnorm}
\CommentTok{\#\textquotesingle{} @importFrom utils combn head methods object.size savehistory str tail}
\CommentTok{\#\textquotesingle{} @importFrom utils write.table}
\NormalTok{setMissing }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(generic, ..., }\AttributeTok{.SIG =} \StringTok{"missing"}\NormalTok{)\{}
\NormalTok{    args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(...)}
\NormalTok{    sig }\OtherTok{\textless{}{-}} \FunctionTok{getGeneric}\NormalTok{(generic)}\SpecialCharTok{@}\NormalTok{signature}
\NormalTok{    res }\OtherTok{\textless{}{-}} \FunctionTok{vapply}\NormalTok{(sig, }\AttributeTok{FUN.VALUE =} \StringTok{"character"}\NormalTok{,}
                  \ControlFlowTok{function}\NormalTok{(name)\{}
                    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(args[[ name ]]))}
\NormalTok{                      .SIG}
                    \ControlFlowTok{else}
\NormalTok{                      args[[ name ]]}
\NormalTok{                  \})}
    \FunctionTok{names}\NormalTok{(res) }\OtherTok{\textless{}{-}}\NormalTok{ sig}
    \FunctionTok{return}\NormalTok{(res)}
\NormalTok{  \}}

\NormalTok{reCallMethod }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(funName, args, ...)\{}
\NormalTok{    arg.order }\OtherTok{\textless{}{-}} \FunctionTok{unname}\NormalTok{(}\FunctionTok{getGeneric}\NormalTok{(funName)}\SpecialCharTok{@}\NormalTok{signature)}
\NormalTok{    args.missing }\OtherTok{\textless{}{-}} \SpecialCharTok{!}\NormalTok{arg.order }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(args)}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{any}\NormalTok{(args.missing)) \{}
\NormalTok{      args.missing }\OtherTok{\textless{}{-}}\NormalTok{ arg.order[args.missing]}
\NormalTok{      args.missing }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(args.missing, }\AttributeTok{simplify =}\NormalTok{ F,}
                             \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{structure}\NormalTok{(0L, }\AttributeTok{class =} \StringTok{"missing"}\NormalTok{))}
\NormalTok{      args }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(args, args.missing)}
\NormalTok{    \}}
\NormalTok{    args }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(arg.order, }\ControlFlowTok{function}\NormalTok{(i) args[[i]])}
\NormalTok{    sig }\OtherTok{\textless{}{-}} \FunctionTok{get\_signature}\NormalTok{(args)}
\NormalTok{    method }\OtherTok{\textless{}{-}} \FunctionTok{selectMethod}\NormalTok{(funName, sig)}
\NormalTok{    last\_fun }\OtherTok{\textless{}{-}} \FunctionTok{sys.function}\NormalTok{(}\FunctionTok{sys.parent}\NormalTok{())}
\NormalTok{    n }\OtherTok{\textless{}{-}} \DecValTok{0}
    \ControlFlowTok{while}\NormalTok{ (}\FunctionTok{identical}\NormalTok{(last\_fun, method}\SpecialCharTok{@}\NormalTok{.Data, }\AttributeTok{ignore.environment =}\NormalTok{ T)) \{}
      \ControlFlowTok{if}\NormalTok{ (n }\SpecialCharTok{==} \DecValTok{0}\NormalTok{) \{}
\NormalTok{        mlist }\OtherTok{\textless{}{-}} \FunctionTok{getMethodsForDispatch}\NormalTok{(}\FunctionTok{getGeneric}\NormalTok{(funName))}
\NormalTok{      \}}
\NormalTok{      n }\OtherTok{\textless{}{-}}\NormalTok{ n }\SpecialCharTok{+} \DecValTok{1}
      \FunctionTok{rm}\NormalTok{(}\AttributeTok{list =} \FunctionTok{paste0}\NormalTok{(method}\SpecialCharTok{@}\NormalTok{defined, }\AttributeTok{collapse =} \StringTok{"\#"}\NormalTok{), }\AttributeTok{envir =}\NormalTok{ mlist)}
\NormalTok{      method }\OtherTok{\textless{}{-}} \FunctionTok{selectMethod}\NormalTok{(funName, sig, }\AttributeTok{mlist =}\NormalTok{ mlist)}
\NormalTok{    \}}
\NormalTok{    expr }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"method@.Data("}\NormalTok{,}
                   \FunctionTok{paste0}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(arg.order, }\StringTok{" = args[["}\NormalTok{,}
                                 \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(arg.order), }\StringTok{"]]"}\NormalTok{),}
                          \AttributeTok{collapse =} \StringTok{", "}\NormalTok{),}
                   \StringTok{", ...)"}\NormalTok{)}
    \FunctionTok{eval}\NormalTok{(}\FunctionTok{parse}\NormalTok{(}\AttributeTok{text =}\NormalTok{ expr))}
\NormalTok{  \}}

\NormalTok{get\_signature }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(args)\{}
    \FunctionTok{vapply}\NormalTok{(args, }\ControlFlowTok{function}\NormalTok{(arg) }\FunctionTok{class}\NormalTok{(arg)[}\DecValTok{1}\NormalTok{], }\AttributeTok{FUN.VALUE =} \StringTok{"ch"}\NormalTok{)}
\NormalTok{  \}}

\NormalTok{match\_methods }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(name, classes)\{}
\NormalTok{    methods }\OtherTok{\textless{}{-}} \FunctionTok{showMethods}\NormalTok{(}\AttributeTok{classes =}\NormalTok{ classes, }\AttributeTok{printTo =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{    methods }\OtherTok{\textless{}{-}}\NormalTok{ methods[ }\FunctionTok{grep}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"\^{}Function: "}\NormalTok{, name), methods, }\AttributeTok{perl =}\NormalTok{ T) ]}
    \FunctionTok{vapply}\NormalTok{(}\FunctionTok{strsplit}\NormalTok{(methods, }\StringTok{" "}\NormalTok{), }\StringTok{\textasciigrave{}}\AttributeTok{[}\StringTok{\textasciigrave{}}\NormalTok{, }\StringTok{"character"}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\NormalTok{  \}}

\NormalTok{vecter\_unique\_by\_names }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(lst)\{}
\NormalTok{    unique }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{names =} \FunctionTok{names}\NormalTok{(lst),}
                         \AttributeTok{order =} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(lst))}
\NormalTok{    unique }\OtherTok{\textless{}{-}}\NormalTok{ unique[}\SpecialCharTok{!}\FunctionTok{duplicated}\NormalTok{(unique}\SpecialCharTok{$}\NormalTok{names), ]}
\NormalTok{    lst[unique}\SpecialCharTok{$}\NormalTok{order]}
\NormalTok{  \}}

\NormalTok{vec\_unique\_by\_value }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(vec)\{}
\NormalTok{    unique }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{value =}\NormalTok{ vec,}
                         \AttributeTok{order =} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(vec))}
\NormalTok{    unique }\OtherTok{\textless{}{-}}\NormalTok{ unique[}\SpecialCharTok{!}\FunctionTok{duplicated}\NormalTok{(unique}\SpecialCharTok{$}\NormalTok{value), ]}
\NormalTok{    vec[unique}\SpecialCharTok{$}\NormalTok{order]}
\NormalTok{  \}}


\NormalTok{slots\_mapply }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(x, fun, ...)\{}
\NormalTok{    slots }\OtherTok{\textless{}{-}} \FunctionTok{attributes}\NormalTok{(x)}
\NormalTok{    slots }\OtherTok{\textless{}{-}}\NormalTok{ slots[}\SpecialCharTok{{-}}\FunctionTok{length}\NormalTok{(slots)]}
\NormalTok{    res }\OtherTok{\textless{}{-}} \FunctionTok{mapply}\NormalTok{(fun, }\AttributeTok{slot =}\NormalTok{ slots, }\AttributeTok{name =} \FunctionTok{names}\NormalTok{(slots), ...)}
    \FunctionTok{return}\NormalTok{(res)}
\NormalTok{  \}}


\NormalTok{mapply\_rename\_col }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(}
\NormalTok{           mutate\_set,}
\NormalTok{           replace\_set,}
\NormalTok{           names,}
           \AttributeTok{fixed =}\NormalTok{ F}
\NormalTok{           )\{}
\NormalTok{    envir }\OtherTok{\textless{}{-}} \FunctionTok{environment}\NormalTok{()}
    \FunctionTok{mapply}\NormalTok{(mutate\_set, replace\_set,}
           \AttributeTok{MoreArgs =} \FunctionTok{list}\NormalTok{(}\AttributeTok{envir =}\NormalTok{ envir, }\AttributeTok{fixed =}\NormalTok{ fixed),}
           \AttributeTok{FUN =} \ControlFlowTok{function}\NormalTok{(mutate, replace, envir,}
                          \AttributeTok{fixed =}\NormalTok{ F, }\AttributeTok{names =} \FunctionTok{get}\NormalTok{(}\StringTok{"names"}\NormalTok{, }\AttributeTok{envir =}\NormalTok{ envir))\{}
\NormalTok{             names }\OtherTok{\textless{}{-}} \FunctionTok{gsub}\NormalTok{(mutate, replace, names, }\AttributeTok{perl =} \FunctionTok{ifelse}\NormalTok{(fixed, F, T), }\AttributeTok{fixed =}\NormalTok{ fixed)}
             \FunctionTok{assign}\NormalTok{(}\StringTok{"names"}\NormalTok{, names, }\AttributeTok{envir =}\NormalTok{ envir)}
\NormalTok{           \})}
    \FunctionTok{return}\NormalTok{(names)}
\NormalTok{  \}}


\NormalTok{.show }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(object)\{}
    \FunctionTok{cat}\NormalTok{(}\FunctionTok{class}\NormalTok{(object), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
    \FunctionTok{slots\_mapply}\NormalTok{(object, }\ControlFlowTok{function}\NormalTok{(names, slots)\{}
              \FunctionTok{cat}\NormalTok{(names, }\StringTok{":}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{, }\AttributeTok{sep =} \StringTok{""}\NormalTok{)}
              \FunctionTok{cat}\NormalTok{(}\FunctionTok{str}\NormalTok{(slots))}
              \FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{           \})}
\NormalTok{  \}}

\CommentTok{\# \# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} }
\NormalTok{.message\_info }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(main, sub, }\AttributeTok{arg =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{sig =} \StringTok{"\#\#"}\NormalTok{)\{}
    \FunctionTok{message}\NormalTok{(sig, }\StringTok{" "}\NormalTok{, main, }\StringTok{": "}\NormalTok{, sub, }\StringTok{" "}\NormalTok{, arg)}
\NormalTok{  \}}

\NormalTok{.message\_info\_formal }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(main, sub, }\AttributeTok{arg =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{sig =} \StringTok{"[INFO]"}\NormalTok{)\{}
    \FunctionTok{message}\NormalTok{(sig, }\StringTok{" "}\NormalTok{, main, }\StringTok{": "}\NormalTok{, sub, }\StringTok{" "}\NormalTok{, arg)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @importFrom grid current.viewport}
\NormalTok{.message\_info\_viewport }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(}\AttributeTok{info =} \StringTok{"info"}\NormalTok{)\{}
    \FunctionTok{.message\_info}\NormalTok{(info, }\StringTok{"current.viewport:"}\NormalTok{,}
                  \FunctionTok{paste0}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n\textbackslash{}t}\StringTok{"}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(grid}\SpecialCharTok{::}\FunctionTok{current.viewport}\NormalTok{())))}
\NormalTok{  \}}

\NormalTok{.get\_missing\_x }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(x, class, }\AttributeTok{n =} \DecValTok{2}\NormalTok{, }\AttributeTok{envir =} \FunctionTok{parent.frame}\NormalTok{(n))\{}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{missing}\NormalTok{(x)) \{}
\NormalTok{      x }\OtherTok{\textless{}{-}} \FunctionTok{get}\NormalTok{(}\StringTok{"x"}\NormalTok{, }\AttributeTok{envir =}\NormalTok{ envir)}
      \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is}\NormalTok{(x, class)) \{}
        \FunctionTok{stop}\NormalTok{( }\FunctionTok{paste0}\NormalTok{(}\StringTok{"there must be an \textasciigrave{}x\textasciigrave{} of \textquotesingle{}"}\NormalTok{, class, }
                     \StringTok{"\textquotesingle{} in \textasciigrave{}parent.frame("}\NormalTok{, n }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{, }\StringTok{")\textasciigrave{}"}\NormalTok{ ) )}
\NormalTok{      \}}
\NormalTok{    \}}
    \FunctionTok{return}\NormalTok{(x)}
\NormalTok{  \}}


\CommentTok{\#\textquotesingle{} @importFrom rlang as\_label}
\NormalTok{.check\_data }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(object, lst, }\AttributeTok{tip =} \StringTok{"(...)"}\NormalTok{)\{}
\NormalTok{    target }\OtherTok{\textless{}{-}}\NormalTok{ rlang}\SpecialCharTok{::}\FunctionTok{as\_label}\NormalTok{(}\FunctionTok{substitute}\NormalTok{(object))}
    \FunctionTok{mapply}\NormalTok{(lst, }\FunctionTok{names}\NormalTok{(lst), }\AttributeTok{FUN =} \ControlFlowTok{function}\NormalTok{(value, name)\{}
\NormalTok{             obj }\OtherTok{\textless{}{-}} \FunctionTok{match.fun}\NormalTok{(name)(object)}
             \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(obj)) \{}
               \FunctionTok{stop}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"is.null("}\NormalTok{, name, }\StringTok{"("}\NormalTok{, target, }\StringTok{")) == T. "}\NormalTok{,}
                           \StringTok{"use \textasciigrave{}"}\NormalTok{, value, tip, }\StringTok{"\textasciigrave{} previously."}\NormalTok{))}
\NormalTok{             \}}
             \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.list}\NormalTok{(obj)) \{}
               \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(obj) }\SpecialCharTok{==} \DecValTok{0}\NormalTok{) \{}
                 \FunctionTok{stop}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"length("}\NormalTok{, name, }\StringTok{"("}\NormalTok{, target, }\StringTok{")) == 0. "}\NormalTok{,}
                             \StringTok{"use \textasciigrave{}"}\NormalTok{, value, tip, }\StringTok{"\textasciigrave{} previously."}\NormalTok{))}
\NormalTok{               \}}
\NormalTok{             \}}
\NormalTok{           \})}
\NormalTok{  \}}

\NormalTok{.check\_names }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(param, formal, tip1, tip2)\{}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(}\FunctionTok{names}\NormalTok{(param))) \{}
      \ControlFlowTok{if}\NormalTok{ ( }\FunctionTok{any}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{names}\NormalTok{(formal) }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(param)) ) \{}
        \FunctionTok{stop}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"the names of \textasciigrave{}"}\NormalTok{, tip1, }\StringTok{"\textasciigrave{} must contain all names of "}\NormalTok{,}
\NormalTok{                    tip2, }\StringTok{"; or without names."}
\NormalTok{                    ))}
\NormalTok{      \}}
\NormalTok{    \}}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @importFrom rlang as\_label}
\NormalTok{.check\_class }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(object, }\AttributeTok{class =} \StringTok{"layout"}\NormalTok{, }\AttributeTok{tip =} \StringTok{"grid::grid.layout"}\NormalTok{)\{}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is}\NormalTok{(object, class)) \{}
      \FunctionTok{stop}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"\textasciigrave{}"}\NormalTok{, rlang}\SpecialCharTok{::}\FunctionTok{as\_label}\NormalTok{(}\FunctionTok{substitute}\NormalTok{(object)),}
                  \StringTok{"\textasciigrave{} should be a \textquotesingle{}"}\NormalTok{, class, }\StringTok{"\textquotesingle{} object created by "}\NormalTok{,}
                  \StringTok{"\textasciigrave{}"}\NormalTok{, tip, }\StringTok{"\textasciigrave{}."}\NormalTok{ ))}
\NormalTok{    \}}
\NormalTok{  \}}

\NormalTok{.check\_columns }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(obj, lst, tip)\{}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.data.frame}\NormalTok{(obj))}
      \FunctionTok{stop}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"\textquotesingle{}"}\NormalTok{, tip, }\StringTok{"\textquotesingle{} must be a \textquotesingle{}data.frame\textquotesingle{}."}\NormalTok{))}
    \FunctionTok{lapply}\NormalTok{(lst, }\ControlFlowTok{function}\NormalTok{(col)\{}
             \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(obj[[ col ]]))}
               \FunctionTok{stop}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"\textquotesingle{}"}\NormalTok{, tip, }\StringTok{"\textquotesingle{} must contains a column of \textquotesingle{}"}\NormalTok{, col, }\StringTok{"\textquotesingle{}."}\NormalTok{))}
\NormalTok{           \})}
\NormalTok{  \}}

\NormalTok{.check\_type }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(obj, type, tip)\{}
\NormalTok{    fun }\OtherTok{\textless{}{-}} \FunctionTok{match.fun}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"is."}\NormalTok{, type))}
    \FunctionTok{apply}\NormalTok{(obj, }\DecValTok{2}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(col)\{}
            \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{fun}\NormalTok{(col))}
              \FunctionTok{stop}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"data columns in \textquotesingle{}"}\NormalTok{, tip, }\StringTok{"\textquotesingle{} must all be \textquotesingle{}"}\NormalTok{, type, }\StringTok{"\textquotesingle{}."}\NormalTok{))}
\NormalTok{           \})}
\NormalTok{  \}}

\NormalTok{.check\_path }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(path)\{}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{file.exists}\NormalTok{(path)) \{}
      \FunctionTok{dir.create}\NormalTok{(path, }\AttributeTok{recursive =}\NormalTok{ T)}
\NormalTok{    \}}
\NormalTok{  \}}

\NormalTok{.check\_file }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(file)\{}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{file.exists}\NormalTok{(file)) \{}
      \FunctionTok{stop}\NormalTok{(}\StringTok{"file.exists(file) == F, \textasciigrave{}file\textasciigrave{} not exists."}\NormalTok{)}
\NormalTok{    \}}
\NormalTok{  \}}

\NormalTok{validate\_class\_in\_list }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(lst, recepts, tip)\{}
\NormalTok{    check }\OtherTok{\textless{}{-}} 
      \FunctionTok{lapply}\NormalTok{(lst, }\ControlFlowTok{function}\NormalTok{(layer) \{}
\NormalTok{               check }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(recepts, }\ControlFlowTok{function}\NormalTok{(class) \{}
                                 \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is}\NormalTok{(layer, class)) T \})}
               \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{any}\NormalTok{(}\FunctionTok{unlist}\NormalTok{(check))) T }\ControlFlowTok{else}\NormalTok{ F}
\NormalTok{           \})}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{any}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{unlist}\NormalTok{(check)))}
      \FunctionTok{stop}\NormalTok{(tip)}
    \ControlFlowTok{else}\NormalTok{ T}
\NormalTok{  \}}

\NormalTok{.suggest\_bio\_package }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(pkg)\{}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{requireNamespace}\NormalTok{(pkg, }\AttributeTok{quietly =}\NormalTok{ T))}
      \FunctionTok{stop}\NormalTok{(}\StringTok{"package \textquotesingle{}"}\NormalTok{, pkg, }\StringTok{"\textquotesingle{} not installed. use folloing to install:}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{,}
           \StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}n}\StringTok{if (!require("BiocManager", quietly = TRUE))\textquotesingle{}}\NormalTok{,}
           \StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}n\textbackslash{}t}\StringTok{install.packages("BiocManager")\textquotesingle{}}\NormalTok{,}
           \StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}n}\StringTok{BiocManager::install("\textquotesingle{}}\NormalTok{, pkg, }\StringTok{\textquotesingle{}")}\SpecialCharTok{\textbackslash{}n\textbackslash{}n}\StringTok{\textquotesingle{}}\NormalTok{)}
\NormalTok{  \}}

\NormalTok{read\_tsv }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(path)\{}
\NormalTok{  file }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{fread}\NormalTok{(}\AttributeTok{input=}\NormalTok{path, }\AttributeTok{sep=}\StringTok{"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}\NormalTok{, }\AttributeTok{header=}\NormalTok{T, }\AttributeTok{quote=}\StringTok{""}\NormalTok{, }\AttributeTok{check.names=}\NormalTok{F)}
  \FunctionTok{return}\NormalTok{(file)}
\NormalTok{\}}

\NormalTok{pbsapply\_read\_tsv }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(path)\{}
\NormalTok{  data }\OtherTok{\textless{}{-}}\NormalTok{ pbapply}\SpecialCharTok{::}\FunctionTok{pbsapply}\NormalTok{(path, read\_tsv, }\AttributeTok{simplify =}\NormalTok{ F)}
  \FunctionTok{return}\NormalTok{(data)}
\NormalTok{\}}

\NormalTok{write\_tsv }\OtherTok{\textless{}{-}}
  \ControlFlowTok{function}\NormalTok{(x, filename, }\AttributeTok{col.names =}\NormalTok{ T, }\AttributeTok{row.names =}\NormalTok{ F)\{}
    \FunctionTok{write.table}\NormalTok{(x, }\AttributeTok{file =}\NormalTok{ filename, }\AttributeTok{sep =} \StringTok{"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}\NormalTok{,}
                \AttributeTok{col.names =}\NormalTok{ col.names, }\AttributeTok{row.names =}\NormalTok{ row.names, }\AttributeTok{quote =}\NormalTok{ F)}
\NormalTok{  \}}


\CommentTok{\#\textquotesingle{} @importFrom grid unit}
\CommentTok{\#\textquotesingle{} @importFrom ggtext element\_textbox}
\NormalTok{.element\_textbox }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(}\AttributeTok{family =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{face =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{size =} \ConstantTok{NULL}\NormalTok{,}
           \AttributeTok{colour =} \StringTok{"white"}\NormalTok{, }\AttributeTok{fill =} \StringTok{"lightblue"}\NormalTok{,}
           \AttributeTok{box.colour =} \StringTok{"white"}\NormalTok{, }\AttributeTok{linetype =} \DecValTok{1}\NormalTok{, }\AttributeTok{linewidth =} \ConstantTok{NULL}\NormalTok{,}
           \AttributeTok{hjust =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{vjust =} \ConstantTok{NULL}\NormalTok{,}
           \AttributeTok{halign =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{valign =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{lineheight =} \ConstantTok{NULL}\NormalTok{,}
           \AttributeTok{margin =} \FunctionTok{match.fun}\NormalTok{(}\StringTok{"margin"}\NormalTok{)(}\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{),}
           \AttributeTok{padding =} \FunctionTok{match.fun}\NormalTok{(}\StringTok{"margin"}\NormalTok{)(}\DecValTok{2}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{),}
           \AttributeTok{width =}\NormalTok{ grid}\SpecialCharTok{::}\FunctionTok{unit}\NormalTok{(}\DecValTok{1}\NormalTok{, }\StringTok{"npc"}\NormalTok{),}
           \AttributeTok{height =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{minwidth =} \ConstantTok{NULL}\NormalTok{,}
           \AttributeTok{maxwidth =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{minheight =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{maxheight =} \ConstantTok{NULL}\NormalTok{,}
           \AttributeTok{r =}\NormalTok{ grid}\SpecialCharTok{::}\FunctionTok{unit}\NormalTok{(}\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{), }\AttributeTok{orientation =} \ConstantTok{NULL}\NormalTok{,}
           \AttributeTok{debug =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{inherit.blank =} \ConstantTok{FALSE}
\NormalTok{           )\{}
    \FunctionTok{structure}\NormalTok{(}\FunctionTok{as.list}\NormalTok{(}\FunctionTok{environment}\NormalTok{()),}
              \AttributeTok{class =} \FunctionTok{c}\NormalTok{(}\StringTok{"element\_textbox"}\NormalTok{, }\StringTok{"element\_text"}\NormalTok{, }\StringTok{"element"}\NormalTok{))}
\NormalTok{  \}}


\NormalTok{.get\_legend }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(p)\{}
\NormalTok{    p }\OtherTok{\textless{}{-}}\NormalTok{ ggplot2}\SpecialCharTok{:::}\FunctionTok{ggplot\_build.ggplot}\NormalTok{(p)}\SpecialCharTok{$}\NormalTok{plot}
\NormalTok{    theme }\OtherTok{\textless{}{-}}\NormalTok{ ggplot2}\SpecialCharTok{:::}\FunctionTok{plot\_theme}\NormalTok{(p)}
\NormalTok{    position }\OtherTok{\textless{}{-}}\NormalTok{ theme}\SpecialCharTok{$}\NormalTok{legend.position}
\NormalTok{    ggplot2}\SpecialCharTok{:::}\FunctionTok{build\_guides}\NormalTok{(p}\SpecialCharTok{$}\NormalTok{scales, p}\SpecialCharTok{$}\NormalTok{layers, p}\SpecialCharTok{$}\NormalTok{mapping,}
\NormalTok{                           position, theme, p}\SpecialCharTok{$}\NormalTok{guides, p}\SpecialCharTok{$}\NormalTok{labels)}
\NormalTok{  \}}

\NormalTok{.depigment\_col }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(col, }\AttributeTok{n =} \DecValTok{10}\NormalTok{, }\AttributeTok{level =} \DecValTok{5}\NormalTok{)\{}
    \FunctionTok{colorRampPalette}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"white"}\NormalTok{, col))(n)[level]}
\NormalTok{  \}}


\NormalTok{.simulate\_quant\_set }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(x)\{}
\NormalTok{    quant }\OtherTok{\textless{}{-}} \FunctionTok{.simulate\_quant}\NormalTok{(}\FunctionTok{features\_annotation}\NormalTok{(x)}\SpecialCharTok{$}\NormalTok{.features\_id)}
\NormalTok{    meta }\OtherTok{\textless{}{-}} \FunctionTok{group\_strings}\NormalTok{(}\FunctionTok{colnames}\NormalTok{(quant),}
                          \FunctionTok{c}\NormalTok{(}\AttributeTok{control =} \StringTok{"\^{}control"}\NormalTok{, }\AttributeTok{model =} \StringTok{"\^{}model"}\NormalTok{,}
                            \AttributeTok{treat =} \StringTok{"\^{}treat"}\NormalTok{, }\AttributeTok{pos =} \StringTok{"\^{}pos"}\NormalTok{), }\StringTok{"sample"}\NormalTok{)}
    \FunctionTok{features\_quantification}\NormalTok{(x) }\OtherTok{\textless{}{-}}\NormalTok{ quant}
    \FunctionTok{sample\_metadata}\NormalTok{(x) }\OtherTok{\textless{}{-}}\NormalTok{ meta}
    \FunctionTok{return}\NormalTok{(x)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @importFrom tibble as\_tibble}
\NormalTok{.simulate\_quant }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(.features\_id, }\AttributeTok{mean =} \DecValTok{50}\NormalTok{, }\AttributeTok{sd =} \DecValTok{20}\NormalTok{, }\AttributeTok{seed =} \DecValTok{555}\NormalTok{,}
           \AttributeTok{group =} \FunctionTok{c}\NormalTok{(}\StringTok{"control"}\NormalTok{, }\StringTok{"model"}\NormalTok{, }\StringTok{"treat"}\NormalTok{, }\StringTok{"pos"}\NormalTok{), }\AttributeTok{rep =} \DecValTok{5}\NormalTok{)\{}
\NormalTok{    quant }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{.features\_id =}\NormalTok{ .features\_id)}
    \FunctionTok{set.seed}\NormalTok{(seed)}
\NormalTok{    lst }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\NormalTok{(}\FunctionTok{length}\NormalTok{(group) }\SpecialCharTok{*}\NormalTok{ rep), }\ControlFlowTok{function}\NormalTok{(x)\{}
                    \FunctionTok{rnorm}\NormalTok{(}\FunctionTok{nrow}\NormalTok{(quant), mean, sd)}
\NormalTok{           \})}
\NormalTok{    df }\OtherTok{\textless{}{-}} \FunctionTok{apply}\NormalTok{(}\FunctionTok{do.call}\NormalTok{(data.frame, lst), }\DecValTok{2}\NormalTok{, abs)}
\NormalTok{    df }\OtherTok{\textless{}{-}}\NormalTok{ df[, }\FunctionTok{hclust}\NormalTok{(}\FunctionTok{dist}\NormalTok{(}\FunctionTok{t}\NormalTok{(df)))}\SpecialCharTok{$}\NormalTok{order]}
    \FunctionTok{colnames}\NormalTok{(df) }\OtherTok{\textless{}{-}} \FunctionTok{unlist}\NormalTok{(}\FunctionTok{lapply}\NormalTok{(group, paste0, }\StringTok{"\_"}\NormalTok{, }\DecValTok{1}\SpecialCharTok{:}\NormalTok{rep))}
\NormalTok{    tibble}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(}\FunctionTok{cbind}\NormalTok{(quant, df))}
\NormalTok{  \}}

\NormalTok{group\_strings }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(strings, patterns, }\AttributeTok{target =} \ConstantTok{NA}\NormalTok{)\{}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(}\FunctionTok{names}\NormalTok{(patterns)))}
      \FunctionTok{stop}\NormalTok{(}\StringTok{"\textasciigrave{}patterns\textasciigrave{} must be characters with names."}\NormalTok{)}
\NormalTok{    lst }\OtherTok{\textless{}{-}} \FunctionTok{.find\_and\_sort\_strings}\NormalTok{(strings, patterns)}
\NormalTok{    lst }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(lst), }\ControlFlowTok{function}\NormalTok{(name)\{}
                    \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{target =}\NormalTok{ lst[[name]], }\AttributeTok{group =}\NormalTok{ name)}
\NormalTok{           \})}
\NormalTok{    df }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(rbind, lst)}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(target)) \{}
      \FunctionTok{colnames}\NormalTok{(df)[}\DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}}\NormalTok{ target}
\NormalTok{    \}}
\NormalTok{    tibble}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(df)}
\NormalTok{  \}}

\NormalTok{.find\_and\_sort\_strings }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(strings, patterns)\{}
    \FunctionTok{lapply}\NormalTok{(patterns,}
           \ControlFlowTok{function}\NormalTok{(pattern)\{}
\NormalTok{             strings[}\FunctionTok{grepl}\NormalTok{(pattern, strings, }\AttributeTok{perl =}\NormalTok{ T)]}
\NormalTok{           \})}
\NormalTok{  \}}

\NormalTok{.as\_dic }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(vec, names, default,}
           \AttributeTok{fill =}\NormalTok{ T, }\AttributeTok{as.list =}\NormalTok{ T, }\AttributeTok{na.rm =}\NormalTok{ F)\{}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(}\FunctionTok{names}\NormalTok{(vec)))}
      \FunctionTok{names}\NormalTok{(vec) }\OtherTok{\textless{}{-}}\NormalTok{ names[}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(vec)]}
    \ControlFlowTok{if}\NormalTok{ (fill) \{}
      \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{any}\NormalTok{(}\SpecialCharTok{!}\NormalTok{names }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(vec))) \{}
\NormalTok{        ex.names }\OtherTok{\textless{}{-}}\NormalTok{ names[}\SpecialCharTok{!}\NormalTok{names }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(vec)]}
\NormalTok{        ex }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(default, }\FunctionTok{length}\NormalTok{(ex.names))}
        \FunctionTok{names}\NormalTok{(ex) }\OtherTok{\textless{}{-}}\NormalTok{ ex.names}
\NormalTok{        vec }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(vec, ex)}
\NormalTok{      \}}
\NormalTok{    \}}
    \ControlFlowTok{if}\NormalTok{ (as.list) \{}
      \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.list}\NormalTok{(vec))}
\NormalTok{        vec }\OtherTok{\textless{}{-}} \FunctionTok{as.list}\NormalTok{(vec)}
\NormalTok{    \}}
    \ControlFlowTok{if}\NormalTok{ (na.rm) \{}
\NormalTok{      vec }\OtherTok{\textless{}{-}}\NormalTok{ vec[}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(}\FunctionTok{names}\NormalTok{(vec))]}
\NormalTok{    \}}
\NormalTok{    vec}
\NormalTok{  \}}

\NormalTok{.fresh\_param }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(default, args)\{}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{missing}\NormalTok{(args))}
\NormalTok{      args }\OtherTok{\textless{}{-}} \FunctionTok{as.list}\NormalTok{(}\FunctionTok{parent.frame}\NormalTok{())}
\NormalTok{    args }\OtherTok{\textless{}{-}}\NormalTok{ args[ }\SpecialCharTok{!}\FunctionTok{vapply}\NormalTok{(args, is.name, T) ]}
    \FunctionTok{sapply}\NormalTok{(}\FunctionTok{unique}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\FunctionTok{names}\NormalTok{(default), }\FunctionTok{names}\NormalTok{(args))),}
           \AttributeTok{simplify =}\NormalTok{ F,}
           \ControlFlowTok{function}\NormalTok{(name)\{}
             \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{any}\NormalTok{(name }\SpecialCharTok{==} \FunctionTok{names}\NormalTok{(args)))}
\NormalTok{               args[[ name ]]}
             \ControlFlowTok{else}
\NormalTok{               default[[ name ]]}
\NormalTok{           \})}
\NormalTok{  \}}


\CommentTok{\#\textquotesingle{} @importFrom grImport2 readPicture}
\CommentTok{\#\textquotesingle{} @importFrom grImport2 grobify}
\NormalTok{.cairosvg\_to\_grob }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(path)\{}
\NormalTok{    grImport2}\SpecialCharTok{::}\FunctionTok{grobify}\NormalTok{(grImport2}\SpecialCharTok{::}\FunctionTok{readPicture}\NormalTok{(path))}
\NormalTok{  \}}

\NormalTok{checkColMerge }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, y, ...)\{}
\NormalTok{  args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(...)}
\NormalTok{  by }\OtherTok{\textless{}{-}}\NormalTok{ args}\SpecialCharTok{$}\NormalTok{by}
\NormalTok{  col }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{list}\NormalTok{(x, y),}
                \ControlFlowTok{function}\NormalTok{(df)\{}
                  \FunctionTok{colnames}\NormalTok{(df)[ }\SpecialCharTok{!}\FunctionTok{colnames}\NormalTok{(df) }\SpecialCharTok{\%in\%}\NormalTok{ by ]}
\NormalTok{                \})}
\NormalTok{  discard }\OtherTok{\textless{}{-}}\NormalTok{ col[[}\DecValTok{2}\NormalTok{]][col[[}\DecValTok{2}\NormalTok{]] }\SpecialCharTok{\%in\%}\NormalTok{ col[[}\DecValTok{1}\NormalTok{]]]}
\NormalTok{  y }\OtherTok{\textless{}{-}}\NormalTok{ y[, }\SpecialCharTok{!}\FunctionTok{colnames}\NormalTok{(y) }\SpecialCharTok{\%in\%}\NormalTok{ discard]}
  \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.data.frame}\NormalTok{(y))}
    \FunctionTok{return}\NormalTok{(x)}
\NormalTok{  args }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y), args)}
  \FunctionTok{do.call}\NormalTok{(merge, args)}
\NormalTok{\}}

\NormalTok{zoRange }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, factor) \{}
\NormalTok{  x }\OtherTok{\textless{}{-}} \FunctionTok{range}\NormalTok{(x)}
\NormalTok{  ex }\OtherTok{\textless{}{-}} \FunctionTok{abs}\NormalTok{(x[}\DecValTok{2}\NormalTok{] }\SpecialCharTok{{-}}\NormalTok{ x[}\DecValTok{1}\NormalTok{]) }\SpecialCharTok{*}\NormalTok{ (factor }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{)}
\NormalTok{  x[}\DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}}\NormalTok{ x[}\DecValTok{1}\NormalTok{] }\SpecialCharTok{{-}}\NormalTok{ ex}
\NormalTok{  x[}\DecValTok{2}\NormalTok{] }\OtherTok{\textless{}{-}}\NormalTok{ x[}\DecValTok{2}\NormalTok{] }\SpecialCharTok{+}\NormalTok{ ex}
  \FunctionTok{return}\NormalTok{(x)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-zzz.r}{%
\section{File: zzz.R}\label{file-zzz.r}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# default font for visualization}
\CommentTok{\# @importFrom grDevices pdfFonts}
\CommentTok{\# .setFont \textless{}{-} function(pattern)\{}
  \CommentTok{\# font \textless{}{-} names(pdfFonts())}
  \CommentTok{\# n \textless{}{-} grep(pattern, font)}
  \CommentTok{\# if (length(n) \textgreater{}= 1) \{}
  \CommentTok{\#   font \textless{}{-} font[n[1]]}
  \CommentTok{\# \} else \{}
  \CommentTok{\#   font[1]}
  \CommentTok{\# \}}
\CommentTok{\# \}}

\CommentTok{\# .font \textless{}{-} if (.Platform$OS.type == \textquotesingle{}unix\textquotesingle{}) "Times" else "Times New Roman"}

\CommentTok{\#\textquotesingle{} @export setFont}
\CommentTok{\#\textquotesingle{} @title Set font for visualization of MCnebula2}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}bold\{Note that\} your R harbours the font you set.}
\CommentTok{\#\textquotesingle{} @param font character(1). Such as \textquotesingle{}Times\textquotesingle{}. If you output the}
\CommentTok{\#\textquotesingle{} visualization for pdf, use \textbackslash{}code\{grDevices::pdfFonts()\} to checkout}
\CommentTok{\#\textquotesingle{} the available fonts; else, you might need help with package \textbackslash{}code\{extrafont\}.}
\CommentTok{\#\textquotesingle{} @rdname setFont}
\NormalTok{setFont }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(}\AttributeTok{font =} \StringTok{"Times"}\NormalTok{) \{}
  \FunctionTok{unlockBinding}\NormalTok{(}\StringTok{".font"}\NormalTok{, }\FunctionTok{topenv}\NormalTok{())}
  \FunctionTok{assign}\NormalTok{(}\StringTok{".font"}\NormalTok{, font, }\AttributeTok{env =} \FunctionTok{topenv}\NormalTok{())}
  \FunctionTok{options}\NormalTok{(}\AttributeTok{mcnebulaFont =}\NormalTok{ font)}
\NormalTok{\}}
\NormalTok{.font }\OtherTok{\textless{}{-}} \StringTok{"Times"}
\end{Highlighting}
\end{Shaded}


\end{document}
