% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\usepackage{caption} \captionsetup{font={footnotesize},width=6in} \renewcommand{\dblfloatpagefraction}{.9} \makeatletter \renewenvironment{figure} {\def\@captype{figure}} \makeatletter \definecolor{shadecolor}{RGB}{242,242,242} \usepackage{xeCJK} \usepackage{setspace} \setstretch{1.3}
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={R codes of exMCnebula2},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{R codes of exMCnebula2}
\author{}
\date{\vspace{-2.5em}}

\begin{document}
\maketitle

{
\setcounter{tocdepth}{3}
\tableofcontents
}
\hypertarget{file-aaa.r}{%
\section{File: aaa.R}\label{file-aaa.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# utilites}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\#\textquotesingle{} @aliases utilites}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title utilites for programming}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description This is a combination of tools that are not always used.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name utilites}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\NormalTok{reCallMethod }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(funName, args, ...)\{}
\NormalTok{    arg.order }\OtherTok{\textless{}{-}} \FunctionTok{unname}\NormalTok{(}\FunctionTok{getGeneric}\NormalTok{(funName)}\SpecialCharTok{@}\NormalTok{signature)}
\NormalTok{    args.missing }\OtherTok{\textless{}{-}} \SpecialCharTok{!}\NormalTok{arg.order }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(args)}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{any}\NormalTok{(args.missing)) \{}
\NormalTok{      args.missing }\OtherTok{\textless{}{-}}\NormalTok{ arg.order[args.missing]}
\NormalTok{      args.missing }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(args.missing, }\AttributeTok{simplify =}\NormalTok{ F,}
        \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{structure}\NormalTok{(0L, }\AttributeTok{class =} \StringTok{"missing"}\NormalTok{))}
\NormalTok{      args }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(args, args.missing)}
\NormalTok{    \}}
\NormalTok{    args }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(arg.order, }\ControlFlowTok{function}\NormalTok{(i) args[[i]])}
\NormalTok{    sig }\OtherTok{\textless{}{-}} \FunctionTok{get\_signature}\NormalTok{(args)}
\NormalTok{    method }\OtherTok{\textless{}{-}} \FunctionTok{selectMethod}\NormalTok{(funName, sig)}
\NormalTok{    last\_fun }\OtherTok{\textless{}{-}} \FunctionTok{sys.function}\NormalTok{(}\FunctionTok{sys.parent}\NormalTok{())}
\NormalTok{    n }\OtherTok{\textless{}{-}} \DecValTok{0}
    \ControlFlowTok{while}\NormalTok{ (}\FunctionTok{identical}\NormalTok{(last\_fun, method}\SpecialCharTok{@}\NormalTok{.Data, }\AttributeTok{ignore.environment =}\NormalTok{ T)) \{}
      \ControlFlowTok{if}\NormalTok{ (n }\SpecialCharTok{==} \DecValTok{0}\NormalTok{) \{}
\NormalTok{        mlist }\OtherTok{\textless{}{-}} \FunctionTok{getMethodsForDispatch}\NormalTok{(}\FunctionTok{getGeneric}\NormalTok{(funName))}
\NormalTok{      \}}
\NormalTok{      n }\OtherTok{\textless{}{-}}\NormalTok{ n }\SpecialCharTok{+} \DecValTok{1}
      \FunctionTok{rm}\NormalTok{(}\AttributeTok{list =} \FunctionTok{paste0}\NormalTok{(method}\SpecialCharTok{@}\NormalTok{defined, }\AttributeTok{collapse =} \StringTok{"\#"}\NormalTok{), }\AttributeTok{envir =}\NormalTok{ mlist)}
\NormalTok{      method }\OtherTok{\textless{}{-}} \FunctionTok{selectMethod}\NormalTok{(funName, sig, }\AttributeTok{mlist =}\NormalTok{ mlist)}
\NormalTok{    \}}
\NormalTok{    expr }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"method@.Data("}\NormalTok{,}
      \FunctionTok{paste0}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(arg.order, }\StringTok{" = args[["}\NormalTok{,}
          \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(arg.order), }\StringTok{"]]"}\NormalTok{),}
        \AttributeTok{collapse =} \StringTok{", "}\NormalTok{),}
      \StringTok{", ...)"}\NormalTok{)}
    \FunctionTok{eval}\NormalTok{(}\FunctionTok{parse}\NormalTok{(}\AttributeTok{text =}\NormalTok{ expr))}
\NormalTok{  \}}

\NormalTok{setMissing }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(generic, ..., }\AttributeTok{.SIG =} \StringTok{"missing"}\NormalTok{)\{}
\NormalTok{    args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(...)}
\NormalTok{    sig }\OtherTok{\textless{}{-}} \FunctionTok{getGeneric}\NormalTok{(generic)}\SpecialCharTok{@}\NormalTok{signature}
\NormalTok{    res }\OtherTok{\textless{}{-}} \FunctionTok{vapply}\NormalTok{(sig, }\AttributeTok{FUN.VALUE =} \StringTok{"character"}\NormalTok{,}
      \ControlFlowTok{function}\NormalTok{(name)\{}
        \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(args[[ name ]]))}
\NormalTok{          .SIG}
        \ControlFlowTok{else}
\NormalTok{          args[[ name ]]}
\NormalTok{      \})}
    \FunctionTok{names}\NormalTok{(res) }\OtherTok{\textless{}{-}}\NormalTok{ sig}
    \FunctionTok{return}\NormalTok{(res)}
\NormalTok{  \}}

\NormalTok{.fresh\_param }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(default, args)\{}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{missing}\NormalTok{(args))}
\NormalTok{      args }\OtherTok{\textless{}{-}} \FunctionTok{as.list}\NormalTok{(}\FunctionTok{parent.frame}\NormalTok{())}
\NormalTok{    args }\OtherTok{\textless{}{-}}\NormalTok{ args[ }\SpecialCharTok{!}\FunctionTok{vapply}\NormalTok{(args, is.name, T) ]}
    \FunctionTok{sapply}\NormalTok{(}\FunctionTok{unique}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\FunctionTok{names}\NormalTok{(default), }\FunctionTok{names}\NormalTok{(args))),}
      \AttributeTok{simplify =}\NormalTok{ F,}
      \ControlFlowTok{function}\NormalTok{(name)\{}
        \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{any}\NormalTok{(name }\SpecialCharTok{==} \FunctionTok{names}\NormalTok{(args)))}
\NormalTok{          args[[ name ]]}
        \ControlFlowTok{else}
\NormalTok{          default[[ name ]]}
\NormalTok{      \})}
\NormalTok{  \}}

\NormalTok{.fresh\_param2 }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(default, args)\{}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{missing}\NormalTok{(args))}
      \FunctionTok{return}\NormalTok{(default)}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(args) }\SpecialCharTok{==} \DecValTok{0}\NormalTok{)}
      \FunctionTok{return}\NormalTok{(default)}
    \FunctionTok{.fresh\_param}\NormalTok{(default, args)}
\NormalTok{  \}}

\NormalTok{.fresh\_param2f }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(default, args, }\AttributeTok{class =} \StringTok{"gpar"}\NormalTok{)\{}
    \FunctionTok{structure}\NormalTok{(}\FunctionTok{.fresh\_param2}\NormalTok{(default, args), }\AttributeTok{class =}\NormalTok{ class)}
\NormalTok{  \}}

\NormalTok{.check\_columns }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(obj, lst, tip)\{}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.data.frame}\NormalTok{(obj))}
      \FunctionTok{stop}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"\textquotesingle{}"}\NormalTok{, tip, }\StringTok{"\textquotesingle{} must be a \textquotesingle{}data.frame\textquotesingle{}."}\NormalTok{))}
    \FunctionTok{lapply}\NormalTok{(lst, }\ControlFlowTok{function}\NormalTok{(col)\{}
      \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(obj[[ col ]]))}
        \FunctionTok{stop}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"\textquotesingle{}"}\NormalTok{, tip, }\StringTok{"\textquotesingle{} must contains a column of \textquotesingle{}"}\NormalTok{, col, }\StringTok{"\textquotesingle{}."}\NormalTok{))}
\NormalTok{      \})}
\NormalTok{  \}}

\NormalTok{.message\_info\_viewport }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(}\AttributeTok{info =} \StringTok{"info"}\NormalTok{)\{}
    \FunctionTok{.message\_info}\NormalTok{(info, }\StringTok{"current.viewport:"}\NormalTok{,}
      \FunctionTok{paste0}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n\textbackslash{}t}\StringTok{"}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(grid}\SpecialCharTok{::}\FunctionTok{current.viewport}\NormalTok{())))}
\NormalTok{  \}}

\NormalTok{.message\_info }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(main, sub, }\AttributeTok{arg =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{sig =} \StringTok{"\#\#"}\NormalTok{)\{}
    \FunctionTok{message}\NormalTok{(sig, }\StringTok{" "}\NormalTok{, main, }\StringTok{": "}\NormalTok{, sub, }\StringTok{" "}\NormalTok{, arg)}
\NormalTok{  \}}

\NormalTok{.suggest\_bio\_package }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(pkg)\{}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{requireNamespace}\NormalTok{(pkg, }\AttributeTok{quietly =}\NormalTok{ T))}
      \FunctionTok{stop}\NormalTok{(}\StringTok{"package \textquotesingle{}"}\NormalTok{, pkg, }\StringTok{"\textquotesingle{} not installed. use folloing to install:}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{,}
        \StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}n}\StringTok{if (!require("BiocManager", quietly = TRUE))\textquotesingle{}}\NormalTok{,}
        \StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}n\textbackslash{}t}\StringTok{install.packages("BiocManager")\textquotesingle{}}\NormalTok{,}
        \StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}n}\StringTok{BiocManager::install("\textquotesingle{}}\NormalTok{, pkg, }\StringTok{\textquotesingle{}")}\SpecialCharTok{\textbackslash{}n\textbackslash{}n}\StringTok{\textquotesingle{}}\NormalTok{)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export tmp\_pdf}
\CommentTok{\#\textquotesingle{} @aliases tmp\_pdf}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{tmp\_pdf\}: ...}
\CommentTok{\#\textquotesingle{} @rdname utilites}
\NormalTok{tmp\_pdf }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{() \{}
  \FunctionTok{paste0}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"/tmp\_pdf.pdf"}\NormalTok{)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export op}
\CommentTok{\#\textquotesingle{} @aliases op}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{op\}: ...}
\CommentTok{\#\textquotesingle{} @rdname utilites}
\NormalTok{op }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(file) \{}
  \FunctionTok{system}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"xdg{-}open "}\NormalTok{, file))}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export .cairosvg\_to\_grob}
\CommentTok{\#\textquotesingle{} @aliases .cairosvg\_to\_grob}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{.cairosvg\_to\_grob\}: Convert cairo svg to \textquotesingle{}grob\textquotesingle{}.}
\CommentTok{\#\textquotesingle{} @rdname utilites}
\NormalTok{.cairosvg\_to\_grob }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(path)\{}
\NormalTok{    grImport2}\SpecialCharTok{::}\FunctionTok{grobify}\NormalTok{(grImport2}\SpecialCharTok{::}\FunctionTok{readPicture}\NormalTok{(path))}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export .as\_dic}
\CommentTok{\#\textquotesingle{} @aliases .as\_dic}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{.as\_dic\}: ...}
\CommentTok{\#\textquotesingle{} @rdname utilites}
\NormalTok{.as\_dic }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(vec, names, default,}
    \AttributeTok{fill =}\NormalTok{ T, }\AttributeTok{as.list =}\NormalTok{ T, }\AttributeTok{na.rm =}\NormalTok{ F)\{}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(}\FunctionTok{names}\NormalTok{(vec)))}
      \FunctionTok{names}\NormalTok{(vec) }\OtherTok{\textless{}{-}}\NormalTok{ names[}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(vec)]}
    \ControlFlowTok{if}\NormalTok{ (fill) \{}
      \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{any}\NormalTok{(}\SpecialCharTok{!}\NormalTok{names }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(vec))) \{}
\NormalTok{        ex.names }\OtherTok{\textless{}{-}}\NormalTok{ names[}\SpecialCharTok{!}\NormalTok{names }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(vec)]}
\NormalTok{        ex }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(default, }\FunctionTok{length}\NormalTok{(ex.names))}
        \FunctionTok{names}\NormalTok{(ex) }\OtherTok{\textless{}{-}}\NormalTok{ ex.names}
\NormalTok{        vec }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(vec, ex)}
\NormalTok{      \}}
\NormalTok{    \}}
    \ControlFlowTok{if}\NormalTok{ (as.list) \{}
      \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.list}\NormalTok{(vec))}
\NormalTok{        vec }\OtherTok{\textless{}{-}} \FunctionTok{as.list}\NormalTok{(vec)}
\NormalTok{    \}}
    \ControlFlowTok{if}\NormalTok{ (na.rm) \{}
\NormalTok{      vec }\OtherTok{\textless{}{-}}\NormalTok{ vec[}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(}\FunctionTok{names}\NormalTok{(vec))]}
\NormalTok{    \}}
\NormalTok{    vec}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export fill\_list}
\CommentTok{\#\textquotesingle{} @aliases fill\_list}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{fill\_list\}: ...}
\CommentTok{\#\textquotesingle{} @rdname utilites}
\NormalTok{fill\_list }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(names, vec, }\AttributeTok{default =}\NormalTok{ vec[}\DecValTok{1}\NormalTok{]) \{}
  \FunctionTok{.as\_dic}\NormalTok{(vec, names, default, }\AttributeTok{fill =}\NormalTok{ T, }\AttributeTok{as.list =}\NormalTok{ F, }\AttributeTok{na.rm =}\NormalTok{ F)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export n}
\CommentTok{\#\textquotesingle{} @aliases n}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{n\}: ...}
\CommentTok{\#\textquotesingle{} @rdname utilites}
\NormalTok{n }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(name, n)\{}
\NormalTok{  name }\OtherTok{\textless{}{-}} \FunctionTok{as.character}\NormalTok{(}\FunctionTok{substitute}\NormalTok{(name))}
  \FunctionTok{paste0}\NormalTok{(name, }\DecValTok{1}\SpecialCharTok{:}\NormalTok{n)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export namel}
\CommentTok{\#\textquotesingle{} @aliases namel}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{namel\}: ...}
\CommentTok{\#\textquotesingle{} @rdname utilites}
\NormalTok{namel }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(...)\{}
\NormalTok{  call }\OtherTok{\textless{}{-}} \FunctionTok{substitute}\NormalTok{(}\FunctionTok{list}\NormalTok{(...))}
\NormalTok{  lst }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(...)}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(}\FunctionTok{names}\NormalTok{(call))) \{}
\NormalTok{    names }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\DecValTok{2}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(call), }\ControlFlowTok{function}\NormalTok{(n) }\FunctionTok{as.character}\NormalTok{(call)[n])}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    names }\OtherTok{\textless{}{-}} \FunctionTok{vapply}\NormalTok{(}\DecValTok{2}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(call), }\AttributeTok{FUN.VALUE =} \FunctionTok{character}\NormalTok{(}\DecValTok{1}\NormalTok{),}
      \ControlFlowTok{function}\NormalTok{(n) \{}
        \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{names}\NormalTok{(call)[n] }\SpecialCharTok{==} \StringTok{""}\NormalTok{)}
          \FunctionTok{as.character}\NormalTok{(call)[n]}
        \ControlFlowTok{else}
          \FunctionTok{names}\NormalTok{(call)[n]}
\NormalTok{      \})}
\NormalTok{  \}}
  \FunctionTok{names}\NormalTok{(lst) }\OtherTok{\textless{}{-}}\NormalTok{ names}
\NormalTok{  lst}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export repSuffix}
\CommentTok{\#\textquotesingle{} @aliases repSuffix}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{repSuffix\}: ...}
\CommentTok{\#\textquotesingle{} @rdname utilites}
\NormalTok{repSuffix }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(chs, }\AttributeTok{anno =} \StringTok{".rep."}\NormalTok{)\{}
    \FunctionTok{gsub}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(anno, }\DecValTok{1}\NormalTok{, }\StringTok{"$"}\NormalTok{), }\StringTok{""}\NormalTok{,}
      \FunctionTok{vapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(chs), }\AttributeTok{FUN.VALUE =} \FunctionTok{character}\NormalTok{(}\DecValTok{1}\NormalTok{),}
        \ControlFlowTok{function}\NormalTok{(n)\{}
          \FunctionTok{paste0}\NormalTok{(chs[n], anno, }\FunctionTok{length}\NormalTok{(chs[}\DecValTok{1}\SpecialCharTok{:}\NormalTok{n][ chs[}\DecValTok{1}\SpecialCharTok{:}\NormalTok{n] }\SpecialCharTok{==}\NormalTok{ chs[n] ]))}
\NormalTok{        \}))}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export \%\textgreater{}\%}
\CommentTok{\#\textquotesingle{} @aliases \%\textgreater{}\%}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{\%\textgreater{}\%\}: ...}
\CommentTok{\#\textquotesingle{} @rdname utilites}
\StringTok{\textasciigrave{}}\AttributeTok{\%\textgreater{}\%}\StringTok{\textasciigrave{}} \OtherTok{\textless{}{-}}\NormalTok{ magrittr}\SpecialCharTok{::}\StringTok{\textasciigrave{}}\AttributeTok{\%\textgreater{}\%}\StringTok{\textasciigrave{}}

\CommentTok{\#\textquotesingle{} @export \%\textless{}\textgreater{}\%}
\CommentTok{\#\textquotesingle{} @aliases \%\textless{}\textgreater{}\%}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{\%\textless{}\textgreater{}\%\}: ...}
\CommentTok{\#\textquotesingle{} @rdname utilites}
\StringTok{\textasciigrave{}}\AttributeTok{\%\textless{}\textgreater{}\%}\StringTok{\textasciigrave{}} \OtherTok{\textless{}{-}}\NormalTok{ magrittr}\SpecialCharTok{::}\StringTok{\textasciigrave{}}\AttributeTok{\%\textless{}\textgreater{}\%}\StringTok{\textasciigrave{}}

\CommentTok{\#\textquotesingle{} @export .expath}
\CommentTok{\#\textquotesingle{} @aliases .expath}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{.expath\}: ...}
\CommentTok{\#\textquotesingle{} @rdname utilites}
\NormalTok{.expath }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{() \{}
\NormalTok{  .expath }\OtherTok{\textless{}{-}} \FunctionTok{system.file}\NormalTok{(}\StringTok{"extdata"}\NormalTok{, }\StringTok{"."}\NormalTok{, }\AttributeTok{package =} \FunctionTok{gsub}\NormalTok{(}\StringTok{"\^{}.*:"}\NormalTok{, }\StringTok{""}\NormalTok{, }\FunctionTok{environmentName}\NormalTok{(}\FunctionTok{topenv}\NormalTok{())))}
  \FunctionTok{assign}\NormalTok{(}\StringTok{\textquotesingle{}.expath\textquotesingle{}}\NormalTok{, .expath, }\AttributeTok{envir =} \FunctionTok{topenv}\NormalTok{())}
\NormalTok{\}}

\NormalTok{.onLoad }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(libname, pkgname) \{}
  \FunctionTok{.expath}\NormalTok{()}
  \FunctionTok{.expathsvg}\NormalTok{()}
  \FunctionTok{.check\_external\_svg}\NormalTok{()}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export agroup}
\CommentTok{\#\textquotesingle{} @aliases agroup}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{agroup\}: ...}
\CommentTok{\#\textquotesingle{} @rdname utilites}
\NormalTok{agroup }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(group, value, }\AttributeTok{FUN.VALUE =} \FunctionTok{character}\NormalTok{(}\DecValTok{1}\NormalTok{)) \{}
\NormalTok{  ug }\OtherTok{\textless{}{-}} \FunctionTok{unique}\NormalTok{(group)}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(ug) }\SpecialCharTok{\textgreater{}} \FunctionTok{length}\NormalTok{(value))}
    \FunctionTok{stop}\NormalTok{( }\StringTok{"the length of \textquotesingle{}value\textquotesingle{} not enough to assign"}\NormalTok{ )}
\NormalTok{  dic }\OtherTok{\textless{}{-}} \FunctionTok{.as\_dic}\NormalTok{(value, ug, }\AttributeTok{fill =}\NormalTok{ F, }\AttributeTok{na.rm =}\NormalTok{ F)}
  \FunctionTok{vapply}\NormalTok{(group, }\ControlFlowTok{function}\NormalTok{(g) dic[[g]], FUN.VALUE)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export write\_tsv}
\CommentTok{\#\textquotesingle{} @aliases write\_tsv}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{write\_tsv\}: ...}
\CommentTok{\#\textquotesingle{} @rdname utilites}
\NormalTok{write\_tsv }\OtherTok{\textless{}{-}}
  \ControlFlowTok{function}\NormalTok{(x, filename, }\AttributeTok{col.names =}\NormalTok{ T, }\AttributeTok{row.names =}\NormalTok{ F)\{}
    \FunctionTok{write.table}\NormalTok{(x, }\AttributeTok{file =}\NormalTok{ filename, }\AttributeTok{sep =} \StringTok{"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}\NormalTok{,}
      \AttributeTok{col.names =}\NormalTok{ col.names, }\AttributeTok{row.names =}\NormalTok{ row.names, }\AttributeTok{quote =}\NormalTok{ F)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export read\_tsv}
\CommentTok{\#\textquotesingle{} @aliases read\_tsv}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{read\_tsv\}: ...}
\CommentTok{\#\textquotesingle{} @rdname utilites}
\NormalTok{read\_tsv }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(path)\{}
\NormalTok{  file }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{fread}\NormalTok{(}\AttributeTok{input =}\NormalTok{ path, }\AttributeTok{sep =} \StringTok{"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}\NormalTok{,}
    \AttributeTok{header =}\NormalTok{ T, }\AttributeTok{quote =} \StringTok{""}\NormalTok{, }\AttributeTok{check.names =}\NormalTok{ F)}
  \FunctionTok{return}\NormalTok{(file)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export mapply\_rename\_col}
\CommentTok{\#\textquotesingle{} @aliases mapply\_rename\_col}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{mapply\_rename\_col\}: ...}
\CommentTok{\#\textquotesingle{} @rdname utilites}
\NormalTok{mapply\_rename\_col }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(}
\NormalTok{    mutate\_set,}
\NormalTok{    replace\_set,}
\NormalTok{    names,}
    \AttributeTok{fixed =}\NormalTok{ F}
\NormalTok{    )\{}
\NormalTok{    envir }\OtherTok{\textless{}{-}} \FunctionTok{environment}\NormalTok{()}
    \FunctionTok{mapply}\NormalTok{(mutate\_set, replace\_set,}
      \AttributeTok{MoreArgs =} \FunctionTok{list}\NormalTok{(}\AttributeTok{envir =}\NormalTok{ envir, }\AttributeTok{fixed =}\NormalTok{ fixed),}
      \AttributeTok{FUN =} \ControlFlowTok{function}\NormalTok{(mutate, replace, envir,}
        \AttributeTok{fixed =}\NormalTok{ F, }\AttributeTok{names =} \FunctionTok{get}\NormalTok{(}\StringTok{"names"}\NormalTok{, }\AttributeTok{envir =}\NormalTok{ envir))\{}
\NormalTok{        names }\OtherTok{\textless{}{-}} \FunctionTok{gsub}\NormalTok{(mutate, replace, names, }\AttributeTok{perl =} \FunctionTok{ifelse}\NormalTok{(fixed, F, T), }\AttributeTok{fixed =}\NormalTok{ fixed)}
        \FunctionTok{assign}\NormalTok{(}\StringTok{"names"}\NormalTok{, names, }\AttributeTok{envir =}\NormalTok{ envir)}
\NormalTok{      \})}
    \FunctionTok{return}\NormalTok{(names)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export turn\_vector}
\CommentTok{\#\textquotesingle{} @aliases turn\_vector}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{turn\_vector\}: ...}
\CommentTok{\#\textquotesingle{} @rdname utilites}
\NormalTok{turn\_vector }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(vec) \{}
\NormalTok{  names }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(vec)}
  \FunctionTok{names}\NormalTok{(vec) }\OtherTok{\textless{}{-}} \FunctionTok{unname}\NormalTok{(vec)}
\NormalTok{  vec[] }\OtherTok{\textless{}{-}}\NormalTok{ names}
\NormalTok{  vec}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export group\_switch}
\CommentTok{\#\textquotesingle{} @aliases group\_switch}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{group\_switch\}: ...}
\CommentTok{\#\textquotesingle{} @rdname utilites}
\NormalTok{group\_switch }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(data, meta.lst, by) \{}
  \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.character}\NormalTok{(data[[ by ]]))}
    \FunctionTok{stop}\NormalTok{( }\StringTok{"is.character(data[[ by ]]) == F"}\NormalTok{ )}
\NormalTok{  meta }\OtherTok{\textless{}{-}} \FunctionTok{unlist}\NormalTok{(meta.lst)}
  \FunctionTok{names}\NormalTok{(meta) }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\FunctionTok{names}\NormalTok{(meta.lst), }\FunctionTok{lengths}\NormalTok{(meta.lst))}
\NormalTok{  meta }\OtherTok{\textless{}{-}} \FunctionTok{as.list}\NormalTok{(}\FunctionTok{turn\_vector}\NormalTok{(meta))}
\NormalTok{  data }\OtherTok{\textless{}{-}}\NormalTok{ data[data[[by]] }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(meta), ]}
\NormalTok{  group }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{order =} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(data[[ by ]]), }\AttributeTok{col =}\NormalTok{ data[[ by ]])}
\NormalTok{  group }\OtherTok{\textless{}{-}} \FunctionTok{split}\NormalTok{(group, }\SpecialCharTok{\textasciitilde{}}\NormalTok{ col)}
\NormalTok{  group }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(group),}
    \ControlFlowTok{function}\NormalTok{(name)\{}
\NormalTok{      data }\OtherTok{\textless{}{-}}\NormalTok{ group[[ name ]]}
\NormalTok{      data}\SpecialCharTok{$}\NormalTok{col }\OtherTok{\textless{}{-}}\NormalTok{ meta[[ name ]]}
      \FunctionTok{return}\NormalTok{(data)}
\NormalTok{    \})}
\NormalTok{  group }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(group)}
\NormalTok{  group }\OtherTok{\textless{}{-}}\NormalTok{ group[}\FunctionTok{order}\NormalTok{(group}\SpecialCharTok{$}\NormalTok{order), ]}\SpecialCharTok{$}\NormalTok{col}
  \FunctionTok{split}\NormalTok{(data, group)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export .find\_and\_sort\_strings}
\CommentTok{\#\textquotesingle{} @aliases .find\_and\_sort\_strings}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{.find\_and\_sort\_strings\}: ...}
\CommentTok{\#\textquotesingle{} @rdname utilites}
\NormalTok{.find\_and\_sort\_strings }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(strings, patterns)\{}
    \FunctionTok{lapply}\NormalTok{(patterns,}
      \ControlFlowTok{function}\NormalTok{(pattern)\{}
\NormalTok{        strings[}\FunctionTok{grepl}\NormalTok{(pattern, strings, }\AttributeTok{perl =}\NormalTok{ T)]}
\NormalTok{      \})}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export maps}
\CommentTok{\#\textquotesingle{} @aliases maps}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{maps\}: ...}
\CommentTok{\#\textquotesingle{} @rdname utilites}
\NormalTok{maps }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(data, value, from, to) \{}
  \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.list}\NormalTok{(value))}
\NormalTok{    value }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(value)}
  \FunctionTok{lapply}\NormalTok{(value,}
    \ControlFlowTok{function}\NormalTok{(value) \{}
\NormalTok{      data }\OtherTok{\textless{}{-}}\NormalTok{ data[data[[from]] }\SpecialCharTok{\%in\%}\NormalTok{ value, ]}
\NormalTok{      vec }\OtherTok{\textless{}{-}}\NormalTok{ data[[ to ]]}
      \FunctionTok{names}\NormalTok{(vec) }\OtherTok{\textless{}{-}}\NormalTok{ data[[ from ]]}
\NormalTok{      vec}
\NormalTok{    \})}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export order\_list}
\CommentTok{\#\textquotesingle{} @aliases order\_list}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{order\_list\}: ...}
\CommentTok{\#\textquotesingle{} @rdname utilites}
\NormalTok{order\_list }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(}
\NormalTok{    list}
\NormalTok{    )\{}
\NormalTok{    lt }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
    \FunctionTok{length}\NormalTok{(lt) }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(list)}
    \FunctionTok{names}\NormalTok{(lt) }\OtherTok{\textless{}{-}} \FunctionTok{sort}\NormalTok{(}\FunctionTok{names}\NormalTok{(list))}
    \ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \FunctionTok{names}\NormalTok{(lt))\{}
\NormalTok{      lt[[i]] }\OtherTok{\textless{}{-}}\NormalTok{ list[[i]]}
\NormalTok{    \}}
    \FunctionTok{return}\NormalTok{(lt)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export molconvert\_structure}
\CommentTok{\#\textquotesingle{} @aliases molconvert\_structure}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{molconvert\_structure\}: ...}
\CommentTok{\#\textquotesingle{} @rdname utilites}
\DocumentationTok{\#\# use \textquotesingle{}molconvert\textquotesingle{} ...}
\DocumentationTok{\#\# https://chemaxon.com/marvin}
\NormalTok{molconvert\_structure }\OtherTok{\textless{}{-}}
  \ControlFlowTok{function}\NormalTok{(smile, path)\{}
    \FunctionTok{system}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"molconvert mol }\SpecialCharTok{\textbackslash{}"}\StringTok{"}\NormalTok{, smile, }\StringTok{"}\SpecialCharTok{\textbackslash{}"}\StringTok{ {-}o "}\NormalTok{, path))}
\NormalTok{    src }\OtherTok{\textless{}{-}} \FunctionTok{paste}\NormalTok{(}\FunctionTok{readLines}\NormalTok{(path), }\AttributeTok{collapse =} \StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{    ChemmineOB}\SpecialCharTok{::}\FunctionTok{convertToImage}\NormalTok{(}\StringTok{"MOL"}\NormalTok{, }\StringTok{"SVG"}\NormalTok{, }\AttributeTok{source =}\NormalTok{ src, }\AttributeTok{toFile =}\NormalTok{ path)}
\NormalTok{    rsvg}\SpecialCharTok{::}\FunctionTok{rsvg\_svg}\NormalTok{(path, path)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export obj.size}
\CommentTok{\#\textquotesingle{} @aliases obj.size}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{obj.size\}: ...}
\CommentTok{\#\textquotesingle{} @rdname utilites}
\NormalTok{obj.size }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, ...) \{}
  \FunctionTok{format}\NormalTok{(}\FunctionTok{object.size}\NormalTok{(x), }\AttributeTok{units =} \StringTok{"MB"}\NormalTok{, ...)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-alignment_merge.r}{%
\section{File: alignment\_merge.R}\label{file-alignment_merge.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# Merge data tables based on continuous variables.}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\#\textquotesingle{} @aliases align\_merge}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Alignment merge of \textquotesingle{}features\textquotesingle{} via m/z and RT}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description Merge two data.frame of \textquotesingle{}features\textquotesingle{} according to m/z and RT.}
\CommentTok{\#\textquotesingle{} The formula is the same in MZmine2:}
\CommentTok{\#\textquotesingle{} Score = (1 {-} rt.difference / rt.tolerance) * rt.weight +}
\CommentTok{\#\textquotesingle{} (1 {-} mz.defference / mz.tolerance) * mz.weight}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name align\_merge}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @export align\_merge}
\CommentTok{\#\textquotesingle{} @aliases align\_merge}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{align\_merge\}: ...}
\CommentTok{\#\textquotesingle{} @rdname align\_merge}
\NormalTok{align\_merge }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(main, sub, }\AttributeTok{id =} \StringTok{".features\_id"}\NormalTok{,}
    \AttributeTok{mz.main =} \StringTok{"mz"}\NormalTok{, }\AttributeTok{mz.sub =} \StringTok{"mz"}\NormalTok{,}
    \AttributeTok{rt.main =} \StringTok{"rt.min"}\NormalTok{, }\AttributeTok{rt.sub =} \StringTok{"rt.min"}\NormalTok{,}
    \AttributeTok{mz.tol =}\NormalTok{ .}\DecValTok{05}\NormalTok{, }\AttributeTok{rt.tol =}\NormalTok{ .}\DecValTok{3}\NormalTok{, }\AttributeTok{mz.weight =} \DecValTok{75}\NormalTok{, }\AttributeTok{rt.weight =} \DecValTok{25}\NormalTok{,}
    \AttributeTok{unique =}\NormalTok{ T}
\NormalTok{    ) \{}
\NormalTok{    lst }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{main =}\NormalTok{ main, }\AttributeTok{sub =}\NormalTok{ sub)}
\NormalTok{    check\_col }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(col.x, col.y, lst) \{}
      \ControlFlowTok{if}\NormalTok{ (col.x }\SpecialCharTok{==}\NormalTok{ col.y) \{}
\NormalTok{        lst }\OtherTok{\textless{}\textless{}{-}} \FunctionTok{coln\_suffix}\NormalTok{(lst, col.x)}
\NormalTok{        cols }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(col.x, }\FunctionTok{c}\NormalTok{(}\StringTok{".main"}\NormalTok{, }\StringTok{".sub"}\NormalTok{))}
\NormalTok{      \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{        cols }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(col.x, col.y)}
\NormalTok{      \}}
      \FunctionTok{return}\NormalTok{(cols)}
\NormalTok{    \}}
\NormalTok{    mz.cols }\OtherTok{\textless{}{-}} \FunctionTok{check\_col}\NormalTok{(mz.main, mz.sub, lst)}
\NormalTok{    rt.cols }\OtherTok{\textless{}{-}} \FunctionTok{check\_col}\NormalTok{(rt.main, rt.sub, lst)}
\NormalTok{    data }\OtherTok{\textless{}{-}} \FunctionTok{tol\_merge}\NormalTok{(lst[[}\DecValTok{1}\NormalTok{]], lst[[}\DecValTok{2}\NormalTok{]], }\AttributeTok{main\_col =}\NormalTok{ mz.cols[}\DecValTok{1}\NormalTok{],}
      \AttributeTok{sub\_col =}\NormalTok{ mz.cols[}\DecValTok{2}\NormalTok{], }\AttributeTok{tol =}\NormalTok{ mz.tol)}
\NormalTok{    data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(data, }\AttributeTok{.rt\_diff =} \FunctionTok{abs}\NormalTok{(.data[[rt.cols[}\DecValTok{1}\NormalTok{]]] }\SpecialCharTok{{-}}\NormalTok{ .data[[rt.cols[}\DecValTok{2}\NormalTok{]]]),}
      \AttributeTok{.mz\_diff =} \FunctionTok{abs}\NormalTok{(.data[[mz.cols[}\DecValTok{1}\NormalTok{]]] }\SpecialCharTok{{-}}\NormalTok{ .data[[mz.cols[}\DecValTok{2}\NormalTok{]]]))}
\NormalTok{    data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(data, .rt\_diff }\SpecialCharTok{\textless{}} \SpecialCharTok{!!}\NormalTok{rt.tol)}
\NormalTok{    data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(data, }\AttributeTok{.score =}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ .rt\_diff }\SpecialCharTok{/} \SpecialCharTok{!!}\NormalTok{rt.tol) }\SpecialCharTok{*}\NormalTok{ rt.weight }\SpecialCharTok{+}
\NormalTok{      (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ .mz\_diff }\SpecialCharTok{/} \SpecialCharTok{!!}\NormalTok{mz.tol) }\SpecialCharTok{*}\NormalTok{ mz.weight)}
\NormalTok{    data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{arrange}\NormalTok{(data, .data[[id]], dplyr}\SpecialCharTok{::}\FunctionTok{desc}\NormalTok{(.score))}
    \ControlFlowTok{if}\NormalTok{ (unique)}
\NormalTok{      data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{distinct}\NormalTok{(data, .data[[id]], }\AttributeTok{.keep\_all =}\NormalTok{ T)}
\NormalTok{    data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(data, }\SpecialCharTok{{-}}\NormalTok{.rt\_diff, }\SpecialCharTok{{-}}\NormalTok{.mz\_diff, }\SpecialCharTok{{-}}\NormalTok{.score)}
\NormalTok{    tibble}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(data)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export tol\_merge}
\CommentTok{\#\textquotesingle{} @aliases tol\_merge}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{tol\_merge\}: ...}
\CommentTok{\#\textquotesingle{} @rdname align\_merge}
\NormalTok{tol\_merge }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(main,}
\NormalTok{    sub,}
    \AttributeTok{main\_col =} \StringTok{"mz"}\NormalTok{,}
    \AttributeTok{sub\_col =} \StringTok{"mz"}\NormalTok{,}
    \AttributeTok{tol =} \FloatTok{0.002}\NormalTok{,}
    \AttributeTok{bin\_size =} \DecValTok{1}
\NormalTok{    )\{}
    \ControlFlowTok{if}\NormalTok{ (main\_col }\SpecialCharTok{==}\NormalTok{ sub\_col) \{}
\NormalTok{      new\_name }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(sub\_col, }\StringTok{".sub"}\NormalTok{)}
      \FunctionTok{colnames}\NormalTok{(sub)[}\FunctionTok{colnames}\NormalTok{(sub) }\SpecialCharTok{==}\NormalTok{ sub\_col] }\OtherTok{\textless{}{-}}\NormalTok{ new\_name}
\NormalTok{      sub\_col }\OtherTok{\textless{}{-}}\NormalTok{ new\_name}
\NormalTok{    \}}
\NormalTok{    main}\SpecialCharTok{$}\NormalTok{...seq }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(main)}
\NormalTok{    backup }\OtherTok{\textless{}{-}}\NormalTok{ main}
    \DocumentationTok{\#\# to reduce computation, round numeric for limitation}
    \DocumentationTok{\#\# main}
\NormalTok{    main}\SpecialCharTok{$}\NormalTok{...id }\OtherTok{\textless{}{-}} \FunctionTok{round}\NormalTok{(main[[ main\_col ]], bin\_size)}
    \DocumentationTok{\#\# sub}
\NormalTok{    sub.x }\OtherTok{\textless{}{-}}\NormalTok{ sub.y }\OtherTok{\textless{}{-}}\NormalTok{ sub}
\NormalTok{    sub.x}\SpecialCharTok{$}\NormalTok{...id }\OtherTok{\textless{}{-}} \FunctionTok{round}\NormalTok{(sub.x[[ sub\_col ]], bin\_size)}
\NormalTok{    sub.y}\SpecialCharTok{$}\NormalTok{...id }\OtherTok{\textless{}{-}}\NormalTok{ sub.x}\SpecialCharTok{$}\NormalTok{...id }\SpecialCharTok{+}\NormalTok{ ( }\DecValTok{1} \SpecialCharTok{*} \DecValTok{10}\SpecialCharTok{\^{}{-}}\NormalTok{bin\_size )}
\NormalTok{    sub }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(sub.x, sub.y)}
    \DocumentationTok{\#\# expand merge}
\NormalTok{    df }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(main, sub, }\AttributeTok{by =} \StringTok{"...id"}\NormalTok{, }\AttributeTok{all.x =}\NormalTok{ T, }\AttributeTok{allow.cartesian =}\NormalTok{ T)}
\NormalTok{    df}\SpecialCharTok{$}\NormalTok{...diff }\OtherTok{\textless{}{-}} \FunctionTok{abs}\NormalTok{(df[[ main\_col ]] }\SpecialCharTok{{-}}\NormalTok{ df[[ sub\_col ]])}
\NormalTok{    df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(df, ...diff }\SpecialCharTok{\textless{}=} \SpecialCharTok{!!}\NormalTok{tol)}
    \DocumentationTok{\#\# get the non{-}merged}
\NormalTok{    backup }\OtherTok{\textless{}{-}}\NormalTok{ backup[}\SpecialCharTok{!}\NormalTok{backup}\SpecialCharTok{$}\NormalTok{...seq }\SpecialCharTok{\%in\%}\NormalTok{ df}\SpecialCharTok{$}\NormalTok{...seq, ]}
\NormalTok{    df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{bind\_rows}\NormalTok{(df, backup)}
    \DocumentationTok{\#\# remove the assist col}
\NormalTok{    dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(df, }\SpecialCharTok{{-}}\NormalTok{...id, }\SpecialCharTok{{-}}\NormalTok{...diff, }\SpecialCharTok{{-}}\NormalTok{...seq)}
\NormalTok{  \}}

\StringTok{\textasciigrave{}}\AttributeTok{:=}\StringTok{\textasciigrave{}} \OtherTok{\textless{}{-}}\NormalTok{ rlang}\SpecialCharTok{::}\StringTok{\textasciigrave{}}\AttributeTok{:=}\StringTok{\textasciigrave{}}

\NormalTok{coln\_suffix }\OtherTok{\textless{}{-}}
  \ControlFlowTok{function}\NormalTok{(lst, col,}
    \AttributeTok{suffix =} \FunctionTok{c}\NormalTok{(}\StringTok{".main"}\NormalTok{, }\StringTok{".sub"}\NormalTok{,}
      \FunctionTok{ifelse}\NormalTok{(}\FunctionTok{length}\NormalTok{(lst) }\SpecialCharTok{\textless{}=} \DecValTok{2}\NormalTok{, }\FunctionTok{character}\NormalTok{(}\DecValTok{0}\NormalTok{),}
        \FunctionTok{paste0}\NormalTok{(}\StringTok{".other"}\NormalTok{, }\DecValTok{1}\SpecialCharTok{:}\NormalTok{(}\FunctionTok{length}\NormalTok{(lst) }\SpecialCharTok{{-}} \DecValTok{2}\NormalTok{))))}
\NormalTok{    ) \{}
    \FunctionTok{lapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(lst),}
      \ControlFlowTok{function}\NormalTok{(n) \{}
\NormalTok{        dplyr}\SpecialCharTok{::}\FunctionTok{rename}\NormalTok{(lst[[n]], }\SpecialCharTok{!!}\FunctionTok{paste0}\NormalTok{(col, suffix[n]) }\SpecialCharTok{:}\ErrorTok{=}\NormalTok{ col)}
\NormalTok{      \})}
\NormalTok{  \}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-cross_select.r}{%
\section{File: cross\_select.R}\label{file-cross_select.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# filter data according to colunm within another data.frame}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\#\textquotesingle{} @aliases select\_features}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Select \textquotesingle{}features\textquotesingle{} for MCnebula2}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description Select significant \textquotesingle{}features\textquotesingle{} from MCnebula2 with}
\CommentTok{\#\textquotesingle{} statistic results for downstream analysis of metabolomics.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name select\_features}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @export select\_features}
\CommentTok{\#\textquotesingle{} @aliases select\_features}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{select\_features\}: ...}
\CommentTok{\#\textquotesingle{} @rdname select\_features}
\NormalTok{select\_features }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(}
\NormalTok{  mcn, }\AttributeTok{classes =} \FunctionTok{unique}\NormalTok{(}\FunctionTok{nebula\_index}\NormalTok{(mcn)}\SpecialCharTok{$}\NormalTok{class.name),}
  \AttributeTok{q.value =}\NormalTok{ .}\DecValTok{05}\NormalTok{, }\AttributeTok{logfc =}\NormalTok{ .}\DecValTok{3}\NormalTok{, }\AttributeTok{coef =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{tani.score\_cutoff =} \ConstantTok{NULL}\NormalTok{,}
  \AttributeTok{order\_by\_coef =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{togather =}\NormalTok{ F) }
\NormalTok{\{}
  \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{requireNamespace}\NormalTok{(}\StringTok{"MCnebula2"}\NormalTok{, }\AttributeTok{quietly =}\NormalTok{ T))}
    \FunctionTok{stop}\NormalTok{(}\StringTok{"package \textquotesingle{}MCnebula2\textquotesingle{} must be available."}\NormalTok{)}
  \FunctionTok{.check\_data}\NormalTok{(}\FunctionTok{statistic\_set}\NormalTok{(mcn), }\FunctionTok{list}\NormalTok{(}\AttributeTok{top\_table =} \StringTok{"binary\_comparison"}\NormalTok{))}
  \FunctionTok{.check\_data}\NormalTok{(mcn, }\FunctionTok{list}\NormalTok{(}\AttributeTok{nebula\_index =} \StringTok{"create\_nebula\_index"}\NormalTok{,}
      \AttributeTok{features\_annotation =} \StringTok{"create\_features\_annotation"}\NormalTok{))}
\NormalTok{  stat }\OtherTok{\textless{}{-}} \FunctionTok{top\_table}\NormalTok{(}\FunctionTok{statistic\_set}\NormalTok{(mcn))}
  \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(coef)) \{}
\NormalTok{    stat }\OtherTok{\textless{}{-}}\NormalTok{ stat[coef]}
\NormalTok{  \}}
\NormalTok{  stat }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(stat))}
\NormalTok{  data.lst }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\FunctionTok{nebula\_index}\NormalTok{(mcn), stat)}
\NormalTok{  filter.lst }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}
\NormalTok{    rlang}\SpecialCharTok{::}\FunctionTok{quos}\NormalTok{(class.name }\SpecialCharTok{\%in\%}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{all\_of}\NormalTok{(classes)),}
\NormalTok{    rlang}\SpecialCharTok{::}\FunctionTok{quos}\NormalTok{(adj.P.Val }\SpecialCharTok{\textless{}}\NormalTok{ q.value, }\FunctionTok{abs}\NormalTok{(logFC) }\SpecialCharTok{\textgreater{}}\NormalTok{ logfc)}
\NormalTok{  )}
  \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(tani.score\_cutoff)) \{}
\NormalTok{    data.lst[[}\DecValTok{3}\NormalTok{]] }\OtherTok{\textless{}{-}} \FunctionTok{features\_annotation}\NormalTok{(mcn)}
\NormalTok{    filter.lst[[}\DecValTok{3}\NormalTok{]] }\OtherTok{\textless{}{-}}\NormalTok{ rlang}\SpecialCharTok{::}\FunctionTok{quos}\NormalTok{(tani.score }\SpecialCharTok{\textgreater{}=}\NormalTok{ tani.score\_cutoff)}
\NormalTok{  \}}
\NormalTok{  res }\OtherTok{\textless{}{-}} \FunctionTok{cross\_select}\NormalTok{(data.lst, filter.lst, }\StringTok{".features\_id"}\NormalTok{, }\StringTok{"class.name"}\NormalTok{)}
  \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(order\_by\_coef)) \{}
\NormalTok{    ranks }\OtherTok{\textless{}{-}} \FunctionTok{top\_table}\NormalTok{(}\FunctionTok{statistic\_set}\NormalTok{(mcn))[[ order\_by\_coef ]]}\SpecialCharTok{$}\NormalTok{.features\_id}
\NormalTok{    res }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(res,}
      \ControlFlowTok{function}\NormalTok{(ids) \{}
\NormalTok{        ranks[ ranks }\SpecialCharTok{\%in\%}\NormalTok{ ids ]}
\NormalTok{      \})}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{ (togather) \{}
\NormalTok{    res }\OtherTok{\textless{}{-}} \FunctionTok{unlist}\NormalTok{(res, }\AttributeTok{use.names =}\NormalTok{ F)}
\NormalTok{    res }\OtherTok{\textless{}{-}}\NormalTok{ ranks[ ranks }\SpecialCharTok{\%in\%}\NormalTok{ res ]}
\NormalTok{  \}}
  \FunctionTok{return}\NormalTok{(res)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export cross\_select}
\CommentTok{\#\textquotesingle{} @aliases cross\_select}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{cross\_select\}: ...}
\CommentTok{\#\textquotesingle{} @rdname select\_features}
\NormalTok{cross\_select }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(data.lst, filter.lst, target, }\AttributeTok{split =} \ConstantTok{NULL}\NormalTok{) \{}
  \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.list}\NormalTok{(data.lst) }\SpecialCharTok{|} \SpecialCharTok{!}\FunctionTok{is.list}\NormalTok{(filter.lst))}
    \FunctionTok{stop}\NormalTok{(}\StringTok{"\textasciigrave{}data.lst\textasciigrave{} and \textasciigrave{}filter.lst\textasciigrave{} must be \textquotesingle{}list\textquotesingle{}."}\NormalTok{)}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(data.lst) }\SpecialCharTok{!=} \FunctionTok{length}\NormalTok{(filter.lst))}
    \FunctionTok{stop}\NormalTok{(}\StringTok{"\textasciigrave{}data.lst\textasciigrave{} and \textasciigrave{}filter.lst\textasciigrave{} must be \textquotesingle{}list\textquotesingle{} with the same length."}\NormalTok{)}
\NormalTok{  lst }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(data.lst),}
    \ControlFlowTok{function}\NormalTok{(n) \{}
      \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(filter.lst[[n]]))}
\NormalTok{        dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(data.lst[[n]], }\SpecialCharTok{!!!}\NormalTok{(filter.lst[[n]]))}
      \ControlFlowTok{else}
\NormalTok{        data.lst[[n]]}
\NormalTok{    \})}
\NormalTok{  fun }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(res, lst) \{}
    \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{2}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(lst)) \{}
\NormalTok{      res }\OtherTok{\textless{}{-}}\NormalTok{ res[res }\SpecialCharTok{\%in\%}\NormalTok{ lst[[ i ]]]}
\NormalTok{    \}}
    \FunctionTok{return}\NormalTok{(res)}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(split)) \{}
\NormalTok{    lst }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(lst, }\ControlFlowTok{function}\NormalTok{(data) data[[ target ]])}
\NormalTok{    res }\OtherTok{\textless{}{-}} \FunctionTok{fun}\NormalTok{(lst[[}\DecValTok{1}\NormalTok{]], lst)}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    res }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{split}\NormalTok{(lst[[}\DecValTok{1}\NormalTok{]], lst[[}\DecValTok{1}\NormalTok{]][[ split ]]),}
      \ControlFlowTok{function}\NormalTok{(data) data[[ target ]])}
\NormalTok{    lst }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(lst, }\ControlFlowTok{function}\NormalTok{(data) data[[ target ]])}
\NormalTok{    res }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(res, fun, }\AttributeTok{lst =}\NormalTok{ lst)}
\NormalTok{  \}}
  \FunctionTok{return}\NormalTok{(res)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @importFrom rlang as\_label}
\NormalTok{.check\_data }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(object, lst, }\AttributeTok{tip =} \StringTok{"(...)"}\NormalTok{)\{}
\NormalTok{    target }\OtherTok{\textless{}{-}}\NormalTok{ rlang}\SpecialCharTok{::}\FunctionTok{as\_label}\NormalTok{(}\FunctionTok{substitute}\NormalTok{(object))}
    \FunctionTok{mapply}\NormalTok{(lst, }\FunctionTok{names}\NormalTok{(lst), }\AttributeTok{FUN =} \ControlFlowTok{function}\NormalTok{(value, name)\{}
\NormalTok{      obj }\OtherTok{\textless{}{-}} \FunctionTok{match.fun}\NormalTok{(name)(object)}
      \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(obj)) \{}
        \FunctionTok{stop}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"is.null("}\NormalTok{, name, }\StringTok{"("}\NormalTok{, target, }\StringTok{")) == T. "}\NormalTok{,}
            \StringTok{"use \textasciigrave{}"}\NormalTok{, value, tip, }\StringTok{"\textasciigrave{} previously."}\NormalTok{))}
\NormalTok{      \}}
      \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.list}\NormalTok{(obj)) \{}
        \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(obj) }\SpecialCharTok{==} \DecValTok{0}\NormalTok{) \{}
          \FunctionTok{stop}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"length("}\NormalTok{, name, }\StringTok{"("}\NormalTok{, target, }\StringTok{")) == 0. "}\NormalTok{,}
              \StringTok{"use \textasciigrave{}"}\NormalTok{, value, tip, }\StringTok{"\textasciigrave{} previously."}\NormalTok{))}
\NormalTok{        \}}
\NormalTok{      \}}
\NormalTok{      \})}
\NormalTok{  \}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-dot_heatmap.r}{%
\section{File: dot\_heatmap.R}\label{file-dot_heatmap.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# heat map with ggplot2}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\#\textquotesingle{} @aliases plot\_heatmap}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Plot heat map with ggplot2}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description According to list of \textquotesingle{}ID\textquotesingle{} to draw mutiple heatmap...}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name plot\_heatmap}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @export plot\_heatmap}
\CommentTok{\#\textquotesingle{} @aliases plot\_heatmap}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{plot\_heatmap\}: ...}
\CommentTok{\#\textquotesingle{} @rdname plot\_heatmap}
\NormalTok{plot\_heatmap }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(id.lst, data, metadata,}
  \AttributeTok{pal\_class =}\NormalTok{ ggsci}\SpecialCharTok{::}\FunctionTok{pal\_futurama}\NormalTok{()(}\DecValTok{12}\NormalTok{), pal\_group,}
  \AttributeTok{clust\_row =}\NormalTok{ T, }\AttributeTok{clust\_col =}\NormalTok{ T, }\AttributeTok{method =} \StringTok{\textquotesingle{}complete\textquotesingle{}}\NormalTok{)}
\NormalTok{\{}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(}\FunctionTok{names}\NormalTok{(id.lst))) \{}
    \FunctionTok{stop}\NormalTok{(}\StringTok{"is.null(names(id.lst)) == T. The names of \textasciigrave{}id.lst\textasciigrave{} should be chemical classes."}\NormalTok{)}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(}\FunctionTok{names}\NormalTok{(pal\_class))) \{}
\NormalTok{    pal\_class }\OtherTok{\textless{}{-}}\NormalTok{ pal\_class[}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(id.lst)]}
    \FunctionTok{names}\NormalTok{(pal\_class) }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(id.lst)}
\NormalTok{  \}}
  \FunctionTok{.check\_columns}\NormalTok{(metadata, }\FunctionTok{c}\NormalTok{(}\StringTok{"sample"}\NormalTok{, }\StringTok{"group"}\NormalTok{), }\StringTok{"metadata"}\NormalTok{)}
  \FunctionTok{.check\_columns}\NormalTok{(data, }\FunctionTok{c}\NormalTok{(}\StringTok{".features\_id"}\NormalTok{, }\StringTok{"sample"}\NormalTok{, }\StringTok{"value"}\NormalTok{), }\StringTok{"data"}\NormalTok{)}
\NormalTok{  lst }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(id.lst), }\AttributeTok{simplify =}\NormalTok{ F,}
    \ControlFlowTok{function}\NormalTok{(class.name) \{}
      \DocumentationTok{\#\# basic heatmap}
\NormalTok{      ids }\OtherTok{\textless{}{-}}\NormalTok{ id.lst[[ class.name ]]}
\NormalTok{      data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(data, .data}\SpecialCharTok{$}\NormalTok{.features\_id }\SpecialCharTok{\%in\%}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{all\_of}\NormalTok{(ids))}
\NormalTok{      p }\OtherTok{\textless{}{-}} \FunctionTok{tile\_heatmap}\NormalTok{(data)}
      \DocumentationTok{\#\# chemical classes}
\NormalTok{      data.class }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{class =}\NormalTok{ class.name, }\AttributeTok{.features\_id =}\NormalTok{ ids)}
\NormalTok{      pal\_class }\OtherTok{\textless{}{-}}\NormalTok{ pal\_class[}\FunctionTok{names}\NormalTok{(pal\_class) }\SpecialCharTok{==}\NormalTok{ class.name]}
\NormalTok{      p }\OtherTok{\textless{}{-}} \FunctionTok{add\_ygroup.tile.heatmap}\NormalTok{(data.class, p, pal\_class)}
      \DocumentationTok{\#\# cluster tree}
      \ControlFlowTok{if}\NormalTok{ (clust\_row }\SpecialCharTok{|}\NormalTok{ clust\_col) \{}
\NormalTok{        data.w }\OtherTok{\textless{}{-}}\NormalTok{ tidyr}\SpecialCharTok{::}\FunctionTok{spread}\NormalTok{(data, .data}\SpecialCharTok{$}\NormalTok{sample, .data}\SpecialCharTok{$}\NormalTok{value)}
\NormalTok{        data.w }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(data.w)}
        \FunctionTok{rownames}\NormalTok{(data.w) }\OtherTok{\textless{}{-}}\NormalTok{ data.w}\SpecialCharTok{$}\NormalTok{.features\_id}
\NormalTok{        data.w }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(data.w, dplyr}\SpecialCharTok{::}\FunctionTok{all\_of}\NormalTok{(metadata[[ }\StringTok{"sample"}\NormalTok{ ]]))}
\NormalTok{        p }\OtherTok{\textless{}{-}} \FunctionTok{add\_tree.heatmap}\NormalTok{(}
\NormalTok{          data.w, p, }\AttributeTok{method =}\NormalTok{ method,}
          \AttributeTok{clust\_row =}\NormalTok{ clust\_row, }\AttributeTok{clust\_col =}\NormalTok{ clust\_col}
\NormalTok{        )}
\NormalTok{      \}}
      \DocumentationTok{\#\# sample metadata}
\NormalTok{      p }\OtherTok{\textless{}{-}} \FunctionTok{add\_xgroup.tile.heatmap}\NormalTok{(metadata, p, pal\_group)}
      \FunctionTok{return}\NormalTok{(p)}
\NormalTok{    \})}
  \FunctionTok{return}\NormalTok{(lst)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export handling\_na}
\CommentTok{\#\textquotesingle{} @aliases handling\_na}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{handling\_na\}:}
\CommentTok{\#\textquotesingle{} For each subset of data, the missing values will be filled with the average}
\CommentTok{\#\textquotesingle{} value; if the set is all missing values, they will be filled with zero.}
\CommentTok{\#\textquotesingle{} @rdname plot\_heatmap}
\NormalTok{handling\_na }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(data, }\AttributeTok{id.cols =} \FunctionTok{c}\NormalTok{(}\StringTok{".features\_id"}\NormalTok{),}
\NormalTok{  metadata, }\AttributeTok{sample.col =} \StringTok{"sample"}\NormalTok{, }\AttributeTok{group.col =} \StringTok{"group"}\NormalTok{)}
\NormalTok{\{}
\NormalTok{  metadata }\OtherTok{\textless{}{-}}\NormalTok{ metadata[, }\FunctionTok{c}\NormalTok{(sample.col, group.col)]}
\NormalTok{  metadata }\OtherTok{\textless{}{-}} \FunctionTok{split}\NormalTok{(metadata, metadata[[ group.col ]])}
\NormalTok{  id.cols }\OtherTok{\textless{}{-}}\NormalTok{ data[, id.cols]}
\NormalTok{  data }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(metadata),}
    \ControlFlowTok{function}\NormalTok{(group) \{}
\NormalTok{      meta }\OtherTok{\textless{}{-}}\NormalTok{ metadata[[ group ]]}
\NormalTok{      df }\OtherTok{\textless{}{-}}\NormalTok{ data[, meta[[ sample.col ]]]}
\NormalTok{      lst }\OtherTok{\textless{}{-}} \FunctionTok{apply}\NormalTok{(df, }\DecValTok{1}\NormalTok{, }\AttributeTok{simplify =}\NormalTok{ F,}
        \ControlFlowTok{function}\NormalTok{(vec) \{}
          \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{all}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(vec))) \{}
\NormalTok{            vec[] }\OtherTok{\textless{}{-}} \DecValTok{0}
\NormalTok{          \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{any}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(vec))) \{}
\NormalTok{            vec[}\FunctionTok{is.na}\NormalTok{(vec)] }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(vec, }\AttributeTok{na.rm =}\NormalTok{ T)}
\NormalTok{          \}}
\NormalTok{          dplyr}\SpecialCharTok{::}\FunctionTok{bind\_rows}\NormalTok{(vec)}
\NormalTok{        \})}
\NormalTok{      data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(lst)}
\NormalTok{    \})}
\NormalTok{  data }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(dplyr}\SpecialCharTok{::}\NormalTok{bind\_cols, data)}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{bind\_cols}\NormalTok{(id.cols, data)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export log\_trans}
\CommentTok{\#\textquotesingle{} @aliases log\_trans}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{log\_trans\}:}
\CommentTok{\#\textquotesingle{} Convert wide data to long data; log transform the values; if there is a}
\CommentTok{\#\textquotesingle{} value 0, replace it with 1/10 of the minimum value of the value column.}
\CommentTok{\#\textquotesingle{} @rdname plot\_heatmap}
\NormalTok{log\_trans }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(data, }\AttributeTok{id.cols =} \FunctionTok{c}\NormalTok{(}\StringTok{".features\_id"}\NormalTok{),}
  \AttributeTok{key =} \StringTok{"sample"}\NormalTok{, }\AttributeTok{value =} \StringTok{"value"}\NormalTok{,}
  \AttributeTok{set\_min =}\NormalTok{ T, }\AttributeTok{factor =} \DecValTok{10}\NormalTok{, }\AttributeTok{fun =}\NormalTok{ log2, }\AttributeTok{center =}\NormalTok{ T)}
\NormalTok{\{}
\NormalTok{  data }\OtherTok{\textless{}{-}}\NormalTok{ tidyr}\SpecialCharTok{::}\FunctionTok{gather}\NormalTok{(data, }\SpecialCharTok{!!}\NormalTok{key, }\SpecialCharTok{!!}\NormalTok{value, }\SpecialCharTok{{-}}\NormalTok{dplyr}\SpecialCharTok{::}\FunctionTok{all\_of}\NormalTok{(id.cols))}
  \ControlFlowTok{if}\NormalTok{ (set\_min) \{}
\NormalTok{    min }\OtherTok{\textless{}{-}} \FunctionTok{min}\NormalTok{(dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(data, .data[[ value ]] }\SpecialCharTok{!=} \DecValTok{0}\NormalTok{)[[ value ]])}
\NormalTok{    data[[ value ]] }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(data[[ value ]] }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, min }\SpecialCharTok{/}\NormalTok{ factor, data[[ value ]])}
\NormalTok{  \}}
\NormalTok{  data[[ value ]] }\OtherTok{\textless{}{-}} \FunctionTok{fun}\NormalTok{(data[[ value ]])}
  \ControlFlowTok{if}\NormalTok{ (center) \{}
\NormalTok{    data[[ value ]] }\OtherTok{\textless{}{-}} \FunctionTok{scale}\NormalTok{(data[[ value ]], }\AttributeTok{scale =}\NormalTok{ F)[, }\DecValTok{1}\NormalTok{]}
\NormalTok{  \}}
  \FunctionTok{return}\NormalTok{(data)}
\NormalTok{\}}

\NormalTok{dot\_heatmap }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(df)\{}
\NormalTok{  p }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(df, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ sample, }\AttributeTok{y =}\NormalTok{ .features\_id)) }\SpecialCharTok{+}
    \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{size =} \FunctionTok{abs}\NormalTok{(value), }\AttributeTok{color =}\NormalTok{ value), }\AttributeTok{shape =} \DecValTok{16}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{theme\_minimal}\NormalTok{() }\SpecialCharTok{+}
    \FunctionTok{guides}\NormalTok{(}\AttributeTok{size =} \StringTok{"none"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{scale\_color\_gradient2}\NormalTok{(}\AttributeTok{low =} \StringTok{"\#3182BDFF"}\NormalTok{, }\AttributeTok{high =} \StringTok{"\#A73030FF"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{theme}\NormalTok{(}\AttributeTok{text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{family =}\NormalTok{ .font),}
      \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{90}\NormalTok{))}
    \FunctionTok{return}\NormalTok{(p)}
\NormalTok{\}}

\DocumentationTok{\#\# long data}
\NormalTok{tile\_heatmap }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(df)\{}
\NormalTok{    p }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(df, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ sample, }\AttributeTok{y =}\NormalTok{ .features\_id)) }\SpecialCharTok{+}
      \FunctionTok{geom\_tile}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ value),}
        \AttributeTok{color =} \StringTok{"white"}\NormalTok{, }\AttributeTok{height =} \DecValTok{1}\NormalTok{, }\AttributeTok{width =} \DecValTok{1}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.2}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{theme\_minimal}\NormalTok{() }\SpecialCharTok{+}
      \FunctionTok{scale\_fill\_gradient2}\NormalTok{(}\AttributeTok{low =} \StringTok{"\#3182BDFF"}\NormalTok{, }\AttributeTok{high =} \StringTok{"\#A73030FF"}\NormalTok{,}
        \AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\FunctionTok{min}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{value), }\FunctionTok{max}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{value))) }\SpecialCharTok{+}
      \FunctionTok{labs}\NormalTok{(}\AttributeTok{x =} \StringTok{"Sample"}\NormalTok{, }\AttributeTok{y =} \StringTok{"Feature ID"}\NormalTok{, }\AttributeTok{fill =} \StringTok{"log2 (Feature level)"}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{theme}\NormalTok{(}\AttributeTok{text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{family =}\NormalTok{ .font, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{),}
        \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{face =} \StringTok{"plain"}\NormalTok{),}
        \AttributeTok{axis.text.x =} \FunctionTok{element\_blank}\NormalTok{()}
\NormalTok{      )}
      \FunctionTok{return}\NormalTok{(p)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export add\_tree.heatmap}
\CommentTok{\#\textquotesingle{} @aliases add\_tree.heatmap}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{add\_tree.heatmap\}: ...}
\CommentTok{\#\textquotesingle{} @rdname plot\_heatmap}
\NormalTok{add\_tree.heatmap }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(df, p, }\AttributeTok{clust\_row =}\NormalTok{ T, }\AttributeTok{clust\_col =}\NormalTok{ T, }\AttributeTok{method =} \StringTok{\textquotesingle{}complete\textquotesingle{}}\NormalTok{)\{}
    \ControlFlowTok{if}\NormalTok{ (clust\_row) \{}
\NormalTok{      phr }\OtherTok{\textless{}{-}} \FunctionTok{hclust}\NormalTok{(}\FunctionTok{dist}\NormalTok{(df), method)}
\NormalTok{      phr }\OtherTok{\textless{}{-}}\NormalTok{ ggtree}\SpecialCharTok{::}\FunctionTok{ggtree}\NormalTok{(phr, }\AttributeTok{layout =} \StringTok{"rectangular"}\NormalTok{, }\AttributeTok{branch.length =} \StringTok{"branch.length"}\NormalTok{) }\SpecialCharTok{+}
        \FunctionTok{theme}\NormalTok{(}\AttributeTok{plot.margin =} \FunctionTok{unit}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{), }\StringTok{"cm"}\NormalTok{))}
\NormalTok{      p }\OtherTok{\textless{}{-}}\NormalTok{ aplot}\SpecialCharTok{::}\FunctionTok{insert\_left}\NormalTok{(p, phr, }\AttributeTok{width =} \FloatTok{0.3}\NormalTok{)}
\NormalTok{    \}}
    \ControlFlowTok{if}\NormalTok{ (clust\_col) \{}
\NormalTok{      phc }\OtherTok{\textless{}{-}} \FunctionTok{hclust}\NormalTok{(}\FunctionTok{dist}\NormalTok{(}\FunctionTok{t}\NormalTok{(df)), method)}
\NormalTok{      phc }\OtherTok{\textless{}{-}}\NormalTok{ ggtree}\SpecialCharTok{::}\FunctionTok{ggtree}\NormalTok{(phc, }\AttributeTok{layout =} \StringTok{"rectangular"}\NormalTok{, }\AttributeTok{branch.length =} \StringTok{"branch.length"}\NormalTok{) }\SpecialCharTok{+}
\NormalTok{        ggtree}\SpecialCharTok{::}\FunctionTok{layout\_dendrogram}\NormalTok{() }\SpecialCharTok{+}
        \FunctionTok{theme}\NormalTok{(}\AttributeTok{plot.margin =} \FunctionTok{unit}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{), }\StringTok{"cm"}\NormalTok{))}
\NormalTok{      p }\OtherTok{\textless{}{-}}\NormalTok{ aplot}\SpecialCharTok{::}\FunctionTok{insert\_top}\NormalTok{(p, phc, }\AttributeTok{height =} \FloatTok{0.3}\NormalTok{)}
\NormalTok{    \}}
    \FunctionTok{return}\NormalTok{(p)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export add\_xgroup.heatmap}
\CommentTok{\#\textquotesingle{} @aliases add\_xgroup.heatmap}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{add\_xgroup.heatmap\}: ...}
\CommentTok{\#\textquotesingle{} @rdname plot\_heatmap}
\NormalTok{add\_xgroup.heatmap }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(df, p)\{}
\NormalTok{    p.xgroup }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(df, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =} \StringTok{"Group"}\NormalTok{, }\AttributeTok{x =}\NormalTok{ sample)) }\SpecialCharTok{+}
      \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{color =}\NormalTok{ group), }\AttributeTok{size =} \DecValTok{6}\NormalTok{) }\SpecialCharTok{+}
\NormalTok{      ggsci}\SpecialCharTok{::}\FunctionTok{scale\_color\_simpsons}\NormalTok{() }\SpecialCharTok{+}
      \FunctionTok{labs}\NormalTok{(}\AttributeTok{x =} \StringTok{""}\NormalTok{, }\AttributeTok{y =} \StringTok{""}\NormalTok{, }\AttributeTok{fill =} \StringTok{"Group"}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{theme\_minimal}\NormalTok{() }\SpecialCharTok{+}
      \FunctionTok{theme}\NormalTok{(}
        \AttributeTok{axis.text.x =} \FunctionTok{element\_blank}\NormalTok{(),}
        \AttributeTok{axis.text.y =} \FunctionTok{element\_blank}\NormalTok{(),}
        \AttributeTok{text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{family =}\NormalTok{ .font, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{),}
        \AttributeTok{plot.margin =} \FunctionTok{unit}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{), }\StringTok{"cm"}\NormalTok{)}
\NormalTok{      )}
\NormalTok{      com }\OtherTok{\textless{}{-}}\NormalTok{ aplot}\SpecialCharTok{::}\FunctionTok{insert\_bottom}\NormalTok{(p, p.xgroup, }\AttributeTok{height =} \FloatTok{0.05}\NormalTok{)}
      \FunctionTok{return}\NormalTok{(com)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export add\_xgroup.tile.heatmap}
\CommentTok{\#\textquotesingle{} @aliases add\_xgroup.tile.heatmap}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{add\_xgroup.tile.heatmap\}: ...}
\CommentTok{\#\textquotesingle{} @rdname plot\_heatmap}
\NormalTok{add\_xgroup.tile.heatmap }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(df, p, }\AttributeTok{pal =} \ConstantTok{NA}\NormalTok{)\{}
\NormalTok{    expr.pal }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(pal),}
      \StringTok{\textquotesingle{}ggsci::scale\_fill\_simpsons()\textquotesingle{}}\NormalTok{,}
      \StringTok{\textquotesingle{}scale\_fill\_manual(values = pal)\textquotesingle{}}\NormalTok{)}
\NormalTok{    p.xgroup }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(df, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =} \StringTok{"Group"}\NormalTok{, }\AttributeTok{x =}\NormalTok{ sample)) }\SpecialCharTok{+}
      \FunctionTok{geom\_tile}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ group), }
        \AttributeTok{color =} \StringTok{"white"}\NormalTok{, }\AttributeTok{height =} \DecValTok{1}\NormalTok{, }\AttributeTok{width =} \DecValTok{1}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.2}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{eval}\NormalTok{(}\FunctionTok{parse}\NormalTok{(}\AttributeTok{text =}\NormalTok{ expr.pal)) }\SpecialCharTok{+}
      \FunctionTok{labs}\NormalTok{(}\AttributeTok{x =} \StringTok{""}\NormalTok{, }\AttributeTok{y =} \StringTok{""}\NormalTok{, }\AttributeTok{fill =} \StringTok{"Group"}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{theme\_minimal}\NormalTok{() }\SpecialCharTok{+}
      \FunctionTok{theme}\NormalTok{(}
        \AttributeTok{axis.text.x =} \FunctionTok{element\_blank}\NormalTok{(),}
        \AttributeTok{axis.text.y =} \FunctionTok{element\_blank}\NormalTok{(),}
        \AttributeTok{text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{family =}\NormalTok{ .font, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{),}
        \AttributeTok{plot.margin =} \FunctionTok{unit}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{), }\StringTok{"cm"}\NormalTok{)}
\NormalTok{      )}
\NormalTok{      com }\OtherTok{\textless{}{-}}\NormalTok{ aplot}\SpecialCharTok{::}\FunctionTok{insert\_bottom}\NormalTok{(p, p.xgroup, }\AttributeTok{height =} \FloatTok{0.05}\NormalTok{)}
      \FunctionTok{return}\NormalTok{(com)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export add\_ygroup.tile.heatmap}
\CommentTok{\#\textquotesingle{} @aliases add\_ygroup.tile.heatmap}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{add\_ygroup.tile.heatmap\}: ...}
\CommentTok{\#\textquotesingle{} @rdname plot\_heatmap}
\NormalTok{add\_ygroup.tile.heatmap }\OtherTok{\textless{}{-}}
  \ControlFlowTok{function}\NormalTok{(df, p, }\AttributeTok{pal =} \ConstantTok{NA}\NormalTok{)\{}
\NormalTok{    expr.pal }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(pal),}
      \StringTok{\textquotesingle{}ggsci::scale\_fill\_npg()\textquotesingle{}}\NormalTok{,}
      \StringTok{\textquotesingle{}scale\_fill\_manual(values = pal)\textquotesingle{}}\NormalTok{)}
\NormalTok{    p.ygroup }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(df, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \StringTok{"Class"}\NormalTok{, }\AttributeTok{y =}\NormalTok{ .features\_id)) }\SpecialCharTok{+}
      \FunctionTok{geom\_tile}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ class),}
        \AttributeTok{color =} \StringTok{"white"}\NormalTok{, }\AttributeTok{height =} \DecValTok{1}\NormalTok{, }\AttributeTok{width =} \DecValTok{1}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.2}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{labs}\NormalTok{(}\AttributeTok{x =} \StringTok{""}\NormalTok{, }\AttributeTok{y =} \StringTok{""}\NormalTok{, }\AttributeTok{fill =} \StringTok{"From"}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{eval}\NormalTok{(}\FunctionTok{parse}\NormalTok{(}\AttributeTok{text =}\NormalTok{ expr.pal)) }\SpecialCharTok{+}
      \FunctionTok{theme\_minimal}\NormalTok{() }\SpecialCharTok{+}
      \FunctionTok{theme}\NormalTok{(}
        \AttributeTok{axis.text.x =} \FunctionTok{element\_blank}\NormalTok{(),}
        \AttributeTok{axis.text.y =} \FunctionTok{element\_blank}\NormalTok{(),}
        \AttributeTok{text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{family =}\NormalTok{ .font, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{),}
        \AttributeTok{plot.margin =} \FunctionTok{unit}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{), }\StringTok{"cm"}\NormalTok{)}
\NormalTok{      )}
\NormalTok{      com }\OtherTok{\textless{}{-}}\NormalTok{ aplot}\SpecialCharTok{::}\FunctionTok{insert\_left}\NormalTok{(p, p.ygroup, }\AttributeTok{width =} \FloatTok{0.02}\NormalTok{) }
      \FunctionTok{return}\NormalTok{(com)}
\NormalTok{  \}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-exreport.r}{%
\section{File: exReport.R}\label{file-exreport.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# extra tool for report system}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\# gather\_sections \textless{}{-} function(prefix = "s", envir = parent.frame(),}
\CommentTok{\#   sort = T, get = T)}
\CommentTok{\# \{}
\CommentTok{\#   objs \textless{}{-} ls(envir = envir)}
\CommentTok{\#   sections \textless{}{-} objs[ grepl(paste0("\^{}", prefix, "[0{-}9]"), objs) ]}
\CommentTok{\#   if (sort) \{}
\CommentTok{\#     num \textless{}{-} stringr::str\_extract(}
\CommentTok{\#       sections, paste0("(?\textless{}=", prefix, ")[0{-}9.]\{0,\}[0{-}9]")}
\CommentTok{\#     )}
\CommentTok{\#     sections \textless{}{-} sections[order(as.numeric(num))]}
\CommentTok{\#   \}}
\CommentTok{\#   if (get) \{}
\CommentTok{\#     sections \textless{}{-} sapply(sections, get, envir = envir, simplify = F)}
\CommentTok{\#   \}}
\CommentTok{\#   sections}
\CommentTok{\# \}}

\CommentTok{\#\textquotesingle{} @export .workflow\_name}
\NormalTok{.workflow\_name }\OtherTok{\textless{}{-}}
  \FunctionTok{substitute}\NormalTok{(}
    \FunctionTok{c}\NormalTok{(}\StringTok{"Abstract"} \OtherTok{=} \DecValTok{1}\NormalTok{, }\StringTok{"Introduction"} \OtherTok{=} \DecValTok{1}\NormalTok{, }\StringTok{"Set{-}up"} \OtherTok{=} \DecValTok{1}\NormalTok{,}
      \StringTok{"Integrate data and Create Nebulae"} \OtherTok{=} \DecValTok{1}\NormalTok{,}
      \StringTok{"Initialize analysis"} \OtherTok{=} \DecValTok{2}\NormalTok{,}
      \StringTok{"Filter candidates"} \OtherTok{=} \DecValTok{2}\NormalTok{,}
      \StringTok{"Filter chemical classes"} \OtherTok{=} \DecValTok{2}\NormalTok{,}
      \StringTok{"Create Nebulae"} \OtherTok{=} \DecValTok{2}\NormalTok{,}
      \StringTok{"Visualize Nebulae"} \OtherTok{=} \DecValTok{2}\NormalTok{,}
      \StringTok{"Nebulae for Downstream analysis"} \OtherTok{=} \DecValTok{1}\NormalTok{,}
      \StringTok{"Statistic analysis"} \OtherTok{=} \DecValTok{2}\NormalTok{,}
      \StringTok{"Set tracer in Child{-}Nebulae"} \OtherTok{=} \DecValTok{2}\NormalTok{,}
      \StringTok{"Quantification in Child{-}Nebulae"} \OtherTok{=} \DecValTok{2}\NormalTok{,}
      \StringTok{"Annotate Nebulae"} \OtherTok{=} \DecValTok{2}\NormalTok{,}
      \StringTok{"Query compounds"} \OtherTok{=} \DecValTok{2}\NormalTok{,}
      \StringTok{"Pathway enrichment"} \OtherTok{=} \DecValTok{2}\NormalTok{,}
      \StringTok{"Session infomation"} \OtherTok{=} \DecValTok{1}
\NormalTok{      ))}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-grid_draw.r}{%
\section{File: grid\_draw.R}\label{file-grid_draw.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# class}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}
\CommentTok{\#\textquotesingle{} @exportClass graph}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @aliases graph}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title A class built on \textquotesingle{}grobs\textquotesingle{}}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description ...}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @rdname graph{-}class}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @examples}
\CommentTok{\#\textquotesingle{} \textbackslash{}dontrun\{}
\CommentTok{\#\textquotesingle{} new(\textquotesingle{}graph\textquotesingle{}, ...)}
\CommentTok{\#\textquotesingle{} \}}
\NormalTok{graph }\OtherTok{\textless{}{-}} 
  \FunctionTok{setClass}\NormalTok{(}\StringTok{"graph"}\NormalTok{, }
    \AttributeTok{contains =} \FunctionTok{character}\NormalTok{(),}
    \AttributeTok{representation =} 
      \FunctionTok{representation}\NormalTok{(}\AttributeTok{grob =} \StringTok{"ANY"}\NormalTok{,}
        \AttributeTok{cvp =} \StringTok{"ANY"}
\NormalTok{        ),}
      \AttributeTok{prototype =} \ConstantTok{NULL}
\NormalTok{  )}

\NormalTok{.grob\_class }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"grob"}\NormalTok{, }\StringTok{"frame"}\NormalTok{, }\StringTok{"gTree"}\NormalTok{, }\StringTok{"null"}\NormalTok{,}
  \StringTok{"text"}\NormalTok{, }\StringTok{"circle"}\NormalTok{, }\StringTok{"segments"}\NormalTok{, }\StringTok{"gtable"}\NormalTok{,}
  \StringTok{"curve"}\NormalTok{, }\StringTok{"polygon"}\NormalTok{, }\StringTok{"rastergrob"}\NormalTok{)}
\FunctionTok{setOldClass}\NormalTok{(.grob\_class)}
\FunctionTok{setOldClass}\NormalTok{(}\StringTok{"viewport"}\NormalTok{)}
\FunctionTok{setClassUnion}\NormalTok{(}\StringTok{"grob.obj"}\NormalTok{, .grob\_class)}

\NormalTok{.gg }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"gg"}\NormalTok{, }\StringTok{"ggplot"}\NormalTok{, }\StringTok{"ggraph"}\NormalTok{)}
\FunctionTok{setOldClass}\NormalTok{(.gg)}
\FunctionTok{setClassUnion}\NormalTok{(}\StringTok{"gg.obj"}\NormalTok{, .gg)}

\NormalTok{.class\_unit }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"unit"}\NormalTok{, }\StringTok{"simpleUnit"}\NormalTok{, }\StringTok{"unit\_v2"}\NormalTok{)}
\FunctionTok{setOldClass}\NormalTok{(.class\_unit)}
\FunctionTok{setClassUnion}\NormalTok{(}\StringTok{"units"}\NormalTok{, .class\_unit)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# color}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\#\textquotesingle{} @export .default\_color}
\NormalTok{.default\_color }\OtherTok{\textless{}{-}}\NormalTok{ ggsci}\SpecialCharTok{::}\FunctionTok{pal\_npg}\NormalTok{()(}\DecValTok{9}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# method}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\#\textquotesingle{} @aliases draw}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title draw class of \textquotesingle{}graph\textquotesingle{} and \textquotesingle{}grobs\textquotesingle{}}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description ...}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name draw{-}methods}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"draw"}\NormalTok{, }
  \ControlFlowTok{function}\NormalTok{(x, content)}
    \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"draw"}\NormalTok{))}

\CommentTok{\#\textquotesingle{} @exportMethod draw}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"draw"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"graph"}\NormalTok{, }\AttributeTok{content =} \StringTok{"grob.obj"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(x, content)\{}
    \FunctionTok{grid.draw}\NormalTok{(x}\SpecialCharTok{@}\NormalTok{grob)}
    \FunctionTok{pushViewport}\NormalTok{(x}\SpecialCharTok{@}\NormalTok{cvp)}
    \FunctionTok{grid.draw}\NormalTok{(content)}
    \FunctionTok{upViewport}\NormalTok{(}\DecValTok{1}\NormalTok{)}
\NormalTok{  \})}

\CommentTok{\#\textquotesingle{} @exportMethod draw}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"draw"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"draw"}\NormalTok{,}
    \AttributeTok{x =} \StringTok{"graph"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(x)\{}
    \FunctionTok{grid.draw}\NormalTok{(x}\SpecialCharTok{@}\NormalTok{grob)}
\NormalTok{  \})}

\CommentTok{\#\textquotesingle{} @exportMethod draw}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"draw"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"grob.obj"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(x)\{}
    \FunctionTok{grid.draw}\NormalTok{(x)}
\NormalTok{  \})}

\CommentTok{\#\textquotesingle{} @exportMethod into}
\CommentTok{\#\textquotesingle{} @title place \textquotesingle{}grobs\textquotesingle{} into \textquotesingle{}graph\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description ...}
\CommentTok{\#\textquotesingle{} @rdname into{-}methods}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"into"}\NormalTok{, }
  \ControlFlowTok{function}\NormalTok{(x, content) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"into"}\NormalTok{))}

\CommentTok{\#\textquotesingle{} @exportMethod into}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"into"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"graph"}\NormalTok{, }\AttributeTok{content =} \StringTok{"grob.obj"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(x, content)\{}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(content}\SpecialCharTok{$}\NormalTok{vp)) \{}
\NormalTok{      content}\SpecialCharTok{$}\NormalTok{vp }\OtherTok{\textless{}{-}}\NormalTok{ x}\SpecialCharTok{@}\NormalTok{cvp}
\NormalTok{    \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{      content}\SpecialCharTok{$}\NormalTok{vp }\OtherTok{\textless{}{-}} \FunctionTok{vpStack}\NormalTok{(x}\SpecialCharTok{@}\NormalTok{cvp, content}\SpecialCharTok{$}\NormalTok{vp)}
\NormalTok{    \}}
    \FunctionTok{gTree}\NormalTok{(}\AttributeTok{children =} \FunctionTok{gList}\NormalTok{(x}\SpecialCharTok{@}\NormalTok{grob, content))}
\NormalTok{  \})}

\CommentTok{\#\textquotesingle{} @exportMethod setvp}
\CommentTok{\#\textquotesingle{} @title ...}
\CommentTok{\#\textquotesingle{} @description ...}
\CommentTok{\#\textquotesingle{} @rdname setvp{-}methods}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"setvp"}\NormalTok{, }
  \ControlFlowTok{function}\NormalTok{(x, ...) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"setvp"}\NormalTok{))}

\CommentTok{\#\textquotesingle{} @exportMethod setvp}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"setvp"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(x, ...)\{}
    \FunctionTok{viewport}\NormalTok{(}\FunctionTok{grobX}\NormalTok{(x, }\DecValTok{90}\NormalTok{), }\FunctionTok{grobY}\NormalTok{(x, }\DecValTok{0}\NormalTok{),}
      \FunctionTok{grobWidth}\NormalTok{(x), }\FunctionTok{grobHeight}\NormalTok{(x), ...)}
\NormalTok{  \})}

\CommentTok{\#\textquotesingle{} @exportMethod weight}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"weight"}\NormalTok{, }
  \ControlFlowTok{function}\NormalTok{(x, sub) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"weight"}\NormalTok{))}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"weight"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"ANY"}\NormalTok{, }\AttributeTok{sub =} \StringTok{"character"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(x, sub)\{}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{isS4}\NormalTok{(x)) \{}
\NormalTok{      weight }\OtherTok{\textless{}{-}}
        \FunctionTok{sapply}\NormalTok{(sub, }\AttributeTok{simplify =}\NormalTok{ F, }\ControlFlowTok{function}\NormalTok{(sub) \{}
          \FunctionTok{get\_weight}\NormalTok{(}\FunctionTok{slot}\NormalTok{(x, sub))}
\NormalTok{      \})}
\NormalTok{    \}}
    \FunctionTok{as.list}\NormalTok{(}\FunctionTok{sort}\NormalTok{(}\FunctionTok{unlist}\NormalTok{(weight), }\AttributeTok{decreasing =}\NormalTok{ T))}
\NormalTok{  \})}

\CommentTok{\#\textquotesingle{} @exportMethod as\_grob}
\CommentTok{\#\textquotesingle{} @title convert \textquotesingle{}ggplot\textquotesingle{} object to \textquotesingle{}grobs\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description ...}
\CommentTok{\#\textquotesingle{} @rdname as\_grob{-}methods}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"as\_grob"}\NormalTok{,}
  \ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"as\_grob"}\NormalTok{))}

\CommentTok{\#\textquotesingle{} @exportMethod as\_grob}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"as\_grob"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{x =} \StringTok{"gg.obj"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(x)\{}
\NormalTok{    ggplot2}\SpecialCharTok{::}\FunctionTok{ggplot\_gtable}\NormalTok{(ggplot2}\SpecialCharTok{::}\FunctionTok{ggplot\_build}\NormalTok{(x))}
\NormalTok{  \})}

\CommentTok{\#\textquotesingle{} @export get\_weight}
\NormalTok{get\_weight }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x)\{}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{isS4}\NormalTok{(x)) \{}
\NormalTok{    n }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(}\FunctionTok{slotNames}\NormalTok{(x))}
    \ControlFlowTok{if}\NormalTok{ (n }\SpecialCharTok{==} \DecValTok{1}\NormalTok{) \{}
      \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.list}\NormalTok{(}\FunctionTok{slot}\NormalTok{(x, }\FunctionTok{slotNames}\NormalTok{(x)))) \{}
\NormalTok{        n }\OtherTok{\textless{}{-}}\NormalTok{ n }\SpecialCharTok{*} \FunctionTok{length}\NormalTok{(}\FunctionTok{slot}\NormalTok{(x, }\FunctionTok{slotNames}\NormalTok{(x)))}
\NormalTok{      \}}
\NormalTok{    \}}
    \FunctionTok{return}\NormalTok{(n)}
\NormalTok{  \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.list}\NormalTok{(x)) \{}
    \FunctionTok{length}\NormalTok{(x)}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
    \FunctionTok{length}\NormalTok{(x)}
\NormalTok{  \}}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @aliases frame}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title draw in grid frame}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description ...}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name frame}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @export layout\_row}
\CommentTok{\#\textquotesingle{} @aliases layout\_row}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{layout\_row\}: ...}
\CommentTok{\#\textquotesingle{} @rdname frame}
\NormalTok{layout\_row }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(weight)\{}
  \FunctionTok{grid.layout}\NormalTok{(}\FunctionTok{length}\NormalTok{(weight), }\DecValTok{1}\NormalTok{, }\AttributeTok{heights =}\NormalTok{ weight)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export frame\_row}
\CommentTok{\#\textquotesingle{} @aliases frame\_row}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{frame\_row\}: ...}
\CommentTok{\#\textquotesingle{} @rdname frame}
\NormalTok{frame\_row }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(weight, data, if.ex)\{}
  \FunctionTok{do.call}\NormalTok{(frame\_place, }\FunctionTok{.fresh\_param}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{type =} \StringTok{"row"}\NormalTok{)))}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export layout\_col}
\CommentTok{\#\textquotesingle{} @aliases layout\_col}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{layout\_col\}: ...}
\CommentTok{\#\textquotesingle{} @rdname frame}
\NormalTok{layout\_col }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(weight)\{}
  \FunctionTok{grid.layout}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FunctionTok{length}\NormalTok{(weight), }\AttributeTok{widths =}\NormalTok{ weight)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export frame\_col}
\CommentTok{\#\textquotesingle{} @aliases frame\_col}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{frame\_col\}: ...}
\CommentTok{\#\textquotesingle{} @rdname frame}
\NormalTok{frame\_col }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(weight, data, if.ex)\{}
  \FunctionTok{do.call}\NormalTok{(frame\_place, }\FunctionTok{.fresh\_param}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{type =} \StringTok{"col"}\NormalTok{)))}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @exportMethod frame\_place}
\CommentTok{\#\textquotesingle{} @aliases frame\_place}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{frame\_place\}: ...}
\CommentTok{\#\textquotesingle{} @rdname frame}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"frame\_place"}\NormalTok{, }
  \ControlFlowTok{function}\NormalTok{(weight, data, type, if.ex) }
    \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"frame\_place"}\NormalTok{))}

\CommentTok{\#\textquotesingle{} @exportMethod frame\_place}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"frame\_place"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"frame\_place"}\NormalTok{,}
    \AttributeTok{weight =} \StringTok{"vector"}\NormalTok{,}
    \AttributeTok{data =} \StringTok{"list"}\NormalTok{,}
    \AttributeTok{type =} \StringTok{"character"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(weight, data, type)\{}
\NormalTok{    fun }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"layout\_"}\NormalTok{, type)}
\NormalTok{    layout }\OtherTok{\textless{}{-}} \FunctionTok{match.fun}\NormalTok{(fun)(weight)}
\NormalTok{    frame }\OtherTok{\textless{}{-}} \FunctionTok{frameGrob}\NormalTok{(}\AttributeTok{layout =}\NormalTok{ layout)}
\NormalTok{    data }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(data), }\AttributeTok{simplify =}\NormalTok{ F,}
      \ControlFlowTok{function}\NormalTok{(name) \{}
\NormalTok{        grob }\OtherTok{\textless{}{-}}\NormalTok{ data[[ name ]]}
        \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is}\NormalTok{(grob, }\StringTok{"graph"}\NormalTok{))}
\NormalTok{          grob }\OtherTok{\textless{}{-}}\NormalTok{ grob}\SpecialCharTok{@}\NormalTok{grob}
        \FunctionTok{gTree}\NormalTok{(}\AttributeTok{children =} \FunctionTok{gList}\NormalTok{(grob),}
          \AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(}\AttributeTok{name =}\NormalTok{ name))}
\NormalTok{      \})}
    \FunctionTok{names}\NormalTok{(weight) }\OtherTok{\textless{}{-}} \FunctionTok{repSuffix}\NormalTok{(}\FunctionTok{names}\NormalTok{(weight))}
    \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(weight)) \{}
\NormalTok{      i.name }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(weight)[[ i ]]}
\NormalTok{      o.name }\OtherTok{\textless{}{-}} \FunctionTok{gsub}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.rep}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.[0{-}9]\{1,\}$"}\NormalTok{, }\StringTok{""}\NormalTok{, i.name)}
\NormalTok{      i.grob }\OtherTok{\textless{}{-}}\NormalTok{ data[[ o.name ]]}
\NormalTok{      i.grob}\SpecialCharTok{$}\NormalTok{vp}\SpecialCharTok{$}\NormalTok{name }\OtherTok{\textless{}{-}}\NormalTok{ i.name}
\NormalTok{      args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(frame, i.grob)}
\NormalTok{      args[[ type ]] }\OtherTok{\textless{}{-}}\NormalTok{ i}
\NormalTok{      frame }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(placeGrob, args)}
\NormalTok{    \}}
\NormalTok{    frame}
\NormalTok{  \})}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"frame\_place"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"frame\_place"}\NormalTok{,}
    \AttributeTok{weight =} \StringTok{"vector"}\NormalTok{,}
    \AttributeTok{data =} \StringTok{"list"}\NormalTok{,}
    \AttributeTok{type =} \StringTok{"character"}\NormalTok{,}
    \AttributeTok{if.ex =} \StringTok{"logical"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(weight, data, type, if.ex)\{}
\NormalTok{    main }\OtherTok{\textless{}{-}}\NormalTok{ weight[}\SpecialCharTok{!}\NormalTok{if.ex]}
\NormalTok{    sub }\OtherTok{\textless{}{-}}\NormalTok{ weight[if.ex]}
\NormalTok{    funs }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(frame\_col, frame\_row)}
    \DocumentationTok{\#\# which function}
\NormalTok{    which }\OtherTok{\textless{}{-}}\NormalTok{ type }\SpecialCharTok{==} \FunctionTok{c}\NormalTok{(}\StringTok{"col"}\NormalTok{, }\StringTok{"row"}\NormalTok{)}
    \DocumentationTok{\#\# ex}
\NormalTok{    ex }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{names}\NormalTok{(sub), }\AttributeTok{collapse =} \StringTok{"\_\_"}\NormalTok{)}
\NormalTok{    data[[ ex ]] }\OtherTok{\textless{}{-}}\NormalTok{ funs[}\SpecialCharTok{!}\NormalTok{which][[}\DecValTok{1}\NormalTok{]](sub, data)}
\NormalTok{    ex.w }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\FunctionTok{sum}\NormalTok{(}\FunctionTok{unlist}\NormalTok{(sub)))}
    \FunctionTok{names}\NormalTok{(ex.w) }\OtherTok{\textless{}{-}}\NormalTok{ ex}
\NormalTok{    weight }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(main, ex.w)}
    \DocumentationTok{\#\# main}
\NormalTok{    funs[which][[}\DecValTok{1}\NormalTok{]](weight, data)}
\NormalTok{  \})}

\CommentTok{\#\textquotesingle{} @aliases setnull}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Set markers crossover viewports}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description ...}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name setnull}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @export setnull}
\CommentTok{\#\textquotesingle{} @aliases setnull}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{setnull\}: ...}
\CommentTok{\#\textquotesingle{} @rdname setnull}
\NormalTok{setnull }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(target, args, }\AttributeTok{name =} \StringTok{"null"}\NormalTok{)\{}
\NormalTok{  gPath }\OtherTok{\textless{}{-}} \FunctionTok{grid.grep}\NormalTok{(}\FunctionTok{gPath}\NormalTok{(target), }\AttributeTok{vpPath =}\NormalTok{ T, }\AttributeTok{grep =}\NormalTok{ T)}
\NormalTok{  vpPath }\OtherTok{\textless{}{-}} \FunctionTok{attr}\NormalTok{(gPath, }\StringTok{"vpPath"}\NormalTok{)}
\NormalTok{  args }\OtherTok{\textless{}{-}} \FunctionTok{.fresh\_param2}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{name =}\NormalTok{ name, }\AttributeTok{vp =}\NormalTok{ vpPath), args)}
  \FunctionTok{do.call}\NormalTok{(nullGrob, args)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export setnullvp}
\CommentTok{\#\textquotesingle{} @aliases setnullvp}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{setnullvp\}: ...}
\CommentTok{\#\textquotesingle{} @rdname setnull}
\NormalTok{setnullvp }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(pattern, args, x, }\AttributeTok{name =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{fix =}\NormalTok{ T, }\AttributeTok{perl =}\NormalTok{ F)\{}
  \ControlFlowTok{if}\NormalTok{ (fix) pattern }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"::"}\NormalTok{, pattern, }\StringTok{"$"}\NormalTok{)}
\NormalTok{  vpPath }\OtherTok{\textless{}{-}} \FunctionTok{gsub}\NormalTok{(}\StringTok{"ROOT::"}\NormalTok{, }\StringTok{""}\NormalTok{, }\FunctionTok{grepPath}\NormalTok{(pattern, }\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{perl =}\NormalTok{ perl)[}\DecValTok{1}\NormalTok{])}
\NormalTok{  vpPath }\OtherTok{\textless{}{-}} \FunctionTok{vpPath}\NormalTok{(vpPath)}
\NormalTok{  args }\OtherTok{\textless{}{-}} \FunctionTok{.fresh\_param2}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{name =}\NormalTok{ name, }\AttributeTok{vp =}\NormalTok{ vpPath), args)}
  \FunctionTok{do.call}\NormalTok{(nullGrob, args)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export ruler}
\NormalTok{ruler }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(p1, p2)\{}
  \FunctionTok{segmentsGrob}\NormalTok{(}\FunctionTok{grobX}\NormalTok{(p1, }\DecValTok{0}\NormalTok{), }\FunctionTok{grobY}\NormalTok{(p1, }\DecValTok{0}\NormalTok{),}
    \FunctionTok{grobX}\NormalTok{(p2, }\DecValTok{0}\NormalTok{), }\FunctionTok{grobY}\NormalTok{(p2, }\DecValTok{0}\NormalTok{))}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export grepPath}
\CommentTok{\#\textquotesingle{} @aliases grepPath}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{grepPath\}: ...}
\CommentTok{\#\textquotesingle{} @rdname setnull}
\NormalTok{grepPath }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{ (pattern, }\AttributeTok{x =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{grobs =}\NormalTok{ T, }\AttributeTok{viewports =}\NormalTok{ T, }\AttributeTok{perl =}\NormalTok{ F) \{}
\NormalTok{    args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{grobs =}\NormalTok{ grobs, }\AttributeTok{viewports =}\NormalTok{ viewports, }\AttributeTok{print =}\NormalTok{ F)}
\NormalTok{    dl }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(grid.ls, args)}
    \ControlFlowTok{if}\NormalTok{ (viewports) \{}
\NormalTok{      keep }\OtherTok{\textless{}{-}}\NormalTok{ dl}\SpecialCharTok{$}\NormalTok{type }\SpecialCharTok{==} \StringTok{"vpListing"} \SpecialCharTok{|}\NormalTok{ dl}\SpecialCharTok{$}\NormalTok{type }\SpecialCharTok{==} \StringTok{"grobListing"} \SpecialCharTok{|} 
\NormalTok{        dl}\SpecialCharTok{$}\NormalTok{type }\SpecialCharTok{==} \StringTok{"gTreeListing"}
\NormalTok{    \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{      keep }\OtherTok{\textless{}{-}}\NormalTok{ dl}\SpecialCharTok{$}\NormalTok{type }\SpecialCharTok{==} \StringTok{"grobListing"} \SpecialCharTok{|}\NormalTok{ dl}\SpecialCharTok{$}\NormalTok{type }\SpecialCharTok{==} \StringTok{"gTreeListing"}
\NormalTok{    \}}
\NormalTok{    vpPaths }\OtherTok{\textless{}{-}}\NormalTok{ dl}\SpecialCharTok{$}\NormalTok{vpPath[keep]}
\NormalTok{    vpPaths[}\FunctionTok{grepl}\NormalTok{(pattern, vpPaths, }\AttributeTok{perl =}\NormalTok{ perl)]}
\NormalTok{  \}}


\CommentTok{\#\textquotesingle{} @export sort\_vpPaths}
\CommentTok{\#\textquotesingle{} @aliases sort\_vpPaths}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{sort\_vpPaths\}: ...}
\CommentTok{\#\textquotesingle{} @rdname setnull}
\NormalTok{sort\_vpPaths }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(vpPaths)\{}
\NormalTok{  nums }\OtherTok{\textless{}{-}} \FunctionTok{vapply}\NormalTok{(vpPaths, }\AttributeTok{FUN.VALUE =} \DecValTok{0}\NormalTok{,}
    \ControlFlowTok{function}\NormalTok{(ch) \{}\FunctionTok{length}\NormalTok{(}\FunctionTok{grepRaw}\NormalTok{(}\StringTok{"::"}\NormalTok{, ch, }\AttributeTok{all =}\NormalTok{ T))\})}
  \FunctionTok{lapply}\NormalTok{(}\FunctionTok{order}\NormalTok{(nums), }\ControlFlowTok{function}\NormalTok{(n) vpPaths[[ n ]])}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export u}
\NormalTok{u }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(n, unit)\{}
\NormalTok{  unit }\OtherTok{\textless{}{-}} \FunctionTok{as.character}\NormalTok{(}\FunctionTok{substitute}\NormalTok{(unit))}
  \FunctionTok{unit}\NormalTok{(n, unit)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export vptest}
\NormalTok{vptest }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(}\AttributeTok{r =}\NormalTok{ .}\DecValTok{7}\NormalTok{, }\AttributeTok{fill =} \StringTok{"lightblue"}\NormalTok{)\{}
  \FunctionTok{x11}\NormalTok{(}\AttributeTok{width =} \DecValTok{7}\NormalTok{, }\AttributeTok{height =} \DecValTok{7} \SpecialCharTok{*}\NormalTok{ r,)}
  \FunctionTok{pushViewport}\NormalTok{(}\FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{5}\NormalTok{, .}\DecValTok{5}\NormalTok{, }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ fill)))}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export sym\_chem}
\NormalTok{sym\_chem }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(smi)\{}
\NormalTok{  tmpsvg }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"/tempsvg.svg"}\NormalTok{)}
\NormalTok{  ChemmineOB}\SpecialCharTok{::}\FunctionTok{convertToImage}\NormalTok{(}\StringTok{"SMI"}\NormalTok{, }\StringTok{"SVG"}\NormalTok{, }\AttributeTok{source =}\NormalTok{ smi, }\AttributeTok{toFile =}\NormalTok{ tmpsvg)}
\NormalTok{  svgtxt }\OtherTok{\textless{}{-}} \FunctionTok{readLines}\NormalTok{(tmpsvg)}
\NormalTok{  svgtxt }\OtherTok{\textless{}{-}} \FunctionTok{gsub}\NormalTok{(}\StringTok{"stroke{-}width=}\SpecialCharTok{\textbackslash{}"}\StringTok{2.0"}\NormalTok{, }\StringTok{"stroke{-}width=}\SpecialCharTok{\textbackslash{}"}\StringTok{4.0"}\NormalTok{, svgtxt)}
  \FunctionTok{writeLines}\NormalTok{(svgtxt, tmpsvg)}
\NormalTok{  rsvg}\SpecialCharTok{::}\FunctionTok{rsvg\_svg}\NormalTok{(tmpsvg, tmpsvg)}
  \FunctionTok{.rm\_background}\NormalTok{(}\FunctionTok{.cairosvg\_to\_grob}\NormalTok{(tmpsvg))}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @aliases ggather}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title a mutate of grid::gTree}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description ...}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name ggather}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @export ggather}
\CommentTok{\#\textquotesingle{} @aliases ggather}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{ggather\}: ...}
\CommentTok{\#\textquotesingle{} @rdname ggather}
\NormalTok{ggather }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(..., }\AttributeTok{vp =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{gp =} \ConstantTok{NULL}\NormalTok{)\{}
\NormalTok{  objs }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(...)}
\NormalTok{  objs }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(objs, }\ControlFlowTok{function}\NormalTok{(obj) \{}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is}\NormalTok{(obj, }\StringTok{"graph"}\NormalTok{))}
\NormalTok{      obj}\SpecialCharTok{@}\NormalTok{grob}
    \ControlFlowTok{else}
\NormalTok{      obj}
\NormalTok{    \})}
\NormalTok{  glist }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(gList, objs)}
  \FunctionTok{gTree}\NormalTok{(}\AttributeTok{children =}\NormalTok{ glist, }\AttributeTok{gp =}\NormalTok{ gp, }\AttributeTok{vp =}\NormalTok{ vp)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export zo}
\CommentTok{\#\textquotesingle{} @aliases zo}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{zo\}: ...}
\CommentTok{\#\textquotesingle{} @rdname ggather}
\NormalTok{zo }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, }\AttributeTok{w =}\NormalTok{ .}\DecValTok{9}\NormalTok{, }\AttributeTok{h =}\NormalTok{ .}\DecValTok{9}\NormalTok{) \{}
  \FunctionTok{ggather}\NormalTok{(x, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(, , w, h))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# arrow}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\#\textquotesingle{} @aliases arrow}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title draw arrow}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description ...}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name arrow}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @export .gpar\_dashed\_line}
\NormalTok{.gpar\_dashed\_line }\OtherTok{\textless{}{-}} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fill =} \StringTok{"black"}\NormalTok{, }\AttributeTok{lty =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{lwd =} \FunctionTok{unit}\NormalTok{(}\DecValTok{2}\NormalTok{, }\StringTok{"line"}\NormalTok{))}

\CommentTok{\#\textquotesingle{} @export .gpar\_dotted\_line}
\NormalTok{.gpar\_dotted\_line }\OtherTok{\textless{}{-}} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fill =} \StringTok{"black"}\NormalTok{, }\AttributeTok{lty =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{lwd =} \FunctionTok{unit}\NormalTok{(}\DecValTok{2}\NormalTok{, }\StringTok{"line"}\NormalTok{))}

\CommentTok{\#\textquotesingle{} @export parrow}
\CommentTok{\#\textquotesingle{} @aliases parrow}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{parrow\}: ...}
\CommentTok{\#\textquotesingle{} @rdname arrow}
\NormalTok{parrow }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(}\AttributeTok{n =} \DecValTok{5}\NormalTok{, col, }\AttributeTok{type =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{lwd =} \FunctionTok{u}\NormalTok{(}\DecValTok{1}\NormalTok{, line))\{}
\NormalTok{  y }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\AttributeTok{length.out =}\NormalTok{ n)[}\FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, }\SpecialCharTok{{-}}\NormalTok{n)]}
\NormalTok{  segs }\OtherTok{\textless{}{-}} \FunctionTok{segmentsGrob}\NormalTok{(}\FunctionTok{rep}\NormalTok{(.}\DecValTok{1}\NormalTok{, n }\SpecialCharTok{{-}} \DecValTok{2}\NormalTok{), y,}
    \FunctionTok{rep}\NormalTok{(.}\DecValTok{9}\NormalTok{, n }\SpecialCharTok{{-}} \DecValTok{2}\NormalTok{), y,}
    \AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{lwd =}\NormalTok{ lwd, }\AttributeTok{fill =}\NormalTok{ col, }\AttributeTok{col =}\NormalTok{ col, }\AttributeTok{lty =}\NormalTok{ type)}
\NormalTok{  )}
\NormalTok{  arrs }\OtherTok{\textless{}{-}} \FunctionTok{segmentsGrob}\NormalTok{(}\FunctionTok{rep}\NormalTok{(.}\DecValTok{8}\NormalTok{, n }\SpecialCharTok{{-}} \DecValTok{2}\NormalTok{), y,}
    \FunctionTok{rep}\NormalTok{(.}\DecValTok{9}\NormalTok{, n }\SpecialCharTok{{-}} \DecValTok{2}\NormalTok{), y,}
    \AttributeTok{arrow =} \FunctionTok{arrow}\NormalTok{(}\AttributeTok{angle =} \DecValTok{15}\NormalTok{, }\AttributeTok{length =} \FunctionTok{unit}\NormalTok{(.}\DecValTok{7}\NormalTok{, }\StringTok{"line"}\NormalTok{), }\AttributeTok{type =} \StringTok{"closed"}\NormalTok{),}
    \AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{lwd =}\NormalTok{ lwd, }\AttributeTok{fill =}\NormalTok{ col, }\AttributeTok{col =}\NormalTok{ col)}
\NormalTok{  )}
  \FunctionTok{ggather}\NormalTok{(segs, arrs)}
\NormalTok{\}}

\FunctionTok{setClassUnion}\NormalTok{(}\StringTok{"maybe\_p1p2"}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\StringTok{"null"}\NormalTok{, }\StringTok{"list"}\NormalTok{))}
\FunctionTok{setClassUnion}\NormalTok{(}\StringTok{"maybe\_function"}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\StringTok{"NULL"}\NormalTok{, }\StringTok{"function"}\NormalTok{))}
\FunctionTok{setClassUnion}\NormalTok{(}\StringTok{"maybe\_list"}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\StringTok{"NULL"}\NormalTok{, }\StringTok{"list"}\NormalTok{))}

\CommentTok{\#\textquotesingle{} @exportMethod garrow}
\CommentTok{\#\textquotesingle{} @aliases garrow}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{garrow\}: ...}
\CommentTok{\#\textquotesingle{} @rdname arrow}
\FunctionTok{setGeneric}\NormalTok{(}\StringTok{"garrow"}\NormalTok{, }
  \ControlFlowTok{function}\NormalTok{(p1, p2, args\_line, args\_arrow, fun\_line, fun\_arrow, city)}
    \FunctionTok{standardGeneric}\NormalTok{(}\StringTok{"garrow"}\NormalTok{))}

\CommentTok{\#\textquotesingle{} @exportMethod garrow}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"garrow"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{setMissing}\NormalTok{(}\StringTok{"garrow"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{()\{}
\NormalTok{    args\_line }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{square =}\NormalTok{ F, }\AttributeTok{ncp =} \DecValTok{10}\NormalTok{, }\AttributeTok{curvature =}\NormalTok{ .}\DecValTok{3}\NormalTok{,}
      \AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fill =} \StringTok{"black"}\NormalTok{))}
\NormalTok{    args\_arrow }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{angle =} \DecValTok{15}\NormalTok{, }\AttributeTok{length =} \FunctionTok{unit}\NormalTok{(.}\DecValTok{7}\NormalTok{, }\StringTok{"line"}\NormalTok{), }\AttributeTok{type =} \StringTok{"closed"}\NormalTok{)}
    \FunctionTok{list}\NormalTok{(}\AttributeTok{args\_line =}\NormalTok{ args\_line,}
      \AttributeTok{args\_arrow =}\NormalTok{ args\_arrow,}
      \AttributeTok{fun\_line =} \FunctionTok{match.fun}\NormalTok{(curveGrob),}
      \AttributeTok{fun\_arrow =} \FunctionTok{match.fun}\NormalTok{(arrow),}
      \AttributeTok{city =} \ConstantTok{NULL}
\NormalTok{    )}
\NormalTok{  \})}

\CommentTok{\#\textquotesingle{} @exportMethod garrow}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"garrow"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{p1 =} \StringTok{"maybe\_p1p2"}\NormalTok{, }\AttributeTok{p2 =} \StringTok{"maybe\_p1p2"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(p1, p2, args\_line, args\_arrow,}
\NormalTok{    fun\_line, fun\_arrow, city)\{}
\NormalTok{    args }\OtherTok{\textless{}{-}} \FunctionTok{as.list}\NormalTok{(}\FunctionTok{environment}\NormalTok{())}
\NormalTok{    default }\OtherTok{\textless{}{-}} \FunctionTok{garrow}\NormalTok{()}
\NormalTok{    args}\SpecialCharTok{$}\NormalTok{args\_line }\OtherTok{\textless{}{-}} \FunctionTok{.fresh\_param2}\NormalTok{(default}\SpecialCharTok{$}\NormalTok{args\_line, args\_line)}
\NormalTok{    args}\SpecialCharTok{$}\NormalTok{args\_arrow }\OtherTok{\textless{}{-}} \FunctionTok{.fresh\_param2}\NormalTok{(default}\SpecialCharTok{$}\NormalTok{args\_arrow, args\_arrow)}
\NormalTok{    args }\OtherTok{\textless{}{-}} \FunctionTok{.fresh\_param2}\NormalTok{(default, args)}
    \FunctionTok{reCallMethod}\NormalTok{(}\StringTok{"garrow"}\NormalTok{, args)}
\NormalTok{  \})}

\CommentTok{\#\textquotesingle{} @exportMethod garrow}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"garrow"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{p1 =} \StringTok{"null"}\NormalTok{, }\AttributeTok{p2 =} \StringTok{"null"}\NormalTok{,}
    \AttributeTok{args\_line =} \StringTok{"list"}\NormalTok{,}
    \AttributeTok{args\_arrow =} \StringTok{"list"}\NormalTok{,}
    \AttributeTok{fun\_line =} \StringTok{"maybe\_function"}\NormalTok{,}
    \AttributeTok{fun\_arrow =} \StringTok{"maybe\_function"}\NormalTok{,}
    \AttributeTok{city =} \StringTok{"maybe\_list"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(p1, p2, args\_line, args\_arrow,}
\NormalTok{    fun\_line, fun\_arrow, city)\{}
\NormalTok{    args }\OtherTok{\textless{}{-}} \FunctionTok{as.list}\NormalTok{(}\FunctionTok{environment}\NormalTok{())}
\NormalTok{    args}\SpecialCharTok{$}\NormalTok{p1 }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{x1 =} \FunctionTok{grobX}\NormalTok{(p1, }\DecValTok{0}\NormalTok{), }\AttributeTok{y1 =} \FunctionTok{grobY}\NormalTok{(p1, }\DecValTok{0}\NormalTok{))}
\NormalTok{    args}\SpecialCharTok{$}\NormalTok{p2 }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{x2 =} \FunctionTok{grobX}\NormalTok{(p2, }\DecValTok{0}\NormalTok{), }\AttributeTok{y2 =} \FunctionTok{grobY}\NormalTok{(p2, }\DecValTok{0}\NormalTok{))}
    \FunctionTok{reCallMethod}\NormalTok{(}\StringTok{"garrow"}\NormalTok{, args)}
\NormalTok{  \})}

\CommentTok{\#\textquotesingle{} @exportMethod garrow}
\FunctionTok{setMethod}\NormalTok{(}\StringTok{"garrow"}\NormalTok{, }
  \AttributeTok{signature =} \FunctionTok{c}\NormalTok{(}\AttributeTok{p1 =} \StringTok{"list"}\NormalTok{, }\AttributeTok{p2 =} \StringTok{"list"}\NormalTok{,}
    \AttributeTok{args\_line =} \StringTok{"list"}\NormalTok{,}
    \AttributeTok{args\_arrow =} \StringTok{"list"}\NormalTok{,}
    \AttributeTok{fun\_line =} \StringTok{"maybe\_function"}\NormalTok{,}
    \AttributeTok{fun\_arrow =} \StringTok{"maybe\_function"}\NormalTok{,}
    \AttributeTok{city =} \StringTok{"maybe\_list"}\NormalTok{),}
  \ControlFlowTok{function}\NormalTok{(p1, p2, args\_line, args\_arrow,}
\NormalTok{    fun\_line, fun\_arrow, city)\{}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(fun\_arrow))}
\NormalTok{      args\_line}\SpecialCharTok{$}\NormalTok{arrow }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(fun\_arrow, args\_arrow)}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(city)) \{}
\NormalTok{      city }\OtherTok{\textless{}{-}} \FunctionTok{.fresh\_param2}\NormalTok{(}\FunctionTok{garrow\_city\_args}\NormalTok{(), city)}
\NormalTok{      e }\OtherTok{\textless{}{-}} \FunctionTok{segmentsGrob}\NormalTok{(p1}\SpecialCharTok{$}\NormalTok{x1, p1}\SpecialCharTok{$}\NormalTok{y1, p2}\SpecialCharTok{$}\NormalTok{x2, p2}\SpecialCharTok{$}\NormalTok{y2)}
      \ControlFlowTok{if}\NormalTok{ (city}\SpecialCharTok{$}\NormalTok{axis }\SpecialCharTok{==} \StringTok{"x"}\NormalTok{) \{}
\NormalTok{        pm }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{x =}\NormalTok{ p1}\SpecialCharTok{$}\NormalTok{x1 }\SpecialCharTok{+}\NormalTok{ city}\SpecialCharTok{$}\NormalTok{shift, }\AttributeTok{y =} \FunctionTok{grobY}\NormalTok{(e, }\DecValTok{0}\NormalTok{))}
\NormalTok{      \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (city}\SpecialCharTok{$}\NormalTok{axis }\SpecialCharTok{==} \StringTok{"y"}\NormalTok{) \{}
\NormalTok{        pm }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \FunctionTok{grobX}\NormalTok{(e, }\DecValTok{90}\NormalTok{), }\AttributeTok{y =}\NormalTok{ p1}\SpecialCharTok{$}\NormalTok{y1 }\SpecialCharTok{+}\NormalTok{ city}\SpecialCharTok{$}\NormalTok{shift)}
\NormalTok{      \} }\ControlFlowTok{else}\NormalTok{ \{}
        \FunctionTok{stop}\NormalTok{(}\StringTok{"city$axis != x \& city$axis != y"}\NormalTok{)}
\NormalTok{      \}}
\NormalTok{      args\_line }\OtherTok{\textless{}{-}} \FunctionTok{.fresh\_param2}\NormalTok{(args\_line, city}\SpecialCharTok{$}\NormalTok{args\_line)}
\NormalTok{      args\_line\_mid }\OtherTok{\textless{}{-}}\NormalTok{ args\_line[}\FunctionTok{names}\NormalTok{(args\_line) }\SpecialCharTok{!=} \StringTok{"arrow"}\NormalTok{]}
      \FunctionTok{names}\NormalTok{(pm) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"x2"}\NormalTok{, }\StringTok{"y2"}\NormalTok{)}
\NormalTok{      a1 }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(fun\_line, }\FunctionTok{c}\NormalTok{(p1, pm, args\_line\_mid))}
      \FunctionTok{names}\NormalTok{(pm) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"x1"}\NormalTok{, }\StringTok{"y1"}\NormalTok{)}
      \ControlFlowTok{if}\NormalTok{ (city}\SpecialCharTok{$}\NormalTok{rev) \{}
\NormalTok{        args\_line}\SpecialCharTok{$}\NormalTok{curvature }\OtherTok{\textless{}{-}} \SpecialCharTok{{-}}\NormalTok{(args\_line}\SpecialCharTok{$}\NormalTok{curvature)}
\NormalTok{      \}}
\NormalTok{      a2 }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(fun\_line, }\FunctionTok{c}\NormalTok{(pm, p2, args\_line))}
      \DocumentationTok{\#\# as graph}
\NormalTok{      vp }\OtherTok{\textless{}{-}} \FunctionTok{viewport}\NormalTok{(pm}\SpecialCharTok{$}\NormalTok{x, pm}\SpecialCharTok{$}\NormalTok{y, .}\DecValTok{1} \SpecialCharTok{*} \FunctionTok{grobHeight}\NormalTok{(e), .}\DecValTok{1} \SpecialCharTok{*} \FunctionTok{grobHeight}\NormalTok{(e))}
      \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(city}\SpecialCharTok{$}\NormalTok{grob\_anno)) \{}
        \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(city}\SpecialCharTok{$}\NormalTok{vp\_anno)) \{}
\NormalTok{          vp }\OtherTok{\textless{}{-}} \FunctionTok{vpStack}\NormalTok{(vp, city}\SpecialCharTok{$}\NormalTok{vp\_anno)}
\NormalTok{        \}}
\NormalTok{        anno }\OtherTok{\textless{}{-}} \FunctionTok{ggather}\NormalTok{(city}\SpecialCharTok{$}\NormalTok{grob\_anno, }\AttributeTok{vp =}\NormalTok{ vp)}
        \FunctionTok{return}\NormalTok{(}\FunctionTok{ggather}\NormalTok{(a1, a2, anno))}
\NormalTok{      \}}
      \FunctionTok{return}\NormalTok{(}\FunctionTok{graph}\NormalTok{(}\AttributeTok{grob =} \FunctionTok{ggather}\NormalTok{(a1, a2), }\AttributeTok{cvp =}\NormalTok{ vp))}
\NormalTok{    \}}
\NormalTok{    args\_line }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(p1, p2, args\_line)}
    \FunctionTok{do.call}\NormalTok{(fun\_line, args\_line)}
\NormalTok{  \})}

\CommentTok{\#\textquotesingle{} @export garrow\_city}
\CommentTok{\#\textquotesingle{} @aliases garrow\_city}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{garrow\_city\}: ...}
\CommentTok{\#\textquotesingle{} @rdname arrow}
\NormalTok{garrow\_city }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(p1, p2, up, left, shift, gp\_line)\{}
\NormalTok{  shift }\OtherTok{\textless{}{-}} \FunctionTok{abs}\NormalTok{(shift)}
\NormalTok{  curvature }\OtherTok{\textless{}{-}} \DecValTok{1}
  \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\NormalTok{up }\SpecialCharTok{\&}\NormalTok{ left) \{}
\NormalTok{    shift }\OtherTok{\textless{}{-}} \SpecialCharTok{{-}}\NormalTok{shift}
\NormalTok{  \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\NormalTok{up }\SpecialCharTok{\&} \SpecialCharTok{!}\NormalTok{left) \{}
\NormalTok{    curvature }\OtherTok{\textless{}{-}} \SpecialCharTok{{-}}\DecValTok{1}
\NormalTok{  \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (up }\SpecialCharTok{\&}\NormalTok{ left) \{}
\NormalTok{    curvature }\OtherTok{\textless{}{-}} \SpecialCharTok{{-}}\DecValTok{1}
\NormalTok{    shift }\OtherTok{\textless{}{-}} \SpecialCharTok{{-}}\NormalTok{shift}
\NormalTok{  \}}
\NormalTok{  args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{curvature =}\NormalTok{ curvature,}
    \AttributeTok{square =}\NormalTok{ T,}
    \AttributeTok{ncp =} \DecValTok{1}\NormalTok{)}
  \FunctionTok{garrow}\NormalTok{(p1, p2, }\FunctionTok{list}\NormalTok{(}\AttributeTok{gp =}\NormalTok{ gp\_line), }
    \AttributeTok{city =} \FunctionTok{list}\NormalTok{(}\AttributeTok{args\_line =}\NormalTok{ args, }\AttributeTok{shift =}\NormalTok{ shift))}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export garrow\_snake}
\CommentTok{\#\textquotesingle{} @aliases garrow\_snake}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{garrow\_snake\}: ...}
\CommentTok{\#\textquotesingle{} @rdname arrow}
\NormalTok{garrow\_snake }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(p1, p2, color, }\AttributeTok{lwd =} \FunctionTok{u}\NormalTok{(}\DecValTok{1}\NormalTok{, line), }\AttributeTok{cur =} \DecValTok{1}\NormalTok{)\{}
  \FunctionTok{garrow}\NormalTok{(p1, p2, }\FunctionTok{list}\NormalTok{(}\AttributeTok{curvature =}\NormalTok{ cur, }\AttributeTok{square =}\NormalTok{ T, }\AttributeTok{ncp =} \DecValTok{1}\NormalTok{, }\AttributeTok{inflect =}\NormalTok{ T,}
      \AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{lwd =}\NormalTok{ lwd, }\AttributeTok{col =}\NormalTok{ color, }\AttributeTok{fill =}\NormalTok{ color)))}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export garrow\_city\_args}
\CommentTok{\#\textquotesingle{} @aliases garrow\_city\_args}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{garrow\_city\_args\}: ...}
\CommentTok{\#\textquotesingle{} @rdname arrow}
\NormalTok{garrow\_city\_args }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(}\AttributeTok{shift =} \FunctionTok{u}\NormalTok{(}\DecValTok{2}\NormalTok{, line), }\AttributeTok{axis =} \StringTok{"x"}\NormalTok{, }\AttributeTok{mid =}\NormalTok{ .}\DecValTok{5}\NormalTok{,}
    \AttributeTok{args\_line =} \FunctionTok{list}\NormalTok{(}\AttributeTok{ncp =} \DecValTok{1}\NormalTok{, }\AttributeTok{curvature =} \DecValTok{1}\NormalTok{, }\AttributeTok{square =}\NormalTok{ T),}
    \AttributeTok{grob\_anno =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{vp\_anno =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{rev =}\NormalTok{ F}
\NormalTok{    )\{}
    \FunctionTok{as.list}\NormalTok{(}\FunctionTok{environment}\NormalTok{())}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export sagnage}
\CommentTok{\#\textquotesingle{} @aliases sagnage}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{sagnage\}: ...}
\CommentTok{\#\textquotesingle{} @rdname arrow}
\NormalTok{sagnage }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(grob, }\AttributeTok{left =}\NormalTok{ T, l\_gpar, }\AttributeTok{borderF =} \FloatTok{1.5}\NormalTok{, }\AttributeTok{front\_len =}\NormalTok{ .}\DecValTok{1}\NormalTok{,}
  \AttributeTok{vp\_shift =} \FunctionTok{u}\NormalTok{(}\FloatTok{1.5}\NormalTok{, line), ...)\{}
\NormalTok{  l\_gpar }\OtherTok{\textless{}{-}} \FunctionTok{.fresh\_param2f}\NormalTok{(}\FunctionTok{gpar}\NormalTok{(}\AttributeTok{linejoin =} \StringTok{"round"}\NormalTok{, }\AttributeTok{fill =} \StringTok{"grey85"}\NormalTok{,}
      \AttributeTok{col =} \StringTok{"transparent"}\NormalTok{), l\_gpar)}
\NormalTok{  w }\OtherTok{\textless{}{-}} \FunctionTok{grobWidth}\NormalTok{(grob) }\SpecialCharTok{*}\NormalTok{ borderF}
\NormalTok{  h }\OtherTok{\textless{}{-}} \FunctionTok{grobHeight}\NormalTok{(grob) }\SpecialCharTok{*}\NormalTok{ borderF}
\NormalTok{  vp }\OtherTok{\textless{}{-}} \FunctionTok{viewport}\NormalTok{(, , w }\SpecialCharTok{*}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{+}\NormalTok{ front\_len), h)}
\NormalTok{  shift }\OtherTok{\textless{}{-}}\NormalTok{ front\_len }\SpecialCharTok{/}\NormalTok{ (front\_len }\SpecialCharTok{+} \DecValTok{1}\NormalTok{)}
\NormalTok{  cw }\OtherTok{\textless{}{-}} \DecValTok{1} \SpecialCharTok{/}\NormalTok{ (front\_len }\SpecialCharTok{+} \DecValTok{1}\NormalTok{)}
  \ControlFlowTok{if}\NormalTok{ (left) \{}
\NormalTok{    poly }\OtherTok{\textless{}{-}} \FunctionTok{polygonGrob}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, front\_len, }\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{, front\_len), }\FunctionTok{c}\NormalTok{(.}\DecValTok{5}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{),}
      \AttributeTok{vp =}\NormalTok{ vp, }\AttributeTok{gp =}\NormalTok{ l\_gpar)}
\NormalTok{    cvp }\OtherTok{\textless{}{-}} \FunctionTok{viewport}\NormalTok{(.}\DecValTok{5} \SpecialCharTok{+}\NormalTok{ shift, }\AttributeTok{width =}\NormalTok{ cw)}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    poly }\OtherTok{\textless{}{-}} \FunctionTok{polygonGrob}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ front\_len, }\DecValTok{1}\NormalTok{, }\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ front\_len),}
      \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{, .}\DecValTok{5}\NormalTok{, }\DecValTok{0}\NormalTok{), }\AttributeTok{vp =}\NormalTok{ vp, }\AttributeTok{gp =}\NormalTok{ l\_gpar)}
\NormalTok{    cvp }\OtherTok{\textless{}{-}} \FunctionTok{viewport}\NormalTok{(.}\DecValTok{5} \SpecialCharTok{{-}}\NormalTok{ shift, }\AttributeTok{width =}\NormalTok{ cw)}
\NormalTok{  \}}
\NormalTok{  ggrob }\OtherTok{\textless{}{-}} \FunctionTok{into}\NormalTok{(}\FunctionTok{graph}\NormalTok{(}\AttributeTok{grob =}\NormalTok{ poly, }\AttributeTok{cvp =} \FunctionTok{vpStack}\NormalTok{(vp, cvp)), grob)}
  \ControlFlowTok{if}\NormalTok{ (left) \{}
\NormalTok{    vp }\OtherTok{\textless{}{-}} \FunctionTok{viewport}\NormalTok{(vp\_shift, }\AttributeTok{just =} \FunctionTok{c}\NormalTok{(}\StringTok{"left"}\NormalTok{, }\StringTok{"centre"}\NormalTok{))}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    vp }\OtherTok{\textless{}{-}} \FunctionTok{viewport}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{vp\_shift, }\AttributeTok{just =} \FunctionTok{c}\NormalTok{(}\StringTok{"left"}\NormalTok{, }\StringTok{"centre"}\NormalTok{))}
\NormalTok{  \}}
  \FunctionTok{c}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{grob\_anno =}\NormalTok{ ggrob, }\AttributeTok{vp\_anno =}\NormalTok{ vp), }\FunctionTok{list}\NormalTok{(...))}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export sagnage\_shiny}
\CommentTok{\#\textquotesingle{} @aliases sagnage\_shiny}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{sagnage\_shiny\}: ...}
\CommentTok{\#\textquotesingle{} @rdname arrow}
\NormalTok{sagnage\_shiny }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(label, left, color)\{}
  \FunctionTok{sagnage}\NormalTok{(}\FunctionTok{gtext}\NormalTok{(label, }\FunctionTok{gpar}\NormalTok{(}\AttributeTok{col =} \StringTok{"white"}\NormalTok{, }\AttributeTok{fontface =} \StringTok{"plain"}\NormalTok{)), }
\NormalTok{    left, }\FunctionTok{gpar}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ color))}\SpecialCharTok{$}\NormalTok{grob\_anno}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export maparrow}
\CommentTok{\#\textquotesingle{} @aliases maparrow}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{maparrow\}: ...}
\CommentTok{\#\textquotesingle{} @rdname arrow}
\NormalTok{maparrow }\OtherTok{\textless{}{-}}
  \ControlFlowTok{function}\NormalTok{(obj, data, }\AttributeTok{pattern =} \FunctionTok{list}\NormalTok{(), }\AttributeTok{round\_cur =}\NormalTok{ .}\DecValTok{3}\NormalTok{,}
    \AttributeTok{pos =} \FunctionTok{list}\NormalTok{(}\AttributeTok{r =} \FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \DecValTok{1}\NormalTok{), }\AttributeTok{l =} \FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \DecValTok{0}\NormalTok{),}
      \AttributeTok{t =} \FunctionTok{list}\NormalTok{(}\AttributeTok{y =} \DecValTok{1}\NormalTok{), }\AttributeTok{b =} \FunctionTok{list}\NormalTok{(}\AttributeTok{y =} \DecValTok{0}\NormalTok{))}
\NormalTok{    )\{}
    \FunctionTok{.check\_columns}\NormalTok{(data, }\FunctionTok{c}\NormalTok{(}\StringTok{"from"}\NormalTok{, }\StringTok{"to"}\NormalTok{, }\StringTok{"group"}\NormalTok{, }\StringTok{"fun"}\NormalTok{, }\StringTok{"color"}\NormalTok{, }\StringTok{"left"}\NormalTok{, }\StringTok{"up"}\NormalTok{,}
        \StringTok{"shift"}\NormalTok{), }\StringTok{"data"}\NormalTok{)}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{dup))}
\NormalTok{      data}\SpecialCharTok{$}\NormalTok{dup }\OtherTok{\textless{}{-}} \FunctionTok{duplicated}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{group)}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{sag))}
\NormalTok{      data}\SpecialCharTok{$}\NormalTok{sag }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{substr}\NormalTok{(}\FunctionTok{form}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{fun), }\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{), }\StringTok{"."}\NormalTok{)}
\NormalTok{    target }\OtherTok{\textless{}{-}} \FunctionTok{unique}\NormalTok{(}\FunctionTok{c}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{from, data}\SpecialCharTok{$}\NormalTok{to))}
\NormalTok{    nulls }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(target, }\AttributeTok{simplify =}\NormalTok{ F,}
      \ControlFlowTok{function}\NormalTok{(name) \{}
\NormalTok{        pattern }\OtherTok{\textless{}{-}} 
          \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(pattern[[ name ]]))}
\NormalTok{            pattern[[ name ]]}
          \ControlFlowTok{else}
\NormalTok{            name}
        \FunctionTok{sapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(pos), }\AttributeTok{simplify =}\NormalTok{ F,}
          \ControlFlowTok{function}\NormalTok{(p)\{}
            \FunctionTok{setnullvp}\NormalTok{(pattern, pos[[p]], obj)}
\NormalTok{          \})}
\NormalTok{      \})}
\NormalTok{    bafs }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(target, }\AttributeTok{simplify =}\NormalTok{ F,}
      \ControlFlowTok{function}\NormalTok{(name) \{}
\NormalTok{        null }\OtherTok{\textless{}{-}}\NormalTok{ nulls[[ name ]]}
\NormalTok{        null }\OtherTok{\textless{}{-}}\NormalTok{ null[}\FunctionTok{names}\NormalTok{(null) }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"l"}\NormalTok{, }\StringTok{"r"}\NormalTok{)]}
        \FunctionTok{lapply}\NormalTok{(null, }\ControlFlowTok{function}\NormalTok{(null) \{}
          \ControlFlowTok{function}\NormalTok{(}\AttributeTok{w =} \FunctionTok{u}\NormalTok{(}\DecValTok{1}\NormalTok{, line), }\AttributeTok{h =} \FunctionTok{u}\NormalTok{(}\DecValTok{3}\NormalTok{, line)) \{}
            \FunctionTok{baf}\NormalTok{(}\FunctionTok{grobX}\NormalTok{(null, }\DecValTok{0}\NormalTok{), }\FunctionTok{grobY}\NormalTok{(null, }\DecValTok{0}\NormalTok{), w, h)}
\NormalTok{          \}}
\NormalTok{          \})}
\NormalTok{      \})}
\NormalTok{    bafs }\OtherTok{\textless{}{-}} \FunctionTok{unlist}\NormalTok{(bafs, F)}
\NormalTok{    keep }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"from"}\NormalTok{, }\StringTok{"to"}\NormalTok{),}
      \ControlFlowTok{function}\NormalTok{(ch) \{}
\NormalTok{        pos }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(data[[ }\StringTok{"left"}\NormalTok{ ]], }\StringTok{"l"}\NormalTok{, }\StringTok{"r"}\NormalTok{)}
        \FunctionTok{paste0}\NormalTok{(data[[ ch ]], }\StringTok{"."}\NormalTok{, pos)}
\NormalTok{      \})}
\NormalTok{    bafs }\OtherTok{\textless{}{-}}\NormalTok{ bafs[}\FunctionTok{names}\NormalTok{(bafs) }\SpecialCharTok{\%in\%} \FunctionTok{unique}\NormalTok{(}\FunctionTok{unlist}\NormalTok{(keep))]}
\NormalTok{    arr\_city }\OtherTok{\textless{}{-}} \FunctionTok{apply}\NormalTok{(data, }\DecValTok{1}\NormalTok{, }\AttributeTok{simplify =}\NormalTok{ F,}
      \ControlFlowTok{function}\NormalTok{(v) \{}
\NormalTok{        pos }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(}\FunctionTok{as.logical}\NormalTok{(v[[ }\StringTok{"left"}\NormalTok{ ]]), }\StringTok{"l"}\NormalTok{, }\StringTok{"r"}\NormalTok{)}
        \FunctionTok{garrow\_city}\NormalTok{(nulls[[ v[[}\StringTok{"from"}\NormalTok{]] ]][[ pos ]],}
\NormalTok{          nulls[[ v[[}\StringTok{"to"}\NormalTok{]] ]][[ pos ]],}
          \FunctionTok{as.logical}\NormalTok{(v[[ }\StringTok{"up"}\NormalTok{ ]]), }\FunctionTok{as.logical}\NormalTok{(v[[ }\StringTok{"left"}\NormalTok{ ]]),}
          \FunctionTok{u}\NormalTok{(}\FunctionTok{as.numeric}\NormalTok{(v[[}\StringTok{"shift"}\NormalTok{]]), line),}
          \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ v[[}\StringTok{"color"}\NormalTok{]], }\AttributeTok{col =}\NormalTok{ v[[}\StringTok{"color"}\NormalTok{]],}
            \AttributeTok{lwd =} \FunctionTok{u}\NormalTok{(}\DecValTok{1}\NormalTok{, line))}
\NormalTok{        )}
\NormalTok{      \})}
\NormalTok{    arr\_round }\OtherTok{\textless{}{-}} \FunctionTok{apply}\NormalTok{(data, }\DecValTok{1}\NormalTok{, }\AttributeTok{simplify =}\NormalTok{ F,}
      \ControlFlowTok{function}\NormalTok{(v) \{}
\NormalTok{        pos }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(}\FunctionTok{as.logical}\NormalTok{(v[[ }\StringTok{"left"}\NormalTok{ ]]), }\StringTok{"l"}\NormalTok{, }\StringTok{"r"}\NormalTok{)}
\NormalTok{        cur }\OtherTok{\textless{}{-}} \ControlFlowTok{if}\NormalTok{ (pos }\SpecialCharTok{==} \StringTok{"l"}\NormalTok{) round\_cur }\ControlFlowTok{else} \SpecialCharTok{{-}}\NormalTok{round\_cur}
\NormalTok{        cur }\OtherTok{\textless{}{-}} \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{as.logical}\NormalTok{(v[[ }\StringTok{"up"}\NormalTok{ ]])) }\SpecialCharTok{{-}}\NormalTok{cur }\ControlFlowTok{else}\NormalTok{ cur}
        \FunctionTok{garrow}\NormalTok{(nulls[[ v[[}\StringTok{"from"}\NormalTok{]] ]][[ pos ]],}
\NormalTok{          nulls[[ v[[}\StringTok{"to"}\NormalTok{]] ]][[ pos ]],}
          \FunctionTok{list}\NormalTok{(}\AttributeTok{curvature =}\NormalTok{ cur,}
            \AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ v[[}\StringTok{"color"}\NormalTok{]], }\AttributeTok{col =}\NormalTok{ v[[}\StringTok{"color"}\NormalTok{]],}
              \AttributeTok{lwd =} \FunctionTok{u}\NormalTok{(}\DecValTok{1}\NormalTok{, line)))}
\NormalTok{        )}
\NormalTok{      \})}
\NormalTok{    sags }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(arr\_city),}
      \ControlFlowTok{function}\NormalTok{(n) \{}
        \ControlFlowTok{if}\NormalTok{ (data}\SpecialCharTok{$}\NormalTok{dup[[n]]) }\FunctionTok{return}\NormalTok{()}
\NormalTok{        left }\OtherTok{\textless{}{-}} \SpecialCharTok{!}\NormalTok{data}\SpecialCharTok{$}\NormalTok{left[[n]]}
\NormalTok{        up }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{up[[n]]}
\NormalTok{        col }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{color[[n]]}
\NormalTok{        gtext }\OtherTok{\textless{}{-}} \FunctionTok{gtext}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{sag[[n]], }\FunctionTok{gpar}\NormalTok{(}\AttributeTok{col =} \StringTok{"white"}\NormalTok{, }\AttributeTok{fontface =} \StringTok{"plain"}\NormalTok{))}
\NormalTok{        sag }\OtherTok{\textless{}{-}} \FunctionTok{sagnage}\NormalTok{(gtext, left, }\FunctionTok{gpar}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ col), }\FloatTok{1.5}\NormalTok{)}\SpecialCharTok{$}\NormalTok{grob\_anno}
\NormalTok{        vp }\OtherTok{\textless{}{-}}\NormalTok{ arr\_city[[n]]}\SpecialCharTok{@}\NormalTok{cvp}
\NormalTok{        x }\OtherTok{\textless{}{-}} \ControlFlowTok{if}\NormalTok{ (left) }\FunctionTok{u}\NormalTok{(.}\DecValTok{5}\NormalTok{, npc) }\SpecialCharTok{+} \FunctionTok{u}\NormalTok{(}\DecValTok{2}\NormalTok{, line) }\ControlFlowTok{else} \FunctionTok{u}\NormalTok{(.}\DecValTok{5}\NormalTok{, npc) }\SpecialCharTok{{-}} \FunctionTok{u}\NormalTok{(}\DecValTok{2}\NormalTok{, line)}
\NormalTok{        y }\OtherTok{\textless{}{-}} \ControlFlowTok{if}\NormalTok{ (up) .}\DecValTok{5} \SpecialCharTok{+} \DecValTok{5} \ControlFlowTok{else}\NormalTok{ .}\DecValTok{5} \SpecialCharTok{{-}}\DecValTok{5}
\NormalTok{        vp }\OtherTok{\textless{}{-}} \FunctionTok{vpStack}\NormalTok{(vp, }\FunctionTok{viewport}\NormalTok{(x, y))}
        \FunctionTok{ggather}\NormalTok{(sag, }\AttributeTok{vp =}\NormalTok{ vp)}
\NormalTok{      \})}
\NormalTok{    sags }\OtherTok{\textless{}{-}}\NormalTok{ sags[}\SpecialCharTok{!}\FunctionTok{vapply}\NormalTok{(sags, is.null, T)]}
    \FunctionTok{namel}\NormalTok{(nulls, bafs, arr\_city, arr\_round, sags, data)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export baf}
\NormalTok{baf }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, y, }\AttributeTok{width =} \FunctionTok{u}\NormalTok{(}\DecValTok{1}\NormalTok{, line), }\AttributeTok{height =} \FunctionTok{u}\NormalTok{(}\DecValTok{3}\NormalTok{, line)) \{}
\NormalTok{  rect }\OtherTok{\textless{}{-}} \FunctionTok{grectn}\NormalTok{(}\AttributeTok{bgp\_args =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{lty =} \StringTok{"solid"}\NormalTok{))}\SpecialCharTok{@}\NormalTok{grob}
\NormalTok{  clip }\OtherTok{\textless{}{-}} \FunctionTok{clipGrob}\NormalTok{(, , .}\DecValTok{7}\NormalTok{)}
  \FunctionTok{ggather}\NormalTok{(clip, rect, }\AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(x, y, width, height))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# text}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\#\textquotesingle{} @aliases text}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title a mutate of grid::textGrob}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description ...}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name text}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @export .font}
\NormalTok{.font }\OtherTok{\textless{}{-}} \StringTok{"Times"}

\CommentTok{\#\textquotesingle{} @export .title\_gp}
\NormalTok{.title\_gp }\OtherTok{\textless{}{-}} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{col =} \StringTok{"black"}\NormalTok{, }\AttributeTok{cex =} \DecValTok{1}\NormalTok{, }\AttributeTok{fontfamily =}\NormalTok{ .font, }\AttributeTok{fontface =} \StringTok{"bold"}\NormalTok{)}

\CommentTok{\#\textquotesingle{} @export gtext}
\CommentTok{\#\textquotesingle{} @aliases gtext}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{gtext\}: ...}
\CommentTok{\#\textquotesingle{} @rdname text}
\NormalTok{gtext }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(label, gp\_arg, }\AttributeTok{form =}\NormalTok{ T, ...)\{}
\NormalTok{  args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(...)}
\NormalTok{  args }\OtherTok{\textless{}{-}} \FunctionTok{.fresh\_param2}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{y =} \FloatTok{0.5}\NormalTok{), args)}
\NormalTok{  args}\SpecialCharTok{$}\NormalTok{label }\OtherTok{\textless{}{-}} \ControlFlowTok{if}\NormalTok{ (form) }\FunctionTok{form}\NormalTok{(label) }\ControlFlowTok{else}\NormalTok{ label}
\NormalTok{  args}\SpecialCharTok{$}\NormalTok{gp }\OtherTok{\textless{}{-}} \FunctionTok{.fresh\_param2f}\NormalTok{(.title\_gp, gp\_arg)}
  \FunctionTok{do.call}\NormalTok{(textGrob, args)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export gtextp}
\CommentTok{\#\textquotesingle{} @aliases gtextp}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{gtextp\}: ...}
\CommentTok{\#\textquotesingle{} @rdname text}
\NormalTok{gtextp }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(label, gp\_arg, }\AttributeTok{form =}\NormalTok{ T, ...)\{}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{missing}\NormalTok{(gp\_arg))}
\NormalTok{    gp\_arg }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
\NormalTok{  gp\_arg}\SpecialCharTok{$}\NormalTok{font }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\AttributeTok{plain =} \DecValTok{1}\NormalTok{)}
  \FunctionTok{gtext}\NormalTok{(label, gp\_arg, form, ...)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export gtext0}
\CommentTok{\#\textquotesingle{} @aliases gtext0}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{gtext0\}: ...}
\CommentTok{\#\textquotesingle{} @rdname text}
\NormalTok{gtext0 }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(label, gp\_arg, }\AttributeTok{form =}\NormalTok{ T, ...) \{}
  \FunctionTok{gtext}\NormalTok{(label, gp\_arg, form, }\AttributeTok{x =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{0}\NormalTok{, ...)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export form}
\CommentTok{\#\textquotesingle{} @aliases form}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{form\}: ...}
\CommentTok{\#\textquotesingle{} @rdname text}
\NormalTok{form }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(label)\{}
\NormalTok{  Hmisc}\SpecialCharTok{::}\FunctionTok{capitalize}\NormalTok{(}\FunctionTok{gsub}\NormalTok{(}\StringTok{"\_"}\NormalTok{, }\StringTok{" "}\NormalTok{,  label))}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export gltext}
\CommentTok{\#\textquotesingle{} @aliases gltext}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{gltext\}: ...}
\CommentTok{\#\textquotesingle{} @rdname text}
\NormalTok{gltext }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(label, }\AttributeTok{gp\_arg =} \FunctionTok{list}\NormalTok{(), }\AttributeTok{args =} \FunctionTok{list}\NormalTok{(),}
  \AttributeTok{l\_gp =}\NormalTok{ .gpar\_dotted\_line, }\AttributeTok{flip =}\NormalTok{ F, }\AttributeTok{borderF =} \FloatTok{1.2}\NormalTok{)\{}
  \ControlFlowTok{if}\NormalTok{ (flip) args}\SpecialCharTok{$}\NormalTok{rot }\OtherTok{\textless{}{-}} \DecValTok{90}
\NormalTok{  title }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(gtext, }\FunctionTok{c}\NormalTok{(}\FunctionTok{list}\NormalTok{(label, gp\_arg), args))}
  \ControlFlowTok{if}\NormalTok{ (flip) \{}
\NormalTok{    height }\OtherTok{\textless{}{-}} \FunctionTok{grobHeight}\NormalTok{(title) }\SpecialCharTok{*}\NormalTok{ borderF}
\NormalTok{    seg }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(.}\DecValTok{5}\NormalTok{, }\DecValTok{0}\NormalTok{, .}\DecValTok{5}\NormalTok{, }\FunctionTok{u}\NormalTok{(.}\DecValTok{5}\NormalTok{, npc) }\SpecialCharTok{{-}}\NormalTok{ height }\SpecialCharTok{/} \DecValTok{2}\NormalTok{)}
\NormalTok{    seg. }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(.}\DecValTok{5}\NormalTok{, }\DecValTok{1}\NormalTok{, .}\DecValTok{5}\NormalTok{, }\FunctionTok{u}\NormalTok{(.}\DecValTok{5}\NormalTok{, npc) }\SpecialCharTok{+}\NormalTok{ height }\SpecialCharTok{/} \DecValTok{2}\NormalTok{)}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    width }\OtherTok{\textless{}{-}} \FunctionTok{grobWidth}\NormalTok{(title) }\SpecialCharTok{*}\NormalTok{ borderF}
\NormalTok{    seg }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\DecValTok{0}\NormalTok{, .}\DecValTok{5}\NormalTok{, }\FunctionTok{u}\NormalTok{(.}\DecValTok{5}\NormalTok{, npc) }\SpecialCharTok{{-}}\NormalTok{ width }\SpecialCharTok{/} \DecValTok{2}\NormalTok{, .}\DecValTok{5}\NormalTok{)}
\NormalTok{    seg. }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\DecValTok{1}\NormalTok{, .}\DecValTok{5}\NormalTok{, }\FunctionTok{u}\NormalTok{(.}\DecValTok{5}\NormalTok{, npc) }\SpecialCharTok{+}\NormalTok{ width }\SpecialCharTok{/} \DecValTok{2}\NormalTok{, .}\DecValTok{5}\NormalTok{)}
\NormalTok{  \}}
\NormalTok{  line }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(segmentsGrob, }\FunctionTok{c}\NormalTok{(seg, }\FunctionTok{list}\NormalTok{(}\AttributeTok{gp =}\NormalTok{ l\_gp)))}
\NormalTok{  line. }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(segmentsGrob, }\FunctionTok{c}\NormalTok{(seg., }\FunctionTok{list}\NormalTok{(}\AttributeTok{gp =}\NormalTok{ l\_gp)))}
  \FunctionTok{ggather}\NormalTok{(title, line, line.)}
\NormalTok{\}}

\CommentTok{\# grid.draw(gtext("test", list(cex = 5)))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# rect}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\#\textquotesingle{} @aliases rect}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title a mutate of grid::rectGrob}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description ...}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name rect}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @export .rect\_gp}
\NormalTok{.rect\_gp }\OtherTok{\textless{}{-}} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fill =} \StringTok{"transparent"}\NormalTok{)}
\CommentTok{\#\textquotesingle{} @export .rect.r}
\NormalTok{.rect.r }\OtherTok{\textless{}{-}} \FunctionTok{unit}\NormalTok{(}\FloatTok{0.3}\NormalTok{, }\StringTok{"lines"}\NormalTok{)}
\CommentTok{\#\textquotesingle{} @export .vp.sep}
\NormalTok{.vp.sep }\OtherTok{\textless{}{-}} \FunctionTok{unit}\NormalTok{(}\FloatTok{0.25}\NormalTok{, }\StringTok{"lines"}\NormalTok{)}

\CommentTok{\#\textquotesingle{} @export .grecti.vp.p}
\NormalTok{.grecti.vp.p }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{width =} \FunctionTok{unit}\NormalTok{(}\DecValTok{1}\NormalTok{, }\StringTok{"npc"}\NormalTok{) }\SpecialCharTok{{-}}\NormalTok{ .vp.sep,}
  \AttributeTok{height =} \FunctionTok{unit}\NormalTok{(}\DecValTok{1}\NormalTok{, }\StringTok{"npc"}\NormalTok{) }\SpecialCharTok{{-}}\NormalTok{ .vp.sep,}
  \AttributeTok{clip =} \StringTok{"on"}\NormalTok{)}
\CommentTok{\#\textquotesingle{} @export .grecti.vp}
\NormalTok{.grecti.vp }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(viewport, .grecti.vp.p)}
\CommentTok{\#\textquotesingle{} @export .grecto.vp}
\NormalTok{.grecto.vp }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(viewport, }\FunctionTok{.fresh\_param2}\NormalTok{(.grecti.vp.p, }\FunctionTok{list}\NormalTok{(}\AttributeTok{clip =} \StringTok{"inherit"}\NormalTok{)))}

\CommentTok{\#\textquotesingle{} @export grect}
\CommentTok{\#\textquotesingle{} @aliases grect}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{grect\}: ...}
\CommentTok{\#\textquotesingle{} @rdname rect}
\NormalTok{grect }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(name, }\AttributeTok{tfill =} \StringTok{"\#E18727FF"}\NormalTok{, }\AttributeTok{bfill =} \StringTok{"white"}\NormalTok{,}
\NormalTok{  t\_args, tgp\_args, }\AttributeTok{t =}\NormalTok{ roundrectGrob,}
\NormalTok{  b\_args, bgp\_args, }\AttributeTok{b =}\NormalTok{ roundrectGrob,}
  \AttributeTok{order =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{), }\AttributeTok{vp =} \ConstantTok{NULL}\NormalTok{)\{}
\NormalTok{  t }\OtherTok{\textless{}{-}} \FunctionTok{match.fun}\NormalTok{(t)}
\NormalTok{  t\_args }\OtherTok{\textless{}{-}} \FunctionTok{.fresh\_param2}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{y =} \FloatTok{0.5}\NormalTok{,}
      \AttributeTok{width =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{height =} \FloatTok{0.5}\NormalTok{,}
      \AttributeTok{r =}\NormalTok{ .rect.r),}
\NormalTok{    t\_args)}
\NormalTok{  t\_args}\SpecialCharTok{$}\NormalTok{gp }\OtherTok{\textless{}{-}} \FunctionTok{.fresh\_param2f}\NormalTok{(}\FunctionTok{gpar}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ tfill), tgp\_args)}
\NormalTok{  trect }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(t, t\_args)}
  \DocumentationTok{\#\# b}
\NormalTok{  b }\OtherTok{\textless{}{-}} \FunctionTok{match.fun}\NormalTok{(b)}
\NormalTok{  b\_args }\OtherTok{\textless{}{-}} \FunctionTok{.fresh\_param2}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{y =} \FloatTok{0.5}\NormalTok{,}
      \AttributeTok{r =}\NormalTok{ .rect.r),}
\NormalTok{    b\_args)}
\NormalTok{  b\_args}\SpecialCharTok{$}\NormalTok{gp }\OtherTok{\textless{}{-}} \FunctionTok{.fresh\_param2f}\NormalTok{(}\FunctionTok{gpar}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ bfill), bgp\_args)}
\NormalTok{  brect }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(b, b\_args)}
  \FunctionTok{gTree}\NormalTok{(}\AttributeTok{children =} \FunctionTok{gList}\NormalTok{(trect, brect)[order], }\AttributeTok{name =}\NormalTok{ name, }\AttributeTok{vp =}\NormalTok{ vp)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export grecti}
\CommentTok{\#\textquotesingle{} @aliases grecti}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{grecti\}: ...}
\CommentTok{\#\textquotesingle{} @rdname rect}
\NormalTok{grecti }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(label, }\AttributeTok{cex =} \DecValTok{1}\NormalTok{, }\AttributeTok{x =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{y =} \FloatTok{1.005}\NormalTok{,}
  \AttributeTok{borderF =} \DecValTok{2}\NormalTok{, }\AttributeTok{just =} \FunctionTok{c}\NormalTok{(}\StringTok{"center"}\NormalTok{, }\StringTok{"top"}\NormalTok{),}
  \AttributeTok{tfill =} \StringTok{"\#E18727FF"}\NormalTok{, }\AttributeTok{vp =}\NormalTok{ .grecti.vp,}
  \AttributeTok{order =} \FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{), }\AttributeTok{cvp\_clip =} \StringTok{"on"}\NormalTok{,}
  \AttributeTok{cvp\_fix =}\NormalTok{ T, ...)\{}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.list}\NormalTok{(borderF)) \{}
\NormalTok{    borderF }\OtherTok{\textless{}{-}}\NormalTok{ borderF[[}\DecValTok{1}\NormalTok{]]}
\NormalTok{    xmax }\OtherTok{\textless{}{-}}\NormalTok{ T}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    xmax }\OtherTok{\textless{}{-}}\NormalTok{ F}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is}\NormalTok{(label, }\StringTok{"grob"}\NormalTok{)) \{}
\NormalTok{    gtext }\OtherTok{\textless{}{-}}\NormalTok{ label}
\NormalTok{    label }\OtherTok{\textless{}{-}}\NormalTok{ label}\SpecialCharTok{$}\NormalTok{label}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    gtext }\OtherTok{\textless{}{-}} \FunctionTok{gtext}\NormalTok{(label, }\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y, }\AttributeTok{gp\_arg =} \FunctionTok{list}\NormalTok{(}\AttributeTok{cex =}\NormalTok{ cex }\SpecialCharTok{*}\NormalTok{ borderF), }\AttributeTok{just =}\NormalTok{ just)}
\NormalTok{  \}}
\NormalTok{  t\_args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \FunctionTok{grobX}\NormalTok{(gtext, }\DecValTok{90}\NormalTok{), }\AttributeTok{y =} \FunctionTok{grobY}\NormalTok{(gtext, }\DecValTok{0}\NormalTok{),}
    \AttributeTok{width =} \FunctionTok{grobWidth}\NormalTok{(gtext), }\AttributeTok{height =} \FunctionTok{grobHeight}\NormalTok{(gtext))}
  \ControlFlowTok{if}\NormalTok{ (xmax) \{}
\NormalTok{    t\_args}\SpecialCharTok{$}\NormalTok{width }\OtherTok{\textless{}{-}} \FunctionTok{u}\NormalTok{(}\FloatTok{1.2}\NormalTok{, npc)}
\NormalTok{  \}}
\NormalTok{  lst }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{t\_args =}\NormalTok{ t\_args, }\AttributeTok{tfill =}\NormalTok{ tfill, }\AttributeTok{order =}\NormalTok{ order)}
\NormalTok{  args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(...)}
\NormalTok{  args }\OtherTok{\textless{}{-}} \FunctionTok{.fresh\_param2}\NormalTok{(lst, args)}
\NormalTok{  args}\SpecialCharTok{$}\NormalTok{name }\OtherTok{\textless{}{-}}\NormalTok{ label}
\NormalTok{  grect }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(grect, args)}
\NormalTok{  gtext }\OtherTok{\textless{}{-}} \FunctionTok{gtext}\NormalTok{(label, }\FunctionTok{list}\NormalTok{(}\AttributeTok{cex =}\NormalTok{ cex, }\AttributeTok{col =} \StringTok{"white"}\NormalTok{), }\AttributeTok{vp =} \FunctionTok{setvp}\NormalTok{(gtext))}
\NormalTok{  grob }\OtherTok{\textless{}{-}} \FunctionTok{gTree}\NormalTok{(}\AttributeTok{children =} \FunctionTok{gList}\NormalTok{(grect, gtext), }\AttributeTok{name =}\NormalTok{ label, }\AttributeTok{vp =}\NormalTok{ vp)}
\NormalTok{  g }\OtherTok{\textless{}{-}}\NormalTok{ grect}\SpecialCharTok{$}\NormalTok{children[[ order[}\DecValTok{2}\NormalTok{] ]]}
\NormalTok{  cvp\_name }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{form}\NormalTok{(label), }\StringTok{"\_content"}\NormalTok{)}
  \ControlFlowTok{if}\NormalTok{ (cvp\_fix) \{}
\NormalTok{    cvp }\OtherTok{\textless{}{-}} \FunctionTok{viewport}\NormalTok{(}\AttributeTok{x =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{y =} \DecValTok{0}\NormalTok{,}
      \AttributeTok{width =} \FunctionTok{grobWidth}\NormalTok{(g),}
      \AttributeTok{height =} \FunctionTok{grobHeight}\NormalTok{(g) }\SpecialCharTok{{-}}\NormalTok{ t\_args}\SpecialCharTok{$}\NormalTok{height,}
      \AttributeTok{just =} \FunctionTok{c}\NormalTok{(}\StringTok{"center"}\NormalTok{, }\StringTok{"bottom"}\NormalTok{),}
      \AttributeTok{clip =}\NormalTok{ cvp\_clip,}
      \AttributeTok{name =}\NormalTok{ cvp\_name)}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    cvp }\OtherTok{\textless{}{-}} \FunctionTok{setvp}\NormalTok{(g, }\AttributeTok{clip =}\NormalTok{ cvp\_clip, }\AttributeTok{name =}\NormalTok{ cvp\_name)}
\NormalTok{  \}}
  \FunctionTok{graph}\NormalTok{(}\AttributeTok{grob =}\NormalTok{ grob, }\AttributeTok{cvp =}\NormalTok{ cvp)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export grecti2}
\CommentTok{\#\textquotesingle{} @aliases grecti2}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{grecti2\}: ...}
\CommentTok{\#\textquotesingle{} @rdname rect}
\NormalTok{grecti2 }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(label, }\AttributeTok{cex =} \DecValTok{1}\NormalTok{, }\AttributeTok{tfill =} \StringTok{"\#E18727FF"}\NormalTok{,}
  \AttributeTok{borderF =} \FunctionTok{list}\NormalTok{(}\DecValTok{2}\NormalTok{), ...)\{}
\NormalTok{  tgp\_args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{col =}\NormalTok{ tfill)}
\NormalTok{  bgp\_args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{col =}\NormalTok{ tfill)}
\NormalTok{  args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(...)}
\NormalTok{  args }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FunctionTok{namel}\NormalTok{(label, cex, borderF, tfill, tgp\_args, bgp\_args), args)}
  \FunctionTok{do.call}\NormalTok{(grecti, args)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export grecti3}
\CommentTok{\#\textquotesingle{} @aliases grecti3}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{grecti3\}: ...}
\CommentTok{\#\textquotesingle{} @rdname rect}
\NormalTok{grecti3 }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(label, }\AttributeTok{cex =} \DecValTok{1}\NormalTok{, }\AttributeTok{tfill =} \StringTok{"\#E18727FF"}\NormalTok{,}
  \AttributeTok{borderF =} \FunctionTok{list}\NormalTok{(}\DecValTok{2}\NormalTok{), ...)\{}
\NormalTok{  tgp\_args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{col =} \StringTok{"black"}\NormalTok{)}
\NormalTok{  bgp\_args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{col =} \StringTok{"transparent"}\NormalTok{)}
\NormalTok{  args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(...)}
\NormalTok{  args }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FunctionTok{namel}\NormalTok{(label, cex, borderF, tfill, tgp\_args, bgp\_args), args)}
  \FunctionTok{do.call}\NormalTok{(grecti, args)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export grecto}
\CommentTok{\#\textquotesingle{} @aliases grecto}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{grecto\}: ...}
\CommentTok{\#\textquotesingle{} @rdname rect}
\NormalTok{grecto }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(label, }\AttributeTok{cex =} \DecValTok{1}\NormalTok{, }\AttributeTok{x =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{y =} \FloatTok{0.995}\NormalTok{,}
  \AttributeTok{borderF =} \DecValTok{2}\NormalTok{, }\AttributeTok{just =} \FunctionTok{c}\NormalTok{(}\StringTok{"center"}\NormalTok{, }\StringTok{"bottom"}\NormalTok{),}
  \AttributeTok{tfill =} \StringTok{"\#E18727FF"}\NormalTok{, }\AttributeTok{vp =}\NormalTok{ .grecto.vp,}
  \AttributeTok{order =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{), }\AttributeTok{cvp\_clip =} \StringTok{"on"}\NormalTok{, }\AttributeTok{cvp\_fix =}\NormalTok{ F, ...)\{}
\NormalTok{  args }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FunctionTok{as.list}\NormalTok{(}\FunctionTok{environment}\NormalTok{()), }\FunctionTok{list}\NormalTok{(...))}
  \FunctionTok{do.call}\NormalTok{(grecti, args)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export grectn}
\CommentTok{\#\textquotesingle{} @aliases grectn}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{grectn\}: ...}
\CommentTok{\#\textquotesingle{} @rdname rect}
\NormalTok{grectn }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(}\AttributeTok{bfill =} \StringTok{"white"}\NormalTok{, b\_args, bgp\_args, }\AttributeTok{b =}\NormalTok{ roundrectGrob,}
  \AttributeTok{cvp\_clip =} \StringTok{"inherit"}\NormalTok{) \{}
\NormalTok{  b }\OtherTok{\textless{}{-}} \FunctionTok{match.fun}\NormalTok{(b)}
\NormalTok{  b\_args }\OtherTok{\textless{}{-}} \FunctionTok{.fresh\_param2}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{y =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{r =}\NormalTok{ .rect.r), b\_args)}
\NormalTok{  b\_args}\SpecialCharTok{$}\NormalTok{gp }\OtherTok{\textless{}{-}} \FunctionTok{.fresh\_param2f}\NormalTok{(}\FunctionTok{gpar}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ bfill, }\AttributeTok{lty =} \StringTok{"dotted"}\NormalTok{), bgp\_args)}
\NormalTok{  brect }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(b, b\_args)}
  \FunctionTok{graph}\NormalTok{(}\AttributeTok{grob =}\NormalTok{ brect, }\AttributeTok{cvp =} \FunctionTok{setvp}\NormalTok{(brect, }\AttributeTok{clip =}\NormalTok{ cvp\_clip))}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export grectn\_frame}
\CommentTok{\#\textquotesingle{} @aliases grectn\_frame}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{grectn\_frame\}: ...}
\CommentTok{\#\textquotesingle{} @rdname rect}
\NormalTok{grectn\_frame }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(content, title, }\AttributeTok{zo =}\NormalTok{ T)\{}
  \ControlFlowTok{if}\NormalTok{ (zo) content }\OtherTok{\textless{}{-}} \FunctionTok{zo}\NormalTok{(content)}
\NormalTok{  content }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{title =}\NormalTok{ .}\DecValTok{2}\NormalTok{, }\AttributeTok{content =} \DecValTok{1}\NormalTok{), }\FunctionTok{namel}\NormalTok{(title, content))}
\NormalTok{  rect }\OtherTok{\textless{}{-}} \FunctionTok{grectn}\NormalTok{(, , }\FunctionTok{list}\NormalTok{(}\AttributeTok{lty =} \StringTok{"solid"}\NormalTok{))}
  \FunctionTok{into}\NormalTok{(rect, content)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export lst\_grecti}
\CommentTok{\#\textquotesingle{} @aliases lst\_grecti}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{lst\_grecti\}: ...}
\CommentTok{\#\textquotesingle{} @rdname rect}
\NormalTok{lst\_grecti }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(names, pal, }\AttributeTok{tar =} \StringTok{"slot"}\NormalTok{, }\AttributeTok{fun =}\NormalTok{ grecti, ...)\{}
  \FunctionTok{sapply}\NormalTok{(names, }\AttributeTok{simplify =}\NormalTok{ F,}
    \ControlFlowTok{function}\NormalTok{(name)\{}
\NormalTok{      graph }\OtherTok{\textless{}{-}} \FunctionTok{match.fun}\NormalTok{(fun)(}\FunctionTok{form}\NormalTok{(name), , }\AttributeTok{tfill =}\NormalTok{ pal[[ tar ]], ...)}
\NormalTok{    \})}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export grectN}
\CommentTok{\#\textquotesingle{} @aliases grectN}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{grectN\}: ...}
\CommentTok{\#\textquotesingle{} @rdname rect}
\NormalTok{grectN }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(lab}\FloatTok{.1}\NormalTok{, lab}\FloatTok{.2}\NormalTok{, }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fontface =} \StringTok{"plain"}\NormalTok{),}
  \AttributeTok{bfill =} \StringTok{"white"}\NormalTok{)\{}
\NormalTok{  frame }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{lab.1 =} \DecValTok{1}\NormalTok{, }\AttributeTok{seg =}\NormalTok{ .}\DecValTok{1}\NormalTok{, }\AttributeTok{lab.2 =} \DecValTok{1}\NormalTok{),}
    \FunctionTok{list}\NormalTok{(}\AttributeTok{lab.1 =} \FunctionTok{gtext}\NormalTok{(lab}\FloatTok{.1}\NormalTok{, gp),}
      \AttributeTok{seg =} \FunctionTok{segmentsGrob}\NormalTok{(}\DecValTok{0}\NormalTok{, .}\DecValTok{5}\NormalTok{, }\DecValTok{1}\NormalTok{, .}\DecValTok{5}\NormalTok{),}
      \AttributeTok{lab.2 =} \FunctionTok{gtext}\NormalTok{(lab}\FloatTok{.2}\NormalTok{, gp)))}
  \FunctionTok{into}\NormalTok{(}\FunctionTok{grectn}\NormalTok{(bfill, , }\FunctionTok{list}\NormalTok{(}\AttributeTok{lty =} \StringTok{"solid"}\NormalTok{)), frame)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export grecta}
\CommentTok{\#\textquotesingle{} @aliases grecta}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{grecta\}: ...}
\CommentTok{\#\textquotesingle{} @rdname rect}
\NormalTok{grecta }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(label, }\AttributeTok{cex =} \DecValTok{4}\NormalTok{) \{}
\NormalTok{  grob }\OtherTok{\textless{}{-}} \FunctionTok{gtext}\NormalTok{(}
\NormalTok{    label, }\FunctionTok{list}\NormalTok{(}\AttributeTok{cex =}\NormalTok{ cex), }\AttributeTok{form =}\NormalTok{ F,}
    \AttributeTok{x =} \DecValTok{0}\NormalTok{, }\AttributeTok{y =} \FunctionTok{u}\NormalTok{(}\DecValTok{1}\NormalTok{, npc),}
    \AttributeTok{just =} \FunctionTok{c}\NormalTok{(}\StringTok{"left"}\NormalTok{, }\StringTok{"top"}\NormalTok{)}
\NormalTok{  )}
\NormalTok{  cvp }\OtherTok{\textless{}{-}} \FunctionTok{viewport}\NormalTok{(}
    \FunctionTok{grobWidth}\NormalTok{(grob), }\DecValTok{0}\NormalTok{, }\FunctionTok{u}\NormalTok{(}\DecValTok{1}\NormalTok{, npc) }\SpecialCharTok{{-}} \FunctionTok{grobWidth}\NormalTok{(grob), .}\DecValTok{95}\NormalTok{,}
    \AttributeTok{just =} \FunctionTok{c}\NormalTok{(}\StringTok{"left"}\NormalTok{, }\StringTok{"bottom"}\NormalTok{)}
\NormalTok{  )}
  \FunctionTok{graph}\NormalTok{(}\AttributeTok{grob =}\NormalTok{ grob, }\AttributeTok{cvp =}\NormalTok{ cvp)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export gshiny}
\CommentTok{\#\textquotesingle{} @aliases gshiny}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{gshiny\}: ...}
\CommentTok{\#\textquotesingle{} @rdname rect}
\NormalTok{gshiny }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(}\AttributeTok{xn =} \DecValTok{4}\NormalTok{, }\AttributeTok{yn =} \DecValTok{3}\NormalTok{,}
  \AttributeTok{xps =} \FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, , xn), }\AttributeTok{yps =} \FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, , yn),}
  \AttributeTok{size =} \FunctionTok{c}\NormalTok{(.}\DecValTok{15}\NormalTok{, .}\DecValTok{02}\NormalTok{),}
  \AttributeTok{color =}\NormalTok{ .default\_color,}
  \AttributeTok{rect =} \FunctionTok{rectGrob}\NormalTok{(),}
  \AttributeTok{vp =} \FunctionTok{viewport}\NormalTok{(}\AttributeTok{clip =} \StringTok{"off"}\NormalTok{),}
  \AttributeTok{cvp =} \FunctionTok{viewport}\NormalTok{(, , .}\DecValTok{9}\NormalTok{, .}\DecValTok{9}\NormalTok{)}
\NormalTok{  )\{}
\NormalTok{  size }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(size[}\DecValTok{1}\NormalTok{], size[}\DecValTok{2}\NormalTok{], }\AttributeTok{length.out =} \FunctionTok{floor}\NormalTok{(}\FunctionTok{max}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\FunctionTok{length}\NormalTok{(xps), }\FunctionTok{length}\NormalTok{(yps))) }\SpecialCharTok{/} \DecValTok{2}\NormalTok{) }\SpecialCharTok{+} \DecValTok{1}\NormalTok{)}
\NormalTok{  xsize }\OtherTok{\textless{}{-}} \FunctionTok{sym\_fill}\NormalTok{(xps, size)}
\NormalTok{  xpal }\OtherTok{\textless{}{-}} \FunctionTok{sym\_fill}\NormalTok{(xps, color)}
\NormalTok{  args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\FunctionTok{c}\NormalTok{(xps, xps), }\FunctionTok{c}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FunctionTok{length}\NormalTok{(xps)), }\FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FunctionTok{length}\NormalTok{(xps))),}
    \FunctionTok{c}\NormalTok{(xsize, xsize), }\FunctionTok{c}\NormalTok{(xpal, xpal))}
\NormalTok{  fun }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(n) \{}
    \FunctionTok{circleGrob}\NormalTok{(args[[}\DecValTok{1}\NormalTok{]][n], args[[}\DecValTok{2}\NormalTok{]][n], args[[}\DecValTok{3}\NormalTok{]][n],}
      \AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ args[[}\DecValTok{4}\NormalTok{]][n], }\AttributeTok{col =} \StringTok{"transparent"}\NormalTok{))}
\NormalTok{  \}}
\NormalTok{  xcir }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\NormalTok{(}\DecValTok{2} \SpecialCharTok{*} \FunctionTok{length}\NormalTok{(xps)), fun)}
\NormalTok{  rep }\OtherTok{\textless{}{-}}\NormalTok{ xps[xps }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{)]}
\NormalTok{  rep }\OtherTok{\textless{}{-}}\NormalTok{ yps[yps }\SpecialCharTok{\%in\%}\NormalTok{ rep]}
\NormalTok{  yps }\OtherTok{\textless{}{-}}\NormalTok{ yps[}\SpecialCharTok{!}\NormalTok{yps }\SpecialCharTok{\%in\%}\NormalTok{ rep]}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(rep) }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{) \{}
\NormalTok{    size }\OtherTok{\textless{}{-}}\NormalTok{ size[}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{]}
\NormalTok{    color }\OtherTok{\textless{}{-}}\NormalTok{ color[}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{]}
\NormalTok{  \}}
\NormalTok{  ysize }\OtherTok{\textless{}{-}} \FunctionTok{sym\_fill}\NormalTok{(yps, size)}
\NormalTok{  ypal }\OtherTok{\textless{}{-}} \FunctionTok{sym\_fill}\NormalTok{(yps, color)}
\NormalTok{  args }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FunctionTok{length}\NormalTok{(yps)), }\FunctionTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FunctionTok{length}\NormalTok{(yps))), }\FunctionTok{c}\NormalTok{(yps, yps),}
    \FunctionTok{c}\NormalTok{(ysize, ysize), }\FunctionTok{c}\NormalTok{(ypal, ypal))}
\NormalTok{  ycir }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\NormalTok{(}\DecValTok{2} \SpecialCharTok{*} \FunctionTok{length}\NormalTok{(yps)), fun)}
\NormalTok{  args }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FunctionTok{list}\NormalTok{(rect), xcir, ycir, }\FunctionTok{list}\NormalTok{(}\AttributeTok{vp =}\NormalTok{ vp))}
  \FunctionTok{graph}\NormalTok{(}\AttributeTok{grob =} \FunctionTok{do.call}\NormalTok{(ggather, args), }\AttributeTok{cvp =}\NormalTok{ cvp)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export sym\_fill}
\NormalTok{sym\_fill }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(long, short)\{}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(long) }\SpecialCharTok{\%\%} \DecValTok{2} \SpecialCharTok{==} \DecValTok{0}\NormalTok{) \{}
\NormalTok{    short }\OtherTok{\textless{}{-}}\NormalTok{ short[}\DecValTok{1}\SpecialCharTok{:}\NormalTok{(}\FunctionTok{length}\NormalTok{(long) }\SpecialCharTok{/} \DecValTok{2}\NormalTok{)]}
\NormalTok{    res }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(short, }\FunctionTok{rev}\NormalTok{(short))}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    half }\OtherTok{\textless{}{-}}\NormalTok{ (}\FunctionTok{length}\NormalTok{(long) }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{) }\SpecialCharTok{/} \DecValTok{2}
\NormalTok{    res }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(short[}\DecValTok{1}\SpecialCharTok{:}\NormalTok{(half }\SpecialCharTok{+} \DecValTok{1}\NormalTok{)], }\FunctionTok{rev}\NormalTok{(short[}\DecValTok{1}\SpecialCharTok{:}\NormalTok{half]))}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{any}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(res)))}
    \FunctionTok{stop}\NormalTok{( }\StringTok{"any(is.na(res)) == T"}\NormalTok{ )}
  \ControlFlowTok{else}
    \FunctionTok{return}\NormalTok{(res)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# get external grob}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\#\textquotesingle{} @export .expathsvg}
\NormalTok{.expathsvg }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{() \{}
\NormalTok{  .expathsvg }\OtherTok{\textless{}{-}} \FunctionTok{system.file}\NormalTok{(}\StringTok{"extdata"}\NormalTok{, }\StringTok{"svg"}\NormalTok{, }\AttributeTok{package =} \FunctionTok{gsub}\NormalTok{(}\StringTok{"\^{}.*:"}\NormalTok{, }\StringTok{""}\NormalTok{,}
      \FunctionTok{environmentName}\NormalTok{(}\FunctionTok{topenv}\NormalTok{())))}
  \FunctionTok{assign}\NormalTok{(}\StringTok{\textquotesingle{}.expathsvg\textquotesingle{}}\NormalTok{, .expathsvg, }\AttributeTok{envir =} \FunctionTok{topenv}\NormalTok{())}
\NormalTok{\}}

\NormalTok{prefix }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}

\CommentTok{\#\textquotesingle{} @export .check\_external\_svg}
\NormalTok{.check\_external\_svg }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{()\{}
\NormalTok{  files }\OtherTok{\textless{}{-}} \FunctionTok{list.files}\NormalTok{(.expathsvg, }\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.svg$"}\NormalTok{, }\AttributeTok{full.names =}\NormalTok{ T)}
\NormalTok{  log.path }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(.expathsvg, }\StringTok{"/log"}\NormalTok{)}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{file.exists}\NormalTok{(log.path)) \{}
\NormalTok{    log }\OtherTok{\textless{}{-}} \FunctionTok{readLines}\NormalTok{(log.path)}
\NormalTok{    log }\OtherTok{\textless{}{-}}\NormalTok{ log[}\FunctionTok{vapply}\NormalTok{(log, file.exists, T)]}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    log }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(files) }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{) \{}
\NormalTok{    new.log }\OtherTok{\textless{}{-}}
      \FunctionTok{lapply}\NormalTok{(files,}
        \ControlFlowTok{function}\NormalTok{(file) \{}
          \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\NormalTok{file }\SpecialCharTok{\%in\%}\NormalTok{ log) \{}
\NormalTok{            rsvg}\SpecialCharTok{::}\FunctionTok{rsvg\_svg}\NormalTok{(file, file)}
\NormalTok{            file}
\NormalTok{          \}}
\NormalTok{        \})}
\NormalTok{    new.log }\OtherTok{\textless{}{-}} \FunctionTok{unlist}\NormalTok{(new.log)}
\NormalTok{    log }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(log, new.log)}
\NormalTok{  \}}
  \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(log))}
    \FunctionTok{writeLines}\NormalTok{(log, log.path)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export ex\_grob}
\NormalTok{ex\_grob }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(name, }\AttributeTok{fun =}\NormalTok{ .cairosvg\_to\_grob)\{}
\NormalTok{  file }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(.expathsvg, }\StringTok{"/"}\NormalTok{, name, }\StringTok{".svg"}\NormalTok{)}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{file.exists}\NormalTok{(file)) \{}
    \FunctionTok{fun}\NormalTok{(file)}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
    \FunctionTok{stop}\NormalTok{(}\StringTok{"file.exsits(file) == F"}\NormalTok{)}
\NormalTok{  \}}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export ex\_pic}
\NormalTok{ex\_pic }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(name)\{}
  \FunctionTok{ex\_grob}\NormalTok{(name, }\AttributeTok{fun =}\NormalTok{ grImport2}\SpecialCharTok{::}\NormalTok{readPicture)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# layers}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\#\textquotesingle{} @export glayer}
\CommentTok{\#\textquotesingle{} @aliases glayer}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{glayer\}: ...}
\CommentTok{\#\textquotesingle{} @rdname rect}
\NormalTok{glayer }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(}\AttributeTok{n =} \DecValTok{5}\NormalTok{, }\AttributeTok{to =}\NormalTok{ .}\DecValTok{2}\NormalTok{, }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fill =} \StringTok{"white"}\NormalTok{), }\AttributeTok{fun =}\NormalTok{ rectGrob)\{}
\NormalTok{    grob }\OtherTok{\textless{}{-}} \FunctionTok{fun}\NormalTok{(}\AttributeTok{x =} \FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, to, }\AttributeTok{length.out =}\NormalTok{ n),}
      \AttributeTok{y =} \FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, to, }\AttributeTok{length.out =}\NormalTok{ n),}
      \AttributeTok{height =} \DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ to,}
      \AttributeTok{width =} \DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ to,}
      \AttributeTok{just =} \FunctionTok{c}\NormalTok{(}\StringTok{"left"}\NormalTok{, }\StringTok{"bottom"}\NormalTok{),}
      \AttributeTok{gp =}\NormalTok{ gp}
\NormalTok{    )}
\NormalTok{    cvp }\OtherTok{\textless{}{-}} \FunctionTok{viewport}\NormalTok{(to, to, }\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ to, }\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ to, }\AttributeTok{just =} \FunctionTok{c}\NormalTok{(}\StringTok{"left"}\NormalTok{, }\StringTok{"bottom"}\NormalTok{), }\AttributeTok{clip =} \StringTok{"on"}\NormalTok{)}
    \FunctionTok{graph}\NormalTok{(}\AttributeTok{grob =}\NormalTok{ grob, }\AttributeTok{cvp =}\NormalTok{ cvp)}
\NormalTok{  \}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# network}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\#\textquotesingle{} @aliases network}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Quickly draw random network diagrams}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description ...}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name network}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @export fast\_layout}
\CommentTok{\#\textquotesingle{} @aliases fast\_layout}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{fast\_layout\}: ...}
\CommentTok{\#\textquotesingle{} @rdname network}
\NormalTok{fast\_layout }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(edges, }\AttributeTok{layout =} \StringTok{"fr"}\NormalTok{, }\AttributeTok{nodes =} \ConstantTok{NULL}\NormalTok{)\{}
\NormalTok{  graph }\OtherTok{\textless{}{-}}\NormalTok{ igraph}\SpecialCharTok{::}\FunctionTok{graph\_from\_data\_frame}\NormalTok{(edges, }\AttributeTok{directed =}\NormalTok{ T, }\AttributeTok{vertices =}\NormalTok{ nodes)}
\NormalTok{  graph }\OtherTok{\textless{}{-}}\NormalTok{ tidygraph}\SpecialCharTok{::}\FunctionTok{as\_tbl\_graph}\NormalTok{(graph)}
\NormalTok{  ggraph}\SpecialCharTok{::}\FunctionTok{create\_layout}\NormalTok{(graph, layout)}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export random\_graph}
\CommentTok{\#\textquotesingle{} @aliases random\_graph}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{random\_graph\}: ...}
\CommentTok{\#\textquotesingle{} @rdname network}
\NormalTok{random\_graph }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(ids, }\AttributeTok{n =} \FunctionTok{length}\NormalTok{(ids), }\AttributeTok{e =} \DecValTok{4}\NormalTok{, }\AttributeTok{layout =} \StringTok{"fr"}\NormalTok{) \{}
\NormalTok{  df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{id =}\NormalTok{ ids, }\AttributeTok{size =} \FunctionTok{rnorm}\NormalTok{(n, .}\DecValTok{5}\NormalTok{, .}\DecValTok{2}\NormalTok{))}
\NormalTok{  edges }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{id1 =} \FunctionTok{sample}\NormalTok{(ids, e), }\AttributeTok{id2 =} \FunctionTok{sample}\NormalTok{(ids, e),}
    \AttributeTok{width =} \FunctionTok{rnorm}\NormalTok{(e, .}\DecValTok{5}\NormalTok{, .}\DecValTok{2}\NormalTok{))}
  \FunctionTok{fast\_layout}\NormalTok{(edges, layout, df)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# others}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\#\textquotesingle{} @export sep\_legend}
\NormalTok{sep\_legend }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(p, theme) \{}
\NormalTok{  p.l }\OtherTok{\textless{}{-}}\NormalTok{ MCnebula2}\SpecialCharTok{:::}\FunctionTok{.get\_legend}\NormalTok{(p }\SpecialCharTok{+}\NormalTok{ theme)}
\NormalTok{  theme}\SpecialCharTok{$}\NormalTok{legend.position }\OtherTok{\textless{}{-}} \StringTok{"none"}
\NormalTok{  p.m }\OtherTok{\textless{}{-}}\NormalTok{ p }\SpecialCharTok{+}\NormalTok{ theme}
\NormalTok{  p }\OtherTok{\textless{}{-}}\NormalTok{ p }\SpecialCharTok{+}\NormalTok{ theme}
  \FunctionTok{return}\NormalTok{(}\FunctionTok{namel}\NormalTok{(p.l, p.m, p))}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @aliases zoom\_pdf}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Zoom in locally pdf to png}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description ...}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name zoom\_pdf}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @export zoom\_pdf}
\CommentTok{\#\textquotesingle{} @aliases zoom\_pdf}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{zoom\_pdf\}: ...}
\CommentTok{\#\textquotesingle{} @rdname zoom\_pdf}
\NormalTok{zoom\_pdf }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(file, }\AttributeTok{position =} \FunctionTok{c}\NormalTok{(.}\DecValTok{5}\NormalTok{, .}\DecValTok{5}\NormalTok{), }\AttributeTok{size =} \FunctionTok{c}\NormalTok{(.}\DecValTok{15}\NormalTok{, .}\DecValTok{1}\NormalTok{), }\AttributeTok{page =} \DecValTok{1}\NormalTok{, }\AttributeTok{dpi =} \DecValTok{2000}\NormalTok{,}
  \AttributeTok{as.grob =}\NormalTok{ T)}
\NormalTok{\{}
\NormalTok{  position[}\DecValTok{2}\NormalTok{] }\OtherTok{\textless{}{-}} \DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ position[}\DecValTok{2}\NormalTok{]}
\NormalTok{  png }\OtherTok{\textless{}{-}}\NormalTok{ pdftools}\SpecialCharTok{::}\FunctionTok{pdf\_render\_page}\NormalTok{(file, }\AttributeTok{page =}\NormalTok{ page, }\AttributeTok{dpi =}\NormalTok{ dpi)}
\NormalTok{  png }\OtherTok{\textless{}{-}}\NormalTok{ png}\SpecialCharTok{::}\FunctionTok{readPNG}\NormalTok{(png}\SpecialCharTok{::}\FunctionTok{writePNG}\NormalTok{(png))}
\NormalTok{  wxh }\OtherTok{\textless{}{-}} \FunctionTok{dim}\NormalTok{(png)[}\DecValTok{2}\SpecialCharTok{:}\DecValTok{1}\NormalTok{]}
\NormalTok{  sel }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{2}\NormalTok{,}
    \ControlFlowTok{function}\NormalTok{(n) \{}
\NormalTok{      center }\OtherTok{\textless{}{-}}\NormalTok{ wxh[n] }\SpecialCharTok{*}\NormalTok{ position[n]}
\NormalTok{      long }\OtherTok{\textless{}{-}}\NormalTok{ wxh[n] }\SpecialCharTok{*}\NormalTok{ size[n]}
\NormalTok{      start }\OtherTok{\textless{}{-}}\NormalTok{ center }\SpecialCharTok{{-}}\NormalTok{ long }\SpecialCharTok{/} \DecValTok{2}
\NormalTok{      end }\OtherTok{\textless{}{-}}\NormalTok{ center }\SpecialCharTok{+}\NormalTok{ long }\SpecialCharTok{/} \DecValTok{2}
      \FunctionTok{round}\NormalTok{(start)}\SpecialCharTok{:}\FunctionTok{round}\NormalTok{(end)}
\NormalTok{    \})}
\NormalTok{  res }\OtherTok{\textless{}{-}}\NormalTok{ png[sel[[}\DecValTok{2}\NormalTok{]], sel[[}\DecValTok{1}\NormalTok{]], ]}
  \ControlFlowTok{if}\NormalTok{ (as.grob) \{}
\NormalTok{    res }\OtherTok{\textless{}{-}} \FunctionTok{rasterGrob}\NormalTok{(res)}
\NormalTok{  \}}
  \FunctionTok{return}\NormalTok{(res)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# shape}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\NormalTok{simulate\_peaks }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(}\AttributeTok{all\_range =} \FunctionTok{list}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{30}\NormalTok{, }\DecValTok{31}\SpecialCharTok{:}\DecValTok{60}\NormalTok{, }\DecValTok{61}\SpecialCharTok{:}\DecValTok{100}\NormalTok{, }\DecValTok{101}\SpecialCharTok{:}\DecValTok{140}\NormalTok{),}
  \AttributeTok{shift =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{))}
\NormalTok{\{}
\NormalTok{  lst }\OtherTok{\textless{}{-}} \FunctionTok{mapply}\NormalTok{(shift, }\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(shift), }\AttributeTok{SIMPLIFY =}\NormalTok{ F, }\AttributeTok{FUN =} \ControlFlowTok{function}\NormalTok{(shift, id)\{}
\NormalTok{    peak }\OtherTok{\textless{}{-}} \FunctionTok{mapply}\NormalTok{(all\_range, }\AttributeTok{SIMPLIFY =}\NormalTok{ F,}
      \AttributeTok{FUN =} \ControlFlowTok{function}\NormalTok{(range)\{}
\NormalTok{        peak }\OtherTok{\textless{}{-}} \FunctionTok{dnorm}\NormalTok{(range, }\FunctionTok{median}\NormalTok{(range) }\SpecialCharTok{+}\NormalTok{ shift, }\FunctionTok{rnorm}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{5}\NormalTok{, }\FloatTok{1.2}\NormalTok{)) }\SpecialCharTok{*}
          \FunctionTok{rnorm}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FloatTok{0.7}\NormalTok{, }\FloatTok{0.15}\NormalTok{)}
\NormalTok{      \})}
\NormalTok{    feature }\OtherTok{\textless{}{-}} \FunctionTok{mapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(all\_range), }\FunctionTok{lengths}\NormalTok{(all\_range),}
      \AttributeTok{FUN =} \ControlFlowTok{function}\NormalTok{(seq, rep)\{}
        \FunctionTok{rep}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"peak"}\NormalTok{, seq), rep)}
\NormalTok{      \})}
\NormalTok{    tibble}\SpecialCharTok{::}\FunctionTok{tibble}\NormalTok{(}\AttributeTok{x =} \FunctionTok{unlist}\NormalTok{(all\_range), }\AttributeTok{y =} \FunctionTok{unlist}\NormalTok{(peak),}
      \AttributeTok{sample =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"sample"}\NormalTok{, id),}
      \AttributeTok{peak =} \FunctionTok{unlist}\NormalTok{(feature)}
\NormalTok{    )}
\NormalTok{  \})}
\NormalTok{  data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(lst)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# get\_ggsets}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\#\textquotesingle{} @export nebulae\_as\_grob}
\CommentTok{\#\textquotesingle{} @title Convert Nebulae as \textquotesingle{}grob\textquotesingle{} object}
\CommentTok{\#\textquotesingle{} @aliases nebulae\_as\_grob}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{nebulae\_as\_grob\}: This will convert Child{-}Nebulae}
\CommentTok{\#\textquotesingle{} as a \textquotesingle{}grob\textquotesingle{} object. See package \textasciigrave{}grid\textasciigrave{} about \textquotesingle{}grob\textquotesingle{} object.}
\CommentTok{\#\textquotesingle{} @param x [mcnebula{-}class] object.}
\CommentTok{\#\textquotesingle{} @rdname nebulae\_as\_grob}
\NormalTok{nebulae\_as\_grob }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  chAsGrob }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(ch, x) \{}
\NormalTok{    ggset }\OtherTok{\textless{}{-}} \FunctionTok{modify\_default\_child}\NormalTok{(ch)}
    \FunctionTok{as\_grob}\NormalTok{(}\FunctionTok{call\_command}\NormalTok{(ggset))}
\NormalTok{  \}}
\NormalTok{  sets }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{ggset}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x)), chAsGrob, }\AttributeTok{x =}\NormalTok{ x)}
\NormalTok{  sets }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(sets),}
    \ControlFlowTok{function}\NormalTok{(name) \{}
      \FunctionTok{ggather}\NormalTok{(sets[[name]],}
        \AttributeTok{vp =} \FunctionTok{viewports}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))[[name]])}
\NormalTok{    \})}
\NormalTok{  sets\_vp }\OtherTok{\textless{}{-}} \FunctionTok{viewport}\NormalTok{(}\AttributeTok{layout =} \FunctionTok{grid\_layout}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x)))}
\NormalTok{  sets }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(ggather, }\FunctionTok{c}\NormalTok{(sets, }\FunctionTok{list}\NormalTok{(}\AttributeTok{vp =}\NormalTok{ sets\_vp)))}
\NormalTok{  legendH }\OtherTok{\textless{}{-}}\NormalTok{ MCnebula2}\SpecialCharTok{:::}\FunctionTok{.legend\_hierarchy}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x), x)}
\NormalTok{  legendG }\OtherTok{\textless{}{-}}\NormalTok{ MCnebula2}\SpecialCharTok{:::}\FunctionTok{.get\_legend}\NormalTok{(}
    \FunctionTok{call\_command}\NormalTok{(}\FunctionTok{modify\_default\_child}\NormalTok{(}\FunctionTok{ggset}\NormalTok{(}\FunctionTok{child\_nebulae}\NormalTok{(x))[[}\DecValTok{1}\NormalTok{]], x))}
\NormalTok{  )}
  \DocumentationTok{\#\# integrate}
\NormalTok{  vis }\OtherTok{\textless{}{-}} \FunctionTok{frame\_row}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{sets =} \DecValTok{5}\NormalTok{, }\AttributeTok{legendH =}\NormalTok{ .}\DecValTok{5}\NormalTok{), }\FunctionTok{namel}\NormalTok{(sets, legendH))}
\NormalTok{  vis }\OtherTok{\textless{}{-}} \FunctionTok{frame\_col}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{vis =} \DecValTok{4}\NormalTok{, }\AttributeTok{legendG =} \DecValTok{1}\NormalTok{), }\FunctionTok{namel}\NormalTok{(vis, legendG))}
\NormalTok{  vis}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-output_identification.r}{%
\section{File: output\_identification.R}\label{file-output_identification.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# output compounds identification table }
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\#\textquotesingle{} @aliases format\_table}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Format table via dplyr::*}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description Format the data.frame via: \textbackslash{}code\{dplyr::filter\}, \textbackslash{}code\{dplyr::arrange\},}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{dplyr::distinct\}, \textbackslash{}code\{dplyr::mutate\}, \textbackslash{}code\{dplyr::select\},}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{dplyr::rename\}.}
\CommentTok{\#\textquotesingle{} @param data data.frame. From \textbackslash{}code\{features\_annotation(mcn)\}.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name format\_table}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @export rename\_table}
\CommentTok{\#\textquotesingle{} @aliases rename\_table}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{rename\_table\}: ...}
\CommentTok{\#\textquotesingle{} @rdname format\_table}
\NormalTok{rename\_table }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(data, }\AttributeTok{export\_name =}\NormalTok{ .export\_name) \{}
    \FunctionTok{format\_table}\NormalTok{(data, }\ConstantTok{NULL}\NormalTok{, }\ConstantTok{NULL}\NormalTok{, }\ConstantTok{NULL}\NormalTok{, }\ConstantTok{NULL}\NormalTok{, }\ConstantTok{NULL}\NormalTok{, export\_name)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export format\_table}
\CommentTok{\#\textquotesingle{} @aliases format\_table}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{format\_table\}: ...}
\CommentTok{\#\textquotesingle{} @rdname format\_table}
\NormalTok{format\_table }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(data, }\AttributeTok{filter =}\NormalTok{ .filter\_format, }\AttributeTok{arrange =}\NormalTok{ .arrange\_format,}
    \AttributeTok{distinct =}\NormalTok{ .distinct\_format, }\AttributeTok{mutate =}\NormalTok{ .mutate\_format,}
    \AttributeTok{select =}\NormalTok{ .select\_format, }\AttributeTok{export\_name =}\NormalTok{ .export\_name) \{}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(filter))}
\NormalTok{      data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(data, }\SpecialCharTok{!!!}\NormalTok{filter)}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(arrange)) \{}
      \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(}\FunctionTok{data.frame}\NormalTok{(data)}\SpecialCharTok{$}\NormalTok{arrange.rank))}
\NormalTok{        data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(data, }\AttributeTok{arrange.rank =} \ConstantTok{NA}\NormalTok{)}
\NormalTok{      data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{arrange}\NormalTok{(data, }\SpecialCharTok{!!!}\NormalTok{arrange)}
\NormalTok{    \}}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(distinct))}
\NormalTok{      data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{distinct}\NormalTok{(data, }\SpecialCharTok{!!!}\NormalTok{distinct, }\AttributeTok{.keep\_all =}\NormalTok{ T)}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(mutate))}
\NormalTok{      data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(data, }\SpecialCharTok{!!!}\NormalTok{mutate)}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(select)) \{}
\NormalTok{      select }\OtherTok{\textless{}{-}}\NormalTok{ select[select }\SpecialCharTok{\%in\%} \FunctionTok{colnames}\NormalTok{(data)]}
      \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(select))}
\NormalTok{        data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(data, dplyr}\SpecialCharTok{::}\FunctionTok{all\_of}\NormalTok{(select))}
\NormalTok{    \}}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(export\_name)) \{}
\NormalTok{      export\_name }\OtherTok{\textless{}{-}}\NormalTok{ export\_name[}\FunctionTok{names}\NormalTok{(export\_name) }\SpecialCharTok{\%in\%} \FunctionTok{colnames}\NormalTok{(data)]}
\NormalTok{      export\_name }\OtherTok{\textless{}{-}} \FunctionTok{as.list}\NormalTok{(}\FunctionTok{turn\_vector}\NormalTok{(export\_name))}
\NormalTok{      data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{rename}\NormalTok{(data, }\SpecialCharTok{!!!}\NormalTok{export\_name)}
\NormalTok{    \}}
\NormalTok{    tibble}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(data)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export .filter\_format}
\CommentTok{\#\textquotesingle{} @aliases .filter\_format}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{.filter\_format\}: ...}
\CommentTok{\#\textquotesingle{} @rdname format\_table}
\NormalTok{.filter\_format }\OtherTok{\textless{}{-}} 
  \FunctionTok{list}\NormalTok{(}\FunctionTok{quote}\NormalTok{(tani.score }\SpecialCharTok{\textgreater{}=}\NormalTok{ .}\DecValTok{5}\NormalTok{))}

\CommentTok{\#\textquotesingle{} @export .arrange\_format}
\CommentTok{\#\textquotesingle{} @aliases .arrange\_format}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{.arrange\_format\}: ...}
\CommentTok{\#\textquotesingle{} @rdname format\_table}
\NormalTok{.arrange\_format }\OtherTok{\textless{}{-}} 
  \FunctionTok{list}\NormalTok{(}
    \FunctionTok{quote}\NormalTok{(arrange.rank),}
    \FunctionTok{quote}\NormalTok{(inchikey2d),}
    \FunctionTok{quote}\NormalTok{(}\FunctionTok{desc}\NormalTok{(tani.score))}
\NormalTok{  )}

\CommentTok{\#\textquotesingle{} @export .distinct\_format}
\CommentTok{\#\textquotesingle{} @aliases .distinct\_format}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{.distinct\_format\}: ...}
\CommentTok{\#\textquotesingle{} @rdname format\_table}
\NormalTok{.distinct\_format }\OtherTok{\textless{}{-}} 
  \FunctionTok{list}\NormalTok{(}\FunctionTok{quote}\NormalTok{(inchikey2d))}

\CommentTok{\#\textquotesingle{} @export .mutate\_format}
\CommentTok{\#\textquotesingle{} @aliases .mutate\_format}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{.mutate\_format\}: ...}
\CommentTok{\#\textquotesingle{} @rdname format\_table}
\NormalTok{.mutate\_format }\OtherTok{\textless{}{-}} 
  \FunctionTok{list}\NormalTok{(}\AttributeTok{mz =} \FunctionTok{quote}\NormalTok{(}\FunctionTok{round}\NormalTok{(mz, }\DecValTok{4}\NormalTok{)),}
    \AttributeTok{error.mass =} \FunctionTok{quote}\NormalTok{(}\FunctionTok{floor}\NormalTok{(error.mass }\SpecialCharTok{*} \DecValTok{10}\NormalTok{) }\SpecialCharTok{/} \DecValTok{10}\NormalTok{),}
    \AttributeTok{tani.score =} \FunctionTok{quote}\NormalTok{(}\FunctionTok{floor}\NormalTok{(tani.score }\SpecialCharTok{*} \DecValTok{100}\NormalTok{) }\SpecialCharTok{/} \DecValTok{100}\NormalTok{),}
    \AttributeTok{rt.min =} \FunctionTok{quote}\NormalTok{(}\FunctionTok{round}\NormalTok{(rt.secound }\SpecialCharTok{/} \DecValTok{60}\NormalTok{, }\DecValTok{1}\NormalTok{))}
\NormalTok{  )}

\CommentTok{\#\textquotesingle{} @export .select\_format}
\CommentTok{\#\textquotesingle{} @aliases .select\_format}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{.select\_format\}: ...}
\CommentTok{\#\textquotesingle{} @rdname format\_table}
\NormalTok{.select\_format }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"No."}\NormalTok{, }\StringTok{"synonym"}\NormalTok{, }\StringTok{".features\_id"}\NormalTok{, }\StringTok{"mz"}\NormalTok{, }\StringTok{"error.mass"}\NormalTok{,}
  \StringTok{"rt.min"}\NormalTok{, }\StringTok{"mol.formula"}\NormalTok{, }\StringTok{"adduct"}\NormalTok{, }\StringTok{"tani.score"}\NormalTok{, }\StringTok{"inchikey2d"}\NormalTok{,}
  \StringTok{"class"}\NormalTok{, }\StringTok{"logFC"}\NormalTok{, }\StringTok{"P.Value"}\NormalTok{, }\StringTok{"adj.P.Val"}
\NormalTok{)}

\CommentTok{\#\textquotesingle{} @export .export\_name}
\CommentTok{\#\textquotesingle{} @aliases .export\_name}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{.export\_name\}: ...}
\CommentTok{\#\textquotesingle{} @rdname format\_table}
\NormalTok{.export\_name }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\AttributeTok{mz =} \StringTok{"Precursor m/z"}\NormalTok{,}
  \AttributeTok{rt.min =} \StringTok{"RT (min)"}\NormalTok{,}
  \AttributeTok{similarity =} \StringTok{"Spectral similarity"}\NormalTok{,}
  \AttributeTok{tani.score =} \StringTok{"Tanimoto similarity"}\NormalTok{,}
  \AttributeTok{rel.index =} \StringTok{"Relative index"}\NormalTok{,}
  \AttributeTok{rel.int. =} \StringTok{"Relative intensity"}\NormalTok{,}
  \AttributeTok{group =} \StringTok{"Group"}\NormalTok{,}
  \AttributeTok{.features\_id =} \StringTok{"ID"}\NormalTok{,}
  \AttributeTok{mol.formula =} \StringTok{"Formula"}\NormalTok{,}
  \AttributeTok{inchikey2d =} \StringTok{"InChIKey planar"}\NormalTok{,}
  \AttributeTok{error.mass =} \StringTok{"Mass error (ppm)"}\NormalTok{,}
  \AttributeTok{synonym =} \StringTok{"Synonym"}\NormalTok{,}
  \AttributeTok{adduct =} \StringTok{"Adduct"}\NormalTok{,}
  \AttributeTok{class =} \StringTok{"Class"}\NormalTok{,}
  \AttributeTok{logFC =} \StringTok{"log2(FC)"}\NormalTok{,}
  \AttributeTok{P.Value =} \StringTok{"P{-}value"}\NormalTok{,}
  \AttributeTok{adj.P.Val =} \StringTok{"Q{-}value"}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-pathway_enrichment.r}{%
\section{File: pathway\_enrichment.R}\label{file-pathway_enrichment.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# Combining multiple tools for pathway enrichment analysis.}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\#\textquotesingle{} @aliases pathway\_enrichment}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Perform pathway enrichment via package of \textquotesingle{}FELLA\textquotesingle{}}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description Pathway enrichment analysis was performed using KEGG ID}
\CommentTok{\#\textquotesingle{} via package of \textquotesingle{}FELLA\textquotesingle{}.}
\CommentTok{\#\textquotesingle{} (Convert CID to KEGG ID using the \textquotesingle{}MetaboAnalystR\textquotesingle{} package.}
\CommentTok{\#\textquotesingle{} See \textless{}https://github.com/xia{-}lab/MetaboAnalystR\textgreater{} for installation.)}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name pathway\_enrichment}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @export init\_fella}
\CommentTok{\#\textquotesingle{} @aliases init\_fella}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{init\_fella\}: ...}
\CommentTok{\#\textquotesingle{} @seealso [FELLA::buildDataFromGraph()], [FELLA::buildGraphFromKEGGREST()]}
\CommentTok{\#\textquotesingle{} @rdname pathway\_enrichment}
\NormalTok{init\_fella }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(dir, }\AttributeTok{org =} \FunctionTok{c}\NormalTok{(}\StringTok{"hsa"}\NormalTok{, }\StringTok{"mmu"}\NormalTok{, }\StringTok{"rno"}\NormalTok{), }\AttributeTok{seed =} \DecValTok{1}\NormalTok{, }\AttributeTok{rebuild =}\NormalTok{ F) \{}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{file.exists}\NormalTok{(dir))}
      \FunctionTok{stop}\NormalTok{(}\StringTok{"file.exists(dir) == F"}\NormalTok{)}
\NormalTok{    dir }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(dir, }\StringTok{"/fella\_pathway"}\NormalTok{)}
    \FunctionTok{dir.create}\NormalTok{(dir, F)}
\NormalTok{    org }\OtherTok{\textless{}{-}} \FunctionTok{match.arg}\NormalTok{(org)}
\NormalTok{    db.dir }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(dir, }\StringTok{"/"}\NormalTok{, org, }\StringTok{".db.dir"}\NormalTok{)}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{file.exists}\NormalTok{(db.dir) }\SpecialCharTok{\&} \SpecialCharTok{!}\NormalTok{rebuild) \{}
      \FunctionTok{return}\NormalTok{(db.dir)}
\NormalTok{    \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{      graph.file }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(dir, }\StringTok{"/"}\NormalTok{, org, }\StringTok{".graph.Rdata"}\NormalTok{)}
      \FunctionTok{unlink}\NormalTok{(db.dir, T)}
      \FunctionTok{set.seed}\NormalTok{(seed)}
\NormalTok{      graph }\OtherTok{\textless{}{-}}\NormalTok{ FELLA}\SpecialCharTok{::}\FunctionTok{buildGraphFromKEGGREST}\NormalTok{(}\AttributeTok{organism =}\NormalTok{ org)}
      \FunctionTok{save}\NormalTok{(graph, }\AttributeTok{file =}\NormalTok{ graph.file)}
\NormalTok{      FELLA}\SpecialCharTok{::}\FunctionTok{buildDataFromGraph}\NormalTok{(}
        \AttributeTok{keggdata.graph =}\NormalTok{ graph,}
        \AttributeTok{databaseDir =}\NormalTok{ db.dir, }\AttributeTok{internalDir =} \ConstantTok{FALSE}\NormalTok{,}
        \AttributeTok{matrices =} \FunctionTok{c}\NormalTok{(}\StringTok{"hypergeom"}\NormalTok{, }\StringTok{"diffusion"}\NormalTok{, }\StringTok{"pagerank"}\NormalTok{),}
        \AttributeTok{normality =} \FunctionTok{c}\NormalTok{(}\StringTok{"diffusion"}\NormalTok{, }\StringTok{"pagerank"}\NormalTok{),}
        \AttributeTok{dampingFactor =} \FloatTok{0.85}\NormalTok{, }\AttributeTok{niter =} \DecValTok{100}\NormalTok{)}
\NormalTok{    \}}
    \FunctionTok{return}\NormalTok{(db.dir)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export load\_fella}
\CommentTok{\#\textquotesingle{} @aliases load\_fella}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{load\_fella\}: ...}
\CommentTok{\#\textquotesingle{} @rdname pathway\_enrichment}
\NormalTok{load\_fella }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(dir) \{}
  \ControlFlowTok{if}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{file.exists}\NormalTok{(dir))\{}
    \FunctionTok{stop}\NormalTok{(}\StringTok{"file.exists(dir) == F"}\NormalTok{)}
\NormalTok{  \}}
\NormalTok{  FELLA}\SpecialCharTok{::}\FunctionTok{loadKEGGdata}\NormalTok{(}
    \AttributeTok{databaseDir =}\NormalTok{ dir, }\AttributeTok{internalDir =} \ConstantTok{FALSE}\NormalTok{, }
    \AttributeTok{loadMatrix =} \FunctionTok{c}\NormalTok{(}\StringTok{"hypergeom"}\NormalTok{, }\StringTok{"diffusion"}\NormalTok{, }\StringTok{"pagerank"}\NormalTok{)}
\NormalTok{  )}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export enrich\_fella}
\CommentTok{\#\textquotesingle{} @aliases enrich\_fella}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{enrich\_fella\}: ...}
\CommentTok{\#\textquotesingle{} @rdname pathway\_enrichment}
\NormalTok{enrich\_fella }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(id.lst, data) \{}
  \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.list}\NormalTok{(id.lst)) \{}
\NormalTok{    id.lst }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(id.lst)}
\NormalTok{  \}}
  \FunctionTok{lapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(id.lst),}
    \ControlFlowTok{function}\NormalTok{(n) \{}
      \FunctionTok{message}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{========="}\NormalTok{, }\StringTok{"Enrichment:"}\NormalTok{, n, }\StringTok{"========="}\NormalTok{)}
\NormalTok{      id }\OtherTok{\textless{}{-}}\NormalTok{ id.lst[[n]]}
\NormalTok{      res }\OtherTok{\textless{}{-}} \FunctionTok{try}\NormalTok{(}
\NormalTok{        FELLA}\SpecialCharTok{::}\FunctionTok{enrich}\NormalTok{(}
\NormalTok{          id, }\AttributeTok{data =}\NormalTok{ data,}
          \AttributeTok{method =}\NormalTok{ FELLA}\SpecialCharTok{::}\FunctionTok{listMethods}\NormalTok{(),}
          \AttributeTok{approx =} \StringTok{"normality"}
\NormalTok{        )}
\NormalTok{      )}
      \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{inherits}\NormalTok{(res, }\StringTok{"try{-}error"}\NormalTok{))}
        \FunctionTok{return}\NormalTok{(}\ConstantTok{NULL}\NormalTok{)}
      \ControlFlowTok{else}
\NormalTok{        res}
\NormalTok{    \})}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export graph\_fella}
\CommentTok{\#\textquotesingle{} @aliases graph\_fella}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{graph\_fella\}: ...}
\CommentTok{\#\textquotesingle{} @rdname pathway\_enrichment}
\NormalTok{graph\_fella }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{( obj.lst, data, }\AttributeTok{method =} \FunctionTok{c}\NormalTok{(}\StringTok{"pagerank"}\NormalTok{, }\StringTok{"diffusion"}\NormalTok{, }\StringTok{"hypergeom"}\NormalTok{),}
  \AttributeTok{threshold =}\NormalTok{ .}\DecValTok{1}\NormalTok{)}
\NormalTok{\{}
\NormalTok{  method }\OtherTok{\textless{}{-}} \FunctionTok{match.arg}\NormalTok{(method)}
\NormalTok{  graph.lst }\OtherTok{\textless{}{-}}
    \FunctionTok{lapply}\NormalTok{(obj.lst,}
      \ControlFlowTok{function}\NormalTok{(obj) \{}
        \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(obj))}
          \FunctionTok{return}\NormalTok{()}
\NormalTok{        inmap }\OtherTok{\textless{}{-}}\NormalTok{ FELLA}\SpecialCharTok{::}\FunctionTok{getInput}\NormalTok{(obj)}
\NormalTok{        graph }\OtherTok{\textless{}{-}}\NormalTok{ FELLA}\SpecialCharTok{::}\FunctionTok{generateResultsGraph}\NormalTok{(}
          \AttributeTok{object =}\NormalTok{ obj,}
          \AttributeTok{method =}\NormalTok{ method,}
          \AttributeTok{threshold =}\NormalTok{ threshold,}
          \AttributeTok{data =}\NormalTok{ data}
\NormalTok{        )}
\NormalTok{        graph }\OtherTok{\textless{}{-}}\NormalTok{ tidygraph}\SpecialCharTok{::}\FunctionTok{as\_tbl\_graph}\NormalTok{(graph)}
\NormalTok{        graph }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(graph, }\SpecialCharTok{{-}}\NormalTok{entrez)}
\NormalTok{        graph }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(}
\NormalTok{          graph, }\AttributeTok{NAME =} \FunctionTok{vapply}\NormalTok{(NAME, }\ControlFlowTok{function}\NormalTok{(c) c[}\DecValTok{1}\NormalTok{], }\StringTok{""}\NormalTok{),}
          \AttributeTok{abbrev.name =}\NormalTok{ stringr}\SpecialCharTok{::}\FunctionTok{str\_trunc}\NormalTok{(NAME, }\DecValTok{15}\NormalTok{),}
          \AttributeTok{input =} \FunctionTok{ifelse}\NormalTok{(input, }\StringTok{"Input"}\NormalTok{, }\StringTok{"Others"}\NormalTok{),}
          \AttributeTok{type =} \FunctionTok{vapply}\NormalTok{(}
\NormalTok{            name, }\AttributeTok{FUN.VALUE =} \StringTok{""}\NormalTok{, }\AttributeTok{USE.NAMES =}\NormalTok{ F,}
            \ControlFlowTok{function}\NormalTok{(str)\{}
\NormalTok{              str }\OtherTok{\textless{}{-}}\NormalTok{ stringr}\SpecialCharTok{::}\FunctionTok{str\_extract}\NormalTok{(str, }\StringTok{"\^{}[\^{}[0{-}9]]\{1,3\}|}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{."}\NormalTok{)}
\NormalTok{              str }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(}\FunctionTok{nchar}\NormalTok{(str) }\SpecialCharTok{\textgreater{}} \DecValTok{1}\NormalTok{, }\StringTok{"pathway"}\NormalTok{, str)}
              \ControlFlowTok{switch}\NormalTok{(}
\NormalTok{                str, }\AttributeTok{pathway =} \StringTok{"Pathway"}\NormalTok{,}
                \AttributeTok{M =} \StringTok{"Module"}\NormalTok{,}
                \StringTok{"."} \OtherTok{=} \StringTok{"Enzyme"}\NormalTok{,}
                \AttributeTok{C =} \StringTok{"Compound"}\NormalTok{,}
                \AttributeTok{R =} \StringTok{"Reaction"}\NormalTok{)}
\NormalTok{            \}))}
\NormalTok{      \})}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @import ggraph}
\CommentTok{\#\textquotesingle{} @export plotGraph\_fella}
\CommentTok{\#\textquotesingle{} @aliases plotGraph\_fella}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{plotGraph\_fella\}: Draw the graph via}
\CommentTok{\#\textquotesingle{} package of \textquotesingle{}ggplot2\textquotesingle{}.}
\CommentTok{\#\textquotesingle{} @rdname pathway\_enrichment}
\NormalTok{plotGraph\_fella }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(}
\NormalTok{  graph, }\AttributeTok{layout =} \StringTok{"graphopt"}\NormalTok{, }\AttributeTok{seed =} \DecValTok{1}\NormalTok{,}
  \AttributeTok{shape =} \FunctionTok{c}\NormalTok{(}\AttributeTok{Input =} \DecValTok{15}\NormalTok{, }\AttributeTok{Others =} \DecValTok{16}\NormalTok{),}
  \AttributeTok{color =} \FunctionTok{c}\NormalTok{(}
    \AttributeTok{Pathway =} \StringTok{"\#E64B35FF"}\NormalTok{,}
    \AttributeTok{Module =} \StringTok{"\#E377C2"}\NormalTok{,}
    \AttributeTok{Enzyme =} \StringTok{"\#EFC000"}\NormalTok{,}
    \AttributeTok{Reaction =} \StringTok{"\#4DBBD5FF"}\NormalTok{,}
    \AttributeTok{Compound =} \StringTok{"\#00A087FF"}\NormalTok{),}
  \AttributeTok{size =} \FunctionTok{c}\NormalTok{(}
    \AttributeTok{Pathway =} \DecValTok{7}\NormalTok{,}
    \AttributeTok{Module =} \DecValTok{5}\NormalTok{,}
    \AttributeTok{Enzyme =} \DecValTok{6}\NormalTok{,}
    \AttributeTok{Reaction =} \DecValTok{5}\NormalTok{,}
    \AttributeTok{Compound =} \DecValTok{10}\NormalTok{))}
\NormalTok{\{}
  \FunctionTok{set.seed}\NormalTok{(seed)}
\NormalTok{  layout }\OtherTok{\textless{}{-}}\NormalTok{ ggraph}\SpecialCharTok{::}\FunctionTok{create\_layout}\NormalTok{(graph, }\AttributeTok{layout =}\NormalTok{ layout)}
  \FunctionTok{ggraph}\NormalTok{(layout) }\SpecialCharTok{+} 
    \FunctionTok{geom\_edge\_fan}\NormalTok{(}
      \FunctionTok{aes}\NormalTok{(}\AttributeTok{edge\_width =}\NormalTok{ weight),}
      \AttributeTok{color =} \StringTok{"black"}\NormalTok{,}
      \AttributeTok{show.legend =}\NormalTok{ F,}
      \AttributeTok{end\_cap =}\NormalTok{ ggraph}\SpecialCharTok{::}\FunctionTok{circle}\NormalTok{(}\DecValTok{3}\NormalTok{, }\StringTok{\textquotesingle{}mm\textquotesingle{}}\NormalTok{),}
      \AttributeTok{arrow =} \FunctionTok{arrow}\NormalTok{(}\AttributeTok{length =} \FunctionTok{unit}\NormalTok{(}\DecValTok{2}\NormalTok{, }\StringTok{\textquotesingle{}mm\textquotesingle{}}\NormalTok{))) }\SpecialCharTok{+} 
    \FunctionTok{geom\_node\_point}\NormalTok{(}
      \FunctionTok{aes}\NormalTok{(}\AttributeTok{color =}\NormalTok{ type,}
        \AttributeTok{shape =}\NormalTok{ input,}
        \AttributeTok{size =}\NormalTok{ type),}
      \AttributeTok{stroke =} \FloatTok{0.1}\NormalTok{) }\SpecialCharTok{+} 
\NormalTok{    ggraph}\SpecialCharTok{::}\FunctionTok{geom\_node\_text}\NormalTok{(}
      \FunctionTok{aes}\NormalTok{(}\AttributeTok{label =}\NormalTok{ stringr}\SpecialCharTok{::}\FunctionTok{str\_wrap}\NormalTok{(}
\NormalTok{          abbrev.name, }\DecValTok{15}\NormalTok{)),}
      \AttributeTok{size =} \DecValTok{3}\NormalTok{,}
      \AttributeTok{family =}\NormalTok{ .font,}
      \AttributeTok{color =} \StringTok{"black"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{scale\_shape\_manual}\NormalTok{(}\AttributeTok{values =}\NormalTok{ shape) }\SpecialCharTok{+}
    \FunctionTok{scale\_color\_manual}\NormalTok{(}\AttributeTok{values =}\NormalTok{ color) }\SpecialCharTok{+}
    \FunctionTok{scale\_size\_manual}\NormalTok{(}\AttributeTok{values =}\NormalTok{ size) }\SpecialCharTok{+}
    \FunctionTok{scale\_edge\_width}\NormalTok{(}\AttributeTok{range =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.1}\NormalTok{, }\FloatTok{0.3}\NormalTok{)) }\SpecialCharTok{+} 
    \FunctionTok{guides}\NormalTok{(}
      \AttributeTok{size =} \StringTok{"none"}\NormalTok{,}
      \AttributeTok{shape =} \FunctionTok{guide\_legend}\NormalTok{(}\AttributeTok{override.aes =} \FunctionTok{list}\NormalTok{(}\AttributeTok{size =} \DecValTok{4}\NormalTok{)),}
      \AttributeTok{color =} \FunctionTok{guide\_legend}\NormalTok{(}\AttributeTok{override.aes =} \FunctionTok{list}\NormalTok{(}\AttributeTok{size =} \DecValTok{4}\NormalTok{))) }\SpecialCharTok{+}
    \FunctionTok{labs}\NormalTok{(}\AttributeTok{color =} \StringTok{"Category"}\NormalTok{, }\AttributeTok{shape =} \StringTok{"Type"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{theme\_void}\NormalTok{() }\SpecialCharTok{+}
    \FunctionTok{theme}\NormalTok{(}\AttributeTok{text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{family =}\NormalTok{ .font))}
\NormalTok{\}}

\CommentTok{\#\textquotesingle{} @export cid.to.kegg}
\CommentTok{\#\textquotesingle{} @aliases cid.to.kegg}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{cid.to.kegg\}: ...}
\CommentTok{\#\textquotesingle{} @rdname pathway\_enrichment}
\NormalTok{cid.to.kegg }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(cids)\{}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{requireNamespace}\NormalTok{(}\StringTok{"MetaboAnalystR"}\NormalTok{, }\AttributeTok{quietly =}\NormalTok{ T)) \{}
      \FunctionTok{stop}\NormalTok{(}\StringTok{"package \textquotesingle{}MetaboAnalystR\textquotesingle{} not available."}\NormalTok{,}
        \StringTok{"See \textless{}https://github.com/xia{-}lab/MetaboAnalystR\textgreater{} for installation."}\NormalTok{)}
\NormalTok{    \}}
\NormalTok{    obj }\OtherTok{\textless{}{-}}\NormalTok{ MetaboAnalystR}\SpecialCharTok{::}\FunctionTok{InitDataObjects}\NormalTok{(}\StringTok{"conc"}\NormalTok{, }\StringTok{"msetora"}\NormalTok{, F)}
\NormalTok{    obj }\OtherTok{\textless{}{-}}\NormalTok{ MetaboAnalystR}\SpecialCharTok{::}\FunctionTok{Setup.MapData}\NormalTok{(obj, cids)}
\NormalTok{    obj }\OtherTok{\textless{}{-}}\NormalTok{ MetaboAnalystR}\SpecialCharTok{::}\FunctionTok{CrossReferencing}\NormalTok{(obj, }\StringTok{"pubchem"}\NormalTok{)}
\NormalTok{    obj }\OtherTok{\textless{}{-}}\NormalTok{ MetaboAnalystR}\SpecialCharTok{::}\FunctionTok{CreateMappingResultTable}\NormalTok{(obj)}
\NormalTok{    obj }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(obj}\SpecialCharTok{$}\NormalTok{dataSet}\SpecialCharTok{$}\NormalTok{map.table)}
\NormalTok{    dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(obj, KEGG }\SpecialCharTok{!=} \StringTok{"NA"}\NormalTok{)}
\NormalTok{  \}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-pick_annotation.r}{%
\section{File: pick\_annotation.R}\label{file-pick_annotation.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# Following a preset algorithm to get a unique value from the candidate items.}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\#\textquotesingle{} @aliases pick\_annotation}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Pick unique annotation for compounds}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description Pick unique chemical class or synonyms for \textquotesingle{}features\textquotesingle{}.}
\CommentTok{\#\textquotesingle{} @family queries}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name pick\_annotation}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @export pick\_class}
\CommentTok{\#\textquotesingle{} @aliases pick\_class}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{pick\_class\}: ...}
\CommentTok{\#\textquotesingle{} @rdname pick\_annotation}
\NormalTok{pick\_class }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(inchikey2d, class.rdata, }\AttributeTok{filter =}\NormalTok{ .filter\_pick.class, }
    \AttributeTok{fun =}\NormalTok{ PickClass)\{}
\NormalTok{    class }\OtherTok{\textless{}{-}} \FunctionTok{extract\_rdata\_list}\NormalTok{(class.rdata, inchikey2d)}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(filter)) \{}
\NormalTok{      class }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(class, }\AttributeTok{idcol =}\NormalTok{ T))}
\NormalTok{      class }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(class, }\SpecialCharTok{!!!}\NormalTok{filter)}
\NormalTok{      class }\OtherTok{\textless{}{-}} \FunctionTok{split}\NormalTok{(class, }\SpecialCharTok{\textasciitilde{}}\NormalTok{ .id)}
\NormalTok{    \}}
\NormalTok{    class }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(inchikey2d, }\AttributeTok{simplify =}\NormalTok{ F,}
      \ControlFlowTok{function}\NormalTok{(key2d) \{}
\NormalTok{        class[[ key2d ]]}\SpecialCharTok{$}\NormalTok{Classification}
\NormalTok{      \})}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(fun)) \{}
\NormalTok{      class }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(class, fun)}
\NormalTok{    \}}
    \FunctionTok{unlist}\NormalTok{(class)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export .filter\_pick.class}
\CommentTok{\#\textquotesingle{} @aliases .filter\_pick.class}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{.filter\_pick.class\}: ...}
\CommentTok{\#\textquotesingle{} @rdname pick\_annotation}
\NormalTok{.filter\_pick.class }\OtherTok{\textless{}{-}} 
  \FunctionTok{list}\NormalTok{(}\FunctionTok{quote}\NormalTok{(}\SpecialCharTok{!}\NormalTok{Level }\SpecialCharTok{\%in\%}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{all\_of}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"kingdom"}\NormalTok{, }\StringTok{"level 7"}\NormalTok{, }\StringTok{"level 8"}\NormalTok{, }\StringTok{"level 9"}\NormalTok{))),}
    \FunctionTok{quote}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{grepl}\NormalTok{(}\StringTok{"[0{-}9]|Organ"}\NormalTok{, Classification))}
\NormalTok{  )}

\CommentTok{\#\textquotesingle{} @export PickClass}
\CommentTok{\#\textquotesingle{} @aliases PickClass}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{PickClass\}: ...}
\CommentTok{\#\textquotesingle{} @rdname pick\_annotation}
\NormalTok{PickClass }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(class)\{}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(class)) }\ConstantTok{NA}
    \ControlFlowTok{else} \FunctionTok{tail}\NormalTok{(class, }\AttributeTok{n =} \DecValTok{1}\NormalTok{)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export pick\_synonym}
\CommentTok{\#\textquotesingle{} @aliases pick\_synonym}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{pick\_synonym\}: ...}
\CommentTok{\#\textquotesingle{} @rdname pick\_annotation}
\NormalTok{pick\_synonym }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(}\AttributeTok{inchikey2d =} \ConstantTok{NULL}\NormalTok{, }\AttributeTok{inchikey.rdata =} \ConstantTok{NULL}\NormalTok{,}
\NormalTok{    synonym.rdata, }\AttributeTok{iupac.rdata =} \ConstantTok{NULL}\NormalTok{,}
    \AttributeTok{filter =}\NormalTok{ .filter\_pick.general, }\AttributeTok{fun =}\NormalTok{ PickGeneral) \{}
\NormalTok{    syno }\OtherTok{\textless{}{-}} \FunctionTok{extract\_rdata\_list}\NormalTok{(synonym.rdata)}
\NormalTok{    syno }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(syno))}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(filter)) \{}
\NormalTok{      syno }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(syno, }\SpecialCharTok{!!!}\NormalTok{filter)}
\NormalTok{    \}}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(inchikey2d)) \{}
\NormalTok{      inchikey }\OtherTok{\textless{}{-}} \FunctionTok{extract\_rdata\_list}\NormalTok{(inchikey.rdata, inchikey2d)}
\NormalTok{      meta }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(inchikey, }\AttributeTok{simplify =}\NormalTok{ F, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{as.character}\NormalTok{(x}\SpecialCharTok{$}\NormalTok{CID))}
\NormalTok{      syno}\SpecialCharTok{$}\NormalTok{cid }\OtherTok{\textless{}{-}} \FunctionTok{as.character}\NormalTok{(syno}\SpecialCharTok{$}\NormalTok{cid)}
\NormalTok{      syno }\OtherTok{\textless{}{-}} \FunctionTok{group\_switch}\NormalTok{(syno, meta, }\AttributeTok{by =} \StringTok{"cid"}\NormalTok{)}
\NormalTok{      syno }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(inchikey2d, }\AttributeTok{simplify =}\NormalTok{ F,}
        \ControlFlowTok{function}\NormalTok{(key2d) \{}
          \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(syno[[ key2d ]]))}
            \FunctionTok{return}\NormalTok{()}
          \ControlFlowTok{else}
\NormalTok{            syno[[ key2d ]]}\SpecialCharTok{$}\NormalTok{syno}
\NormalTok{        \})}
\NormalTok{    \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{      syno }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{split}\NormalTok{(syno, }\SpecialCharTok{\textasciitilde{}}\NormalTok{ cid), }\ControlFlowTok{function}\NormalTok{(set) set}\SpecialCharTok{$}\NormalTok{syno)}
\NormalTok{    \}}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(iupac.rdata)) \{}
\NormalTok{      iupac }\OtherTok{\textless{}{-}} \FunctionTok{extract\_rdata\_list}\NormalTok{(iupac.rdata, inchikey2d)}
      \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(inchikey2d)) \{}
\NormalTok{        iupac }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(iupac)}
\NormalTok{        iupac }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{split}\NormalTok{(iupac, }\SpecialCharTok{\textasciitilde{}}\NormalTok{ CID), }\ControlFlowTok{function}\NormalTok{(set) set}\SpecialCharTok{$}\NormalTok{IUPACName)}
\NormalTok{      \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{        iupac }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(iupac, }\ControlFlowTok{function}\NormalTok{(set) set}\SpecialCharTok{$}\NormalTok{IUPACName)}
\NormalTok{      \}}
\NormalTok{      syno }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(syno), }\AttributeTok{simplify =}\NormalTok{ F,}
        \ControlFlowTok{function}\NormalTok{(name) \{}
          \FunctionTok{c}\NormalTok{(syno[[ name ]], iupac[[ name ]])}
\NormalTok{        \})}
\NormalTok{    \}}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(fun)) \{}
\NormalTok{      syno }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(syno, fun)}
\NormalTok{    \}}
    \FunctionTok{unlist}\NormalTok{(syno)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export .filter\_pick.general}
\CommentTok{\#\textquotesingle{} @aliases .filter\_pick.general}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{.filter\_pick.general\}: ...}
\CommentTok{\#\textquotesingle{} @rdname pick\_annotation}
\NormalTok{.filter\_pick.general }\OtherTok{\textless{}{-}}
  \FunctionTok{list}\NormalTok{(}\FunctionTok{quote}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(syno)),}
    \FunctionTok{quote}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{grepl}\NormalTok{(}\StringTok{\textquotesingle{}[0{-}9]\{3\}\textquotesingle{}}\NormalTok{, syno)),}
    \FunctionTok{quote}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{grepl}\NormalTok{(}\StringTok{\textquotesingle{}\^{}[A{-}Z{-}]\{1,5\}$\textquotesingle{}}\NormalTok{, syno)),}
    \FunctionTok{quote}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{grepl}\NormalTok{(}\StringTok{\textquotesingle{}\^{}[A{-}Z0{-}9]\{1,\}$\textquotesingle{}}\NormalTok{, syno)),}
    \FunctionTok{quote}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{grepl}\NormalTok{(}\StringTok{\textquotesingle{}(?\textless{}={-})[A{-}Z0{-}9]\{5,\}$\textquotesingle{}}\NormalTok{, syno, }\AttributeTok{perl =}\NormalTok{ T)),}
    \FunctionTok{quote}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{grepl}\NormalTok{(}\StringTok{\textquotesingle{}\^{}[0{-}9{-}]*$\textquotesingle{}}\NormalTok{, syno))}
\NormalTok{  )}

\CommentTok{\#\textquotesingle{} @export PickGeneral}
\CommentTok{\#\textquotesingle{} @aliases PickGeneral}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{PickGeneral\}: ...}
\CommentTok{\#\textquotesingle{} @rdname pick\_annotation}
\NormalTok{PickGeneral }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(syno,}
  \AttributeTok{ps =} \FunctionTok{c}\NormalTok{(}\StringTok{"\^{}[a{-}zA{-}Z]*$"}\NormalTok{, }\StringTok{"\^{}[a{-}zA{-}Z{-}]*$"}\NormalTok{,}
    \StringTok{"\^{}[a{-}zA{-}Z0{-}9{-}]*$"}\NormalTok{, }\StringTok{"\^{}[\^{}:]*$"}\NormalTok{)}
\NormalTok{  )\{}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(syno)) }\FunctionTok{return}\NormalTok{(}\ConstantTok{NA}\NormalTok{)}
  \FunctionTok{unlist}\NormalTok{(}\FunctionTok{lapply}\NormalTok{(ps, }\ControlFlowTok{function}\NormalTok{(p) syno[}\FunctionTok{grepl}\NormalTok{(p, syno)]))[}\DecValTok{1}\NormalTok{]}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-plot_eic_stack.r}{%
\section{File: plot\_EIC\_stack.R}\label{file-plot_eic_stack.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# plot extracted ions chromatograph (EIC) for features using \textasciigrave{}MSnbase\textasciigrave{}}
\CommentTok{\# to extract mass data.}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\#\textquotesingle{} @aliases plot\_EIC\_stack}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Draw extracted ions chromatography for \textquotesingle{}features\textquotesingle{}}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description Use quantification table (with peak start time and end time)}
\CommentTok{\#\textquotesingle{} exported by MCmine to draw EIC plot.}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name plot\_EIC\_stack}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @export plot\_EIC\_stack}
\CommentTok{\#\textquotesingle{} @aliases plot\_EIC\_stack}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{plot\_EIC\_stack\}: ...}
\CommentTok{\#\textquotesingle{} @rdname plot\_EIC\_stack}
\NormalTok{plot\_EIC\_stack }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(}
\NormalTok{    idset,}
\NormalTok{    metadata,}
\NormalTok{    quant.path,}
\NormalTok{    mzml.path,}
    \AttributeTok{palette =}\NormalTok{ ggsci}\SpecialCharTok{::}\FunctionTok{pal\_npg}\NormalTok{()(}\DecValTok{10}\NormalTok{),}
    \AttributeTok{mz.tol =} \FloatTok{0.01}\NormalTok{,}
    \AttributeTok{rt.tol =} \FloatTok{0.1}\NormalTok{,}
    \AttributeTok{cl =} \ConstantTok{NULL}\NormalTok{,}
    \AttributeTok{data =} \ConstantTok{NULL}\NormalTok{)}
\NormalTok{  \{}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(data)) \{}
      \FunctionTok{.suggest\_bio\_package}\NormalTok{(}\StringTok{"MSnbase"}\NormalTok{)}
      \DocumentationTok{\#\# metadata}
      \FunctionTok{.check\_columns}\NormalTok{(metadata, }\FunctionTok{c}\NormalTok{(}\StringTok{"file"}\NormalTok{, }\StringTok{"sample"}\NormalTok{, }\StringTok{"group"}\NormalTok{), }\StringTok{"metadata"}\NormalTok{)}
\NormalTok{      metadata }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{arrange}\NormalTok{(metadata, sample)}
\NormalTok{      feature }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{fread}\NormalTok{(quant.path)}
      \FunctionTok{.check\_columns}\NormalTok{(}
\NormalTok{        feature, }\FunctionTok{c}\NormalTok{(}\StringTok{"row ID"}\NormalTok{,    }\StringTok{"row m/z"}\NormalTok{, }\StringTok{"row retention time"}\NormalTok{),}
        \StringTok{"data.table::fread(quant.path)"}
\NormalTok{      )}
\NormalTok{      feature }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(}
\NormalTok{        feature, }\AttributeTok{.features\_id =} \DecValTok{1}\NormalTok{, }\AttributeTok{mz =} \DecValTok{2}\NormalTok{, }\AttributeTok{rt =} \DecValTok{3}\NormalTok{,}
\NormalTok{        dplyr}\SpecialCharTok{::}\FunctionTok{contains}\NormalTok{(metadata}\SpecialCharTok{$}\NormalTok{sample) }\SpecialCharTok{\&}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{contains}\NormalTok{(}\StringTok{"Peak RT"}\NormalTok{)}
\NormalTok{      )}
      \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{ncol}\NormalTok{(feature) }\SpecialCharTok{==} \DecValTok{3}\NormalTok{) \{}
        \FunctionTok{stop}\NormalTok{(}\StringTok{"\textasciigrave{}feature\textasciigrave{} get by data.table::fread(quant.path) not contains \textquotesingle{}Peak RT\textquotesingle{} information."}\NormalTok{)}
\NormalTok{      \}}
\NormalTok{      feature }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(feature, }\AttributeTok{.features\_id =} \FunctionTok{as.character}\NormalTok{(.features\_id))}
\NormalTok{      feature }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(feature, .features\_id }\SpecialCharTok{\%in\%}\NormalTok{ idset)}
\NormalTok{      feature }\OtherTok{\textless{}{-}}\NormalTok{ tidyr}\SpecialCharTok{::}\FunctionTok{gather}\NormalTok{(feature, type, time, }\SpecialCharTok{{-}}\NormalTok{.features\_id, }\SpecialCharTok{{-}}\NormalTok{mz, }\SpecialCharTok{{-}}\NormalTok{rt)}
\NormalTok{      feature }\OtherTok{\textless{}{-}}\NormalTok{ feature.rt.during }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(}
\NormalTok{        feature, }\AttributeTok{time =} \FunctionTok{ifelse}\NormalTok{(time }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, }\ConstantTok{NA}\NormalTok{, time),}
        \AttributeTok{sub.type =}\NormalTok{ stringr}\SpecialCharTok{::}\FunctionTok{str\_extract}\NormalTok{(type, }\StringTok{"(?\textless{}=RT ).*?$"}\NormalTok{),}
        \AttributeTok{sample =} \FunctionTok{gsub}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.mz.\{{-}\}ML Peak RT.*$"}\NormalTok{, }\StringTok{""}\NormalTok{, type)}
\NormalTok{      )}
\NormalTok{      feature }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{group\_by}\NormalTok{(feature, .features\_id, mz, rt, sub.type)}
\NormalTok{      feature }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{summarize}\NormalTok{(}
\NormalTok{        feature, }\AttributeTok{sub.type.min =} \FunctionTok{min}\NormalTok{(time, }\AttributeTok{na.rm =}\NormalTok{ T),}
        \AttributeTok{sub.type.max =} \FunctionTok{max}\NormalTok{(time, }\AttributeTok{na.rm =}\NormalTok{ T),}
        \AttributeTok{.groups =} \StringTok{"drop\_last"}
\NormalTok{      )}
\NormalTok{      feature }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(}
\NormalTok{        feature, }\AttributeTok{time =} \FunctionTok{ifelse}\NormalTok{(sub.type }\SpecialCharTok{==} \StringTok{"start"}\NormalTok{, sub.type.min, sub.type.max)}
\NormalTok{      )}
\NormalTok{      feature }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(feature, }\SpecialCharTok{{-}}\FunctionTok{contains}\NormalTok{(}\StringTok{"sub.type."}\NormalTok{))}
\NormalTok{      feature }\OtherTok{\textless{}{-}}\NormalTok{ tidyr}\SpecialCharTok{::}\FunctionTok{spread}\NormalTok{(feature, sub.type, time)}
      \DocumentationTok{\#\# read data}
      \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(cl))}
        \FunctionTok{bioc.par}\NormalTok{(cl)}
\NormalTok{      data }\OtherTok{\textless{}{-}}\NormalTok{ MSnbase}\SpecialCharTok{::}\FunctionTok{readMSData}\NormalTok{(}
        \FunctionTok{paste0}\NormalTok{(mzml.path, }\StringTok{"/"}\NormalTok{, metadata}\SpecialCharTok{$}\NormalTok{file),}
        \AttributeTok{pdata =} \FunctionTok{new}\NormalTok{(}\StringTok{"NAnnotatedDataFrame"}\NormalTok{, metadata),}
        \AttributeTok{mode =} \StringTok{"onDisk"}
\NormalTok{      )}
      \DocumentationTok{\#\# extract EIC}
\NormalTok{      rt.tol.sec }\OtherTok{\textless{}{-}}\NormalTok{ rt.tol }\SpecialCharTok{*} \DecValTok{60}
      \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(cl))}
        \FunctionTok{bioc.par}\NormalTok{(cl)}
\NormalTok{      eic.list }\OtherTok{\textless{}{-}}\NormalTok{ pbapply}\SpecialCharTok{::}\FunctionTok{pbapply}\NormalTok{(}
\NormalTok{        feature, }\DecValTok{1}\NormalTok{,}
        \ControlFlowTok{function}\NormalTok{(vec)\{}
          \DocumentationTok{\#\# mz range for EIC}
\NormalTok{          mz }\OtherTok{\textless{}{-}} \FunctionTok{as.numeric}\NormalTok{(vec[[}\StringTok{"mz"}\NormalTok{]])}
\NormalTok{          mz.range }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(mz }\SpecialCharTok{{-}}\NormalTok{ mz.tol, mz }\SpecialCharTok{+}\NormalTok{ mz.tol)}
          \DocumentationTok{\#\# rt range for EIC}
\NormalTok{          rt.range }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(vec[[}\StringTok{"start"}\NormalTok{]], vec[[}\StringTok{"end"}\NormalTok{]])}
\NormalTok{          rt.range }\OtherTok{\textless{}{-}} \FunctionTok{as.numeric}\NormalTok{(rt.range) }\SpecialCharTok{*} \DecValTok{60}
\NormalTok{          rt.range }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(rt.range[}\DecValTok{1}\NormalTok{] }\SpecialCharTok{{-}}\NormalTok{ rt.tol.sec, rt.range[}\DecValTok{2}\NormalTok{] }\SpecialCharTok{+}\NormalTok{ rt.tol.sec)}
\NormalTok{          ms1.vec }\OtherTok{\textless{}{-}}\NormalTok{ MSnbase}\SpecialCharTok{::}\FunctionTok{chromatogram}\NormalTok{(data, }\AttributeTok{msLevel =}\NormalTok{ 1L, }\AttributeTok{mz =}\NormalTok{ mz.range,}
            \AttributeTok{rt =}\NormalTok{ rt.range, }\AttributeTok{aggregationFun =} \StringTok{"max"}\NormalTok{)}
\NormalTok{          data.list }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\FunctionTok{unlist}\NormalTok{(ms1.vec),}
            \ControlFlowTok{function}\NormalTok{(chr)\{}
\NormalTok{              int }\OtherTok{\textless{}{-}}\NormalTok{ MSnbase}\SpecialCharTok{::}\FunctionTok{intensity}\NormalTok{(chr)}
\NormalTok{              rt }\OtherTok{\textless{}{-}}\NormalTok{ MSnbase}\SpecialCharTok{::}\FunctionTok{rtime}\NormalTok{(chr)}
              \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{real.time =}\NormalTok{ rt, }\AttributeTok{int =}\NormalTok{ int)}
\NormalTok{            \})}
          \FunctionTok{names}\NormalTok{(data.list) }\OtherTok{\textless{}{-}}\NormalTok{ metadata}\SpecialCharTok{$}\NormalTok{sample}
\NormalTok{          df }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(data.list, }\AttributeTok{idcol =}\NormalTok{ T)}
\NormalTok{          df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{rename}\NormalTok{(df, }\AttributeTok{sample =}\NormalTok{ .id)}
\NormalTok{          dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(df, }\AttributeTok{.features\_id =}\NormalTok{ vec[[}\StringTok{".features\_id"}\NormalTok{]])}
\NormalTok{        \})}
      \DocumentationTok{\#\# define whether the peak belong to the feature}
\NormalTok{      eic.df }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(eic.list)}
\NormalTok{      eic.df }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}
\NormalTok{        eic.df, feature.rt.during, }\AttributeTok{by =} \FunctionTok{c}\NormalTok{(}\StringTok{".features\_id"}\NormalTok{, }\StringTok{"sample"}\NormalTok{), }\AttributeTok{allow.cartesian =}\NormalTok{ T}
\NormalTok{      )}
\NormalTok{      eic.df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(eic.df, }\SpecialCharTok{{-}}\NormalTok{type)}
\NormalTok{      eic.df }\OtherTok{\textless{}{-}}\NormalTok{ tidyr}\SpecialCharTok{::}\FunctionTok{spread}\NormalTok{(eic.df, }\AttributeTok{key =}\NormalTok{ sub.type, }\AttributeTok{value =}\NormalTok{ time)}
\NormalTok{      eic.df }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(eic.df, metadata, }\AttributeTok{by =} \StringTok{"sample"}\NormalTok{, }\AttributeTok{all.x =}\NormalTok{ T)}
\NormalTok{      eic.df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(}
\NormalTok{        eic.df, }\AttributeTok{real.time.min =}\NormalTok{ real.time }\SpecialCharTok{/} \DecValTok{60}\NormalTok{,}
        \AttributeTok{feature =} \FunctionTok{ifelse}\NormalTok{(real.time.min }\SpecialCharTok{\textgreater{}=}\NormalTok{ start }\SpecialCharTok{\&}\NormalTok{ real.time.min }\SpecialCharTok{\textless{}=}\NormalTok{ end,}
\NormalTok{          sample, }\StringTok{"Non feature"}\NormalTok{),}
        \AttributeTok{fill =} \FunctionTok{ifelse}\NormalTok{(feature }\SpecialCharTok{==} \StringTok{"Non feature"}\NormalTok{, feature, group),}
        \AttributeTok{mz =} \FunctionTok{round}\NormalTok{(mz, }\DecValTok{4}\NormalTok{),}
        \AttributeTok{anno.mz =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Precursor m/z:}\SpecialCharTok{\textbackslash{}n}\StringTok{  "}\NormalTok{, mz }\SpecialCharTok{{-}}\NormalTok{ mz.tol, }\StringTok{"\textasciitilde{}"}\NormalTok{, mz }\SpecialCharTok{+}\NormalTok{ mz.tol),}
        \AttributeTok{anno.rt =} \FunctionTok{paste}\NormalTok{(}\StringTok{"RT (min):"}\NormalTok{, }\FunctionTok{round}\NormalTok{(rt, }\DecValTok{1}\NormalTok{)),}
        \AttributeTok{anno =} \FunctionTok{paste0}\NormalTok{(anno.mz, }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{, anno.rt)}
\NormalTok{      )}
      \DocumentationTok{\#\# annotation (mz and rt)}
\NormalTok{      anno }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(eic.df, .features\_id, int, real.time.min, }\FunctionTok{contains}\NormalTok{(}\StringTok{"anno"}\NormalTok{))}
\NormalTok{      anno }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{group\_by}\NormalTok{(anno, .features\_id)}
\NormalTok{      anno }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{summarize}\NormalTok{(}
\NormalTok{        anno, }\AttributeTok{anno.x =} \FunctionTok{min}\NormalTok{(real.time.min, }\AttributeTok{na.rm =}\NormalTok{ T),}
        \AttributeTok{anno.y =} \FunctionTok{max}\NormalTok{(int, }\AttributeTok{na.rm =}\NormalTok{ T) }\SpecialCharTok{*} \DecValTok{3} \SpecialCharTok{/} \DecValTok{4}\NormalTok{,}
        \AttributeTok{anno =} \FunctionTok{unique}\NormalTok{(anno)}
\NormalTok{      )}
\NormalTok{      data }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{eic.df =}\NormalTok{ eic.df, }\AttributeTok{anno =}\NormalTok{ anno)}
\NormalTok{    \}}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{any}\NormalTok{(}\FunctionTok{names}\NormalTok{(palette) }\SpecialCharTok{==} \StringTok{"Non feature"}\NormalTok{)) \{}
\NormalTok{      palette[[ }\StringTok{"Non feature"}\NormalTok{ ]] }\OtherTok{\textless{}{-}} \StringTok{"grey95"}
\NormalTok{    \}}
\NormalTok{    data}\SpecialCharTok{$}\NormalTok{p }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(data[[ }\StringTok{"eic.df"}\NormalTok{ ]]) }\SpecialCharTok{+}
      \FunctionTok{geom\_line}\NormalTok{(}
        \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ real.time.min,}
          \AttributeTok{y =}\NormalTok{ int,}
          \AttributeTok{group =}\NormalTok{ sample,}
          \AttributeTok{color =}\NormalTok{ fill),}
        \AttributeTok{lineend =} \StringTok{"round"}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{labs}\NormalTok{(}\AttributeTok{color =} \StringTok{"Peak attribution"}\NormalTok{, }\AttributeTok{x =} \StringTok{"RT (min)"}\NormalTok{, }\AttributeTok{y =} \StringTok{"Intensity"}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{geom\_text}\NormalTok{(}\AttributeTok{data =}\NormalTok{ data[[ }\StringTok{"anno"}\NormalTok{ ]],}
        \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ anno.x, }\AttributeTok{y =}\NormalTok{ anno.y, }\AttributeTok{label =}\NormalTok{ anno),}
        \AttributeTok{hjust =} \DecValTok{0}\NormalTok{, }\AttributeTok{fontface =} \StringTok{"bold"}\NormalTok{, }\AttributeTok{family =}\NormalTok{ .font) }\SpecialCharTok{+}
      \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{labels =}\NormalTok{ scales}\SpecialCharTok{::}\NormalTok{scientific) }\SpecialCharTok{+}
      \FunctionTok{facet\_wrap}\NormalTok{( }\SpecialCharTok{\textasciitilde{}} \FunctionTok{paste}\NormalTok{(}\StringTok{"ID:"}\NormalTok{, .features\_id), }\AttributeTok{scales =} \StringTok{"free"}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{theme\_minimal}\NormalTok{() }\SpecialCharTok{+}
      \FunctionTok{scale\_color\_manual}\NormalTok{(}\AttributeTok{values =}\NormalTok{ palette) }\SpecialCharTok{+}
      \FunctionTok{theme}\NormalTok{(}\AttributeTok{text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{family =}\NormalTok{ .font),}
        \AttributeTok{plot.background =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{"white"}\NormalTok{, }\AttributeTok{size =} \DecValTok{0}\NormalTok{, }\AttributeTok{color =} \StringTok{"transparent"}\NormalTok{),}
        \AttributeTok{strip.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{12}\NormalTok{)) }\SpecialCharTok{+}
      \FunctionTok{geom\_blank}\NormalTok{()}
    \FunctionTok{return}\NormalTok{(data)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export bioc.par}
\CommentTok{\#\textquotesingle{} @aliases bioc.par}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{bioc.par\}: ...}
\CommentTok{\#\textquotesingle{} @rdname plot\_EIC\_stack}
\NormalTok{bioc.par }\OtherTok{\textless{}{-}}
  \ControlFlowTok{function}\NormalTok{(}\AttributeTok{cl =} \DecValTok{4}\NormalTok{)\{}
\NormalTok{    BiocParallel}\SpecialCharTok{::}\FunctionTok{register}\NormalTok{(}
\NormalTok{      BiocParallel}\SpecialCharTok{::}\FunctionTok{bpstart}\NormalTok{(}
\NormalTok{        BiocParallel}\SpecialCharTok{::}\FunctionTok{MulticoreParam}\NormalTok{(cl)}
\NormalTok{      )}
\NormalTok{    )}
\NormalTok{  \}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-query_classification.r}{%
\section{File: query\_classification.R}\label{file-query_classification.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# query classification for compounds using classyfire API}
\CommentTok{\# run after query\_inchikey}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\#\textquotesingle{} @aliases query\_classification}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Query classification of compounds via packgage of \textquotesingle{}classifyerR\textquotesingle{}}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description The used function is:}
\CommentTok{\#\textquotesingle{} \textbackslash{}code\{classyfireR::get\_classification(inchikey)\}}
\CommentTok{\#\textquotesingle{} @family queries}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name query\_classification}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @export query\_classification}
\CommentTok{\#\textquotesingle{} @aliases query\_classification}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{query\_classification\}: ...}
\CommentTok{\#\textquotesingle{} @rdname query\_classification}
\NormalTok{query\_classification }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(}
\NormalTok{    inchikey2d,}
\NormalTok{    dir,}
    \AttributeTok{inchikey.rdata =} \FunctionTok{paste0}\NormalTok{(dir, }\StringTok{"/inchikey.rdata"}\NormalTok{),}
    \AttributeTok{rdata.name =} \StringTok{"classification.rdata"}\NormalTok{,}
    \AttributeTok{classyfire\_cl =} \ConstantTok{NULL}\NormalTok{,}
    \AttributeTok{gather\_as\_rdata =}\NormalTok{ T,}
\NormalTok{    ...}
\NormalTok{    )\{}
\NormalTok{    rdata }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(dir, }\StringTok{"/"}\NormalTok{, rdata.name)}
\NormalTok{    classes }\OtherTok{\textless{}{-}} \FunctionTok{extract\_rdata\_list}\NormalTok{(rdata)}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(classes))}
\NormalTok{      inchikey2d }\OtherTok{\textless{}{-}}\NormalTok{ inchikey2d[}\SpecialCharTok{!}\NormalTok{inchikey2d }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(classes)]}
    \ControlFlowTok{if}\NormalTok{(}\FunctionTok{length}\NormalTok{(inchikey2d) }\SpecialCharTok{==} \DecValTok{0}\NormalTok{)}
      \FunctionTok{return}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(dir, }\StringTok{"/"}\NormalTok{, rdata.name))}
\NormalTok{    inchikey\_set }\OtherTok{\textless{}{-}} \FunctionTok{extract\_rdata\_list}\NormalTok{(inchikey.rdata, inchikey2d)}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(inchikey\_set))}
      \FunctionTok{stop}\NormalTok{(}\StringTok{"is.null(inchikey\_set) == T. File \textasciigrave{}inchikey.rdata\textasciigrave{} may not exists."}\NormalTok{)}
\NormalTok{    sets }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(inchikey\_set, }\ControlFlowTok{function}\NormalTok{(df)\{}
      \ControlFlowTok{if}\NormalTok{(}\StringTok{"InChIKey"} \SpecialCharTok{\%in\%} \FunctionTok{colnames}\NormalTok{(df))}
        \FunctionTok{return}\NormalTok{(df)}
\NormalTok{    \})}
\NormalTok{    sets }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(sets)}
\NormalTok{    sets }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(sets, }\AttributeTok{inchikey2d =}\NormalTok{ stringr}\SpecialCharTok{::}\FunctionTok{str\_extract}\NormalTok{(InChIKey, }\StringTok{"\^{}[A{-}Z]\{1,\}"}\NormalTok{))}
\NormalTok{    l }\OtherTok{\textless{}{-}} \FunctionTok{classyfire\_get\_classification}\NormalTok{(sets, dir, }\AttributeTok{classyfire\_cl =}\NormalTok{ classyfire\_cl, ...)}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.logical}\NormalTok{(l))}
      \FunctionTok{return}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(dir, }\StringTok{"/"}\NormalTok{, rdata.name))}
    \ControlFlowTok{if}\NormalTok{ (gather\_as\_rdata) \{}
      \FunctionTok{cat}\NormalTok{(}\StringTok{"\#\# gather data}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
      \FunctionTok{packing\_as\_rdata\_list}\NormalTok{(dir, }\AttributeTok{pattern =} \StringTok{"\^{}[A{-}Z]\{14\}$"}\NormalTok{,}
        \AttributeTok{rdata =}\NormalTok{ rdata.name, }\AttributeTok{extra =}\NormalTok{ classes)}
\NormalTok{    \}}
    \FunctionTok{return}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(dir, }\StringTok{"/"}\NormalTok{, rdata.name))}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export classyfire\_get\_classification}
\CommentTok{\#\textquotesingle{} @aliases classyfire\_get\_classification}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{classyfire\_get\_classification\}: ...}
\CommentTok{\#\textquotesingle{} @rdname query\_classification}
\NormalTok{classyfire\_get\_classification }\OtherTok{\textless{}{-}}
  \ControlFlowTok{function}\NormalTok{(}
\NormalTok{    sets,}
\NormalTok{    dir,}
    \AttributeTok{classyfire\_cl =} \ConstantTok{NULL}\NormalTok{,}
    \AttributeTok{log\_file =} \FunctionTok{paste0}\NormalTok{(dir, }\StringTok{"/classyfire.log"}\NormalTok{),}
\NormalTok{    ...}
\NormalTok{    )\{}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{file.exists}\NormalTok{(log\_file))\{}
\NormalTok{      log\_df }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{fread}\NormalTok{(log\_file)}
\NormalTok{      sets }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(sets, }\SpecialCharTok{!}\NormalTok{InChIKey }\SpecialCharTok{\%in\%}\NormalTok{ log\_df}\SpecialCharTok{$}\NormalTok{log)}
      \ControlFlowTok{if}\NormalTok{(}\FunctionTok{nrow}\NormalTok{(sets) }\SpecialCharTok{==} \DecValTok{0}\NormalTok{)}
        \FunctionTok{return}\NormalTok{(F)}
\NormalTok{    \}}
\NormalTok{    sets }\OtherTok{\textless{}{-}} \FunctionTok{split}\NormalTok{(}\FunctionTok{data.frame}\NormalTok{(sets), }\SpecialCharTok{\textasciitilde{}}\NormalTok{ inchikey2d)}
\NormalTok{    log }\OtherTok{\textless{}{-}}\NormalTok{ pbapply}\SpecialCharTok{::}\FunctionTok{pblapply}\NormalTok{(}\FunctionTok{names}\NormalTok{(sets), }\AttributeTok{cl =}\NormalTok{ classyfire\_cl,}
      \ControlFlowTok{function}\NormalTok{(inchikey2d) \{}
\NormalTok{        set }\OtherTok{\textless{}{-}}\NormalTok{ sets[[ inchikey2d ]]}
        \FunctionTok{unlist}\NormalTok{(}\FunctionTok{lapply}\NormalTok{(set[[}\StringTok{"InChIKey"}\NormalTok{]], .get\_classification,}
            \AttributeTok{file =} \FunctionTok{paste0}\NormalTok{(dir, }\StringTok{"/"}\NormalTok{, inchikey2d)),}
          \AttributeTok{use.names =}\NormalTok{ F)}
\NormalTok{      \})}
\NormalTok{    log }\OtherTok{\textless{}{-}} \FunctionTok{unlist}\NormalTok{(log, }\AttributeTok{use.names =}\NormalTok{ F)}
\NormalTok{    log }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{log =}\NormalTok{ log)}
    \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{exists}\NormalTok{(}\StringTok{"log\_df"}\NormalTok{))}
\NormalTok{      log }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{bind\_rows}\NormalTok{(log\_df, log)}
    \FunctionTok{write\_tsv}\NormalTok{(log, }\AttributeTok{file =}\NormalTok{ log\_file)}
\NormalTok{  \}}

\NormalTok{.get\_classification }\OtherTok{\textless{}{-}}
  \ControlFlowTok{function}\NormalTok{(inchikey, file)\{}
    \ControlFlowTok{if}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{file.exists}\NormalTok{(file))\{}
\NormalTok{      ch }\OtherTok{\textless{}{-}}\NormalTok{ classyfireR}\SpecialCharTok{::}\FunctionTok{get\_classification}\NormalTok{(inchikey)}
\NormalTok{    \}}\ControlFlowTok{else}\NormalTok{\{}
      \FunctionTok{return}\NormalTok{()}
\NormalTok{    \}}
    \ControlFlowTok{if}\NormalTok{(}\FunctionTok{is.null}\NormalTok{(ch))\{}
      \FunctionTok{return}\NormalTok{(inchikey)}
\NormalTok{    \}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{      ch }\OtherTok{\textless{}{-}}\NormalTok{ classyfireR}\SpecialCharTok{::}\FunctionTok{classification}\NormalTok{(ch)}
      \FunctionTok{write\_tsv}\NormalTok{(ch, file)}
\NormalTok{    \}}
\NormalTok{  \}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-query_inchikey.r}{%
\section{File: query\_inchikey.R}\label{file-query_inchikey.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# query inchikey for compounds using pubchem API}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\#\textquotesingle{} @aliases query\_inchikey}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Query InChIkey of compounds via \textquotesingle{}InChIkey 2D\textquotesingle{}}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description }
\CommentTok{\#\textquotesingle{} The API:}
\CommentTok{\#\textquotesingle{} url\_start = paste0("https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/", type, "/")}
\CommentTok{\#\textquotesingle{} url\_end = paste0("/property/", paste(get, collapse = ","), "/CSV")}
\CommentTok{\#\textquotesingle{} url = paste0(url\_start, "/", inchikey2d, "/", url\_end)}
\CommentTok{\#\textquotesingle{} }
\CommentTok{\#\textquotesingle{} @family queries}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name query\_inchikey}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @export query\_inchikey}
\CommentTok{\#\textquotesingle{} @aliases query\_inchikey}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{query\_inchikey\}: ...}
\CommentTok{\#\textquotesingle{} @rdname query\_inchikey}
\NormalTok{query\_inchikey }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(}
\NormalTok{    inchikey2d,}
\NormalTok{    dir,}
    \AttributeTok{rdata.name =} \StringTok{"inchikey.rdata"}\NormalTok{,}
    \AttributeTok{curl\_cl =} \ConstantTok{NULL}\NormalTok{,}
    \AttributeTok{gather\_as\_rdata =}\NormalTok{ T,}
\NormalTok{    ...}
\NormalTok{    )\{}
\NormalTok{    rdata }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(dir, }\StringTok{"/"}\NormalTok{, rdata.name)}
\NormalTok{    inchikey\_set }\OtherTok{\textless{}{-}} \FunctionTok{extract\_rdata\_list}\NormalTok{(rdata)}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(inchikey\_set))}
\NormalTok{      inchikey2d }\OtherTok{\textless{}{-}}\NormalTok{ inchikey2d[}\SpecialCharTok{!}\NormalTok{inchikey2d }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(inchikey\_set)]}
    \ControlFlowTok{if}\NormalTok{(}\FunctionTok{length}\NormalTok{(inchikey2d) }\SpecialCharTok{==} \DecValTok{0}\NormalTok{)}
      \FunctionTok{return}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(dir, }\StringTok{"/"}\NormalTok{, rdata.name))}
\NormalTok{    pbapply}\SpecialCharTok{::}\FunctionTok{pblapply}\NormalTok{(inchikey2d, pubchem\_get\_inchikey,}
      \AttributeTok{dir =}\NormalTok{ dir, }\AttributeTok{cl =}\NormalTok{ curl\_cl, ...)}
    \ControlFlowTok{if}\NormalTok{ (gather\_as\_rdata) \{}
      \FunctionTok{cat}\NormalTok{(}\StringTok{"\#\# gather data}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
      \FunctionTok{packing\_as\_rdata\_list}\NormalTok{(dir, }\AttributeTok{pattern =} \StringTok{"\^{}[A{-}Z]\{14\}$"}\NormalTok{,}
        \AttributeTok{rdata =}\NormalTok{ rdata.name, }\AttributeTok{extra =}\NormalTok{ inchikey\_set)}
\NormalTok{    \}}
    \FunctionTok{return}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(dir, }\StringTok{"/"}\NormalTok{, rdata.name))}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export pubchem\_get\_inchikey}
\CommentTok{\#\textquotesingle{} @aliases pubchem\_get\_inchikey}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{pubchem\_get\_inchikey\}: ...}
\CommentTok{\#\textquotesingle{} @rdname query\_inchikey}
\NormalTok{pubchem\_get\_inchikey }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(}
\NormalTok{    inchikey2d,}
\NormalTok{    dir,}
    \AttributeTok{type =} \StringTok{"inchikey"}\NormalTok{,}
    \AttributeTok{get =} \StringTok{"InChIkey"}\NormalTok{,}
\NormalTok{    ...}
\NormalTok{    )\{}
\NormalTok{    file }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(dir, }\StringTok{"/"}\NormalTok{, inchikey2d)}
    \ControlFlowTok{if}\NormalTok{(}\FunctionTok{file.exists}\NormalTok{(file))\{}
\NormalTok{      csv }\OtherTok{\textless{}{-}} \FunctionTok{read\_tsv}\NormalTok{(file)}
      \ControlFlowTok{if}\NormalTok{(}\StringTok{"CID"} \SpecialCharTok{\%in\%} \FunctionTok{colnames}\NormalTok{(csv))}
        \FunctionTok{return}\NormalTok{()}
\NormalTok{    \}}
\NormalTok{    url\_start }\OtherTok{=} \FunctionTok{paste0}\NormalTok{(}\StringTok{"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/"}\NormalTok{, type, }\StringTok{"/"}\NormalTok{)}
\NormalTok{    url\_end }\OtherTok{=} \FunctionTok{paste0}\NormalTok{(}\StringTok{"/property/"}\NormalTok{, }\FunctionTok{paste}\NormalTok{(get, }\AttributeTok{collapse =} \StringTok{","}\NormalTok{), }\StringTok{"/CSV"}\NormalTok{)}
\NormalTok{    url }\OtherTok{=} \FunctionTok{paste0}\NormalTok{(url\_start, }\StringTok{"/"}\NormalTok{, inchikey2d, }\StringTok{"/"}\NormalTok{, url\_end)}
\NormalTok{    check }\OtherTok{\textless{}{-}} \DecValTok{0}
    \ControlFlowTok{while}\NormalTok{(check }\SpecialCharTok{==} \DecValTok{0} \SpecialCharTok{|} \FunctionTok{inherits}\NormalTok{(check, }\StringTok{"try{-}error"}\NormalTok{))\{}
\NormalTok{      check }\OtherTok{\textless{}{-}} \FunctionTok{try}\NormalTok{(csv }\OtherTok{\textless{}{-}}\NormalTok{ RCurl}\SpecialCharTok{::}\FunctionTok{getURL}\NormalTok{(url), }\AttributeTok{silent =}\NormalTok{ T)}
\NormalTok{    \}}
    \ControlFlowTok{if}\NormalTok{(}\FunctionTok{grepl}\NormalTok{(}\StringTok{"Status: 404"}\NormalTok{, csv))\{}
      \FunctionTok{write\_tsv}\NormalTok{(csv, }\AttributeTok{file =}\NormalTok{ file)}
      \FunctionTok{return}\NormalTok{()}
\NormalTok{    \}}
    \ControlFlowTok{while}\NormalTok{(}\FunctionTok{grepl}\NormalTok{(}\StringTok{"Status:    503"}\NormalTok{, csv))\{}
\NormalTok{      csv }\OtherTok{\textless{}{-}}\NormalTok{ RCurl}\SpecialCharTok{::}\FunctionTok{getURL}\NormalTok{(url)}
\NormalTok{    \}}
\NormalTok{    csv }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{fread}\NormalTok{(}\AttributeTok{text =}\NormalTok{ csv)}
    \FunctionTok{write\_tsv}\NormalTok{(csv, }\AttributeTok{file =}\NormalTok{ file)}
\NormalTok{  \}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-query_others.r}{%
\section{File: query\_others.R}\label{file-query_others.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# query other property for compounds using pubchem API}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\#\textquotesingle{} @aliases query\_iupac}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Query IUPAC name of compounds via \textquotesingle{}InChIkey 2D\textquotesingle{}}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description Similar to [query\_inchikey()], but get \textquotesingle{}IUPACName\textquotesingle{}.}
\CommentTok{\#\textquotesingle{} @family queries}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name query\_iupac}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @export query\_iupac}
\CommentTok{\#\textquotesingle{} @aliases query\_iupac}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{query\_iupac\}: ...}
\CommentTok{\#\textquotesingle{} @rdname query\_iupac}
\NormalTok{query\_iupac }\OtherTok{\textless{}{-}}
  \ControlFlowTok{function}\NormalTok{(inchikey2d,}
\NormalTok{    dir,}
    \AttributeTok{rdata.name =} \StringTok{"iupac.rdata"}\NormalTok{,}
    \AttributeTok{curl\_cl =} \ConstantTok{NULL}\NormalTok{,}
    \AttributeTok{gather\_as\_rdata =}\NormalTok{ T,}
\NormalTok{    ...}
\NormalTok{    ) \{}
    \FunctionTok{query\_inchikey}\NormalTok{(inchikey2d, dir, rdata.name, curl\_cl, gather\_as\_rdata,}
      \AttributeTok{get =} \StringTok{"IUPACName"}\NormalTok{)}
\NormalTok{  \}}
\end{Highlighting}
\end{Shaded}

\hypertarget{file-query_synonyms.r}{%
\section{File: query\_synonyms.R}\label{file-query_synonyms.r}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================================================================}
\CommentTok{\# query synonyms for compounds using pubchem API}
\CommentTok{\# {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-} {-}}

\CommentTok{\#\textquotesingle{} @aliases query\_synonyms}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @title Query synonyms of compounds via CID}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @description Bulk search for compound synonyms via pubchem API.}
\CommentTok{\#\textquotesingle{} (https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/.../synonyms/XML)}
\CommentTok{\#\textquotesingle{} @family queries}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @name query\_synonyms}
\ConstantTok{NULL}
\CommentTok{\#\textgreater{} NULL}

\CommentTok{\#\textquotesingle{} @export query\_synonyms}
\CommentTok{\#\textquotesingle{} @aliases query\_synonyms}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{query\_synonyms\}: ...}
\CommentTok{\#\textquotesingle{} @rdname query\_synonyms}
\NormalTok{query\_synonyms }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(}
\NormalTok{    cid,}
\NormalTok{    dir,}
    \AttributeTok{rdata.name =} \StringTok{"synonyms.rdata"}\NormalTok{,}
    \AttributeTok{curl\_cl =} \ConstantTok{NULL}\NormalTok{,}
    \AttributeTok{gather\_as\_rdata =}\NormalTok{ T,}
    \AttributeTok{group\_number =} \DecValTok{50}\NormalTok{,}
\NormalTok{    ...}
\NormalTok{    )\{}
\NormalTok{    rdata }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(dir, }\StringTok{"/"}\NormalTok{, rdata.name)}
\NormalTok{    cid\_set }\OtherTok{\textless{}{-}} \FunctionTok{extract\_rdata\_list}\NormalTok{(rdata)}
    \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(cid\_set)) \{}
\NormalTok{      cid\_set }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(cid\_set)}
      \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{nrow}\NormalTok{(cid\_set) }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{)}
\NormalTok{        extra }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(cid\_set)}
      \ControlFlowTok{else}
\NormalTok{        extra }\OtherTok{\textless{}{-}} \ConstantTok{NULL}
      \ControlFlowTok{if}\NormalTok{(}\StringTok{"cid"} \SpecialCharTok{\%in\%} \FunctionTok{colnames}\NormalTok{(cid\_set))\{}
\NormalTok{        cid\_set }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{distinct}\NormalTok{(cid\_set, cid, syno)}
\NormalTok{      \}}
\NormalTok{      cid }\OtherTok{\textless{}{-}}\NormalTok{ cid[}\SpecialCharTok{!}\NormalTok{cid }\SpecialCharTok{\%in\%}\NormalTok{ cid\_set}\SpecialCharTok{$}\NormalTok{cid]}
      \ControlFlowTok{if}\NormalTok{(}\FunctionTok{length}\NormalTok{(cid) }\SpecialCharTok{==} \DecValTok{0}\NormalTok{) }
        \FunctionTok{return}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(dir, }\StringTok{"/"}\NormalTok{, rdata.name))}
\NormalTok{    \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{      extra }\OtherTok{\textless{}{-}} \ConstantTok{NULL}
\NormalTok{    \}}
\NormalTok{    group }\OtherTok{\textless{}{-}} \FunctionTok{grouping\_vec2list}\NormalTok{(cid, }\AttributeTok{group\_number =}\NormalTok{ group\_number)}
\NormalTok{    pbapply}\SpecialCharTok{::}\FunctionTok{pblapply}\NormalTok{(group, pubchem\_get\_synonyms,}
      \AttributeTok{dir =}\NormalTok{ dir, ..., }\AttributeTok{cl =}\NormalTok{ curl\_cl)}
    \ControlFlowTok{if}\NormalTok{ (gather\_as\_rdata) \{}
      \FunctionTok{cat}\NormalTok{(}\StringTok{"\#\# gather data}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
      \FunctionTok{packing\_as\_rdata\_list}\NormalTok{(dir, }\AttributeTok{pattern =} \StringTok{"\^{}G[0{-}9]\{1,\}$"}\NormalTok{,}
        \AttributeTok{dedup =}\NormalTok{ F,}
        \AttributeTok{rdata =}\NormalTok{ rdata.name,}
        \AttributeTok{extra =}\NormalTok{ extra)}
\NormalTok{    \}}
    \FunctionTok{return}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(dir, }\StringTok{"/"}\NormalTok{, rdata.name))}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export pubchem\_get\_synonyms}
\CommentTok{\#\textquotesingle{} @aliases pubchem\_get\_synonyms}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{pubchem\_get\_synonyms\}: ...}
\CommentTok{\#\textquotesingle{} @rdname query\_synonyms}
\NormalTok{pubchem\_get\_synonyms }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(}
\NormalTok{    cid,}
\NormalTok{    dir,}
\NormalTok{    ...}
\NormalTok{    )\{}
\NormalTok{    savename }\OtherTok{\textless{}{-}} \FunctionTok{attr}\NormalTok{(cid, }\StringTok{"name"}\NormalTok{)}
\NormalTok{    file }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(dir, }\StringTok{"/"}\NormalTok{, savename)}
\NormalTok{    cid }\OtherTok{\textless{}{-}} \FunctionTok{paste}\NormalTok{(cid, }\AttributeTok{collapse =} \StringTok{","}\NormalTok{)}
\NormalTok{    url\_start }\OtherTok{\textless{}{-}} \StringTok{"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"}
\NormalTok{    url\_end }\OtherTok{\textless{}{-}} \StringTok{"/synonyms/XML"}
\NormalTok{    url }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(url\_start, cid, url\_end)}
\NormalTok{    check }\OtherTok{\textless{}{-}} \DecValTok{0}
    \ControlFlowTok{while}\NormalTok{(check }\SpecialCharTok{==} \DecValTok{0} \SpecialCharTok{|} \FunctionTok{inherits}\NormalTok{(check, }\StringTok{"try{-}error"}\NormalTok{))\{}
\NormalTok{      check }\OtherTok{\textless{}{-}} \FunctionTok{try}\NormalTok{(text }\OtherTok{\textless{}{-}}\NormalTok{ RCurl}\SpecialCharTok{::}\FunctionTok{getURL}\NormalTok{(url), }\AttributeTok{silent =}\NormalTok{ T)}
\NormalTok{    \}}
    \ControlFlowTok{while}\NormalTok{(}\FunctionTok{grepl}\NormalTok{(}\StringTok{"Status:    503"}\NormalTok{, text))\{}
\NormalTok{      text }\OtherTok{\textless{}{-}}\NormalTok{ RCurl}\SpecialCharTok{::}\FunctionTok{getURL}\NormalTok{(url)}
\NormalTok{    \}}
\NormalTok{    text }\OtherTok{\textless{}{-}}\NormalTok{ XML}\SpecialCharTok{::}\FunctionTok{xmlToList}\NormalTok{(text)}
\NormalTok{    text }\OtherTok{\textless{}{-}}\NormalTok{ text[}\FunctionTok{names}\NormalTok{(text) }\SpecialCharTok{==} \StringTok{"Information"}\NormalTok{]}
\NormalTok{    text }\OtherTok{\textless{}{-}}
      \FunctionTok{lapply}\NormalTok{(text,}
        \ControlFlowTok{function}\NormalTok{(list)\{}
\NormalTok{          syno }\OtherTok{\textless{}{-}}\NormalTok{ list[}\FunctionTok{names}\NormalTok{(list) }\SpecialCharTok{==} \StringTok{"Synonym"}\NormalTok{]}
\NormalTok{          syno }\OtherTok{\textless{}{-}}
            \FunctionTok{lapply}\NormalTok{(syno,}
              \ControlFlowTok{function}\NormalTok{(char)\{}
                \ControlFlowTok{if}\NormalTok{(}\FunctionTok{is.null}\NormalTok{(char))\{}
                  \FunctionTok{return}\NormalTok{(}\ConstantTok{NA}\NormalTok{)}
\NormalTok{                \}}\ControlFlowTok{else}\NormalTok{\{}
                  \FunctionTok{return}\NormalTok{(char)}
\NormalTok{                \}}
\NormalTok{              \})}
\NormalTok{          data.table}\SpecialCharTok{::}\FunctionTok{data.table}\NormalTok{(}\AttributeTok{cid =}\NormalTok{ list}\SpecialCharTok{$}\NormalTok{CID, }\AttributeTok{syno =} \FunctionTok{unlist}\NormalTok{(syno))}
\NormalTok{        \})}
\NormalTok{    text }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{rbindlist}\NormalTok{(text, }\AttributeTok{fill =}\NormalTok{ T)}
    \FunctionTok{write\_tsv}\NormalTok{(text, }\AttributeTok{filename =}\NormalTok{ file)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export grouping\_vec2list}
\CommentTok{\#\textquotesingle{} @aliases grouping\_vec2list}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{grouping\_vec2list\}: ...}
\CommentTok{\#\textquotesingle{} @rdname query\_synonyms}
\NormalTok{grouping\_vec2list }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(}
\NormalTok{    vector,}
\NormalTok{    group\_number,}
    \AttributeTok{byrow =}\NormalTok{ F}
\NormalTok{    )\{}
    \ControlFlowTok{if}\NormalTok{(}\FunctionTok{length}\NormalTok{(vector) }\SpecialCharTok{\textless{}}\NormalTok{ group\_number)\{}
      \FunctionTok{attr}\NormalTok{(vector, }\StringTok{"name"}\NormalTok{) }\OtherTok{\textless{}{-}} \StringTok{"G1"}
      \FunctionTok{return}\NormalTok{(}\FunctionTok{list}\NormalTok{(vector))}
\NormalTok{    \}}
\NormalTok{    rest }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(vector) }\SpecialCharTok{\%\%}\NormalTok{ group\_number}
\NormalTok{    group }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(vector[}\DecValTok{1}\SpecialCharTok{:}\NormalTok{(}\FunctionTok{length}\NormalTok{(vector) }\SpecialCharTok{{-}}\NormalTok{ rest)],}
      \AttributeTok{ncol =}\NormalTok{ group\_number,}
      \AttributeTok{byrow =}\NormalTok{ byrow)}
\NormalTok{    group }\OtherTok{\textless{}{-}} \FunctionTok{apply}\NormalTok{(group, }\DecValTok{1}\NormalTok{, c, }\AttributeTok{simplify =}\NormalTok{ F)}
\NormalTok{    group }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(group, }\FunctionTok{list}\NormalTok{(}\FunctionTok{tail}\NormalTok{(vector, }\AttributeTok{n =}\NormalTok{ rest)))}
\NormalTok{    group }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(group),}
      \ControlFlowTok{function}\NormalTok{(n) \{}
\NormalTok{        vec }\OtherTok{\textless{}{-}}\NormalTok{ group[[n]]}
        \FunctionTok{attr}\NormalTok{(vec, }\StringTok{"name"}\NormalTok{) }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"G"}\NormalTok{, n)}
\NormalTok{        vec}
\NormalTok{      \})}
    \ControlFlowTok{if}\NormalTok{(rest }\SpecialCharTok{==} \DecValTok{0}\NormalTok{)}
\NormalTok{      group }\OtherTok{\textless{}{-}}\NormalTok{ group[}\DecValTok{1}\SpecialCharTok{:}\NormalTok{(}\FunctionTok{length}\NormalTok{(group) }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{)]}
    \FunctionTok{return}\NormalTok{(group)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export extract\_rdata\_list}
\CommentTok{\#\textquotesingle{} @aliases extract\_rdata\_list}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{extract\_rdata\_list\}: extract results from .rdata}
\CommentTok{\#\textquotesingle{} @rdname query\_synonyms}
\NormalTok{extract\_rdata\_list }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(}
\NormalTok{    rdata,}
    \AttributeTok{names =} \ConstantTok{NA}
\NormalTok{    )\{}
    \ControlFlowTok{if}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{file.exists}\NormalTok{(rdata))}
      \FunctionTok{return}\NormalTok{()}
    \FunctionTok{load}\NormalTok{(rdata)}
    \ControlFlowTok{if}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(names[}\DecValTok{1}\NormalTok{]))\{}
\NormalTok{      list }\OtherTok{\textless{}{-}}\NormalTok{ list[}\FunctionTok{names}\NormalTok{(list) }\SpecialCharTok{\%in\%}\NormalTok{ names]}
\NormalTok{    \}}
    \FunctionTok{return}\NormalTok{(list)}
\NormalTok{  \}}

\CommentTok{\#\textquotesingle{} @export packing\_as\_rdata\_list}
\CommentTok{\#\textquotesingle{} @aliases packing\_as\_rdata\_list}
\CommentTok{\#\textquotesingle{} @description \textbackslash{}code\{packing\_as\_rdata\_list\}: gather table as .rdata}
\CommentTok{\#\textquotesingle{} @rdname query\_synonyms}
\NormalTok{packing\_as\_rdata\_list }\OtherTok{\textless{}{-}} 
  \ControlFlowTok{function}\NormalTok{(}
\NormalTok{    path,}
\NormalTok{    pattern,}
\NormalTok{    rdata,}
    \AttributeTok{extra =} \ConstantTok{NULL}\NormalTok{,}
    \AttributeTok{rm\_files =}\NormalTok{ T,}
    \AttributeTok{dedup =}\NormalTok{ T}
\NormalTok{    )\{}
\NormalTok{    file\_set }\OtherTok{\textless{}{-}} \FunctionTok{list.files}\NormalTok{(path, }\AttributeTok{pattern =}\NormalTok{ pattern)}
    \ControlFlowTok{if}\NormalTok{(}\FunctionTok{length}\NormalTok{(file\_set) }\SpecialCharTok{==} \DecValTok{0}\NormalTok{)}
      \FunctionTok{return}\NormalTok{()}
\NormalTok{    list }\OtherTok{\textless{}{-}}\NormalTok{ pbapply}\SpecialCharTok{::}\FunctionTok{pblapply}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(path, }\StringTok{"/"}\NormalTok{, file\_set), read\_tsv)}
    \FunctionTok{names}\NormalTok{(list) }\OtherTok{\textless{}{-}}\NormalTok{ file\_set}
\NormalTok{    list }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(extra, list)}
    \ControlFlowTok{if}\NormalTok{(dedup)\{}
\NormalTok{      df }\OtherTok{\textless{}{-}}\NormalTok{ data.table}\SpecialCharTok{::}\FunctionTok{data.table}\NormalTok{(}\AttributeTok{name =} \FunctionTok{names}\NormalTok{(list), }\AttributeTok{n =} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(list))}
\NormalTok{      df }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{distinct}\NormalTok{(df, name, }\AttributeTok{.keep\_all =}\NormalTok{ T)}
\NormalTok{      list }\OtherTok{\textless{}{-}}\NormalTok{ list[df}\SpecialCharTok{$}\NormalTok{n]}
\NormalTok{    \}}
    \ControlFlowTok{if}\NormalTok{(rm\_files)\{}
      \FunctionTok{lapply}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(path, }\StringTok{"/"}\NormalTok{, file\_set), file.remove)}
\NormalTok{    \}}
    \FunctionTok{save}\NormalTok{(list, }\AttributeTok{file =} \FunctionTok{paste0}\NormalTok{(path, }\StringTok{"/"}\NormalTok{, rdata))}
\NormalTok{  \}}
\end{Highlighting}
\end{Shaded}


\end{document}
