---
title: 
bibliography: '`r system.file("extdata", "library.bib", package = "utils.tool")`'
csl: '`r system.file("extdata", "nature.csl", package = "utils.tool")`'
reference-section-title: "Reference"
link-citations: true
output:
  bookdown::pdf_document2:
    # pandoc_args: [
      # "--filter", "pandoc-fignos",
      # "--filter", "pandoc-tablenos"
    # ]
    keep_tex: true
    keep_md: true
    toc: false
    # toc_depth: 4
    latex_engine: xelatex
header-includes:
  \usepackage{caption}
  \captionsetup{font={footnotesize},width=6in}
  \renewcommand{\dblfloatpagefraction}{.9}
  \makeatletter
  \renewenvironment{figure}
  {\def\@captype{figure}}
  \makeatother
  \newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
  \definecolor{shadecolor}{RGB}{230,230,230}
  \usepackage{xeCJK}
  \usepackage{setspace}
  \setstretch{1.3} 
  \usepackage{tcolorbox}
  \setcounter{secnumdepth}{4}
  \setcounter{tocdepth}{4}
  \usepackage{wallpaper}
  \usepackage[absolute]{textpos}
  \tcbuselibrary{breakable}
  \renewenvironment{Shaded}
  {\begin{tcolorbox}[colback = gray!10, colframe = gray!40, width = 16cm,
    arc = 1mm, auto outer arc, title = {Input}]}
  {\end{tcolorbox}}
  \usepackage{titlesec}
  \titleformat{\paragraph}
  {\fontsize{10pt}{0pt}\bfseries} {\arabic{section}.\arabic{subsection}.\arabic{subsubsection}.\arabic{paragraph}} {1em} {} []

---


```{r include = F, eval = F}
deparse_mail()
info <- items(belong = odate(12), coef = NA)

order_publish()
idname <- order_packaging()
```

```{r include = F}
#| setup
if (!requireNamespace("utils.tool"))
  devtools::load_all("~/utils.tool/")
autor_preset()
## the package are available at <https://github.com/shaman-yellow/utils.tool>
## if you want to run codes of this Rmarkdown,
## please install the package `utils.tool` and other related packages (run
## install.R)
options(savedir = list(figs = "Figure+Table", tabs = "Figure+Table"))
```

```{r eval = T, echo = F, results = "asis"}
set_cover(info$title)
```

```{r eval = T, echo = F, results = "asis"}
set_index()
```

# 摘要 {#abstract}

## 需求和结果

- 白芍总苷 Total glucosides of paeony 中主要化学成分10-20个（TCMSP筛选下口服利用度等）及各个化学成分对应的作用靶点
  （gene与AR过敏性鼻炎相关），最终形成drug-chemical-target gene靶点图
    - 由于`r d("g")` 成分过少(Tab. \@ref(tab:Baishao-glycosides-related-compounds),
      Fig. \@ref(fig:Classification-hierarchy))，没有利用 OB 筛选。
      由于靶点过少，这里也没有根据 AR 相关过滤后绘制成分靶点图，而是直接绘制，
      网络药理图见 Fig. \@ref(fig:Baishao-Network-pharmacology-visualization)。
      其中与 AR 相关的基因见 Fig. \@ref(fig:Baishao-glucosides-targets-intersect-with-AR-related-targets)。
- 将获得的靶点进行GO, KEGG富集分析，目标靶点为USP5，关联成分为芍药苷Paeoniflorin
    - `r d("g")` 没有富集到 USP5 (TCMSP 的`r d("g")`靶点信息，不包含 USP5 和 SOX18) ，
      Fig. \@ref(fig:Gly-Interect-genes-KEGG-enrichment) 和 Fig. \@ref(fig:Gly-Interect-genes-GO-enrichment) 为富集分析结果。
- 将芍药苷pae单独拎出，形成pae-targets-pathway网络，此处形成的target genes的GO、KEGG富集图也需要，
  备注USP5参与哪些部分（功能、通路）
    - Fig. \@ref(fig:Paeoniflorin-Network-pharmacology-visualization) 为 Paeoniflorin 网络药理图 
      (由于靶点过少，这里也没有根据 AR 相关过滤后绘制成分靶点图，而是直接绘制) 。
      Paeoniflorin 与 AR 交集基因为 Fig. \@ref(fig:Paeoniflorin-targets-intersect-with-AR-related-targets)
- 分子对接模拟芍药苷与USP5互作
    - 见 Fig. \@ref(fig:Overall-combining-Affinity) 和 Fig. \@ref(fig:Paeoniflorin-combine-USP5)
- 转至第2步目标靶点为SOX18，关联成分为芍药苷Paeoniflorin
    - Paeoniflorin 不包含 SOX18
- 第3步中备注SOX18参与哪些部分（功能、通路）
    - 不参与
- 分子对接模拟芍药苷与SOX18互作
    - 见 Fig. \@ref(fig:Paeoniflorin-combine-SOX18)

```{r}
dic(di("白芍总苷", "Total glucosides of paeony", "TGP"),
  di("过敏性鼻炎"),
  di("苷类"),
  di("芍药苷", en = "Paeoniflorin")
)

# TGP: Total glucosides of paeony 白芍总苷
# AR: allergic rhinitis 过敏性鼻炎
# G: Glycosides 苷类
# P: Paeoniflorin 芍药苷
```

# 前言 {#introduction}

# 材料和方法 {#methods}

## 材料

```{r eval = T, echo = F, results = "asis"}
auto_material()
```

## 方法

```{r eval = T, echo = F, results = "asis"}
auto_method()
```

# 分析结果 {#results}

# 结论 {#dis}

# 附：分析流程 {#workflow}

## TCMSP 白芍成分获取

```{r}
tp <- job_tcmsp("白芍")
tp <- step1(tp)
tp <- step2(tp)
```

```{r}
cf.rev <- job_classyfire(c(442534, 51346141, 21631105, 21631106,
    138113866, 14605198, 50163461, 102000323, 494717, 138108175, 124079396,
    101382399, 102516499, 71452334, 137705343))
cf.rev <- step1(cf.rev)
rev.which <- cf.rev@params$db_inchi$InChIKey %in% tp@tables$step2$compounds_targets$InChIKey
cf.rev@params$db_inchi$CID[ rev.which ]
```

```{r eval = T, echo = F, results = "asis"}
#| Baishao-Compounds-and-targets
autor(tp@tables$step2$compounds_targets)
```

## 白芍所有化合物 (TCMSP) 的化学类

### 白芍的所有成分

```{r eval = T, echo = F, results = "asis"}
#| Classification-hierarchy
autor(cf.tp@plots$step2$p.classes_freq)
```

```{r}
cf.tp <- asjob_classyfire(tp)
cf.tp <- step1(cf.tp)
cf.tp <- step2(cf.tp, "gly")
cf.tp@plots$step2$p.classes_freq
cf.tp@plots$step2$p.isClassified
```

### 白芍的`r d("g")`成分和靶基因

```{r eval = T, echo = F, results = "asis"}
#| Baishao-glycosides-related-compounds
autor(tp.gly@tables$step3$easyRead)
```

## 白芍`r d("g")` 的网络药理学分析

### 白芍-`r d("g")`-靶点

```{r eval = T, echo = F, results = "asis"}
#| Baishao-Network-pharmacology-visualization
autor(tp.gly@plots$step3$p.pharm)
```

```{r eval = T, echo = F, results = "asis"}
#| Paeoniflorin-Network-pharmacology-visualization
autor(wrap(tp.glyPae@plots$step3$p.pharm, 7, 1.5))
```

### `r d("ar")` 相关基因

AR 相关基因通过 geneCards 获取，并通过 Biomart 注释。

```{r eval = T, echo = F, results = "asis"}
#| AR-related-genes
autor(tp.gly@tables$step3$disease_targets_annotation)
```

```{r}
tp.gly <- map(tp, cf.tp)
tp.gly <- step3(tp.gly, "allergic rhinitis", 1)
tp.gly@plots$step3$p.pharm
tp.gly@tables$step3$easyRead
tp.gly@tables$step3$disease_targets_annotation
```

### `r d("g")` 和 `r d("ar")` 靶基因的交集

```{r eval = T, echo = F, results = "asis"}
#| Baishao-glucosides-targets-intersect-with-AR-related-targets
autor(p.venn)
```

```{r}
p.venn <- new_venn(lst = list(Targets = tp.gly@tables$step3$easyRead$symbols,
  AR_related = tp.gly@tables$step3$disease_targets_annotation$hgnc_symbol))
```

### `r d("p")` 和 `r d("ar")` 靶基因的交集

```{r eval = T, echo = F, results = "asis"}
#| Paeoniflorin-targets-intersect-with-AR-related-targets
autor(p.vennPae)
```

```{r}
keys <- c("USP5", "SOX18")
tp.glyPae <- map(tp, cf.tp)
tp.glyPae <- filter(tp.glyPae, grpl(`Molecule Name`, "^Paeoniflorin$", T))
tp.glyPae@tables$step2$compounds_targets
tp.glyPae <- step3(tp.glyPae, "allergic rhinitis", 1)
wrap(tp.glyPae@plots$step3$p.pharm, 7, 1.5)

p.vennPae <- new_venn(lst = list(Pae_Targets = tp.glyPae@tables$step3$easyRead$symbols,
  AR_related = tp.glyPae@tables$step3$disease_targets_annotation$hgnc_symbol))
```


## 富集分析

### 白芍`r d("g")`与 AR 交集基因的富集分析

```{r eval = T, echo = F, results = "asis"}
#| Gly-Interect-genes-KEGG-enrichment
autor(en@plots$step1$p.kegg$ids)
```

```{r eval = T, echo = F, results = "asis"}
#| Gly-Interect-genes-GO-enrichment
autor(wrap(en@plots$step1$p.go$ids, 14))
```

```{r}
en <- job_enrich(p.venn$ins)
en <- step1(en)
en@plots$step1$p.kegg$ids
wrap(en@plots$step1$p.go$ids, 14)
en@tables$step1$res.kegg
```

## 分子对接

对接的对象为： SOX18, USP5

### `r d("p")`

```{r eval = T, echo = F, results = "asis"}
#| Overall-combining-Affinity
autor(wrap(vn@plots$step5$p.res_vina, 7.2, 2))
```

```{r eval = T, echo = F, results = "asis"}
#| Paeoniflorin-combine-USP5
autor(.file_fig("./figs/442534_into_2dag.png"))
```

```{r eval = T, echo = F, results = "asis"}
#| Paeoniflorin-combine-SOX18
autor(.file_fig("./figs/442534_into_sox18.png"))
```

```{r}
pae.cids <- PubChemR::get_cids("Paeoniflorin")
pae.info <- data.frame(Ingredient_name = "Paeoniflorin", PubChem_id = as.integer(pae.cids$CID[[1]]))

vn <- job_vina(c(Paeoniflorin = pae.cids$CID[[1]]), c("SOX18", "USP5"))
vn <- step1(vn, NULL)
vn <- step2(vn)
file.copy("./order_material/AF-P35713-F1-model_v4.pdb", "./protein_pdb/sox18.pdb")
vn <- step3(vn, extra_pdb.files = c(sox18 = "./protein_pdb/sox18.pdb"),
  extra_layouts = nl(pae.cids$CID[[1]], "sox18"))
vn <- step4(vn)
vn <- step5(vn)
vn@tables$step5$res_dock
wrap(vn@plots$step5$p.res_vina, 7.2, 2)
vn <- step6(vn)
vn <- step7(vn)
```

