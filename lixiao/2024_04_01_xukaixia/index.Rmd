---
---

```{r include = F, eval = F}
deparse_mail()
info <- items(belong = odate(5), eval = ic(3, 2, 0, 0, 2))
show.ic(info)

order_publish()
idname <- order_packaging()
```

```{r include = F}
#| setup
if (!requireNamespace("utils.tool"))
  devtools::load_all("~/utils.tool/")
autor_preset()
## the package are available at <https://github.com/shaman-yellow/utils.tool>
## if you want to run codes of this Rmarkdown,
## please install the package `utils.tool` and other related packages (run
## install.R)
options(savedir = list(figs = "Figure+Table", tabs = "Figure+Table"))
```

```{r eval = T, echo = F, results = "asis"}
set_cover(info$title)
```

```{r eval = T, echo = F, results = "asis"}
set_index()
```

# 摘要 {#abstract}

```{r}
dic(di("差异表达基因", "Differential Expressed Genes", "DEGs"),
  di("糖代谢紊乱", "Glycometabolic disturbance")
)

# DEGs: Differential Expressed Genes 差异表达基因
# GD: Glycometabolic disturbance 糖代谢紊乱

```

Whole-genome DNA methylation analysis in liver
tissue of offspring of Zuogui pill (ZGP)-intervened GD rats, trying to find evidence
for ZGP effect on epigenetics and potential pathways

Then, 92 DM-related differentially
methylated genes were identified. They were mainly enriched in
glycometabolism, receptors on the membrane, and protein kinases and
their regulators by GO analysis as well as in MAPK pathway by KEGG
analysis.

A core **network involved in PI3K/AKT signaling was
obtained.** The effect of ZGP on eugenics in the offspring of GD rats
may be achieved by affecting the liver methylation of the offspring,
with **PI3K/AKT pathway as one of targets.**

- differentially methylated regions (DMRs) identification
- Bismark was used for aligning clean reads to reference genome 
- profiles of extracted methylation sites were analyzed by **methylKit** to perform
  calling DMR between Model and Model-Cure group, with \|delta\| \> 0.3, FDR \<
  0.05, and annotate DMRs-related genes by Rattus norvegicus genome

# 前言 {#introduction}

# 材料和方法 {#methods}

## 材料

```{r eval = T, echo = F, results = "asis"}
auto_material()
```

## 方法

```{r eval = T, echo = F, results = "asis"}
auto_method()
```

# 分析结果 {#results}

# 结论 {#dis}

# 附：分析流程 {#workflow}

- 许凯霞需求
- 浙江百越4例WGBS信息采集与分析

## DMR data

```{r}
t.genes <- ftibble("/media/echo/My Passport/浙江百越4例WGBS信息采集与分析/结果/01_甲基化差异表达基因.tsv")
t.genes

t.diff <- ftibble("/media/echo/My Passport/浙江百越4例WGBS信息采集与分析/结果/01_甲基化差异表达DMR.csv")
t.diff <- dplyr::select(t.diff, dmr_id, dplyr::ends_with("Model-vs-Model-Cure"))
t.diff <- dplyr::mutate(t.diff,
  chr = strx(dmr_id, "chr[0-9]+"),
  start = strx(dmr_id, "(?<=_)[0-9]+(?=_)"),
  end = strx(dmr_id, "[0-9]+$"),
  DMR_Treatment_vs_Model = -`dmr_diff_cg_Model-vs-Model-Cure`,
  DMR_Qvalue = `dmr_qvalue_cg_Model-vs-Model-Cure`
)
dmrDat <- dplyr::select(t.diff, chr, start, end, tidyselect::starts_with("DMR", F), dmr_id)
dmrDat <- dplyr::arrange(dmrDat, DMR_Qvalue)
dmrDat

dmrDat.genes <- map(dmrDat, "dmr_id", t.genes, "dmr_id", "gene", col = "symbol")
dmrDat.genes

dmr <- job_dmr(dmrDat.genes, "rn6")
```

## DMR distribution

```{r}
p.distri <- new_pie(dmrDat$chr, title = "DMR distribution")
wrap(p.distri, 7, 5)

p.distriGene <- new_pie(dmrDat.genes$chr, title = "DMR in Genes")
wrap(p.distriGene, 7, 5)
```

## CpG Island

```{r}
cpgi <- get_cpgisland_GRranges("rn6")
cpgi

dmrDat.gr <- as_GRanges(dmrDat, "chr7")
dmrDat.gr

```

## DMR plot

```{r}
# job_ucscTable
x <- plot_dmr(dmrDat, "chr1", "rn6", subset.cpgIsland = 2)
y <- plot_dmr(dplyr::filter(dmrDat, dmr_id %in% t.genes$dmr_id), "chr1", "rn6")
```


