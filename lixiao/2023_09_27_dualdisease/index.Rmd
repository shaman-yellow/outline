---
---

```{r include = F}
#| setup
if (!requireNamespace("utils.tool"))
  devtools::load_all("~/utils.tool/")
autor_preset()
## the package are available at <https://github.com/shaman-yellow/utils.tool>
## if you want to run codes of this Rmarkdown,
## please install the package `utils.tool` and other related packages (run
## install.R)
options(savedir = list(figs = "Figure+Table", tabs = "Figure+Table"))
```

```{r eval = T, echo = F, results = "asis"}
set_index()
```

# 题目

# 摘要 {#abstract}

# 前言 {#introduction}

CKD 与患癌症风险之间的联系尚未明确。尽管多项研究观察到需要透析或肾移植的 ESRD 患者患癌症的风险较高，但不太严重的肾脏疾病是否与癌症相关仍知之甚少[@OnconephrologyRosner2021; @CkdAndTheRisLowran2014; @CancerRiskAndKitchl2022]。

肾癌流行病学[@EpidemiologyOfBukavi2022]

CKD 和肾癌[@RenalCellCancSaly2021]

Cancer Risk and Mortality in Patients With Kidney Disease: Cancer risk was increased in mild to moderate CKD and among transplant recipients[@CancerRiskAndKitchl2022]

# 研究设计流程图 {#route}

TCGA 突变数据
TCGA 转录数据
基因共表达
免疫浸润水平
生存分析
timeROC
单细胞数据验证

多种慢性肾病的 FC
癌症的 FC
用基因集的 FC 来关联分析 (需要多个 GEO 数据集)

- Kidney status markers
- cancer markers
- micro-envir...
- ferroptosis
- ...

```{r}
#| route
route <- as_network(
  list("RNA_seq_data:Preprocess",
    ), "tree"
)
p.route <- flowChart(route, 1.1, 1)
```

```{r, eval = T, echo = F, fig.width = 10, fig.height = 7, fig.cap = NULL}
p.route
```

# 材料和方法 {#methods}

```{r}
lite_cancer <- esearch.mj("cancer prediction")
lite_cancer %>% select(.id, Title) %>% filter(grepl("Nature", .id)) %>% print(n = 100)
```

# 分析结果 {#results}

# 结论 {#dis}

# 附：分析流程

## 肾癌 (GEO)

### GSE171306

    - Single-cell RNA sequencing (scRNA-seq) was performed on bilateral clear
      cell RCC (ccRCC). Primary kidney samples from 3 patients were used for
      single cell RNA sequencing by 10X Genomics

```{r}
geo1 <- job_geo("GSE171306")
geo1 <- step1(geo1)
geo1 <- step2(geo1)
untar("./GSE171306/GSE171306_RAW.tar", exdir = "./GSE171306")
dir.create("./GSE171306/sample1")

fun <- function() {
  files <- list.files("./GSE171306/", "\\.gz$", full.names = T)
  files <- files[ grepl("ccRCC1", files) ]
  lapply(files,
    function(x)
      file.rename(x, paste0("./GSE171306/sample1/",
          gs(get_filename(x), ".*_", "")))
  )}
fun()
```

#### 细胞聚类和注释

```{r}
sr <- job_seurat("./GSE171306/sample1")
sr <- step1(sr)
sr@plots$step1$p.qc
sr <- step2(sr, 0, 7500, 35)
sr@plots$step2$p.pca_rank
sr <- step3(sr, 1:15, 1.2)
sr@step <- 4L
sr@plots$step3$p.umap
sr <- step5(sr, 5)
sr <- step6(sr, "Kidney")

sr@plots$step6$p.map_scsa
```

#### 癌细胞识别

```{r}
kat <- job_kat(sr)
kat <- step1(kat)
```

## 肾癌 (TCGA-KIRC)

### TCGA 数据

```{r}
tc <- job_tcga("TCGA-KIRC")
tc <- step1(tc)
tc <- step2(tc)
tc <- step3(tc)
tc <- clear(tc)

lm <- asjob_limma(tc)
lm@object$samples
```

## 血管性疾患

### 高血压性肾炎（hypertensive nephropathy）
- GSE210898: Single-cell RNA transcriptomics of hypertensive nephropathy patients

```{r}
geo.hn <- job_geo("GSE210898")
```

#### 细胞聚类和注释



## （原发性）肾小球性疾患

### IgA 肾病 (IgA Nephropathy)

- GSE171314, scRNA-seq
- GSE145652, RNA-seq
- GSE175759, RNA-seq

### 膜性肾病 (idiopathic membranous nephropathy)

- GSE241302, scRNA
- GSE216841, RNA-seq
- GSE175759, RNA-seq

### 微小病变肾病 (Minimal change disease)

- GSE176465, scRNA (only but not fit)
- GSE216841, RNA-seq
- GSE175759, RNA-seq

## （继发性）肾小球性疾患

### 糖尿病肾病 (Diabetic kidney disease)

- GSE204880, scRNA
- GSE175759, RNA-seq
- GSE199838, RNA-seq
- GSE217709, RNA-seq

### 狼疮性肾炎 (lupus nephritis)

- no scRNA
- GSE175759, RNA-seq
- GSE157293, RNA-seq

