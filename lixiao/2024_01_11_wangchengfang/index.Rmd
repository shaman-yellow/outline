---
---

```{r include = F, eval = F}
deparse_mail()
info <- items(belong = odate(1), coef = cf(900))

order_publish()
idname <- order_packaging()
```

```{r include = F}
#| setup
if (!requireNamespace("utils.tool"))
  devtools::load_all("~/utils.tool/")
autor_preset()
## the package are available at <https://github.com/shaman-yellow/utils.tool>
## if you want to run codes of this Rmarkdown,
## please install the package `utils.tool` and other related packages (run
## install.R)
options(savedir = list(figs = "Figure+Table", tabs = "Figure+Table"))
```

```{r eval = T, echo = F, results = "asis"}
set_cover(info$title)
```

```{r eval = T, echo = F, results = "asis"}
set_index()
```

# 摘要 {#abstract}

- 质谱对复方内的五味药萆薢、土茯苓、泽泻、川牛膝和生米仁进行预测，得到复方药物的具体的有效药物成分XX1、XX2、XX3
- 分子对接检测XX1、XX2、XX3与FOXO信号的对接能量
- 通过GO功能富集分析和KEGG通路富集分析，对FOXO信号通路的下游靶点进行预测，进而得到所需的关于抑制炎症的下游靶点YY

```{r}
dic(di("差异表达基因", "Differential Expressed Genes", "DEGs"))
```

# 前言 {#introduction}

# 材料和方法 {#methods}

## 材料

```{r eval = T, echo = F, results = "asis"}
auto_material()
```

## 方法

```{r eval = T, echo = F, results = "asis"}
auto_method("job_herb")
```

# 分析结果 {#results}

# 结论 {#dis}

# 附：分析流程 {#workflow}

## 已被鉴定的成分

```{r eval = T, echo = F, results = "asis"}
#| Identified-compounds-records-in-table-CompoundDiscovery
autor(lstcd$table)
```

```{r}
lstcd <- read_from_compoundDiscovery("./order_material/活性成分附表-FT231221067-Y.xlsx")

oc <- job_ocr()
oc <- step1(oc)
res <- map(oc, scales$file)

lstcd <- try_get_area.compoundDiscovery(lstcd, res)
```

## 化合物信息

```{r}
table <- lstcd$table
db <- try_get_cids.name(table$en.name)
db <- dplyr::mutate(db,
  CID = dplyr::recode(Identifier,
    Maltopentaose = 13489094L,
    "Liguiritigenin-7-O-β-D-apiosyl-4'-O-β-D-glucoside" = 74819332L,
    "Oroxylin A-7-O-β-D-glucuronide" = 14655552L,
    "α-Linolenic acid" = 5280934L,
    "Ononin" = 442813L,
    "Calycosin-7-O-β-D-glucoside" = 137699082L,
    .default = CID
  )
)

pr <- job_pubchemr(nl(db$Identifier, db$CID, F))
pr <- step1(pr)

cf <- job_classyfire(pr@object)
cf <- step1(cf)
cf <- step2(cf)
cf@plots$step2$p.classes_freq

sp <- asjob_superpred(pr)
sp <- step1(sp, port = 7777)

hb <- do_herb(pr, sp, run_step3 = F)
hb <- step3(hb)
hb@tables$step2$compounds_targets

tmp <- dplyr::mutate(table, name = en.name, level = log2(peak_area))
hb <- map(hb, list(), levels = tmp, lab.level = "Log2(Peak area)")
hb@params$p.pharmMap

gm <- job_gmix("inflammation", "inflammation")
gm <- step1(gm)
gm <- step2(gm, 1, 1, 5)
gm@plots$step2$p.cols
gm@params$lst.genes

hb <- map(hb, gm@params$lst.genes, levels = tmp, lab.level = "Log2(Peak area)")
hb@params$p.pharm2dis
hb@params$p.venn2dis

tf <- job_tfbs(hb@params$p.venn2dis$ins)
tf <- step1(tf, cl = 5)

## tf (FOXO) >> ins

en <- job_enrich(hb@params$p.venn2dis$ins)
en <- step1(en)
en@plots$step1$p.go$ids
en@plots$step1$p.kegg$ids



```

## LC-MS

```{r}
path <- "/media/echo/6E3CE3153CE2D75D/王陈芳质谱结果/FT231221067-原始数据/"
files <- list.files(path, ".raw$")

msc <- job_msconvert(path, files)
msc.neg <- step1(msc, "neg")
msc.pos <- step1(msc, "pos")

```

### Neg

```{r}
xc.neg <- asjob_xcms(msc.neg)
xc.neg <- step1(xc.neg)
xc.neg <- step2(xc.neg)

si.neg <- asjob_sirius(xc.neg)
si.neg <- set_remote(si.neg, "/data/hlc/wangchengfang_neg")
si.neg@step <- 0L
si.neg <- step1(si.neg)
si.neg <- step2(si.neg, NULL, workers = 30)

si.neg <- step3(si.neg)
ping(si.neg)



```

### Pos

```{r}

```

```{r}
saves()
loads()
```
